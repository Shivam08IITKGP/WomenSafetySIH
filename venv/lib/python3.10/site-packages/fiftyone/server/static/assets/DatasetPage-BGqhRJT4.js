const __vite__fileDeps=["./troika-three-text.esm-D8EKBBIg.js","./index-BC5hUGnO.js","./index-BnE2Oh-e.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var CB=Object.defineProperty;var AB=(n,t,r)=>t in n?CB(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var bf=(n,t,r)=>(AB(n,typeof t!="symbol"?t+"":t,r),r);import TB from"./DatasetPageQuery.graphql-3t8VEU88.js";import{a as k,b as cp,c as up,j as Q,d as Xh,e as qh,i as Kh,g as hp,f as sn,h as ep,k as D_,l as SB,u as Da,m as Ro,L as i_,C as O_,n as MB,o as IB,v as k_,p as d1,q as f1,s as ah,t as _T,w as p1,x as Pi,y as zd,z as yT,A as PB,B as LB,D as BB,E as m1,F as fc,G as RB,H as gv,I as DB,J as Nh,P as OB,K as vT,M as xT,N as u_,O as bT,Q as wT,T as ET,U as kB,V as CT,W as g1,X as _1,Y as AT,Z as zB,_ as Xo,$ as Md,a0 as pc,R as Pe,a1 as z_,a2 as F_,a3 as h0,a4 as Cm,a5 as FB,a6 as jB,a7 as _l,a8 as Wf,a9 as Ai,aa as y1,ab as wd,ac as Ed,ad as Am,ae as d0,af as UB,ag as NB,ah as Tt,ai as Zo,aj as GB,ak as VB,al as $B,am as HB,an as WB,ao as ZB,ap as XB,aq as qB,ar as KB,as as _v,at as TT,au as v1,av as JB,aw as ST,ax as YB,ay as wf,az as Ef,aA as kl,aB as yv,aC as Jh,aD as Dl,aE as Tu,aF as MT,aG as vv,aH as IT,aI as Uf,aJ as Pu,aK as Ci,aL as QB,aM as eR,aN as Ba,aO as j_,aP as tR,aQ as Vh,aR as nR,aS as h_,aT as PT,aU as tp,aV as Cd,aW as vm,aX as km,aY as x1,aZ as Tm,a_ as LT,a$ as Oa,b0 as d_,b1,b2 as rR,b3 as Id,b4 as Zf,b5 as fa,b6 as BT,b7 as RT,b8 as xv,b9 as DT,ba as iR,bb as oR,bc as sR,bd as aR,be as bv,bf as lR,bg as cR,bh as OT,bi as zl,bj as wv,bk as Ev,bl as Cv,bm as dh,bn as dp,bo as uR,bp as za,bq as hR,br as Xf,bs as kT,bt as dR,bu as fR,bv as Ti,bw as pR,bx as mR,by as gm,bz as zT,bA as np,bB as FT,bC as w1,bD as Sm,bE as qf,bF as jT,bG as Gr,bH as gR,bI as _R,bJ as yR,bK as vR,bL as UT,bM as xR,bN as NT,bO as GT,bP as VT,bQ as $T,bR,bS as fp,bT as pp,bU as wR,bV as Gi,bW as ER,bX as CR,bY as AR,bZ as HT,b_ as TR,b$ as SR,c0 as MR,c1 as _m,c2 as o_,c3 as WT,c4 as IR,c5 as PR,c6 as f0,c7 as LR,c8 as BR,c9 as RR,ca as U_,cb as DR,cc as ZT,cd as OR,ce as Av,cf as f_,cg as kR,ch as zR,ci as FR,cj as jR,ck as XT,cl as Mm,cm as E1,cn as p_,co as m_,cp as qT,cq as KT,cr as C1,cs as A1,ct as Nf,cu as T1,cv as S1,cw as $w,cx as uc,cy as nh,cz as UR,cA as Hw,cB as N_,cC as NR,cD as GR,cE as JT,cF as M1,cG as VR,cH as Tv,cI as Ww,cJ as s_,cK as $R,cL as HR,cM as WR,cN as Zw,cO as ZR,cP as Sv,cQ as XR,cR as p0,cS as qR,cT as YT,cU as KR,cV as Mv,cW as m0,cX as QT,cY as JR,cZ as YR,c_ as QR,c$ as eD,d0 as tD,d1 as eS,d2 as nD,d3 as rD,d4 as iD,d5 as tS,d6 as Xw,d7 as g0,d8 as oD,d9 as sD,da as aD,db as lD,dc as nS,dd as rS,de as cD,df as uD,dg as hD,dh as dD,di as fD,dj as pD,dk as mD,dl as gD,dm as _D,dn as yD,dp as vD,dq as xD,dr as qw,ds as bD,dt as _0,du as wD,dv as ED,dw as CD,dx as AD,dy as Kw,dz as Jw,dA as TD,dB as SD,dC as MD,dD as ID,dE as zf,dF as G_,dG as PD,dH as LD,dI as Yw,r as BD,dJ as RD,dK as DD,dL as OD,dM as kD,S as zD}from"./index-BC5hUGnO.js";import{N as FD,s as jD,S as UD}from"./index.module-CDjp3B6c.js";function ND(n,t){for(var r=0;r<t.length;r++){const l=t[r];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in n)){const d=Object.getOwnPropertyDescriptor(l,u);d&&Object.defineProperty(n,u,d.get?d:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const GD=["top","right","bottom","left"],$h=Math.min,Rl=Math.max,g_=Math.round,Dg=Math.floor,Hh=n=>({x:n,y:n}),VD={left:"right",right:"left",bottom:"top",top:"bottom"},$D={start:"end",end:"start"};function Iv(n,t,r){return Rl(n,$h(t,r))}function lh(n,t){return typeof n=="function"?n(t):n}function ch(n){return n.split("-")[0]}function mp(n){return n.split("-")[1]}function I1(n){return n==="x"?"y":"x"}function P1(n){return n==="y"?"height":"width"}function gp(n){return["top","bottom"].includes(ch(n))?"y":"x"}function L1(n){return I1(gp(n))}function HD(n,t,r){r===void 0&&(r=!1);const l=mp(n),u=L1(n),d=P1(u);let p=u==="x"?l===(r?"end":"start")?"right":"left":l==="start"?"bottom":"top";return t.reference[d]>t.floating[d]&&(p=__(p)),[p,__(p)]}function WD(n){const t=__(n);return[Pv(n),t,Pv(t)]}function Pv(n){return n.replace(/start|end/g,t=>$D[t])}function ZD(n,t,r){const l=["left","right"],u=["right","left"],d=["top","bottom"],p=["bottom","top"];switch(n){case"top":case"bottom":return r?t?u:l:t?l:u;case"left":case"right":return t?d:p;default:return[]}}function XD(n,t,r,l){const u=mp(n);let d=ZD(ch(n),r==="start",l);return u&&(d=d.map(p=>p+"-"+u),t&&(d=d.concat(d.map(Pv)))),d}function __(n){return n.replace(/left|right|bottom|top/g,t=>VD[t])}function qD(n){return{top:0,right:0,bottom:0,left:0,...n}}function iS(n){return typeof n!="number"?qD(n):{top:n,right:n,bottom:n,left:n}}function y_(n){return{...n,top:n.y,left:n.x,right:n.x+n.width,bottom:n.y+n.height}}function Qw(n,t,r){let{reference:l,floating:u}=n;const d=gp(t),p=L1(t),b=P1(p),i=ch(t),E=d==="y",T=l.x+l.width/2-u.width/2,A=l.y+l.height/2-u.height/2,I=l[b]/2-u[b]/2;let O;switch(i){case"top":O={x:T,y:l.y-u.height};break;case"bottom":O={x:T,y:l.y+l.height};break;case"right":O={x:l.x+l.width,y:A};break;case"left":O={x:l.x-u.width,y:A};break;default:O={x:l.x,y:l.y}}switch(mp(t)){case"start":O[p]-=I*(r&&E?-1:1);break;case"end":O[p]+=I*(r&&E?-1:1);break}return O}const KD=async(n,t,r)=>{const{placement:l="bottom",strategy:u="absolute",middleware:d=[],platform:p}=r,b=d.filter(Boolean),i=await(p.isRTL==null?void 0:p.isRTL(t));let E=await p.getElementRects({reference:n,floating:t,strategy:u}),{x:T,y:A}=Qw(E,l,i),I=l,O={},z=0;for(let U=0;U<b.length;U++){const{name:N,fn:V}=b[U],{x:X,y:J,data:te,reset:ue}=await V({x:T,y:A,initialPlacement:l,placement:I,strategy:u,middlewareData:O,rects:E,platform:p,elements:{reference:n,floating:t}});T=X??T,A=J??A,O={...O,[N]:{...O[N],...te}},ue&&z<=50&&(z++,typeof ue=="object"&&(ue.placement&&(I=ue.placement),ue.rects&&(E=ue.rects===!0?await p.getElementRects({reference:n,floating:t,strategy:u}):ue.rects),{x:T,y:A}=Qw(E,I,i)),U=-1)}return{x:T,y:A,placement:I,strategy:u,middlewareData:O}};async function Im(n,t){var r;t===void 0&&(t={});const{x:l,y:u,platform:d,rects:p,elements:b,strategy:i}=n,{boundary:E="clippingAncestors",rootBoundary:T="viewport",elementContext:A="floating",altBoundary:I=!1,padding:O=0}=lh(t,n),z=iS(O),N=b[I?A==="floating"?"reference":"floating":A],V=y_(await d.getClippingRect({element:(r=await(d.isElement==null?void 0:d.isElement(N)))==null||r?N:N.contextElement||await(d.getDocumentElement==null?void 0:d.getDocumentElement(b.floating)),boundary:E,rootBoundary:T,strategy:i})),X=A==="floating"?{...p.floating,x:l,y:u}:p.reference,J=await(d.getOffsetParent==null?void 0:d.getOffsetParent(b.floating)),te=await(d.isElement==null?void 0:d.isElement(J))?await(d.getScale==null?void 0:d.getScale(J))||{x:1,y:1}:{x:1,y:1},ue=y_(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({elements:b,rect:X,offsetParent:J,strategy:i}):X);return{top:(V.top-ue.top+z.top)/te.y,bottom:(ue.bottom-V.bottom+z.bottom)/te.y,left:(V.left-ue.left+z.left)/te.x,right:(ue.right-V.right+z.right)/te.x}}const JD=n=>({name:"arrow",options:n,async fn(t){const{x:r,y:l,placement:u,rects:d,platform:p,elements:b,middlewareData:i}=t,{element:E,padding:T=0}=lh(n,t)||{};if(E==null)return{};const A=iS(T),I={x:r,y:l},O=L1(u),z=P1(O),U=await p.getDimensions(E),N=O==="y",V=N?"top":"left",X=N?"bottom":"right",J=N?"clientHeight":"clientWidth",te=d.reference[z]+d.reference[O]-I[O]-d.floating[z],ue=I[O]-d.reference[O],ae=await(p.getOffsetParent==null?void 0:p.getOffsetParent(E));let be=ae?ae[J]:0;(!be||!await(p.isElement==null?void 0:p.isElement(ae)))&&(be=b.floating[J]||d.floating[z]);const Ce=te/2-ue/2,je=be/2-U[z]/2-1,me=$h(A[V],je),Ne=$h(A[X],je),ht=me,_t=be-U[z]-Ne,Bt=be/2-U[z]/2+Ce,Kt=Iv(ht,Bt,_t),Gt=!i.arrow&&mp(u)!=null&&Bt!==Kt&&d.reference[z]/2-(Bt<ht?me:Ne)-U[z]/2<0,hn=Gt?Bt<ht?Bt-ht:Bt-_t:0;return{[O]:I[O]+hn,data:{[O]:Kt,centerOffset:Bt-Kt-hn,...Gt&&{alignmentOffset:hn}},reset:Gt}}}),YD=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(t){var r,l;const{placement:u,middlewareData:d,rects:p,initialPlacement:b,platform:i,elements:E}=t,{mainAxis:T=!0,crossAxis:A=!0,fallbackPlacements:I,fallbackStrategy:O="bestFit",fallbackAxisSideDirection:z="none",flipAlignment:U=!0,...N}=lh(n,t);if((r=d.arrow)!=null&&r.alignmentOffset)return{};const V=ch(u),X=ch(b)===b,J=await(i.isRTL==null?void 0:i.isRTL(E.floating)),te=I||(X||!U?[__(b)]:WD(b));!I&&z!=="none"&&te.push(...XD(b,U,z,J));const ue=[b,...te],ae=await Im(t,N),be=[];let Ce=((l=d.flip)==null?void 0:l.overflows)||[];if(T&&be.push(ae[V]),A){const ht=HD(u,p,J);be.push(ae[ht[0]],ae[ht[1]])}if(Ce=[...Ce,{placement:u,overflows:be}],!be.every(ht=>ht<=0)){var je,me;const ht=(((je=d.flip)==null?void 0:je.index)||0)+1,_t=ue[ht];if(_t)return{data:{index:ht,overflows:Ce},reset:{placement:_t}};let Bt=(me=Ce.filter(Kt=>Kt.overflows[0]<=0).sort((Kt,Gt)=>Kt.overflows[1]-Gt.overflows[1])[0])==null?void 0:me.placement;if(!Bt)switch(O){case"bestFit":{var Ne;const Kt=(Ne=Ce.map(Gt=>[Gt.placement,Gt.overflows.filter(hn=>hn>0).reduce((hn,wt)=>hn+wt,0)]).sort((Gt,hn)=>Gt[1]-hn[1])[0])==null?void 0:Ne[0];Kt&&(Bt=Kt);break}case"initialPlacement":Bt=b;break}if(u!==Bt)return{reset:{placement:Bt}}}return{}}}};function eE(n,t){return{top:n.top-t.height,right:n.right-t.width,bottom:n.bottom-t.height,left:n.left-t.width}}function tE(n){return GD.some(t=>n[t]>=0)}const QD=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(t){const{rects:r}=t,{strategy:l="referenceHidden",...u}=lh(n,t);switch(l){case"referenceHidden":{const d=await Im(t,{...u,elementContext:"reference"}),p=eE(d,r.reference);return{data:{referenceHiddenOffsets:p,referenceHidden:tE(p)}}}case"escaped":{const d=await Im(t,{...u,altBoundary:!0}),p=eE(d,r.floating);return{data:{escapedOffsets:p,escaped:tE(p)}}}default:return{}}}}};async function eO(n,t){const{placement:r,platform:l,elements:u}=n,d=await(l.isRTL==null?void 0:l.isRTL(u.floating)),p=ch(r),b=mp(r),i=gp(r)==="y",E=["left","top"].includes(p)?-1:1,T=d&&i?-1:1,A=lh(t,n);let{mainAxis:I,crossAxis:O,alignmentAxis:z}=typeof A=="number"?{mainAxis:A,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...A};return b&&typeof z=="number"&&(O=b==="end"?z*-1:z),i?{x:O*T,y:I*E}:{x:I*E,y:O*T}}const tO=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(t){var r,l;const{x:u,y:d,placement:p,middlewareData:b}=t,i=await eO(t,n);return p===((r=b.offset)==null?void 0:r.placement)&&(l=b.arrow)!=null&&l.alignmentOffset?{}:{x:u+i.x,y:d+i.y,data:{...i,placement:p}}}}},nO=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(t){const{x:r,y:l,placement:u}=t,{mainAxis:d=!0,crossAxis:p=!1,limiter:b={fn:N=>{let{x:V,y:X}=N;return{x:V,y:X}}},...i}=lh(n,t),E={x:r,y:l},T=await Im(t,i),A=gp(ch(u)),I=I1(A);let O=E[I],z=E[A];if(d){const N=I==="y"?"top":"left",V=I==="y"?"bottom":"right",X=O+T[N],J=O-T[V];O=Iv(X,O,J)}if(p){const N=A==="y"?"top":"left",V=A==="y"?"bottom":"right",X=z+T[N],J=z-T[V];z=Iv(X,z,J)}const U=b.fn({...t,[I]:O,[A]:z});return{...U,data:{x:U.x-r,y:U.y-l}}}}},rO=function(n){return n===void 0&&(n={}),{options:n,fn(t){const{x:r,y:l,placement:u,rects:d,middlewareData:p}=t,{offset:b=0,mainAxis:i=!0,crossAxis:E=!0}=lh(n,t),T={x:r,y:l},A=gp(u),I=I1(A);let O=T[I],z=T[A];const U=lh(b,t),N=typeof U=="number"?{mainAxis:U,crossAxis:0}:{mainAxis:0,crossAxis:0,...U};if(i){const J=I==="y"?"height":"width",te=d.reference[I]-d.floating[J]+N.mainAxis,ue=d.reference[I]+d.reference[J]-N.mainAxis;O<te?O=te:O>ue&&(O=ue)}if(E){var V,X;const J=I==="y"?"width":"height",te=["top","left"].includes(ch(u)),ue=d.reference[A]-d.floating[J]+(te&&((V=p.offset)==null?void 0:V[A])||0)+(te?0:N.crossAxis),ae=d.reference[A]+d.reference[J]+(te?0:((X=p.offset)==null?void 0:X[A])||0)-(te?N.crossAxis:0);z<ue?z=ue:z>ae&&(z=ae)}return{[I]:O,[A]:z}}}},iO=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(t){const{placement:r,rects:l,platform:u,elements:d}=t,{apply:p=()=>{},...b}=lh(n,t),i=await Im(t,b),E=ch(r),T=mp(r),A=gp(r)==="y",{width:I,height:O}=l.floating;let z,U;E==="top"||E==="bottom"?(z=E,U=T===(await(u.isRTL==null?void 0:u.isRTL(d.floating))?"start":"end")?"left":"right"):(U=E,z=T==="end"?"top":"bottom");const N=O-i[z],V=I-i[U],X=!t.middlewareData.shift;let J=N,te=V;if(A){const ae=I-i.left-i.right;te=T||X?$h(V,ae):ae}else{const ae=O-i.top-i.bottom;J=T||X?$h(N,ae):ae}if(X&&!T){const ae=Rl(i.left,0),be=Rl(i.right,0),Ce=Rl(i.top,0),je=Rl(i.bottom,0);A?te=I-2*(ae!==0||be!==0?ae+be:Rl(i.left,i.right)):J=O-2*(Ce!==0||je!==0?Ce+je:Rl(i.top,i.bottom))}await p({...t,availableWidth:te,availableHeight:J});const ue=await u.getDimensions(d.floating);return I!==ue.width||O!==ue.height?{reset:{rects:!0}}:{}}}};function Wh(n){return oS(n)?(n.nodeName||"").toLowerCase():"#document"}function jl(n){var t;return(n==null||(t=n.ownerDocument)==null?void 0:t.defaultView)||window}function fh(n){var t;return(t=(oS(n)?n.ownerDocument:n.document)||window.document)==null?void 0:t.documentElement}function oS(n){return n instanceof Node||n instanceof jl(n).Node}function uh(n){return n instanceof Element||n instanceof jl(n).Element}function Su(n){return n instanceof HTMLElement||n instanceof jl(n).HTMLElement}function nE(n){return typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof jl(n).ShadowRoot}function zm(n){const{overflow:t,overflowX:r,overflowY:l,display:u}=hc(n);return/auto|scroll|overlay|hidden|clip/.test(t+l+r)&&!["inline","contents"].includes(u)}function oO(n){return["table","td","th"].includes(Wh(n))}function B1(n){const t=R1(),r=hc(n);return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(l=>(r.willChange||"").includes(l))||["paint","layout","strict","content"].some(l=>(r.contain||"").includes(l))}function sO(n){let t=rp(n);for(;Su(t)&&!V_(t);){if(B1(t))return t;t=rp(t)}return null}function R1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function V_(n){return["html","body","#document"].includes(Wh(n))}function hc(n){return jl(n).getComputedStyle(n)}function $_(n){return uh(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function rp(n){if(Wh(n)==="html")return n;const t=n.assignedSlot||n.parentNode||nE(n)&&n.host||fh(n);return nE(t)?t.host:t}function sS(n){const t=rp(n);return V_(t)?n.ownerDocument?n.ownerDocument.body:n.body:Su(t)&&zm(t)?t:sS(t)}function Pm(n,t,r){var l;t===void 0&&(t=[]),r===void 0&&(r=!0);const u=sS(n),d=u===((l=n.ownerDocument)==null?void 0:l.body),p=jl(u);return d?t.concat(p,p.visualViewport||[],zm(u)?u:[],p.frameElement&&r?Pm(p.frameElement):[]):t.concat(u,Pm(u,[],r))}function aS(n){const t=hc(n);let r=parseFloat(t.width)||0,l=parseFloat(t.height)||0;const u=Su(n),d=u?n.offsetWidth:r,p=u?n.offsetHeight:l,b=g_(r)!==d||g_(l)!==p;return b&&(r=d,l=p),{width:r,height:l,$:b}}function D1(n){return uh(n)?n:n.contextElement}function Kf(n){const t=D1(n);if(!Su(t))return Hh(1);const r=t.getBoundingClientRect(),{width:l,height:u,$:d}=aS(t);let p=(d?g_(r.width):r.width)/l,b=(d?g_(r.height):r.height)/u;return(!p||!Number.isFinite(p))&&(p=1),(!b||!Number.isFinite(b))&&(b=1),{x:p,y:b}}const aO=Hh(0);function lS(n){const t=jl(n);return!R1()||!t.visualViewport?aO:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function lO(n,t,r){return t===void 0&&(t=!1),!r||t&&r!==jl(n)?!1:t}function Od(n,t,r,l){t===void 0&&(t=!1),r===void 0&&(r=!1);const u=n.getBoundingClientRect(),d=D1(n);let p=Hh(1);t&&(l?uh(l)&&(p=Kf(l)):p=Kf(n));const b=lO(d,r,l)?lS(d):Hh(0);let i=(u.left+b.x)/p.x,E=(u.top+b.y)/p.y,T=u.width/p.x,A=u.height/p.y;if(d){const I=jl(d),O=l&&uh(l)?jl(l):l;let z=I,U=z.frameElement;for(;U&&l&&O!==z;){const N=Kf(U),V=U.getBoundingClientRect(),X=hc(U),J=V.left+(U.clientLeft+parseFloat(X.paddingLeft))*N.x,te=V.top+(U.clientTop+parseFloat(X.paddingTop))*N.y;i*=N.x,E*=N.y,T*=N.x,A*=N.y,i+=J,E+=te,z=jl(U),U=z.frameElement}}return y_({width:T,height:A,x:i,y:E})}const cO=[":popover-open",":modal"];function cS(n){return cO.some(t=>{try{return n.matches(t)}catch{return!1}})}function uO(n){let{elements:t,rect:r,offsetParent:l,strategy:u}=n;const d=u==="fixed",p=fh(l),b=t?cS(t.floating):!1;if(l===p||b&&d)return r;let i={scrollLeft:0,scrollTop:0},E=Hh(1);const T=Hh(0),A=Su(l);if((A||!A&&!d)&&((Wh(l)!=="body"||zm(p))&&(i=$_(l)),Su(l))){const I=Od(l);E=Kf(l),T.x=I.x+l.clientLeft,T.y=I.y+l.clientTop}return{width:r.width*E.x,height:r.height*E.y,x:r.x*E.x-i.scrollLeft*E.x+T.x,y:r.y*E.y-i.scrollTop*E.y+T.y}}function hO(n){return Array.from(n.getClientRects())}function uS(n){return Od(fh(n)).left+$_(n).scrollLeft}function dO(n){const t=fh(n),r=$_(n),l=n.ownerDocument.body,u=Rl(t.scrollWidth,t.clientWidth,l.scrollWidth,l.clientWidth),d=Rl(t.scrollHeight,t.clientHeight,l.scrollHeight,l.clientHeight);let p=-r.scrollLeft+uS(n);const b=-r.scrollTop;return hc(l).direction==="rtl"&&(p+=Rl(t.clientWidth,l.clientWidth)-u),{width:u,height:d,x:p,y:b}}function fO(n,t){const r=jl(n),l=fh(n),u=r.visualViewport;let d=l.clientWidth,p=l.clientHeight,b=0,i=0;if(u){d=u.width,p=u.height;const E=R1();(!E||E&&t==="fixed")&&(b=u.offsetLeft,i=u.offsetTop)}return{width:d,height:p,x:b,y:i}}function pO(n,t){const r=Od(n,!0,t==="fixed"),l=r.top+n.clientTop,u=r.left+n.clientLeft,d=Su(n)?Kf(n):Hh(1),p=n.clientWidth*d.x,b=n.clientHeight*d.y,i=u*d.x,E=l*d.y;return{width:p,height:b,x:i,y:E}}function rE(n,t,r){let l;if(t==="viewport")l=fO(n,r);else if(t==="document")l=dO(fh(n));else if(uh(t))l=pO(t,r);else{const u=lS(n);l={...t,x:t.x-u.x,y:t.y-u.y}}return y_(l)}function hS(n,t){const r=rp(n);return r===t||!uh(r)||V_(r)?!1:hc(r).position==="fixed"||hS(r,t)}function mO(n,t){const r=t.get(n);if(r)return r;let l=Pm(n,[],!1).filter(b=>uh(b)&&Wh(b)!=="body"),u=null;const d=hc(n).position==="fixed";let p=d?rp(n):n;for(;uh(p)&&!V_(p);){const b=hc(p),i=B1(p);!i&&b.position==="fixed"&&(u=null),(d?!i&&!u:!i&&b.position==="static"&&!!u&&["absolute","fixed"].includes(u.position)||zm(p)&&!i&&hS(n,p))?l=l.filter(T=>T!==p):u=b,p=rp(p)}return t.set(n,l),l}function gO(n){let{element:t,boundary:r,rootBoundary:l,strategy:u}=n;const p=[...r==="clippingAncestors"?mO(t,this._c):[].concat(r),l],b=p[0],i=p.reduce((E,T)=>{const A=rE(t,T,u);return E.top=Rl(A.top,E.top),E.right=$h(A.right,E.right),E.bottom=$h(A.bottom,E.bottom),E.left=Rl(A.left,E.left),E},rE(t,b,u));return{width:i.right-i.left,height:i.bottom-i.top,x:i.left,y:i.top}}function _O(n){const{width:t,height:r}=aS(n);return{width:t,height:r}}function yO(n,t,r){const l=Su(t),u=fh(t),d=r==="fixed",p=Od(n,!0,d,t);let b={scrollLeft:0,scrollTop:0};const i=Hh(0);if(l||!l&&!d)if((Wh(t)!=="body"||zm(u))&&(b=$_(t)),l){const A=Od(t,!0,d,t);i.x=A.x+t.clientLeft,i.y=A.y+t.clientTop}else u&&(i.x=uS(u));const E=p.left+b.scrollLeft-i.x,T=p.top+b.scrollTop-i.y;return{x:E,y:T,width:p.width,height:p.height}}function iE(n,t){return!Su(n)||hc(n).position==="fixed"?null:t?t(n):n.offsetParent}function dS(n,t){const r=jl(n);if(!Su(n)||cS(n))return r;let l=iE(n,t);for(;l&&oO(l)&&hc(l).position==="static";)l=iE(l,t);return l&&(Wh(l)==="html"||Wh(l)==="body"&&hc(l).position==="static"&&!B1(l))?r:l||sO(n)||r}const vO=async function(n){const t=this.getOffsetParent||dS,r=this.getDimensions;return{reference:yO(n.reference,await t(n.floating),n.strategy),floating:{x:0,y:0,...await r(n.floating)}}};function xO(n){return hc(n).direction==="rtl"}const bO={convertOffsetParentRelativeRectToViewportRelativeRect:uO,getDocumentElement:fh,getClippingRect:gO,getOffsetParent:dS,getElementRects:vO,getClientRects:hO,getDimensions:_O,getScale:Kf,isElement:uh,isRTL:xO};function wO(n,t){let r=null,l;const u=fh(n);function d(){var b;clearTimeout(l),(b=r)==null||b.disconnect(),r=null}function p(b,i){b===void 0&&(b=!1),i===void 0&&(i=1),d();const{left:E,top:T,width:A,height:I}=n.getBoundingClientRect();if(b||t(),!A||!I)return;const O=Dg(T),z=Dg(u.clientWidth-(E+A)),U=Dg(u.clientHeight-(T+I)),N=Dg(E),X={rootMargin:-O+"px "+-z+"px "+-U+"px "+-N+"px",threshold:Rl(0,$h(1,i))||1};let J=!0;function te(ue){const ae=ue[0].intersectionRatio;if(ae!==i){if(!J)return p();ae?p(!1,ae):l=setTimeout(()=>{p(!1,1e-7)},100)}J=!1}try{r=new IntersectionObserver(te,{...X,root:u.ownerDocument})}catch{r=new IntersectionObserver(te,X)}r.observe(n)}return p(!0),d}function EO(n,t,r,l){l===void 0&&(l={});const{ancestorScroll:u=!0,ancestorResize:d=!0,elementResize:p=typeof ResizeObserver=="function",layoutShift:b=typeof IntersectionObserver=="function",animationFrame:i=!1}=l,E=D1(n),T=u||d?[...E?Pm(E):[],...Pm(t)]:[];T.forEach(V=>{u&&V.addEventListener("scroll",r,{passive:!0}),d&&V.addEventListener("resize",r)});const A=E&&b?wO(E,r):null;let I=-1,O=null;p&&(O=new ResizeObserver(V=>{let[X]=V;X&&X.target===E&&O&&(O.unobserve(t),cancelAnimationFrame(I),I=requestAnimationFrame(()=>{var J;(J=O)==null||J.observe(t)})),r()}),E&&!i&&O.observe(E),O.observe(t));let z,U=i?Od(n):null;i&&N();function N(){const V=Od(n);U&&(V.x!==U.x||V.y!==U.y||V.width!==U.width||V.height!==U.height)&&r(),U=V,z=requestAnimationFrame(N)}return r(),()=>{var V;T.forEach(X=>{u&&X.removeEventListener("scroll",r),d&&X.removeEventListener("resize",r)}),A==null||A(),(V=O)==null||V.disconnect(),O=null,i&&cancelAnimationFrame(z)}}const CO=nO,AO=YD,TO=iO,SO=QD,oE=JD,MO=rO,IO=(n,t,r)=>{const l=new Map,u={platform:bO,...r},d={...u.platform,_c:l};return KD(n,t,{...u,platform:d})},PO=n=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:n,fn(r){const{element:l,padding:u}=typeof n=="function"?n(r):n;return l&&t(l)?l.current!=null?oE({element:l.current,padding:u}).fn(r):{}:l?oE({element:l,padding:u}).fn(r):{}}}};var a_=typeof document<"u"?k.useLayoutEffect:k.useEffect;function v_(n,t){if(n===t)return!0;if(typeof n!=typeof t)return!1;if(typeof n=="function"&&n.toString()===t.toString())return!0;let r,l,u;if(n&&t&&typeof n=="object"){if(Array.isArray(n)){if(r=n.length,r!==t.length)return!1;for(l=r;l--!==0;)if(!v_(n[l],t[l]))return!1;return!0}if(u=Object.keys(n),r=u.length,r!==Object.keys(t).length)return!1;for(l=r;l--!==0;)if(!{}.hasOwnProperty.call(t,u[l]))return!1;for(l=r;l--!==0;){const d=u[l];if(!(d==="_owner"&&n.$$typeof)&&!v_(n[d],t[d]))return!1}return!0}return n!==n&&t!==t}function fS(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function sE(n,t){const r=fS(n);return Math.round(t*r)/r}function aE(n){const t=k.useRef(n);return a_(()=>{t.current=n}),t}function LO(n){n===void 0&&(n={});const{placement:t="bottom",strategy:r="absolute",middleware:l=[],platform:u,elements:{reference:d,floating:p}={},transform:b=!0,whileElementsMounted:i,open:E}=n,[T,A]=k.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[I,O]=k.useState(l);v_(I,l)||O(l);const[z,U]=k.useState(null),[N,V]=k.useState(null),X=k.useCallback(hn=>{hn!==ae.current&&(ae.current=hn,U(hn))},[]),J=k.useCallback(hn=>{hn!==be.current&&(be.current=hn,V(hn))},[]),te=d||z,ue=p||N,ae=k.useRef(null),be=k.useRef(null),Ce=k.useRef(T),je=i!=null,me=aE(i),Ne=aE(u),ht=k.useCallback(()=>{if(!ae.current||!be.current)return;const hn={placement:t,strategy:r,middleware:I};Ne.current&&(hn.platform=Ne.current),IO(ae.current,be.current,hn).then(wt=>{const bt={...wt,isPositioned:!0};_t.current&&!v_(Ce.current,bt)&&(Ce.current=bt,cp.flushSync(()=>{A(bt)}))})},[I,t,r,Ne]);a_(()=>{E===!1&&Ce.current.isPositioned&&(Ce.current.isPositioned=!1,A(hn=>({...hn,isPositioned:!1})))},[E]);const _t=k.useRef(!1);a_(()=>(_t.current=!0,()=>{_t.current=!1}),[]),a_(()=>{if(te&&(ae.current=te),ue&&(be.current=ue),te&&ue){if(me.current)return me.current(te,ue,ht);ht()}},[te,ue,ht,me,je]);const Bt=k.useMemo(()=>({reference:ae,floating:be,setReference:X,setFloating:J}),[X,J]),Kt=k.useMemo(()=>({reference:te,floating:ue}),[te,ue]),Gt=k.useMemo(()=>{const hn={position:r,left:0,top:0};if(!Kt.floating)return hn;const wt=sE(Kt.floating,T.x),bt=sE(Kt.floating,T.y);return b?{...hn,transform:"translate("+wt+"px, "+bt+"px)",...fS(Kt.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:wt,top:bt}},[r,b,Kt.floating,T.x,T.y]);return k.useMemo(()=>({...T,update:ht,refs:Bt,elements:Kt,floatingStyles:Gt}),[T,ht,Bt,Kt,Gt])}const BO=up(Q.jsx("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3z"}),"AccountTree"),pS=up(Q.jsx("path",{d:"M5 15H3v4c0 1.1.9 2 2 2h4v-2H5zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2m0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2zM12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"}),"CenterFocusWeak"),RO=up(Q.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"CloseTwoTone"),DO=up(Q.jsx("path",{d:"M17 5h-2V3h2zm-2 16h2v-2.59L19.59 21 21 19.59 18.41 17H21v-2h-6zm4-12h2V7h-2zm0 4h2v-2h-2zm-8 8h2v-2h-2zM7 5h2V3H7zM3 17h2v-2H3zm2 4v-2H3c0 1.1.9 2 2 2M19 3v2h2c0-1.1-.9-2-2-2m-8 2h2V3h-2zM3 9h2V7H3zm4 12h2v-2H7zm-4-8h2v-2H3zm0-8h2V3c-1.1 0-2 .9-2 2"}),"HighlightAlt"),OO=up(Q.jsx("path",{d:"M10 9h4V6h3l-5-5-5 5h3zm-1 1H6V7l-5 5 5 5v-3h3zm14 2-5-5v3h-3v4h3v3zm-9 3h-4v3H7l5 5 5-5h-3z"}),"OpenWith"),mS=up(Q.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var O1={},kO=Kh;Object.defineProperty(O1,"__esModule",{value:!0});var k1=O1.default=void 0,zO=kO(Xh()),y0=qh();k1=O1.default=(0,zO.default)([(0,y0.jsx)("circle",{cx:"7",cy:"14",r:"3"},"0"),(0,y0.jsx)("circle",{cx:"11",cy:"6",r:"3"},"1"),(0,y0.jsx)("circle",{cx:"16.6",cy:"17.6",r:"3"},"2")],"ScatterPlot");async function FO(n){return H_(await hp()("POST","/embeddings/selection",n))}async function jO(n){return H_(await hp()("POST","/embeddings/extended-stage",n))}async function UO(n){return H_(await hp()("POST","/embeddings/color-by-choices",n))}async function NO({datasetName:n,brainKey:t,view:r,labelField:l,slices:u}){const d=await hp()("POST","/embeddings/plot",{datasetName:n,brainKey:t,view:r,labelField:l,slices:u});return H_(d)}function H_(n){if(!n||!n.error)return n;throw new Error((n==null?void 0:n.error)||"Unknown error fetching embeddings plot data.")}function GO(){const n=sn(ep),[t]=Fm(),[r,l]=k.useState(!1),[u,d]=k.useState(null),[p,b]=k.useState(null);return k.useEffect(()=>{t&&(l(!0),UO({datasetName:n,brainKey:t}).then(i=>{l(!1),d(["uncolored",...i.fields])}).catch(i=>{l(!1),b(i)}))},[n,t]),{availableFields:u,isLoading:r}}const z1=()=>Da("colorByField",null);function VO(){sn(D_),sn(SB);const[n,t]=z1(),{availableFields:r,isLoading:l}=GO();return{label:n,handlers:{onSelect(d){d==="uncolored"&&(d=null),t(d)},value:n,toKey:d=>d,useSearch:d=>({values:r&&r.filter(p=>p.toLowerCase().includes(d.toLowerCase()))})},isLoading:l,canSelect:!l&&r&&r.length>0}}const Fm=()=>Da("brainResult",null);function $O(){const[n,t]=Fm(),r=sn(D_),[l,u]=z1();return{handlers:{onSelect(p){t(p),u(null)},value:n,useSearch:p=>({values:HO(r).filter(b=>b.toLowerCase().includes(p.toLowerCase()))})},brainKey:n,canSelect:WO(r)>0,hasSelection:n!==null}}function HO(n){return n.brainMethods.filter(gS).map(t=>t.key)}function WO(n){return((n==null?void 0:n.brainMethods)||[]).filter(gS).length}function gS(n){return n.config.cls.includes("fiftyone.brain.visualization")}const ZO=Ro.div`
  margin: 0;
  height: 100%;
  width: 100%;
  position: relative;
`,XO=Ro.div`
  display: flex;
  gap: 1rem;
  position: absolute;
  top: 1rem;
  display: flex;
  column-gap: 1rem;
  z-index: 1;
  padding: 0 1rem;
  > div {
    display: flex;
    column-gap: 1rem;
  }
`,Cf=Ro(i_)`
  display: flex;
  color: var(--fo-palette-primary-plainColor);
  align-items: center;
  cursor: pointer;
  border-bottom: 1px var(--fo-palette-primary-plainColor) solid;
  background: var(--fo-palette-neutral-softBg);
  border-top-left-radius: 3px;
  border-top-right-radius: 3px;
  padding: 0.25rem;
`,qO=Ro.ul`
  position: absolute;
  top: 3rem;
  z-index: 1;
  list-style: none;
  padding-inline-start: 0;
  background: var(--fo-palette-background-level1);
  > li {
    margin: 1rem 0;
  }
`,KO=Ro.li`
  display: flex;
  column-gap: 1rem;
  color: var(--fo-palette-text-plainColor);
  padding: 0 2.5rem 0 1rem;
  border-radius: 3px;
  list-style: none;
  svg {
    position: relative;
    top: 3px;
  }
`,JO=Ro.div`
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  cursor: pointer;
`;function F1(){const[n,t]=Da("warnings",{warnings:[]},!0),{warnings:r}=n,l=Array.isArray(r)&&r.length>0,u=d=>{t(p=>d(p||{warnings:[]}))};return{hasWarnings:l,items:r,visible:l&&n.visible,count:Array.isArray(r)?r.length:null,show(){u(d=>({...d,visible:!0}))},hide(){u(d=>({...d,visible:!1,userHidden:!0}))},clear(){u(d=>({...d,warnings:null}))},add(d){u(p=>({...p,visible:!0,warnings:[...p.warnings||[],d]}))}}}function YO(){const n=F1();return n.visible?Q.jsxs(qO,{children:[Q.jsx(JO,{children:Q.jsx(O_,{onClick:n.hide})}),n.items.map(t=>Q.jsxs(KO,{children:[Q.jsx("div",{children:Q.jsx(mS,{})}),Q.jsx("div",{children:t})]}))]}):null}let Gf=class Lv{constructor(t,r,l){this.r=t,this.g=r,this.b=l}static fromCSSRGBValues(t,r,l){return new Lv(t/255,r/255,l/255)}setBrightness(t){const r=this.getBrightness(),l=t-r;return new Lv(this.r+l,this.g+l,this.b+l)}getBrightness(){return(this.r+this.g+this.b)/3}toCSSRGBString(){return`rgb(${this.r*255}, ${this.g*255}, ${this.b*255})`}};const lE={name:["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenRod","DarkGray","DarkGrey","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkSlateGrey","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DimGrey","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","GoldenRod","Gray","Grey","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGrey","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquaMarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","RebeccaPurple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"],hex:["#f0f8ff","#faebd7","#00ffff","#7fffd4","#f0ffff","#f5f5dc","#ffe4c4","#000000","#ffebcd","#0000ff","#8a2be2","#a52a2a","#deb887","#5f9ea0","#7fff00","#d2691e","#ff7f50","#6495ed","#fff8dc","#dc143c","#00ffff","#00008b","#008b8b","#b8860b","#a9a9a9","#a9a9a9","#006400","#bdb76b","#8b008b","#556b2f","#ff8c00","#9932cc","#8b0000","#e9967a","#8fbc8f","#483d8b","#2f4f4f","#2f4f4f","#00ced1","#9400d3","#ff1493","#00bfff","#696969","#696969","#1e90ff","#b22222","#fffaf0","#228b22","#ff00ff","#dcdcdc","#f8f8ff","#ffd700","#daa520","#808080","#808080","#008000","#adff2f","#f0fff0","#ff69b4","#cd5c5c","#4b0082","#fffff0","#f0e68c","#e6e6fa","#fff0f5","#7cfc00","#fffacd","#add8e6","#f08080","#e0ffff","#fafad2","#d3d3d3","#d3d3d3","#90ee90","#ffb6c1","#ffa07a","#20b2aa","#87cefa","#778899","#778899","#b0c4de","#ffffe0","#00ff00","#32cd32","#faf0e6","#ff00ff","#800000","#66cdaa","#0000cd","#ba55d3","#9370db","#3cb371","#7b68ee","#00fa9a","#48d1cc","#c71585","#191970","#f5fffa","#ffe4e1","#ffe4b5","#ffdead","#000080","#fdf5e6","#808000","#6b8e23","#ffa500","#ff4500","#da70d6","#eee8aa","#98fb98","#afeeee","#db7093","#ffefd5","#ffdab9","#cd853f","#ffc0cb","#dda0dd","#b0e0e6","#800080","#663399","#ff0000","#bc8f8f","#4169e1","#8b4513","#fa8072","#f4a460","#2e8b57","#fff5ee","#a0522d","#c0c0c0","#87ceeb","#6a5acd","#708090","#708090","#fffafa","#00ff7f","#4682b4","#d2b48c","#008080","#d8bfd8","#ff6347","#40e0d0","#ee82ee","#f5deb3","#ffffff","#f5f5f5","#ffff00","#9acd32"]};function cE(n,t,r){for(var l=0;l<n.length;l++)if(n[l][t]===r)return l;return null}function QO(n,t){let r=cE(n,"id",t);return r==null&&(r=cE(n,"sample_id",t)),r}function ek(n,t){return n.localeCompare(t)}const j1=35,tk=new RegExp(`.{1,${j1}}(\\s|$)`,"g"),nk=new RegExp(`.{1,${j1}}`,"g");function rk(n,t,r,l,u,d,p){const b=t==="categorical",i=t==="continuous",E=t==="uncolored";return Object.entries(n).sort((T,A)=>ek(T[0],A[0])).map(ik).map(([T,A])=>{const I=l!=null&&l.length?l.map(U=>QO(A,U)).filter(U=>U!==null):null,O=ok(T,p)??_S(r(T))??new Gf(255,165,0),z=d.map((U,N)=>{const V=Gf.fromCSSRGBValues(...U);return[N/(d.length-1),V.toCSSRGBString()]});return{x:A.map(U=>U.points[0]),y:A.map(U=>U.points[1]),ids:A.map(U=>U.id),type:"scattergl",mode:"markers",marker:{autocolorscale:!i,colorscale:z,color:b?O.toCSSRGBString():E?null:A.map(U=>U.label),size:6,colorbar:b||E?void 0:{lenmode:"fraction",x:1,y:.5}},name:T,selectedpoints:I,selected:{marker:{opacity:1,size:u==="selected"?10:6,color:u==="selected"?"orange":void 0}},unselected:{marker:{opacity:.2}}}})}const ik=([n,t])=>{if(n&&n.length>j1){let r=n.match(tk);r.length===1&&(r=n.match(nk)),n=r.join("<br />")}return[n,t]},ok=(n,t)=>{var l;if(!t||!t.valueColors)return null;const r=(l=t.valueColors.find(u=>u.value===n))==null?void 0:l.color;return _S(r)},_S=n=>{if(Array.isArray(n))return Gf.fromCSSRGBValues(...n);if(!MB(n))return null;if(n.startsWith("#")){const r=uE(n);return Gf.fromCSSRGBValues(r.r,r.g,r.b)}if(n.startsWith("rgb")){const r=n.split("(")[1].split(")")[0].split(",");return Gf.fromCSSRGBValues(parseInt(r[0]),parseInt(r[1]),parseInt(r[2]))}const t=lE.name.map(r=>r.toLowerCase()).indexOf(n);if(t>-1){const r=uE(lE.hex[t]);return Gf.fromCSSRGBValues(r.r,r.g,r.b)}return null};function uE(n){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function v0(n,t,r=[]){k.useEffect(()=>{const l=u=>{u.key===n&&t(!0)};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[n,...r])}function sk(){const n=sn(IB),t=sn(ep),[r,l]=Fm(),[u]=z1(),d=sn(k_),p=sn(d1(!1)),b=sn(f1),[i,E]=Da("loadedPlot",null,!0),[T,A]=Da("loadingPlot",!0,!0),[I,O]=Da("loadingPlotError",null,!0),z=ah(_T),U=F1();k.useEffect(()=>{z(null),A(!0),NO({datasetName:t,filters:b,brainKey:r,view:d,labelField:u,slices:p}).catch(N=>{O(N)}).then(N=>{if(!N||!N.index_size){(N==null?void 0:N.index_size)===0&&U.add("No samples in the current view.");return}const V=N.index_size-N.available_count,X=N.missing_count;N.index_size;const J=N.patches_field?"patches":"samples";U.clear(),X>0&&U.add(`${X} ${J} in the current view do not have corresponding embeddings.`),V>0&&U.add(`${V} embeddings in the index correspond to samples not in the current view`),O(null),E(N)}).finally(()=>A(!1))},[t,r,u,d,n,p,b])}function ak(){sn(ep);const[n]=Fm(),t=sn(D_);return n&&t?t.brainMethods.find(l=>l.key===n):null}const Bv="embe@fiftyone/embeddingsddings";function U1(){var te;const n=ak(),t=(te=n==null?void 0:n.config)==null?void 0:te.patchesField,r=p1(),[{selection:l,scope:u},d]=Pi(zd),[p,b]=Pi(yT),[i,E]=Da("plotSelection",[],!0),T=sn(PB(t)),A=sn(LB);function I(ue){b(new Set),d({selection:ue,scope:Bv}),ue===null&&O()}function O(){r(),E(null),b(new Set)}let z=null;const U=Array.from(p),N=Array.from(T),V=Array.from(A);let X=null;return!t&&V&&V.length?(X=V,z="selected"):N&&N.length?(X=N,z="selected"):U&&U.length?(X=U,z="selected"):i&&i.length?(X=i,z="plot"):l&&l.length&&(X=l,z="extended"),{setPlotSelection:E,handleSelected:I,clearSelection:O,resolvedSelection:X,hasSelection:X!==null,selectionStyle:z,selectionIsExternal:u!==Bv}}function lk(){const{setPlotSelection:n}=U1(),t=sn(ep),r=sn(yT),[l]=Fm(),u=sn(k_),[d]=Da("loadedPlot",null,!0),p=sn(f1),b=sn(BB),{selection:i}=sn(zd),E=sn(d1(!1));k.useEffect(()=>{d&&FO({datasetName:t,brainKey:l,view:u,filters:p,extended:i?b:null,extendedSelection:i,slices:E}).then(A=>{let I=null;A.selected?I=A.selected:r&&r.size&&(I=Array.from(r)),n(I)})},[t,l,u,p,i,r])}function ck(){const n=sn(ep),t=sn(k_),[r]=Da("loadedPlot",null,!0),l=ah(_T),{selection:u}=sn(zd),d=m1(({snapshot:b})=>async()=>b.getPromise(ep)),p=sn(d1(!1));k.useEffect(()=>{r&&Array.isArray(u)&&jO({datasetName:n,view:t,patchesField:r.patches_field,selection:u,slices:p}).then(async b=>{await d()===n&&l({[b._cls]:b.kwargs})})},[n,r==null?void 0:r.patches_field,t,u])}function uk({clearSelection:n,setPlotSelection:t}){const[r]=Da("loadedPlot",null,!0),[l]=Da("loadingPlot",!0,!0),[u]=Da("loadingPlotError",null,!0);return sk(),lk(),ck(),{...r||{},isLoading:l,error:u}}const yS=()=>Da("zoomRevision",1,!0);function vS(){const[n,t]=yS();return()=>{t(l=>typeof l=="number"?l+1:2)}}function hk({labelSelectorLoading:n,labelField:t,bounds:r,plotSelection:l}){var me;const u=fc(),d=sn(RB),p=sn(gv).fields,b=sn(gv),i=sn(DB).scale,E=((me=b.colorscales.find(Ne=>Ne.path===t))==null?void 0:me.rgb)??b.defaultColorscale.rgb??i,T=k.useMemo(()=>p==null?void 0:p.find(Ne=>t==null?void 0:t.includes((Ne==null?void 0:Ne.path)??"")),[p,t]),{resolvedSelection:A,clearSelection:I,hasSelection:O,handleSelected:z,selectionStyle:U}=l,[N]=yS(),V=vS(),{isLoading:X,traces:J,style:te,error:ue}=uk(l),[ae,be]=Da("dragMode","lasso",!0);if(v0("s",()=>be("lasso")),v0("g",()=>be("pan")),v0("Escape",()=>{O?I():V()},[O]),ue)return Q.jsx(Nh,{children:ue.message});if(n||X||!J)return Q.jsx(Nh,{children:"Pixelating..."});const Ce=rk(J,te,d,A,U,E,T),je=te==="categorical";return Q.jsx("div",{style:{height:"100%"},"data-cy":"embeddings-plot-container",children:(r==null?void 0:r.width)&&Q.jsx(OB,{data:Ce,style:{zIndex:1},onSelected:(Ne,ht)=>{var Kt;if(!Ne||((Kt=Ne==null?void 0:Ne.points)==null?void 0:Kt.length)===0)return;const _t={},Bt=[];for(const Gt of Ne.points)_t[Gt.fullData.name]||(_t[Gt.fullData.name]=[]),_t[Gt.fullData.name].push(Gt.id),Bt.push(Gt.id);z(Bt)},onDeselect:()=>{z(null)},config:{scrollZoom:!0,displaylogo:!1,responsive:!0,displayModeBar:!1},layout:{dragmode:ae,uirevision:N,font:{family:"var(--fo-fontFamily-body)",size:14},showlegend:je,width:r.width,height:r.height,hovermode:!1,xaxis:{showgrid:!1,zeroline:!1,visible:!1},yaxis:{showgrid:!1,zeroline:!1,visible:!1,scaleanchor:"x",scaleratio:1},autosize:!0,margin:{t:0,l:0,b:0,r:0,pad:0},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",legend:{x:1,y:1,bgcolor:u.background.level1,font:{color:u.text.secondary}}}})})}const hE=({value:n})=>Q.jsx(Q.Fragment,{children:n});function dk({containerHeight:n,dimensions:t}){const r=k.useRef(),l=fc(),u=vS(),d=$O(),p=VO(),b=d.canSelect,i=d.hasSelection,E=U1(),[T,A]=Da("dragMode","lasso",!0),I=F1(),O=vT(),z=xT("https://docs.voxel51.com");k.useEffect(()=>{O(()=>{E.clearSelection()})},[O,E]);const U={background:l.neutral.softBg,borderTopLeftRadius:3,borderTopRightRadius:3,padding:"0.25rem"};return b?Q.jsxs(ZO,{ref:r,"data-cy":"embeddings-container",children:[Q.jsx(XO,{children:Q.jsxs("div",{children:[Q.jsx(u_,{cy:"embeddings",...d.handlers,placeholder:"Select brain key",overflow:!0,component:hE,resultsPlacement:"bottom-start",containerStyle:U}),d.hasSelection&&!p.isLoading&&Q.jsx(u_,{cy:"embeddings-colorby",...p.handlers,placeholder:"Color by",overflow:!0,component:hE,resultsPlacement:"bottom-start",containerStyle:U}),!E.selectionIsExternal&&Q.jsx(Cf,{to:E.clearSelection,title:"Clear selection (Esc)",children:Q.jsx(O_,{})}),i&&Q.jsxs(k.Fragment,{children:[Q.jsx(Cf,{to:()=>u(),title:"Reset zoom (Esc)",children:Q.jsx(pS,{})}),Q.jsx(Cf,{cy:"embeddings-plot-option-lasso",style:{opacity:T!=="lasso"?.5:1},to:()=>A("lasso"),title:"Select (s)",children:Q.jsx(DO,{})}),Q.jsx(Cf,{style:{opacity:T!=="pan"?.5:1},to:()=>A("pan"),title:"Pan (g)",children:Q.jsx(OO,{})}),I.count>0&&Q.jsxs(Cf,{to:()=>I.show(),title:"Warnings",children:[Q.jsx(mS,{style:{marginRight:"0.5rem"}}),I.count]}),Q.jsx(YO,{}),Q.jsx(Cf,{href:"https://docs.voxel51.com/user_guide/app.html#embeddings-panel",title:"Help",to:z,target:"_blank",children:Q.jsx(bT,{})})]}),Q.jsx(wT,{place:ET.EMBEDDINGS_ACTIONS})]})}),i&&Q.jsx(hk,{labelSelectorLoading:p.isLoading,plotSelection:E,bounds:t.bounds,el:r,brainKey:d.brainKey,labelField:p.label,containerHeight:n})]}):Q.jsx(Nh,{style:{background:l.background.mediaSpace},children:Q.jsxs(fk,{style:{textAlign:"center"},children:[Q.jsx("h3",{children:"No embeddings visualizations found."}),Q.jsxs("p",{children:[Q.jsx(kB,{style:{color:l.text.primary},href:"https://docs.voxel51.com/user_guide/app.html#embeddings-panel",children:"Learn more"})," ","about using this feature."]})]})})}const fk=Ro.div`
  text-align: center;
`;function pk(){const{selection:n,scope:t}=sn(zd),r=U1();return t!==Bv?null:Q.jsx(CT,{selectionCount:n==null?void 0:n.length.toString(),onClickSelection:r.clearSelection})}g1({name:"Embeddings",label:"Embeddings",component:dk,type:_1.Panel,activator:()=>!0,Icon:k1,panelOptions:{TabIndicator:pk,priority:AT}});const W_=zB({key:"fo3d-assetsParseStatusLog",default:[]}),mk=Xo({key:"fo3d-cameraPosition",default:null}),xS=Xo({key:"fo3d-shadeBy",default:Md,effects:[pc("shadeBy")]}),bS=Xo({key:"fo3d-customColorMap",default:null,effects:[pc("customColorMap",{useJsonSerialization:!0})]}),Pd=Xo({key:"fo3d-openAction",default:null}),wS=Xo({key:"fo3d-pointSize",default:"2",effects:[pc("pointSize")]});Xo({key:"fo3d-pointSizeRange",default:[.1,2]});const ES=Xo({key:"fo3d-isPointSizeAttenuated",default:!1,effects:[pc("isPointSizeAttenuated",{valueClass:"boolean"})]}),Z_=Xo({key:"fo3d-isGridOn",default:!0,effects:[pc("fo3d-isGridOn",{valueClass:"boolean"})]}),CS=Xo({key:"fo3d-gridCellSize",default:1}),AS=Xo({key:"fo3d-gridSectionSize",default:10}),TS=Xo({key:"fo3d-isGridInfinitelyLarge",default:!0,effects:[pc("fo3d-isGridInfinitelyLarge",{valueClass:"boolean"})]}),SS=Xo({key:"fo3d-gridSize",default:1e3,effects:[pc("fo3d-gridSize")]}),MS=Xo({key:"fo3d-shouldGridFade",default:!0,effects:[pc("fo3d-shouldGridFade",{valueClass:"boolean"})]}),N1=Xo({key:"fo3d-containsBackground",default:!1}),G1=Xo({key:"fo3d-isBackgroundON",default:!0,effects:[pc("fo3d-isBackgroundON",{valueClass:"boolean"})]}),gk=Xo({key:"fo3d-isStatusBarOn",default:!1}),IS=Xo({key:"fo3d-activeNode",default:null}),PS=Xo({key:"fo3d-cuboidLabelLineWidth",default:3,effects:[pc("fo3d-cuboidLabelLineWidth",{valueClass:"number"})]}),LS=Xo({key:"fo3d-polylineLabelLineWidth",default:3,effects:[pc("fo3d-polylineLabelLineWidth",{valueClass:"number"})]}),dE=({error:n,boundaryName:t})=>{const r=sn(z_),l=ah(W_(r));return k.useEffect(()=>{if(!n)return;const u=n.message||n.toString(),d=t?`Error loading ${t}: ${u}`:u;l(p=>[...p,{message:d,status:"error"}])},[t,n,l]),null};class V1 extends Pe.Component{constructor(){super(...arguments);bf(this,"state",{error:null,hasError:!1})}componentDidCatch(r){this.setState({error:r})}render(){return this.state.hasError?this.props.ignoreError?Q.jsx(dE,{error:this.state.error,boundaryName:this.props.boundaryName}):Q.jsxs(Nh,{dataCy:"looker3d",children:[Q.jsx(dE,{error:this.state.error,boundaryName:this.props.boundaryName}),Q.jsx("div",{"data-cy":"looker-error-info",children:this.state.error instanceof Error?this.state.error.message:this.state.error})]}):this.props.children}}bf(V1,"getDerivedStateFromError",r=>({hasError:!0,error:r}));var BS={exports:{}},Fd={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Fd.ConcurrentRoot=1;Fd.ContinuousEventPriority=4;Fd.DefaultEventPriority=16;Fd.DiscreteEventPriority=1;Fd.IdleEventPriority=536870912;Fd.LegacyRoot=0;BS.exports=Fd;var Vf=BS.exports;function _k(n){let t;const r=new Set,l=(E,T)=>{const A=typeof E=="function"?E(t):E;if(A!==t){const I=t;t=T?A:Object.assign({},t,A),r.forEach(O=>O(t,I))}},u=()=>t,d=(E,T=u,A=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let I=T(t);function O(){const z=T(t);if(!A(I,z)){const U=I;E(I=z,U)}}return r.add(O),()=>r.delete(O)},i={setState:l,getState:u,subscribe:(E,T,A)=>T||A?d(E,T,A):(r.add(E),()=>r.delete(E)),destroy:()=>r.clear()};return t=n(l,u,i),i}const yk=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),fE=yk?k.useEffect:k.useLayoutEffect;function $1(n){const t=typeof n=="function"?_k(n):n,r=(l=t.getState,u=Object.is)=>{const[,d]=k.useReducer(N=>N+1,0),p=t.getState(),b=k.useRef(p),i=k.useRef(l),E=k.useRef(u),T=k.useRef(!1),A=k.useRef();A.current===void 0&&(A.current=l(p));let I,O=!1;(b.current!==p||i.current!==l||E.current!==u||T.current)&&(I=l(p),O=!u(A.current,I)),fE(()=>{O&&(A.current=I),b.current=p,i.current=l,E.current=u,T.current=!1});const z=k.useRef(p);fE(()=>{const N=()=>{try{const X=t.getState(),J=i.current(X);E.current(A.current,J)||(b.current=X,A.current=J,d())}catch{T.current=!0,d()}},V=t.subscribe(N);return t.getState()!==z.current&&N(),V},[]);const U=O?I:A.current;return k.useDebugValue(U),U};return Object.assign(r,t),r[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const l=[r,t];return{next(){const u=l.length<=0;return{value:l.shift(),done:u}}}},r}var RS={exports:{}},DS={exports:{}},OS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function t(wt,bt){var $t=wt.length;wt.push(bt);e:for(;0<$t;){var Zt=$t-1>>>1,mn=wt[Zt];if(0<u(mn,bt))wt[Zt]=bt,wt[$t]=mn,$t=Zt;else break e}}function r(wt){return wt.length===0?null:wt[0]}function l(wt){if(wt.length===0)return null;var bt=wt[0],$t=wt.pop();if($t!==bt){wt[0]=$t;e:for(var Zt=0,mn=wt.length,yn=mn>>>1;Zt<yn;){var On=2*(Zt+1)-1,rr=wt[On],Yn=On+1,Vr=wt[Yn];if(0>u(rr,$t))Yn<mn&&0>u(Vr,rr)?(wt[Zt]=Vr,wt[Yn]=$t,Zt=Yn):(wt[Zt]=rr,wt[On]=$t,Zt=On);else if(Yn<mn&&0>u(Vr,$t))wt[Zt]=Vr,wt[Yn]=$t,Zt=Yn;else break e}}return bt}function u(wt,bt){var $t=wt.sortIndex-bt.sortIndex;return $t!==0?$t:wt.id-bt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var p=Date,b=p.now();n.unstable_now=function(){return p.now()-b}}var i=[],E=[],T=1,A=null,I=3,O=!1,z=!1,U=!1,N=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,X=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function J(wt){for(var bt=r(E);bt!==null;){if(bt.callback===null)l(E);else if(bt.startTime<=wt)l(E),bt.sortIndex=bt.expirationTime,t(i,bt);else break;bt=r(E)}}function te(wt){if(U=!1,J(wt),!z)if(r(i)!==null)z=!0,Gt(ue);else{var bt=r(E);bt!==null&&hn(te,bt.startTime-wt)}}function ue(wt,bt){z=!1,U&&(U=!1,V(Ce),Ce=-1),O=!0;var $t=I;try{for(J(bt),A=r(i);A!==null&&(!(A.expirationTime>bt)||wt&&!Ne());){var Zt=A.callback;if(typeof Zt=="function"){A.callback=null,I=A.priorityLevel;var mn=Zt(A.expirationTime<=bt);bt=n.unstable_now(),typeof mn=="function"?A.callback=mn:A===r(i)&&l(i),J(bt)}else l(i);A=r(i)}if(A!==null)var yn=!0;else{var On=r(E);On!==null&&hn(te,On.startTime-bt),yn=!1}return yn}finally{A=null,I=$t,O=!1}}var ae=!1,be=null,Ce=-1,je=5,me=-1;function Ne(){return!(n.unstable_now()-me<je)}function ht(){if(be!==null){var wt=n.unstable_now();me=wt;var bt=!0;try{bt=be(!0,wt)}finally{bt?_t():(ae=!1,be=null)}}else ae=!1}var _t;if(typeof X=="function")_t=function(){X(ht)};else if(typeof MessageChannel<"u"){var Bt=new MessageChannel,Kt=Bt.port2;Bt.port1.onmessage=ht,_t=function(){Kt.postMessage(null)}}else _t=function(){N(ht,0)};function Gt(wt){be=wt,ae||(ae=!0,_t())}function hn(wt,bt){Ce=N(function(){wt(n.unstable_now())},bt)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(wt){wt.callback=null},n.unstable_continueExecution=function(){z||O||(z=!0,Gt(ue))},n.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<wt?Math.floor(1e3/wt):5},n.unstable_getCurrentPriorityLevel=function(){return I},n.unstable_getFirstCallbackNode=function(){return r(i)},n.unstable_next=function(wt){switch(I){case 1:case 2:case 3:var bt=3;break;default:bt=I}var $t=I;I=bt;try{return wt()}finally{I=$t}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(wt,bt){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var $t=I;I=wt;try{return bt()}finally{I=$t}},n.unstable_scheduleCallback=function(wt,bt,$t){var Zt=n.unstable_now();switch(typeof $t=="object"&&$t!==null?($t=$t.delay,$t=typeof $t=="number"&&0<$t?Zt+$t:Zt):$t=Zt,wt){case 1:var mn=-1;break;case 2:mn=250;break;case 5:mn=1073741823;break;case 4:mn=1e4;break;default:mn=5e3}return mn=$t+mn,wt={id:T++,callback:bt,priorityLevel:wt,startTime:$t,expirationTime:mn,sortIndex:-1},$t>Zt?(wt.sortIndex=$t,t(E,wt),r(i)===null&&wt===r(E)&&(U?(V(Ce),Ce=-1):U=!0,hn(te,$t-Zt))):(wt.sortIndex=mn,t(i,wt),z||O||(z=!0,Gt(ue))),wt},n.unstable_shouldYield=Ne,n.unstable_wrapCallback=function(wt){var bt=I;return function(){var $t=I;I=bt;try{return wt.apply(this,arguments)}finally{I=$t}}}})(OS);DS.exports=OS;var Rv=DS.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vk=function(t){var r={},l=k,u=Rv,d=Object.assign;function p(_){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+_,L=1;L<arguments.length;L++)v+="&args[]="+encodeURIComponent(arguments[L]);return"Minified React error #"+_+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var b=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,i=Symbol.for("react.element"),E=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),z=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),ue=Symbol.iterator;function ae(_){return _===null||typeof _!="object"?null:(_=ue&&_[ue]||_["@@iterator"],typeof _=="function"?_:null)}function be(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case T:return"Fragment";case E:return"Portal";case I:return"Profiler";case A:return"StrictMode";case N:return"Suspense";case V:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case z:return(_.displayName||"Context")+".Consumer";case O:return(_._context.displayName||"Context")+".Provider";case U:var v=_.render;return _=_.displayName,_||(_=v.displayName||v.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case X:return v=_.displayName||null,v!==null?v:be(_.type)||"Memo";case J:v=_._payload,_=_._init;try{return be(_(v))}catch{}}return null}function Ce(_){var v=_.type;switch(_.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=v.render,_=_.displayName||_.name||"",v.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return be(v);case 8:return v===A?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function je(_){var v=_,L=_;if(_.alternate)for(;v.return;)v=v.return;else{_=v;do v=_,v.flags&4098&&(L=v.return),_=v.return;while(_)}return v.tag===3?L:null}function me(_){if(je(_)!==_)throw Error(p(188))}function Ne(_){var v=_.alternate;if(!v){if(v=je(_),v===null)throw Error(p(188));return v!==_?null:_}for(var L=_,F=v;;){var K=L.return;if(K===null)break;var re=K.alternate;if(re===null){if(F=K.return,F!==null){L=F;continue}break}if(K.child===re.child){for(re=K.child;re;){if(re===L)return me(K),_;if(re===F)return me(K),v;re=re.sibling}throw Error(p(188))}if(L.return!==F.return)L=K,F=re;else{for(var Ie=!1,Ze=K.child;Ze;){if(Ze===L){Ie=!0,L=K,F=re;break}if(Ze===F){Ie=!0,F=K,L=re;break}Ze=Ze.sibling}if(!Ie){for(Ze=re.child;Ze;){if(Ze===L){Ie=!0,L=re,F=K;break}if(Ze===F){Ie=!0,F=re,L=K;break}Ze=Ze.sibling}if(!Ie)throw Error(p(189))}}if(L.alternate!==F)throw Error(p(190))}if(L.tag!==3)throw Error(p(188));return L.stateNode.current===L?_:v}function ht(_){return _=Ne(_),_!==null?_t(_):null}function _t(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var v=_t(_);if(v!==null)return v;_=_.sibling}return null}function Bt(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){if(_.tag!==4){var v=Bt(_);if(v!==null)return v}_=_.sibling}return null}var Kt=Array.isArray,Gt=t.getPublicInstance,hn=t.getRootHostContext,wt=t.getChildHostContext,bt=t.prepareForCommit,$t=t.resetAfterCommit,Zt=t.createInstance,mn=t.appendInitialChild,yn=t.finalizeInitialChildren,On=t.prepareUpdate,rr=t.shouldSetTextContent,Yn=t.createTextInstance,Vr=t.scheduleTimeout,Jr=t.cancelTimeout,kr=t.noTimeout,Ln=t.isPrimaryRenderer,li=t.supportsMutation,kn=t.supportsPersistence,Br=t.supportsHydration,ci=t.getInstanceFromNode,Ji=t.preparePortalMount,wn=t.getCurrentEventPriority,ki=t.detachDeletedInstance,Bs=t.supportsMicrotasks,Do=t.scheduleMicrotask,Tr=t.supportsTestSelectors,xo=t.findFiberRoot,bs=t.getBoundingRect,an=t.getTextContent,xn=t.isHiddenSubtree,$r=t.matchAccessibilityRole,Hr=t.setFocusIfFocusable,Bi=t.setupIntersectionObserver,ui=t.appendChild,Hi=t.appendChildToContainer,Oo=t.commitTextUpdate,no=t.commitMount,ko=t.commitUpdate,bo=t.insertBefore,Ko=t.insertInContainerBefore,wo=t.removeChild,Je=t.removeChildFromContainer,Vt=t.resetTextContent,In=t.hideInstance,ir=t.hideTextInstance,Ae=t.unhideInstance,se=t.unhideTextInstance,le=t.clearContainer,Te=t.cloneInstance,Be=t.createContainerChildSet,Ge=t.appendChildToContainerChildSet,Xe=t.finalizeContainerChildren,qe=t.replaceContainerChildren,Ve=t.cloneHiddenInstance,rt=t.cloneHiddenTextInstance,Rt=t.canHydrateInstance,jt=t.canHydrateTextInstance,Dt=t.canHydrateSuspenseInstance,En=t.isSuspenseInstancePending,Un=t.isSuspenseInstanceFallback,Fn=t.registerSuspenseInstanceRetry,zn=t.getNextHydratableSibling,$n=t.getFirstHydratableChild,Yr=t.getFirstHydratableChildWithinContainer,yi=t.getFirstHydratableChildWithinSuspenseInstance,Wi=t.hydrateInstance,zi=t.hydrateTextInstance,Hs=t.hydrateSuspenseInstance,br=t.getNextHydratableInstanceAfterSuspenseInstance,Eo=t.commitHydratedContainer,Nl=t.commitHydratedSuspenseInstance,Yh=t.clearSuspenseBoundary,Ru=t.clearSuspenseBoundaryFromContainer,vr=t.shouldDeleteUnhydratedTailInstances,_c=t.didNotMatchHydratedContainerTextInstance,yc=t.didNotMatchHydratedTextInstance,Fa;function Ws(_){if(Fa===void 0)try{throw Error()}catch(L){var v=L.stack.trim().match(/\n( *(at )?)/);Fa=v&&v[1]||""}return`
`+Fa+_}var Jo=!1;function zr(_,v){if(!_||Jo)return"";Jo=!0;var L=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(Nt){var F=Nt}Reflect.construct(_,[],v)}else{try{v.call()}catch(Nt){F=Nt}_.call(v.prototype)}else{try{throw Error()}catch(Nt){F=Nt}_()}}catch(Nt){if(Nt&&F&&typeof Nt.stack=="string"){for(var K=Nt.stack.split(`
`),re=F.stack.split(`
`),Ie=K.length-1,Ze=re.length-1;1<=Ie&&0<=Ze&&K[Ie]!==re[Ze];)Ze--;for(;1<=Ie&&0<=Ze;Ie--,Ze--)if(K[Ie]!==re[Ze]){if(Ie!==1||Ze!==1)do if(Ie--,Ze--,0>Ze||K[Ie]!==re[Ze]){var vt=`
`+K[Ie].replace(" at new "," at ");return _.displayName&&vt.includes("<anonymous>")&&(vt=vt.replace("<anonymous>",_.displayName)),vt}while(1<=Ie&&0<=Ze);break}}}finally{Jo=!1,Error.prepareStackTrace=L}return(_=_?_.displayName||_.name:"")?Ws(_):""}var Nc=Object.prototype.hasOwnProperty,Gl=[],Zi=-1;function hi(_){return{current:_}}function wr(_){0>Zi||(_.current=Gl[Zi],Gl[Zi]=null,Zi--)}function et(_,v){Zi++,Gl[Zi]=_.current,_.current=v}var Si={},hr=hi(Si),Sr=hi(!1),ja=Si;function zo(_,v){var L=_.type.contextTypes;if(!L)return Si;var F=_.stateNode;if(F&&F.__reactInternalMemoizedUnmaskedChildContext===v)return F.__reactInternalMemoizedMaskedChildContext;var K={},re;for(re in L)K[re]=v[re];return F&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=v,_.__reactInternalMemoizedMaskedChildContext=K),K}function ro(_){return _=_.childContextTypes,_!=null}function vl(){wr(Sr),wr(hr)}function Ua(_,v,L){if(hr.current!==Si)throw Error(p(168));et(hr,v),et(Sr,L)}function Ht(_,v,L){var F=_.stateNode;if(v=v.childContextTypes,typeof F.getChildContext!="function")return L;F=F.getChildContext();for(var K in F)if(!(K in v))throw Error(p(108,Ce(_)||"Unknown",K));return d({},L,F)}function Xn(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||Si,ja=hr.current,et(hr,_),et(Sr,Sr.current),!0}function qn(_,v,L){var F=_.stateNode;if(!F)throw Error(p(169));L?(_=Ht(_,v,ja),F.__reactInternalMemoizedMergedChildContext=_,wr(Sr),wr(hr),et(hr,_)):wr(Sr),et(Sr,L)}var wi=Math.clz32?Math.clz32:H,Yo=Math.log,B=Math.LN2;function H(_){return _>>>=0,_===0?32:31-(Yo(_)/B|0)|0}var ce=64,Se=4194304;function ze(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function De(_,v){var L=_.pendingLanes;if(L===0)return 0;var F=0,K=_.suspendedLanes,re=_.pingedLanes,Ie=L&268435455;if(Ie!==0){var Ze=Ie&~K;Ze!==0?F=ze(Ze):(re&=Ie,re!==0&&(F=ze(re)))}else Ie=L&~K,Ie!==0?F=ze(Ie):re!==0&&(F=ze(re));if(F===0)return 0;if(v!==0&&v!==F&&!(v&K)&&(K=F&-F,re=v&-v,K>=re||K===16&&(re&4194240)!==0))return v;if(F&4&&(F|=L&16),v=_.entangledLanes,v!==0)for(_=_.entanglements,v&=F;0<v;)L=31-wi(v),K=1<<L,F|=_[L],v&=~K;return F}function Ke(_,v){switch(_){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function It(_,v){for(var L=_.suspendedLanes,F=_.pingedLanes,K=_.expirationTimes,re=_.pendingLanes;0<re;){var Ie=31-wi(re),Ze=1<<Ie,vt=K[Ie];vt===-1?(!(Ze&L)||Ze&F)&&(K[Ie]=Ke(Ze,v)):vt<=v&&(_.expiredLanes|=Ze),re&=~Ze}}function Ft(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function Jt(_){for(var v=[],L=0;31>L;L++)v.push(_);return v}function Yt(_,v,L){_.pendingLanes|=v,v!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,v=31-wi(v),_[v]=L}function Wt(_,v){var L=_.pendingLanes&~v;_.pendingLanes=v,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=v,_.mutableReadLanes&=v,_.entangledLanes&=v,v=_.entanglements;var F=_.eventTimes;for(_=_.expirationTimes;0<L;){var K=31-wi(L),re=1<<K;v[K]=0,F[K]=-1,_[K]=-1,L&=~re}}function Rn(_,v){var L=_.entangledLanes|=v;for(_=_.entanglements;L;){var F=31-wi(L),K=1<<F;K&v|_[F]&v&&(_[F]|=v),L&=~K}}var Sn=0;function jn(_){return _&=-_,1<_?4<_?_&268435455?16:536870912:4:1}var Wr=u.unstable_scheduleCallback,yt=u.unstable_cancelCallback,en=u.unstable_shouldYield,Mr=u.unstable_requestPaint,dr=u.unstable_now,gr=u.unstable_ImmediatePriority,Qo=u.unstable_UserBlockingPriority,Gc=u.unstable_NormalPriority,Fr=u.unstable_IdlePriority,Zr=null,es=null;function Rs(_){if(es&&typeof es.onCommitFiberRoot=="function")try{es.onCommitFiberRoot(Zr,_,void 0,(_.current.flags&128)===128)}catch{}}function Na(_,v){return _===v&&(_!==0||1/_===1/v)||_!==_&&v!==v}var Xr=typeof Object.is=="function"?Object.is:Na,ws=null,Ga=!1,Es=!1;function Zs(_){ws===null?ws=[_]:ws.push(_)}function Vc(_){Ga=!0,Zs(_)}function Xs(){if(!Es&&ws!==null){Es=!0;var _=0,v=Sn;try{var L=ws;for(Sn=1;_<L.length;_++){var F=L[_];do F=F(!0);while(F!==null)}ws=null,Ga=!1}catch(K){throw ws!==null&&(ws=ws.slice(_+1)),Wr(gr,Xs),K}finally{Sn=v,Es=!1}}return null}var Du=b.ReactCurrentBatchConfig;function qs(_,v){if(Xr(_,v))return!0;if(typeof _!="object"||_===null||typeof v!="object"||v===null)return!1;var L=Object.keys(_),F=Object.keys(v);if(L.length!==F.length)return!1;for(F=0;F<L.length;F++){var K=L[F];if(!Nc.call(v,K)||!Xr(_[K],v[K]))return!1}return!0}function Ds(_){switch(_.tag){case 5:return Ws(_.type);case 16:return Ws("Lazy");case 13:return Ws("Suspense");case 19:return Ws("SuspenseList");case 0:case 2:case 15:return _=zr(_.type,!1),_;case 11:return _=zr(_.type.render,!1),_;case 1:return _=zr(_.type,!0),_;default:return""}}function ts(_,v){if(_&&_.defaultProps){v=d({},v),_=_.defaultProps;for(var L in _)v[L]===void 0&&(v[L]=_[L]);return v}return v}var Ks=hi(null),Cs=null,ds=null,fs=null;function xl(){fs=ds=Cs=null}function Co(_,v,L){Ln?(et(Ks,v._currentValue),v._currentValue=L):(et(Ks,v._currentValue2),v._currentValue2=L)}function Va(_){var v=Ks.current;wr(Ks),Ln?_._currentValue=v:_._currentValue2=v}function vc(_,v,L){for(;_!==null;){var F=_.alternate;if((_.childLanes&v)!==v?(_.childLanes|=v,F!==null&&(F.childLanes|=v)):F!==null&&(F.childLanes&v)!==v&&(F.childLanes|=v),_===L)break;_=_.return}}function _a(_,v){Cs=_,fs=ds=null,_=_.dependencies,_!==null&&_.firstContext!==null&&(_.lanes&v&&(_s=!0),_.firstContext=null)}function Fo(_){var v=Ln?_._currentValue:_._currentValue2;if(fs!==_)if(_={context:_,memoizedValue:v,next:null},ds===null){if(Cs===null)throw Error(p(308));ds=_,Cs.dependencies={lanes:0,firstContext:_}}else ds=ds.next=_;return v}var jo=null,ns=!1;function fr(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mh(_,v){_=_.updateQueue,v.updateQueue===_&&(v.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function io(_,v){return{eventTime:_,lane:v,tag:0,payload:null,callback:null,next:null}}function Js(_,v){var L=_.updateQueue;L!==null&&(L=L.shared,Et!==null&&_.mode&1&&!(at&2)?(_=L.interleaved,_===null?(v.next=v,jo===null?jo=[L]:jo.push(L)):(v.next=_.next,_.next=v),L.interleaved=v):(_=L.pending,_===null?v.next=v:(v.next=_.next,_.next=v),L.pending=v))}function Vl(_,v,L){if(v=v.updateQueue,v!==null&&(v=v.shared,(L&4194240)!==0)){var F=v.lanes;F&=_.pendingLanes,L|=F,v.lanes=L,Rn(_,L)}}function Ou(_,v){var L=_.updateQueue,F=_.alternate;if(F!==null&&(F=F.updateQueue,L===F)){var K=null,re=null;if(L=L.firstBaseUpdate,L!==null){do{var Ie={eventTime:L.eventTime,lane:L.lane,tag:L.tag,payload:L.payload,callback:L.callback,next:null};re===null?K=re=Ie:re=re.next=Ie,L=L.next}while(L!==null);re===null?K=re=v:re=re.next=v}else K=re=v;L={baseState:F.baseState,firstBaseUpdate:K,lastBaseUpdate:re,shared:F.shared,effects:F.effects},_.updateQueue=L;return}_=L.lastBaseUpdate,_===null?L.firstBaseUpdate=v:_.next=v,L.lastBaseUpdate=v}function $a(_,v,L,F){var K=_.updateQueue;ns=!1;var re=K.firstBaseUpdate,Ie=K.lastBaseUpdate,Ze=K.shared.pending;if(Ze!==null){K.shared.pending=null;var vt=Ze,Nt=vt.next;vt.next=null,Ie===null?re=Nt:Ie.next=Nt,Ie=vt;var vn=_.alternate;vn!==null&&(vn=vn.updateQueue,Ze=vn.lastBaseUpdate,Ze!==Ie&&(Ze===null?vn.firstBaseUpdate=Nt:Ze.next=Nt,vn.lastBaseUpdate=vt))}if(re!==null){var lr=K.baseState;Ie=0,vn=Nt=vt=null,Ze=re;do{var Dn=Ze.lane,Kr=Ze.eventTime;if((F&Dn)===Dn){vn!==null&&(vn=vn.next={eventTime:Kr,lane:0,tag:Ze.tag,payload:Ze.payload,callback:Ze.callback,next:null});e:{var pn=_,Po=Ze;switch(Dn=v,Kr=L,Po.tag){case 1:if(pn=Po.payload,typeof pn=="function"){lr=pn.call(Kr,lr,Dn);break e}lr=pn;break e;case 3:pn.flags=pn.flags&-65537|128;case 0:if(pn=Po.payload,Dn=typeof pn=="function"?pn.call(Kr,lr,Dn):pn,Dn==null)break e;lr=d({},lr,Dn);break e;case 2:ns=!0}}Ze.callback!==null&&Ze.lane!==0&&(_.flags|=64,Dn=K.effects,Dn===null?K.effects=[Ze]:Dn.push(Ze))}else Kr={eventTime:Kr,lane:Dn,tag:Ze.tag,payload:Ze.payload,callback:Ze.callback,next:null},vn===null?(Nt=vn=Kr,vt=lr):vn=vn.next=Kr,Ie|=Dn;if(Ze=Ze.next,Ze===null){if(Ze=K.shared.pending,Ze===null)break;Dn=Ze,Ze=Dn.next,Dn.next=null,K.lastBaseUpdate=Dn,K.shared.pending=null}}while(!0);if(vn===null&&(vt=lr),K.baseState=vt,K.firstBaseUpdate=Nt,K.lastBaseUpdate=vn,v=K.shared.interleaved,v!==null){K=v;do Ie|=K.lane,K=K.next;while(K!==v)}else re===null&&(K.shared.lanes=0);un|=Ie,_.lanes=Ie,_.memoizedState=lr}}function Os(_,v,L){if(_=v.effects,v.effects=null,_!==null)for(v=0;v<_.length;v++){var F=_[v],K=F.callback;if(K!==null){if(F.callback=null,F=L,typeof K!="function")throw Error(p(191,K));K.call(F)}}}var bl=new l.Component().refs;function Ys(_,v,L,F){v=_.memoizedState,L=L(F,v),L=L==null?v:d({},v,L),_.memoizedState=L,_.lanes===0&&(_.updateQueue.baseState=L)}var rs={isMounted:function(_){return(_=_._reactInternals)?je(_)===_:!1},enqueueSetState:function(_,v,L){_=_._reactInternals;var F=lo(),K=cs(_),re=io(F,K);re.payload=v,L!=null&&(re.callback=L),Js(_,re),v=co(_,K,F),v!==null&&Vl(v,_,K)},enqueueReplaceState:function(_,v,L){_=_._reactInternals;var F=lo(),K=cs(_),re=io(F,K);re.tag=1,re.payload=v,L!=null&&(re.callback=L),Js(_,re),v=co(_,K,F),v!==null&&Vl(v,_,K)},enqueueForceUpdate:function(_,v){_=_._reactInternals;var L=lo(),F=cs(_),K=io(L,F);K.tag=2,v!=null&&(K.callback=v),Js(_,K),v=co(_,F,L),v!==null&&Vl(v,_,F)}};function As(_,v,L,F,K,re,Ie){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(F,re,Ie):v.prototype&&v.prototype.isPureReactComponent?!qs(L,F)||!qs(K,re):!0}function xc(_,v,L){var F=!1,K=Si,re=v.contextType;return typeof re=="object"&&re!==null?re=Fo(re):(K=ro(v)?ja:hr.current,F=v.contextTypes,re=(F=F!=null)?zo(_,K):Si),v=new v(L,re),_.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=rs,_.stateNode=v,v._reactInternals=_,F&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=K,_.__reactInternalMemoizedMaskedChildContext=re),v}function ku(_,v,L,F){_=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(L,F),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(L,F),v.state!==_&&rs.enqueueReplaceState(v,v.state,null)}function wl(_,v,L,F){var K=_.stateNode;K.props=L,K.state=_.memoizedState,K.refs=bl,fr(_);var re=v.contextType;typeof re=="object"&&re!==null?K.context=Fo(re):(re=ro(v)?ja:hr.current,K.context=zo(_,re)),K.state=_.memoizedState,re=v.getDerivedStateFromProps,typeof re=="function"&&(Ys(_,v,re,L),K.state=_.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(v=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),v!==K.state&&rs.enqueueReplaceState(K,K.state,null),$a(_,L,K,F),K.state=_.memoizedState),typeof K.componentDidMount=="function"&&(_.flags|=4194308)}var Ha=[],Wa=0,Za=null,ya=0,Fi=[],Pn=0,oo=null,ps=1,Yi="";function Xa(_,v){Ha[Wa++]=ya,Ha[Wa++]=Za,Za=_,ya=v}function ks(_,v,L){Fi[Pn++]=ps,Fi[Pn++]=Yi,Fi[Pn++]=oo,oo=_;var F=ps;_=Yi;var K=32-wi(F)-1;F&=~(1<<K),L+=1;var re=32-wi(v)+K;if(30<re){var Ie=K-K%5;re=(F&(1<<Ie)-1).toString(32),F>>=Ie,K-=Ie,ps=1<<32-wi(v)+K|L<<K|F,Yi=re+_}else ps=1<<re|L<<K|F,Yi=_}function va(_){_.return!==null&&(Xa(_,1),ks(_,1,0))}function $c(_){for(;_===Za;)Za=Ha[--Wa],Ha[Wa]=null,ya=Ha[--Wa],Ha[Wa]=null;for(;_===oo;)oo=Fi[--Pn],Fi[Pn]=null,Yi=Fi[--Pn],Fi[Pn]=null,ps=Fi[--Pn],Fi[Pn]=null}var is=null,ms=null,Qr=!1,qa=!1,os=null;function Ka(_,v){var L=Ma(5,null,null,0);L.elementType="DELETED",L.stateNode=v,L.return=_,v=_.deletions,v===null?(_.deletions=[L],_.flags|=16):v.push(L)}function Ja(_,v){switch(_.tag){case 5:return v=Rt(v,_.type,_.pendingProps),v!==null?(_.stateNode=v,is=_,ms=$n(v),!0):!1;case 6:return v=jt(v,_.pendingProps),v!==null?(_.stateNode=v,is=_,ms=null,!0):!1;case 13:if(v=Dt(v),v!==null){var L=oo!==null?{id:ps,overflow:Yi}:null;return _.memoizedState={dehydrated:v,treeContext:L,retryLane:1073741824},L=Ma(18,null,null,0),L.stateNode=v,L.return=_,_.child=L,is=_,ms=null,!0}return!1;default:return!1}}function Hc(_){return(_.mode&1)!==0&&(_.flags&128)===0}function Qs(_){if(Qr){var v=ms;if(v){var L=v;if(!Ja(_,v)){if(Hc(_))throw Error(p(418));v=zn(L);var F=is;v&&Ja(_,v)?Ka(F,L):(_.flags=_.flags&-4097|2,Qr=!1,is=_)}}else{if(Hc(_))throw Error(p(418));_.flags=_.flags&-4097|2,Qr=!1,is=_}}}function $l(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;is=_}function Ao(_){if(!Br||_!==is)return!1;if(!Qr)return $l(_),Qr=!0,!1;if(_.tag!==3&&(_.tag!==5||vr(_.type)&&!rr(_.type,_.memoizedProps))){var v=ms;if(v){if(Hc(_)){for(_=ms;_;)_=zn(_);throw Error(p(418))}for(;v;)Ka(_,v),v=zn(v)}}if($l(_),_.tag===13){if(!Br)throw Error(p(316));if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(p(317));ms=br(_)}else ms=is?zn(_.stateNode):null;return!0}function xa(){Br&&(ms=is=null,qa=Qr=!1)}function El(_){os===null?os=[_]:os.push(_)}function ea(_,v,L){if(_=L.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(L._owner){if(L=L._owner,L){if(L.tag!==1)throw Error(p(309));var F=L.stateNode}if(!F)throw Error(p(147,_));var K=F,re=""+_;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===re?v.ref:(v=function(Ie){var Ze=K.refs;Ze===bl&&(Ze=K.refs={}),Ie===null?delete Ze[re]:Ze[re]=Ie},v._stringRef=re,v)}if(typeof _!="string")throw Error(p(284));if(!L._owner)throw Error(p(290,_))}return _}function Uo(_,v){throw _=Object.prototype.toString.call(v),Error(p(31,_==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":_))}function Hl(_){var v=_._init;return v(_._payload)}function bc(_){function v(lt,Ye){if(_){var ut=lt.deletions;ut===null?(lt.deletions=[Ye],lt.flags|=16):ut.push(Ye)}}function L(lt,Ye){if(!_)return null;for(;Ye!==null;)v(lt,Ye),Ye=Ye.sibling;return null}function F(lt,Ye){for(lt=new Map;Ye!==null;)Ye.key!==null?lt.set(Ye.key,Ye):lt.set(Ye.index,Ye),Ye=Ye.sibling;return lt}function K(lt,Ye){return lt=au(lt,Ye),lt.index=0,lt.sibling=null,lt}function re(lt,Ye,ut){return lt.index=ut,_?(ut=lt.alternate,ut!==null?(ut=ut.index,ut<Ye?(lt.flags|=2,Ye):ut):(lt.flags|=2,Ye)):(lt.flags|=1048576,Ye)}function Ie(lt){return _&&lt.alternate===null&&(lt.flags|=2),lt}function Ze(lt,Ye,ut,dn){return Ye===null||Ye.tag!==6?(Ye=Jl(ut,lt.mode,dn),Ye.return=lt,Ye):(Ye=K(Ye,ut),Ye.return=lt,Ye)}function vt(lt,Ye,ut,dn){var Mn=ut.type;return Mn===T?vn(lt,Ye,ut.props.children,dn,ut.key):Ye!==null&&(Ye.elementType===Mn||typeof Mn=="object"&&Mn!==null&&Mn.$$typeof===J&&Hl(Mn)===Ye.type)?(dn=K(Ye,ut.props),dn.ref=ea(lt,Ye,ut),dn.return=lt,dn):(dn=Qd(ut.type,ut.key,ut.props,null,lt.mode,dn),dn.ref=ea(lt,Ye,ut),dn.return=lt,dn)}function Nt(lt,Ye,ut,dn){return Ye===null||Ye.tag!==4||Ye.stateNode.containerInfo!==ut.containerInfo||Ye.stateNode.implementation!==ut.implementation?(Ye=Mh(ut,lt.mode,dn),Ye.return=lt,Ye):(Ye=K(Ye,ut.children||[]),Ye.return=lt,Ye)}function vn(lt,Ye,ut,dn,Mn){return Ye===null||Ye.tag!==7?(Ye=fi(ut,lt.mode,dn,Mn),Ye.return=lt,Ye):(Ye=K(Ye,ut),Ye.return=lt,Ye)}function lr(lt,Ye,ut){if(typeof Ye=="string"&&Ye!==""||typeof Ye=="number")return Ye=Jl(""+Ye,lt.mode,ut),Ye.return=lt,Ye;if(typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case i:return ut=Qd(Ye.type,Ye.key,Ye.props,null,lt.mode,ut),ut.ref=ea(lt,null,Ye),ut.return=lt,ut;case E:return Ye=Mh(Ye,lt.mode,ut),Ye.return=lt,Ye;case J:var dn=Ye._init;return lr(lt,dn(Ye._payload),ut)}if(Kt(Ye)||ae(Ye))return Ye=fi(Ye,lt.mode,ut,null),Ye.return=lt,Ye;Uo(lt,Ye)}return null}function Dn(lt,Ye,ut,dn){var Mn=Ye!==null?Ye.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number")return Mn!==null?null:Ze(lt,Ye,""+ut,dn);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case i:return ut.key===Mn?vt(lt,Ye,ut,dn):null;case E:return ut.key===Mn?Nt(lt,Ye,ut,dn):null;case J:return Mn=ut._init,Dn(lt,Ye,Mn(ut._payload),dn)}if(Kt(ut)||ae(ut))return Mn!==null?null:vn(lt,Ye,ut,dn,null);Uo(lt,ut)}return null}function Kr(lt,Ye,ut,dn,Mn){if(typeof dn=="string"&&dn!==""||typeof dn=="number")return lt=lt.get(ut)||null,Ze(Ye,lt,""+dn,Mn);if(typeof dn=="object"&&dn!==null){switch(dn.$$typeof){case i:return lt=lt.get(dn.key===null?ut:dn.key)||null,vt(Ye,lt,dn,Mn);case E:return lt=lt.get(dn.key===null?ut:dn.key)||null,Nt(Ye,lt,dn,Mn);case J:var Gn=dn._init;return Kr(lt,Ye,ut,Gn(dn._payload),Mn)}if(Kt(dn)||ae(dn))return lt=lt.get(ut)||null,vn(Ye,lt,dn,Mn,null);Uo(Ye,dn)}return null}function pn(lt,Ye,ut,dn){for(var Mn=null,Gn=null,ur=Ye,Nr=Ye=0,Ho=null;ur!==null&&Nr<ut.length;Nr++){ur.index>Nr?(Ho=ur,ur=null):Ho=ur.sibling;var Ur=Dn(lt,ur,ut[Nr],dn);if(Ur===null){ur===null&&(ur=Ho);break}_&&ur&&Ur.alternate===null&&v(lt,ur),Ye=re(Ur,Ye,Nr),Gn===null?Mn=Ur:Gn.sibling=Ur,Gn=Ur,ur=Ho}if(Nr===ut.length)return L(lt,ur),Qr&&Xa(lt,Nr),Mn;if(ur===null){for(;Nr<ut.length;Nr++)ur=lr(lt,ut[Nr],dn),ur!==null&&(Ye=re(ur,Ye,Nr),Gn===null?Mn=ur:Gn.sibling=ur,Gn=ur);return Qr&&Xa(lt,Nr),Mn}for(ur=F(lt,ur);Nr<ut.length;Nr++)Ho=Kr(ur,lt,Nr,ut[Nr],dn),Ho!==null&&(_&&Ho.alternate!==null&&ur.delete(Ho.key===null?Nr:Ho.key),Ye=re(Ho,Ye,Nr),Gn===null?Mn=Ho:Gn.sibling=Ho,Gn=Ho);return _&&ur.forEach(function(sa){return v(lt,sa)}),Qr&&Xa(lt,Nr),Mn}function Po(lt,Ye,ut,dn){var Mn=ae(ut);if(typeof Mn!="function")throw Error(p(150));if(ut=Mn.call(ut),ut==null)throw Error(p(151));for(var Gn=Mn=null,ur=Ye,Nr=Ye=0,Ho=null,Ur=ut.next();ur!==null&&!Ur.done;Nr++,Ur=ut.next()){ur.index>Nr?(Ho=ur,ur=null):Ho=ur.sibling;var sa=Dn(lt,ur,Ur.value,dn);if(sa===null){ur===null&&(ur=Ho);break}_&&ur&&sa.alternate===null&&v(lt,ur),Ye=re(sa,Ye,Nr),Gn===null?Mn=sa:Gn.sibling=sa,Gn=sa,ur=Ho}if(Ur.done)return L(lt,ur),Qr&&Xa(lt,Nr),Mn;if(ur===null){for(;!Ur.done;Nr++,Ur=ut.next())Ur=lr(lt,Ur.value,dn),Ur!==null&&(Ye=re(Ur,Ye,Nr),Gn===null?Mn=Ur:Gn.sibling=Ur,Gn=Ur);return Qr&&Xa(lt,Nr),Mn}for(ur=F(lt,ur);!Ur.done;Nr++,Ur=ut.next())Ur=Kr(ur,lt,Nr,Ur.value,dn),Ur!==null&&(_&&Ur.alternate!==null&&ur.delete(Ur.key===null?Nr:Ur.key),Ye=re(Ur,Ye,Nr),Gn===null?Mn=Ur:Gn.sibling=Ur,Gn=Ur);return _&&ur.forEach(function(eg){return v(lt,eg)}),Qr&&Xa(lt,Nr),Mn}function Ei(lt,Ye,ut,dn){if(typeof ut=="object"&&ut!==null&&ut.type===T&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case i:e:{for(var Mn=ut.key,Gn=Ye;Gn!==null;){if(Gn.key===Mn){if(Mn=ut.type,Mn===T){if(Gn.tag===7){L(lt,Gn.sibling),Ye=K(Gn,ut.props.children),Ye.return=lt,lt=Ye;break e}}else if(Gn.elementType===Mn||typeof Mn=="object"&&Mn!==null&&Mn.$$typeof===J&&Hl(Mn)===Gn.type){L(lt,Gn.sibling),Ye=K(Gn,ut.props),Ye.ref=ea(lt,Gn,ut),Ye.return=lt,lt=Ye;break e}L(lt,Gn);break}else v(lt,Gn);Gn=Gn.sibling}ut.type===T?(Ye=fi(ut.props.children,lt.mode,dn,ut.key),Ye.return=lt,lt=Ye):(dn=Qd(ut.type,ut.key,ut.props,null,lt.mode,dn),dn.ref=ea(lt,Ye,ut),dn.return=lt,lt=dn)}return Ie(lt);case E:e:{for(Gn=ut.key;Ye!==null;){if(Ye.key===Gn)if(Ye.tag===4&&Ye.stateNode.containerInfo===ut.containerInfo&&Ye.stateNode.implementation===ut.implementation){L(lt,Ye.sibling),Ye=K(Ye,ut.children||[]),Ye.return=lt,lt=Ye;break e}else{L(lt,Ye);break}else v(lt,Ye);Ye=Ye.sibling}Ye=Mh(ut,lt.mode,dn),Ye.return=lt,lt=Ye}return Ie(lt);case J:return Gn=ut._init,Ei(lt,Ye,Gn(ut._payload),dn)}if(Kt(ut))return pn(lt,Ye,ut,dn);if(ae(ut))return Po(lt,Ye,ut,dn);Uo(lt,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"?(ut=""+ut,Ye!==null&&Ye.tag===6?(L(lt,Ye.sibling),Ye=K(Ye,ut),Ye.return=lt,lt=Ye):(L(lt,Ye),Ye=Jl(ut,lt.mode,dn),Ye.return=lt,lt=Ye),Ie(lt)):L(lt,Ye)}return Ei}var ta=bc(!0),Cl=bc(!1),Ya={},Ts=hi(Ya),We=hi(Ya),dt=hi(Ya);function Ut(_){if(_===Ya)throw Error(p(174));return _}function Cn(_,v){et(dt,v),et(We,_),et(Ts,Ya),_=hn(v),wr(Ts),et(Ts,_)}function Er(){wr(Ts),wr(We),wr(dt)}function pr(_){var v=Ut(dt.current),L=Ut(Ts.current);v=wt(L,_.type,v),L!==v&&(et(We,_),et(Ts,v))}function ei(_){We.current===_&&(wr(Ts),wr(We))}var Qn=hi(0);function Qi(_){for(var v=_;v!==null;){if(v.tag===13){var L=v.memoizedState;if(L!==null&&(L=L.dehydrated,L===null||En(L)||Un(L)))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if(v.flags&128)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===_)break;for(;v.sibling===null;){if(v.return===null||v.return===_)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var Mi=[];function vi(){for(var _=0;_<Mi.length;_++){var v=Mi[_];Ln?v._workInProgressVersionPrimary=null:v._workInProgressVersionSecondary=null}Mi.length=0}var ss=b.ReactCurrentDispatcher,di=b.ReactCurrentBatchConfig,ji=0,Rr=null,Ri=null,Di=null,ba=!1,na=!1,wa=0,Wl=0;function so(){throw Error(p(321))}function Dr(_,v){if(v===null)return!1;for(var L=0;L<v.length&&L<_.length;L++)if(!Xr(_[L],v[L]))return!1;return!0}function cr(_,v,L,F,K,re){if(ji=re,Rr=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,ss.current=_===null||_.memoizedState===null?Gd:yh,_=L(F,K),na){re=0;do{if(na=!1,wa=0,25<=re)throw Error(p(301));re+=1,Di=Ri=null,v.updateQueue=null,ss.current=Jc,_=L(F,K)}while(na)}if(ss.current=Ec,v=Ri!==null&&Ri.next!==null,ji=0,Di=Ri=Rr=null,ba=!1,v)throw Error(p(300));return _}function Ea(){var _=wa!==0;return wa=0,_}function qr(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Di===null?Rr.memoizedState=Di=_:Di=Di.next=_,Di}function To(){if(Ri===null){var _=Rr.alternate;_=_!==null?_.memoizedState:null}else _=Ri.next;var v=Di===null?Rr.memoizedState:Di.next;if(v!==null)Di=v,Ri=_;else{if(_===null)throw Error(p(310));Ri=_,_={memoizedState:Ri.memoizedState,baseState:Ri.baseState,baseQueue:Ri.baseQueue,queue:Ri.queue,next:null},Di===null?Rr.memoizedState=Di=_:Di=Di.next=_}return Di}function Xi(_,v){return typeof v=="function"?v(_):v}function eo(_){var v=To(),L=v.queue;if(L===null)throw Error(p(311));L.lastRenderedReducer=_;var F=Ri,K=F.baseQueue,re=L.pending;if(re!==null){if(K!==null){var Ie=K.next;K.next=re.next,re.next=Ie}F.baseQueue=K=re,L.pending=null}if(K!==null){re=K.next,F=F.baseState;var Ze=Ie=null,vt=null,Nt=re;do{var vn=Nt.lane;if((ji&vn)===vn)vt!==null&&(vt=vt.next={lane:0,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null}),F=Nt.hasEagerState?Nt.eagerState:_(F,Nt.action);else{var lr={lane:vn,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null};vt===null?(Ze=vt=lr,Ie=F):vt=vt.next=lr,Rr.lanes|=vn,un|=vn}Nt=Nt.next}while(Nt!==null&&Nt!==re);vt===null?Ie=F:vt.next=Ze,Xr(F,v.memoizedState)||(_s=!0),v.memoizedState=F,v.baseState=Ie,v.baseQueue=vt,L.lastRenderedState=F}if(_=L.interleaved,_!==null){K=_;do re=K.lane,Rr.lanes|=re,un|=re,K=K.next;while(K!==_)}else K===null&&(L.lanes=0);return[v.memoizedState,L.dispatch]}function So(_){var v=To(),L=v.queue;if(L===null)throw Error(p(311));L.lastRenderedReducer=_;var F=L.dispatch,K=L.pending,re=v.memoizedState;if(K!==null){L.pending=null;var Ie=K=K.next;do re=_(re,Ie.action),Ie=Ie.next;while(Ie!==K);Xr(re,v.memoizedState)||(_s=!0),v.memoizedState=re,v.baseQueue===null&&(v.baseState=re),L.lastRenderedState=re}return[re,F]}function Ca(){}function Qa(_,v){var L=Rr,F=To(),K=v(),re=!Xr(F.memoizedState,K);if(re&&(F.memoizedState=K,_s=!0),F=F.queue,rl(Wc.bind(null,L,F,_),[_]),F.getSnapshot!==v||re||Di!==null&&Di.memoizedState.tag&1){if(L.flags|=2048,Aa(9,Ss.bind(null,L,F,K,v),void 0,null),Et===null)throw Error(p(349));ji&30||nr(L,v,K)}return K}function nr(_,v,L){_.flags|=16384,_={getSnapshot:v,value:L},v=Rr.updateQueue,v===null?(v={lastEffect:null,stores:null},Rr.updateQueue=v,v.stores=[_]):(L=v.stores,L===null?v.stores=[_]:L.push(_))}function Ss(_,v,L,F){v.value=L,v.getSnapshot=F,el(v)&&co(_,1,-1)}function Wc(_,v,L){return L(function(){el(v)&&co(_,1,-1)})}function el(_){var v=_.getSnapshot;_=_.value;try{var L=v();return!Xr(_,L)}catch{return!0}}function ra(_){var v=qr();return typeof _=="function"&&(_=_()),v.memoizedState=v.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xi,lastRenderedState:_},v.queue=_,_=_.dispatch=ju.bind(null,Rr,_),[v.memoizedState,_]}function Aa(_,v,L,F){return _={tag:_,create:v,destroy:L,deps:F,next:null},v=Rr.updateQueue,v===null?(v={lastEffect:null,stores:null},Rr.updateQueue=v,v.lastEffect=_.next=_):(L=v.lastEffect,L===null?v.lastEffect=_.next=_:(F=L.next,L.next=_,_.next=F,v.lastEffect=_)),_}function tl(){return To().memoizedState}function gs(_,v,L,F){var K=qr();Rr.flags|=_,K.memoizedState=Aa(1|v,L,void 0,F===void 0?null:F)}function nl(_,v,L,F){var K=To();F=F===void 0?null:F;var re=void 0;if(Ri!==null){var Ie=Ri.memoizedState;if(re=Ie.destroy,F!==null&&Dr(F,Ie.deps)){K.memoizedState=Aa(v,L,re,F);return}}Rr.flags|=_,K.memoizedState=Aa(1|v,L,re,F)}function Ta(_,v){return gs(8390656,8,_,v)}function rl(_,v){return nl(2048,8,_,v)}function wc(_,v){return nl(4,2,_,v)}function gh(_,v){return nl(4,4,_,v)}function Zc(_,v){if(typeof v=="function")return _=_(),v(_),function(){v(null)};if(v!=null)return _=_(),v.current=_,function(){v.current=null}}function Xc(_,v,L){return L=L!=null?L.concat([_]):null,nl(4,4,Zc.bind(null,v,_),L)}function qc(){}function zu(_,v){var L=To();v=v===void 0?null:v;var F=L.memoizedState;return F!==null&&v!==null&&Dr(v,F[1])?F[0]:(L.memoizedState=[_,v],_)}function nn(_,v){var L=To();v=v===void 0?null:v;var F=L.memoizedState;return F!==null&&v!==null&&Dr(v,F[1])?F[0]:(_=_(),L.memoizedState=[_,v],_)}function Sa(_,v){var L=Sn;Sn=L!==0&&4>L?L:4,_(!0);var F=di.transition;di.transition={};try{_(!1),v()}finally{Sn=L,di.transition=F}}function Qh(){return To().memoizedState}function Fu(_,v,L){var F=cs(_);L={lane:F,action:L,hasEagerState:!1,eagerState:null,next:null},ao(_)?Kc(v,L):(Uu(_,v,L),L=lo(),_=co(_,F,L),_!==null&&_h(_,v,F))}function ju(_,v,L){var F=cs(_),K={lane:F,action:L,hasEagerState:!1,eagerState:null,next:null};if(ao(_))Kc(v,K);else{Uu(_,v,K);var re=_.alternate;if(_.lanes===0&&(re===null||re.lanes===0)&&(re=v.lastRenderedReducer,re!==null))try{var Ie=v.lastRenderedState,Ze=re(Ie,L);if(K.hasEagerState=!0,K.eagerState=Ze,Xr(Ze,Ie))return}catch{}finally{}L=lo(),_=co(_,F,L),_!==null&&_h(_,v,F)}}function ao(_){var v=_.alternate;return _===Rr||v!==null&&v===Rr}function Kc(_,v){na=ba=!0;var L=_.pending;L===null?v.next=v:(v.next=L.next,L.next=v),_.pending=v}function Uu(_,v,L){Et!==null&&_.mode&1&&!(at&2)?(_=v.interleaved,_===null?(L.next=L,jo===null?jo=[v]:jo.push(v)):(L.next=_.next,_.next=L),v.interleaved=L):(_=v.pending,_===null?L.next=L:(L.next=_.next,_.next=L),v.pending=L)}function _h(_,v,L){if(L&4194240){var F=v.lanes;F&=_.pendingLanes,L|=F,v.lanes=L,Rn(_,L)}}var Ec={readContext:Fo,useCallback:so,useContext:so,useEffect:so,useImperativeHandle:so,useInsertionEffect:so,useLayoutEffect:so,useMemo:so,useReducer:so,useRef:so,useState:so,useDebugValue:so,useDeferredValue:so,useTransition:so,useMutableSource:so,useSyncExternalStore:so,useId:so,unstable_isNewReconciler:!1},Gd={readContext:Fo,useCallback:function(_,v){return qr().memoizedState=[_,v===void 0?null:v],_},useContext:Fo,useEffect:Ta,useImperativeHandle:function(_,v,L){return L=L!=null?L.concat([_]):null,gs(4194308,4,Zc.bind(null,v,_),L)},useLayoutEffect:function(_,v){return gs(4194308,4,_,v)},useInsertionEffect:function(_,v){return gs(4,2,_,v)},useMemo:function(_,v){var L=qr();return v=v===void 0?null:v,_=_(),L.memoizedState=[_,v],_},useReducer:function(_,v,L){var F=qr();return v=L!==void 0?L(v):v,F.memoizedState=F.baseState=v,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:v},F.queue=_,_=_.dispatch=Fu.bind(null,Rr,_),[F.memoizedState,_]},useRef:function(_){var v=qr();return _={current:_},v.memoizedState=_},useState:ra,useDebugValue:qc,useDeferredValue:function(_){var v=ra(_),L=v[0],F=v[1];return Ta(function(){var K=di.transition;di.transition={};try{F(_)}finally{di.transition=K}},[_]),L},useTransition:function(){var _=ra(!1),v=_[0];return _=Sa.bind(null,_[1]),qr().memoizedState=_,[v,_]},useMutableSource:function(){},useSyncExternalStore:function(_,v,L){var F=Rr,K=qr();if(Qr){if(L===void 0)throw Error(p(407));L=L()}else{if(L=v(),Et===null)throw Error(p(349));ji&30||nr(F,v,L)}K.memoizedState=L;var re={value:L,getSnapshot:v};return K.queue=re,Ta(Wc.bind(null,F,re,_),[_]),F.flags|=2048,Aa(9,Ss.bind(null,F,re,L,v),void 0,null),L},useId:function(){var _=qr(),v=Et.identifierPrefix;if(Qr){var L=Yi,F=ps;L=(F&~(1<<32-wi(F)-1)).toString(32)+L,v=":"+v+"R"+L,L=wa++,0<L&&(v+="H"+L.toString(32)),v+=":"}else L=Wl++,v=":"+v+"r"+L.toString(32)+":";return _.memoizedState=v},unstable_isNewReconciler:!1},yh={readContext:Fo,useCallback:zu,useContext:Fo,useEffect:rl,useImperativeHandle:Xc,useInsertionEffect:wc,useLayoutEffect:gh,useMemo:nn,useReducer:eo,useRef:tl,useState:function(){return eo(Xi)},useDebugValue:qc,useDeferredValue:function(_){var v=eo(Xi),L=v[0],F=v[1];return rl(function(){var K=di.transition;di.transition={};try{F(_)}finally{di.transition=K}},[_]),L},useTransition:function(){var _=eo(Xi)[0],v=To().memoizedState;return[_,v]},useMutableSource:Ca,useSyncExternalStore:Qa,useId:Qh,unstable_isNewReconciler:!1},Jc={readContext:Fo,useCallback:zu,useContext:Fo,useEffect:rl,useImperativeHandle:Xc,useInsertionEffect:wc,useLayoutEffect:gh,useMemo:nn,useReducer:So,useRef:tl,useState:function(){return So(Xi)},useDebugValue:qc,useDeferredValue:function(_){var v=So(Xi),L=v[0],F=v[1];return rl(function(){var K=di.transition;di.transition={};try{F(_)}finally{di.transition=K}},[_]),L},useTransition:function(){var _=So(Xi)[0],v=To().memoizedState;return[_,v]},useMutableSource:Ca,useSyncExternalStore:Qa,useId:Qh,unstable_isNewReconciler:!1};function Nu(_,v){try{var L="",F=v;do L+=Ds(F),F=F.return;while(F);var K=L}catch(re){K=`
Error generating stack: `+re.message+`
`+re.stack}return{value:_,source:v,stack:K}}function ed(_,v){try{console.error(v.value)}catch(L){setTimeout(function(){throw L})}}var Vd=typeof WeakMap=="function"?WeakMap:Map;function Cc(_,v,L){L=io(-1,L),L.tag=3,L.payload={element:null};var F=v.value;return L.callback=function(){js||(js=!0,ti=F),ed(_,v)},L}function vh(_,v,L){L=io(-1,L),L.tag=3;var F=_.type.getDerivedStateFromError;if(typeof F=="function"){var K=v.value;L.payload=function(){return F(K)},L.callback=function(){ed(_,v)}}var re=_.stateNode;return re!==null&&typeof re.componentDidCatch=="function"&&(L.callback=function(){ed(_,v),typeof F!="function"&&(_r===null?_r=new Set([this]):_r.add(this));var Ie=v.stack;this.componentDidCatch(v.value,{componentStack:Ie!==null?Ie:""})}),L}function xh(_,v,L){var F=_.pingCache;if(F===null){F=_.pingCache=new Vd;var K=new Set;F.set(v,K)}else K=F.get(v),K===void 0&&(K=new Set,F.set(v,K));K.has(L)||(K.add(L),_=su.bind(null,_,v,L),v.then(_,_))}function bh(_){do{var v;if((v=_.tag===13)&&(v=_.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return _;_=_.return}while(_!==null);return null}function Gu(_,v,L,F,K){return _.mode&1?(_.flags|=65536,_.lanes=K,_):(_===v?_.flags|=65536:(_.flags|=128,L.flags|=131072,L.flags&=-52805,L.tag===1&&(L.alternate===null?L.tag=17:(v=io(-1,1),v.tag=2,Js(L,v))),L.lanes|=1),_)}function Ms(_){_.flags|=4}function Yc(_,v){if(_!==null&&_.child===v.child)return!0;if(v.flags&16)return!1;for(_=v.child;_!==null;){if(_.flags&12854||_.subtreeFlags&12854)return!1;_=_.sibling}return!0}var Ac,Qc,eu,Vu;if(li)Ac=function(_,v){for(var L=v.child;L!==null;){if(L.tag===5||L.tag===6)mn(_,L.stateNode);else if(L.tag!==4&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===v)break;for(;L.sibling===null;){if(L.return===null||L.return===v)return;L=L.return}L.sibling.return=L.return,L=L.sibling}},Qc=function(){},eu=function(_,v,L,F,K){if(_=_.memoizedProps,_!==F){var re=v.stateNode,Ie=Ut(Ts.current);L=On(re,L,_,F,K,Ie),(v.updateQueue=L)&&Ms(v)}},Vu=function(_,v,L,F){L!==F&&Ms(v)};else if(kn){Ac=function(_,v,L,F){for(var K=v.child;K!==null;){if(K.tag===5){var re=K.stateNode;L&&F&&(re=Ve(re,K.type,K.memoizedProps,K)),mn(_,re)}else if(K.tag===6)re=K.stateNode,L&&F&&(re=rt(re,K.memoizedProps,K)),mn(_,re);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)re=K.child,re!==null&&(re.return=K),Ac(_,K,!0,!0);else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===v)break;for(;K.sibling===null;){if(K.return===null||K.return===v)return;K=K.return}K.sibling.return=K.return,K=K.sibling}};var Al=function(_,v,L,F){for(var K=v.child;K!==null;){if(K.tag===5){var re=K.stateNode;L&&F&&(re=Ve(re,K.type,K.memoizedProps,K)),Ge(_,re)}else if(K.tag===6)re=K.stateNode,L&&F&&(re=rt(re,K.memoizedProps,K)),Ge(_,re);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)re=K.child,re!==null&&(re.return=K),Al(_,K,!0,!0);else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===v)break;for(;K.sibling===null;){if(K.return===null||K.return===v)return;K=K.return}K.sibling.return=K.return,K=K.sibling}};Qc=function(_,v){var L=v.stateNode;if(!Yc(_,v)){_=L.containerInfo;var F=Be(_);Al(F,v,!1,!1),L.pendingChildren=F,Ms(v),Xe(_,F)}},eu=function(_,v,L,F,K){var re=_.stateNode,Ie=_.memoizedProps;if((_=Yc(_,v))&&Ie===F)v.stateNode=re;else{var Ze=v.stateNode,vt=Ut(Ts.current),Nt=null;Ie!==F&&(Nt=On(Ze,L,Ie,F,K,vt)),_&&Nt===null?v.stateNode=re:(re=Te(re,Nt,L,Ie,F,v,_,Ze),yn(re,L,F,K,vt)&&Ms(v),v.stateNode=re,_?Ms(v):Ac(re,v,!1,!1))}},Vu=function(_,v,L,F){L!==F?(_=Ut(dt.current),L=Ut(Ts.current),v.stateNode=Yn(F,_,L,v),Ms(v)):v.stateNode=_.stateNode}}else Qc=function(){},eu=function(){},Vu=function(){};function tu(_,v){if(!Qr)switch(_.tailMode){case"hidden":v=_.tail;for(var L=null;v!==null;)v.alternate!==null&&(L=v),v=v.sibling;L===null?_.tail=null:L.sibling=null;break;case"collapsed":L=_.tail;for(var F=null;L!==null;)L.alternate!==null&&(F=L),L=L.sibling;F===null?v||_.tail===null?_.tail=null:_.tail.sibling=null:F.sibling=null}}function No(_){var v=_.alternate!==null&&_.alternate.child===_.child,L=0,F=0;if(v)for(var K=_.child;K!==null;)L|=K.lanes|K.childLanes,F|=K.subtreeFlags&14680064,F|=K.flags&14680064,K.return=_,K=K.sibling;else for(K=_.child;K!==null;)L|=K.lanes|K.childLanes,F|=K.subtreeFlags,F|=K.flags,K.return=_,K=K.sibling;return _.subtreeFlags|=F,_.childLanes=L,v}function Ap(_,v,L){var F=v.pendingProps;switch($c(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return No(v),null;case 1:return ro(v.type)&&vl(),No(v),null;case 3:return F=v.stateNode,Er(),wr(Sr),wr(hr),vi(),F.pendingContext&&(F.context=F.pendingContext,F.pendingContext=null),(_===null||_.child===null)&&(Ao(v)?Ms(v):_===null||_.memoizedState.isDehydrated&&!(v.flags&256)||(v.flags|=1024,os!==null&&(qd(os),os=null))),Qc(_,v),No(v),null;case 5:ei(v),L=Ut(dt.current);var K=v.type;if(_!==null&&v.stateNode!=null)eu(_,v,K,F,L),_.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!F){if(v.stateNode===null)throw Error(p(166));return No(v),null}if(_=Ut(Ts.current),Ao(v)){if(!Br)throw Error(p(175));_=Wi(v.stateNode,v.type,v.memoizedProps,L,_,v,!qa),v.updateQueue=_,_!==null&&Ms(v)}else{var re=Zt(K,F,L,_,v);Ac(re,v,!1,!1),v.stateNode=re,yn(re,K,F,L,_)&&Ms(v)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return No(v),null;case 6:if(_&&v.stateNode!=null)Vu(_,v,_.memoizedProps,F);else{if(typeof F!="string"&&v.stateNode===null)throw Error(p(166));if(_=Ut(dt.current),L=Ut(Ts.current),Ao(v)){if(!Br)throw Error(p(176));if(_=v.stateNode,F=v.memoizedProps,(L=zi(_,F,v,!qa))&&(K=is,K!==null))switch(re=(K.mode&1)!==0,K.tag){case 3:_c(K.stateNode.containerInfo,_,F,re);break;case 5:yc(K.type,K.memoizedProps,K.stateNode,_,F,re)}L&&Ms(v)}else v.stateNode=Yn(F,_,L,v)}return No(v),null;case 13:if(wr(Qn),F=v.memoizedState,Qr&&ms!==null&&v.mode&1&&!(v.flags&128)){for(_=ms;_;)_=zn(_);return xa(),v.flags|=98560,v}if(F!==null&&F.dehydrated!==null){if(F=Ao(v),_===null){if(!F)throw Error(p(318));if(!Br)throw Error(p(344));if(_=v.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(p(317));Hs(_,v)}else xa(),!(v.flags&128)&&(v.memoizedState=null),v.flags|=4;return No(v),null}return os!==null&&(qd(os),os=null),v.flags&128?(v.lanes=L,v):(F=F!==null,L=!1,_===null?Ao(v):L=_.memoizedState!==null,F&&!L&&(v.child.flags|=8192,v.mode&1&&(_===null||Qn.current&1?An===0&&(An=3):Sh())),v.updateQueue!==null&&(v.flags|=4),No(v),null);case 4:return Er(),Qc(_,v),_===null&&Ji(v.stateNode.containerInfo),No(v),null;case 10:return Va(v.type._context),No(v),null;case 17:return ro(v.type)&&vl(),No(v),null;case 19:if(wr(Qn),K=v.memoizedState,K===null)return No(v),null;if(F=(v.flags&128)!==0,re=K.rendering,re===null)if(F)tu(K,!1);else{if(An!==0||_!==null&&_.flags&128)for(_=v.child;_!==null;){if(re=Qi(_),re!==null){for(v.flags|=128,tu(K,!1),_=re.updateQueue,_!==null&&(v.updateQueue=_,v.flags|=4),v.subtreeFlags=0,_=L,F=v.child;F!==null;)L=F,K=_,L.flags&=14680066,re=L.alternate,re===null?(L.childLanes=0,L.lanes=K,L.child=null,L.subtreeFlags=0,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=re.childLanes,L.lanes=re.lanes,L.child=re.child,L.subtreeFlags=0,L.deletions=null,L.memoizedProps=re.memoizedProps,L.memoizedState=re.memoizedState,L.updateQueue=re.updateQueue,L.type=re.type,K=re.dependencies,L.dependencies=K===null?null:{lanes:K.lanes,firstContext:K.firstContext}),F=F.sibling;return et(Qn,Qn.current&1|2),v.child}_=_.sibling}K.tail!==null&&dr()>to&&(v.flags|=128,F=!0,tu(K,!1),v.lanes=4194304)}else{if(!F)if(_=Qi(re),_!==null){if(v.flags|=128,F=!0,_=_.updateQueue,_!==null&&(v.updateQueue=_,v.flags|=4),tu(K,!0),K.tail===null&&K.tailMode==="hidden"&&!re.alternate&&!Qr)return No(v),null}else 2*dr()-K.renderingStartTime>to&&L!==1073741824&&(v.flags|=128,F=!0,tu(K,!1),v.lanes=4194304);K.isBackwards?(re.sibling=v.child,v.child=re):(_=K.last,_!==null?_.sibling=re:v.child=re,K.last=re)}return K.tail!==null?(v=K.tail,K.rendering=v,K.tail=v.sibling,K.renderingStartTime=dr(),v.sibling=null,_=Qn.current,et(Qn,F?_&1|2:_&1),v):(No(v),null);case 22:case 23:return Jd(),F=v.memoizedState!==null,_!==null&&_.memoizedState!==null!==F&&(v.flags|=8192),F&&v.mode&1?qt&1073741824&&(No(v),li&&v.subtreeFlags&6&&(v.flags|=8192)):No(v),null;case 24:return null;case 25:return null}throw Error(p(156,v.tag))}var $d=b.ReactCurrentOwner,_s=!1;function as(_,v,L,F){v.child=_===null?Cl(v,null,L,F):ta(v,_.child,L,F)}function td(_,v,L,F,K){L=L.render;var re=v.ref;return _a(v,K),F=cr(_,v,L,F,re,K),L=Ea(),_!==null&&!_s?(v.updateQueue=_.updateQueue,v.flags&=-2053,_.lanes&=~K,Sl(_,v,K)):(Qr&&L&&va(v),v.flags|=1,as(_,v,F,K),v.child)}function Go(_,v,L,F,K){if(_===null){var re=L.type;return typeof re=="function"&&!Yd(re)&&re.defaultProps===void 0&&L.compare===null&&L.defaultProps===void 0?(v.tag=15,v.type=re,Hd(_,v,re,F,K)):(_=Qd(L.type,null,F,v,v.mode,K),_.ref=v.ref,_.return=v,v.child=_)}if(re=_.child,!(_.lanes&K)){var Ie=re.memoizedProps;if(L=L.compare,L=L!==null?L:qs,L(Ie,F)&&_.ref===v.ref)return Sl(_,v,K)}return v.flags|=1,_=au(re,F),_.ref=v.ref,_.return=v,v.child=_}function Hd(_,v,L,F,K){if(_!==null&&qs(_.memoizedProps,F)&&_.ref===v.ref)if(_s=!1,(_.lanes&K)!==0)_.flags&131072&&(_s=!0);else return v.lanes=_.lanes,Sl(_,v,K);return rd(_,v,L,F,K)}function nd(_,v,L){var F=v.pendingProps,K=F.children,re=_!==null?_.memoizedState:null;if(F.mode==="hidden")if(!(v.mode&1))v.memoizedState={baseLanes:0,cachePool:null},et(gn,qt),qt|=L;else if(L&1073741824)v.memoizedState={baseLanes:0,cachePool:null},F=re!==null?re.baseLanes:L,et(gn,qt),qt|=F;else return _=re!==null?re.baseLanes|L:L,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:_,cachePool:null},v.updateQueue=null,et(gn,qt),qt|=_,null;else re!==null?(F=re.baseLanes|L,v.memoizedState=null):F=L,et(gn,qt),qt|=F;return as(_,v,K,L),v.child}function Wd(_,v){var L=v.ref;(_===null&&L!==null||_!==null&&_.ref!==L)&&(v.flags|=512,v.flags|=2097152)}function rd(_,v,L,F,K){var re=ro(L)?ja:hr.current;return re=zo(v,re),_a(v,K),L=cr(_,v,L,F,re,K),F=Ea(),_!==null&&!_s?(v.updateQueue=_.updateQueue,v.flags&=-2053,_.lanes&=~K,Sl(_,v,K)):(Qr&&F&&va(v),v.flags|=1,as(_,v,L,K),v.child)}function zs(_,v,L,F,K){if(ro(L)){var re=!0;Xn(v)}else re=!1;if(_a(v,K),v.stateNode===null)_!==null&&(_.alternate=null,v.alternate=null,v.flags|=2),xc(v,L,F),wl(v,L,F,K),F=!0;else if(_===null){var Ie=v.stateNode,Ze=v.memoizedProps;Ie.props=Ze;var vt=Ie.context,Nt=L.contextType;typeof Nt=="object"&&Nt!==null?Nt=Fo(Nt):(Nt=ro(L)?ja:hr.current,Nt=zo(v,Nt));var vn=L.getDerivedStateFromProps,lr=typeof vn=="function"||typeof Ie.getSnapshotBeforeUpdate=="function";lr||typeof Ie.UNSAFE_componentWillReceiveProps!="function"&&typeof Ie.componentWillReceiveProps!="function"||(Ze!==F||vt!==Nt)&&ku(v,Ie,F,Nt),ns=!1;var Dn=v.memoizedState;Ie.state=Dn,$a(v,F,Ie,K),vt=v.memoizedState,Ze!==F||Dn!==vt||Sr.current||ns?(typeof vn=="function"&&(Ys(v,L,vn,F),vt=v.memoizedState),(Ze=ns||As(v,L,Ze,F,Dn,vt,Nt))?(lr||typeof Ie.UNSAFE_componentWillMount!="function"&&typeof Ie.componentWillMount!="function"||(typeof Ie.componentWillMount=="function"&&Ie.componentWillMount(),typeof Ie.UNSAFE_componentWillMount=="function"&&Ie.UNSAFE_componentWillMount()),typeof Ie.componentDidMount=="function"&&(v.flags|=4194308)):(typeof Ie.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=F,v.memoizedState=vt),Ie.props=F,Ie.state=vt,Ie.context=Nt,F=Ze):(typeof Ie.componentDidMount=="function"&&(v.flags|=4194308),F=!1)}else{Ie=v.stateNode,mh(_,v),Ze=v.memoizedProps,Nt=v.type===v.elementType?Ze:ts(v.type,Ze),Ie.props=Nt,lr=v.pendingProps,Dn=Ie.context,vt=L.contextType,typeof vt=="object"&&vt!==null?vt=Fo(vt):(vt=ro(L)?ja:hr.current,vt=zo(v,vt));var Kr=L.getDerivedStateFromProps;(vn=typeof Kr=="function"||typeof Ie.getSnapshotBeforeUpdate=="function")||typeof Ie.UNSAFE_componentWillReceiveProps!="function"&&typeof Ie.componentWillReceiveProps!="function"||(Ze!==lr||Dn!==vt)&&ku(v,Ie,F,vt),ns=!1,Dn=v.memoizedState,Ie.state=Dn,$a(v,F,Ie,K);var pn=v.memoizedState;Ze!==lr||Dn!==pn||Sr.current||ns?(typeof Kr=="function"&&(Ys(v,L,Kr,F),pn=v.memoizedState),(Nt=ns||As(v,L,Nt,F,Dn,pn,vt)||!1)?(vn||typeof Ie.UNSAFE_componentWillUpdate!="function"&&typeof Ie.componentWillUpdate!="function"||(typeof Ie.componentWillUpdate=="function"&&Ie.componentWillUpdate(F,pn,vt),typeof Ie.UNSAFE_componentWillUpdate=="function"&&Ie.UNSAFE_componentWillUpdate(F,pn,vt)),typeof Ie.componentDidUpdate=="function"&&(v.flags|=4),typeof Ie.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof Ie.componentDidUpdate!="function"||Ze===_.memoizedProps&&Dn===_.memoizedState||(v.flags|=4),typeof Ie.getSnapshotBeforeUpdate!="function"||Ze===_.memoizedProps&&Dn===_.memoizedState||(v.flags|=1024),v.memoizedProps=F,v.memoizedState=pn),Ie.props=F,Ie.state=pn,Ie.context=vt,F=Nt):(typeof Ie.componentDidUpdate!="function"||Ze===_.memoizedProps&&Dn===_.memoizedState||(v.flags|=4),typeof Ie.getSnapshotBeforeUpdate!="function"||Ze===_.memoizedProps&&Dn===_.memoizedState||(v.flags|=1024),F=!1)}return wh(_,v,L,F,re,K)}function wh(_,v,L,F,K,re){Wd(_,v);var Ie=(v.flags&128)!==0;if(!F&&!Ie)return K&&qn(v,L,!1),Sl(_,v,re);F=v.stateNode,$d.current=v;var Ze=Ie&&typeof L.getDerivedStateFromError!="function"?null:F.render();return v.flags|=1,_!==null&&Ie?(v.child=ta(v,_.child,null,re),v.child=ta(v,null,Ze,re)):as(_,v,Ze,re),v.memoizedState=F.state,K&&qn(v,L,!0),v.child}function Zd(_){var v=_.stateNode;v.pendingContext?Ua(_,v.pendingContext,v.pendingContext!==v.context):v.context&&Ua(_,v.context,!1),Cn(_,v.containerInfo)}function ia(_,v,L,F,K){return xa(),El(K),v.flags|=256,as(_,v,L,F),v.child}var Fs={dehydrated:null,treeContext:null,retryLane:0};function il(_){return{baseLanes:_,cachePool:null}}function $u(_,v,L){var F=v.pendingProps,K=Qn.current,re=!1,Ie=(v.flags&128)!==0,Ze;if((Ze=Ie)||(Ze=_!==null&&_.memoizedState===null?!1:(K&2)!==0),Ze?(re=!0,v.flags&=-129):(_===null||_.memoizedState!==null)&&(K|=1),et(Qn,K&1),_===null)return Qs(v),_=v.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?(v.mode&1?Un(_)?v.lanes=8:v.lanes=1073741824:v.lanes=1,null):(K=F.children,_=F.fallback,re?(F=v.mode,re=v.child,K={mode:"hidden",children:K},!(F&1)&&re!==null?(re.childLanes=0,re.pendingProps=K):re=_n(K,F,0,null),_=fi(_,F,L,null),re.return=v,_.return=v,re.sibling=_,v.child=re,v.child.memoizedState=il(L),v.memoizedState=Fs,_):on(v,K));if(K=_.memoizedState,K!==null){if(Ze=K.dehydrated,Ze!==null){if(Ie)return v.flags&256?(v.flags&=-257,Tl(_,v,L,Error(p(422)))):v.memoizedState!==null?(v.child=_.child,v.flags|=128,null):(re=F.fallback,K=v.mode,F=_n({mode:"visible",children:F.children},K,0,null),re=fi(re,K,L,null),re.flags|=2,F.return=v,re.return=v,F.sibling=re,v.child=F,v.mode&1&&ta(v,_.child,null,L),v.child.memoizedState=il(L),v.memoizedState=Fs,re);if(!(v.mode&1))v=Tl(_,v,L,null);else if(Un(Ze))v=Tl(_,v,L,Error(p(419)));else if(F=(L&_.childLanes)!==0,_s||F){if(F=Et,F!==null){switch(L&-L){case 4:re=2;break;case 16:re=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:re=32;break;case 536870912:re=268435456;break;default:re=0}F=re&(F.suspendedLanes|L)?0:re,F!==0&&F!==K.retryLane&&(K.retryLane=F,co(_,F,-1))}Sh(),v=Tl(_,v,L,Error(p(421)))}else En(Ze)?(v.flags|=128,v.child=_.child,v=Xu.bind(null,_),Fn(Ze,v),v=null):(L=K.treeContext,Br&&(ms=yi(Ze),is=v,Qr=!0,os=null,qa=!1,L!==null&&(Fi[Pn++]=ps,Fi[Pn++]=Yi,Fi[Pn++]=oo,ps=L.id,Yi=L.overflow,oo=v)),v=on(v,v.pendingProps.children),v.flags|=4096);return v}return re?(F=Ch(_,v,F.children,F.fallback,L),re=v.child,K=_.child.memoizedState,re.memoizedState=K===null?il(L):{baseLanes:K.baseLanes|L,cachePool:null},re.childLanes=_.childLanes&~L,v.memoizedState=Fs,F):(L=Eh(_,v,F.children,L),v.memoizedState=null,L)}return re?(F=Ch(_,v,F.children,F.fallback,L),re=v.child,K=_.child.memoizedState,re.memoizedState=K===null?il(L):{baseLanes:K.baseLanes|L,cachePool:null},re.childLanes=_.childLanes&~L,v.memoizedState=Fs,F):(L=Eh(_,v,F.children,L),v.memoizedState=null,L)}function on(_,v){return v=_n({mode:"visible",children:v},_.mode,0,null),v.return=_,_.child=v}function Eh(_,v,L,F){var K=_.child;return _=K.sibling,L=au(K,{mode:"visible",children:L}),!(v.mode&1)&&(L.lanes=F),L.return=v,L.sibling=null,_!==null&&(F=v.deletions,F===null?(v.deletions=[_],v.flags|=16):F.push(_)),v.child=L}function Ch(_,v,L,F,K){var re=v.mode;_=_.child;var Ie=_.sibling,Ze={mode:"hidden",children:L};return!(re&1)&&v.child!==_?(L=v.child,L.childLanes=0,L.pendingProps=Ze,v.deletions=null):(L=au(_,Ze),L.subtreeFlags=_.subtreeFlags&14680064),Ie!==null?F=au(Ie,F):(F=fi(F,re,K,null),F.flags|=2),F.return=v,L.return=v,L.sibling=F,v.child=L,F}function Tl(_,v,L,F){return F!==null&&El(F),ta(v,_.child,null,L),_=on(v,v.pendingProps.children),_.flags|=2,v.memoizedState=null,_}function Zl(_,v,L){_.lanes|=v;var F=_.alternate;F!==null&&(F.lanes|=v),vc(_.return,v,L)}function Xt(_,v,L,F,K){var re=_.memoizedState;re===null?_.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:F,tail:L,tailMode:K}:(re.isBackwards=v,re.rendering=null,re.renderingStartTime=0,re.last=F,re.tail=L,re.tailMode=K)}function Ah(_,v,L){var F=v.pendingProps,K=F.revealOrder,re=F.tail;if(as(_,v,F.children,L),F=Qn.current,F&2)F=F&1|2,v.flags|=128;else{if(_!==null&&_.flags&128)e:for(_=v.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&Zl(_,L,v);else if(_.tag===19)Zl(_,L,v);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===v)break e;for(;_.sibling===null;){if(_.return===null||_.return===v)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}F&=1}if(et(Qn,F),!(v.mode&1))v.memoizedState=null;else switch(K){case"forwards":for(L=v.child,K=null;L!==null;)_=L.alternate,_!==null&&Qi(_)===null&&(K=L),L=L.sibling;L=K,L===null?(K=v.child,v.child=null):(K=L.sibling,L.sibling=null),Xt(v,!1,K,L,re);break;case"backwards":for(L=null,K=v.child,v.child=null;K!==null;){if(_=K.alternate,_!==null&&Qi(_)===null){v.child=K;break}_=K.sibling,K.sibling=L,L=K,K=_}Xt(v,!0,L,null,re);break;case"together":Xt(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function Sl(_,v,L){if(_!==null&&(v.dependencies=_.dependencies),un|=v.lanes,!(L&v.childLanes))return null;if(_!==null&&v.child!==_.child)throw Error(p(153));if(v.child!==null){for(_=v.child,L=au(_,_.pendingProps),v.child=L,L.return=v;_.sibling!==null;)_=_.sibling,L=L.sibling=au(_,_.pendingProps),L.return=v;L.sibling=null}return v.child}function Xd(_,v,L){switch(v.tag){case 3:Zd(v),xa();break;case 5:pr(v);break;case 1:ro(v.type)&&Xn(v);break;case 4:Cn(v,v.stateNode.containerInfo);break;case 10:Co(v,v.type._context,v.memoizedProps.value);break;case 13:var F=v.memoizedState;if(F!==null)return F.dehydrated!==null?(et(Qn,Qn.current&1),v.flags|=128,null):L&v.child.childLanes?$u(_,v,L):(et(Qn,Qn.current&1),_=Sl(_,v,L),_!==null?_.sibling:null);et(Qn,Qn.current&1);break;case 19:if(F=(L&v.childLanes)!==0,_.flags&128){if(F)return Ah(_,v,L);v.flags|=128}var K=v.memoizedState;if(K!==null&&(K.rendering=null,K.tail=null,K.lastEffect=null),et(Qn,Qn.current),F)break;return null;case 22:case 23:return v.lanes=0,nd(_,v,L)}return Sl(_,v,L)}function id(_,v){switch($c(v),v.tag){case 1:return ro(v.type)&&vl(),_=v.flags,_&65536?(v.flags=_&-65537|128,v):null;case 3:return Er(),wr(Sr),wr(hr),vi(),_=v.flags,_&65536&&!(_&128)?(v.flags=_&-65537|128,v):null;case 5:return ei(v),null;case 13:if(wr(Qn),_=v.memoizedState,_!==null&&_.dehydrated!==null){if(v.alternate===null)throw Error(p(340));xa()}return _=v.flags,_&65536?(v.flags=_&-65537|128,v):null;case 19:return wr(Qn),null;case 4:return Er(),null;case 10:return Va(v.type._context),null;case 22:case 23:return Jd(),null;case 24:return null;default:return null}}var Hu=!1,Xl=!1,Tp=typeof WeakSet=="function"?WeakSet:Set,cn=null;function nu(_,v){var L=_.ref;if(L!==null)if(typeof L=="function")try{L(null)}catch(F){Ui(_,v,F)}else L.current=null}function Wu(_,v,L){try{L()}catch(F){Ui(_,v,F)}}var Th=!1;function ru(_,v){for(bt(_.containerInfo),cn=v;cn!==null;)if(_=cn,v=_.child,(_.subtreeFlags&1028)!==0&&v!==null)v.return=_,cn=v;else for(;cn!==null;){_=cn;try{var L=_.alternate;if(_.flags&1024)switch(_.tag){case 0:case 11:case 15:break;case 1:if(L!==null){var F=L.memoizedProps,K=L.memoizedState,re=_.stateNode,Ie=re.getSnapshotBeforeUpdate(_.elementType===_.type?F:ts(_.type,F),K);re.__reactInternalSnapshotBeforeUpdate=Ie}break;case 3:li&&le(_.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Ze){Ui(_,_.return,Ze)}if(v=_.sibling,v!==null){v.return=_.return,cn=v;break}cn=_.return}return L=Th,Th=!1,L}function m(_,v,L){var F=v.updateQueue;if(F=F!==null?F.lastEffect:null,F!==null){var K=F=F.next;do{if((K.tag&_)===_){var re=K.destroy;K.destroy=void 0,re!==void 0&&Wu(v,L,re)}K=K.next}while(K!==F)}}function a(_,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var L=v=v.next;do{if((L.tag&_)===_){var F=L.create;L.destroy=F()}L=L.next}while(L!==v)}}function h(_){var v=_.ref;if(v!==null){var L=_.stateNode;switch(_.tag){case 5:_=Gt(L);break;default:_=L}typeof v=="function"?v(_):v.current=_}}function y(_,v,L){if(es&&typeof es.onCommitFiberUnmount=="function")try{es.onCommitFiberUnmount(Zr,v)}catch{}switch(v.tag){case 0:case 11:case 14:case 15:if(_=v.updateQueue,_!==null&&(_=_.lastEffect,_!==null)){var F=_=_.next;do{var K=F,re=K.destroy;K=K.tag,re!==void 0&&(K&2||K&4)&&Wu(v,L,re),F=F.next}while(F!==_)}break;case 1:if(nu(v,L),_=v.stateNode,typeof _.componentWillUnmount=="function")try{_.props=v.memoizedProps,_.state=v.memoizedState,_.componentWillUnmount()}catch(Ie){Ui(v,L,Ie)}break;case 5:nu(v,L);break;case 4:li?ne(_,v,L):kn&&kn&&(v=v.stateNode.containerInfo,L=Be(v),qe(v,L))}}function w(_,v,L){for(var F=v;;)if(y(_,F,L),F.child===null||li&&F.tag===4){if(F===v)break;for(;F.sibling===null;){if(F.return===null||F.return===v)return;F=F.return}F.sibling.return=F.return,F=F.sibling}else F.child.return=F,F=F.child}function S(_){var v=_.alternate;v!==null&&(_.alternate=null,S(v)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(v=_.stateNode,v!==null&&ki(v)),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function R(_){return _.tag===5||_.tag===3||_.tag===4}function D(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||R(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function G(_){if(li){e:{for(var v=_.return;v!==null;){if(R(v))break e;v=v.return}throw Error(p(160))}var L=v;switch(L.tag){case 5:v=L.stateNode,L.flags&32&&(Vt(v),L.flags&=-33),L=D(_),Z(_,L,v);break;case 3:case 4:v=L.stateNode.containerInfo,L=D(_),q(_,L,v);break;default:throw Error(p(161))}}}function q(_,v,L){var F=_.tag;if(F===5||F===6)_=_.stateNode,v?Ko(L,_,v):Hi(L,_);else if(F!==4&&(_=_.child,_!==null))for(q(_,v,L),_=_.sibling;_!==null;)q(_,v,L),_=_.sibling}function Z(_,v,L){var F=_.tag;if(F===5||F===6)_=_.stateNode,v?bo(L,_,v):ui(L,_);else if(F!==4&&(_=_.child,_!==null))for(Z(_,v,L),_=_.sibling;_!==null;)Z(_,v,L),_=_.sibling}function ne(_,v,L){for(var F=v,K=!1,re,Ie;;){if(!K){K=F.return;e:for(;;){if(K===null)throw Error(p(160));switch(re=K.stateNode,K.tag){case 5:Ie=!1;break e;case 3:re=re.containerInfo,Ie=!0;break e;case 4:re=re.containerInfo,Ie=!0;break e}K=K.return}K=!0}if(F.tag===5||F.tag===6)w(_,F,L),Ie?Je(re,F.stateNode):wo(re,F.stateNode);else if(F.tag===18)Ie?Ru(re,F.stateNode):Yh(re,F.stateNode);else if(F.tag===4){if(F.child!==null){re=F.stateNode.containerInfo,Ie=!0,F.child.return=F,F=F.child;continue}}else if(y(_,F,L),F.child!==null){F.child.return=F,F=F.child;continue}if(F===v)break;for(;F.sibling===null;){if(F.return===null||F.return===v)return;F=F.return,F.tag===4&&(K=!1)}F.sibling.return=F.return,F=F.sibling}}function he(_,v){if(li){switch(v.tag){case 0:case 11:case 14:case 15:m(3,v,v.return),a(3,v),m(5,v,v.return);return;case 1:return;case 5:var L=v.stateNode;if(L!=null){var F=v.memoizedProps;_=_!==null?_.memoizedProps:F;var K=v.type,re=v.updateQueue;v.updateQueue=null,re!==null&&ko(L,re,K,_,F,v)}return;case 6:if(v.stateNode===null)throw Error(p(162));L=v.memoizedProps,Oo(v.stateNode,_!==null?_.memoizedProps:L,L);return;case 3:Br&&_!==null&&_.memoizedState.isDehydrated&&Eo(v.stateNode.containerInfo);return;case 12:return;case 13:fe(v);return;case 19:fe(v);return;case 17:return}throw Error(p(163))}switch(v.tag){case 0:case 11:case 14:case 15:m(3,v,v.return),a(3,v),m(5,v,v.return);return;case 12:return;case 13:fe(v);return;case 19:fe(v);return;case 3:Br&&_!==null&&_.memoizedState.isDehydrated&&Eo(v.stateNode.containerInfo);break;case 22:case 23:return}e:if(kn){switch(v.tag){case 1:case 5:case 6:break e;case 3:case 4:v=v.stateNode,qe(v.containerInfo,v.pendingChildren);break e}throw Error(p(163))}}function fe(_){var v=_.updateQueue;if(v!==null){_.updateQueue=null;var L=_.stateNode;L===null&&(L=_.stateNode=new Tp),v.forEach(function(F){var K=ay.bind(null,_,F);L.has(F)||(L.add(F),F.then(K,K))})}}function _e(_,v){for(cn=v;cn!==null;){v=cn;var L=v.deletions;if(L!==null)for(var F=0;F<L.length;F++){var K=L[F];try{var re=_;li?ne(re,K,v):w(re,K,v);var Ie=K.alternate;Ie!==null&&(Ie.return=null),K.return=null}catch(Mn){Ui(K,v,Mn)}}if(L=v.child,v.subtreeFlags&12854&&L!==null)L.return=v,cn=L;else for(;cn!==null;){v=cn;try{var Ze=v.flags;if(Ze&32&&li&&Vt(v.stateNode),Ze&512){var vt=v.alternate;if(vt!==null){var Nt=vt.ref;Nt!==null&&(typeof Nt=="function"?Nt(null):Nt.current=null)}}if(Ze&8192)switch(v.tag){case 13:if(v.memoizedState!==null){var vn=v.alternate;(vn===null||vn.memoizedState===null)&&(Mo=dr())}break;case 22:var lr=v.memoizedState!==null,Dn=v.alternate,Kr=Dn!==null&&Dn.memoizedState!==null;if(L=v,li){e:if(F=L,K=lr,re=null,li)for(var pn=F;;){if(pn.tag===5){if(re===null){re=pn;var Po=pn.stateNode;K?In(Po):Ae(pn.stateNode,pn.memoizedProps)}}else if(pn.tag===6){if(re===null){var Ei=pn.stateNode;K?ir(Ei):se(Ei,pn.memoizedProps)}}else if((pn.tag!==22&&pn.tag!==23||pn.memoizedState===null||pn===F)&&pn.child!==null){pn.child.return=pn,pn=pn.child;continue}if(pn===F)break;for(;pn.sibling===null;){if(pn.return===null||pn.return===F)break e;re===pn&&(re=null),pn=pn.return}re===pn&&(re=null),pn.sibling.return=pn.return,pn=pn.sibling}}if(lr&&!Kr&&L.mode&1){cn=L;for(var lt=L.child;lt!==null;){for(L=cn=lt;cn!==null;){F=cn;var Ye=F.child;switch(F.tag){case 0:case 11:case 14:case 15:m(4,F,F.return);break;case 1:nu(F,F.return);var ut=F.stateNode;if(typeof ut.componentWillUnmount=="function"){var dn=F.return;try{ut.props=F.memoizedProps,ut.state=F.memoizedState,ut.componentWillUnmount()}catch(Mn){Ui(F,dn,Mn)}}break;case 5:nu(F,F.return);break;case 22:if(F.memoizedState!==null){pe(L);continue}}Ye!==null?(Ye.return=F,cn=Ye):pe(L)}lt=lt.sibling}}}switch(Ze&4102){case 2:G(v),v.flags&=-3;break;case 6:G(v),v.flags&=-3,he(v.alternate,v);break;case 4096:v.flags&=-4097;break;case 4100:v.flags&=-4097,he(v.alternate,v);break;case 4:he(v.alternate,v)}}catch(Mn){Ui(v,v.return,Mn)}if(L=v.sibling,L!==null){L.return=v.return,cn=L;break}cn=v.return}}}function ge(_,v,L){cn=_,ye(_)}function ye(_,v,L){for(var F=(_.mode&1)!==0;cn!==null;){var K=cn,re=K.child;if(K.tag===22&&F){var Ie=K.memoizedState!==null||Hu;if(!Ie){var Ze=K.alternate,vt=Ze!==null&&Ze.memoizedState!==null||Xl;Ze=Hu;var Nt=Xl;if(Hu=Ie,(Xl=vt)&&!Nt)for(cn=K;cn!==null;)Ie=cn,vt=Ie.child,Ie.tag===22&&Ie.memoizedState!==null?we(K):vt!==null?(vt.return=Ie,cn=vt):we(K);for(;re!==null;)cn=re,ye(re),re=re.sibling;cn=K,Hu=Ze,Xl=Nt}ie(_)}else K.subtreeFlags&8772&&re!==null?(re.return=K,cn=re):ie(_)}}function ie(_){for(;cn!==null;){var v=cn;if(v.flags&8772){var L=v.alternate;try{if(v.flags&8772)switch(v.tag){case 0:case 11:case 15:Xl||a(5,v);break;case 1:var F=v.stateNode;if(v.flags&4&&!Xl)if(L===null)F.componentDidMount();else{var K=v.elementType===v.type?L.memoizedProps:ts(v.type,L.memoizedProps);F.componentDidUpdate(K,L.memoizedState,F.__reactInternalSnapshotBeforeUpdate)}var re=v.updateQueue;re!==null&&Os(v,re,F);break;case 3:var Ie=v.updateQueue;if(Ie!==null){if(L=null,v.child!==null)switch(v.child.tag){case 5:L=Gt(v.child.stateNode);break;case 1:L=v.child.stateNode}Os(v,Ie,L)}break;case 5:var Ze=v.stateNode;L===null&&v.flags&4&&no(Ze,v.type,v.memoizedProps,v);break;case 6:break;case 4:break;case 12:break;case 13:if(Br&&v.memoizedState===null){var vt=v.alternate;if(vt!==null){var Nt=vt.memoizedState;if(Nt!==null){var vn=Nt.dehydrated;vn!==null&&Nl(vn)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(p(163))}Xl||v.flags&512&&h(v)}catch(lr){Ui(v,v.return,lr)}}if(v===_){cn=null;break}if(L=v.sibling,L!==null){L.return=v.return,cn=L;break}cn=v.return}}function pe(_){for(;cn!==null;){var v=cn;if(v===_){cn=null;break}var L=v.sibling;if(L!==null){L.return=v.return,cn=L;break}cn=v.return}}function we(_){for(;cn!==null;){var v=cn;try{switch(v.tag){case 0:case 11:case 15:var L=v.return;try{a(4,v)}catch(vt){Ui(v,L,vt)}break;case 1:var F=v.stateNode;if(typeof F.componentDidMount=="function"){var K=v.return;try{F.componentDidMount()}catch(vt){Ui(v,K,vt)}}var re=v.return;try{h(v)}catch(vt){Ui(v,re,vt)}break;case 5:var Ie=v.return;try{h(v)}catch(vt){Ui(v,Ie,vt)}}}catch(vt){Ui(v,v.return,vt)}if(v===_){cn=null;break}var Ze=v.sibling;if(Ze!==null){Ze.return=v.return,cn=Ze;break}cn=v.return}}var Ee=0,ke=1,Ue=2,Fe=3,He=4;if(typeof Symbol=="function"&&Symbol.for){var $e=Symbol.for;Ee=$e("selector.component"),ke=$e("selector.has_pseudo_class"),Ue=$e("selector.role"),Fe=$e("selector.test_id"),He=$e("selector.text")}function it(_){var v=ci(_);if(v!=null){if(typeof v.memoizedProps["data-testname"]!="string")throw Error(p(364));return v}if(_=xo(_),_===null)throw Error(p(362));return _.stateNode.current}function Pt(_,v){switch(v.$$typeof){case Ee:if(_.type===v.value)return!0;break;case ke:e:{v=v.value,_=[_,0];for(var L=0;L<_.length;){var F=_[L++],K=_[L++],re=v[K];if(F.tag!==5||!xn(F)){for(;re!=null&&Pt(F,re);)K++,re=v[K];if(K===v.length){v=!0;break e}else for(F=F.child;F!==null;)_.push(F,K),F=F.sibling}}v=!1}return v;case Ue:if(_.tag===5&&$r(_.stateNode,v.value))return!0;break;case He:if((_.tag===5||_.tag===6)&&(_=an(_),_!==null&&0<=_.indexOf(v.value)))return!0;break;case Fe:if(_.tag===5&&(_=_.memoizedProps["data-testname"],typeof _=="string"&&_.toLowerCase()===v.value.toLowerCase()))return!0;break;default:throw Error(p(365))}return!1}function Qe(_){switch(_.$$typeof){case Ee:return"<"+(be(_.value)||"Unknown")+">";case ke:return":has("+(Qe(_)||"")+")";case Ue:return'[role="'+_.value+'"]';case He:return'"'+_.value+'"';case Fe:return'[data-testname="'+_.value+'"]';default:throw Error(p(365))}}function gt(_,v){var L=[];_=[_,0];for(var F=0;F<_.length;){var K=_[F++],re=_[F++],Ie=v[re];if(K.tag!==5||!xn(K)){for(;Ie!=null&&Pt(K,Ie);)re++,Ie=v[re];if(re===v.length)L.push(K);else for(K=K.child;K!==null;)_.push(K,re),K=K.sibling}}return L}function st(_,v){if(!Tr)throw Error(p(363));_=it(_),_=gt(_,v),v=[],_=Array.from(_);for(var L=0;L<_.length;){var F=_[L++];if(F.tag===5)xn(F)||v.push(F.stateNode);else for(F=F.child;F!==null;)_.push(F),F=F.sibling}return v}var Lt=Math.ceil,tt=b.ReactCurrentDispatcher,mt=b.ReactCurrentOwner,xt=b.ReactCurrentBatchConfig,at=0,Et=null,rn=null,fn=0,qt=0,gn=hi(0),An=0,Nn=null,un=0,xr=0,Or=0,Cr=null,or=null,Mo=0,to=1/0;function Vo(){to=dr()+500}var js=!1,ti=null,_r=null,mr=!1,ni=null,Io=0,jr=0,ls=null,Tc=-1,ol=0;function lo(){return at&6?dr():Tc!==-1?Tc:Tc=dr()}function cs(_){return _.mode&1?at&2&&fn!==0?fn&-fn:Du.transition!==null?(ol===0&&(_=ce,ce<<=1,!(ce&4194240)&&(ce=64),ol=_),ol):(_=Sn,_!==0?_:wn()):1}function co(_,v,L){if(50<jr)throw jr=0,ls=null,Error(p(185));var F=sl(_,v);return F===null?null:(Yt(F,v,L),(!(at&2)||F!==Et)&&(F===Et&&(!(at&2)&&(xr|=v),An===4&&ou(F,fn)),$o(F,L),v===1&&at===0&&!(_.mode&1)&&(Vo(),Ga&&Xs())),F)}function sl(_,v){_.lanes|=v;var L=_.alternate;for(L!==null&&(L.lanes|=v),L=_,_=_.return;_!==null;)_.childLanes|=v,L=_.alternate,L!==null&&(L.childLanes|=v),L=_,_=_.return;return L.tag===3?L.stateNode:null}function $o(_,v){var L=_.callbackNode;It(_,v);var F=De(_,_===Et?fn:0);if(F===0)L!==null&&yt(L),_.callbackNode=null,_.callbackPriority=0;else if(v=F&-F,_.callbackPriority!==v){if(L!=null&&yt(L),v===1)_.tag===0?Vc(Kd.bind(null,_)):Zs(Kd.bind(null,_)),Bs?Do(function(){at===0&&Xs()}):Wr(gr,Xs),L=null;else{switch(jn(F)){case 1:L=gr;break;case 4:L=Qo;break;case 16:L=Gc;break;case 536870912:L=Fr;break;default:L=Gc}L=Qm(L,iu.bind(null,_))}_.callbackPriority=v,_.callbackNode=L}}function iu(_,v){if(Tc=-1,ol=0,at&6)throw Error(p(327));var L=_.callbackNode;if(al()&&_.callbackNode!==L)return null;var F=De(_,_===Et?fn:0);if(F===0)return null;if(F&30||F&_.expiredLanes||v)v=ad(_,F);else{v=F;var K=at;at|=2;var re=ql();(Et!==_||fn!==v)&&(Vo(),Sc(_,v));do try{sy();break}catch(Ze){sd(_,Ze)}while(!0);xl(),tt.current=re,at=K,rn!==null?v=0:(Et=null,fn=0,v=An)}if(v!==0){if(v===2&&(K=Ft(_),K!==0&&(F=K,v=Zu(_,K))),v===1)throw L=Nn,Sc(_,0),ou(_,F),$o(_,dr()),L;if(v===6)ou(_,F);else{if(K=_.current.alternate,!(F&30)&&!Xm(K)&&(v=ad(_,F),v===2&&(re=Ft(_),re!==0&&(F=re,v=Zu(_,re))),v===1))throw L=Nn,Sc(_,0),ou(_,F),$o(_,dr()),L;switch(_.finishedWork=K,_.finishedLanes=F,v){case 0:case 1:throw Error(p(345));case 2:Mc(_,or);break;case 3:if(ou(_,F),(F&130023424)===F&&(v=Mo+500-dr(),10<v)){if(De(_,0)!==0)break;if(K=_.suspendedLanes,(K&F)!==F){lo(),_.pingedLanes|=_.suspendedLanes&K;break}_.timeoutHandle=Vr(Mc.bind(null,_,or),v);break}Mc(_,or);break;case 4:if(ou(_,F),(F&4194240)===F)break;for(v=_.eventTimes,K=-1;0<F;){var Ie=31-wi(F);re=1<<Ie,Ie=v[Ie],Ie>K&&(K=Ie),F&=~re}if(F=K,F=dr()-F,F=(120>F?120:480>F?480:1080>F?1080:1920>F?1920:3e3>F?3e3:4320>F?4320:1960*Lt(F/1960))-F,10<F){_.timeoutHandle=Vr(Mc.bind(null,_,or),F);break}Mc(_,or);break;case 5:Mc(_,or);break;default:throw Error(p(329))}}}return $o(_,dr()),_.callbackNode===L?iu.bind(null,_):null}function Zu(_,v){var L=Cr;return _.current.memoizedState.isDehydrated&&(Sc(_,v).flags|=256),_=ad(_,v),_!==2&&(v=or,or=L,v!==null&&qd(v)),_}function qd(_){or===null?or=_:or.push.apply(or,_)}function Xm(_){for(var v=_;;){if(v.flags&16384){var L=v.updateQueue;if(L!==null&&(L=L.stores,L!==null))for(var F=0;F<L.length;F++){var K=L[F],re=K.getSnapshot;K=K.value;try{if(!Xr(re(),K))return!1}catch{return!1}}}if(L=v.child,v.subtreeFlags&16384&&L!==null)L.return=v,v=L;else{if(v===_)break;for(;v.sibling===null;){if(v.return===null||v.return===_)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function ou(_,v){for(v&=~Or,v&=~xr,_.suspendedLanes|=v,_.pingedLanes&=~v,_=_.expirationTimes;0<v;){var L=31-wi(v),F=1<<L;_[L]=-1,v&=~F}}function Kd(_){if(at&6)throw Error(p(327));al();var v=De(_,0);if(!(v&1))return $o(_,dr()),null;var L=ad(_,v);if(_.tag!==0&&L===2){var F=Ft(_);F!==0&&(v=F,L=Zu(_,F))}if(L===1)throw L=Nn,Sc(_,0),ou(_,v),$o(_,dr()),L;if(L===6)throw Error(p(345));return _.finishedWork=_.current.alternate,_.finishedLanes=v,Mc(_,or),$o(_,dr()),null}function od(_){ni!==null&&ni.tag===0&&!(at&6)&&al();var v=at;at|=1;var L=xt.transition,F=Sn;try{if(xt.transition=null,Sn=1,_)return _()}finally{Sn=F,xt.transition=L,at=v,!(at&6)&&Xs()}}function Jd(){qt=gn.current,wr(gn)}function Sc(_,v){_.finishedWork=null,_.finishedLanes=0;var L=_.timeoutHandle;if(L!==kr&&(_.timeoutHandle=kr,Jr(L)),rn!==null)for(L=rn.return;L!==null;){var F=L;switch($c(F),F.tag){case 1:F=F.type.childContextTypes,F!=null&&vl();break;case 3:Er(),wr(Sr),wr(hr),vi();break;case 5:ei(F);break;case 4:Er();break;case 13:wr(Qn);break;case 19:wr(Qn);break;case 10:Va(F.type._context);break;case 22:case 23:Jd()}L=L.return}if(Et=_,rn=_=au(_.current,null),fn=qt=v,An=0,Nn=null,Or=xr=un=0,or=Cr=null,jo!==null){for(v=0;v<jo.length;v++)if(L=jo[v],F=L.interleaved,F!==null){L.interleaved=null;var K=F.next,re=L.pending;if(re!==null){var Ie=re.next;re.next=K,F.next=Ie}L.pending=F}jo=null}return _}function sd(_,v){do{var L=rn;try{if(xl(),ss.current=Ec,ba){for(var F=Rr.memoizedState;F!==null;){var K=F.queue;K!==null&&(K.pending=null),F=F.next}ba=!1}if(ji=0,Di=Ri=Rr=null,na=!1,wa=0,mt.current=null,L===null||L.return===null){An=1,Nn=v,rn=null;break}e:{var re=_,Ie=L.return,Ze=L,vt=v;if(v=fn,Ze.flags|=32768,vt!==null&&typeof vt=="object"&&typeof vt.then=="function"){var Nt=vt,vn=Ze,lr=vn.tag;if(!(vn.mode&1)&&(lr===0||lr===11||lr===15)){var Dn=vn.alternate;Dn?(vn.updateQueue=Dn.updateQueue,vn.memoizedState=Dn.memoizedState,vn.lanes=Dn.lanes):(vn.updateQueue=null,vn.memoizedState=null)}var Kr=bh(Ie);if(Kr!==null){Kr.flags&=-257,Gu(Kr,Ie,Ze,re,v),Kr.mode&1&&xh(re,Nt,v),v=Kr,vt=Nt;var pn=v.updateQueue;if(pn===null){var Po=new Set;Po.add(vt),v.updateQueue=Po}else pn.add(vt);break e}else{if(!(v&1)){xh(re,Nt,v),Sh();break e}vt=Error(p(426))}}else if(Qr&&Ze.mode&1){var Ei=bh(Ie);if(Ei!==null){!(Ei.flags&65536)&&(Ei.flags|=256),Gu(Ei,Ie,Ze,re,v),El(vt);break e}}re=vt,An!==4&&(An=2),Cr===null?Cr=[re]:Cr.push(re),vt=Nu(vt,Ze),Ze=Ie;do{switch(Ze.tag){case 3:Ze.flags|=65536,v&=-v,Ze.lanes|=v;var lt=Cc(Ze,vt,v);Ou(Ze,lt);break e;case 1:re=vt;var Ye=Ze.type,ut=Ze.stateNode;if(!(Ze.flags&128)&&(typeof Ye.getDerivedStateFromError=="function"||ut!==null&&typeof ut.componentDidCatch=="function"&&(_r===null||!_r.has(ut)))){Ze.flags|=65536,v&=-v,Ze.lanes|=v;var dn=vh(Ze,re,v);Ou(Ze,dn);break e}}Ze=Ze.return}while(Ze!==null)}Jm(L)}catch(Mn){v=Mn,rn===L&&L!==null&&(rn=L=L.return);continue}break}while(!0)}function ql(){var _=tt.current;return tt.current=Ec,_===null?Ec:_}function Sh(){(An===0||An===3||An===2)&&(An=4),Et===null||!(un&268435455)&&!(xr&268435455)||ou(Et,fn)}function ad(_,v){var L=at;at|=2;var F=ql();Et===_&&fn===v||Sc(_,v);do try{qm();break}catch(K){sd(_,K)}while(!0);if(xl(),at=L,tt.current=F,rn!==null)throw Error(p(261));return Et=null,fn=0,An}function qm(){for(;rn!==null;)Km(rn)}function sy(){for(;rn!==null&&!en();)Km(rn)}function Km(_){var v=Ym(_.alternate,_,qt);_.memoizedProps=_.pendingProps,v===null?Jm(_):rn=v,mt.current=null}function Jm(_){var v=_;do{var L=v.alternate;if(_=v.return,v.flags&32768){if(L=id(L,v),L!==null){L.flags&=32767,rn=L;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{An=6,rn=null;return}}else if(L=Ap(L,v,qt),L!==null){rn=L;return}if(v=v.sibling,v!==null){rn=v;return}rn=v=_}while(v!==null);An===0&&(An=5)}function Mc(_,v){var L=Sn,F=xt.transition;try{xt.transition=null,Sn=1,ld(_,v,L)}finally{xt.transition=F,Sn=L}return null}function ld(_,v,L){do al();while(ni!==null);if(at&6)throw Error(p(327));var F=_.finishedWork,K=_.finishedLanes;if(F===null)return null;if(_.finishedWork=null,_.finishedLanes=0,F===_.current)throw Error(p(177));_.callbackNode=null,_.callbackPriority=0;var re=F.lanes|F.childLanes;if(Wt(_,re),_===Et&&(rn=Et=null,fn=0),!(F.subtreeFlags&2064)&&!(F.flags&2064)||mr||(mr=!0,Qm(Gc,function(){return al(),null})),re=(F.flags&15990)!==0,F.subtreeFlags&15990||re){re=xt.transition,xt.transition=null;var Ie=Sn;Sn=1;var Ze=at;at|=4,mt.current=null,ru(_,F),_e(_,F),$t(_.containerInfo),_.current=F,ge(F),Mr(),at=Ze,Sn=Ie,xt.transition=re}else _.current=F;if(mr&&(mr=!1,ni=_,Io=K),re=_.pendingLanes,re===0&&(_r=null),Rs(F.stateNode),$o(_,dr()),v!==null)for(L=_.onRecoverableError,F=0;F<v.length;F++)L(v[F]);if(js)throw js=!1,_=ti,ti=null,_;return Io&1&&_.tag!==0&&al(),re=_.pendingLanes,re&1?_===ls?jr++:(jr=0,ls=_):jr=0,Xs(),null}function al(){if(ni!==null){var _=jn(Io),v=xt.transition,L=Sn;try{if(xt.transition=null,Sn=16>_?16:_,ni===null)var F=!1;else{if(_=ni,ni=null,Io=0,at&6)throw Error(p(331));var K=at;for(at|=4,cn=_.current;cn!==null;){var re=cn,Ie=re.child;if(cn.flags&16){var Ze=re.deletions;if(Ze!==null){for(var vt=0;vt<Ze.length;vt++){var Nt=Ze[vt];for(cn=Nt;cn!==null;){var vn=cn;switch(vn.tag){case 0:case 11:case 15:m(8,vn,re)}var lr=vn.child;if(lr!==null)lr.return=vn,cn=lr;else for(;cn!==null;){vn=cn;var Dn=vn.sibling,Kr=vn.return;if(S(vn),vn===Nt){cn=null;break}if(Dn!==null){Dn.return=Kr,cn=Dn;break}cn=Kr}}}var pn=re.alternate;if(pn!==null){var Po=pn.child;if(Po!==null){pn.child=null;do{var Ei=Po.sibling;Po.sibling=null,Po=Ei}while(Po!==null)}}cn=re}}if(re.subtreeFlags&2064&&Ie!==null)Ie.return=re,cn=Ie;else e:for(;cn!==null;){if(re=cn,re.flags&2048)switch(re.tag){case 0:case 11:case 15:m(9,re,re.return)}var lt=re.sibling;if(lt!==null){lt.return=re.return,cn=lt;break e}cn=re.return}}var Ye=_.current;for(cn=Ye;cn!==null;){Ie=cn;var ut=Ie.child;if(Ie.subtreeFlags&2064&&ut!==null)ut.return=Ie,cn=ut;else e:for(Ie=Ye;cn!==null;){if(Ze=cn,Ze.flags&2048)try{switch(Ze.tag){case 0:case 11:case 15:a(9,Ze)}}catch(Mn){Ui(Ze,Ze.return,Mn)}if(Ze===Ie){cn=null;break e}var dn=Ze.sibling;if(dn!==null){dn.return=Ze.return,cn=dn;break e}cn=Ze.return}}if(at=K,Xs(),es&&typeof es.onPostCommitFiberRoot=="function")try{es.onPostCommitFiberRoot(Zr,_)}catch{}F=!0}return F}finally{Sn=L,xt.transition=v}}return!1}function Kl(_,v,L){v=Nu(L,v),v=Cc(_,v,1),Js(_,v),v=lo(),_=sl(_,1),_!==null&&(Yt(_,1,v),$o(_,v))}function Ui(_,v,L){if(_.tag===3)Kl(_,_,L);else for(;v!==null;){if(v.tag===3){Kl(v,_,L);break}else if(v.tag===1){var F=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof F.componentDidCatch=="function"&&(_r===null||!_r.has(F))){_=Nu(L,_),_=vh(v,_,1),Js(v,_),_=lo(),v=sl(v,1),v!==null&&(Yt(v,1,_),$o(v,_));break}}v=v.return}}function su(_,v,L){var F=_.pingCache;F!==null&&F.delete(v),v=lo(),_.pingedLanes|=_.suspendedLanes&L,Et===_&&(fn&L)===L&&(An===4||An===3&&(fn&130023424)===fn&&500>dr()-Mo?Sc(_,0):Or|=L),$o(_,v)}function Ic(_,v){v===0&&(_.mode&1?(v=Se,Se<<=1,!(Se&130023424)&&(Se=4194304)):v=1);var L=lo();_=sl(_,v),_!==null&&(Yt(_,v,L),$o(_,L))}function Xu(_){var v=_.memoizedState,L=0;v!==null&&(L=v.retryLane),Ic(_,L)}function ay(_,v){var L=0;switch(_.tag){case 13:var F=_.stateNode,K=_.memoizedState;K!==null&&(L=K.retryLane);break;case 19:F=_.stateNode;break;default:throw Error(p(314))}F!==null&&F.delete(v),Ic(_,L)}var Ym;Ym=function(_,v,L){if(_!==null)if(_.memoizedProps!==v.pendingProps||Sr.current)_s=!0;else{if(!(_.lanes&L)&&!(v.flags&128))return _s=!1,Xd(_,v,L);_s=!!(_.flags&131072)}else _s=!1,Qr&&v.flags&1048576&&ks(v,ya,v.index);switch(v.lanes=0,v.tag){case 2:var F=v.type;_!==null&&(_.alternate=null,v.alternate=null,v.flags|=2),_=v.pendingProps;var K=zo(v,hr.current);_a(v,L),K=cr(null,v,F,_,K,L);var re=Ea();return v.flags|=1,typeof K=="object"&&K!==null&&typeof K.render=="function"&&K.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,ro(F)?(re=!0,Xn(v)):re=!1,v.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,fr(v),K.updater=rs,v.stateNode=K,K._reactInternals=v,wl(v,F,_,L),v=wh(null,v,F,!0,re,L)):(v.tag=0,Qr&&re&&va(v),as(null,v,K,L),v=v.child),v;case 16:F=v.elementType;e:{switch(_!==null&&(_.alternate=null,v.alternate=null,v.flags|=2),_=v.pendingProps,K=F._init,F=K(F._payload),v.type=F,K=v.tag=Ml(F),_=ts(F,_),K){case 0:v=rd(null,v,F,_,L);break e;case 1:v=zs(null,v,F,_,L);break e;case 11:v=td(null,v,F,_,L);break e;case 14:v=Go(null,v,F,ts(F.type,_),L);break e}throw Error(p(306,F,""))}return v;case 0:return F=v.type,K=v.pendingProps,K=v.elementType===F?K:ts(F,K),rd(_,v,F,K,L);case 1:return F=v.type,K=v.pendingProps,K=v.elementType===F?K:ts(F,K),zs(_,v,F,K,L);case 3:e:{if(Zd(v),_===null)throw Error(p(387));F=v.pendingProps,re=v.memoizedState,K=re.element,mh(_,v),$a(v,F,null,L);var Ie=v.memoizedState;if(F=Ie.element,Br&&re.isDehydrated)if(re={element:F,isDehydrated:!1,cache:Ie.cache,transitions:Ie.transitions},v.updateQueue.baseState=re,v.memoizedState=re,v.flags&256){K=Error(p(423)),v=ia(_,v,F,L,K);break e}else if(F!==K){K=Error(p(424)),v=ia(_,v,F,L,K);break e}else for(Br&&(ms=Yr(v.stateNode.containerInfo),is=v,Qr=!0,os=null,qa=!1),L=Cl(v,null,F,L),v.child=L;L;)L.flags=L.flags&-3|4096,L=L.sibling;else{if(xa(),F===K){v=Sl(_,v,L);break e}as(_,v,F,L)}v=v.child}return v;case 5:return pr(v),_===null&&Qs(v),F=v.type,K=v.pendingProps,re=_!==null?_.memoizedProps:null,Ie=K.children,rr(F,K)?Ie=null:re!==null&&rr(F,re)&&(v.flags|=32),Wd(_,v),as(_,v,Ie,L),v.child;case 6:return _===null&&Qs(v),null;case 13:return $u(_,v,L);case 4:return Cn(v,v.stateNode.containerInfo),F=v.pendingProps,_===null?v.child=ta(v,null,F,L):as(_,v,F,L),v.child;case 11:return F=v.type,K=v.pendingProps,K=v.elementType===F?K:ts(F,K),td(_,v,F,K,L);case 7:return as(_,v,v.pendingProps,L),v.child;case 8:return as(_,v,v.pendingProps.children,L),v.child;case 12:return as(_,v,v.pendingProps.children,L),v.child;case 10:e:{if(F=v.type._context,K=v.pendingProps,re=v.memoizedProps,Ie=K.value,Co(v,F,Ie),re!==null)if(Xr(re.value,Ie)){if(re.children===K.children&&!Sr.current){v=Sl(_,v,L);break e}}else for(re=v.child,re!==null&&(re.return=v);re!==null;){var Ze=re.dependencies;if(Ze!==null){Ie=re.child;for(var vt=Ze.firstContext;vt!==null;){if(vt.context===F){if(re.tag===1){vt=io(-1,L&-L),vt.tag=2;var Nt=re.updateQueue;if(Nt!==null){Nt=Nt.shared;var vn=Nt.pending;vn===null?vt.next=vt:(vt.next=vn.next,vn.next=vt),Nt.pending=vt}}re.lanes|=L,vt=re.alternate,vt!==null&&(vt.lanes|=L),vc(re.return,L,v),Ze.lanes|=L;break}vt=vt.next}}else if(re.tag===10)Ie=re.type===v.type?null:re.child;else if(re.tag===18){if(Ie=re.return,Ie===null)throw Error(p(341));Ie.lanes|=L,Ze=Ie.alternate,Ze!==null&&(Ze.lanes|=L),vc(Ie,L,v),Ie=re.sibling}else Ie=re.child;if(Ie!==null)Ie.return=re;else for(Ie=re;Ie!==null;){if(Ie===v){Ie=null;break}if(re=Ie.sibling,re!==null){re.return=Ie.return,Ie=re;break}Ie=Ie.return}re=Ie}as(_,v,K.children,L),v=v.child}return v;case 9:return K=v.type,F=v.pendingProps.children,_a(v,L),K=Fo(K),F=F(K),v.flags|=1,as(_,v,F,L),v.child;case 14:return F=v.type,K=ts(F,v.pendingProps),K=ts(F.type,K),Go(_,v,F,K,L);case 15:return Hd(_,v,v.type,v.pendingProps,L);case 17:return F=v.type,K=v.pendingProps,K=v.elementType===F?K:ts(F,K),_!==null&&(_.alternate=null,v.alternate=null,v.flags|=2),v.tag=1,ro(F)?(_=!0,Xn(v)):_=!1,_a(v,L),xc(v,F,K),wl(v,F,K,L),wh(null,v,F,!0,_,L);case 19:return Ah(_,v,L);case 22:return nd(_,v,L)}throw Error(p(156,v.tag))};function Qm(_,v){return Wr(_,v)}function ly(_,v,L,F){this.tag=_,this.key=L,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=F,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ma(_,v,L,F){return new ly(_,v,L,F)}function Yd(_){return _=_.prototype,!(!_||!_.isReactComponent)}function Ml(_){if(typeof _=="function")return Yd(_)?1:0;if(_!=null){if(_=_.$$typeof,_===U)return 11;if(_===X)return 14}return 2}function au(_,v){var L=_.alternate;return L===null?(L=Ma(_.tag,v,_.key,_.mode),L.elementType=_.elementType,L.type=_.type,L.stateNode=_.stateNode,L.alternate=_,_.alternate=L):(L.pendingProps=v,L.type=_.type,L.flags=0,L.subtreeFlags=0,L.deletions=null),L.flags=_.flags&14680064,L.childLanes=_.childLanes,L.lanes=_.lanes,L.child=_.child,L.memoizedProps=_.memoizedProps,L.memoizedState=_.memoizedState,L.updateQueue=_.updateQueue,v=_.dependencies,L.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},L.sibling=_.sibling,L.index=_.index,L.ref=_.ref,L}function Qd(_,v,L,F,K,re){var Ie=2;if(F=_,typeof _=="function")Yd(_)&&(Ie=1);else if(typeof _=="string")Ie=5;else e:switch(_){case T:return fi(L.children,K,re,v);case A:Ie=8,K|=8;break;case I:return _=Ma(12,L,v,K|2),_.elementType=I,_.lanes=re,_;case N:return _=Ma(13,L,v,K),_.elementType=N,_.lanes=re,_;case V:return _=Ma(19,L,v,K),_.elementType=V,_.lanes=re,_;case te:return _n(L,K,re,v);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case O:Ie=10;break e;case z:Ie=9;break e;case U:Ie=11;break e;case X:Ie=14;break e;case J:Ie=16,F=null;break e}throw Error(p(130,_==null?_:typeof _,""))}return v=Ma(Ie,L,v,K),v.elementType=_,v.type=F,v.lanes=re,v}function fi(_,v,L,F){return _=Ma(7,_,F,v),_.lanes=L,_}function _n(_,v,L,F){return _=Ma(22,_,F,v),_.elementType=te,_.lanes=L,_.stateNode={},_}function Jl(_,v,L){return _=Ma(6,_,null,v),_.lanes=L,_}function Mh(_,v,L){return v=Ma(4,_.children!==null?_.children:[],_.key,v),v.lanes=L,v.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},v}function oa(_,v,L,F,K){this.tag=v,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=kr,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Jt(0),this.expirationTimes=Jt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jt(0),this.identifierPrefix=F,this.onRecoverableError=K,Br&&(this.mutableSourceEagerHydrationData=null)}function Sp(_,v,L,F,K,re,Ie,Ze,vt){return _=new oa(_,v,L,Ze,vt),v===1?(v=1,re===!0&&(v|=8)):v=0,re=Ma(3,null,null,v),_.current=re,re.stateNode=_,re.memoizedState={element:F,isDehydrated:L,cache:null,transitions:null},fr(re),_}function Mp(_){if(!_)return Si;_=_._reactInternals;e:{if(je(_)!==_||_.tag!==1)throw Error(p(170));var v=_;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(ro(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(p(171))}if(_.tag===1){var L=_.type;if(ro(L))return Ht(_,L,v)}return v}function ll(_){var v=_._reactInternals;if(v===void 0)throw typeof _.render=="function"?Error(p(188)):(_=Object.keys(_).join(","),Error(p(268,_)));return _=ht(v),_===null?null:_.stateNode}function ef(_,v){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var L=_.retryLane;_.retryLane=L!==0&&L<v?L:v}}function Pc(_,v){ef(_,v),(_=_.alternate)&&ef(_,v)}function cd(_){return _=ht(_),_===null?null:_.stateNode}function qu(){return null}return r.attemptContinuousHydration=function(_){if(_.tag===13){var v=lo();co(_,134217728,v),Pc(_,134217728)}},r.attemptHydrationAtCurrentPriority=function(_){if(_.tag===13){var v=lo(),L=cs(_);co(_,L,v),Pc(_,L)}},r.attemptSynchronousHydration=function(_){switch(_.tag){case 3:var v=_.stateNode;if(v.current.memoizedState.isDehydrated){var L=ze(v.pendingLanes);L!==0&&(Rn(v,L|1),$o(v,dr()),!(at&6)&&(Vo(),Xs()))}break;case 13:var F=lo();od(function(){return co(_,1,F)}),Pc(_,1)}},r.batchedUpdates=function(_,v){var L=at;at|=1;try{return _(v)}finally{at=L,at===0&&(Vo(),Ga&&Xs())}},r.createComponentSelector=function(_){return{$$typeof:Ee,value:_}},r.createContainer=function(_,v,L,F,K,re,Ie){return Sp(_,v,!1,null,L,F,K,re,Ie)},r.createHasPseudoClassSelector=function(_){return{$$typeof:ke,value:_}},r.createHydrationContainer=function(_,v,L,F,K,re,Ie,Ze,vt){return _=Sp(L,F,!0,_,K,re,Ie,Ze,vt),_.context=Mp(null),L=_.current,F=lo(),K=cs(L),re=io(F,K),re.callback=v??null,Js(L,re),_.current.lanes=K,Yt(_,K,F),$o(_,F),_},r.createPortal=function(_,v,L){var F=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:E,key:F==null?null:""+F,children:_,containerInfo:v,implementation:L}},r.createRoleSelector=function(_){return{$$typeof:Ue,value:_}},r.createTestNameSelector=function(_){return{$$typeof:Fe,value:_}},r.createTextSelector=function(_){return{$$typeof:He,value:_}},r.deferredUpdates=function(_){var v=Sn,L=xt.transition;try{return xt.transition=null,Sn=16,_()}finally{Sn=v,xt.transition=L}},r.discreteUpdates=function(_,v,L,F,K){var re=Sn,Ie=xt.transition;try{return xt.transition=null,Sn=1,_(v,L,F,K)}finally{Sn=re,xt.transition=Ie,at===0&&Vo()}},r.findAllNodes=st,r.findBoundingRects=function(_,v){if(!Tr)throw Error(p(363));v=st(_,v),_=[];for(var L=0;L<v.length;L++)_.push(bs(v[L]));for(v=_.length-1;0<v;v--){L=_[v];for(var F=L.x,K=F+L.width,re=L.y,Ie=re+L.height,Ze=v-1;0<=Ze;Ze--)if(v!==Ze){var vt=_[Ze],Nt=vt.x,vn=Nt+vt.width,lr=vt.y,Dn=lr+vt.height;if(F>=Nt&&re>=lr&&K<=vn&&Ie<=Dn){_.splice(v,1);break}else if(F!==Nt||L.width!==vt.width||Dn<re||lr>Ie){if(!(re!==lr||L.height!==vt.height||vn<F||Nt>K)){Nt>F&&(vt.width+=Nt-F,vt.x=F),vn<K&&(vt.width=K-Nt),_.splice(v,1);break}}else{lr>re&&(vt.height+=lr-re,vt.y=re),Dn<Ie&&(vt.height=Ie-lr),_.splice(v,1);break}}}return _},r.findHostInstance=ll,r.findHostInstanceWithNoPortals=function(_){return _=Ne(_),_=_!==null?Bt(_):null,_===null?null:_.stateNode},r.findHostInstanceWithWarning=function(_){return ll(_)},r.flushControlled=function(_){var v=at;at|=1;var L=xt.transition,F=Sn;try{xt.transition=null,Sn=1,_()}finally{Sn=F,xt.transition=L,at=v,at===0&&(Vo(),Xs())}},r.flushPassiveEffects=al,r.flushSync=od,r.focusWithin=function(_,v){if(!Tr)throw Error(p(363));for(_=it(_),v=gt(_,v),v=Array.from(v),_=0;_<v.length;){var L=v[_++];if(!xn(L)){if(L.tag===5&&Hr(L.stateNode))return!0;for(L=L.child;L!==null;)v.push(L),L=L.sibling}}return!1},r.getCurrentUpdatePriority=function(){return Sn},r.getFindAllNodesFailureDescription=function(_,v){if(!Tr)throw Error(p(363));var L=0,F=[];_=[it(_),0];for(var K=0;K<_.length;){var re=_[K++],Ie=_[K++],Ze=v[Ie];if((re.tag!==5||!xn(re))&&(Pt(re,Ze)&&(F.push(Qe(Ze)),Ie++,Ie>L&&(L=Ie)),Ie<v.length))for(re=re.child;re!==null;)_.push(re,Ie),re=re.sibling}if(L<v.length){for(_=[];L<v.length;L++)_.push(Qe(v[L]));return`findAllNodes was able to match part of the selector:
  `+(F.join(" > ")+`

No matching component was found for:
  `)+_.join(" > ")}return null},r.getPublicRootInstance=function(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return Gt(_.child.stateNode);default:return _.child.stateNode}},r.injectIntoDevTools=function(_){if(_={bundleType:_.bundleType,version:_.version,rendererPackageName:_.rendererPackageName,rendererConfig:_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:cd,findFiberByHostInstance:_.findFiberByHostInstance||qu,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")_=!1;else{var v=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(v.isDisabled||!v.supportsFiber)_=!0;else{try{Zr=v.inject(_),es=v}catch{}_=!!v.checkDCE}}return _},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(_,v,L,F){if(!Tr)throw Error(p(363));_=st(_,v);var K=Bi(_,L,F).disconnect;return{disconnect:function(){K()}}},r.registerMutableSourceForHydration=function(_,v){var L=v._getVersion;L=L(v._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[v,L]:_.mutableSourceEagerHydrationData.push(v,L)},r.runWithPriority=function(_,v){var L=Sn;try{return Sn=_,v()}finally{Sn=L}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(_,v,L,F){var K=v.current,re=lo(),Ie=cs(K);return L=Mp(L),v.context===null?v.context=L:v.pendingContext=L,v=io(re,Ie),v.payload={element:_},F=F===void 0?null:F,F!==null&&(v.callback=F),Js(K,v),_=co(K,Ie,re),_!==null&&Vl(_,K,Ie),Ie},r};RS.exports=vk;var xk=RS.exports;const bk=F_(xk),wk=n=>typeof n=="object"&&typeof n.then=="function",Ad=[];function kS(n,t,r=(l,u)=>l===u){if(n===t)return!0;if(!n||!t)return!1;const l=n.length;if(t.length!==l)return!1;for(let u=0;u<l;u++)if(!r(n[u],t[u]))return!1;return!0}function zS(n,t=null,r=!1,l={}){t===null&&(t=[n]);for(const d of Ad)if(kS(t,d.keys,d.equal)){if(r)return;if(Object.prototype.hasOwnProperty.call(d,"error"))throw d.error;if(Object.prototype.hasOwnProperty.call(d,"response"))return l.lifespan&&l.lifespan>0&&(d.timeout&&clearTimeout(d.timeout),d.timeout=setTimeout(d.remove,l.lifespan)),d.response;if(!r)throw d.promise}const u={keys:t,equal:l.equal,remove:()=>{const d=Ad.indexOf(u);d!==-1&&Ad.splice(d,1)},promise:(wk(n)?n:n(...t)).then(d=>{u.response=d,l.lifespan&&l.lifespan>0&&(u.timeout=setTimeout(u.remove,l.lifespan))}).catch(d=>u.error=d)};if(Ad.push(u),!r)throw u.promise}const Dv=(n,t,r)=>zS(n,t,!1,r),Ek=(n,t,r)=>void zS(n,t,!0,r),Ck=n=>{if(n===void 0||n.length===0)Ad.splice(0,Ad.length);else{const t=Ad.find(r=>kS(n,r.keys,r.equal));t&&t.remove()}},H1={},jm=n=>void Object.assign(H1,n);function Ak(n,t){function r(T,{args:A=[],attach:I,...O},z){let U=`${T[0].toUpperCase()}${T.slice(1)}`,N;if(T==="primitive"){if(O.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const V=O.object;N=Ff(V,{type:T,root:z,attach:I,primitive:!0})}else{const V=H1[U];if(!V)throw new Error(`R3F: ${U} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(A))throw new Error("R3F: The args prop must be an array!");N=Ff(new V(...A),{type:T,root:z,attach:I,memoizedProps:{args:A}})}return N.__r3f.attach===void 0&&(N instanceof _l?N.__r3f.attach="geometry":N instanceof Wf&&(N.__r3f.attach="material")),U!=="inject"&&w0(N,O),N}function l(T,A){let I=!1;if(A){var O,z;(O=A.__r3f)!=null&&O.attach?b0(T,A,A.__r3f.attach):A.isObject3D&&T.isObject3D&&(T.add(A),I=!0),I||(z=T.__r3f)==null||z.objects.push(A),A.__r3f||Ff(A,{}),A.__r3f.parent=T,kv(A),jf(A)}}function u(T,A,I){let O=!1;if(A){var z,U;if((z=A.__r3f)!=null&&z.attach)b0(T,A,A.__r3f.attach);else if(A.isObject3D&&T.isObject3D){A.parent=T,A.dispatchEvent({type:"added"}),T.dispatchEvent({type:"childadded",child:A});const N=T.children.filter(X=>X!==A),V=N.indexOf(I);T.children=[...N.slice(0,V),A,...N.slice(V)],O=!0}O||(U=T.__r3f)==null||U.objects.push(A),A.__r3f||Ff(A,{}),A.__r3f.parent=T,kv(A),jf(A)}}function d(T,A,I=!1){T&&[...T].forEach(O=>p(A,O,I))}function p(T,A,I){if(A){var O,z,U;if(A.__r3f&&(A.__r3f.parent=null),(O=T.__r3f)!=null&&O.objects&&(T.__r3f.objects=T.__r3f.objects.filter(te=>te!==A)),(z=A.__r3f)!=null&&z.attach)yE(T,A,A.__r3f.attach);else if(A.isObject3D&&T.isObject3D){var N;T.remove(A),(N=A.__r3f)!=null&&N.root&&Rk(l_(A),A)}const X=(U=A.__r3f)==null?void 0:U.primitive,J=!X&&(I===void 0?A.dispose!==null:I);if(!X){var V;d((V=A.__r3f)==null?void 0:V.objects,A,J),d(A.children,A,J)}if(delete A.__r3f,J&&A.dispose&&A.type!=="Scene"){const te=()=>{try{A.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Rv.unstable_scheduleCallback(Rv.unstable_IdlePriority,te):te()}jf(T)}}function b(T,A,I,O){var z;const U=(z=T.__r3f)==null?void 0:z.parent;if(!U)return;const N=r(A,I,T.__r3f.root);if(T.children){for(const V of T.children)V.__r3f&&l(N,V);T.children=T.children.filter(V=>!V.__r3f)}T.__r3f.objects.forEach(V=>l(N,V)),T.__r3f.objects=[],T.__r3f.autoRemovedBeforeAppend||p(U,T),N.parent&&(N.__r3f.autoRemovedBeforeAppend=!0),l(U,N),N.raycast&&N.__r3f.eventCount&&l_(N).getState().internal.interaction.push(N),[O,O.alternate].forEach(V=>{V!==null&&(V.stateNode=N,V.ref&&(typeof V.ref=="function"?V.ref(N):V.ref.current=N))})}const i=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:bk({createInstance:r,removeChild:p,appendChild:l,appendInitialChild:l,insertBefore:u,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(T,A)=>{if(!A)return;const I=T.getState().scene;I.__r3f&&(I.__r3f.root=T,l(I,A))},removeChildFromContainer:(T,A)=>{A&&p(T.getState().scene,A)},insertInContainerBefore:(T,A,I)=>{if(!A||!I)return;const O=T.getState().scene;O.__r3f&&u(O,A,I)},getRootHostContext:()=>null,getChildHostContext:T=>T,finalizeInitialChildren(T){var A;return!!((A=T==null?void 0:T.__r3f)!=null?A:{}).handlers},prepareUpdate(T,A,I,O){var z;if(((z=T==null?void 0:T.__r3f)!=null?z:{}).primitive&&O.object&&O.object!==T)return[!0];{const{args:N=[],children:V,...X}=O,{args:J=[],children:te,...ue}=I;if(!Array.isArray(N))throw new Error("R3F: the args prop must be an array!");if(N.some((be,Ce)=>be!==J[Ce]))return[!0];const ae=$S(T,X,ue,!0);return ae.changes.length?[!1,ae]:null}},commitUpdate(T,[A,I],O,z,U,N){A?b(T,O,U,N):w0(T,I)},commitMount(T,A,I,O){var z;const U=(z=T.__r3f)!=null?z:{};T.raycast&&U.handlers&&U.eventCount&&l_(T).getState().internal.interaction.push(T)},getPublicInstance:T=>T,prepareForCommit:()=>null,preparePortalMount:T=>Ff(T.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(T){var A;const{attach:I,parent:O}=(A=T.__r3f)!=null?A:{};I&&O&&yE(O,T,I),T.isObject3D&&(T.visible=!1),jf(T)},unhideInstance(T,A){var I;const{attach:O,parent:z}=(I=T.__r3f)!=null?I:{};O&&z&&b0(z,T,O),(T.isObject3D&&A.visible==null||A.visible)&&(T.visible=!0),jf(T)},createTextInstance:i,hideTextInstance:i,unhideTextInstance:i,getCurrentEventPriority:()=>t?t():Vf.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&$i.fun(performance.now)?performance.now:$i.fun(Date.now)?Date.now:()=>0,scheduleTimeout:$i.fun(setTimeout)?setTimeout:void 0,cancelTimeout:$i.fun(clearTimeout)?clearTimeout:void 0}),applyProps:w0}}var pE,mE;const x0=n=>"colorSpace"in n||"outputColorSpace"in n,FS=()=>{var n;return(n=H1.ColorManagement)!=null?n:null},jS=n=>n&&n.isOrthographicCamera,Tk=n=>n&&n.hasOwnProperty("current"),Um=typeof window<"u"&&((pE=window.document)!=null&&pE.createElement||((mE=window.navigator)==null?void 0:mE.product)==="ReactNative")?k.useLayoutEffect:k.useEffect;function US(n){const t=k.useRef(n);return Um(()=>void(t.current=n),[n]),t}function Sk({set:n}){return Um(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}class NS extends k.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}NS.getDerivedStateFromError=()=>({error:!0});const GS="__default",gE=new Map,Mk=n=>n&&!!n.memoized&&!!n.changes;function VS(n){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],r),n[1]):n}const rm=n=>{var t;return(t=n.__r3f)==null?void 0:t.root.getState()};function l_(n){let t=n.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const $i={obj:n=>n===Object(n)&&!$i.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,t,{arrays:r="shallow",objects:l="reference",strict:u=!0}={}){if(typeof n!=typeof t||!!n!=!!t)return!1;if($i.str(n)||$i.num(n)||$i.boo(n))return n===t;const d=$i.obj(n);if(d&&l==="reference")return n===t;const p=$i.arr(n);if(p&&r==="reference")return n===t;if((p||d)&&n===t)return!0;let b;for(b in n)if(!(b in t))return!1;if(d&&r==="shallow"&&l==="shallow"){for(b in u?t:n)if(!$i.equ(n[b],t[b],{strict:u,objects:"reference"}))return!1}else for(b in u?t:n)if(n[b]!==t[b])return!1;if($i.und(b)){if(p&&n.length===0&&t.length===0||d&&Object.keys(n).length===0&&Object.keys(t).length===0)return!0;if(n!==t)return!1}return!0}};function Ik(n){const t={nodes:{},materials:{}};return n&&n.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Pk(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const t in n)t.dispose==null||t.dispose(),delete n[t]}function Ff(n,t){const r=n;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},n}function Ov(n,t){let r=n;if(t.includes("-")){const l=t.split("-"),u=l.pop();return r=l.reduce((d,p)=>d[p],n),{target:r,key:u}}else return{target:r,key:t}}const _E=/-\d+$/;function b0(n,t,r){if($i.str(r)){if(_E.test(r)){const d=r.replace(_E,""),{target:p,key:b}=Ov(n,d);Array.isArray(p[b])||(p[b]=[])}const{target:l,key:u}=Ov(n,r);t.__r3f.previousAttach=l[u],l[u]=t}else t.__r3f.previousAttach=r(n,t)}function yE(n,t,r){var l,u;if($i.str(r)){const{target:d,key:p}=Ov(n,r),b=t.__r3f.previousAttach;b===void 0?delete d[p]:d[p]=b}else(l=t.__r3f)==null||l.previousAttach==null||l.previousAttach(n,t);(u=t.__r3f)==null||delete u.previousAttach}function $S(n,{children:t,key:r,ref:l,...u},{children:d,key:p,ref:b,...i}={},E=!1){const T=n.__r3f,A=Object.entries(u),I=[];if(E){const z=Object.keys(i);for(let U=0;U<z.length;U++)u.hasOwnProperty(z[U])||A.unshift([z[U],GS+"remove"])}A.forEach(([z,U])=>{var N;if((N=n.__r3f)!=null&&N.primitive&&z==="object"||$i.equ(U,i[z]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(z))return I.push([z,U,!0,[]]);let V=[];z.includes("-")&&(V=z.split("-")),I.push([z,U,!1,V]);for(const X in u){const J=u[X];X.startsWith(`${z}-`)&&I.push([X,J,!1,X.split("-")])}});const O={...u};return T!=null&&T.memoizedProps&&T!=null&&T.memoizedProps.args&&(O.args=T.memoizedProps.args),T!=null&&T.memoizedProps&&T!=null&&T.memoizedProps.attach&&(O.attach=T.memoizedProps.attach),{memoized:O,changes:I}}const Lk=typeof process<"u"&&!1;function w0(n,t){var r;const l=n.__r3f,u=l==null?void 0:l.root,d=u==null||u.getState==null?void 0:u.getState(),{memoized:p,changes:b}=Mk(t)?t:$S(n,t),i=l==null?void 0:l.eventCount;n.__r3f&&(n.__r3f.memoizedProps=p);for(let T=0;T<b.length;T++){let[A,I,O,z]=b[T];if(x0(n)){const X="srgb",J="srgb-linear";A==="encoding"?(A="colorSpace",I=I===3001?X:J):A==="outputEncoding"&&(A="outputColorSpace",I=I===3001?X:J)}let U=n,N=U[A];if(z.length&&(N=z.reduce((V,X)=>V[X],n),!(N&&N.set))){const[V,...X]=z.reverse();U=X.reverse().reduce((J,te)=>J[te],n),A=V}if(I===GS+"remove")if(U.constructor){let V=gE.get(U.constructor);V||(V=new U.constructor,gE.set(U.constructor,V)),I=V[A]}else I=0;if(O&&l)I?l.handlers[A]=I:delete l.handlers[A],l.eventCount=Object.keys(l.handlers).length;else if(N&&N.set&&(N.copy||N instanceof h0)){if(Array.isArray(I))N.fromArray?N.fromArray(I):N.set(...I);else if(N.copy&&I&&I.constructor&&(Lk?N.constructor.name===I.constructor.name:N.constructor===I.constructor))N.copy(I);else if(I!==void 0){const V=N instanceof Ai;!V&&N.setScalar?N.setScalar(I):N instanceof h0&&I instanceof h0?N.mask=I.mask:N.set(I),!FS()&&d&&!d.linear&&V&&N.convertSRGBToLinear()}}else if(U[A]=I,U[A]instanceof Cm&&U[A].format===FB&&U[A].type===jB&&d){const V=U[A];x0(V)&&x0(d.gl)?V.colorSpace=d.gl.outputColorSpace:V.encoding=d.gl.outputEncoding}jf(n)}if(l&&l.parent&&n.raycast&&i!==l.eventCount){const T=l_(n).getState().internal,A=T.interaction.indexOf(n);A>-1&&T.interaction.splice(A,1),l.eventCount&&T.interaction.push(n)}return!(b.length===1&&b[0][0]==="onUpdate")&&b.length&&(r=n.__r3f)!=null&&r.parent&&kv(n),n}function jf(n){var t,r;const l=(t=n.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();l&&l.internal.frames===0&&l.invalidate()}function kv(n){n.onUpdate==null||n.onUpdate(n)}function HS(n,t){n.manual||(jS(n)?(n.left=t.width/-2,n.right=t.width/2,n.top=t.height/2,n.bottom=t.height/-2):n.aspect=t.width/t.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function Og(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function Bk(){var n;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return Vf.DefaultEventPriority;switch((n=t.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Vf.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Vf.ContinuousEventPriority;default:return Vf.DefaultEventPriority}}function WS(n,t,r,l){const u=r.get(t);u&&(r.delete(t),r.size===0&&(n.delete(l),u.target.releasePointerCapture(l)))}function Rk(n,t){const{internal:r}=n.getState();r.interaction=r.interaction.filter(l=>l!==t),r.initialHits=r.initialHits.filter(l=>l!==t),r.hovered.forEach((l,u)=>{(l.eventObject===t||l.object===t)&&r.hovered.delete(u)}),r.capturedMap.forEach((l,u)=>{WS(r.capturedMap,t,l,u)})}function Dk(n){function t(i){const{internal:E}=n.getState(),T=i.offsetX-E.initialClick[0],A=i.offsetY-E.initialClick[1];return Math.round(Math.sqrt(T*T+A*A))}function r(i){return i.filter(E=>["Move","Over","Enter","Out","Leave"].some(T=>{var A;return(A=E.__r3f)==null?void 0:A.handlers["onPointer"+T]}))}function l(i,E){const T=n.getState(),A=new Set,I=[],O=E?E(T.internal.interaction):T.internal.interaction;for(let V=0;V<O.length;V++){const X=rm(O[V]);X&&(X.raycaster.camera=void 0)}T.previousRoot||T.events.compute==null||T.events.compute(i,T);function z(V){const X=rm(V);if(!X||!X.events.enabled||X.raycaster.camera===null)return[];if(X.raycaster.camera===void 0){var J;X.events.compute==null||X.events.compute(i,X,(J=X.previousRoot)==null?void 0:J.getState()),X.raycaster.camera===void 0&&(X.raycaster.camera=null)}return X.raycaster.camera?X.raycaster.intersectObject(V,!0):[]}let U=O.flatMap(z).sort((V,X)=>{const J=rm(V.object),te=rm(X.object);return!J||!te?V.distance-X.distance:te.events.priority-J.events.priority||V.distance-X.distance}).filter(V=>{const X=Og(V);return A.has(X)?!1:(A.add(X),!0)});T.events.filter&&(U=T.events.filter(U,T));for(const V of U){let X=V.object;for(;X;){var N;(N=X.__r3f)!=null&&N.eventCount&&I.push({...V,eventObject:X}),X=X.parent}}if("pointerId"in i&&T.internal.capturedMap.has(i.pointerId))for(let V of T.internal.capturedMap.get(i.pointerId).values())A.has(Og(V.intersection))||I.push(V.intersection);return I}function u(i,E,T,A){const I=n.getState();if(i.length){const O={stopped:!1};for(const z of i){const U=rm(z.object)||I,{raycaster:N,pointer:V,camera:X,internal:J}=U,te=new Tt(V.x,V.y,0).unproject(X),ue=me=>{var Ne,ht;return(Ne=(ht=J.capturedMap.get(me))==null?void 0:ht.has(z.eventObject))!=null?Ne:!1},ae=me=>{const Ne={intersection:z,target:E.target};J.capturedMap.has(me)?J.capturedMap.get(me).set(z.eventObject,Ne):J.capturedMap.set(me,new Map([[z.eventObject,Ne]])),E.target.setPointerCapture(me)},be=me=>{const Ne=J.capturedMap.get(me);Ne&&WS(J.capturedMap,z.eventObject,Ne,me)};let Ce={};for(let me in E){let Ne=E[me];typeof Ne!="function"&&(Ce[me]=Ne)}let je={...z,...Ce,pointer:V,intersections:i,stopped:O.stopped,delta:T,unprojectedPoint:te,ray:N.ray,camera:X,stopPropagation(){const me="pointerId"in E&&J.capturedMap.get(E.pointerId);if((!me||me.has(z.eventObject))&&(je.stopped=O.stopped=!0,J.hovered.size&&Array.from(J.hovered.values()).find(Ne=>Ne.eventObject===z.eventObject))){const Ne=i.slice(0,i.indexOf(z));d([...Ne,z])}},target:{hasPointerCapture:ue,setPointerCapture:ae,releasePointerCapture:be},currentTarget:{hasPointerCapture:ue,setPointerCapture:ae,releasePointerCapture:be},nativeEvent:E};if(A(je),O.stopped===!0)break}}return i}function d(i){const{internal:E}=n.getState();for(const T of E.hovered.values())if(!i.length||!i.find(A=>A.object===T.object&&A.index===T.index&&A.instanceId===T.instanceId)){const I=T.eventObject.__r3f,O=I==null?void 0:I.handlers;if(E.hovered.delete(Og(T)),I!=null&&I.eventCount){const z={...T,intersections:i};O.onPointerOut==null||O.onPointerOut(z),O.onPointerLeave==null||O.onPointerLeave(z)}}}function p(i,E){for(let T=0;T<E.length;T++){const A=E[T].__r3f;A==null||A.handlers.onPointerMissed==null||A.handlers.onPointerMissed(i)}}function b(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>d([]);case"onLostPointerCapture":return E=>{const{internal:T}=n.getState();"pointerId"in E&&T.capturedMap.has(E.pointerId)&&requestAnimationFrame(()=>{T.capturedMap.has(E.pointerId)&&(T.capturedMap.delete(E.pointerId),d([]))})}}return function(T){const{onPointerMissed:A,internal:I}=n.getState();I.lastEvent.current=T;const O=i==="onPointerMove",z=i==="onClick"||i==="onContextMenu"||i==="onDoubleClick",N=l(T,O?r:void 0),V=z?t(T):0;i==="onPointerDown"&&(I.initialClick=[T.offsetX,T.offsetY],I.initialHits=N.map(J=>J.eventObject)),z&&!N.length&&V<=2&&(p(T,I.interaction),A&&A(T)),O&&d(N);function X(J){const te=J.eventObject,ue=te.__r3f,ae=ue==null?void 0:ue.handlers;if(ue!=null&&ue.eventCount)if(O){if(ae.onPointerOver||ae.onPointerEnter||ae.onPointerOut||ae.onPointerLeave){const be=Og(J),Ce=I.hovered.get(be);Ce?Ce.stopped&&J.stopPropagation():(I.hovered.set(be,J),ae.onPointerOver==null||ae.onPointerOver(J),ae.onPointerEnter==null||ae.onPointerEnter(J))}ae.onPointerMove==null||ae.onPointerMove(J)}else{const be=ae[i];be?(!z||I.initialHits.includes(te))&&(p(T,I.interaction.filter(Ce=>!I.initialHits.includes(Ce))),be(J)):z&&I.initialHits.includes(te)&&p(T,I.interaction.filter(Ce=>!I.initialHits.includes(Ce)))}}u(N,T,V,X)}}return{handlePointer:b}}const Ok=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],ZS=n=>!!(n!=null&&n.render),W1=k.createContext(null),kk=(n,t)=>{const r=$1((b,i)=>{const E=new Tt,T=new Tt,A=new Tt;function I(V=i().camera,X=T,J=i().size){const{width:te,height:ue,top:ae,left:be}=J,Ce=te/ue;X instanceof Tt?A.copy(X):A.set(...X);const je=V.getWorldPosition(E).distanceTo(A);if(jS(V))return{width:te/V.zoom,height:ue/V.zoom,top:ae,left:be,factor:1,distance:je,aspect:Ce};{const me=V.fov*Math.PI/180,Ne=2*Math.tan(me/2)*je,ht=Ne*(te/ue);return{width:ht,height:Ne,top:ae,left:be,factor:te/ht,distance:je,aspect:Ce}}}let O;const z=V=>b(X=>({performance:{...X.performance,current:V}})),U=new Zo;return{set:b,get:i,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(V=1)=>n(i(),V),advance:(V,X)=>t(V,X,i()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ZB,pointer:U,mouse:U,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const V=i();O&&clearTimeout(O),V.performance.current!==V.performance.min&&z(V.performance.min),O=setTimeout(()=>z(i().performance.max),V.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:I},setEvents:V=>b(X=>({...X,events:{...X.events,...V}})),setSize:(V,X,J,te,ue)=>{const ae=i().camera,be={width:V,height:X,top:te||0,left:ue||0,updateStyle:J};b(Ce=>({size:be,viewport:{...Ce.viewport,...I(ae,T,be)}}))},setDpr:V=>b(X=>{const J=VS(V);return{viewport:{...X.viewport,dpr:J,initialDpr:X.viewport.initialDpr||J}}}),setFrameloop:(V="always")=>{const X=i().clock;X.stop(),X.elapsedTime=0,V!=="never"&&(X.start(),X.elapsedTime=0),b(()=>({frameloop:V}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:k.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(V,X,J)=>{const te=i().internal;return te.priority=te.priority+(X>0?1:0),te.subscribers.push({ref:V,priority:X,store:J}),te.subscribers=te.subscribers.sort((ue,ae)=>ue.priority-ae.priority),()=>{const ue=i().internal;ue!=null&&ue.subscribers&&(ue.priority=ue.priority-(X>0?1:0),ue.subscribers=ue.subscribers.filter(ae=>ae.ref!==V))}}}}}),l=r.getState();let u=l.size,d=l.viewport.dpr,p=l.camera;return r.subscribe(()=>{const{camera:b,size:i,viewport:E,gl:T,set:A}=r.getState();if(i.width!==u.width||i.height!==u.height||E.dpr!==d){var I;u=i,d=E.dpr,HS(b,i),T.setPixelRatio(E.dpr);const O=(I=i.updateStyle)!=null?I:typeof HTMLCanvasElement<"u"&&T.domElement instanceof HTMLCanvasElement;T.setSize(i.width,i.height,O)}b!==p&&(p=b,A(O=>({viewport:{...O.viewport,...O.viewport.getCurrentViewport(b)}})))}),r.subscribe(b=>n(b)),r};function Z1(n,t){const r={callback:n};return t.add(r),()=>void t.delete(r)}let kg,XS=new Set,qS=new Set,KS=new Set;const zk=n=>Z1(n,XS),Fk=n=>Z1(n,qS),jk=n=>Z1(n,KS);function E0(n,t){if(n.size)for(const{callback:r}of n.values())r(t)}function im(n,t){switch(n){case"before":return E0(XS,t);case"after":return E0(qS,t);case"tail":return E0(KS,t)}}let C0,A0;function T0(n,t,r){let l=t.clock.getDelta();for(t.frameloop==="never"&&typeof n=="number"&&(l=n-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=n),C0=t.internal.subscribers,kg=0;kg<C0.length;kg++)A0=C0[kg],A0.ref.current(A0.store.getState(),l,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Uk(n){let t=!1,r=!1,l,u,d;function p(E){u=requestAnimationFrame(p),t=!0,l=0,im("before",E),r=!0;for(const A of n.values()){var T;d=A.store.getState(),d.internal.active&&(d.frameloop==="always"||d.internal.frames>0)&&!((T=d.gl.xr)!=null&&T.isPresenting)&&(l+=T0(E,d))}if(r=!1,im("after",E),l===0)return im("tail",E),t=!1,cancelAnimationFrame(u)}function b(E,T=1){var A;if(!E)return n.forEach(I=>b(I.store.getState(),T));(A=E.gl.xr)!=null&&A.isPresenting||!E.internal.active||E.frameloop==="never"||(T>1?E.internal.frames=Math.min(60,E.internal.frames+T):r?E.internal.frames=2:E.internal.frames=1,t||(t=!0,requestAnimationFrame(p)))}function i(E,T=!0,A,I){if(T&&im("before",E),A)T0(E,A,I);else for(const O of n.values())T0(E,O.store.getState());T&&im("after",E)}return{loop:p,invalidate:b,advance:i}}function X1(){const n=k.useContext(W1);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function ar(n=r=>r,t){return X1()(n,t)}function mc(n,t=0){const r=X1(),l=r.getState().internal.subscribe,u=US(n);return Um(()=>l(u,t,r),[t,l,r]),null}const vE=new WeakMap;function JS(n,t){return function(r,...l){let u=vE.get(r);return u||(u=new r,vE.set(r,u)),n&&n(u),Promise.all(l.map(d=>new Promise((p,b)=>u.load(d,i=>{i.scene&&Object.assign(i,Ik(i.scene)),p(i)},t,i=>b(new Error(`Could not load ${d}: ${i==null?void 0:i.message}`))))))}}function ka(n,t,r,l){const u=Array.isArray(t)?t:[t],d=Dv(JS(r,l),[n,...u],{equal:$i.equ});return Array.isArray(t)?d:d[0]}ka.preload=function(n,t,r){const l=Array.isArray(t)?t:[t];return Ek(JS(r),[n,...l])};ka.clear=function(n,t){const r=Array.isArray(t)?t:[t];return Ck([n,...r])};const ip=new Map,{invalidate:xE,advance:bE}=Uk(ip),{reconciler:Lm,applyProps:Af}=Ak(ip,Bk),Tf={objects:"shallow",strict:!1},Nk=(n,t)=>{const r=typeof n=="function"?n(t):n;return ZS(r)?r:new GB({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...n})};function Gk(n,t){const r=typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement;if(t){const{width:l,height:u,top:d,left:p,updateStyle:b=r}=t;return{width:l,height:u,top:d,left:p,updateStyle:b}}else if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:l,height:u,top:d,left:p}=n.parentElement.getBoundingClientRect();return{width:l,height:u,top:d,left:p,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Vk(n){const t=ip.get(n),r=t==null?void 0:t.fiber,l=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const u=typeof reportError=="function"?reportError:console.error,d=l||kk(xE,bE),p=r||Lm.createContainer(d,Vf.ConcurrentRoot,null,!1,null,"",u,null);t||ip.set(n,{fiber:p,store:d});let b,i=!1,E;return{configure(T={}){let{gl:A,size:I,scene:O,events:z,onCreated:U,shadows:N=!1,linear:V=!1,flat:X=!1,legacy:J=!1,orthographic:te=!1,frameloop:ue="always",dpr:ae=[1,2],performance:be,raycaster:Ce,camera:je,onPointerMissed:me}=T,Ne=d.getState(),ht=Ne.gl;Ne.gl||Ne.set({gl:ht=Nk(A,n)});let _t=Ne.raycaster;_t||Ne.set({raycaster:_t=new y1});const{params:Bt,...Kt}=Ce||{};if($i.equ(Kt,_t,Tf)||Af(_t,{...Kt}),$i.equ(Bt,_t.params,Tf)||Af(_t,{params:{..._t.params,...Bt}}),!Ne.camera||Ne.camera===E&&!$i.equ(E,je,Tf)){E=je;const $t=je instanceof VB,Zt=$t?je:te?new wd(0,0,0,0,.1,1e3):new Ed(75,0,.1,1e3);$t||(Zt.position.z=5,je&&(Af(Zt,je),("aspect"in je||"left"in je||"right"in je||"bottom"in je||"top"in je)&&(Zt.manual=!0,Zt.updateProjectionMatrix())),!Ne.camera&&!(je!=null&&je.rotation)&&Zt.lookAt(0,0,0)),Ne.set({camera:Zt}),_t.camera=Zt}if(!Ne.scene){let $t;O instanceof Am?$t=O:($t=new Am,O&&Af($t,O)),Ne.set({scene:Ff($t)})}if(!Ne.xr){var Gt;const $t=(yn,On)=>{const rr=d.getState();rr.frameloop!=="never"&&bE(yn,!0,rr,On)},Zt=()=>{const yn=d.getState();yn.gl.xr.enabled=yn.gl.xr.isPresenting,yn.gl.xr.setAnimationLoop(yn.gl.xr.isPresenting?$t:null),yn.gl.xr.isPresenting||xE(yn)},mn={connect(){const yn=d.getState().gl;yn.xr.addEventListener("sessionstart",Zt),yn.xr.addEventListener("sessionend",Zt)},disconnect(){const yn=d.getState().gl;yn.xr.removeEventListener("sessionstart",Zt),yn.xr.removeEventListener("sessionend",Zt)}};typeof((Gt=ht.xr)==null?void 0:Gt.addEventListener)=="function"&&mn.connect(),Ne.set({xr:mn})}if(ht.shadowMap){const $t=ht.shadowMap.enabled,Zt=ht.shadowMap.type;if(ht.shadowMap.enabled=!!N,$i.boo(N))ht.shadowMap.type=d0;else if($i.str(N)){var hn;const mn={basic:$B,percentage:HB,soft:d0,variance:WB};ht.shadowMap.type=(hn=mn[N])!=null?hn:d0}else $i.obj(N)&&Object.assign(ht.shadowMap,N);($t!==ht.shadowMap.enabled||Zt!==ht.shadowMap.type)&&(ht.shadowMap.needsUpdate=!0)}const wt=FS();wt&&("enabled"in wt?wt.enabled=!J:"legacyMode"in wt&&(wt.legacyMode=J)),i||Af(ht,{outputEncoding:V?3e3:3001,toneMapping:X?UB:NB}),Ne.legacy!==J&&Ne.set(()=>({legacy:J})),Ne.linear!==V&&Ne.set(()=>({linear:V})),Ne.flat!==X&&Ne.set(()=>({flat:X})),A&&!$i.fun(A)&&!ZS(A)&&!$i.equ(A,ht,Tf)&&Af(ht,A),z&&!Ne.events.handlers&&Ne.set({events:z(d)});const bt=Gk(n,I);return $i.equ(bt,Ne.size,Tf)||Ne.setSize(bt.width,bt.height,bt.updateStyle,bt.top,bt.left),ae&&Ne.viewport.dpr!==VS(ae)&&Ne.setDpr(ae),Ne.frameloop!==ue&&Ne.setFrameloop(ue),Ne.onPointerMissed||Ne.set({onPointerMissed:me}),be&&!$i.equ(be,Ne.performance,Tf)&&Ne.set($t=>({performance:{...$t.performance,...be}})),b=U,i=!0,this},render(T){return i||this.configure(),Lm.updateContainer(Q.jsx($k,{store:d,children:T,onCreated:b,rootElement:n}),p,null,()=>{}),d},unmount(){YS(n)}}}function $k({store:n,children:t,onCreated:r,rootElement:l}){return Um(()=>{const u=n.getState();u.set(d=>({internal:{...d.internal,active:!0}})),r&&r(u),n.getState().events.connected||u.events.connect==null||u.events.connect(l)},[]),Q.jsx(W1.Provider,{value:n,children:t})}function YS(n,t){const r=ip.get(n),l=r==null?void 0:r.fiber;if(l){const u=r==null?void 0:r.store.getState();u&&(u.internal.active=!1),Lm.updateContainer(null,l,null,()=>{u&&setTimeout(()=>{try{var d,p,b,i;u.events.disconnect==null||u.events.disconnect(),(d=u.gl)==null||(p=d.renderLists)==null||p.dispose==null||p.dispose(),(b=u.gl)==null||b.forceContextLoss==null||b.forceContextLoss(),(i=u.gl)!=null&&i.xr&&u.xr.disconnect(),Pk(u),ip.delete(n)}catch{}},500)})}}function Hk(n,t,r){return Q.jsx(Wk,{children:n,container:t,state:r},t.uuid)}function Wk({state:n={},children:t,container:r}){const{events:l,size:u,...d}=n,p=X1(),[b]=k.useState(()=>new y1),[i]=k.useState(()=>new Zo),E=k.useCallback((A,I)=>{const O={...A};Object.keys(A).forEach(U=>{(Ok.includes(U)||A[U]!==I[U]&&I[U])&&delete O[U]});let z;if(I&&u){const U=I.camera;z=A.viewport.getCurrentViewport(U,new Tt,u),U!==A.camera&&HS(U,u)}return{...O,scene:r,raycaster:b,pointer:i,mouse:i,previousRoot:p,events:{...A.events,...I==null?void 0:I.events,...l},size:{...A.size,...u},viewport:{...A.viewport,...z},...d}},[n]),[T]=k.useState(()=>{const A=p.getState();return $1((O,z)=>({...A,scene:r,raycaster:b,pointer:i,mouse:i,previousRoot:p,events:{...A.events,...l},size:{...A.size,...u},...d,set:O,get:z,setEvents:U=>O(N=>({...N,events:{...N.events,...U}}))}))});return k.useEffect(()=>{const A=p.subscribe(I=>T.setState(O=>E(I,O)));return()=>{A()}},[E]),k.useEffect(()=>{T.setState(A=>E(p.getState(),A))},[E]),k.useEffect(()=>()=>{T.destroy()},[]),Q.jsx(Q.Fragment,{children:Lm.createPortal(Q.jsx(W1.Provider,{value:T,children:t}),T,null)})}Lm.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:k.version});var Zk=Object.defineProperty,Xk=Object.defineProperties,qk=Object.getOwnPropertyDescriptors,wE=Object.getOwnPropertySymbols,Kk=Object.prototype.hasOwnProperty,Jk=Object.prototype.propertyIsEnumerable,EE=(n,t,r)=>t in n?Zk(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,CE=(n,t)=>{for(var r in t||(t={}))Kk.call(t,r)&&EE(n,r,t[r]);if(wE)for(var r of wE(t))Jk.call(t,r)&&EE(n,r,t[r]);return n},Yk=(n,t)=>Xk(n,qk(t));function QS(n,t,r){if(!n)return;if(r(n)===!0)return n;let l=n.child;for(;l;){const u=QS(l,t,r);if(u)return u;l=l.sibling}}function eM(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const q1=eM(k.createContext(null));class tM extends k.Component{render(){return k.createElement(q1.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:AE,ReactCurrentDispatcher:TE}=k.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Qk(){const n=k.useContext(q1);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=k.useId();return k.useMemo(()=>{for(const l of[AE==null?void 0:AE.current,n,n==null?void 0:n.alternate]){if(!l)continue;const u=QS(l,!1,d=>{let p=d.memoizedState;for(;p;){if(p.memoizedState===t)return!0;p=p.next}});if(u)return u}},[n,t])}function e5(){var n;const t=Qk(),[r]=k.useState(()=>new Map);r.clear();let l=t;for(;l;){if(l.type&&typeof l.type=="object"){const u="Provider"in l.type?l.type:l.type._context;u&&u!==q1&&!r.has(u)&&r.set(u,(n=TE==null?void 0:TE.current)==null?void 0:n.readContext(eM(u)))}l=l.return}return r}function t5(){const n=e5();return k.useMemo(()=>Array.from(n.keys()).reduce((t,r)=>l=>k.createElement(t,null,k.createElement(r.Provider,Yk(CE({},l),{value:n.get(r)}))),t=>k.createElement(tM,CE({},t))),[n])}const S0={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function n5(n){const{handlePointer:t}=Dk(n);return{priority:1,enabled:!0,compute(r,l,u){l.pointer.set(r.offsetX/l.size.width*2-1,-(r.offsetY/l.size.height)*2+1),l.raycaster.setFromCamera(l.pointer,l.camera)},connected:void 0,handlers:Object.keys(S0).reduce((r,l)=>({...r,[l]:t(l)}),{}),update:()=>{var r;const{events:l,internal:u}=n.getState();(r=u.lastEvent)!=null&&r.current&&l.handlers&&l.handlers.onPointerMove(u.lastEvent.current)},connect:r=>{var l;const{set:u,events:d}=n.getState();d.disconnect==null||d.disconnect(),u(p=>({events:{...p.events,connected:r}})),Object.entries((l=d.handlers)!=null?l:[]).forEach(([p,b])=>{const[i,E]=S0[p];r.addEventListener(i,b,{passive:E})})},disconnect:()=>{const{set:r,events:l}=n.getState();if(l.connected){var u;Object.entries((u=l.handlers)!=null?u:[]).forEach(([d,p])=>{if(l&&l.connected instanceof HTMLElement){const[b]=S0[d];l.connected.removeEventListener(b,p)}}),r(d=>({events:{...d.events,connected:void 0}}))}}}}const r5=k.forwardRef(function({children:t,fallback:r,resize:l,style:u,gl:d,events:p=n5,eventSource:b,eventPrefix:i,shadows:E,linear:T,flat:A,legacy:I,orthographic:O,frameloop:z,dpr:U,performance:N,raycaster:V,camera:X,scene:J,onPointerMissed:te,onCreated:ue,...ae},be){k.useMemo(()=>jm(XB),[]);const Ce=t5(),[je,me]=qB({scroll:!0,debounce:{scroll:50,resize:0},...l}),Ne=k.useRef(null),ht=k.useRef(null);k.useImperativeHandle(be,()=>Ne.current);const _t=US(te),[Bt,Kt]=k.useState(!1),[Gt,hn]=k.useState(!1);if(Bt)throw Bt;if(Gt)throw Gt;const wt=k.useRef(null);Um(()=>{const $t=Ne.current;me.width>0&&me.height>0&&$t&&(wt.current||(wt.current=Vk($t)),wt.current.configure({gl:d,events:p,shadows:E,linear:T,flat:A,legacy:I,orthographic:O,frameloop:z,dpr:U,performance:N,raycaster:V,camera:X,scene:J,size:me,onPointerMissed:(...Zt)=>_t.current==null?void 0:_t.current(...Zt),onCreated:Zt=>{Zt.events.connect==null||Zt.events.connect(b?Tk(b)?b.current:b:ht.current),i&&Zt.setEvents({compute:(mn,yn)=>{const On=mn[i+"X"],rr=mn[i+"Y"];yn.pointer.set(On/yn.size.width*2-1,-(rr/yn.size.height)*2+1),yn.raycaster.setFromCamera(yn.pointer,yn.camera)}}),ue==null||ue(Zt)}}),wt.current.render(Q.jsx(Ce,{children:Q.jsx(NS,{set:hn,children:Q.jsx(k.Suspense,{fallback:Q.jsx(Sk,{set:Kt}),children:t})})})))}),k.useEffect(()=>{const $t=Ne.current;if($t)return()=>YS($t)},[]);const bt=b?"none":"auto";return Q.jsx("div",{ref:ht,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:bt,...u},...ae,children:Q.jsx("div",{ref:je,style:{width:"100%",height:"100%"},children:Q.jsx("canvas",{ref:Ne,style:{display:"block"},children:r})})})}),x_=k.forwardRef(function(t,r){return Q.jsx(tM,{children:Q.jsx(r5,{...t,ref:r})})});function nM(n,t="pointer",r="auto",l=document.body){k.useEffect(()=>{if(n)return l.style.cursor=t,()=>void(l.style.cursor=r)},[n])}const i5=n=>(t,r,l)=>{const u=l.subscribe;return l.subscribe=(p,b,i)=>{let E=p;if(b){const T=(i==null?void 0:i.equalityFn)||Object.is;let A=p(l.getState());E=I=>{const O=p(I);if(!T(A,O)){const z=A;b(A=O,z)}},i!=null&&i.fireImmediately&&b(A,A)}return u(E)},n(t,r,l)};function SE(n,t){if(t===KB)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===_v||t===TT){let r=n.getIndex();if(r===null){const p=[],b=n.getAttribute("position");if(b!==void 0){for(let i=0;i<b.count;i++)p.push(i);n.setIndex(p),r=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const l=r.count-2,u=[];if(r)if(t===_v)for(let p=1;p<=l;p++)u.push(r.getX(0)),u.push(r.getX(p)),u.push(r.getX(p+1));else for(let p=0;p<l;p++)p%2===0?(u.push(r.getX(p)),u.push(r.getX(p+1)),u.push(r.getX(p+2))):(u.push(r.getX(p+2)),u.push(r.getX(p+1)),u.push(r.getX(p)));u.length/3!==l&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const d=n.clone();return d.setIndex(u),d.clearGroups(),d}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}const o5=parseInt(v1.replace(/\D+/g,""));var ac=Uint8Array,Gh=Uint16Array,zv=Uint32Array,rM=new ac([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),iM=new ac([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s5=new ac([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),oM=function(n,t){for(var r=new Gh(31),l=0;l<31;++l)r[l]=t+=1<<n[l-1];for(var u=new zv(r[30]),l=1;l<30;++l)for(var d=r[l];d<r[l+1];++d)u[d]=d-r[l]<<5|l;return[r,u]},sM=oM(rM,2),aM=sM[0],a5=sM[1];aM[28]=258,a5[258]=28;var l5=oM(iM,0),c5=l5[0],Fv=new Gh(32768);for(var Ki=0;Ki<32768;++Ki){var zh=(Ki&43690)>>>1|(Ki&21845)<<1;zh=(zh&52428)>>>2|(zh&13107)<<2,zh=(zh&61680)>>>4|(zh&3855)<<4,Fv[Ki]=((zh&65280)>>>8|(zh&255)<<8)>>>1}var xm=function(n,t,r){for(var l=n.length,u=0,d=new Gh(t);u<l;++u)++d[n[u]-1];var p=new Gh(t);for(u=0;u<t;++u)p[u]=p[u-1]+d[u-1]<<1;var b;if(r){b=new Gh(1<<t);var i=15-t;for(u=0;u<l;++u)if(n[u])for(var E=u<<4|n[u],T=t-n[u],A=p[n[u]-1]++<<T,I=A|(1<<T)-1;A<=I;++A)b[Fv[A]>>>i]=E}else for(b=new Gh(l),u=0;u<l;++u)n[u]&&(b[u]=Fv[p[n[u]-1]++]>>>15-n[u]);return b},Nm=new ac(288);for(var Ki=0;Ki<144;++Ki)Nm[Ki]=8;for(var Ki=144;Ki<256;++Ki)Nm[Ki]=9;for(var Ki=256;Ki<280;++Ki)Nm[Ki]=7;for(var Ki=280;Ki<288;++Ki)Nm[Ki]=8;var lM=new ac(32);for(var Ki=0;Ki<32;++Ki)lM[Ki]=5;var u5=xm(Nm,9,1),h5=xm(lM,5,1),M0=function(n){for(var t=n[0],r=1;r<n.length;++r)n[r]>t&&(t=n[r]);return t},kc=function(n,t,r){var l=t/8|0;return(n[l]|n[l+1]<<8)>>(t&7)&r},I0=function(n,t){var r=t/8|0;return(n[r]|n[r+1]<<8|n[r+2]<<16)>>(t&7)},d5=function(n){return(n/8|0)+(n&7&&1)},f5=function(n,t,r){(r==null||r>n.length)&&(r=n.length);var l=new(n instanceof Gh?Gh:n instanceof zv?zv:ac)(r-t);return l.set(n.subarray(t,r)),l},p5=function(n,t,r){var l=n.length;if(!l||r&&!r.l&&l<5)return t||new ac(0);var u=!t||r,d=!r||r.i;r||(r={}),t||(t=new ac(l*3));var p=function(Yn){var Vr=t.length;if(Yn>Vr){var Jr=new ac(Math.max(Vr*2,Yn));Jr.set(t),t=Jr}},b=r.f||0,i=r.p||0,E=r.b||0,T=r.l,A=r.d,I=r.m,O=r.n,z=l*8;do{if(!T){r.f=b=kc(n,i,1);var U=kc(n,i+1,3);if(i+=3,U)if(U==1)T=u5,A=h5,I=9,O=5;else if(U==2){var J=kc(n,i,31)+257,te=kc(n,i+10,15)+4,ue=J+kc(n,i+5,31)+1;i+=14;for(var ae=new ac(ue),be=new ac(19),Ce=0;Ce<te;++Ce)be[s5[Ce]]=kc(n,i+Ce*3,7);i+=te*3;for(var je=M0(be),me=(1<<je)-1,Ne=xm(be,je,1),Ce=0;Ce<ue;){var ht=Ne[kc(n,i,me)];i+=ht&15;var N=ht>>>4;if(N<16)ae[Ce++]=N;else{var _t=0,Bt=0;for(N==16?(Bt=3+kc(n,i,3),i+=2,_t=ae[Ce-1]):N==17?(Bt=3+kc(n,i,7),i+=3):N==18&&(Bt=11+kc(n,i,127),i+=7);Bt--;)ae[Ce++]=_t}}var Kt=ae.subarray(0,J),Gt=ae.subarray(J);I=M0(Kt),O=M0(Gt),T=xm(Kt,I,1),A=xm(Gt,O,1)}else throw"invalid block type";else{var N=d5(i)+4,V=n[N-4]|n[N-3]<<8,X=N+V;if(X>l){if(d)throw"unexpected EOF";break}u&&p(E+V),t.set(n.subarray(N,X),E),r.b=E+=V,r.p=i=X*8;continue}if(i>z){if(d)throw"unexpected EOF";break}}u&&p(E+131072);for(var hn=(1<<I)-1,wt=(1<<O)-1,bt=i;;bt=i){var _t=T[I0(n,i)&hn],$t=_t>>>4;if(i+=_t&15,i>z){if(d)throw"unexpected EOF";break}if(!_t)throw"invalid length/literal";if($t<256)t[E++]=$t;else if($t==256){bt=i,T=null;break}else{var Zt=$t-254;if($t>264){var Ce=$t-257,mn=rM[Ce];Zt=kc(n,i,(1<<mn)-1)+aM[Ce],i+=mn}var yn=A[I0(n,i)&wt],On=yn>>>4;if(!yn)throw"invalid distance";i+=yn&15;var Gt=c5[On];if(On>3){var mn=iM[On];Gt+=I0(n,i)&(1<<mn)-1,i+=mn}if(i>z){if(d)throw"unexpected EOF";break}u&&p(E+131072);for(var rr=E+Zt;E<rr;E+=4)t[E]=t[E-Gt],t[E+1]=t[E+1-Gt],t[E+2]=t[E+2-Gt],t[E+3]=t[E+3-Gt];E=rr}}r.l=T,r.p=bt,r.b=E,T&&(b=1,r.m=I,r.d=A,r.n=O)}while(!b);return E==t.length?t:f5(t,0,E)},m5=new ac(0),g5=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function _5(n,t){return p5((g5(n),n.subarray(2,-4)),t)}var y5=typeof TextDecoder<"u"&&new TextDecoder,v5=0;try{y5.decode(m5,{stream:!0}),v5=1}catch{}var x5=Object.defineProperty,b5=(n,t,r)=>t in n?x5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,sr=(n,t,r)=>(b5(n,typeof t!="symbol"?t+"":t,r),r);const zg=new JB,ME=new ST,w5=Math.cos(70*(Math.PI/180)),IE=(n,t)=>(n%t+t)%t;let E5=class extends YB{constructor(t,r){super(),sr(this,"object"),sr(this,"domElement"),sr(this,"enabled",!0),sr(this,"target",new Tt),sr(this,"minDistance",0),sr(this,"maxDistance",1/0),sr(this,"minZoom",0),sr(this,"maxZoom",1/0),sr(this,"minPolarAngle",0),sr(this,"maxPolarAngle",Math.PI),sr(this,"minAzimuthAngle",-1/0),sr(this,"maxAzimuthAngle",1/0),sr(this,"enableDamping",!1),sr(this,"dampingFactor",.05),sr(this,"enableZoom",!0),sr(this,"zoomSpeed",1),sr(this,"enableRotate",!0),sr(this,"rotateSpeed",1),sr(this,"enablePan",!0),sr(this,"panSpeed",1),sr(this,"screenSpacePanning",!0),sr(this,"keyPanSpeed",7),sr(this,"zoomToCursor",!1),sr(this,"autoRotate",!1),sr(this,"autoRotateSpeed",2),sr(this,"reverseOrbit",!1),sr(this,"reverseHorizontalOrbit",!1),sr(this,"reverseVerticalOrbit",!1),sr(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),sr(this,"mouseButtons",{LEFT:wf.ROTATE,MIDDLE:wf.DOLLY,RIGHT:wf.PAN}),sr(this,"touches",{ONE:Ef.ROTATE,TWO:Ef.DOLLY_PAN}),sr(this,"target0"),sr(this,"position0"),sr(this,"zoom0"),sr(this,"_domElementKeyEvents",null),sr(this,"getPolarAngle"),sr(this,"getAzimuthalAngle"),sr(this,"setPolarAngle"),sr(this,"setAzimuthalAngle"),sr(this,"getDistance"),sr(this,"listenToKeyEvents"),sr(this,"stopListenToKeyEvents"),sr(this,"saveState"),sr(this,"reset"),sr(this,"update"),sr(this,"connect"),sr(this,"dispose"),this.object=t,this.domElement=r,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>T.phi,this.getAzimuthalAngle=()=>T.theta,this.setPolarAngle=Je=>{let Vt=IE(Je,2*Math.PI),In=T.phi;In<0&&(In+=2*Math.PI),Vt<0&&(Vt+=2*Math.PI);let ir=Math.abs(Vt-In);2*Math.PI-ir<ir&&(Vt<In?Vt+=2*Math.PI:In+=2*Math.PI),A.phi=Vt-In,l.update()},this.setAzimuthalAngle=Je=>{let Vt=IE(Je,2*Math.PI),In=T.theta;In<0&&(In+=2*Math.PI),Vt<0&&(Vt+=2*Math.PI);let ir=Math.abs(Vt-In);2*Math.PI-ir<ir&&(Vt<In?Vt+=2*Math.PI:In+=2*Math.PI),A.theta=Vt-In,l.update()},this.getDistance=()=>l.object.position.distanceTo(l.target),this.listenToKeyEvents=Je=>{Je.addEventListener("keydown",ui),this._domElementKeyEvents=Je},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ui),this._domElementKeyEvents=null},this.saveState=()=>{l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=()=>{l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(u),l.update(),i=b.NONE},this.update=(()=>{const Je=new Tt,Vt=new Tt(0,1,0),In=new kl().setFromUnitVectors(t.up,Vt),ir=In.clone().invert(),Ae=new Tt,se=new kl,le=2*Math.PI;return function(){const Be=l.object.position;In.setFromUnitVectors(t.up,Vt),ir.copy(In).invert(),Je.copy(Be).sub(l.target),Je.applyQuaternion(In),T.setFromVector3(Je),l.autoRotate&&i===b.NONE&&Bt(ht()),l.enableDamping?(T.theta+=A.theta*l.dampingFactor,T.phi+=A.phi*l.dampingFactor):(T.theta+=A.theta,T.phi+=A.phi);let Ge=l.minAzimuthAngle,Xe=l.maxAzimuthAngle;isFinite(Ge)&&isFinite(Xe)&&(Ge<-Math.PI?Ge+=le:Ge>Math.PI&&(Ge-=le),Xe<-Math.PI?Xe+=le:Xe>Math.PI&&(Xe-=le),Ge<=Xe?T.theta=Math.max(Ge,Math.min(Xe,T.theta)):T.theta=T.theta>(Ge+Xe)/2?Math.max(Ge,T.theta):Math.min(Xe,T.theta)),T.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,T.phi)),T.makeSafe(),l.enableDamping===!0?l.target.addScaledVector(O,l.dampingFactor):l.target.add(O),l.zoomToCursor&&je||l.object.isOrthographicCamera?T.radius=mn(T.radius):T.radius=mn(T.radius*I),Je.setFromSpherical(T),Je.applyQuaternion(ir),Be.copy(l.target).add(Je),l.object.matrixAutoUpdate||l.object.updateMatrix(),l.object.lookAt(l.target),l.enableDamping===!0?(A.theta*=1-l.dampingFactor,A.phi*=1-l.dampingFactor,O.multiplyScalar(1-l.dampingFactor)):(A.set(0,0,0),O.set(0,0,0));let qe=!1;if(l.zoomToCursor&&je){let Ve=null;if(l.object instanceof Ed&&l.object.isPerspectiveCamera){const rt=Je.length();Ve=mn(rt*I);const Rt=rt-Ve;l.object.position.addScaledVector(be,Rt),l.object.updateMatrixWorld()}else if(l.object.isOrthographicCamera){const rt=new Tt(Ce.x,Ce.y,0);rt.unproject(l.object),l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/I)),l.object.updateProjectionMatrix(),qe=!0;const Rt=new Tt(Ce.x,Ce.y,0);Rt.unproject(l.object),l.object.position.sub(Rt).add(rt),l.object.updateMatrixWorld(),Ve=Je.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),l.zoomToCursor=!1;Ve!==null&&(l.screenSpacePanning?l.target.set(0,0,-1).transformDirection(l.object.matrix).multiplyScalar(Ve).add(l.object.position):(zg.origin.copy(l.object.position),zg.direction.set(0,0,-1).transformDirection(l.object.matrix),Math.abs(l.object.up.dot(zg.direction))<w5?t.lookAt(l.target):(ME.setFromNormalAndCoplanarPoint(l.object.up,l.target),zg.intersectPlane(ME,l.target))))}else l.object instanceof wd&&l.object.isOrthographicCamera&&(qe=I!==1,qe&&(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/I)),l.object.updateProjectionMatrix()));return I=1,je=!1,qe||Ae.distanceToSquared(l.object.position)>E||8*(1-se.dot(l.object.quaternion))>E?(l.dispatchEvent(u),Ae.copy(l.object.position),se.copy(l.object.quaternion),qe=!1,!0):!1}})(),this.connect=Je=>{Je===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),l.domElement=Je,l.domElement.style.touchAction="none",l.domElement.addEventListener("contextmenu",no),l.domElement.addEventListener("pointerdown",xo),l.domElement.addEventListener("pointercancel",xn),l.domElement.addEventListener("wheel",Bi)},this.dispose=()=>{var Je,Vt,In,ir,Ae,se;l.domElement&&(l.domElement.style.touchAction="auto"),(Je=l.domElement)==null||Je.removeEventListener("contextmenu",no),(Vt=l.domElement)==null||Vt.removeEventListener("pointerdown",xo),(In=l.domElement)==null||In.removeEventListener("pointercancel",xn),(ir=l.domElement)==null||ir.removeEventListener("wheel",Bi),(Ae=l.domElement)==null||Ae.ownerDocument.removeEventListener("pointermove",bs),(se=l.domElement)==null||se.ownerDocument.removeEventListener("pointerup",an),l._domElementKeyEvents!==null&&l._domElementKeyEvents.removeEventListener("keydown",ui)};const l=this,u={type:"change"},d={type:"start"},p={type:"end"},b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=b.NONE;const E=1e-6,T=new yv,A=new yv;let I=1;const O=new Tt,z=new Zo,U=new Zo,N=new Zo,V=new Zo,X=new Zo,J=new Zo,te=new Zo,ue=new Zo,ae=new Zo,be=new Tt,Ce=new Zo;let je=!1;const me=[],Ne={};function ht(){return 2*Math.PI/60/60*l.autoRotateSpeed}function _t(){return Math.pow(.95,l.zoomSpeed)}function Bt(Je){l.reverseOrbit||l.reverseHorizontalOrbit?A.theta+=Je:A.theta-=Je}function Kt(Je){l.reverseOrbit||l.reverseVerticalOrbit?A.phi+=Je:A.phi-=Je}const Gt=(()=>{const Je=new Tt;return function(In,ir){Je.setFromMatrixColumn(ir,0),Je.multiplyScalar(-In),O.add(Je)}})(),hn=(()=>{const Je=new Tt;return function(In,ir){l.screenSpacePanning===!0?Je.setFromMatrixColumn(ir,1):(Je.setFromMatrixColumn(ir,0),Je.crossVectors(l.object.up,Je)),Je.multiplyScalar(In),O.add(Je)}})(),wt=(()=>{const Je=new Tt;return function(In,ir){const Ae=l.domElement;if(Ae&&l.object instanceof Ed&&l.object.isPerspectiveCamera){const se=l.object.position;Je.copy(se).sub(l.target);let le=Je.length();le*=Math.tan(l.object.fov/2*Math.PI/180),Gt(2*In*le/Ae.clientHeight,l.object.matrix),hn(2*ir*le/Ae.clientHeight,l.object.matrix)}else Ae&&l.object instanceof wd&&l.object.isOrthographicCamera?(Gt(In*(l.object.right-l.object.left)/l.object.zoom/Ae.clientWidth,l.object.matrix),hn(ir*(l.object.top-l.object.bottom)/l.object.zoom/Ae.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}})();function bt(Je){l.object instanceof Ed&&l.object.isPerspectiveCamera||l.object instanceof wd&&l.object.isOrthographicCamera?I/=Je:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function $t(Je){l.object instanceof Ed&&l.object.isPerspectiveCamera||l.object instanceof wd&&l.object.isOrthographicCamera?I*=Je:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function Zt(Je){if(!l.zoomToCursor||!l.domElement)return;je=!0;const Vt=l.domElement.getBoundingClientRect(),In=Je.clientX-Vt.left,ir=Je.clientY-Vt.top,Ae=Vt.width,se=Vt.height;Ce.x=In/Ae*2-1,Ce.y=-(ir/se)*2+1,be.set(Ce.x,Ce.y,1).unproject(l.object).sub(l.object.position).normalize()}function mn(Je){return Math.max(l.minDistance,Math.min(l.maxDistance,Je))}function yn(Je){z.set(Je.clientX,Je.clientY)}function On(Je){Zt(Je),te.set(Je.clientX,Je.clientY)}function rr(Je){V.set(Je.clientX,Je.clientY)}function Yn(Je){U.set(Je.clientX,Je.clientY),N.subVectors(U,z).multiplyScalar(l.rotateSpeed);const Vt=l.domElement;Vt&&(Bt(2*Math.PI*N.x/Vt.clientHeight),Kt(2*Math.PI*N.y/Vt.clientHeight)),z.copy(U),l.update()}function Vr(Je){ue.set(Je.clientX,Je.clientY),ae.subVectors(ue,te),ae.y>0?bt(_t()):ae.y<0&&$t(_t()),te.copy(ue),l.update()}function Jr(Je){X.set(Je.clientX,Je.clientY),J.subVectors(X,V).multiplyScalar(l.panSpeed),wt(J.x,J.y),V.copy(X),l.update()}function kr(Je){Zt(Je),Je.deltaY<0?$t(_t()):Je.deltaY>0&&bt(_t()),l.update()}function Ln(Je){let Vt=!1;switch(Je.code){case l.keys.UP:wt(0,l.keyPanSpeed),Vt=!0;break;case l.keys.BOTTOM:wt(0,-l.keyPanSpeed),Vt=!0;break;case l.keys.LEFT:wt(l.keyPanSpeed,0),Vt=!0;break;case l.keys.RIGHT:wt(-l.keyPanSpeed,0),Vt=!0;break}Vt&&(Je.preventDefault(),l.update())}function li(){if(me.length==1)z.set(me[0].pageX,me[0].pageY);else{const Je=.5*(me[0].pageX+me[1].pageX),Vt=.5*(me[0].pageY+me[1].pageY);z.set(Je,Vt)}}function kn(){if(me.length==1)V.set(me[0].pageX,me[0].pageY);else{const Je=.5*(me[0].pageX+me[1].pageX),Vt=.5*(me[0].pageY+me[1].pageY);V.set(Je,Vt)}}function Br(){const Je=me[0].pageX-me[1].pageX,Vt=me[0].pageY-me[1].pageY,In=Math.sqrt(Je*Je+Vt*Vt);te.set(0,In)}function ci(){l.enableZoom&&Br(),l.enablePan&&kn()}function Ji(){l.enableZoom&&Br(),l.enableRotate&&li()}function wn(Je){if(me.length==1)U.set(Je.pageX,Je.pageY);else{const In=wo(Je),ir=.5*(Je.pageX+In.x),Ae=.5*(Je.pageY+In.y);U.set(ir,Ae)}N.subVectors(U,z).multiplyScalar(l.rotateSpeed);const Vt=l.domElement;Vt&&(Bt(2*Math.PI*N.x/Vt.clientHeight),Kt(2*Math.PI*N.y/Vt.clientHeight)),z.copy(U)}function ki(Je){if(me.length==1)X.set(Je.pageX,Je.pageY);else{const Vt=wo(Je),In=.5*(Je.pageX+Vt.x),ir=.5*(Je.pageY+Vt.y);X.set(In,ir)}J.subVectors(X,V).multiplyScalar(l.panSpeed),wt(J.x,J.y),V.copy(X)}function Bs(Je){const Vt=wo(Je),In=Je.pageX-Vt.x,ir=Je.pageY-Vt.y,Ae=Math.sqrt(In*In+ir*ir);ue.set(0,Ae),ae.set(0,Math.pow(ue.y/te.y,l.zoomSpeed)),bt(ae.y),te.copy(ue)}function Do(Je){l.enableZoom&&Bs(Je),l.enablePan&&ki(Je)}function Tr(Je){l.enableZoom&&Bs(Je),l.enableRotate&&wn(Je)}function xo(Je){var Vt,In;l.enabled!==!1&&(me.length===0&&((Vt=l.domElement)==null||Vt.ownerDocument.addEventListener("pointermove",bs),(In=l.domElement)==null||In.ownerDocument.addEventListener("pointerup",an)),ko(Je),Je.pointerType==="touch"?Hi(Je):$r(Je))}function bs(Je){l.enabled!==!1&&(Je.pointerType==="touch"?Oo(Je):Hr(Je))}function an(Je){var Vt,In,ir;bo(Je),me.length===0&&((Vt=l.domElement)==null||Vt.releasePointerCapture(Je.pointerId),(In=l.domElement)==null||In.ownerDocument.removeEventListener("pointermove",bs),(ir=l.domElement)==null||ir.ownerDocument.removeEventListener("pointerup",an)),l.dispatchEvent(p),i=b.NONE}function xn(Je){bo(Je)}function $r(Je){let Vt;switch(Je.button){case 0:Vt=l.mouseButtons.LEFT;break;case 1:Vt=l.mouseButtons.MIDDLE;break;case 2:Vt=l.mouseButtons.RIGHT;break;default:Vt=-1}switch(Vt){case wf.DOLLY:if(l.enableZoom===!1)return;On(Je),i=b.DOLLY;break;case wf.ROTATE:if(Je.ctrlKey||Je.metaKey||Je.shiftKey){if(l.enablePan===!1)return;rr(Je),i=b.PAN}else{if(l.enableRotate===!1)return;yn(Je),i=b.ROTATE}break;case wf.PAN:if(Je.ctrlKey||Je.metaKey||Je.shiftKey){if(l.enableRotate===!1)return;yn(Je),i=b.ROTATE}else{if(l.enablePan===!1)return;rr(Je),i=b.PAN}break;default:i=b.NONE}i!==b.NONE&&l.dispatchEvent(d)}function Hr(Je){if(l.enabled!==!1)switch(i){case b.ROTATE:if(l.enableRotate===!1)return;Yn(Je);break;case b.DOLLY:if(l.enableZoom===!1)return;Vr(Je);break;case b.PAN:if(l.enablePan===!1)return;Jr(Je);break}}function Bi(Je){l.enabled===!1||l.enableZoom===!1||i!==b.NONE&&i!==b.ROTATE||(Je.preventDefault(),l.dispatchEvent(d),kr(Je),l.dispatchEvent(p))}function ui(Je){l.enabled===!1||l.enablePan===!1||Ln(Je)}function Hi(Je){switch(Ko(Je),me.length){case 1:switch(l.touches.ONE){case Ef.ROTATE:if(l.enableRotate===!1)return;li(),i=b.TOUCH_ROTATE;break;case Ef.PAN:if(l.enablePan===!1)return;kn(),i=b.TOUCH_PAN;break;default:i=b.NONE}break;case 2:switch(l.touches.TWO){case Ef.DOLLY_PAN:if(l.enableZoom===!1&&l.enablePan===!1)return;ci(),i=b.TOUCH_DOLLY_PAN;break;case Ef.DOLLY_ROTATE:if(l.enableZoom===!1&&l.enableRotate===!1)return;Ji(),i=b.TOUCH_DOLLY_ROTATE;break;default:i=b.NONE}break;default:i=b.NONE}i!==b.NONE&&l.dispatchEvent(d)}function Oo(Je){switch(Ko(Je),i){case b.TOUCH_ROTATE:if(l.enableRotate===!1)return;wn(Je),l.update();break;case b.TOUCH_PAN:if(l.enablePan===!1)return;ki(Je),l.update();break;case b.TOUCH_DOLLY_PAN:if(l.enableZoom===!1&&l.enablePan===!1)return;Do(Je),l.update();break;case b.TOUCH_DOLLY_ROTATE:if(l.enableZoom===!1&&l.enableRotate===!1)return;Tr(Je),l.update();break;default:i=b.NONE}}function no(Je){l.enabled!==!1&&Je.preventDefault()}function ko(Je){me.push(Je)}function bo(Je){delete Ne[Je.pointerId];for(let Vt=0;Vt<me.length;Vt++)if(me[Vt].pointerId==Je.pointerId){me.splice(Vt,1);return}}function Ko(Je){let Vt=Ne[Je.pointerId];Vt===void 0&&(Vt=new Zo,Ne[Je.pointerId]=Vt),Vt.set(Je.pageX,Je.pageY)}function wo(Je){const Vt=Je.pointerId===me[0].pointerId?me[1]:me[0];return Ne[Vt.pointerId]}r!==void 0&&this.connect(r),this.update()}};const Td="srgb",oh="srgb-linear",PE=3001,C5=3e3;class K1 extends Jh{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(r){return new I5(r)}),this.register(function(r){return new P5(r)}),this.register(function(r){return new j5(r)}),this.register(function(r){return new U5(r)}),this.register(function(r){return new N5(r)}),this.register(function(r){return new B5(r)}),this.register(function(r){return new R5(r)}),this.register(function(r){return new D5(r)}),this.register(function(r){return new O5(r)}),this.register(function(r){return new M5(r)}),this.register(function(r){return new k5(r)}),this.register(function(r){return new L5(r)}),this.register(function(r){return new F5(r)}),this.register(function(r){return new z5(r)}),this.register(function(r){return new T5(r)}),this.register(function(r){return new G5(r)}),this.register(function(r){return new V5(r)})}load(t,r,l,u){const d=this;let p;if(this.resourcePath!=="")p=this.resourcePath;else if(this.path!==""){const E=Dl.extractUrlBase(t);p=Dl.resolveURL(E,this.path)}else p=Dl.extractUrlBase(t);this.manager.itemStart(t);const b=function(E){u?u(E):console.error(E),d.manager.itemError(t),d.manager.itemEnd(t)},i=new Tu(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,function(E){try{d.parse(E,p,function(T){r(T),d.manager.itemEnd(t)},b)}catch(T){b(T)}},l,b)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,r,l,u){let d;const p={},b={};if(typeof t=="string")d=JSON.parse(t);else if(t instanceof ArrayBuffer)if(Dl.decodeText(new Uint8Array(t.slice(0,4)))===cM){try{p[Lr.KHR_BINARY_GLTF]=new $5(t)}catch(T){u&&u(T);return}d=JSON.parse(p[Lr.KHR_BINARY_GLTF].content)}else d=JSON.parse(Dl.decodeText(new Uint8Array(t)));else d=t;if(d.asset===void 0||d.asset.version[0]<2){u&&u(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const i=new r4(d,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});i.fileLoader.setRequestHeader(this.requestHeader);for(let E=0;E<this.pluginCallbacks.length;E++){const T=this.pluginCallbacks[E](i);T.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),b[T.name]=T,p[T.name]=!0}if(d.extensionsUsed)for(let E=0;E<d.extensionsUsed.length;++E){const T=d.extensionsUsed[E],A=d.extensionsRequired||[];switch(T){case Lr.KHR_MATERIALS_UNLIT:p[T]=new S5;break;case Lr.KHR_DRACO_MESH_COMPRESSION:p[T]=new H5(d,this.dracoLoader);break;case Lr.KHR_TEXTURE_TRANSFORM:p[T]=new W5;break;case Lr.KHR_MESH_QUANTIZATION:p[T]=new Z5;break;default:A.indexOf(T)>=0&&b[T]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+T+'".')}}i.setExtensions(p),i.setPlugins(b),i.parse(l,u)}parseAsync(t,r){const l=this;return new Promise(function(u,d){l.parse(t,r,u,d)})}}function A5(){let n={};return{get:function(t){return n[t]},add:function(t,r){n[t]=r},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const Lr={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class T5{constructor(t){this.parser=t,this.name=Lr.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,r=this.parser.json.nodes||[];for(let l=0,u=r.length;l<u;l++){const d=r[l];d.extensions&&d.extensions[this.name]&&d.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,d.extensions[this.name].light)}}_loadLight(t){const r=this.parser,l="light:"+t;let u=r.cache.get(l);if(u)return u;const d=r.json,i=((d.extensions&&d.extensions[this.name]||{}).lights||[])[t];let E;const T=new Ai(16777215);i.color!==void 0&&T.setRGB(i.color[0],i.color[1],i.color[2],oh);const A=i.range!==void 0?i.range:0;switch(i.type){case"directional":E=new IT(T),E.target.position.set(0,0,-1),E.add(E.target);break;case"point":E=new vv(T),E.distance=A;break;case"spot":E=new MT(T),E.distance=A,i.spot=i.spot||{},i.spot.innerConeAngle=i.spot.innerConeAngle!==void 0?i.spot.innerConeAngle:0,i.spot.outerConeAngle=i.spot.outerConeAngle!==void 0?i.spot.outerConeAngle:Math.PI/4,E.angle=i.spot.outerConeAngle,E.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,E.target.position.set(0,0,-1),E.add(E.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return E.position.set(0,0,0),E.decay=2,th(E,i),i.intensity!==void 0&&(E.intensity=i.intensity),E.name=r.createUniqueName(i.name||"light_"+t),u=Promise.resolve(E),r.cache.add(l,u),u}getDependency(t,r){if(t==="light")return this._loadLight(r)}createNodeAttachment(t){const r=this,l=this.parser,d=l.json.nodes[t],b=(d.extensions&&d.extensions[this.name]||{}).light;return b===void 0?null:this._loadLight(b).then(function(i){return l._getNodeRef(r.cache,b,i)})}}class S5{constructor(){this.name=Lr.KHR_MATERIALS_UNLIT}getMaterialType(){return Uf}extendParams(t,r,l){const u=[];t.color=new Ai(1,1,1),t.opacity=1;const d=r.pbrMetallicRoughness;if(d){if(Array.isArray(d.baseColorFactor)){const p=d.baseColorFactor;t.color.setRGB(p[0],p[1],p[2],oh),t.opacity=p[3]}d.baseColorTexture!==void 0&&u.push(l.assignTexture(t,"map",d.baseColorTexture,Td))}return Promise.all(u)}}class M5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,r){const u=this.parser.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=u.extensions[this.name].emissiveStrength;return d!==void 0&&(r.emissiveIntensity=d),Promise.resolve()}}class I5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const l=this.parser,u=l.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=[],p=u.extensions[this.name];if(p.clearcoatFactor!==void 0&&(r.clearcoat=p.clearcoatFactor),p.clearcoatTexture!==void 0&&d.push(l.assignTexture(r,"clearcoatMap",p.clearcoatTexture)),p.clearcoatRoughnessFactor!==void 0&&(r.clearcoatRoughness=p.clearcoatRoughnessFactor),p.clearcoatRoughnessTexture!==void 0&&d.push(l.assignTexture(r,"clearcoatRoughnessMap",p.clearcoatRoughnessTexture)),p.clearcoatNormalTexture!==void 0&&(d.push(l.assignTexture(r,"clearcoatNormalMap",p.clearcoatNormalTexture)),p.clearcoatNormalTexture.scale!==void 0)){const b=p.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new Zo(b,b)}return Promise.all(d)}}class P5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_DISPERSION}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const u=this.parser.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=u.extensions[this.name];return r.dispersion=d.dispersion!==void 0?d.dispersion:0,Promise.resolve()}}class L5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const l=this.parser,u=l.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=[],p=u.extensions[this.name];return p.iridescenceFactor!==void 0&&(r.iridescence=p.iridescenceFactor),p.iridescenceTexture!==void 0&&d.push(l.assignTexture(r,"iridescenceMap",p.iridescenceTexture)),p.iridescenceIor!==void 0&&(r.iridescenceIOR=p.iridescenceIor),r.iridescenceThicknessRange===void 0&&(r.iridescenceThicknessRange=[100,400]),p.iridescenceThicknessMinimum!==void 0&&(r.iridescenceThicknessRange[0]=p.iridescenceThicknessMinimum),p.iridescenceThicknessMaximum!==void 0&&(r.iridescenceThicknessRange[1]=p.iridescenceThicknessMaximum),p.iridescenceThicknessTexture!==void 0&&d.push(l.assignTexture(r,"iridescenceThicknessMap",p.iridescenceThicknessTexture)),Promise.all(d)}}class B5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_SHEEN}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const l=this.parser,u=l.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=[];r.sheenColor=new Ai(0,0,0),r.sheenRoughness=0,r.sheen=1;const p=u.extensions[this.name];if(p.sheenColorFactor!==void 0){const b=p.sheenColorFactor;r.sheenColor.setRGB(b[0],b[1],b[2],oh)}return p.sheenRoughnessFactor!==void 0&&(r.sheenRoughness=p.sheenRoughnessFactor),p.sheenColorTexture!==void 0&&d.push(l.assignTexture(r,"sheenColorMap",p.sheenColorTexture,Td)),p.sheenRoughnessTexture!==void 0&&d.push(l.assignTexture(r,"sheenRoughnessMap",p.sheenRoughnessTexture)),Promise.all(d)}}class R5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const l=this.parser,u=l.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=[],p=u.extensions[this.name];return p.transmissionFactor!==void 0&&(r.transmission=p.transmissionFactor),p.transmissionTexture!==void 0&&d.push(l.assignTexture(r,"transmissionMap",p.transmissionTexture)),Promise.all(d)}}class D5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_VOLUME}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const l=this.parser,u=l.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=[],p=u.extensions[this.name];r.thickness=p.thicknessFactor!==void 0?p.thicknessFactor:0,p.thicknessTexture!==void 0&&d.push(l.assignTexture(r,"thicknessMap",p.thicknessTexture)),r.attenuationDistance=p.attenuationDistance||1/0;const b=p.attenuationColor||[1,1,1];return r.attenuationColor=new Ai().setRGB(b[0],b[1],b[2],oh),Promise.all(d)}}class O5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_IOR}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const u=this.parser.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=u.extensions[this.name];return r.ior=d.ior!==void 0?d.ior:1.5,Promise.resolve()}}class k5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_SPECULAR}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const l=this.parser,u=l.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=[],p=u.extensions[this.name];r.specularIntensity=p.specularFactor!==void 0?p.specularFactor:1,p.specularTexture!==void 0&&d.push(l.assignTexture(r,"specularIntensityMap",p.specularTexture));const b=p.specularColorFactor||[1,1,1];return r.specularColor=new Ai().setRGB(b[0],b[1],b[2],oh),p.specularColorTexture!==void 0&&d.push(l.assignTexture(r,"specularColorMap",p.specularColorTexture,Td)),Promise.all(d)}}class z5{constructor(t){this.parser=t,this.name=Lr.EXT_MATERIALS_BUMP}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const l=this.parser,u=l.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=[],p=u.extensions[this.name];return r.bumpScale=p.bumpFactor!==void 0?p.bumpFactor:1,p.bumpTexture!==void 0&&d.push(l.assignTexture(r,"bumpMap",p.bumpTexture)),Promise.all(d)}}class F5{constructor(t){this.parser=t,this.name=Lr.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:Pu}extendMaterialParams(t,r){const l=this.parser,u=l.json.materials[t];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const d=[],p=u.extensions[this.name];return p.anisotropyStrength!==void 0&&(r.anisotropy=p.anisotropyStrength),p.anisotropyRotation!==void 0&&(r.anisotropyRotation=p.anisotropyRotation),p.anisotropyTexture!==void 0&&d.push(l.assignTexture(r,"anisotropyMap",p.anisotropyTexture)),Promise.all(d)}}class j5{constructor(t){this.parser=t,this.name=Lr.KHR_TEXTURE_BASISU}loadTexture(t){const r=this.parser,l=r.json,u=l.textures[t];if(!u.extensions||!u.extensions[this.name])return null;const d=u.extensions[this.name],p=r.options.ktx2Loader;if(!p){if(l.extensionsRequired&&l.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return r.loadTextureImage(t,d.source,p)}}class U5{constructor(t){this.parser=t,this.name=Lr.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const r=this.name,l=this.parser,u=l.json,d=u.textures[t];if(!d.extensions||!d.extensions[r])return null;const p=d.extensions[r],b=u.images[p.source];let i=l.textureLoader;if(b.uri){const E=l.options.manager.getHandler(b.uri);E!==null&&(i=E)}return this.detectSupport().then(function(E){if(E)return l.loadTextureImage(t,p.source,i);if(u.extensionsRequired&&u.extensionsRequired.indexOf(r)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return l.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const r=new Image;r.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",r.onload=r.onerror=function(){t(r.height===1)}})),this.isSupported}}class N5{constructor(t){this.parser=t,this.name=Lr.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const r=this.name,l=this.parser,u=l.json,d=u.textures[t];if(!d.extensions||!d.extensions[r])return null;const p=d.extensions[r],b=u.images[p.source];let i=l.textureLoader;if(b.uri){const E=l.options.manager.getHandler(b.uri);E!==null&&(i=E)}return this.detectSupport().then(function(E){if(E)return l.loadTextureImage(t,p.source,i);if(u.extensionsRequired&&u.extensionsRequired.indexOf(r)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return l.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const r=new Image;r.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",r.onload=r.onerror=function(){t(r.height===1)}})),this.isSupported}}class G5{constructor(t){this.name=Lr.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const r=this.parser.json,l=r.bufferViews[t];if(l.extensions&&l.extensions[this.name]){const u=l.extensions[this.name],d=this.parser.getDependency("buffer",u.buffer),p=this.parser.options.meshoptDecoder;if(!p||!p.supported){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return d.then(function(b){const i=u.byteOffset||0,E=u.byteLength||0,T=u.count,A=u.byteStride,I=new Uint8Array(b,i,E);return p.decodeGltfBufferAsync?p.decodeGltfBufferAsync(T,A,I,u.mode,u.filter).then(function(O){return O.buffer}):p.ready.then(function(){const O=new ArrayBuffer(T*A);return p.decodeGltfBuffer(new Uint8Array(O),T,A,I,u.mode,u.filter),O})})}else return null}}class V5{constructor(t){this.name=Lr.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const r=this.parser.json,l=r.nodes[t];if(!l.extensions||!l.extensions[this.name]||l.mesh===void 0)return null;const u=r.meshes[l.mesh];for(const E of u.primitives)if(E.mode!==oc.TRIANGLES&&E.mode!==oc.TRIANGLE_STRIP&&E.mode!==oc.TRIANGLE_FAN&&E.mode!==void 0)return null;const p=l.extensions[this.name].attributes,b=[],i={};for(const E in p)b.push(this.parser.getDependency("accessor",p[E]).then(T=>(i[E]=T,i[E])));return b.length<1?null:(b.push(this.parser.createNodeMesh(t)),Promise.all(b).then(E=>{const T=E.pop(),A=T.isGroup?T.children:[T],I=E[0].count,O=[];for(const z of A){const U=new Ci,N=new Tt,V=new kl,X=new Tt(1,1,1),J=new QB(z.geometry,z.material,I);for(let te=0;te<I;te++)i.TRANSLATION&&N.fromBufferAttribute(i.TRANSLATION,te),i.ROTATION&&V.fromBufferAttribute(i.ROTATION,te),i.SCALE&&X.fromBufferAttribute(i.SCALE,te),J.setMatrixAt(te,U.compose(N,V,X));for(const te in i)if(te==="_COLOR_0"){const ue=i[te];J.instanceColor=new eR(ue.array,ue.itemSize,ue.normalized)}else te!=="TRANSLATION"&&te!=="ROTATION"&&te!=="SCALE"&&z.geometry.setAttribute(te,i[te]);Ba.prototype.copy.call(J,z),this.parser.assignFinalMaterial(J),O.push(J)}return T.isGroup?(T.clear(),T.add(...O),T):O[0]}))}}const cM="glTF",om=12,LE={JSON:1313821514,BIN:5130562};class $5{constructor(t){this.name=Lr.KHR_BINARY_GLTF,this.content=null,this.body=null;const r=new DataView(t,0,om);if(this.header={magic:Dl.decodeText(new Uint8Array(t.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==cM)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const l=this.header.length-om,u=new DataView(t,om);let d=0;for(;d<l;){const p=u.getUint32(d,!0);d+=4;const b=u.getUint32(d,!0);if(d+=4,b===LE.JSON){const i=new Uint8Array(t,om+d,p);this.content=Dl.decodeText(i)}else if(b===LE.BIN){const i=om+d;this.body=t.slice(i,i+p)}d+=p}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class H5{constructor(t,r){if(!r)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Lr.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=r,this.dracoLoader.preload()}decodePrimitive(t,r){const l=this.json,u=this.dracoLoader,d=t.extensions[this.name].bufferView,p=t.extensions[this.name].attributes,b={},i={},E={};for(const T in p){const A=jv[T]||T.toLowerCase();b[A]=p[T]}for(const T in t.attributes){const A=jv[T]||T.toLowerCase();if(p[T]!==void 0){const I=l.accessors[t.attributes[T]],O=Jf[I.componentType];E[A]=O.name,i[A]=I.normalized===!0}}return r.getDependency("bufferView",d).then(function(T){return new Promise(function(A,I){u.decodeDracoFile(T,function(O){for(const z in O.attributes){const U=O.attributes[z],N=i[z];N!==void 0&&(U.normalized=N)}A(O)},b,E,oh,I)})})}}class W5{constructor(){this.name=Lr.KHR_TEXTURE_TRANSFORM}extendTexture(t,r){return(r.texCoord===void 0||r.texCoord===t.channel)&&r.offset===void 0&&r.rotation===void 0&&r.scale===void 0||(t=t.clone(),r.texCoord!==void 0&&(t.channel=r.texCoord),r.offset!==void 0&&t.offset.fromArray(r.offset),r.rotation!==void 0&&(t.rotation=r.rotation),r.scale!==void 0&&t.repeat.fromArray(r.scale),t.needsUpdate=!0),t}}class Z5{constructor(){this.name=Lr.KHR_MESH_QUANTIZATION}}class uM extends uR{constructor(t,r,l,u){super(t,r,l,u)}copySampleValue_(t){const r=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=t*u*3+u;for(let p=0;p!==u;p++)r[p]=l[d+p];return r}interpolate_(t,r,l,u){const d=this.resultBuffer,p=this.sampleValues,b=this.valueSize,i=b*2,E=b*3,T=u-r,A=(l-r)/T,I=A*A,O=I*A,z=t*E,U=z-E,N=-2*O+3*I,V=O-I,X=1-N,J=V-I+A;for(let te=0;te!==b;te++){const ue=p[U+te+b],ae=p[U+te+i]*T,be=p[z+te+b],Ce=p[z+te]*T;d[te]=X*ue+J*ae+N*be+V*Ce}return d}}const X5=new kl;class q5 extends uM{interpolate_(t,r,l,u){const d=super.interpolate_(t,r,l,u);return X5.fromArray(d).normalize().toArray(d),d}}const oc={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Jf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},BE={9728:iR,9729:h_,9984:oR,9985:sR,9986:aR,9987:PT},RE={33071:bv,33648:lR,10497:tp},P0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jv={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...o5>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Fh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},K5={CUBICSPLINE:void 0,LINEAR:DT,STEP:cR},L0={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function J5(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new km({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:OT})),n.DefaultMaterial}function vd(n,t,r){for(const l in r.extensions)n[l]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[l]=r.extensions[l])}function th(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Y5(n,t,r){let l=!1,u=!1,d=!1;for(let E=0,T=t.length;E<T;E++){const A=t[E];if(A.POSITION!==void 0&&(l=!0),A.NORMAL!==void 0&&(u=!0),A.COLOR_0!==void 0&&(d=!0),l&&u&&d)break}if(!l&&!u&&!d)return Promise.resolve(n);const p=[],b=[],i=[];for(let E=0,T=t.length;E<T;E++){const A=t[E];if(l){const I=A.POSITION!==void 0?r.getDependency("accessor",A.POSITION):n.attributes.position;p.push(I)}if(u){const I=A.NORMAL!==void 0?r.getDependency("accessor",A.NORMAL):n.attributes.normal;b.push(I)}if(d){const I=A.COLOR_0!==void 0?r.getDependency("accessor",A.COLOR_0):n.attributes.color;i.push(I)}}return Promise.all([Promise.all(p),Promise.all(b),Promise.all(i)]).then(function(E){const T=E[0],A=E[1],I=E[2];return l&&(n.morphAttributes.position=T),u&&(n.morphAttributes.normal=A),d&&(n.morphAttributes.color=I),n.morphTargetsRelative=!0,n})}function Q5(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let r=0,l=t.weights.length;r<l;r++)n.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(n.morphTargetInfluences.length===r.length){n.morphTargetDictionary={};for(let l=0,u=r.length;l<u;l++)n.morphTargetDictionary[r[l]]=l}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function e4(n){let t;const r=n.extensions&&n.extensions[Lr.KHR_DRACO_MESH_COMPRESSION];if(r?t="draco:"+r.bufferView+":"+r.indices+":"+B0(r.attributes):t=n.indices+":"+B0(n.attributes)+":"+n.mode,n.targets!==void 0)for(let l=0,u=n.targets.length;l<u;l++)t+=":"+B0(n.targets[l]);return t}function B0(n){let t="";const r=Object.keys(n).sort();for(let l=0,u=r.length;l<u;l++)t+=r[l]+":"+n[r[l]]+";";return t}function Uv(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function t4(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const n4=new Ci;class r4{constructor(t={},r={}){this.json=t,this.extensions={},this.plugins={},this.options=r,this.cache=new A5,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let l=!1,u=!1,d=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,u=navigator.userAgent.indexOf("Firefox")>-1,d=u?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||l||u&&d<98?this.textureLoader=new j_(this.options.manager):this.textureLoader=new tR(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Tu(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,r){const l=this,u=this.json,d=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(p){return p._markDefs&&p._markDefs()}),Promise.all(this._invokeAll(function(p){return p.beforeRoot&&p.beforeRoot()})).then(function(){return Promise.all([l.getDependencies("scene"),l.getDependencies("animation"),l.getDependencies("camera")])}).then(function(p){const b={scene:p[0][u.scene||0],scenes:p[0],animations:p[1],cameras:p[2],asset:u.asset,parser:l,userData:{}};return vd(d,b,u),th(b,u),Promise.all(l._invokeAll(function(i){return i.afterRoot&&i.afterRoot(b)})).then(function(){for(const i of b.scenes)i.updateMatrixWorld();t(b)})}).catch(r)}_markDefs(){const t=this.json.nodes||[],r=this.json.skins||[],l=this.json.meshes||[];for(let u=0,d=r.length;u<d;u++){const p=r[u].joints;for(let b=0,i=p.length;b<i;b++)t[p[b]].isBone=!0}for(let u=0,d=t.length;u<d;u++){const p=t[u];p.mesh!==void 0&&(this._addNodeRef(this.meshCache,p.mesh),p.skin!==void 0&&(l[p.mesh].isSkinnedMesh=!0)),p.camera!==void 0&&this._addNodeRef(this.cameraCache,p.camera)}}_addNodeRef(t,r){r!==void 0&&(t.refs[r]===void 0&&(t.refs[r]=t.uses[r]=0),t.refs[r]++)}_getNodeRef(t,r,l){if(t.refs[r]<=1)return l;const u=l.clone(),d=(p,b)=>{const i=this.associations.get(p);i!=null&&this.associations.set(b,i);for(const[E,T]of p.children.entries())d(T,b.children[E])};return d(l,u),u.name+="_instance_"+t.uses[r]++,u}_invokeOne(t){const r=Object.values(this.plugins);r.push(this);for(let l=0;l<r.length;l++){const u=t(r[l]);if(u)return u}return null}_invokeAll(t){const r=Object.values(this.plugins);r.unshift(this);const l=[];for(let u=0;u<r.length;u++){const d=t(r[u]);d&&l.push(d)}return l}getDependency(t,r){const l=t+":"+r;let u=this.cache.get(l);if(!u){switch(t){case"scene":u=this.loadScene(r);break;case"node":u=this._invokeOne(function(d){return d.loadNode&&d.loadNode(r)});break;case"mesh":u=this._invokeOne(function(d){return d.loadMesh&&d.loadMesh(r)});break;case"accessor":u=this.loadAccessor(r);break;case"bufferView":u=this._invokeOne(function(d){return d.loadBufferView&&d.loadBufferView(r)});break;case"buffer":u=this.loadBuffer(r);break;case"material":u=this._invokeOne(function(d){return d.loadMaterial&&d.loadMaterial(r)});break;case"texture":u=this._invokeOne(function(d){return d.loadTexture&&d.loadTexture(r)});break;case"skin":u=this.loadSkin(r);break;case"animation":u=this._invokeOne(function(d){return d.loadAnimation&&d.loadAnimation(r)});break;case"camera":u=this.loadCamera(r);break;default:if(u=this._invokeOne(function(d){return d!=this&&d.getDependency&&d.getDependency(t,r)}),!u)throw new Error("Unknown type: "+t);break}this.cache.add(l,u)}return u}getDependencies(t){let r=this.cache.get(t);if(!r){const l=this,u=this.json[t+(t==="mesh"?"es":"s")]||[];r=Promise.all(u.map(function(d,p){return l.getDependency(t,p)})),this.cache.add(t,r)}return r}loadBuffer(t){const r=this.json.buffers[t],l=this.fileLoader;if(r.type&&r.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(r.uri===void 0&&t===0)return Promise.resolve(this.extensions[Lr.KHR_BINARY_GLTF].body);const u=this.options;return new Promise(function(d,p){l.load(Dl.resolveURL(r.uri,u.path),d,void 0,function(){p(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})}loadBufferView(t){const r=this.json.bufferViews[t];return this.getDependency("buffer",r.buffer).then(function(l){const u=r.byteLength||0,d=r.byteOffset||0;return l.slice(d,d+u)})}loadAccessor(t){const r=this,l=this.json,u=this.json.accessors[t];if(u.bufferView===void 0&&u.sparse===void 0){const p=P0[u.type],b=Jf[u.componentType],i=u.normalized===!0,E=new b(u.count*p);return Promise.resolve(new Vh(E,p,i))}const d=[];return u.bufferView!==void 0?d.push(this.getDependency("bufferView",u.bufferView)):d.push(null),u.sparse!==void 0&&(d.push(this.getDependency("bufferView",u.sparse.indices.bufferView)),d.push(this.getDependency("bufferView",u.sparse.values.bufferView))),Promise.all(d).then(function(p){const b=p[0],i=P0[u.type],E=Jf[u.componentType],T=E.BYTES_PER_ELEMENT,A=T*i,I=u.byteOffset||0,O=u.bufferView!==void 0?l.bufferViews[u.bufferView].byteStride:void 0,z=u.normalized===!0;let U,N;if(O&&O!==A){const V=Math.floor(I/O),X="InterleavedBuffer:"+u.bufferView+":"+u.componentType+":"+V+":"+u.count;let J=r.cache.get(X);J||(U=new E(b,V*O,u.count*O/T),J=new nR(U,O/T),r.cache.add(X,J)),N=new zl(J,i,I%O/T,z)}else b===null?U=new E(u.count*i):U=new E(b,I,u.count*i),N=new Vh(U,i,z);if(u.sparse!==void 0){const V=P0.SCALAR,X=Jf[u.sparse.indices.componentType],J=u.sparse.indices.byteOffset||0,te=u.sparse.values.byteOffset||0,ue=new X(p[1],J,u.sparse.count*V),ae=new E(p[2],te,u.sparse.count*i);b!==null&&(N=new Vh(N.array.slice(),N.itemSize,N.normalized));for(let be=0,Ce=ue.length;be<Ce;be++){const je=ue[be];if(N.setX(je,ae[be*i]),i>=2&&N.setY(je,ae[be*i+1]),i>=3&&N.setZ(je,ae[be*i+2]),i>=4&&N.setW(je,ae[be*i+3]),i>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return N})}loadTexture(t){const r=this.json,l=this.options,d=r.textures[t].source,p=r.images[d];let b=this.textureLoader;if(p.uri){const i=l.manager.getHandler(p.uri);i!==null&&(b=i)}return this.loadTextureImage(t,d,b)}loadTextureImage(t,r,l){const u=this,d=this.json,p=d.textures[t],b=d.images[r],i=(b.uri||b.bufferView)+":"+p.sampler;if(this.textureCache[i])return this.textureCache[i];const E=this.loadImageSource(r,l).then(function(T){T.flipY=!1,T.name=p.name||b.name||"",T.name===""&&typeof b.uri=="string"&&b.uri.startsWith("data:image/")===!1&&(T.name=b.uri);const I=(d.samplers||{})[p.sampler]||{};return T.magFilter=BE[I.magFilter]||h_,T.minFilter=BE[I.minFilter]||PT,T.wrapS=RE[I.wrapS]||tp,T.wrapT=RE[I.wrapT]||tp,u.associations.set(T,{textures:t}),T}).catch(function(){return null});return this.textureCache[i]=E,E}loadImageSource(t,r){const l=this,u=this.json,d=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(A=>A.clone());const p=u.images[t],b=self.URL||self.webkitURL;let i=p.uri||"",E=!1;if(p.bufferView!==void 0)i=l.getDependency("bufferView",p.bufferView).then(function(A){E=!0;const I=new Blob([A],{type:p.mimeType});return i=b.createObjectURL(I),i});else if(p.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const T=Promise.resolve(i).then(function(A){return new Promise(function(I,O){let z=I;r.isImageBitmapLoader===!0&&(z=function(U){const N=new Cm(U);N.needsUpdate=!0,I(N)}),r.load(Dl.resolveURL(A,d.path),z,void 0,O)})}).then(function(A){return E===!0&&b.revokeObjectURL(i),th(A,p),A.userData.mimeType=p.mimeType||t4(p.uri),A}).catch(function(A){throw console.error("THREE.GLTFLoader: Couldn't load texture",i),A});return this.sourceCache[t]=T,T}assignTexture(t,r,l,u){const d=this;return this.getDependency("texture",l.index).then(function(p){if(!p)return null;if(l.texCoord!==void 0&&l.texCoord>0&&(p=p.clone(),p.channel=l.texCoord),d.extensions[Lr.KHR_TEXTURE_TRANSFORM]){const b=l.extensions!==void 0?l.extensions[Lr.KHR_TEXTURE_TRANSFORM]:void 0;if(b){const i=d.associations.get(p);p=d.extensions[Lr.KHR_TEXTURE_TRANSFORM].extendTexture(p,b),d.associations.set(p,i)}}return u!==void 0&&(typeof u=="number"&&(u=u===PE?Td:oh),"colorSpace"in p?p.colorSpace=u:p.encoding=u===Td?PE:C5),t[r]=p,p})}assignFinalMaterial(t){const r=t.geometry;let l=t.material;const u=r.attributes.tangent===void 0,d=r.attributes.color!==void 0,p=r.attributes.normal===void 0;if(t.isPoints){const b="PointsMaterial:"+l.uuid;let i=this.cache.get(b);i||(i=new Cd,Wf.prototype.copy.call(i,l),i.color.copy(l.color),i.map=l.map,i.sizeAttenuation=!1,this.cache.add(b,i)),l=i}else if(t.isLine){const b="LineBasicMaterial:"+l.uuid;let i=this.cache.get(b);i||(i=new vm,Wf.prototype.copy.call(i,l),i.color.copy(l.color),i.map=l.map,this.cache.add(b,i)),l=i}if(u||d||p){let b="ClonedMaterial:"+l.uuid+":";u&&(b+="derivative-tangents:"),d&&(b+="vertex-colors:"),p&&(b+="flat-shading:");let i=this.cache.get(b);i||(i=l.clone(),d&&(i.vertexColors=!0),p&&(i.flatShading=!0),u&&(i.normalScale&&(i.normalScale.y*=-1),i.clearcoatNormalScale&&(i.clearcoatNormalScale.y*=-1)),this.cache.add(b,i),this.associations.set(i,this.associations.get(l))),l=i}t.material=l}getMaterialType(){return km}loadMaterial(t){const r=this,l=this.json,u=this.extensions,d=l.materials[t];let p;const b={},i=d.extensions||{},E=[];if(i[Lr.KHR_MATERIALS_UNLIT]){const A=u[Lr.KHR_MATERIALS_UNLIT];p=A.getMaterialType(),E.push(A.extendParams(b,d,r))}else{const A=d.pbrMetallicRoughness||{};if(b.color=new Ai(1,1,1),b.opacity=1,Array.isArray(A.baseColorFactor)){const I=A.baseColorFactor;b.color.setRGB(I[0],I[1],I[2],oh),b.opacity=I[3]}A.baseColorTexture!==void 0&&E.push(r.assignTexture(b,"map",A.baseColorTexture,Td)),b.metalness=A.metallicFactor!==void 0?A.metallicFactor:1,b.roughness=A.roughnessFactor!==void 0?A.roughnessFactor:1,A.metallicRoughnessTexture!==void 0&&(E.push(r.assignTexture(b,"metalnessMap",A.metallicRoughnessTexture)),E.push(r.assignTexture(b,"roughnessMap",A.metallicRoughnessTexture))),p=this._invokeOne(function(I){return I.getMaterialType&&I.getMaterialType(t)}),E.push(Promise.all(this._invokeAll(function(I){return I.extendMaterialParams&&I.extendMaterialParams(t,b)})))}d.doubleSided===!0&&(b.side=x1);const T=d.alphaMode||L0.OPAQUE;if(T===L0.BLEND?(b.transparent=!0,b.depthWrite=!1):(b.transparent=!1,T===L0.MASK&&(b.alphaTest=d.alphaCutoff!==void 0?d.alphaCutoff:.5)),d.normalTexture!==void 0&&p!==Uf&&(E.push(r.assignTexture(b,"normalMap",d.normalTexture)),b.normalScale=new Zo(1,1),d.normalTexture.scale!==void 0)){const A=d.normalTexture.scale;b.normalScale.set(A,A)}if(d.occlusionTexture!==void 0&&p!==Uf&&(E.push(r.assignTexture(b,"aoMap",d.occlusionTexture)),d.occlusionTexture.strength!==void 0&&(b.aoMapIntensity=d.occlusionTexture.strength)),d.emissiveFactor!==void 0&&p!==Uf){const A=d.emissiveFactor;b.emissive=new Ai().setRGB(A[0],A[1],A[2],oh)}return d.emissiveTexture!==void 0&&p!==Uf&&E.push(r.assignTexture(b,"emissiveMap",d.emissiveTexture,Td)),Promise.all(E).then(function(){const A=new p(b);return d.name&&(A.name=d.name),th(A,d),r.associations.set(A,{materials:t}),d.extensions&&vd(u,A,d),A})}createUniqueName(t){const r=Tm.sanitizeNodeName(t||"");return r in this.nodeNamesUsed?r+"_"+ ++this.nodeNamesUsed[r]:(this.nodeNamesUsed[r]=0,r)}loadGeometries(t){const r=this,l=this.extensions,u=this.primitiveCache;function d(b){return l[Lr.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(b,r).then(function(i){return DE(i,b,r)})}const p=[];for(let b=0,i=t.length;b<i;b++){const E=t[b],T=e4(E),A=u[T];if(A)p.push(A.promise);else{let I;E.extensions&&E.extensions[Lr.KHR_DRACO_MESH_COMPRESSION]?I=d(E):I=DE(new _l,E,r),u[T]={primitive:E,promise:I},p.push(I)}}return Promise.all(p)}loadMesh(t){const r=this,l=this.json,u=this.extensions,d=l.meshes[t],p=d.primitives,b=[];for(let i=0,E=p.length;i<E;i++){const T=p[i].material===void 0?J5(this.cache):this.getDependency("material",p[i].material);b.push(T)}return b.push(r.loadGeometries(p)),Promise.all(b).then(function(i){const E=i.slice(0,i.length-1),T=i[i.length-1],A=[];for(let O=0,z=T.length;O<z;O++){const U=T[O],N=p[O];let V;const X=E[O];if(N.mode===oc.TRIANGLES||N.mode===oc.TRIANGLE_STRIP||N.mode===oc.TRIANGLE_FAN||N.mode===void 0)V=d.isSkinnedMesh===!0?new LT(U,X):new Oa(U,X),V.isSkinnedMesh===!0&&V.normalizeSkinWeights(),N.mode===oc.TRIANGLE_STRIP?V.geometry=SE(V.geometry,TT):N.mode===oc.TRIANGLE_FAN&&(V.geometry=SE(V.geometry,_v));else if(N.mode===oc.LINES)V=new d_(U,X);else if(N.mode===oc.LINE_STRIP)V=new b1(U,X);else if(N.mode===oc.LINE_LOOP)V=new rR(U,X);else if(N.mode===oc.POINTS)V=new Id(U,X);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+N.mode);Object.keys(V.geometry.morphAttributes).length>0&&Q5(V,d),V.name=r.createUniqueName(d.name||"mesh_"+t),th(V,d),N.extensions&&vd(u,V,N),r.assignFinalMaterial(V),A.push(V)}for(let O=0,z=A.length;O<z;O++)r.associations.set(A[O],{meshes:t,primitives:O});if(A.length===1)return d.extensions&&vd(u,A[0],d),A[0];const I=new Zf;d.extensions&&vd(u,I,d),r.associations.set(I,{meshes:t});for(let O=0,z=A.length;O<z;O++)I.add(A[O]);return I})}loadCamera(t){let r;const l=this.json.cameras[t],u=l[l.type];if(!u){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return l.type==="perspective"?r=new Ed(fa.radToDeg(u.yfov),u.aspectRatio||1,u.znear||1,u.zfar||2e6):l.type==="orthographic"&&(r=new wd(-u.xmag,u.xmag,u.ymag,-u.ymag,u.znear,u.zfar)),l.name&&(r.name=this.createUniqueName(l.name)),th(r,l),Promise.resolve(r)}loadSkin(t){const r=this.json.skins[t],l=[];for(let u=0,d=r.joints.length;u<d;u++)l.push(this._loadNodeShallow(r.joints[u]));return r.inverseBindMatrices!==void 0?l.push(this.getDependency("accessor",r.inverseBindMatrices)):l.push(null),Promise.all(l).then(function(u){const d=u.pop(),p=u,b=[],i=[];for(let E=0,T=p.length;E<T;E++){const A=p[E];if(A){b.push(A);const I=new Ci;d!==null&&I.fromArray(d.array,E*16),i.push(I)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[E])}return new BT(b,i)})}loadAnimation(t){const r=this.json,l=this,u=r.animations[t],d=u.name?u.name:"animation_"+t,p=[],b=[],i=[],E=[],T=[];for(let A=0,I=u.channels.length;A<I;A++){const O=u.channels[A],z=u.samplers[O.sampler],U=O.target,N=U.node,V=u.parameters!==void 0?u.parameters[z.input]:z.input,X=u.parameters!==void 0?u.parameters[z.output]:z.output;U.node!==void 0&&(p.push(this.getDependency("node",N)),b.push(this.getDependency("accessor",V)),i.push(this.getDependency("accessor",X)),E.push(z),T.push(U))}return Promise.all([Promise.all(p),Promise.all(b),Promise.all(i),Promise.all(E),Promise.all(T)]).then(function(A){const I=A[0],O=A[1],z=A[2],U=A[3],N=A[4],V=[];for(let X=0,J=I.length;X<J;X++){const te=I[X],ue=O[X],ae=z[X],be=U[X],Ce=N[X];if(te===void 0)continue;te.updateMatrix&&te.updateMatrix();const je=l._createAnimationTracks(te,ue,ae,be,Ce);if(je)for(let me=0;me<je.length;me++)V.push(je[me])}return new RT(d,void 0,V)})}createNodeMesh(t){const r=this.json,l=this,u=r.nodes[t];return u.mesh===void 0?null:l.getDependency("mesh",u.mesh).then(function(d){const p=l._getNodeRef(l.meshCache,u.mesh,d);return u.weights!==void 0&&p.traverse(function(b){if(b.isMesh)for(let i=0,E=u.weights.length;i<E;i++)b.morphTargetInfluences[i]=u.weights[i]}),p})}loadNode(t){const r=this.json,l=this,u=r.nodes[t],d=l._loadNodeShallow(t),p=[],b=u.children||[];for(let E=0,T=b.length;E<T;E++)p.push(l.getDependency("node",b[E]));const i=u.skin===void 0?Promise.resolve(null):l.getDependency("skin",u.skin);return Promise.all([d,Promise.all(p),i]).then(function(E){const T=E[0],A=E[1],I=E[2];I!==null&&T.traverse(function(O){O.isSkinnedMesh&&O.bind(I,n4)});for(let O=0,z=A.length;O<z;O++)T.add(A[O]);return T})}_loadNodeShallow(t){const r=this.json,l=this.extensions,u=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const d=r.nodes[t],p=d.name?u.createUniqueName(d.name):"",b=[],i=u._invokeOne(function(E){return E.createNodeMesh&&E.createNodeMesh(t)});return i&&b.push(i),d.camera!==void 0&&b.push(u.getDependency("camera",d.camera).then(function(E){return u._getNodeRef(u.cameraCache,d.camera,E)})),u._invokeAll(function(E){return E.createNodeAttachment&&E.createNodeAttachment(t)}).forEach(function(E){b.push(E)}),this.nodeCache[t]=Promise.all(b).then(function(E){let T;if(d.isBone===!0?T=new xv:E.length>1?T=new Zf:E.length===1?T=E[0]:T=new Ba,T!==E[0])for(let A=0,I=E.length;A<I;A++)T.add(E[A]);if(d.name&&(T.userData.name=d.name,T.name=p),th(T,d),d.extensions&&vd(l,T,d),d.matrix!==void 0){const A=new Ci;A.fromArray(d.matrix),T.applyMatrix4(A)}else d.translation!==void 0&&T.position.fromArray(d.translation),d.rotation!==void 0&&T.quaternion.fromArray(d.rotation),d.scale!==void 0&&T.scale.fromArray(d.scale);return u.associations.has(T)||u.associations.set(T,{}),u.associations.get(T).nodes=t,T}),this.nodeCache[t]}loadScene(t){const r=this.extensions,l=this.json.scenes[t],u=this,d=new Zf;l.name&&(d.name=u.createUniqueName(l.name)),th(d,l),l.extensions&&vd(r,d,l);const p=l.nodes||[],b=[];for(let i=0,E=p.length;i<E;i++)b.push(u.getDependency("node",p[i]));return Promise.all(b).then(function(i){for(let T=0,A=i.length;T<A;T++)d.add(i[T]);const E=T=>{const A=new Map;for(const[I,O]of u.associations)(I instanceof Wf||I instanceof Cm)&&A.set(I,O);return T.traverse(I=>{const O=u.associations.get(I);O!=null&&A.set(I,O)}),A};return u.associations=E(d),d})}_createAnimationTracks(t,r,l,u,d){const p=[],b=t.name?t.name:t.uuid,i=[];Fh[d.path]===Fh.weights?t.traverse(function(I){I.morphTargetInfluences&&i.push(I.name?I.name:I.uuid)}):i.push(b);let E;switch(Fh[d.path]){case Fh.weights:E=Ev;break;case Fh.rotation:E=Cv;break;case Fh.position:case Fh.scale:E=wv;break;default:switch(l.itemSize){case 1:E=Ev;break;case 2:case 3:default:E=wv;break}break}const T=u.interpolation!==void 0?K5[u.interpolation]:DT,A=this._getArrayFromAccessor(l);for(let I=0,O=i.length;I<O;I++){const z=new E(i[I]+"."+Fh[d.path],r.array,A,T);u.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(z),p.push(z)}return p}_getArrayFromAccessor(t){let r=t.array;if(t.normalized){const l=Uv(r.constructor),u=new Float32Array(r.length);for(let d=0,p=r.length;d<p;d++)u[d]=r[d]*l;r=u}return r}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(l){const u=this instanceof Cv?q5:uM;return new u(this.times,this.values,this.getValueSize()/3,l)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function i4(n,t,r){const l=t.attributes,u=new dh;if(l.POSITION!==void 0){const b=r.json.accessors[l.POSITION],i=b.min,E=b.max;if(i!==void 0&&E!==void 0){if(u.set(new Tt(i[0],i[1],i[2]),new Tt(E[0],E[1],E[2])),b.normalized){const T=Uv(Jf[b.componentType]);u.min.multiplyScalar(T),u.max.multiplyScalar(T)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const d=t.targets;if(d!==void 0){const b=new Tt,i=new Tt;for(let E=0,T=d.length;E<T;E++){const A=d[E];if(A.POSITION!==void 0){const I=r.json.accessors[A.POSITION],O=I.min,z=I.max;if(O!==void 0&&z!==void 0){if(i.setX(Math.max(Math.abs(O[0]),Math.abs(z[0]))),i.setY(Math.max(Math.abs(O[1]),Math.abs(z[1]))),i.setZ(Math.max(Math.abs(O[2]),Math.abs(z[2]))),I.normalized){const U=Uv(Jf[I.componentType]);i.multiplyScalar(U)}b.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}u.expandByVector(b)}n.boundingBox=u;const p=new dp;u.getCenter(p.center),p.radius=u.min.distanceTo(u.max)/2,n.boundingSphere=p}function DE(n,t,r){const l=t.attributes,u=[];function d(p,b){return r.getDependency("accessor",p).then(function(i){n.setAttribute(b,i)})}for(const p in l){const b=jv[p]||p.toLowerCase();b in n.attributes||u.push(d(l[p],b))}if(t.indices!==void 0&&!n.index){const p=r.getDependency("accessor",t.indices).then(function(b){n.setIndex(b)});u.push(p)}return th(n,t),i4(n,t,r),Promise.all(u).then(function(){return t.targets!==void 0?Y5(n,t.targets,r):n})}function hM(n,t,r){const l=r.length-n-1;if(t>=r[l])return l-1;if(t<=r[n])return n;let u=n,d=l,p=Math.floor((u+d)/2);for(;t<r[p]||t>=r[p+1];)t<r[p]?d=p:u=p,p=Math.floor((u+d)/2);return p}function o4(n,t,r,l){const u=[],d=[],p=[];u[0]=1;for(let b=1;b<=r;++b){d[b]=t-l[n+1-b],p[b]=l[n+b]-t;let i=0;for(let E=0;E<b;++E){const T=p[E+1],A=d[b-E],I=u[E]/(T+A);u[E]=i+T*I,i=A*I}u[b]=i}return u}function s4(n,t,r,l){const u=hM(n,l,t),d=o4(u,l,n,t),p=new za(0,0,0,0);for(let b=0;b<=n;++b){const i=r[u-n+b],E=d[b],T=i.w*E;p.x+=i.x*T,p.y+=i.y*T,p.z+=i.z*T,p.w+=i.w*E}return p}function a4(n,t,r,l,u){const d=[];for(let A=0;A<=r;++A)d[A]=0;const p=[];for(let A=0;A<=l;++A)p[A]=d.slice(0);const b=[];for(let A=0;A<=r;++A)b[A]=d.slice(0);b[0][0]=1;const i=d.slice(0),E=d.slice(0);for(let A=1;A<=r;++A){i[A]=t-u[n+1-A],E[A]=u[n+A]-t;let I=0;for(let O=0;O<A;++O){const z=E[O+1],U=i[A-O];b[A][O]=z+U;const N=b[O][A-1]/b[A][O];b[O][A]=I+z*N,I=U*N}b[A][A]=I}for(let A=0;A<=r;++A)p[0][A]=b[A][r];for(let A=0;A<=r;++A){let I=0,O=1;const z=[];for(let U=0;U<=r;++U)z[U]=d.slice(0);z[0][0]=1;for(let U=1;U<=l;++U){let N=0;const V=A-U,X=r-U;A>=U&&(z[O][0]=z[I][0]/b[X+1][V],N=z[O][0]*b[V][X]);const J=V>=-1?1:-V,te=A-1<=X?U-1:r-A;for(let ae=J;ae<=te;++ae)z[O][ae]=(z[I][ae]-z[I][ae-1])/b[X+1][V+ae],N+=z[O][ae]*b[V+ae][X];A<=X&&(z[O][U]=-z[I][U-1]/b[X+1][A],N+=z[O][U]*b[A][X]),p[U][A]=N;const ue=I;I=O,O=ue}}let T=r;for(let A=1;A<=l;++A){for(let I=0;I<=r;++I)p[A][I]*=T;T*=r-A}return p}function l4(n,t,r,l,u){const d=u<n?u:n,p=[],b=hM(n,l,t),i=a4(b,l,n,d,t),E=[];for(let T=0;T<r.length;++T){const A=r[T].clone(),I=A.w;A.x*=I,A.y*=I,A.z*=I,E[T]=A}for(let T=0;T<=d;++T){const A=E[b-n].clone().multiplyScalar(i[T][0]);for(let I=1;I<=n;++I)A.add(E[b-n+I].clone().multiplyScalar(i[T][I]));p[T]=A}for(let T=d+1;T<=u+1;++T)p[T]=new za(0,0,0);return p}function c4(n,t){let r=1;for(let u=2;u<=n;++u)r*=u;let l=1;for(let u=2;u<=t;++u)l*=u;for(let u=2;u<=n-t;++u)l*=u;return r/l}function u4(n){const t=n.length,r=[],l=[];for(let d=0;d<t;++d){const p=n[d];r[d]=new Tt(p.x,p.y,p.z),l[d]=p.w}const u=[];for(let d=0;d<t;++d){const p=r[d].clone();for(let b=1;b<=d;++b)p.sub(u[d-b].clone().multiplyScalar(c4(d,b)*l[b]));u[d]=p.divideScalar(l[0])}return u}function h4(n,t,r,l,u){const d=l4(n,t,r,l,u);return u4(d)}class OE extends hR{constructor(t,r,l,u,d){super(),this.degree=t,this.knots=r,this.controlPoints=[],this.startKnot=u||0,this.endKnot=d||this.knots.length-1;for(let p=0;p<l.length;++p){const b=l[p];this.controlPoints[p]=new za(b.x,b.y,b.z,b.w)}}getPoint(t,r){const l=r||new Tt,u=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),d=s4(this.degree,this.knots,this.controlPoints,u);return d.w!=1&&d.divideScalar(d.w),l.set(d.x,d.y,d.z)}getTangent(t,r){const l=r||new Tt,u=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),d=h4(this.degree,this.knots,this.controlPoints,u,1);return l.copy(d[1]).normalize(),l}}let Pr,Wo,pl;class d4 extends Jh{constructor(t){super(t)}load(t,r,l,u){const d=this,p=d.path===""?Dl.extractUrlBase(t):d.path,b=new Tu(this.manager);b.setPath(d.path),b.setResponseType("arraybuffer"),b.setRequestHeader(d.requestHeader),b.setWithCredentials(d.withCredentials),b.load(t,function(i){try{r(d.parse(i,p))}catch(E){u?u(E):console.error(E),d.manager.itemError(t)}},l,u)}parse(t,r){if(y4(t))Pr=new _4().parse(t);else{const u=mM(t);if(!v4(u))throw new Error("THREE.FBXLoader: Unknown format.");if(zE(u)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+zE(u));Pr=new g4().parse(u)}const l=new j_(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin);return new f4(l,this.manager).parse(Pr)}}class f4{constructor(t,r){this.textureLoader=t,this.manager=r}parse(){Wo=this.parseConnections();const t=this.parseImages(),r=this.parseTextures(t),l=this.parseMaterials(r),u=this.parseDeformers(),d=new p4().parse(u);return this.parseScene(u,d,l),pl}parseConnections(){const t=new Map;return"Connections"in Pr&&Pr.Connections.connections.forEach(function(l){const u=l[0],d=l[1],p=l[2];t.has(u)||t.set(u,{parents:[],children:[]});const b={ID:d,relationship:p};t.get(u).parents.push(b),t.has(d)||t.set(d,{parents:[],children:[]});const i={ID:u,relationship:p};t.get(d).children.push(i)}),t}parseImages(){const t={},r={};if("Video"in Pr.Objects){const l=Pr.Objects.Video;for(const u in l){const d=l[u],p=parseInt(u);if(t[p]=d.RelativeFilename||d.Filename,"Content"in d){const b=d.Content instanceof ArrayBuffer&&d.Content.byteLength>0,i=typeof d.Content=="string"&&d.Content!=="";if(b||i){const E=this.parseImage(l[u]);r[d.RelativeFilename||d.Filename]=E}}}}for(const l in t){const u=t[l];r[u]!==void 0?t[l]=r[u]:t[l]=t[l].split("\\").pop()}return t}parseImage(t){const r=t.Content,l=t.RelativeFilename||t.Filename,u=l.slice(l.lastIndexOf(".")+1).toLowerCase();let d;switch(u){case"bmp":d="image/bmp";break;case"jpg":case"jpeg":d="image/jpeg";break;case"png":d="image/png";break;case"tif":d="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",l),d="image/tga";break;default:console.warn('FBXLoader: Image type "'+u+'" is not supported.');return}if(typeof r=="string")return"data:"+d+";base64,"+r;{const p=new Uint8Array(r);return window.URL.createObjectURL(new Blob([p],{type:d}))}}parseTextures(t){const r=new Map;if("Texture"in Pr.Objects){const l=Pr.Objects.Texture;for(const u in l){const d=this.parseTexture(l[u],t);r.set(parseInt(u),d)}}return r}parseTexture(t,r){const l=this.loadTexture(t,r);l.ID=t.id,l.name=t.attrName;const u=t.WrapModeU,d=t.WrapModeV,p=u!==void 0?u.value:0,b=d!==void 0?d.value:0;if(l.wrapS=p===0?tp:bv,l.wrapT=b===0?tp:bv,"Scaling"in t){const i=t.Scaling.value;l.repeat.x=i[0],l.repeat.y=i[1]}return l}loadTexture(t,r){let l;const u=this.textureLoader.path,d=Wo.get(t.id).children;d!==void 0&&d.length>0&&r[d[0].ID]!==void 0&&(l=r[d[0].ID],(l.indexOf("blob:")===0||l.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let p;const b=t.FileName.slice(-3).toLowerCase();if(b==="tga"){const i=this.manager.getHandler(".tga");i===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),p=new Cm):(i.setPath(this.textureLoader.path),p=i.load(l))}else b==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),p=new Cm):p=this.textureLoader.load(l);return this.textureLoader.setPath(u),p}parseMaterials(t){const r=new Map;if("Material"in Pr.Objects){const l=Pr.Objects.Material;for(const u in l){const d=this.parseMaterial(l[u],t);d!==null&&r.set(parseInt(u),d)}}return r}parseMaterial(t,r){const l=t.id,u=t.attrName;let d=t.ShadingModel;if(typeof d=="object"&&(d=d.value),!Wo.has(l))return null;const p=this.parseParameters(t,r,l);let b;switch(d.toLowerCase()){case"phong":b=new Xf;break;case"lambert":b=new kT;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',d),b=new Xf;break}return b.setValues(p),b.name=u,b}parseParameters(t,r,l){const u={};t.BumpFactor&&(u.bumpScale=t.BumpFactor.value),t.Diffuse?u.color=new Ai().fromArray(t.Diffuse.value):t.DiffuseColor&&(t.DiffuseColor.type==="Color"||t.DiffuseColor.type==="ColorRGB")&&(u.color=new Ai().fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(u.displacementScale=t.DisplacementFactor.value),t.Emissive?u.emissive=new Ai().fromArray(t.Emissive.value):t.EmissiveColor&&(t.EmissiveColor.type==="Color"||t.EmissiveColor.type==="ColorRGB")&&(u.emissive=new Ai().fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(u.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(u.opacity=parseFloat(t.Opacity.value)),u.opacity<1&&(u.transparent=!0),t.ReflectionFactor&&(u.reflectivity=t.ReflectionFactor.value),t.Shininess&&(u.shininess=t.Shininess.value),t.Specular?u.specular=new Ai().fromArray(t.Specular.value):t.SpecularColor&&t.SpecularColor.type==="Color"&&(u.specular=new Ai().fromArray(t.SpecularColor.value));const d=this;return Wo.get(l).children.forEach(function(p){const b=p.relationship;switch(b){case"Bump":u.bumpMap=d.getTexture(r,p.ID);break;case"Maya|TEX_ao_map":u.aoMap=d.getTexture(r,p.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":u.map=d.getTexture(r,p.ID),u.map!==void 0&&("colorSpace"in u.map?u.map.colorSpace="srgb":u.map.encoding=3001);break;case"DisplacementColor":u.displacementMap=d.getTexture(r,p.ID);break;case"EmissiveColor":u.emissiveMap=d.getTexture(r,p.ID),u.emissiveMap!==void 0&&("colorSpace"in u.emissiveMap?u.emissiveMap.colorSpace="srgb":u.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":u.normalMap=d.getTexture(r,p.ID);break;case"ReflectionColor":u.envMap=d.getTexture(r,p.ID),u.envMap!==void 0&&(u.envMap.mapping=dR,"colorSpace"in u.envMap?u.envMap.colorSpace="srgb":u.envMap.encoding=3001);break;case"SpecularColor":u.specularMap=d.getTexture(r,p.ID),u.specularMap!==void 0&&("colorSpace"in u.specularMap?u.specularMap.colorSpace="srgb":u.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":u.alphaMap=d.getTexture(r,p.ID),u.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",b);break}}),u}getTexture(t,r){return"LayeredTexture"in Pr.Objects&&r in Pr.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=Wo.get(r).children[0].ID),t.get(r)}parseDeformers(){const t={},r={};if("Deformer"in Pr.Objects){const l=Pr.Objects.Deformer;for(const u in l){const d=l[u],p=Wo.get(parseInt(u));if(d.attrType==="Skin"){const b=this.parseSkeleton(p,l);b.ID=u,p.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),b.geometryID=p.parents[0].ID,t[u]=b}else if(d.attrType==="BlendShape"){const b={id:u};b.rawTargets=this.parseMorphTargets(p,l),b.id=u,p.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[u]=b}}}return{skeletons:t,morphTargets:r}}parseSkeleton(t,r){const l=[];return t.children.forEach(function(u){const d=r[u.ID];if(d.attrType!=="Cluster")return;const p={ID:u.ID,indices:[],weights:[],transformLink:new Ci().fromArray(d.TransformLink.a)};"Indexes"in d&&(p.indices=d.Indexes.a,p.weights=d.Weights.a),l.push(p)}),{rawBones:l,bones:[]}}parseMorphTargets(t,r){const l=[];for(let u=0;u<t.children.length;u++){const d=t.children[u],p=r[d.ID],b={name:p.attrName,initialWeight:p.DeformPercent,id:p.id,fullWeights:p.FullWeights.a};if(p.attrType!=="BlendShapeChannel")return;b.geoID=Wo.get(parseInt(d.ID)).children.filter(function(i){return i.relationship===void 0})[0].ID,l.push(b)}return l}parseScene(t,r,l){pl=new Zf;const u=this.parseModels(t.skeletons,r,l),d=Pr.Objects.Model,p=this;u.forEach(function(i){const E=d[i.ID];p.setLookAtProperties(i,E),Wo.get(i.ID).parents.forEach(function(A){const I=u.get(A.ID);I!==void 0&&I.add(i)}),i.parent===null&&pl.add(i)}),this.bindSkeleton(t.skeletons,r,u),this.createAmbientLight(),pl.traverse(function(i){if(i.userData.transformData){i.parent&&(i.userData.transformData.parentMatrix=i.parent.matrix,i.userData.transformData.parentMatrixWorld=i.parent.matrixWorld);const E=fM(i.userData.transformData);i.applyMatrix4(E),i.updateWorldMatrix()}});const b=new m4().parse();pl.children.length===1&&pl.children[0].isGroup&&(pl.children[0].animations=b,pl=pl.children[0]),pl.animations=b}parseModels(t,r,l){const u=new Map,d=Pr.Objects.Model;for(const p in d){const b=parseInt(p),i=d[p],E=Wo.get(b);let T=this.buildSkeleton(E,t,b,i.attrName);if(!T){switch(i.attrType){case"Camera":T=this.createCamera(E);break;case"Light":T=this.createLight(E);break;case"Mesh":T=this.createMesh(E,r,l);break;case"NurbsCurve":T=this.createCurve(E,r);break;case"LimbNode":case"Root":T=new xv;break;case"Null":default:T=new Zf;break}T.name=i.attrName?Tm.sanitizeNodeName(i.attrName):"",T.ID=b}this.getTransformData(T,i),u.set(b,T)}return u}buildSkeleton(t,r,l,u){let d=null;return t.parents.forEach(function(p){for(const b in r){const i=r[b];i.rawBones.forEach(function(E,T){if(E.ID===p.ID){const A=d;d=new xv,d.matrixWorld.copy(E.transformLink),d.name=u?Tm.sanitizeNodeName(u):"",d.ID=l,i.bones[T]=d,A!==null&&d.add(A)}})}}),d}createCamera(t){let r,l;if(t.children.forEach(function(u){const d=Pr.Objects.NodeAttribute[u.ID];d!==void 0&&(l=d)}),l===void 0)r=new Ba;else{let u=0;l.CameraProjectionType!==void 0&&l.CameraProjectionType.value===1&&(u=1);let d=1;l.NearPlane!==void 0&&(d=l.NearPlane.value/1e3);let p=1e3;l.FarPlane!==void 0&&(p=l.FarPlane.value/1e3);let b=window.innerWidth,i=window.innerHeight;l.AspectWidth!==void 0&&l.AspectHeight!==void 0&&(b=l.AspectWidth.value,i=l.AspectHeight.value);const E=b/i;let T=45;l.FieldOfView!==void 0&&(T=l.FieldOfView.value);const A=l.FocalLength?l.FocalLength.value:null;switch(u){case 0:r=new Ed(T,E,d,p),A!==null&&r.setFocalLength(A);break;case 1:r=new wd(-b/2,b/2,i/2,-i/2,d,p);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+u+"."),r=new Ba;break}}return r}createLight(t){let r,l;if(t.children.forEach(function(u){const d=Pr.Objects.NodeAttribute[u.ID];d!==void 0&&(l=d)}),l===void 0)r=new Ba;else{let u;l.LightType===void 0?u=0:u=l.LightType.value;let d=16777215;l.Color!==void 0&&(d=new Ai().fromArray(l.Color.value));let p=l.Intensity===void 0?1:l.Intensity.value/100;l.CastLightOnObject!==void 0&&l.CastLightOnObject.value===0&&(p=0);let b=0;l.FarAttenuationEnd!==void 0&&(l.EnableFarAttenuation!==void 0&&l.EnableFarAttenuation.value===0?b=0:b=l.FarAttenuationEnd.value);const i=1;switch(u){case 0:r=new vv(d,p,b,i);break;case 1:r=new IT(d,p);break;case 2:let E=Math.PI/3;l.InnerAngle!==void 0&&(E=fa.degToRad(l.InnerAngle.value));let T=0;l.OuterAngle!==void 0&&(T=fa.degToRad(l.OuterAngle.value),T=Math.max(T,1)),r=new MT(d,p,b,E,T,i);break;default:console.warn("THREE.FBXLoader: Unknown light type "+l.LightType.value+", defaulting to a PointLight."),r=new vv(d,p);break}l.CastShadows!==void 0&&l.CastShadows.value===1&&(r.castShadow=!0)}return r}createMesh(t,r,l){let u,d=null,p=null;const b=[];return t.children.forEach(function(i){r.has(i.ID)&&(d=r.get(i.ID)),l.has(i.ID)&&b.push(l.get(i.ID))}),b.length>1?p=b:b.length>0?p=b[0]:(p=new Xf({color:13421772}),b.push(p)),"color"in d.attributes&&b.forEach(function(i){i.vertexColors=!0}),d.FBX_Deformer?(u=new LT(d,p),u.normalizeSkinWeights()):u=new Oa(d,p),u}createCurve(t,r){const l=t.children.reduce(function(d,p){return r.has(p.ID)&&(d=r.get(p.ID)),d},null),u=new vm({color:3342591,linewidth:1});return new b1(l,u)}getTransformData(t,r){const l={};"InheritType"in r&&(l.inheritType=parseInt(r.InheritType.value)),"RotationOrder"in r?l.eulerOrder=pM(r.RotationOrder.value):l.eulerOrder="ZYX","Lcl_Translation"in r&&(l.translation=r.Lcl_Translation.value),"PreRotation"in r&&(l.preRotation=r.PreRotation.value),"Lcl_Rotation"in r&&(l.rotation=r.Lcl_Rotation.value),"PostRotation"in r&&(l.postRotation=r.PostRotation.value),"Lcl_Scaling"in r&&(l.scale=r.Lcl_Scaling.value),"ScalingOffset"in r&&(l.scalingOffset=r.ScalingOffset.value),"ScalingPivot"in r&&(l.scalingPivot=r.ScalingPivot.value),"RotationOffset"in r&&(l.rotationOffset=r.RotationOffset.value),"RotationPivot"in r&&(l.rotationPivot=r.RotationPivot.value),t.userData.transformData=l}setLookAtProperties(t,r){"LookAtProperty"in r&&Wo.get(t.ID).children.forEach(function(u){if(u.relationship==="LookAtProperty"){const d=Pr.Objects.Model[u.ID];if("Lcl_Translation"in d){const p=d.Lcl_Translation.value;t.target!==void 0?(t.target.position.fromArray(p),pl.add(t.target)):t.lookAt(new Tt().fromArray(p))}}})}bindSkeleton(t,r,l){const u=this.parsePoseNodes();for(const d in t){const p=t[d];Wo.get(parseInt(p.ID)).parents.forEach(function(i){if(r.has(i.ID)){const E=i.ID;Wo.get(E).parents.forEach(function(A){l.has(A.ID)&&l.get(A.ID).bind(new BT(p.bones),u[A.ID])})}})}}parsePoseNodes(){const t={};if("Pose"in Pr.Objects){const r=Pr.Objects.Pose;for(const l in r)if(r[l].attrType==="BindPose"&&r[l].NbPoseNodes>0){const u=r[l].PoseNode;Array.isArray(u)?u.forEach(function(d){t[d.Node]=new Ci().fromArray(d.Matrix.a)}):t[u.Node]=new Ci().fromArray(u.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in Pr&&"AmbientColor"in Pr.GlobalSettings){const t=Pr.GlobalSettings.AmbientColor.value,r=t[0],l=t[1],u=t[2];if(r!==0||l!==0||u!==0){const d=new Ai(r,l,u);pl.add(new fR(d,1))}}}}class p4{parse(t){const r=new Map;if("Geometry"in Pr.Objects){const l=Pr.Objects.Geometry;for(const u in l){const d=Wo.get(parseInt(u)),p=this.parseGeometry(d,l[u],t);r.set(parseInt(u),p)}}return r}parseGeometry(t,r,l){switch(r.attrType){case"Mesh":return this.parseMeshGeometry(t,r,l);case"NurbsCurve":return this.parseNurbsGeometry(r)}}parseMeshGeometry(t,r,l){const u=l.skeletons,d=[],p=t.parents.map(function(A){return Pr.Objects.Model[A.ID]});if(p.length===0)return;const b=t.children.reduce(function(A,I){return u[I.ID]!==void 0&&(A=u[I.ID]),A},null);t.children.forEach(function(A){l.morphTargets[A.ID]!==void 0&&d.push(l.morphTargets[A.ID])});const i=p[0],E={};"RotationOrder"in i&&(E.eulerOrder=pM(i.RotationOrder.value)),"InheritType"in i&&(E.inheritType=parseInt(i.InheritType.value)),"GeometricTranslation"in i&&(E.translation=i.GeometricTranslation.value),"GeometricRotation"in i&&(E.rotation=i.GeometricRotation.value),"GeometricScaling"in i&&(E.scale=i.GeometricScaling.value);const T=fM(E);return this.genGeometry(r,b,d,T)}genGeometry(t,r,l,u){const d=new _l;t.attrName&&(d.name=t.attrName);const p=this.parseGeoNode(t,r),b=this.genBuffers(p),i=new Ti(b.vertex,3);if(i.applyMatrix4(u),d.setAttribute("position",i),b.colors.length>0&&d.setAttribute("color",new Ti(b.colors,3)),r&&(d.setAttribute("skinIndex",new pR(b.weightsIndices,4)),d.setAttribute("skinWeight",new Ti(b.vertexWeights,4)),d.FBX_Deformer=r),b.normal.length>0){const E=new mR().getNormalMatrix(u),T=new Ti(b.normal,3);T.applyNormalMatrix(E),d.setAttribute("normal",T)}if(b.uvs.forEach(function(E,T){let A="uv"+(T+1).toString();T===0&&(A="uv"),d.setAttribute(A,new Ti(b.uvs[T],2))}),p.material&&p.material.mappingType!=="AllSame"){let E=b.materialIndex[0],T=0;if(b.materialIndex.forEach(function(A,I){A!==E&&(d.addGroup(T,I-T,E),E=A,T=I)}),d.groups.length>0){const A=d.groups[d.groups.length-1],I=A.start+A.count;I!==b.materialIndex.length&&d.addGroup(I,b.materialIndex.length-I,E)}d.groups.length===0&&d.addGroup(0,b.materialIndex.length,b.materialIndex[0])}return this.addMorphTargets(d,t,l,u),d}parseGeoNode(t,r){const l={};if(l.vertexPositions=t.Vertices!==void 0?t.Vertices.a:[],l.vertexIndices=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(l.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(l.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(l.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){l.uv=[];let u=0;for(;t.LayerElementUV[u];)t.LayerElementUV[u].UV&&l.uv.push(this.parseUVs(t.LayerElementUV[u])),u++}return l.weightTable={},r!==null&&(l.skeleton=r,r.rawBones.forEach(function(u,d){u.indices.forEach(function(p,b){l.weightTable[p]===void 0&&(l.weightTable[p]=[]),l.weightTable[p].push({id:d,weight:u.weights[b]})})})),l}genBuffers(t){const r={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let l=0,u=0,d=!1,p=[],b=[],i=[],E=[],T=[],A=[];const I=this;return t.vertexIndices.forEach(function(O,z){let U,N=!1;O<0&&(O=O^-1,N=!0);let V=[],X=[];if(p.push(O*3,O*3+1,O*3+2),t.color){const J=Fg(z,l,O,t.color);i.push(J[0],J[1],J[2])}if(t.skeleton){if(t.weightTable[O]!==void 0&&t.weightTable[O].forEach(function(J){X.push(J.weight),V.push(J.id)}),X.length>4){d||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),d=!0);const J=[0,0,0,0],te=[0,0,0,0];X.forEach(function(ue,ae){let be=ue,Ce=V[ae];te.forEach(function(je,me,Ne){if(be>je){Ne[me]=be,be=je;const ht=J[me];J[me]=Ce,Ce=ht}})}),V=J,X=te}for(;X.length<4;)X.push(0),V.push(0);for(let J=0;J<4;++J)T.push(X[J]),A.push(V[J])}if(t.normal){const J=Fg(z,l,O,t.normal);b.push(J[0],J[1],J[2])}t.material&&t.material.mappingType!=="AllSame"&&(U=Fg(z,l,O,t.material)[0]),t.uv&&t.uv.forEach(function(J,te){const ue=Fg(z,l,O,J);E[te]===void 0&&(E[te]=[]),E[te].push(ue[0]),E[te].push(ue[1])}),u++,N&&(I.genFace(r,t,p,U,b,i,E,T,A,u),l++,u=0,p=[],b=[],i=[],E=[],T=[],A=[])}),r}genFace(t,r,l,u,d,p,b,i,E,T){for(let A=2;A<T;A++)t.vertex.push(r.vertexPositions[l[0]]),t.vertex.push(r.vertexPositions[l[1]]),t.vertex.push(r.vertexPositions[l[2]]),t.vertex.push(r.vertexPositions[l[(A-1)*3]]),t.vertex.push(r.vertexPositions[l[(A-1)*3+1]]),t.vertex.push(r.vertexPositions[l[(A-1)*3+2]]),t.vertex.push(r.vertexPositions[l[A*3]]),t.vertex.push(r.vertexPositions[l[A*3+1]]),t.vertex.push(r.vertexPositions[l[A*3+2]]),r.skeleton&&(t.vertexWeights.push(i[0]),t.vertexWeights.push(i[1]),t.vertexWeights.push(i[2]),t.vertexWeights.push(i[3]),t.vertexWeights.push(i[(A-1)*4]),t.vertexWeights.push(i[(A-1)*4+1]),t.vertexWeights.push(i[(A-1)*4+2]),t.vertexWeights.push(i[(A-1)*4+3]),t.vertexWeights.push(i[A*4]),t.vertexWeights.push(i[A*4+1]),t.vertexWeights.push(i[A*4+2]),t.vertexWeights.push(i[A*4+3]),t.weightsIndices.push(E[0]),t.weightsIndices.push(E[1]),t.weightsIndices.push(E[2]),t.weightsIndices.push(E[3]),t.weightsIndices.push(E[(A-1)*4]),t.weightsIndices.push(E[(A-1)*4+1]),t.weightsIndices.push(E[(A-1)*4+2]),t.weightsIndices.push(E[(A-1)*4+3]),t.weightsIndices.push(E[A*4]),t.weightsIndices.push(E[A*4+1]),t.weightsIndices.push(E[A*4+2]),t.weightsIndices.push(E[A*4+3])),r.color&&(t.colors.push(p[0]),t.colors.push(p[1]),t.colors.push(p[2]),t.colors.push(p[(A-1)*3]),t.colors.push(p[(A-1)*3+1]),t.colors.push(p[(A-1)*3+2]),t.colors.push(p[A*3]),t.colors.push(p[A*3+1]),t.colors.push(p[A*3+2])),r.material&&r.material.mappingType!=="AllSame"&&(t.materialIndex.push(u),t.materialIndex.push(u),t.materialIndex.push(u)),r.normal&&(t.normal.push(d[0]),t.normal.push(d[1]),t.normal.push(d[2]),t.normal.push(d[(A-1)*3]),t.normal.push(d[(A-1)*3+1]),t.normal.push(d[(A-1)*3+2]),t.normal.push(d[A*3]),t.normal.push(d[A*3+1]),t.normal.push(d[A*3+2])),r.uv&&r.uv.forEach(function(I,O){t.uvs[O]===void 0&&(t.uvs[O]=[]),t.uvs[O].push(b[O][0]),t.uvs[O].push(b[O][1]),t.uvs[O].push(b[O][(A-1)*2]),t.uvs[O].push(b[O][(A-1)*2+1]),t.uvs[O].push(b[O][A*2]),t.uvs[O].push(b[O][A*2+1])})}addMorphTargets(t,r,l,u){if(l.length===0)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const d=this;l.forEach(function(p){p.rawTargets.forEach(function(b){const i=Pr.Objects.Geometry[b.geoID];i!==void 0&&d.genMorphGeometry(t,r,i,u,b.name)})})}genMorphGeometry(t,r,l,u,d){const p=r.PolygonVertexIndex!==void 0?r.PolygonVertexIndex.a:[],b=l.Vertices!==void 0?l.Vertices.a:[],i=l.Indexes!==void 0?l.Indexes.a:[],E=t.attributes.position.count*3,T=new Float32Array(E);for(let z=0;z<i.length;z++){const U=i[z]*3;T[U]=b[z*3],T[U+1]=b[z*3+1],T[U+2]=b[z*3+2]}const A={vertexIndices:p,vertexPositions:T},I=this.genBuffers(A),O=new Ti(I.vertex,3);O.name=d||l.attrName,O.applyMatrix4(u),t.morphAttributes.position.push(O)}parseNormals(t){const r=t.MappingInformationType,l=t.ReferenceInformationType,u=t.Normals.a;let d=[];return l==="IndexToDirect"&&("NormalIndex"in t?d=t.NormalIndex.a:"NormalsIndex"in t&&(d=t.NormalsIndex.a)),{dataSize:3,buffer:u,indices:d,mappingType:r,referenceType:l}}parseUVs(t){const r=t.MappingInformationType,l=t.ReferenceInformationType,u=t.UV.a;let d=[];return l==="IndexToDirect"&&(d=t.UVIndex.a),{dataSize:2,buffer:u,indices:d,mappingType:r,referenceType:l}}parseVertexColors(t){const r=t.MappingInformationType,l=t.ReferenceInformationType,u=t.Colors.a;let d=[];return l==="IndexToDirect"&&(d=t.ColorIndex.a),{dataSize:4,buffer:u,indices:d,mappingType:r,referenceType:l}}parseMaterialIndices(t){const r=t.MappingInformationType,l=t.ReferenceInformationType;if(r==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:l};const u=t.Materials.a,d=[];for(let p=0;p<u.length;++p)d.push(p);return{dataSize:1,buffer:u,indices:d,mappingType:r,referenceType:l}}parseNurbsGeometry(t){if(OE===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new _l;const r=parseInt(t.Order);if(isNaN(r))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new _l;const l=r-1,u=t.KnotVector.a,d=[],p=t.Points.a;for(let A=0,I=p.length;A<I;A+=4)d.push(new za().fromArray(p,A));let b,i;if(t.Form==="Closed")d.push(d[0]);else if(t.Form==="Periodic"){b=l,i=u.length-1-b;for(let A=0;A<l;++A)d.push(d[A])}const T=new OE(l,u,d,b,i).getPoints(d.length*12);return new _l().setFromPoints(T)}}class m4{parse(){const t=[],r=this.parseClips();if(r!==void 0)for(const l in r){const u=r[l],d=this.addClip(u);t.push(d)}return t}parseClips(){if(Pr.Objects.AnimationCurve===void 0)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}parseAnimationCurveNodes(){const t=Pr.Objects.AnimationCurveNode,r=new Map;for(const l in t){const u=t[l];if(u.attrName.match(/S|R|T|DeformPercent/)!==null){const d={id:u.id,attr:u.attrName,curves:{}};r.set(d.id,d)}}return r}parseAnimationCurves(t){const r=Pr.Objects.AnimationCurve;for(const l in r){const u={id:r[l].id,times:r[l].KeyTime.a.map(x4),values:r[l].KeyValueFloat.a},d=Wo.get(u.id);if(d!==void 0){const p=d.parents[0].ID,b=d.parents[0].relationship;b.match(/X/)?t.get(p).curves.x=u:b.match(/Y/)?t.get(p).curves.y=u:b.match(/Z/)?t.get(p).curves.z=u:b.match(/d|DeformPercent/)&&t.has(p)&&(t.get(p).curves.morph=u)}}}parseAnimationLayers(t){const r=Pr.Objects.AnimationLayer,l=new Map;for(const u in r){const d=[],p=Wo.get(parseInt(u));p!==void 0&&(p.children.forEach(function(i,E){if(t.has(i.ID)){const T=t.get(i.ID);if(T.curves.x!==void 0||T.curves.y!==void 0||T.curves.z!==void 0){if(d[E]===void 0){const A=Wo.get(i.ID).parents.filter(function(I){return I.relationship!==void 0})[0].ID;if(A!==void 0){const I=Pr.Objects.Model[A.toString()];if(I===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",i);return}const O={modelName:I.attrName?Tm.sanitizeNodeName(I.attrName):"",ID:I.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};pl.traverse(function(z){z.ID===I.id&&(O.transform=z.matrix,z.userData.transformData&&(O.eulerOrder=z.userData.transformData.eulerOrder))}),O.transform||(O.transform=new Ci),"PreRotation"in I&&(O.preRotation=I.PreRotation.value),"PostRotation"in I&&(O.postRotation=I.PostRotation.value),d[E]=O}}d[E]&&(d[E][T.attr]=T)}else if(T.curves.morph!==void 0){if(d[E]===void 0){const A=Wo.get(i.ID).parents.filter(function(V){return V.relationship!==void 0})[0].ID,I=Wo.get(A).parents[0].ID,O=Wo.get(I).parents[0].ID,z=Wo.get(O).parents[0].ID,U=Pr.Objects.Model[z],N={modelName:U.attrName?Tm.sanitizeNodeName(U.attrName):"",morphName:Pr.Objects.Deformer[A].attrName};d[E]=N}d[E][T.attr]=T}}}),l.set(parseInt(u),d))}return l}parseAnimStacks(t){const r=Pr.Objects.AnimationStack,l={};for(const u in r){const d=Wo.get(parseInt(u)).children;d.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const p=t.get(d[0].ID);l[u]={name:r[u].attrName,layer:p}}return l}addClip(t){let r=[];const l=this;return t.layer.forEach(function(u){r=r.concat(l.generateTracks(u))}),new RT(t.name,-1,r)}generateTracks(t){const r=[];let l=new Tt,u=new kl,d=new Tt;if(t.transform&&t.transform.decompose(l,u,d),l=l.toArray(),u=new gm().setFromQuaternion(u,t.eulerOrder).toArray(),d=d.toArray(),t.T!==void 0&&Object.keys(t.T.curves).length>0){const p=this.generateVectorTrack(t.modelName,t.T.curves,l,"position");p!==void 0&&r.push(p)}if(t.R!==void 0&&Object.keys(t.R.curves).length>0){const p=this.generateRotationTrack(t.modelName,t.R.curves,u,t.preRotation,t.postRotation,t.eulerOrder);p!==void 0&&r.push(p)}if(t.S!==void 0&&Object.keys(t.S.curves).length>0){const p=this.generateVectorTrack(t.modelName,t.S.curves,d,"scale");p!==void 0&&r.push(p)}if(t.DeformPercent!==void 0){const p=this.generateMorphTrack(t);p!==void 0&&r.push(p)}return r}generateVectorTrack(t,r,l,u){const d=this.getTimesForAllAxes(r),p=this.getKeyframeTrackValues(d,r,l);return new wv(t+"."+u,d,p)}generateRotationTrack(t,r,l,u,d,p){r.x!==void 0&&(this.interpolateRotations(r.x),r.x.values=r.x.values.map(fa.degToRad)),r.y!==void 0&&(this.interpolateRotations(r.y),r.y.values=r.y.values.map(fa.degToRad)),r.z!==void 0&&(this.interpolateRotations(r.z),r.z.values=r.z.values.map(fa.degToRad));const b=this.getTimesForAllAxes(r),i=this.getKeyframeTrackValues(b,r,l);u!==void 0&&(u=u.map(fa.degToRad),u.push(p),u=new gm().fromArray(u),u=new kl().setFromEuler(u)),d!==void 0&&(d=d.map(fa.degToRad),d.push(p),d=new gm().fromArray(d),d=new kl().setFromEuler(d).invert());const E=new kl,T=new gm,A=[];for(let I=0;I<i.length;I+=3)T.set(i[I],i[I+1],i[I+2],p),E.setFromEuler(T),u!==void 0&&E.premultiply(u),d!==void 0&&E.multiply(d),E.toArray(A,I/3*4);return new Cv(t+".quaternion",b,A)}generateMorphTrack(t){const r=t.DeformPercent.curves.morph,l=r.values.map(function(d){return d/100}),u=pl.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new Ev(t.modelName+".morphTargetInfluences["+u+"]",r.times,l)}getTimesForAllAxes(t){let r=[];if(t.x!==void 0&&(r=r.concat(t.x.times)),t.y!==void 0&&(r=r.concat(t.y.times)),t.z!==void 0&&(r=r.concat(t.z.times)),r=r.sort(function(l,u){return l-u}),r.length>1){let l=1,u=r[0];for(let d=1;d<r.length;d++){const p=r[d];p!==u&&(r[l]=p,u=p,l++)}r=r.slice(0,l)}return r}getKeyframeTrackValues(t,r,l){const u=l,d=[];let p=-1,b=-1,i=-1;return t.forEach(function(E){if(r.x&&(p=r.x.times.indexOf(E)),r.y&&(b=r.y.times.indexOf(E)),r.z&&(i=r.z.times.indexOf(E)),p!==-1){const T=r.x.values[p];d.push(T),u[0]=T}else d.push(u[0]);if(b!==-1){const T=r.y.values[b];d.push(T),u[1]=T}else d.push(u[1]);if(i!==-1){const T=r.z.values[i];d.push(T),u[2]=T}else d.push(u[2])}),d}interpolateRotations(t){for(let r=1;r<t.values.length;r++){const l=t.values[r-1],u=t.values[r]-l,d=Math.abs(u);if(d>=180){const p=d/180,b=u/p;let i=l+b;const E=t.times[r-1],A=(t.times[r]-E)/p;let I=E+A;const O=[],z=[];for(;I<t.times[r];)O.push(I),I+=A,z.push(i),i+=b;t.times=FE(t.times,r,O),t.values=FE(t.values,r,z)}}}}class g4{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,r){this.currentProp=t,this.currentPropName=r}parse(t){this.currentIndent=0,this.allNodes=new dM,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const r=this,l=t.split(/[\r\n]+/);return l.forEach(function(u,d){const p=u.match(/^[\s\t]*;/),b=u.match(/^[\s\t]*$/);if(p||b)return;const i=u.match("^\\t{"+r.currentIndent+"}(\\w+):(.*){",""),E=u.match("^\\t{"+r.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),T=u.match("^\\t{"+(r.currentIndent-1)+"}}");i?r.parseNodeBegin(u,i):E?r.parseNodeProperty(u,E,l[++d]):T?r.popStack():u.match(/^[^\s\t}]/)&&r.parseNodePropertyContinued(u)}),this.allNodes}parseNodeBegin(t,r){const l=r[1].trim().replace(/^"/,"").replace(/"$/,""),u=r[2].split(",").map(function(i){return i.trim().replace(/^"/,"").replace(/"$/,"")}),d={name:l},p=this.parseNodeAttr(u),b=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(l,d):l in b?(l==="PoseNode"?b.PoseNode.push(d):b[l].id!==void 0&&(b[l]={},b[l][b[l].id]=b[l]),p.id!==""&&(b[l][p.id]=d)):typeof p.id=="number"?(b[l]={},b[l][p.id]=d):l!=="Properties70"&&(l==="PoseNode"?b[l]=[d]:b[l]=d),typeof p.id=="number"&&(d.id=p.id),p.name!==""&&(d.attrName=p.name),p.type!==""&&(d.attrType=p.type),this.pushStack(d)}parseNodeAttr(t){let r=t[0];t[0]!==""&&(r=parseInt(t[0]),isNaN(r)&&(r=t[0]));let l="",u="";return t.length>1&&(l=t[1].replace(/^(\w+)::/,""),u=t[2]),{id:r,name:l,type:u}}parseNodeProperty(t,r,l){let u=r[1].replace(/^"/,"").replace(/"$/,"").trim(),d=r[2].replace(/^"/,"").replace(/"$/,"").trim();u==="Content"&&d===","&&(d=l.replace(/"/g,"").replace(/,$/,"").trim());const p=this.getCurrentNode();if(p.name==="Properties70"){this.parseNodeSpecialProperty(t,u,d);return}if(u==="C"){const i=d.split(",").slice(1),E=parseInt(i[0]),T=parseInt(i[1]);let A=d.split(",").slice(3);A=A.map(function(I){return I.trim().replace(/^"/,"")}),u="connections",d=[E,T],w4(d,A),p[u]===void 0&&(p[u]=[])}u==="Node"&&(p.id=d),u in p&&Array.isArray(p[u])?p[u].push(d):u!=="a"?p[u]=d:p.a=d,this.setCurrentProp(p,u),u==="a"&&d.slice(-1)!==","&&(p.a=D0(d))}parseNodePropertyContinued(t){const r=this.getCurrentNode();r.a+=t,t.slice(-1)!==","&&(r.a=D0(r.a))}parseNodeSpecialProperty(t,r,l){const u=l.split('",').map(function(T){return T.trim().replace(/^\"/,"").replace(/\s/,"_")}),d=u[0],p=u[1],b=u[2],i=u[3];let E=u[4];switch(p){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":E=parseFloat(E);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":E=D0(E);break}this.getPrevNode()[d]={type:p,type2:b,flag:i,value:E},this.setCurrentProp(this.getPrevNode(),d)}}class _4{parse(t){const r=new kE(t);r.skip(23);const l=r.getUint32();if(l<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+l);const u=new dM;for(;!this.endOfContent(r);){const d=this.parseNode(r,l);d!==null&&u.add(d.name,d)}return u}endOfContent(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,r){const l={},u=r>=7500?t.getUint64():t.getUint32(),d=r>=7500?t.getUint64():t.getUint32();r>=7500?t.getUint64():t.getUint32();const p=t.getUint8(),b=t.getString(p);if(u===0)return null;const i=[];for(let I=0;I<d;I++)i.push(this.parseProperty(t));const E=i.length>0?i[0]:"",T=i.length>1?i[1]:"",A=i.length>2?i[2]:"";for(l.singleProperty=d===1&&t.getOffset()===u;u>t.getOffset();){const I=this.parseNode(t,r);I!==null&&this.parseSubNode(b,l,I)}return l.propertyList=i,typeof E=="number"&&(l.id=E),T!==""&&(l.attrName=T),A!==""&&(l.attrType=A),b!==""&&(l.name=b),l}parseSubNode(t,r,l){if(l.singleProperty===!0){const u=l.propertyList[0];Array.isArray(u)?(r[l.name]=l,l.a=u):r[l.name]=u}else if(t==="Connections"&&l.name==="C"){const u=[];l.propertyList.forEach(function(d,p){p!==0&&u.push(d)}),r.connections===void 0&&(r.connections=[]),r.connections.push(u)}else if(l.name==="Properties70")Object.keys(l).forEach(function(d){r[d]=l[d]});else if(t==="Properties70"&&l.name==="P"){let u=l.propertyList[0],d=l.propertyList[1];const p=l.propertyList[2],b=l.propertyList[3];let i;u.indexOf("Lcl ")===0&&(u=u.replace("Lcl ","Lcl_")),d.indexOf("Lcl ")===0&&(d=d.replace("Lcl ","Lcl_")),d==="Color"||d==="ColorRGB"||d==="Vector"||d==="Vector3D"||d.indexOf("Lcl_")===0?i=[l.propertyList[4],l.propertyList[5],l.propertyList[6]]:i=l.propertyList[4],r[u]={type:d,type2:p,flag:b,value:i}}else r[l.name]===void 0?typeof l.id=="number"?(r[l.name]={},r[l.name][l.id]=l):r[l.name]=l:l.name==="PoseNode"?(Array.isArray(r[l.name])||(r[l.name]=[r[l.name]]),r[l.name].push(l)):r[l.name][l.id]===void 0&&(r[l.name][l.id]=l)}parseProperty(t){const r=t.getString(1);let l;switch(r){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return l=t.getUint32(),t.getArrayBuffer(l);case"S":return l=t.getUint32(),t.getString(l);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const u=t.getUint32(),d=t.getUint32(),p=t.getUint32();if(d===0)switch(r){case"b":case"c":return t.getBooleanArray(u);case"d":return t.getFloat64Array(u);case"f":return t.getFloat32Array(u);case"i":return t.getInt32Array(u);case"l":return t.getInt64Array(u)}const b=_5(new Uint8Array(t.getArrayBuffer(p))),i=new kE(b.buffer);switch(r){case"b":case"c":return i.getBooleanArray(u);case"d":return i.getFloat64Array(u);case"f":return i.getFloat32Array(u);case"i":return i.getInt32Array(u);case"l":return i.getInt64Array(u)}default:throw new Error("THREE.FBXLoader: Unknown property type "+r)}}}class kE{constructor(t,r){this.dv=new DataView(t),this.offset=0,this.littleEndian=r!==void 0?r:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(t){const r=[];for(let l=0;l<t;l++)r.push(this.getBoolean());return r}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const r=[];for(let l=0;l<t;l++)r.push(this.getInt32());return r}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,r;return this.littleEndian?(t=this.getUint32(),r=this.getUint32()):(r=this.getUint32(),t=this.getUint32()),r&2147483648?(r=~r&4294967295,t=~t&4294967295,t===4294967295&&(r=r+1&4294967295),t=t+1&4294967295,-(r*4294967296+t)):r*4294967296+t}getInt64Array(t){const r=[];for(let l=0;l<t;l++)r.push(this.getInt64());return r}getUint64(){let t,r;return this.littleEndian?(t=this.getUint32(),r=this.getUint32()):(r=this.getUint32(),t=this.getUint32()),r*4294967296+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const r=[];for(let l=0;l<t;l++)r.push(this.getFloat32());return r}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const r=[];for(let l=0;l<t;l++)r.push(this.getFloat64());return r}getArrayBuffer(t){const r=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,r}getString(t){let r=[];for(let u=0;u<t;u++)r[u]=this.getUint8();const l=r.indexOf(0);return l>=0&&(r=r.slice(0,l)),Dl.decodeText(new Uint8Array(r))}}class dM{add(t,r){this[t]=r}}function y4(n){const t="Kaydara FBX Binary  \0";return n.byteLength>=t.length&&t===mM(n,0,t.length)}function v4(n){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;function l(u){const d=n[u-1];return n=n.slice(r+u),r++,d}for(let u=0;u<t.length;++u)if(l(1)===t[u])return!1;return!0}function zE(n){const t=/FBXVersion: (\d+)/,r=n.match(t);if(r)return parseInt(r[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function x4(n){return n/46186158e3}const b4=[];function Fg(n,t,r,l){let u;switch(l.mappingType){case"ByPolygonVertex":u=n;break;case"ByPolygon":u=t;break;case"ByVertice":u=r;break;case"AllSame":u=l.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+l.mappingType)}l.referenceType==="IndexToDirect"&&(u=l.indices[u]);const d=u*l.dataSize,p=d+l.dataSize;return E4(b4,l.buffer,d,p)}const R0=new gm,Sf=new Tt;function fM(n){const t=new Ci,r=new Ci,l=new Ci,u=new Ci,d=new Ci,p=new Ci,b=new Ci,i=new Ci,E=new Ci,T=new Ci,A=new Ci,I=new Ci,O=n.inheritType?n.inheritType:0;if(n.translation&&t.setPosition(Sf.fromArray(n.translation)),n.preRotation){const me=n.preRotation.map(fa.degToRad);me.push(n.eulerOrder),r.makeRotationFromEuler(R0.fromArray(me))}if(n.rotation){const me=n.rotation.map(fa.degToRad);me.push(n.eulerOrder),l.makeRotationFromEuler(R0.fromArray(me))}if(n.postRotation){const me=n.postRotation.map(fa.degToRad);me.push(n.eulerOrder),u.makeRotationFromEuler(R0.fromArray(me)),u.invert()}n.scale&&d.scale(Sf.fromArray(n.scale)),n.scalingOffset&&b.setPosition(Sf.fromArray(n.scalingOffset)),n.scalingPivot&&p.setPosition(Sf.fromArray(n.scalingPivot)),n.rotationOffset&&i.setPosition(Sf.fromArray(n.rotationOffset)),n.rotationPivot&&E.setPosition(Sf.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(A.copy(n.parentMatrix),T.copy(n.parentMatrixWorld));const z=r.clone().multiply(l).multiply(u),U=new Ci;U.extractRotation(T);const N=new Ci;N.copyPosition(T);const V=N.clone().invert().multiply(T),X=U.clone().invert().multiply(V),J=d,te=new Ci;if(O===0)te.copy(U).multiply(z).multiply(X).multiply(J);else if(O===1)te.copy(U).multiply(X).multiply(z).multiply(J);else{const Ne=new Ci().scale(new Tt().setFromMatrixScale(A)).clone().invert(),ht=X.clone().multiply(Ne);te.copy(U).multiply(z).multiply(ht).multiply(J)}const ue=E.clone().invert(),ae=p.clone().invert();let be=t.clone().multiply(i).multiply(E).multiply(r).multiply(l).multiply(u).multiply(ue).multiply(b).multiply(p).multiply(d).multiply(ae);const Ce=new Ci().copyPosition(be),je=T.clone().multiply(Ce);return I.copyPosition(je),be=I.clone().multiply(te),be.premultiply(T.invert()),be}function pM(n){n=n||0;const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[n]}function D0(n){return n.split(",").map(function(r){return parseFloat(r)})}function mM(n,t,r){return t===void 0&&(t=0),r===void 0&&(r=n.byteLength),Dl.decodeText(new Uint8Array(n,t,r))}function w4(n,t){for(let r=0,l=n.length,u=t.length;r<u;r++,l++)n[l]=t[r]}function E4(n,t,r,l){for(let u=r,d=0;u<l;u++,d++)n[d]=t[u];return n}function FE(n,t,r){return n.slice(0,t).concat(r).concat(n.slice(t))}const O0=new WeakMap;class C4 extends Jh{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,r,l,u){const d=new Tu(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(t,p=>{const b={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(p,b).then(r).catch(u)},l,u)}decodeDracoFile(t,r,l,u){const d={attributeIDs:l||this.defaultAttributeIDs,attributeTypes:u||this.defaultAttributeTypes,useUniqueIDs:!!l};this.decodeGeometry(t,d).then(r)}decodeGeometry(t,r){for(const i in r.attributeTypes){const E=r.attributeTypes[i];E.BYTES_PER_ELEMENT!==void 0&&(r.attributeTypes[i]=E.name)}const l=JSON.stringify(r);if(O0.has(t)){const i=O0.get(t);if(i.key===l)return i.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let u;const d=this.workerNextTaskID++,p=t.byteLength,b=this._getWorker(d,p).then(i=>(u=i,new Promise((E,T)=>{u._callbacks[d]={resolve:E,reject:T},u.postMessage({type:"decode",id:d,taskConfig:r,buffer:t},[t])}))).then(i=>this._createGeometry(i.geometry));return b.catch(()=>!0).then(()=>{u&&d&&this._releaseTask(u,d)}),O0.set(t,{key:l,promise:b}),b}_createGeometry(t){const r=new _l;t.index&&r.setIndex(new Vh(t.index.array,1));for(let l=0;l<t.attributes.length;l++){const u=t.attributes[l],d=u.name,p=u.array,b=u.itemSize;r.setAttribute(d,new Vh(p,b))}return r}_loadLibrary(t,r){const l=new Tu(this.manager);return l.setPath(this.decoderPath),l.setResponseType(r),l.setWithCredentials(this.withCredentials),new Promise((u,d)=>{l.load(t,u,void 0,d)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",r=[];return t?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then(l=>{const u=l[0];t||(this.decoderConfig.wasmBinary=l[1]);const d=A4.toString(),p=["/* draco decoder */",u,"","/* worker */",d.substring(d.indexOf("{")+1,d.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([p]))}),this.decoderPending}_getWorker(t,r){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const u=new Worker(this.workerSourceURL);u._callbacks={},u._taskCosts={},u._taskLoad=0,u.postMessage({type:"init",decoderConfig:this.decoderConfig}),u.onmessage=function(d){const p=d.data;switch(p.type){case"decode":u._callbacks[p.id].resolve(p);break;case"error":u._callbacks[p.id].reject(p);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+p.type+'"')}},this.workerPool.push(u)}else this.workerPool.sort(function(u,d){return u._taskLoad>d._taskLoad?-1:1});const l=this.workerPool[this.workerPool.length-1];return l._taskCosts[t]=r,l._taskLoad+=r,l})}_releaseTask(t,r){t._taskLoad-=t._taskCosts[r],delete t._callbacks[r],delete t._taskCosts[r]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function A4(){let n,t;onmessage=function(p){const b=p.data;switch(b.type){case"init":n=b.decoderConfig,t=new Promise(function(T){n.onModuleLoaded=function(A){T({draco:A})},DracoDecoderModule(n)});break;case"decode":const i=b.buffer,E=b.taskConfig;t.then(T=>{const A=T.draco,I=new A.Decoder,O=new A.DecoderBuffer;O.Init(new Int8Array(i),i.byteLength);try{const z=r(A,I,O,E),U=z.attributes.map(N=>N.array.buffer);z.index&&U.push(z.index.array.buffer),self.postMessage({type:"decode",id:b.id,geometry:z},U)}catch(z){console.error(z),self.postMessage({type:"error",id:b.id,error:z.message})}finally{A.destroy(O),A.destroy(I)}});break}};function r(p,b,i,E){const T=E.attributeIDs,A=E.attributeTypes;let I,O;const z=b.GetEncodedGeometryType(i);if(z===p.TRIANGULAR_MESH)I=new p.Mesh,O=b.DecodeBufferToMesh(i,I);else if(z===p.POINT_CLOUD)I=new p.PointCloud,O=b.DecodeBufferToPointCloud(i,I);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!O.ok()||I.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+O.error_msg());const U={index:null,attributes:[]};for(const N in T){const V=self[A[N]];let X,J;if(E.useUniqueIDs)J=T[N],X=b.GetAttributeByUniqueId(I,J);else{if(J=b.GetAttributeId(I,p[T[N]]),J===-1)continue;X=b.GetAttribute(I,J)}U.attributes.push(u(p,b,I,N,V,X))}return z===p.TRIANGULAR_MESH&&(U.index=l(p,b,I)),p.destroy(I),U}function l(p,b,i){const T=i.num_faces()*3,A=T*4,I=p._malloc(A);b.GetTrianglesUInt32Array(i,A,I);const O=new Uint32Array(p.HEAPF32.buffer,I,T).slice();return p._free(I),{array:O,itemSize:1}}function u(p,b,i,E,T,A){const I=A.num_components(),z=i.num_points()*I,U=z*T.BYTES_PER_ELEMENT,N=d(p,T),V=p._malloc(U);b.GetAttributeDataArrayForAllPoints(i,A,N,U,V);const X=new T(p.HEAPF32.buffer,V,z).slice();return p._free(V),{name:E,array:X,itemSize:I}}function d(p,b){switch(b){case Float32Array:return p.DT_FLOAT32;case Int8Array:return p.DT_INT8;case Int16Array:return p.DT_INT16;case Int32Array:return p.DT_INT32;case Uint8Array:return p.DT_UINT8;case Uint16Array:return p.DT_UINT16;case Uint32Array:return p.DT_UINT32}}}const jE=new dh,jg=new Tt;let J1=class extends zT{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],r=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],l=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(l),this.setAttribute("position",new Ti(t,3)),this.setAttribute("uv",new Ti(r,2))}applyMatrix4(t){const r=this.attributes.instanceStart,l=this.attributes.instanceEnd;return r!==void 0&&(r.applyMatrix4(t),l.applyMatrix4(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let r;t instanceof Float32Array?r=t:Array.isArray(t)&&(r=new Float32Array(t));const l=new np(r,6,1);return this.setAttribute("instanceStart",new zl(l,3,0)),this.setAttribute("instanceEnd",new zl(l,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t,r=3){let l;t instanceof Float32Array?l=t:Array.isArray(t)&&(l=new Float32Array(t));const u=new np(l,r*2,1);return this.setAttribute("instanceColorStart",new zl(u,r,0)),this.setAttribute("instanceColorEnd",new zl(u,r,r)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new FT(t.geometry)),this}fromLineSegments(t){const r=t.geometry;return this.setPositions(r.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new dh);const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;t!==void 0&&r!==void 0&&(this.boundingBox.setFromBufferAttribute(t),jE.setFromBufferAttribute(r),this.boundingBox.union(jE))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new dp),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(t!==void 0&&r!==void 0){const l=this.boundingSphere.center;this.boundingBox.getCenter(l);let u=0;for(let d=0,p=t.count;d<p;d++)jg.fromBufferAttribute(t,d),u=Math.max(u,l.distanceToSquared(jg)),jg.fromBufferAttribute(r,d),u=Math.max(u,l.distanceToSquared(jg));this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}},gM=class extends J1{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const r=t.length-3,l=new Float32Array(2*r);for(let u=0;u<r;u+=3)l[2*u]=t[u],l[2*u+1]=t[u+1],l[2*u+2]=t[u+2],l[2*u+3]=t[u+3],l[2*u+4]=t[u+4],l[2*u+5]=t[u+5];return super.setPositions(l),this}setColors(t,r=3){const l=t.length-r,u=new Float32Array(2*l);if(r===3)for(let d=0;d<l;d+=r)u[2*d]=t[d],u[2*d+1]=t[d+1],u[2*d+2]=t[d+2],u[2*d+3]=t[d+3],u[2*d+4]=t[d+4],u[2*d+5]=t[d+5];else for(let d=0;d<l;d+=r)u[2*d]=t[d],u[2*d+1]=t[d+1],u[2*d+2]=t[d+2],u[2*d+3]=t[d+3],u[2*d+4]=t[d+4],u[2*d+5]=t[d+5],u[2*d+6]=t[d+6],u[2*d+7]=t[d+7];return super.setColors(u,r),this}fromLine(t){const r=t.geometry;return this.setPositions(r.attributes.position.array),this}},Y1=class extends w1{constructor(t){super({type:"LineMaterial",uniforms:Sm.clone(Sm.merge([qf.common,qf.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Zo(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${parseInt(v1.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(r){this.uniforms.diffuse.value=r}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(r){r===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(r){this.uniforms.linewidth.value=r}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(r){!!r!="USE_DASH"in this.defines&&(this.needsUpdate=!0),r===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(r){this.uniforms.dashScale.value=r}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(r){this.uniforms.dashSize.value=r}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(r){this.uniforms.dashOffset.value=r}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(r){this.uniforms.gapSize.value=r}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(r){this.uniforms.opacity.value=r}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(r){this.uniforms.resolution.value.copy(r)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(r){!!r!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),r===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};const UE=new Tt,NE=new Tt,Us=new za,Ns=new za,gu=new za,k0=new Tt,z0=new Ci,ha=new jT,GE=new Tt,Ug=new dh,Ng=new dp,_u=new za;let Eu,Nv,_M,Ld;function VE(n,t,r){return _u.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),_u.multiplyScalar(1/_u.w),_u.x=Ld/r.width,_u.y=Ld/r.height,_u.applyMatrix4(n.projectionMatrixInverse),_u.multiplyScalar(1/_u.w),Math.abs(Math.max(_u.x,_u.y))}function T4(n,t){for(let r=0,l=Nv.count;r<l;r++){ha.start.fromBufferAttribute(Nv,r),ha.end.fromBufferAttribute(_M,r);const u=new Tt,d=new Tt;Eu.distanceSqToSegment(ha.start,ha.end,d,u),d.distanceTo(u)<Ld*.5&&t.push({point:d,pointOnLine:u,distance:Eu.origin.distanceTo(d),object:n,face:null,faceIndex:r,uv:null,uv2:null})}}function S4(n,t,r){const l=t.projectionMatrix,d=n.material.resolution,p=n.matrixWorld,b=n.geometry,i=b.attributes.instanceStart,E=b.attributes.instanceEnd,T=-t.near;Eu.at(1,gu),gu.w=1,gu.applyMatrix4(t.matrixWorldInverse),gu.applyMatrix4(l),gu.multiplyScalar(1/gu.w),gu.x*=d.x/2,gu.y*=d.y/2,gu.z=0,k0.copy(gu),z0.multiplyMatrices(t.matrixWorldInverse,p);for(let A=0,I=i.count;A<I;A++){if(Us.fromBufferAttribute(i,A),Ns.fromBufferAttribute(E,A),Us.w=1,Ns.w=1,Us.applyMatrix4(z0),Ns.applyMatrix4(z0),Us.z>T&&Ns.z>T)continue;if(Us.z>T){const X=Us.z-Ns.z,J=(Us.z-T)/X;Us.lerp(Ns,J)}else if(Ns.z>T){const X=Ns.z-Us.z,J=(Ns.z-T)/X;Ns.lerp(Us,J)}Us.applyMatrix4(l),Ns.applyMatrix4(l),Us.multiplyScalar(1/Us.w),Ns.multiplyScalar(1/Ns.w),Us.x*=d.x/2,Us.y*=d.y/2,Ns.x*=d.x/2,Ns.y*=d.y/2,ha.start.copy(Us),ha.start.z=0,ha.end.copy(Ns),ha.end.z=0;const z=ha.closestPointToPointParameter(k0,!0);ha.at(z,GE);const U=fa.lerp(Us.z,Ns.z,z),N=U>=-1&&U<=1,V=k0.distanceTo(GE)<Ld*.5;if(N&&V){ha.start.fromBufferAttribute(i,A),ha.end.fromBufferAttribute(E,A),ha.start.applyMatrix4(p),ha.end.applyMatrix4(p);const X=new Tt,J=new Tt;Eu.distanceSqToSegment(ha.start,ha.end,J,X),r.push({point:J,pointOnLine:X,distance:Eu.origin.distanceTo(J),object:n,face:null,faceIndex:A,uv:null,uv2:null})}}}let yM=class extends Oa{constructor(t=new J1,r=new Y1({color:Math.random()*16777215})){super(t,r),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,r=t.attributes.instanceStart,l=t.attributes.instanceEnd,u=new Float32Array(2*r.count);for(let p=0,b=0,i=r.count;p<i;p++,b+=2)UE.fromBufferAttribute(r,p),NE.fromBufferAttribute(l,p),u[b]=b===0?0:u[b-1],u[b+1]=u[b]+UE.distanceTo(NE);const d=new np(u,2,1);return t.setAttribute("instanceDistanceStart",new zl(d,1,0)),t.setAttribute("instanceDistanceEnd",new zl(d,1,1)),this}raycast(t,r){const l=this.material.worldUnits,u=t.camera;u===null&&!l&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const d=t.params.Line2!==void 0&&t.params.Line2.threshold||0;Eu=t.ray;const p=this.matrixWorld,b=this.geometry,i=this.material;Ld=i.linewidth+d,Nv=b.attributes.instanceStart,_M=b.attributes.instanceEnd,b.boundingSphere===null&&b.computeBoundingSphere(),Ng.copy(b.boundingSphere).applyMatrix4(p);let E;if(l)E=Ld*.5;else{const A=Math.max(u.near,Ng.distanceToPoint(Eu.origin));E=VE(u,A,i.resolution)}if(Ng.radius+=E,Eu.intersectsSphere(Ng)===!1)return;b.boundingBox===null&&b.computeBoundingBox(),Ug.copy(b.boundingBox).applyMatrix4(p);let T;if(l)T=Ld*.5;else{const A=Math.max(u.near,Ug.distanceToPoint(Eu.origin));T=VE(u,A,i.resolution)}Ug.expandByScalar(T),Eu.intersectsBox(Ug)!==!1&&(l?T4(this,r):S4(this,u,r))}},M4=class extends yM{constructor(t=new gM,r=new Y1({color:Math.random()*16777215})){super(t,r),this.isLine2=!0,this.type="Line2"}},Gg;const F0=()=>{if(Gg)return Gg;const n="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",t="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),l=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let u=n;WebAssembly.validate(r)&&(u=t);let d;const p=WebAssembly.instantiate(b(u),{}).then(A=>{d=A.instance,d.exports.__wasm_call_ctors()});function b(A){const I=new Uint8Array(A.length);for(let z=0;z<A.length;++z){const U=A.charCodeAt(z);I[z]=U>96?U-71:U>64?U-65:U>47?U+4:U>46?63:62}let O=0;for(let z=0;z<A.length;++z)I[O++]=I[z]<60?l[I[z]]:(I[z]-60)*64+I[++z];return I.buffer.slice(0,O)}function i(A,I,O,z,U,N){const V=d.exports.sbrk,X=O+3&-4,J=V(X*z),te=V(U.length),ue=new Uint8Array(d.exports.memory.buffer);ue.set(U,te);const ae=A(J,O,z,te,U.length);if(ae===0&&N&&N(J,X,z),I.set(ue.subarray(J,J+O*z)),V(J-V(0)),ae!==0)throw new Error(`Malformed buffer data: ${ae}`)}const E={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},T={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Gg={ready:p,supported:!0,decodeVertexBuffer(A,I,O,z,U){i(d.exports.meshopt_decodeVertexBuffer,A,I,O,z,d.exports[E[U]])},decodeIndexBuffer(A,I,O,z){i(d.exports.meshopt_decodeIndexBuffer,A,I,O,z)},decodeIndexSequence(A,I,O,z){i(d.exports.meshopt_decodeIndexSequence,A,I,O,z)},decodeGltfBuffer(A,I,O,z,U,N){i(d.exports[T[U]],A,I,O,z,d.exports[E[N]])}},Gg};function X_(n,t){if(Object.is(n,t))return!0;if(typeof n!="object"||n===null||typeof t!="object"||t===null)return!1;const r=Object.keys(n);if(r.length!==Object.keys(t).length)return!1;for(let l=0;l<r.length;l++)if(!Object.prototype.hasOwnProperty.call(t,r[l])||!Object.is(n[r[l]],t[r[l]]))return!1;return!0}const I4=k.forwardRef(function({points:t,color:r=16777215,vertexColors:l,linewidth:u,lineWidth:d,segments:p,dashed:b,...i},E){var T,A;const I=ar(V=>V.size),O=k.useMemo(()=>p?new yM:new M4,[p]),[z]=k.useState(()=>new Y1),U=(l==null||(T=l[0])==null?void 0:T.length)===4?4:3,N=k.useMemo(()=>{const V=p?new J1:new gM,X=t.map(J=>{const te=Array.isArray(J);return J instanceof Tt||J instanceof za?[J.x,J.y,J.z]:J instanceof Zo?[J.x,J.y,0]:te&&J.length===3?[J[0],J[1],J[2]]:te&&J.length===2?[J[0],J[1],0]:J});if(V.setPositions(X.flat()),l){r=16777215;const J=l.map(te=>te instanceof Ai?te.toArray():te);V.setColors(J.flat(),U)}return V},[t,p,l,U]);return k.useLayoutEffect(()=>{O.computeLineDistances()},[t,O]),k.useLayoutEffect(()=>{b?z.defines.USE_DASH="":delete z.defines.USE_DASH,z.needsUpdate=!0},[b,z]),k.useEffect(()=>()=>N.dispose(),[N]),k.createElement("primitive",Gr({object:O,ref:E},i),k.createElement("primitive",{object:N,attach:"geometry"}),k.createElement("primitive",Gr({object:z,attach:"material",color:r,vertexColors:!!l,resolution:[I.width,I.height],linewidth:(A=u??d)!==null&&A!==void 0?A:1,dashed:b,transparent:U===4},i)))});function P4(n,t,r,l){const u=class extends w1{constructor(p={}){const b=Object.entries(n);super({uniforms:b.reduce((i,[E,T])=>{const A=Sm.clone({[E]:{value:T}});return{...i,...A}},{}),vertexShader:t,fragmentShader:r}),this.key="",b.forEach(([i])=>Object.defineProperty(this,i,{get:()=>this.uniforms[i].value,set:E=>this.uniforms[i].value=E})),Object.assign(this,p)}};return u.key=fa.generateUUID(),u}const L4=()=>parseInt(v1.replace(/\D+/g,"")),B4=L4();let Vg=null,vM="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function xM(n,t,r){return l=>{r&&r(l),n&&(Vg||(Vg=new C4),Vg.setDecoderPath(typeof n=="string"?n:vM),l.setDRACOLoader(Vg)),t&&l.setMeshoptDecoder(typeof F0=="function"?F0():F0)}}function q_(n,t=!0,r=!0,l){return ka(K1,n,xM(t,r,l))}q_.preload=(n,t=!0,r=!0,l)=>ka.preload(K1,n,xM(t,r,l));q_.clear=n=>ka.clear(K1,n);q_.setDecoderPath=n=>{vM=n};function R4(n,t,r){const l=ar(I=>I.size),u=ar(I=>I.viewport),d=typeof n=="number"?n:l.width*u.dpr,p=l.height*u.dpr,b=(typeof n=="number"?r:n)||{},{samples:i=0,depth:E,...T}=b,A=k.useMemo(()=>{const I=new gR(d,p,{minFilter:h_,magFilter:h_,type:_R,...T});return E&&(I.depthTexture=new yR(d,p,vR)),I.samples=i,I},[]);return k.useLayoutEffect(()=>{A.setSize(d,p),i&&(A.samples=i)},[i,A,d,p]),k.useEffect(()=>()=>A.dispose(),[]),A}const D4=n=>typeof n=="function",O4=k.forwardRef(({envMap:n,resolution:t=256,frames:r=1/0,children:l,makeDefault:u,...d},p)=>{const b=ar(({set:N})=>N),i=ar(({camera:N})=>N),E=ar(({size:N})=>N),T=k.useRef(null);k.useImperativeHandle(p,()=>T.current,[]);const A=k.useRef(null),I=R4(t);k.useLayoutEffect(()=>{d.manual||T.current.updateProjectionMatrix()},[E,d]),k.useLayoutEffect(()=>{T.current.updateProjectionMatrix()}),k.useLayoutEffect(()=>{if(u){const N=i;return b(()=>({camera:T.current})),()=>b(()=>({camera:N}))}},[T,u,b]);let O=0,z=null;const U=D4(l);return mc(N=>{U&&(r===1/0||O<r)&&(A.current.visible=!1,N.gl.setRenderTarget(I),z=N.scene.background,n&&(N.scene.background=n),N.gl.render(N.scene,T.current),N.scene.background=z,N.gl.setRenderTarget(null),A.current.visible=!0,O++)}),k.createElement(k.Fragment,null,k.createElement("orthographicCamera",Gr({left:E.width/-2,right:E.width/2,top:E.height/2,bottom:E.height/-2,ref:T},d),!U&&l),k.createElement("group",{ref:A},U&&l(I.texture)))}),k4=k.forwardRef(({makeDefault:n,camera:t,regress:r,domElement:l,enableDamping:u=!0,keyEvents:d=!1,onChange:p,onStart:b,onEnd:i,...E},T)=>{const A=ar(ae=>ae.invalidate),I=ar(ae=>ae.camera),O=ar(ae=>ae.gl),z=ar(ae=>ae.events),U=ar(ae=>ae.setEvents),N=ar(ae=>ae.set),V=ar(ae=>ae.get),X=ar(ae=>ae.performance),J=t||I,te=l||z.connected||O.domElement,ue=k.useMemo(()=>new E5(J),[J]);return mc(()=>{ue.enabled&&ue.update()},-1),k.useEffect(()=>(d&&ue.connect(d===!0?te:d),ue.connect(te),()=>void ue.dispose()),[d,te,r,ue,A]),k.useEffect(()=>{const ae=je=>{A(),r&&X.regress(),p&&p(je)},be=je=>{b&&b(je)},Ce=je=>{i&&i(je)};return ue.addEventListener("change",ae),ue.addEventListener("start",be),ue.addEventListener("end",Ce),()=>{ue.removeEventListener("start",be),ue.removeEventListener("end",Ce),ue.removeEventListener("change",ae)}},[p,b,i,ue,A,U]),k.useEffect(()=>{if(n){const ae=V().controls;return N({controls:ue}),()=>N({controls:ae})}},[n,ue]),k.createElement("primitive",Gr({ref:T,object:ue,enableDamping:u},E))});/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const go={LEFT:1,RIGHT:2,MIDDLE:4},St=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Mf={NONE:0,IN:1,OUT:-1};function xd(n){return n.isPerspectiveCamera}function jh(n){return n.isOrthographicCamera}const If=Math.PI*2,$E=Math.PI/2,bM=1e-5,sm=Math.PI/180;function zc(n,t,r){return Math.max(t,Math.min(r,n))}function Vi(n,t=bM){return Math.abs(n)<t}function bi(n,t,r=bM){return Vi(n-t,r)}function HE(n,t){return Math.round(n/t)*t}function am(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function lm(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function $g(n,t,r,l,u=1/0,d){l=Math.max(1e-4,l);const p=2/l,b=p*d,i=1/(1+b+.48*b*b+.235*b*b*b);let E=n-t;const T=t,A=u*l;E=zc(E,-A,A),t=n-E;const I=(r.value+p*E)*d;r.value=(r.value-p*I)*i;let O=t+(E+I)*i;return T-n>0==O>T&&(O=T,r.value=(O-T)/d),O}function WE(n,t,r,l,u=1/0,d,p){l=Math.max(1e-4,l);const b=2/l,i=b*d,E=1/(1+i+.48*i*i+.235*i*i*i);let T=t.x,A=t.y,I=t.z,O=n.x-T,z=n.y-A,U=n.z-I;const N=T,V=A,X=I,J=u*l,te=J*J,ue=O*O+z*z+U*U;if(ue>te){const Kt=Math.sqrt(ue);O=O/Kt*J,z=z/Kt*J,U=U/Kt*J}T=n.x-O,A=n.y-z,I=n.z-U;const ae=(r.x+b*O)*d,be=(r.y+b*z)*d,Ce=(r.z+b*U)*d;r.x=(r.x-b*ae)*E,r.y=(r.y-b*be)*E,r.z=(r.z-b*Ce)*E,p.x=T+(O+ae)*E,p.y=A+(z+be)*E,p.z=I+(U+Ce)*E;const je=N-n.x,me=V-n.y,Ne=X-n.z,ht=p.x-N,_t=p.y-V,Bt=p.z-X;return je*ht+me*_t+Ne*Bt>0&&(p.x=N,p.y=V,p.z=X,r.x=(p.x-N)/d,r.y=(p.y-V)/d,r.z=(p.z-X)/d),p}function j0(n,t){t.set(0,0),n.forEach(r=>{t.x+=r.clientX,t.y+=r.clientY}),t.x/=n.length,t.y/=n.length}function U0(n,t){return jh(n)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class z4{constructor(){this._listeners={}}addEventListener(t,r){const l=this._listeners;l[t]===void 0&&(l[t]=[]),l[t].indexOf(r)===-1&&l[t].push(r)}hasEventListener(t,r){const l=this._listeners;return l[t]!==void 0&&l[t].indexOf(r)!==-1}removeEventListener(t,r){const u=this._listeners[t];if(u!==void 0){const d=u.indexOf(r);d!==-1&&u.splice(d,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const l=this._listeners[t.type];if(l!==void 0){t.target=this;const u=l.slice(0);for(let d=0,p=u.length;d<p;d++)u[d].call(this,t)}}}var N0;const F4="2.8.3",Hg=1/8,j4=/Mac/.test((N0=globalThis==null?void 0:globalThis.navigator)===null||N0===void 0?void 0:N0.platform);let er,ZE,Wg,G0,dl,yr,ai,Pf,cm,yu,vu,bd,XE,qE,tc,um,Lf,KE,V0,JE,$0,H0,Zg,Yf=class Gv extends z4{static install(t){er=t.THREE,ZE=Object.freeze(new er.Vector3(0,0,0)),Wg=Object.freeze(new er.Vector3(0,1,0)),G0=Object.freeze(new er.Vector3(0,0,1)),dl=new er.Vector2,yr=new er.Vector3,ai=new er.Vector3,Pf=new er.Vector3,cm=new er.Vector3,yu=new er.Vector3,vu=new er.Vector3,bd=new er.Vector3,XE=new er.Vector3,qE=new er.Vector3,tc=new er.Spherical,um=new er.Spherical,Lf=new er.Box3,KE=new er.Box3,V0=new er.Sphere,JE=new er.Quaternion,$0=new er.Quaternion,H0=new er.Matrix4,Zg=new er.Raycaster}static get ACTION(){return St}constructor(t,r){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=St.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Mf.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new er.Vector3,this._focalOffsetVelocity=new er.Vector3,this._zoomVelocity={value:0},this._truckInternal=(V,X,J)=>{let te,ue;if(xd(this._camera)){const ae=yr.copy(this._camera.position).sub(this._target),be=this._camera.getEffectiveFOV()*sm,Ce=ae.length()*Math.tan(be*.5);te=this.truckSpeed*V*Ce/this._elementRect.height,ue=this.truckSpeed*X*Ce/this._elementRect.height}else if(jh(this._camera)){const ae=this._camera;te=V*(ae.right-ae.left)/ae.zoom/this._elementRect.width,ue=X*(ae.top-ae.bottom)/ae.zoom/this._elementRect.height}else return;this.verticalDragToForward?(J?this.setFocalOffset(this._focalOffsetEnd.x+te,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(te,0,!0),this.forward(-ue,!0)):J?this.setFocalOffset(this._focalOffsetEnd.x+te,this._focalOffsetEnd.y+ue,this._focalOffsetEnd.z,!0):this.truck(te,ue,!0)},this._rotateInternal=(V,X)=>{const J=If*this.azimuthRotateSpeed*V/this._elementRect.height,te=If*this.polarRotateSpeed*X/this._elementRect.height;this.rotate(J,te,!0)},this._dollyInternal=(V,X,J)=>{const te=Math.pow(.95,-V*this.dollySpeed),ue=this._sphericalEnd.radius,ae=this._sphericalEnd.radius*te,be=zc(ae,this.minDistance,this.maxDistance),Ce=be-ae;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(ae,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(Ce,!0),this._dollyToNoClamp(be,!0)):this._dollyToNoClamp(be,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?ae:be)-ue,this._dollyControlCoord.set(X,J)),this._lastDollyDirection=Math.sign(-V)},this._zoomInternal=(V,X,J)=>{const te=Math.pow(.95,V*this.dollySpeed),ue=this._zoom,ae=this._zoom*te;this.zoomTo(ae,!0),this.dollyToCursor&&(this._changedZoom+=ae-ue,this._dollyControlCoord.set(X,J))},typeof er>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new er.Quaternion().setFromUnitVectors(this._camera.up,Wg),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=St.NONE,this._target=new er.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new er.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new er.Spherical().setFromVector3(yr.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new er.Vector3,new er.Vector3,new er.Vector3,new er.Vector3],this._updateNearPlaneCorners(),this._boundary=new er.Box3(new er.Vector3(-1/0,-1/0,-1/0),new er.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new er.Vector2,this.mouseButtons={left:St.ROTATE,middle:St.DOLLY,right:St.TRUCK,wheel:xd(this._camera)?St.DOLLY:jh(this._camera)?St.ZOOM:St.NONE},this.touches={one:St.TOUCH_ROTATE,two:xd(this._camera)?St.TOUCH_DOLLY_TRUCK:jh(this._camera)?St.TOUCH_ZOOM_TRUCK:St.NONE,three:St.TOUCH_TRUCK};const l=new er.Vector2,u=new er.Vector2,d=new er.Vector2,p=V=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const te=this._domElement.getBoundingClientRect(),ue=V.clientX/te.width,ae=V.clientY/te.height;if(ue<this._interactiveArea.left||ue>this._interactiveArea.right||ae<this._interactiveArea.top||ae>this._interactiveArea.bottom)return}const X=V.pointerType!=="mouse"?null:(V.buttons&go.LEFT)===go.LEFT?go.LEFT:(V.buttons&go.MIDDLE)===go.MIDDLE?go.MIDDLE:(V.buttons&go.RIGHT)===go.RIGHT?go.RIGHT:null;if(X!==null){const te=this._findPointerByMouseButton(X);te&&this._disposePointer(te)}if((V.buttons&go.LEFT)===go.LEFT&&this._lockedPointer)return;const J={pointerId:V.pointerId,clientX:V.clientX,clientY:V.clientY,deltaX:0,deltaY:0,mouseButton:X};this._activePointers.push(J),this._domElement.ownerDocument.removeEventListener("pointermove",b,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",i),this._domElement.ownerDocument.addEventListener("pointermove",b,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",i),this._isDragging=!0,I(V)},b=V=>{V.cancelable&&V.preventDefault();const X=V.pointerId,J=this._lockedPointer||this._findPointerById(X);if(J){if(J.clientX=V.clientX,J.clientY=V.clientY,J.deltaX=V.movementX,J.deltaY=V.movementY,this._state=0,V.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(V.buttons&go.LEFT)===go.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(V.buttons&go.MIDDLE)===go.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(V.buttons&go.RIGHT)===go.RIGHT&&(this._state=this._state|this.mouseButtons.right);O()}},i=V=>{const X=this._findPointerById(V.pointerId);if(!(X&&X===this._lockedPointer)){if(X&&this._disposePointer(X),V.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=St.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=St.NONE;z()}};let E=-1;const T=V=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===St.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const ae=this._domElement.getBoundingClientRect(),be=V.clientX/ae.width,Ce=V.clientY/ae.height;if(be<this._interactiveArea.left||be>this._interactiveArea.right||Ce<this._interactiveArea.top||Ce>this._interactiveArea.bottom)return}if(V.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===St.ROTATE||this.mouseButtons.wheel===St.TRUCK){const ae=performance.now();E-ae<1e3&&this._getClientRect(this._elementRect),E=ae}const X=j4?-1:-3,J=V.deltaMode===1?V.deltaY/X:V.deltaY/(X*10),te=this.dollyToCursor?(V.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,ue=this.dollyToCursor?(V.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case St.ROTATE:{this._rotateInternal(V.deltaX,V.deltaY),this._isUserControllingRotate=!0;break}case St.TRUCK:{this._truckInternal(V.deltaX,V.deltaY,!1),this._isUserControllingTruck=!0;break}case St.OFFSET:{this._truckInternal(V.deltaX,V.deltaY,!0),this._isUserControllingOffset=!0;break}case St.DOLLY:{this._dollyInternal(-J,te,ue),this._isUserControllingDolly=!0;break}case St.ZOOM:{this._zoomInternal(-J,te,ue),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},A=V=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Gv.ACTION.NONE){const X=V instanceof PointerEvent?V.pointerId:0,J=this._findPointerById(X);J&&this._disposePointer(J),this._domElement.ownerDocument.removeEventListener("pointermove",b,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",i);return}V.preventDefault()}},I=V=>{if(!this._enabled)return;if(j0(this._activePointers,dl),this._getClientRect(this._elementRect),l.copy(dl),u.copy(dl),this._activePointers.length>=2){const J=dl.x-this._activePointers[1].clientX,te=dl.y-this._activePointers[1].clientY,ue=Math.sqrt(J*J+te*te);d.set(0,ue);const ae=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,be=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;u.set(ae,be)}if(this._state=0,!V)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in V&&V.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(V.buttons&go.LEFT)===go.LEFT&&(this._state=this._state|this.mouseButtons.left),(V.buttons&go.MIDDLE)===go.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(V.buttons&go.RIGHT)===go.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&St.ROTATE)===St.ROTATE||(this._state&St.TOUCH_ROTATE)===St.TOUCH_ROTATE||(this._state&St.TOUCH_DOLLY_ROTATE)===St.TOUCH_DOLLY_ROTATE||(this._state&St.TOUCH_ZOOM_ROTATE)===St.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&St.TRUCK)===St.TRUCK||(this._state&St.TOUCH_TRUCK)===St.TOUCH_TRUCK||(this._state&St.TOUCH_DOLLY_TRUCK)===St.TOUCH_DOLLY_TRUCK||(this._state&St.TOUCH_ZOOM_TRUCK)===St.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&St.DOLLY)===St.DOLLY||(this._state&St.TOUCH_DOLLY)===St.TOUCH_DOLLY||(this._state&St.TOUCH_DOLLY_TRUCK)===St.TOUCH_DOLLY_TRUCK||(this._state&St.TOUCH_DOLLY_OFFSET)===St.TOUCH_DOLLY_OFFSET||(this._state&St.TOUCH_DOLLY_ROTATE)===St.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&St.ZOOM)===St.ZOOM||(this._state&St.TOUCH_ZOOM)===St.TOUCH_ZOOM||(this._state&St.TOUCH_ZOOM_TRUCK)===St.TOUCH_ZOOM_TRUCK||(this._state&St.TOUCH_ZOOM_OFFSET)===St.TOUCH_ZOOM_OFFSET||(this._state&St.TOUCH_ZOOM_ROTATE)===St.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&St.OFFSET)===St.OFFSET||(this._state&St.TOUCH_OFFSET)===St.TOUCH_OFFSET||(this._state&St.TOUCH_DOLLY_OFFSET)===St.TOUCH_DOLLY_OFFSET||(this._state&St.TOUCH_ZOOM_OFFSET)===St.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},O=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,j0(this._activePointers,dl);const X=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,J=X?-X.deltaX:u.x-dl.x,te=X?-X.deltaY:u.y-dl.y;if(u.copy(dl),((this._state&St.ROTATE)===St.ROTATE||(this._state&St.TOUCH_ROTATE)===St.TOUCH_ROTATE||(this._state&St.TOUCH_DOLLY_ROTATE)===St.TOUCH_DOLLY_ROTATE||(this._state&St.TOUCH_ZOOM_ROTATE)===St.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(J,te),this._isUserControllingRotate=!0),(this._state&St.DOLLY)===St.DOLLY||(this._state&St.ZOOM)===St.ZOOM){const ue=this.dollyToCursor?(l.x-this._elementRect.x)/this._elementRect.width*2-1:0,ae=this.dollyToCursor?(l.y-this._elementRect.y)/this._elementRect.height*-2+1:0,be=this.dollyDragInverted?-1:1;(this._state&St.DOLLY)===St.DOLLY?(this._dollyInternal(be*te*Hg,ue,ae),this._isUserControllingDolly=!0):(this._zoomInternal(be*te*Hg,ue,ae),this._isUserControllingZoom=!0)}if((this._state&St.TOUCH_DOLLY)===St.TOUCH_DOLLY||(this._state&St.TOUCH_ZOOM)===St.TOUCH_ZOOM||(this._state&St.TOUCH_DOLLY_TRUCK)===St.TOUCH_DOLLY_TRUCK||(this._state&St.TOUCH_ZOOM_TRUCK)===St.TOUCH_ZOOM_TRUCK||(this._state&St.TOUCH_DOLLY_OFFSET)===St.TOUCH_DOLLY_OFFSET||(this._state&St.TOUCH_ZOOM_OFFSET)===St.TOUCH_ZOOM_OFFSET||(this._state&St.TOUCH_DOLLY_ROTATE)===St.TOUCH_DOLLY_ROTATE||(this._state&St.TOUCH_ZOOM_ROTATE)===St.TOUCH_ZOOM_ROTATE){const ue=dl.x-this._activePointers[1].clientX,ae=dl.y-this._activePointers[1].clientY,be=Math.sqrt(ue*ue+ae*ae),Ce=d.y-be;d.set(0,be);const je=this.dollyToCursor?(u.x-this._elementRect.x)/this._elementRect.width*2-1:0,me=this.dollyToCursor?(u.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&St.TOUCH_DOLLY)===St.TOUCH_DOLLY||(this._state&St.TOUCH_DOLLY_ROTATE)===St.TOUCH_DOLLY_ROTATE||(this._state&St.TOUCH_DOLLY_TRUCK)===St.TOUCH_DOLLY_TRUCK||(this._state&St.TOUCH_DOLLY_OFFSET)===St.TOUCH_DOLLY_OFFSET?(this._dollyInternal(Ce*Hg,je,me),this._isUserControllingDolly=!0):(this._zoomInternal(Ce*Hg,je,me),this._isUserControllingZoom=!0)}((this._state&St.TRUCK)===St.TRUCK||(this._state&St.TOUCH_TRUCK)===St.TOUCH_TRUCK||(this._state&St.TOUCH_DOLLY_TRUCK)===St.TOUCH_DOLLY_TRUCK||(this._state&St.TOUCH_ZOOM_TRUCK)===St.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(J,te,!1),this._isUserControllingTruck=!0),((this._state&St.OFFSET)===St.OFFSET||(this._state&St.TOUCH_OFFSET)===St.TOUCH_OFFSET||(this._state&St.TOUCH_DOLLY_OFFSET)===St.TOUCH_DOLLY_OFFSET||(this._state&St.TOUCH_ZOOM_OFFSET)===St.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(J,te,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},z=()=>{j0(this._activePointers,dl),u.copy(dl),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",b,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",i),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",b,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",i),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",U),this._domElement.ownerDocument.addEventListener("pointerlockerror",N),this._domElement.ownerDocument.addEventListener("pointermove",b,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",i),I())},this.unlockPointer=()=>{var V,X,J;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(V=this._domElement)===null||V===void 0||V.ownerDocument.exitPointerLock(),(X=this._domElement)===null||X===void 0||X.ownerDocument.removeEventListener("pointerlockchange",U),(J=this._domElement)===null||J===void 0||J.ownerDocument.removeEventListener("pointerlockerror",N),this.cancel()};const U=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},N=()=>{this.unlockPointer()};this._addAllEventListeners=V=>{this._domElement=V,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",p),this._domElement.addEventListener("pointercancel",i),this._domElement.addEventListener("wheel",T,{passive:!1}),this._domElement.addEventListener("contextmenu",A)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",p),this._domElement.removeEventListener("pointercancel",i),this._domElement.removeEventListener("wheel",T,{passive:!1}),this._domElement.removeEventListener("contextmenu",A),this._domElement.ownerDocument.removeEventListener("pointermove",b,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",i),this._domElement.ownerDocument.removeEventListener("pointerlockchange",U),this._domElement.ownerDocument.removeEventListener("pointerlockerror",N))},this.cancel=()=>{this._state!==St.NONE&&(this._state=St.NONE,this._activePointers.length=0,z())},r&&this.connect(r),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=zc(t.width,0,1),this._interactiveArea.height=zc(t.height,0,1),this._interactiveArea.x=zc(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=zc(t.y,0,1-this._interactiveArea.height)}addEventListener(t,r){super.addEventListener(t,r)}removeEventListener(t,r){super.removeEventListener(t,r)}rotate(t,r,l=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+r,l)}rotateAzimuthTo(t,r=!1){return this.rotateTo(t,this._sphericalEnd.phi,r)}rotatePolarTo(t,r=!1){return this.rotateTo(this._sphericalEnd.theta,t,r)}rotateTo(t,r,l=!1){this._isUserControllingRotate=!1;const u=zc(t,this.minAzimuthAngle,this.maxAzimuthAngle),d=zc(r,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=u,this._sphericalEnd.phi=d,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,l||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const p=!l||bi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&bi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(p)}dolly(t,r=!1){return this.dollyTo(this._sphericalEnd.radius-t,r)}dollyTo(t,r=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Mf.NONE,this._changedDolly=0,this._dollyToNoClamp(zc(t,this.minDistance,this.maxDistance),r)}_dollyToNoClamp(t,r=!1){const l=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const p=this._collisionTest(),b=bi(p,this._spherical.radius);if(!(l>t)&&b)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,p)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,r||(this._spherical.radius=this._sphericalEnd.radius);const d=!r||bi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(d)}dollyInFixed(t,r=!1){this._targetEnd.add(this._getCameraDirection(cm).multiplyScalar(t)),r||this._target.copy(this._targetEnd);const l=!r||bi(this._target.x,this._targetEnd.x,this.restThreshold)&&bi(this._target.y,this._targetEnd.y,this.restThreshold)&&bi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(l)}zoom(t,r=!1){return this.zoomTo(this._zoomEnd+t,r)}zoomTo(t,r=!1){this._isUserControllingZoom=!1,this._zoomEnd=zc(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,r||(this._zoom=this._zoomEnd);const l=!r||bi(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(l)}pan(t,r,l=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,r,l)}truck(t,r,l=!1){this._camera.updateMatrix(),yu.setFromMatrixColumn(this._camera.matrix,0),vu.setFromMatrixColumn(this._camera.matrix,1),yu.multiplyScalar(t),vu.multiplyScalar(-r);const u=yr.copy(yu).add(vu),d=ai.copy(this._targetEnd).add(u);return this.moveTo(d.x,d.y,d.z,l)}forward(t,r=!1){yr.setFromMatrixColumn(this._camera.matrix,0),yr.crossVectors(this._camera.up,yr),yr.multiplyScalar(t);const l=ai.copy(this._targetEnd).add(yr);return this.moveTo(l.x,l.y,l.z,r)}elevate(t,r=!1){return yr.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+yr.x,this._targetEnd.y+yr.y,this._targetEnd.z+yr.z,r)}moveTo(t,r,l,u=!1){this._isUserControllingTruck=!1;const d=yr.set(t,r,l).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,d,this.boundaryFriction),this._needsUpdate=!0,u||this._target.copy(this._targetEnd);const p=!u||bi(this._target.x,this._targetEnd.x,this.restThreshold)&&bi(this._target.y,this._targetEnd.y,this.restThreshold)&&bi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(p)}lookInDirectionOf(t,r,l,u=!1){const b=yr.set(t,r,l).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(b.x,b.y,b.z,u)}fitToBox(t,r,{cover:l=!1,paddingLeft:u=0,paddingRight:d=0,paddingBottom:p=0,paddingTop:b=0}={}){const i=[],E=t.isBox3?Lf.copy(t):Lf.setFromObject(t);E.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const T=HE(this._sphericalEnd.theta,$E),A=HE(this._sphericalEnd.phi,$E);i.push(this.rotateTo(T,A,r));const I=yr.setFromSpherical(this._sphericalEnd).normalize(),O=JE.setFromUnitVectors(I,G0),z=bi(Math.abs(I.y),1);z&&O.multiply($0.setFromAxisAngle(Wg,T)),O.multiply(this._yAxisUpSpaceInverse);const U=KE.makeEmpty();ai.copy(E.min).applyQuaternion(O),U.expandByPoint(ai),ai.copy(E.min).setX(E.max.x).applyQuaternion(O),U.expandByPoint(ai),ai.copy(E.min).setY(E.max.y).applyQuaternion(O),U.expandByPoint(ai),ai.copy(E.max).setZ(E.min.z).applyQuaternion(O),U.expandByPoint(ai),ai.copy(E.min).setZ(E.max.z).applyQuaternion(O),U.expandByPoint(ai),ai.copy(E.max).setY(E.min.y).applyQuaternion(O),U.expandByPoint(ai),ai.copy(E.max).setX(E.min.x).applyQuaternion(O),U.expandByPoint(ai),ai.copy(E.max).applyQuaternion(O),U.expandByPoint(ai),U.min.x-=u,U.min.y-=p,U.max.x+=d,U.max.y+=b,O.setFromUnitVectors(G0,I),z&&O.premultiply($0.invert()),O.premultiply(this._yAxisUpSpace);const N=U.getSize(yr),V=U.getCenter(ai).applyQuaternion(O);if(xd(this._camera)){const X=this.getDistanceToFitBox(N.x,N.y,N.z,l);i.push(this.moveTo(V.x,V.y,V.z,r)),i.push(this.dollyTo(X,r)),i.push(this.setFocalOffset(0,0,0,r))}else if(jh(this._camera)){const X=this._camera,J=X.right-X.left,te=X.top-X.bottom,ue=l?Math.max(J/N.x,te/N.y):Math.min(J/N.x,te/N.y);i.push(this.moveTo(V.x,V.y,V.z,r)),i.push(this.zoomTo(ue,r)),i.push(this.setFocalOffset(0,0,0,r))}return Promise.all(i)}fitToSphere(t,r){const l=[],d=t instanceof er.Sphere?V0.copy(t):Gv.createBoundingSphere(t,V0);if(l.push(this.moveTo(d.center.x,d.center.y,d.center.z,r)),xd(this._camera)){const p=this.getDistanceToFitSphere(d.radius);l.push(this.dollyTo(p,r))}else if(jh(this._camera)){const p=this._camera.right-this._camera.left,b=this._camera.top-this._camera.bottom,i=2*d.radius,E=Math.min(p/i,b/i);l.push(this.zoomTo(E,r))}return l.push(this.setFocalOffset(0,0,0,r)),Promise.all(l)}setLookAt(t,r,l,u,d,p,b=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Mf.NONE,this._changedDolly=0;const i=ai.set(u,d,p),E=yr.set(t,r,l);this._targetEnd.copy(i),this._sphericalEnd.setFromVector3(E.sub(i).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,b||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const T=!b||bi(this._target.x,this._targetEnd.x,this.restThreshold)&&bi(this._target.y,this._targetEnd.y,this.restThreshold)&&bi(this._target.z,this._targetEnd.z,this.restThreshold)&&bi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&bi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&bi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(T)}lerpLookAt(t,r,l,u,d,p,b,i,E,T,A,I,O,z=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Mf.NONE,this._changedDolly=0;const U=yr.set(u,d,p),N=ai.set(t,r,l);tc.setFromVector3(N.sub(U).applyQuaternion(this._yAxisUpSpace));const V=Pf.set(T,A,I),X=ai.set(b,i,E);um.setFromVector3(X.sub(V).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(U.lerp(V,O));const J=um.theta-tc.theta,te=um.phi-tc.phi,ue=um.radius-tc.radius;this._sphericalEnd.set(tc.radius+ue*O,tc.phi+te*O,tc.theta+J*O),this.normalizeRotations(),this._needsUpdate=!0,z||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const ae=!z||bi(this._target.x,this._targetEnd.x,this.restThreshold)&&bi(this._target.y,this._targetEnd.y,this.restThreshold)&&bi(this._target.z,this._targetEnd.z,this.restThreshold)&&bi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&bi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&bi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(ae)}setPosition(t,r,l,u=!1){return this.setLookAt(t,r,l,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,u)}setTarget(t,r,l,u=!1){const d=this.getPosition(yr),p=this.setLookAt(d.x,d.y,d.z,t,r,l,u);return this._sphericalEnd.phi=zc(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),p}setFocalOffset(t,r,l,u=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,r,l),this._needsUpdate=!0,u||this._focalOffset.copy(this._focalOffsetEnd);const d=!u||bi(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&bi(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&bi(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(d)}setOrbitPoint(t,r,l){this._camera.updateMatrixWorld(),yu.setFromMatrixColumn(this._camera.matrixWorldInverse,0),vu.setFromMatrixColumn(this._camera.matrixWorldInverse,1),bd.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const u=yr.set(t,r,l),d=u.distanceTo(this._camera.position),p=u.sub(this._camera.position);yu.multiplyScalar(p.x),vu.multiplyScalar(p.y),bd.multiplyScalar(p.z),yr.copy(yu).add(vu).add(bd),yr.z=yr.z+d,this.dollyTo(d,!1),this.setFocalOffset(-yr.x,yr.y,-yr.z,!1),this.moveTo(t,r,l,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,r,l,u){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new er.Vector4,typeof t=="number"?this._viewport.set(t,r,l,u):this._viewport.copy(t)}getDistanceToFitBox(t,r,l,u=!1){if(U0(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const d=t/r,p=this._camera.getEffectiveFOV()*sm,b=this._camera.aspect;return((u?d>b:d<b)?r:t/b)*.5/Math.tan(p*.5)+l*.5}getDistanceToFitSphere(t){if(U0(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const r=this._camera.getEffectiveFOV()*sm,l=Math.atan(Math.tan(r*.5)*this._camera.aspect)*2,u=1<this._camera.aspect?r:l;return t/Math.sin(u*.5)}getTarget(t,r=!0){return(t&&t.isVector3?t:new er.Vector3).copy(r?this._targetEnd:this._target)}getPosition(t,r=!0){return(t&&t.isVector3?t:new er.Vector3).setFromSpherical(r?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(r?this._targetEnd:this._target)}getSpherical(t,r=!0){return(t&&t instanceof er.Spherical?t:new er.Spherical).copy(r?this._sphericalEnd:this._spherical)}getFocalOffset(t,r=!0){return(t&&t.isVector3?t:new er.Vector3).copy(r?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%If,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=If),this._spherical.theta+=If*Math.round((this._sphericalEnd.theta-this._spherical.theta)/If)}reset(t=!1){if(!bi(this._camera.up.x,this._cameraUp0.x)||!bi(this._camera.up.y,this._cameraUp0.y)||!bi(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const l=this.getPosition(yr);this.updateCameraUp(),this.setPosition(l.x,l.y,l.z)}const r=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(r)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Wg),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=yr.subVectors(this._target,this._camera.position).normalize(),r=ai.crossVectors(t,this._camera.up);this._camera.up.crossVectors(r,t).normalize(),this._camera.updateMatrixWorld();const l=this.getPosition(yr);this.updateCameraUp(),this.setPosition(l.x,l.y,l.z)}update(t){const r=this._sphericalEnd.theta-this._spherical.theta,l=this._sphericalEnd.phi-this._spherical.phi,u=this._sphericalEnd.radius-this._spherical.radius,d=XE.subVectors(this._targetEnd,this._target),p=qE.subVectors(this._focalOffsetEnd,this._focalOffset),b=this._zoomEnd-this._zoom;if(Vi(r))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const A=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=$g(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,A,1/0,t),this._needsUpdate=!0}if(Vi(l))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const A=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=$g(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,A,1/0,t),this._needsUpdate=!0}if(Vi(u))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const A=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=$g(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,A,this.maxSpeed,t),this._needsUpdate=!0}if(Vi(d.x)&&Vi(d.y)&&Vi(d.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const A=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;WE(this._target,this._targetEnd,this._targetVelocity,A,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(Vi(p.x)&&Vi(p.y)&&Vi(p.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const A=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;WE(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,A,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(Vi(b))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const A=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=$g(this._zoom,this._zoomEnd,this._zoomVelocity,A,1/0,t)}if(this.dollyToCursor){if(xd(this._camera)&&this._changedDolly!==0){const A=this._spherical.radius-this._lastDistance,I=this._camera,O=this._getCameraDirection(cm),z=yr.copy(O).cross(I.up).normalize();z.lengthSq()===0&&(z.x=1);const U=ai.crossVectors(z,O),N=this._sphericalEnd.radius*Math.tan(I.getEffectiveFOV()*sm*.5),X=(this._sphericalEnd.radius-A-this._sphericalEnd.radius)/this._sphericalEnd.radius,J=Pf.copy(this._targetEnd).add(z.multiplyScalar(this._dollyControlCoord.x*N*I.aspect)).add(U.multiplyScalar(this._dollyControlCoord.y*N)),te=yr.copy(this._targetEnd).lerp(J,X),ue=this._lastDollyDirection===Mf.IN&&this._spherical.radius<=this.minDistance,ae=this._lastDollyDirection===Mf.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(ue||ae)){this._sphericalEnd.radius-=A,this._spherical.radius-=A;const Ce=ai.copy(O).multiplyScalar(-A);te.add(Ce)}this._boundary.clampPoint(te,te);const be=ai.subVectors(te,this._targetEnd);this._targetEnd.copy(te),this._target.add(be),this._changedDolly-=A,Vi(this._changedDolly)&&(this._changedDolly=0)}else if(jh(this._camera)&&this._changedZoom!==0){const A=this._zoom-this._lastZoom,I=this._camera,O=yr.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(I.near+I.far)/(I.near-I.far)).unproject(I),z=ai.set(0,0,-1).applyQuaternion(I.quaternion),U=Pf.copy(O).add(z.multiplyScalar(-O.dot(I.up))),V=-(this._zoom-A-this._zoom)/this._zoom,X=this._getCameraDirection(cm),J=this._targetEnd.dot(X),te=yr.copy(this._targetEnd).lerp(U,V),ue=te.dot(X),ae=X.multiplyScalar(ue-J);te.sub(ae),this._boundary.clampPoint(te,te);const be=ai.subVectors(te,this._targetEnd);this._targetEnd.copy(te),this._target.add(be),this._changedZoom-=A,Vi(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const i=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,i),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Vi(this._focalOffset.x)||!Vi(this._focalOffset.y)||!Vi(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),yu.setFromMatrixColumn(this._camera.matrix,0),vu.setFromMatrixColumn(this._camera.matrix,1),bd.setFromMatrixColumn(this._camera.matrix,2),yu.multiplyScalar(this._focalOffset.x),vu.multiplyScalar(-this._focalOffset.y),bd.multiplyScalar(this._focalOffset.z),yr.copy(yu).add(vu).add(bd),this._camera.position.add(yr)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),yr.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const T=this._needsUpdate;return T&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):T?(this.dispatchEvent({type:"update"}),Vi(r,this.restThreshold)&&Vi(l,this.restThreshold)&&Vi(u,this.restThreshold)&&Vi(d.x,this.restThreshold)&&Vi(d.y,this.restThreshold)&&Vi(d.z,this.restThreshold)&&Vi(p.x,this.restThreshold)&&Vi(p.y,this.restThreshold)&&Vi(p.z,this.restThreshold)&&Vi(b,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!T&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=T,this._needsUpdate=!1,T}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:am(this.maxDistance),minZoom:this.minZoom,maxZoom:am(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:am(this.maxPolarAngle),minAzimuthAngle:am(this.minAzimuthAngle),maxAzimuthAngle:am(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:yr.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,r=!1){const l=JSON.parse(t);this.enabled=l.enabled,this.minDistance=l.minDistance,this.maxDistance=lm(l.maxDistance),this.minZoom=l.minZoom,this.maxZoom=lm(l.maxZoom),this.minPolarAngle=l.minPolarAngle,this.maxPolarAngle=lm(l.maxPolarAngle),this.minAzimuthAngle=lm(l.minAzimuthAngle),this.maxAzimuthAngle=lm(l.maxAzimuthAngle),this.smoothTime=l.smoothTime,this.draggingSmoothTime=l.draggingSmoothTime,this.dollySpeed=l.dollySpeed,this.truckSpeed=l.truckSpeed,this.dollyToCursor=l.dollyToCursor,this.verticalDragToForward=l.verticalDragToForward,this._target0.fromArray(l.target0),this._position0.fromArray(l.position0),this._zoom0=l.zoom0,this._focalOffset0.fromArray(l.focalOffset0),this.moveTo(l.target[0],l.target[1],l.target[2],r),tc.setFromVector3(yr.fromArray(l.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(tc.theta,tc.phi,r),this.dollyTo(tc.radius,r),this.zoomTo(l.zoom,r),this.setFocalOffset(l.focalOffset[0],l.focalOffset[1],l.focalOffset[2],r),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",F4),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(r=>r.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(r=>r.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,r,l){const u=r.lengthSq();if(u===0)return t;const d=ai.copy(r).add(t),b=this._boundary.clampPoint(d,Pf).sub(d),i=b.lengthSq();if(i===0)return t.add(r);if(i===u)return t;if(l===0)return t.add(r).add(b);{const E=1+l*i/r.dot(b);return t.add(ai.copy(r).multiplyScalar(E)).add(b.multiplyScalar(1-l))}}_updateNearPlaneCorners(){if(xd(this._camera)){const t=this._camera,r=t.near,l=t.getEffectiveFOV()*sm,u=Math.tan(l*.5)*r,d=u*t.aspect;this._nearPlaneCorners[0].set(-d,-u,0),this._nearPlaneCorners[1].set(d,-u,0),this._nearPlaneCorners[2].set(d,u,0),this._nearPlaneCorners[3].set(-d,u,0)}else if(jh(this._camera)){const t=this._camera,r=1/t.zoom,l=t.left*r,u=t.right*r,d=t.top*r,p=t.bottom*r;this._nearPlaneCorners[0].set(l,d,0),this._nearPlaneCorners[1].set(u,d,0),this._nearPlaneCorners[2].set(u,p,0),this._nearPlaneCorners[3].set(l,p,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||U0(this._camera,"_collisionTest"))return t;const l=this._getTargetDirection(cm);H0.lookAt(ZE,l,this._camera.up);for(let u=0;u<4;u++){const d=ai.copy(this._nearPlaneCorners[u]);d.applyMatrix4(H0);const p=Pf.addVectors(this._target,d);Zg.set(p,l),Zg.far=this._spherical.radius+1;const b=Zg.intersectObjects(this.colliderMeshes);b.length!==0&&b[0].distance<t&&(t=b[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const r=this._domElement.getBoundingClientRect();return t.x=r.left,t.y=r.top,this._viewport?(t.x+=this._viewport.x,t.y+=r.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=r.width,t.height=r.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(r=>{const l=()=>{this.removeEventListener("rest",l),r()};this.addEventListener("rest",l)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,r=new er.Sphere){const l=r,u=l.center;Lf.makeEmpty(),t.traverseVisible(p=>{p.isMesh&&Lf.expandByObject(p)}),Lf.getCenter(u);let d=0;return t.traverseVisible(p=>{if(!p.isMesh)return;const b=p,i=b.geometry.clone();i.applyMatrix4(b.matrixWorld);const T=i.attributes.position;for(let A=0,I=T.count;A<I;A++)yr.fromBufferAttribute(T,A),d=Math.max(d,u.distanceToSquared(yr))}),l.radius=Math.sqrt(d),l}};const U4=k.forwardRef((n,t)=>{k.useMemo(()=>{const ue={Box3:dh,MathUtils:{clamp:fa.clamp},Matrix4:Ci,Quaternion:kl,Raycaster:y1,Sphere:dp,Spherical:yv,Vector2:Zo,Vector3:Tt,Vector4:za};Yf.install({THREE:ue}),jm({CameraControlsImpl:Yf})},[]);const{camera:r,domElement:l,makeDefault:u,onStart:d,onEnd:p,onChange:b,regress:i,...E}=n,T=ar(ue=>ue.camera),A=ar(ue=>ue.gl),I=ar(ue=>ue.invalidate),O=ar(ue=>ue.events),z=ar(ue=>ue.setEvents),U=ar(ue=>ue.set),N=ar(ue=>ue.get),V=ar(ue=>ue.performance),X=r||T,J=l||O.connected||A.domElement,te=k.useMemo(()=>new Yf(X),[X]);return mc((ue,ae)=>{te.enabled&&te.update(ae)},-1),k.useEffect(()=>(te.connect(J),()=>void te.disconnect()),[J,te]),k.useEffect(()=>{const ue=Ce=>{I(),i&&V.regress(),b&&b(Ce)},ae=Ce=>{d&&d(Ce)},be=Ce=>{p&&p(Ce)};return te.addEventListener("update",ue),te.addEventListener("controlstart",ae),te.addEventListener("controlend",be),te.addEventListener("control",ue),te.addEventListener("transitionstart",ue),te.addEventListener("wake",ue),()=>{te.removeEventListener("update",ue),te.removeEventListener("controlstart",ae),te.removeEventListener("controlend",be),te.removeEventListener("control",ue),te.removeEventListener("transitionstart",ue),te.removeEventListener("wake",ue)}},[te,d,p,I,z,i,b]),k.useEffect(()=>{if(u){const ue=N().controls;return U({controls:te}),()=>U({controls:ue})}},[u,te]),k.createElement("primitive",Gr({ref:t,object:te},E))});function N4({defaultScene:n,defaultCamera:t,renderPriority:r=1}){const{gl:l,scene:u,camera:d}=ar();let p;return mc(()=>{p=l.autoClear,r===1&&(l.autoClear=!0,l.render(n,t)),l.autoClear=!1,l.clearDepth(),l.render(u,d),l.autoClear=p},r),k.createElement("group",{onPointerOver:()=>null})}function G4({children:n,renderPriority:t=1}){const{scene:r,camera:l}=ar(),[u]=k.useState(()=>new Am);return k.createElement(k.Fragment,null,Hk(k.createElement(k.Fragment,null,n,k.createElement(N4,{defaultScene:r,defaultCamera:l,renderPriority:t})),u,{events:{priority:t+1}}))}const wM=k.createContext({}),V4=()=>k.useContext(wM),$4=2*Math.PI,W0=new Ba,YE=new Ci,[Bf,Z0]=[new kl,new kl],QE=new Tt,eC=new Tt,H4=n=>"minPolarAngle"in n,W4=({alignment:n="bottom-right",margin:t=[80,80],renderPriority:r=1,onUpdate:l,onTarget:u,children:d})=>{const p=ar(ae=>ae.size),b=ar(ae=>ae.camera),i=ar(ae=>ae.controls),E=ar(ae=>ae.invalidate),T=k.useRef(null),A=k.useRef(null),I=k.useRef(!1),O=k.useRef(0),z=k.useRef(new Tt(0,0,0)),U=k.useRef(new Tt(0,0,0));k.useEffect(()=>{U.current.copy(b.up)},[b]);const N=k.useCallback(ae=>{I.current=!0,(i||u)&&(z.current=(i==null?void 0:i.target)||(u==null?void 0:u())),O.current=b.position.distanceTo(QE),Bf.copy(b.quaternion),eC.copy(ae).multiplyScalar(O.current).add(QE),W0.lookAt(eC),W0.up.copy(b.up),Z0.copy(W0.quaternion),E()},[i,b,u,E]);mc((ae,be)=>{if(A.current&&T.current){var Ce;if(I.current)if(Bf.angleTo(Z0)<.01)I.current=!1,H4(i)&&b.up.copy(U.current);else{const je=be*$4;Bf.rotateTowards(Z0,je),b.position.set(0,0,1).applyQuaternion(Bf).multiplyScalar(O.current).add(z.current),b.up.set(0,1,0).applyQuaternion(Bf).normalize(),b.quaternion.copy(Bf),l?l():i&&i.update(),E()}YE.copy(b.matrix).invert(),(Ce=T.current)==null||Ce.quaternion.setFromRotationMatrix(YE)}});const V=k.useMemo(()=>({tweenCamera:N}),[N]),[X,J]=t,te=n.endsWith("-center")?0:n.endsWith("-left")?-p.width/2+X:p.width/2-X,ue=n.startsWith("center-")?0:n.startsWith("top-")?p.height/2-J:-p.height/2+J;return k.createElement(G4,{renderPriority:r},k.createElement(wM.Provider,{value:V},k.createElement(O4,{makeDefault:!0,ref:A,position:[0,0,200]}),k.createElement("group",{ref:T,position:[te,ue,0]},d)))};function X0({scale:n=[.8,.05,.05],color:t,rotation:r}){return k.createElement("group",{rotation:r},k.createElement("mesh",{position:[.4,0,0]},k.createElement("boxGeometry",{args:n}),k.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function Rf({onClick:n,font:t,disabled:r,arcStyle:l,label:u,labelColor:d,axisHeadScale:p=1,...b}){const i=ar(U=>U.gl),E=k.useMemo(()=>{const U=document.createElement("canvas");U.width=64,U.height=64;const N=U.getContext("2d");return N.beginPath(),N.arc(32,32,16,0,2*Math.PI),N.closePath(),N.fillStyle=l,N.fill(),u&&(N.font=t,N.textAlign="center",N.fillStyle=d,N.fillText(u,32,41)),new UT(U)},[l,u,d,t]),[T,A]=k.useState(!1),I=(u?1:.75)*(T?1.2:1)*p,O=U=>{U.stopPropagation(),A(!0)},z=U=>{U.stopPropagation(),A(!1)};return k.createElement("sprite",Gr({scale:I,onPointerOver:r?void 0:O,onPointerOut:r?void 0:n||z},b),k.createElement("spriteMaterial",{map:E,"map-anisotropy":i.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:u?1:.75,toneMapped:!1}))}const Z4=({hideNegativeAxes:n,hideAxisHeads:t,disabled:r,font:l="18px Inter var, Arial, sans-serif",axisColors:u=["#ff2060","#20df80","#2080ff"],axisHeadScale:d=1,axisScale:p,labels:b=["X","Y","Z"],labelColor:i="#000",onClick:E,...T})=>{const[A,I,O]=u,{tweenCamera:z}=V4(),U={font:l,disabled:r,labelColor:i,onClick:E,axisHeadScale:d,onPointerDown:r?void 0:N=>{z(N.object.position),N.stopPropagation()}};return k.createElement("group",Gr({scale:40},T),k.createElement(X0,{color:A,rotation:[0,0,0],scale:p}),k.createElement(X0,{color:I,rotation:[0,0,Math.PI/2],scale:p}),k.createElement(X0,{color:O,rotation:[0,-Math.PI/2,0],scale:p}),!t&&k.createElement(k.Fragment,null,k.createElement(Rf,Gr({arcStyle:A,position:[1,0,0],label:b[0]},U)),k.createElement(Rf,Gr({arcStyle:I,position:[0,1,0],label:b[1]},U)),k.createElement(Rf,Gr({arcStyle:O,position:[0,0,1],label:b[2]},U)),!n&&k.createElement(k.Fragment,null,k.createElement(Rf,Gr({arcStyle:A,position:[-1,0,0]},U)),k.createElement(Rf,Gr({arcStyle:I,position:[0,-1,0]},U)),k.createElement(Rf,Gr({arcStyle:O,position:[0,0,-1]},U)))))},X4=P4({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new Ai,sectionColor:new Ai,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new Tt,worldPlanePosition:new Tt},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${B4>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),q4=k.forwardRef(({args:n,cellColor:t="#000000",sectionColor:r="#2080ff",cellSize:l=.5,sectionSize:u=1,followCamera:d=!1,infiniteGrid:p=!1,fadeDistance:b=100,fadeStrength:i=1,fadeFrom:E=1,cellThickness:T=.5,sectionThickness:A=1,side:I=xR,...O},z)=>{jm({GridMaterial:X4});const U=k.useRef(null);k.useImperativeHandle(z,()=>U.current,[]);const N=new ST,V=new Tt(0,1,0),X=new Tt(0,0,0);mc(ue=>{N.setFromNormalAndCoplanarPoint(V,X).applyMatrix4(U.current.matrixWorld);const ae=U.current.material,be=ae.uniforms.worldCamProjPosition,Ce=ae.uniforms.worldPlanePosition;N.projectPoint(ue.camera.position,be.value),Ce.value.set(0,0,0).applyMatrix4(U.current.matrixWorld)});const J={cellSize:l,sectionSize:u,cellColor:t,sectionColor:r,cellThickness:T,sectionThickness:A},te={fadeDistance:b,fadeStrength:i,fadeFrom:E,infiniteGrid:p,followCamera:d};return k.createElement("mesh",Gr({ref:U,frustumCulled:!1},O),k.createElement("gridMaterial",Gr({transparent:!0,"extensions-derivatives":!0,side:I},J,te)),k.createElement("planeGeometry",{args:n}))});function K4(n,t,...r){const l=k.useRef(),u=ar(d=>d.scene);return k.useLayoutEffect(()=>{let d;if(n&&n!=null&&n.current&&t&&(l.current=d=new t(n.current,...r)),d)return d.traverse(p=>p.raycast=()=>null),u.add(d),()=>{l.current=void 0,u.remove(d),d.dispose==null||d.dispose()}},[u,t,n,...r]),mc(()=>{var d;return void((d=l.current)==null||d.update==null?void 0:d.update())}),l}class J4 extends km{constructor(t={}){super(t),this.setValues(t),this._time={value:0},this._factor={value:1}}onBeforeCompile(t){t.uniforms.time=this._time,t.uniforms.factor=this._factor,t.vertexShader=`
      uniform float time;
      uniform float factor;
      ${t.vertexShader}
    `,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
        float c = cos( theta );
        float s = sin( theta );
        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
        vec3 transformed = vec3( position ) * m;
        vNormal = vNormal * m;`)}get time(){return this._time.value}set time(t){this._time.value=t}get factor(){return this._factor.value}set factor(t){this._factor.value=t}}const Y4=k.forwardRef(({speed:n=1,...t},r)=>{const[l]=k.useState(()=>new J4);return mc(u=>l&&(l.time=u.clock.getElapsedTime()*n)),k.createElement("primitive",Gr({object:l,ref:r,attach:"material"},t))});function Q4({pixelated:n}){const t=ar(p=>p.gl),r=ar(p=>p.internal.active),l=ar(p=>p.performance.current),u=ar(p=>p.viewport.initialDpr),d=ar(p=>p.setDpr);return k.useEffect(()=>{const p=t.domElement;return()=>{r&&d(u),n&&p&&(p.style.imageRendering="auto")}},[]),k.useEffect(()=>{d(l*u),n&&t.domElement&&(t.domElement.style.imageRendering=l===1?"auto":"pixelated")},[l]),null}function ez(){const n=ar(l=>l.get),t=ar(l=>l.setEvents),r=ar(l=>l.performance.current);return k.useEffect(()=>{const l=n().events.enabled;return()=>t({enabled:l})},[]),k.useEffect(()=>t({enabled:r===1}),[r]),null}var tz={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const tC=n=>{let t;const r=new Set,l=(T,A)=>{const I=typeof T=="function"?T(t):T;if(!Object.is(I,t)){const O=t;t=A??(typeof I!="object"||I===null)?I:Object.assign({},t,I),r.forEach(z=>z(t,O))}},u=()=>t,i={setState:l,getState:u,getInitialState:()=>E,subscribe:T=>(r.add(T),()=>r.delete(T)),destroy:()=>{(tz?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},E=t=n(l,u,i);return i},nz=n=>n?tC(n):tC;var EM={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{useDebugValue:rz}=Pe,{useSyncExternalStoreWithSelector:iz}=NT;let nC=!1;const oz=n=>n;function sz(n,t=oz,r){(EM?"production":void 0)!=="production"&&r&&!nC&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),nC=!0);const l=iz(n.subscribe,n.getState,n.getServerState||n.getInitialState,t,r);return rz(l),l}const rC=n=>{(EM?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof n=="function"?nz(n):n,r=(l,u)=>sz(t,l,u);return Object.assign(r,t),r},az=n=>n?rC(n):rC;var iC,oC;const sC=typeof window<"u"&&((iC=window.document)!=null&&iC.createElement||((oC=window.navigator)==null?void 0:oC.product)==="ReactNative")?Pe.useLayoutEffect:Pe.useEffect;function lz(){const n=az(t=>({current:new Array,version:0,set:t}));return{In:({children:t})=>{const r=n(u=>u.set),l=n(u=>u.version);return sC(()=>{r(u=>({version:u.version+1}))},[]),sC(()=>(r(({current:u})=>({current:[...u,t]})),()=>r(({current:u})=>({current:u.filter(d=>d!==t)}))),[t,l]),null},Out:()=>{const t=n(r=>r.current);return Pe.createElement(Pe.Fragment,null,t)}}}const CM="fiftyone-camera-position",cz=new Tt(0,0,0),uz=({cameraRef:n,controlsRef:t,settings:r,isGridOn:l,bounds:u})=>{const d=ar(z=>z.camera),p=k.useMemo(()=>new Tt(...r.defaultUp).normalize(),[r]),b=k.useMemo(()=>GT(p),[p]);k.useEffect(()=>{n.current=d;const z=()=>{window==null||window.localStorage.setItem(CM,JSON.stringify(d.position.toArray()))},U=t.current;return U==null||U.addEventListener("change",z),()=>{U==null||U.removeEventListener("change",z)}},[d,n,t]);const i=k.useMemo(()=>p.equals(new Tt(0,0,1)),[p]),E=k.useMemo(()=>p.equals(new Tt(0,1,0)),[p]),T=k.useMemo(()=>p.equals(new Tt(1,0,0)),[p]),A=k.useMemo(()=>T||E||i,[T,E,i]),I=k.useMemo(()=>{var U,N,V,X,J,te,ue,ae,be,Ce,je,me;let z;if(T)z=Math.max(((U=u==null?void 0:u.max)==null?void 0:U.y)-((N=u==null?void 0:u.min)==null?void 0:N.y),((V=u==null?void 0:u.max)==null?void 0:V.z)-((X=u==null?void 0:u.min)==null?void 0:X.z));else if(E)z=Math.max(((J=u==null?void 0:u.max)==null?void 0:J.x)-((te=u==null?void 0:u.min)==null?void 0:te.x),((ue=u==null?void 0:u.max)==null?void 0:ue.z)-((ae=u==null?void 0:u.min)==null?void 0:ae.z));else if(i)z=Math.max(((be=u==null?void 0:u.max)==null?void 0:be.x)-((Ce=u==null?void 0:u.min)==null?void 0:Ce.x),((je=u==null?void 0:u.max)==null?void 0:je.y)-((me=u==null?void 0:u.min)==null?void 0:me.y));else return 100;return isNaN(z)?100:Math.ceil(z*1.1)},[u,T,E,i]),O=k.useMemo(()=>{const z=Math.ceil(I/10);return z===1?5:z},[I]);return Q.jsxs(Q.Fragment,{children:[Q.jsx(k4,{ref:t,makeDefault:!0,autoRotateSpeed:2.5,zoomSpeed:.5}),Q.jsx("axesHelper",{}),!A&&Q.jsx("arrowHelper",{args:[p,cz]}),l&&Q.jsx("gridHelper",{args:[I,O],quaternion:b})]})},hz=()=>{const{gl:n,scene:t,camera:r}=ar();return VT(()=>new Promise(l=>{n.render(t,r),l(n.domElement)})),null},Lu=Ro.div`
  display: flex;
  align-content: center;
  text-align: center;
  cursor: pointer;
  color: var(--fo-palette-text-secondary);
  -webkit-transition: 0.2s ease-in-out;
  -moz-transition: 0.2s ease-in-out;
  -o-transition: 0.2s ease-in-out;
  transition: 0.2s ease-in-out;

  &:hover {
    transform: translate(0, -1px);
  }
`,dz=Ro.div`
  position: absolute;
  bottom: 0;
  left: 0;
  opacity: 1;
  z-index: 20000;
  justify-items: center;
  align-items: center;
  display: flex;

  color: #eee;

  -webkit-transition: opacity 0.5s;
  -moz-transition: opacity 0.5s;
  -o-transition: opacity 0.5s;
  -ms-transition: opacity 0.5s;
  transition: opacity 0.5s;
  width: 100%;

  opacity: 0.95;
  min-height: 37px;
  max-height: 200px;
  background-color: var(--fo-palette-background-level3);
  border: 1px solid var(--fo-palette-primary-plainBorder);
  border-left: 0;
  padding: 0 1rem;
`,fz=Ro.div`
  position: relative;
  display: flex;
  flex-grow: 1;
  justify-content: end;
  row-gap: 0.5rem;
  column-gap: 0.75rem;
  align-items: center;
  height: 2.3rem;
`,pz=Ro.div`
  width: 20rem;
  position: absolute;
  bottom: 2.5rem;
  background-color: var(--fo-palette-background-level2);
  border: 1px solid var(--fo-palette-primary-plainBorder);
  box-shadow: 0 8px 15px 0 var(--fo-palette-neutral-softBg);
  border-radius: 3px;
  color: var(--fo-palette-text-secondary);
  overflow: hidden;
`,mz=Ro.div`
  padding: 0 0.25rem;
`,AM=Ro.div`
  height: 100%;
  width: 100%;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
`,gz=Ro.div`
  position: absolute;
  top: 12vh;
  right: ${n=>n.isSidebarVisible?"23vw":"3vw"};
  z-index: 1000;
  height: 0;
`,_z=Ro.div`
  position: absolute;
  bottom: 3em;
  margin-bottom: 3vh;
  left: 1vw;
  z-index: 1000;
  width: 100%;

  & .looker-3d-core-stats-panel {
    position: relative !important;
  }
`;Ro.div`
  display: flex;
  flex-direction: column;
  position: absolute;
  top: 3em;
  margin-top: 2vh;
  right: 1vw;
  z-index: 1000;
`;const yz=Ro.div`
  display: flex;
  flex-direction: column;
  width: 150px;
`,vz=Ro.div`
  line-height: 1rem;
  padding: 3px 6px;
  background-color: var(--fo-palette-text-secondary);
  color: var(--fo-palette-text-invert);
  border-radius: 1rem;
  border: none;
  font-weight: bold;
  display: flex;
  justify-content: space-between;
  opacity: 1;
`;function xz(n,t){typeof n=="function"?n(t):n!=null&&(n.current=t)}function TM(...n){return t=>n.forEach(r=>xz(r,t))}function _p(...n){return k.useCallback(TM(...n),n)}const SM=k.forwardRef((n,t)=>{const{children:r,...l}=n,u=k.Children.toArray(r),d=u.find(bz);if(d){const p=d.props.children,b=u.map(i=>i===d?k.Children.count(p)>1?k.Children.only(null):k.isValidElement(p)?p.props.children:null:i);return k.createElement(Vv,Gr({},l,{ref:t}),k.isValidElement(p)?k.cloneElement(p,void 0,b):null)}return k.createElement(Vv,Gr({},l,{ref:t}),r)});SM.displayName="Slot";const Vv=k.forwardRef((n,t)=>{const{children:r,...l}=n;return k.isValidElement(r)?k.cloneElement(r,{...wz(l,r.props),ref:t?TM(t,r.ref):r.ref}):k.Children.count(r)>1?k.Children.only(null):null});Vv.displayName="SlotClone";const MM=({children:n})=>k.createElement(k.Fragment,null,n);function bz(n){return k.isValidElement(n)&&n.type===MM}function wz(n,t){const r={...t};for(const l in t){const u=n[l],d=t[l];/^on[A-Z]/.test(l)?u&&d?r[l]=(...b)=>{d(...b),u(...b)}:u&&(r[l]=u):l==="style"?r[l]={...u,...d}:l==="className"&&(r[l]=[u,d].filter(Boolean).join(" "))}return{...n,...r}}const Ez=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],jd=Ez.reduce((n,t)=>{const r=k.forwardRef((l,u)=>{const{asChild:d,...p}=l,b=d?SM:t;return k.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),k.createElement(b,Gr({},p,{ref:u}))});return r.displayName=`Primitive.${t}`,{...n,[t]:r}},{});function Cz(n,t){n&&cp.flushSync(()=>n.dispatchEvent(t))}const Az=k.forwardRef((n,t)=>{var r;const{container:l=globalThis==null||(r=globalThis.document)===null||r===void 0?void 0:r.body,...u}=n;return l?$T.createPortal(k.createElement(jd.div,Gr({},u,{ref:t})),l):null}),Tz=Az;var aC=Object.prototype.hasOwnProperty;function Bm(n,t){var r,l;if(n===t)return!0;if(n&&t&&(r=n.constructor)===t.constructor){if(r===Date)return n.getTime()===t.getTime();if(r===RegExp)return n.toString()===t.toString();if(r===Array){if((l=n.length)===t.length)for(;l--&&Bm(n[l],t[l]););return l===-1}if(!r||typeof n=="object"){l=0;for(r in n)if(aC.call(n,r)&&++l&&!aC.call(t,r)||!(r in t)||!Bm(n[r],t[r]))return!1;return Object.keys(t).length===l}}return n!==n&&t!==t}var K_=function(t,r,l,u){this.name=t,this.fn=r,this.args=l,this.modifiers=u};K_.prototype._test=function(t){var r=this.fn;try{Qf(this.modifiers.slice(),r,this)(t)}catch{r=function(){return!1}}try{return Qf(this.modifiers.slice(),r,this)(t)}catch{return!1}};K_.prototype._check=function(t){try{Qf(this.modifiers.slice(),this.fn,this)(t)}catch{if(Qf(this.modifiers.slice(),function(l){return l},this)(!1))return}if(!Qf(this.modifiers.slice(),this.fn,this)(t))throw null};K_.prototype._testAsync=function(t){var r=this;return new Promise(function(l,u){PM(r.modifiers.slice(),r.fn,r)(t).then(function(d){d?l(t):u(null)}).catch(function(d){return u(d)})})};function IM(n,t){return t===void 0&&(t="simple"),typeof n=="object"?n[t]:n}function Qf(n,t,r){if(n.length){var l=n.shift(),u=Qf(n,t,r);return l.perform(u,r)}else return IM(t)}function PM(n,t,r){if(n.length){var l=n.shift(),u=PM(n,t,r);return l.performAsync(u,r)}else return function(d){return Promise.resolve(IM(t,"async")(d))}}var Sz=function(t,r,l){this.name=t,this.perform=r,this.performAsync=l},Q1=function(n){function t(r,l,u,d){for(var p=[],b=arguments.length-4;b-- >0;)p[b]=arguments[b+4];n.call(this,p),n.captureStackTrace&&n.captureStackTrace(this,t),this.rule=r,this.value=l,this.cause=u,this.target=d}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(Error),Mu=function(t,r){t===void 0&&(t=[]),r===void 0&&(r=[]),this.chain=t,this.nextRuleModifiers=r};Mu.prototype._applyRule=function(t,r){var l=this;return function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return l.chain.push(new K_(r,t.apply(l,u),u,l.nextRuleModifiers)),l.nextRuleModifiers=[],l}};Mu.prototype._applyModifier=function(t,r){return this.nextRuleModifiers.push(new Sz(r,t.simple,t.async)),this};Mu.prototype._clone=function(){return new Mu(this.chain.slice(),this.nextRuleModifiers.slice())};Mu.prototype.test=function(t){return this.chain.every(function(r){return r._test(t)})};Mu.prototype.testAll=function(t){var r=[];return this.chain.forEach(function(l){try{l._check(t)}catch(u){r.push(new Q1(l,t,u))}}),r};Mu.prototype.check=function(t){this.chain.forEach(function(r){try{r._check(t)}catch(l){throw new Q1(r,t,l)}})};Mu.prototype.testAsync=function(t){var r=this;return new Promise(function(l,u){LM(t,r.chain.slice(),l,u)})};function LM(n,t,r,l){if(t.length){var u=t.shift();u._testAsync(n).then(function(){LM(n,t,r,l)},function(d){l(new Q1(u,n,d))})}else r(n)}var lC=function(n,t){return t&&typeof n=="string"&&n.trim().length===0?!0:n==null};function Mz(n,t){return t===void 0&&(t=!1),{simple:function(r){return lC(r,t)||n.check(r)===void 0},async:function(r){return lC(r,t)||n.testAsync(r)}}}function yl(){return typeof Proxy<"u"?BM(new Mu):$v(new Mu)}var Rm={};yl.extend=function(n){Object.assign(Rm,n)};yl.clearCustomRules=function(){Rm={}};function BM(n){return new Proxy(n,{get:function(r,l){if(l in r)return r[l];var u=BM(n._clone());if(l in b_)return u._applyModifier(b_[l],l);if(l in Rm)return u._applyRule(Rm[l],l);if(l in Hv)return u._applyRule(Hv[l],l)}})}function $v(n){var t=function(u,d){return Object.keys(u).forEach(function(p){d[p]=function(){for(var b=[],i=arguments.length;i--;)b[i]=arguments[i];var E=$v(d._clone()),T=E._applyRule(u[p],p).apply(void 0,b);return T}}),d},r=t(Hv,n),l=t(Rm,r);return Object.keys(b_).forEach(function(u){Object.defineProperty(l,u,{get:function(){var d=$v(l._clone());return d._applyModifier(b_[u],u)}})}),l}var b_={not:{simple:function(n){return function(t){return!n(t)}},async:function(n){return function(t){return Promise.resolve(n(t)).then(function(r){return!r}).catch(function(){return!0})}}},some:{simple:function(n){return function(t){return Xg(t).some(function(r){try{return n(r)}catch{return!1}})}},async:function(n){return function(t){return Promise.all(Xg(t).map(function(r){try{return n(r).catch(function(){return!1})}catch{return!1}})).then(function(r){return r.some(Boolean)})}}},every:{simple:function(n){return function(t){return t!==!1&&Xg(t).every(n)}},async:function(n){return function(t){return Promise.all(Xg(t).map(n)).then(function(r){return r.every(Boolean)})}}},strict:{simple:function(n,t){return function(r){return cC(t)&&r&&typeof r=="object"?Object.keys(t.args[0]).length===Object.keys(r).length&&n(r):n(r)}},async:function(n,t){return function(r){return Promise.resolve(n(r)).then(function(l){return cC(t)&&r&&typeof r=="object"?Object.keys(t.args[0]).length===Object.keys(r).length&&l:l}).catch(function(){return!1})}}}};function cC(n){return n&&n.name==="schema"&&n.args.length>0&&typeof n.args[0]=="object"}function Xg(n){return typeof n=="string"?n.split(""):n}var Hv={equal:function(n){return function(t){return t==n}},exact:function(n){return function(t){return t===n}},number:function(n){return n===void 0&&(n=!0),function(t){return typeof t=="number"&&(n||isFinite(t))}},integer:function(){return function(n){var t=Number.isInteger||Iz;return t(n)}},numeric:function(){return function(n){return!isNaN(parseFloat(n))&&isFinite(n)}},string:function(){return Df("string")},boolean:function(){return Df("boolean")},undefined:function(){return Df("undefined")},null:function(){return Df("null")},array:function(){return Df("array")},object:function(){return Df("object")},instanceOf:function(n){return function(t){return t instanceof n}},pattern:function(n){return function(t){return n.test(t)}},lowercase:function(){return function(n){return typeof n=="boolean"||n===n.toLowerCase()&&n.trim()!==""}},uppercase:function(){return function(n){return n===n.toUpperCase()&&n.trim()!==""}},vowel:function(){return function(n){return/^[aeiou]+$/i.test(n)}},consonant:function(){return function(n){return/^(?=[^aeiou])([a-z]+)$/i.test(n)}},first:function(n){return function(t){return t[0]==n}},last:function(n){return function(t){return t[t.length-1]==n}},empty:function(){return function(n){return n.length===0}},length:function(n,t){return function(r){return r.length>=n&&r.length<=(t||n)}},minLength:function(n){return function(t){return t.length>=n}},maxLength:function(n){return function(t){return t.length<=n}},negative:function(){return function(n){return n<0}},positive:function(){return function(n){return n>=0}},between:function(n,t){return function(r){return r>=n&&r<=t}},range:function(n,t){return function(r){return r>=n&&r<=t}},lessThan:function(n){return function(t){return t<n}},lessThanOrEqual:function(n){return function(t){return t<=n}},greaterThan:function(n){return function(t){return t>n}},greaterThanOrEqual:function(n){return function(t){return t>=n}},even:function(){return function(n){return n%2===0}},odd:function(){return function(n){return n%2!==0}},includes:function(n){return function(t){return~t.indexOf(n)}},schema:function(n){return Pz(n)},passesAnyOf:function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];return function(r){return n.some(function(l){return l.test(r)})}},optional:Mz};function Df(n){return function(t){return Array.isArray(t)&&n==="array"||t===null&&n==="null"||typeof t===n}}function Iz(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n}function Pz(n){return{simple:function(t){var r=[];if(Object.keys(n).forEach(function(l){var u=n[l];try{u.check((t||{})[l])}catch(d){d.target=l,r.push(d)}}),r.length>0)throw r;return!0},async:function(t){var r=[],l=Object.keys(n).map(function(u){var d=n[u];return d.testAsync((t||{})[u]).catch(function(p){p.target=u,r.push(p)})});return Promise.all(l).then(function(){if(r.length>0)throw r;return!0})}}}var Ii="colors",Pa="sizes",Tn="space",Lz={gap:Tn,gridGap:Tn,columnGap:Tn,gridColumnGap:Tn,rowGap:Tn,gridRowGap:Tn,inset:Tn,insetBlock:Tn,insetBlockEnd:Tn,insetBlockStart:Tn,insetInline:Tn,insetInlineEnd:Tn,insetInlineStart:Tn,margin:Tn,marginTop:Tn,marginRight:Tn,marginBottom:Tn,marginLeft:Tn,marginBlock:Tn,marginBlockEnd:Tn,marginBlockStart:Tn,marginInline:Tn,marginInlineEnd:Tn,marginInlineStart:Tn,padding:Tn,paddingTop:Tn,paddingRight:Tn,paddingBottom:Tn,paddingLeft:Tn,paddingBlock:Tn,paddingBlockEnd:Tn,paddingBlockStart:Tn,paddingInline:Tn,paddingInlineEnd:Tn,paddingInlineStart:Tn,top:Tn,right:Tn,bottom:Tn,left:Tn,scrollMargin:Tn,scrollMarginTop:Tn,scrollMarginRight:Tn,scrollMarginBottom:Tn,scrollMarginLeft:Tn,scrollMarginX:Tn,scrollMarginY:Tn,scrollMarginBlock:Tn,scrollMarginBlockEnd:Tn,scrollMarginBlockStart:Tn,scrollMarginInline:Tn,scrollMarginInlineEnd:Tn,scrollMarginInlineStart:Tn,scrollPadding:Tn,scrollPaddingTop:Tn,scrollPaddingRight:Tn,scrollPaddingBottom:Tn,scrollPaddingLeft:Tn,scrollPaddingX:Tn,scrollPaddingY:Tn,scrollPaddingBlock:Tn,scrollPaddingBlockEnd:Tn,scrollPaddingBlockStart:Tn,scrollPaddingInline:Tn,scrollPaddingInlineEnd:Tn,scrollPaddingInlineStart:Tn,fontSize:"fontSizes",background:Ii,backgroundColor:Ii,backgroundImage:Ii,borderImage:Ii,border:Ii,borderBlock:Ii,borderBlockEnd:Ii,borderBlockStart:Ii,borderBottom:Ii,borderBottomColor:Ii,borderColor:Ii,borderInline:Ii,borderInlineEnd:Ii,borderInlineStart:Ii,borderLeft:Ii,borderLeftColor:Ii,borderRight:Ii,borderRightColor:Ii,borderTop:Ii,borderTopColor:Ii,caretColor:Ii,color:Ii,columnRuleColor:Ii,fill:Ii,outline:Ii,outlineColor:Ii,stroke:Ii,textDecorationColor:Ii,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Pa,minBlockSize:Pa,maxBlockSize:Pa,inlineSize:Pa,minInlineSize:Pa,maxInlineSize:Pa,width:Pa,minWidth:Pa,maxWidth:Pa,height:Pa,minHeight:Pa,maxHeight:Pa,flexBasis:Pa,gridTemplateColumns:Pa,gridTemplateRows:Pa,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Bz=(n,t)=>typeof t=="function"?{"()":Function.prototype.toString.call(t)}:t,yp=()=>{const n=Object.create(null);return(t,r,...l)=>{const u=(d=>JSON.stringify(d,Bz))(t);return u in n?n[u]:n[u]=r(t,...l)}},Bd=Symbol.for("sxs.internal"),ex=(n,t)=>Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)),uC=n=>{for(const t in n)return!0;return!1},{hasOwnProperty:Rz}=Object.prototype,Wv=n=>n.includes("-")?n:n.replace(/[A-Z]/g,t=>"-"+t.toLowerCase()),Dz=/\s+(?![^()]*\))/,Of=n=>t=>n(...typeof t=="string"?String(t).split(Dz):[t]),hC={appearance:n=>({WebkitAppearance:n,appearance:n}),backfaceVisibility:n=>({WebkitBackfaceVisibility:n,backfaceVisibility:n}),backdropFilter:n=>({WebkitBackdropFilter:n,backdropFilter:n}),backgroundClip:n=>({WebkitBackgroundClip:n,backgroundClip:n}),boxDecorationBreak:n=>({WebkitBoxDecorationBreak:n,boxDecorationBreak:n}),clipPath:n=>({WebkitClipPath:n,clipPath:n}),content:n=>({content:n.includes('"')||n.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(n)?n:`"${n}"`}),hyphens:n=>({WebkitHyphens:n,hyphens:n}),maskImage:n=>({WebkitMaskImage:n,maskImage:n}),maskSize:n=>({WebkitMaskSize:n,maskSize:n}),tabSize:n=>({MozTabSize:n,tabSize:n}),textSizeAdjust:n=>({WebkitTextSizeAdjust:n,textSizeAdjust:n}),userSelect:n=>({WebkitUserSelect:n,userSelect:n}),marginBlock:Of((n,t)=>({marginBlockStart:n,marginBlockEnd:t||n})),marginInline:Of((n,t)=>({marginInlineStart:n,marginInlineEnd:t||n})),maxSize:Of((n,t)=>({maxBlockSize:n,maxInlineSize:t||n})),minSize:Of((n,t)=>({minBlockSize:n,minInlineSize:t||n})),paddingBlock:Of((n,t)=>({paddingBlockStart:n,paddingBlockEnd:t||n})),paddingInline:Of((n,t)=>({paddingInlineStart:n,paddingInlineEnd:t||n}))},q0=/([\d.]+)([^]*)/,Oz=(n,t)=>n.length?n.reduce((r,l)=>(r.push(...t.map(u=>u.includes("&")?u.replace(/&/g,/[ +>|~]/.test(l)&&/&.*&/.test(u)?`:is(${l})`:l):l+" "+u)),r),[]):t,kz=(n,t)=>n in zz&&typeof t=="string"?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(r,l,u,d)=>l+(u==="stretch"?`-moz-available${d};${Wv(n)}:${l}-webkit-fill-available`:`-moz-fit-content${d};${Wv(n)}:${l}fit-content`)+d):String(t),zz={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},hh=n=>n?n+"-":"",RM=(n,t,r)=>n.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(l,u,d,p,b)=>p=="$"==!!d?l:(u||p=="--"?"calc(":"")+"var(--"+(p==="$"?hh(t)+(b.includes("$")?"":hh(r))+b.replace(/\$/g,"-"):b)+")"+(u||p=="--"?"*"+(u||"")+(d||"1")+")":"")),Fz=/\s*,\s*(?![^()]*\))/,jz=Object.prototype.toString,$f=(n,t,r,l,u)=>{let d,p,b;const i=(E,T,A)=>{let I,O;const z=U=>{for(I in U){const X=I.charCodeAt(0)===64,J=X&&Array.isArray(U[I])?U[I]:[U[I]];for(O of J){const te=/[A-Z]/.test(V=I)?V:V.replace(/-[^]/g,ae=>ae[1].toUpperCase()),ue=typeof O=="object"&&O&&O.toString===jz&&(!l.utils[te]||!T.length);if(te in l.utils&&!ue){const ae=l.utils[te];if(ae!==p){p=ae,z(ae(O)),p=null;continue}}else if(te in hC){const ae=hC[te];if(ae!==b){b=ae,z(ae(O)),b=null;continue}}if(X&&(N=I.slice(1)in l.media?"@media "+l.media[I.slice(1)]:I,I=N.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(ae,be,Ce,je,me,Ne)=>{const ht=q0.test(be),_t=.0625*(ht?-1:1),[Bt,Kt]=ht?[je,be]:[be,je];return"("+(Ce[0]==="="?"":Ce[0]===">"===ht?"max-":"min-")+Bt+":"+(Ce[0]!=="="&&Ce.length===1?Kt.replace(q0,(Gt,hn,wt)=>Number(hn)+_t*(Ce===">"?1:-1)+wt):Kt)+(me?") and ("+(me[0]===">"?"min-":"max-")+Bt+":"+(me.length===1?Ne.replace(q0,(Gt,hn,wt)=>Number(hn)+_t*(me===">"?-1:1)+wt):Ne):"")+")"})),ue){const ae=X?A.concat(I):[...A],be=X?[...T]:Oz(T,I.split(Fz));d!==void 0&&u(dC(...d)),d=void 0,i(O,be,ae)}else d===void 0&&(d=[[],T,A]),I=X||I.charCodeAt(0)!==36?I:`--${hh(l.prefix)}${I.slice(1).replace(/\$/g,"-")}`,O=ue?O:typeof O=="number"?O&&te in Uz?String(O)+"px":String(O):RM(kz(te,O??""),l.prefix,l.themeMap[te]),d[0].push(`${X?`${I} `:`${Wv(I)}:`}${O}`)}}var N,V};z(E),d!==void 0&&u(dC(...d)),d=void 0};i(n,t,r)},dC=(n,t,r)=>`${r.map(l=>`${l}{`).join("")}${t.length?`${t.join(",")}{`:""}${n.join(";")}${t.length?"}":""}${Array(r.length?r.length+1:0).join("}")}`,Uz={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},fC=n=>String.fromCharCode(n+(n>25?39:97)),Rd=n=>(t=>{let r,l="";for(r=Math.abs(t);r>52;r=r/52|0)l=fC(r%52)+l;return fC(r%52)+l})(((t,r)=>{let l=r.length;for(;l;)t=33*t^r.charCodeAt(--l);return t})(5381,JSON.stringify(n))>>>0),ym=["themed","global","styled","onevar","resonevar","allvar","inline"],Nz=n=>{if(n.href&&!n.href.startsWith(location.origin))return!1;try{return!!n.cssRules}catch{return!1}},Gz=n=>{let t;const r=()=>{const{cssRules:u}=t.sheet;return[].map.call(u,(d,p)=>{const{cssText:b}=d;let i="";if(b.startsWith("--sxs"))return"";if(u[p-1]&&(i=u[p-1].cssText).startsWith("--sxs")){if(!d.cssRules.length)return"";for(const E in t.rules)if(t.rules[E].group===d)return`--sxs{--sxs:${[...t.rules[E].cache].join(" ")}}${b}`;return d.cssRules.length?`${i}${b}`:""}return b}).join("")},l=()=>{if(t){const{rules:b,sheet:i}=t;if(!i.deleteRule){for(;Object(Object(i.cssRules)[0]).type===3;)i.cssRules.splice(0,1);i.cssRules=[]}for(const E in b)delete b[E]}const u=Object(n).styleSheets||[];for(const b of u)if(Nz(b)){for(let i=0,E=b.cssRules;E[i];++i){const T=Object(E[i]);if(T.type!==1)continue;const A=Object(E[i+1]);if(A.type!==4)continue;++i;const{cssText:I}=T;if(!I.startsWith("--sxs"))continue;const O=I.slice(14,-3).trim().split(/\s+/),z=ym[O[0]];z&&(t||(t={sheet:b,reset:l,rules:{},toString:r}),t.rules[z]={group:A,index:i,cache:new Set(O)})}if(t)break}if(!t){const b=(i,E)=>({type:E,cssRules:[],insertRule(T,A){this.cssRules.splice(A,0,b(T,{import:3,undefined:1}[(T.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return i==="@media{}"?`@media{${[].map.call(this.cssRules,T=>T.cssText).join("")}}`:i}});t={sheet:n?(n.head||n).appendChild(document.createElement("style")).sheet:b("","text/css"),rules:{},reset:l,toString:r}}const{sheet:d,rules:p}=t;for(let b=ym.length-1;b>=0;--b){const i=ym[b];if(!p[i]){const E=ym[b+1],T=p[E]?p[E].index:d.cssRules.length;d.insertRule("@media{}",T),d.insertRule(`--sxs{--sxs:${b}}`,T),p[i]={group:d.cssRules[T+1],index:T,cache:new Set([b])}}Vz(p[i])}};return l(),t},Vz=n=>{const t=n.group;let r=t.cssRules.length;n.apply=l=>{try{t.insertRule(l,r),++r}catch{}}},hm=Symbol(),$z=yp(),pC=(n,t)=>$z(n,()=>(...r)=>{let l={type:null,composers:new Set};for(const u of r)if(u!=null)if(u[Bd]){l.type==null&&(l.type=u[Bd].type);for(const d of u[Bd].composers)l.composers.add(d)}else u.constructor!==Object||u.$$typeof?l.type==null&&(l.type=u):l.composers.add(Hz(u,n));return l.type==null&&(l.type="span"),l.composers.size||l.composers.add(["PJLV",{},[],[],{},[]]),Wz(n,l,t)}),Hz=({variants:n,compoundVariants:t,defaultVariants:r,...l},u)=>{const d=`${hh(u.prefix)}c-${Rd(l)}`,p=[],b=[],i=Object.create(null),E=[];for(const I in r)i[I]=String(r[I]);if(typeof n=="object"&&n)for(const I in n){T=i,A=I,Rz.call(T,A)||(i[I]="undefined");const O=n[I];for(const z in O){const U={[I]:String(z)};String(z)==="undefined"&&E.push(I);const N=O[z],V=[U,N,!uC(N)];p.push(V)}}var T,A;if(typeof t=="object"&&t)for(const I of t){let{css:O,...z}=I;O=typeof O=="object"&&O||{};for(const N in z)z[N]=String(z[N]);const U=[z,O,!uC(O)];b.push(U)}return[d,l,p,b,i,E]},Wz=(n,t,r)=>{const[l,u,d,p]=Zz(t.composers),b=typeof t.type=="function"||t.type.$$typeof?(A=>{function I(){for(let O=0;O<I[hm].length;O++){const[z,U]=I[hm][O];A.rules[z].apply(U)}return I[hm]=[],null}return I[hm]=[],I.rules={},ym.forEach(O=>I.rules[O]={apply:z=>I[hm].push([O,z])}),I})(r):null,i=(b||r).rules,E=`.${l}${u.length>1?`:where(.${u.slice(1).join(".")})`:""}`,T=A=>{A=typeof A=="object"&&A||Xz;const{css:I,...O}=A,z={};for(const V in d)if(delete O[V],V in A){let X=A[V];typeof X=="object"&&X?z[V]={"@initial":d[V],...X}:(X=String(X),z[V]=X!=="undefined"||p.has(V)?X:d[V])}else z[V]=d[V];const U=new Set([...u]);for(const[V,X,J,te]of t.composers){r.rules.styled.cache.has(V)||(r.rules.styled.cache.add(V),$f(X,[`.${V}`],[],n,be=>{i.styled.apply(be)}));const ue=mC(J,z,n.media),ae=mC(te,z,n.media,!0);for(const be of ue)if(be!==void 0)for(const[Ce,je,me]of be){const Ne=`${V}-${Rd(je)}-${Ce}`;U.add(Ne);const ht=(me?r.rules.resonevar:r.rules.onevar).cache,_t=me?i.resonevar:i.onevar;ht.has(Ne)||(ht.add(Ne),$f(je,[`.${Ne}`],[],n,Bt=>{_t.apply(Bt)}))}for(const be of ae)if(be!==void 0)for(const[Ce,je]of be){const me=`${V}-${Rd(je)}-${Ce}`;U.add(me),r.rules.allvar.cache.has(me)||(r.rules.allvar.cache.add(me),$f(je,[`.${me}`],[],n,Ne=>{i.allvar.apply(Ne)}))}}if(typeof I=="object"&&I){const V=`${l}-i${Rd(I)}-css`;U.add(V),r.rules.inline.cache.has(V)||(r.rules.inline.cache.add(V),$f(I,[`.${V}`],[],n,X=>{i.inline.apply(X)}))}for(const V of String(A.className||"").trim().split(/\s+/))V&&U.add(V);const N=O.className=[...U].join(" ");return{type:t.type,className:N,selector:E,props:O,toString:()=>N,deferredInjector:b}};return ex(T,{className:l,selector:E,[Bd]:t,toString:()=>(r.rules.styled.cache.has(l)||T(),l)})},Zz=n=>{let t="";const r=[],l={},u=[];for(const[d,,,,p,b]of n){t===""&&(t=d),r.push(d),u.push(...b);for(const i in p){const E=p[i];(l[i]===void 0||E!=="undefined"||b.includes(E))&&(l[i]=E)}}return[t,r,l,new Set(u)]},mC=(n,t,r,l)=>{const u=[];e:for(let[d,p,b]of n){if(b)continue;let i,E=0,T=!1;for(i in d){const A=d[i];let I=t[i];if(I!==A){if(typeof I!="object"||!I)continue e;{let O,z,U=0;for(const N in I){if(A===String(I[N])){if(N!=="@initial"){const V=N.slice(1);(z=z||[]).push(V in r?r[V]:N.replace(/^@media ?/,"")),T=!0}E+=U,O=!0}++U}if(z&&z.length&&(p={["@media "+z.join(", ")]:p}),!O)continue e}}}(u[E]=u[E]||[]).push([l?"cv":`${i}-${d[i]}`,p,T])}return u},Xz={},qz=yp(),Kz=(n,t)=>qz(n,()=>(...r)=>{const l=()=>{for(let u of r){u=typeof u=="object"&&u||{};let d=Rd(u);if(!t.rules.global.cache.has(d)){if(t.rules.global.cache.add(d),"@import"in u){let p=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let b of[].concat(u["@import"]))b=b.includes('"')||b.includes("'")?b:`"${b}"`,t.sheet.insertRule(`@import ${b};`,p++);delete u["@import"]}$f(u,[],[],n,p=>{t.rules.global.apply(p)})}}return""};return ex(l,{toString:l})}),Jz=yp(),Yz=(n,t)=>Jz(n,()=>r=>{const l=`${hh(n.prefix)}k-${Rd(r)}`,u=()=>{if(!t.rules.global.cache.has(l)){t.rules.global.cache.add(l);const d=[];$f(r,[],[],n,b=>d.push(b));const p=`@keyframes ${l}{${d.join("")}}`;t.rules.global.apply(p)}return l};return ex(u,{get name(){return u()},toString:u})}),Qz=class{constructor(n,t,r,l){this.token=n==null?"":String(n),this.value=t==null?"":String(t),this.scale=r==null?"":String(r),this.prefix=l==null?"":String(l)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+hh(this.prefix)+hh(this.scale)+this.token}toString(){return this.computedValue}},eF=yp(),tF=(n,t)=>eF(n,()=>(r,l)=>{l=typeof r=="object"&&r||Object(l);const u=`.${r=(r=typeof r=="string"?r:"")||`${hh(n.prefix)}t-${Rd(l)}`}`,d={},p=[];for(const i in l){d[i]={};for(const E in l[i]){const T=`--${hh(n.prefix)}${i}-${E}`,A=RM(String(l[i][E]),n.prefix,i);d[i][E]=new Qz(E,A,i,n.prefix),p.push(`${T}:${A}`)}}const b=()=>{if(p.length&&!t.rules.themed.cache.has(r)){t.rules.themed.cache.add(r);const i=`${l===n.theme?":root,":""}.${r}{${p.join(";")}}`;t.rules.themed.apply(i)}return r};return{...d,get className(){return b()},selector:u,toString:b}}),nF=yp(),gC,rF=yp(),DM=n=>{const t=(r=>{let l=!1;const u=nF(r,d=>{l=!0;const p="prefix"in(d=typeof d=="object"&&d||{})?String(d.prefix):"",b=typeof d.media=="object"&&d.media||{},i=typeof d.root=="object"?d.root||null:globalThis.document||null,E=typeof d.theme=="object"&&d.theme||{},T={prefix:p,media:b,theme:E,themeMap:typeof d.themeMap=="object"&&d.themeMap||{...Lz},utils:typeof d.utils=="object"&&d.utils||{}},A=Gz(i),I={css:pC(T,A),globalCss:Kz(T,A),keyframes:Yz(T,A),createTheme:tF(T,A),reset(){A.reset(),I.theme.toString()},theme:{},sheet:A,config:T,prefix:p,getCssText:A.toString,toString:A.toString};return String(I.theme=I.createTheme(E)),I});return l||u.reset(),u})(n);return t.styled=(({config:r,sheet:l})=>rF(r,()=>{const u=pC(r,l);return(...d)=>{const p=u(...d),b=p[Bd].type,i=Pe.forwardRef((E,T)=>{const A=E&&E.as||b,{props:I,deferredInjector:O}=p(E);return delete I.as,I.ref=T,O?Pe.createElement(Pe.Fragment,null,Pe.createElement(A,I),Pe.createElement(O,null)):Pe.createElement(A,I)});return i.className=p.className,i.displayName=`Styled.${b.displayName||b.name||b}`,i.selector=p.selector,i.toString=()=>p.selector,i[Bd]=p[Bd],i}}))(t),t},iF=()=>gC||(gC=DM()),xs=(...n)=>iF().styled(...n);function oF(n,t,r){return Math.max(t,Math.min(n,r))}const ma={toVector(n,t){return n===void 0&&(n=t),Array.isArray(n)?n:[n,n]},add(n,t){return[n[0]+t[0],n[1]+t[1]]},sub(n,t){return[n[0]-t[0],n[1]-t[1]]},addTo(n,t){n[0]+=t[0],n[1]+=t[1]},subTo(n,t){n[0]-=t[0],n[1]-=t[1]}};function _C(n,t,r){return t===0||Math.abs(t)===1/0?Math.pow(n,r*5):n*t*r/(t+r*n)}function yC(n,t,r,l=.15){return l===0?oF(n,t,r):n<t?-_C(t-n,r-t,l)+t:n>r?+_C(n-r,r-t,l)+r:n}function sF(n,[t,r],[l,u]){const[[d,p],[b,i]]=n;return[yC(t,d,p,l),yC(r,b,i,u)]}function aF(n,t){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var l=r.call(n,t||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function lF(n){var t=aF(n,"string");return typeof t=="symbol"?t:String(t)}function ml(n,t,r){return t=lF(t),t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function vC(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable})),r.push.apply(r,l)}return r}function vo(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vC(Object(r),!0).forEach(function(l){ml(n,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):vC(Object(r)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(r,l))})}return n}const OM={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function xC(n){return n?n[0].toUpperCase()+n.slice(1):""}const cF=["enter","leave"];function uF(n=!1,t){return n&&!cF.includes(t)}function hF(n,t="",r=!1){const l=OM[n],u=l&&l[t]||t;return"on"+xC(n)+xC(u)+(uF(r,u)?"Capture":"")}const dF=["gotpointercapture","lostpointercapture"];function fF(n){let t=n.substring(2).toLowerCase();const r=!!~t.indexOf("passive");r&&(t=t.replace("passive",""));const l=dF.includes(t)?"capturecapture":"capture",u=!!~t.indexOf(l);return u&&(t=t.replace("capture","")),{device:t,capture:u,passive:r}}function pF(n,t=""){const r=OM[n],l=r&&r[t]||t;return n+l}function J_(n){return"touches"in n}function kM(n){return J_(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function mF(n){return Array.from(n.touches).filter(t=>{var r,l;return t.target===n.currentTarget||((r=n.currentTarget)===null||r===void 0||(l=r.contains)===null||l===void 0?void 0:l.call(r,t.target))})}function gF(n){return n.type==="touchend"||n.type==="touchcancel"?n.changedTouches:n.targetTouches}function zM(n){return J_(n)?gF(n)[0]:n}function _F(n){return mF(n).map(t=>t.identifier)}function K0(n){const t=zM(n);return J_(n)?t.identifier:t.pointerId}function bC(n){const t=zM(n);return[t.clientX,t.clientY]}function yF(n){const t={};if("buttons"in n&&(t.buttons=n.buttons),"shiftKey"in n){const{shiftKey:r,altKey:l,metaKey:u,ctrlKey:d}=n;Object.assign(t,{shiftKey:r,altKey:l,metaKey:u,ctrlKey:d})}return t}function w_(n,...t){return typeof n=="function"?n(...t):n}function vF(){}function xF(...n){return n.length===0?vF:n.length===1?n[0]:function(){let t;for(const r of n)t=r.apply(this,arguments)||t;return t}}function wC(n,t){return Object.assign({},t,n||{})}const bF=32;class wF{constructor(t,r,l){this.ctrl=t,this.args=r,this.key=l,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:r,ingKey:l,args:u}=this;r[l]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=u,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const r=this.state,l=this.config;r._active||(this.reset(),this.computeInitial(),r._active=!0,r.target=t.target,r.currentTarget=t.currentTarget,r.lastOffset=l.from?w_(l.from,r):r.offset,r.offset=r.lastOffset,r.startTime=r.timeStamp=t.timeStamp)}computeValues(t){const r=this.state;r._values=t,r.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:r,config:l,shared:u}=this;r.args=this.args;let d=0;if(t&&(r.event=t,l.preventDefault&&t.cancelable&&r.event.preventDefault(),r.type=t.type,u.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,u.locked=!!document.pointerLockElement,Object.assign(u,yF(t)),u.down=u.pressed=u.buttons%2===1||u.touches>0,d=t.timeStamp-r.timeStamp,r.timeStamp=t.timeStamp,r.elapsedTime=r.timeStamp-r.startTime),r._active){const ae=r._delta.map(Math.abs);ma.addTo(r._distance,ae)}this.axisIntent&&this.axisIntent(t);const[p,b]=r._movement,[i,E]=l.threshold,{_step:T,values:A}=r;if(l.hasCustomTransform?(T[0]===!1&&(T[0]=Math.abs(p)>=i&&A[0]),T[1]===!1&&(T[1]=Math.abs(b)>=E&&A[1])):(T[0]===!1&&(T[0]=Math.abs(p)>=i&&Math.sign(p)*i),T[1]===!1&&(T[1]=Math.abs(b)>=E&&Math.sign(b)*E)),r.intentional=T[0]!==!1||T[1]!==!1,!r.intentional)return;const I=[0,0];if(l.hasCustomTransform){const[ae,be]=A;I[0]=T[0]!==!1?ae-T[0]:0,I[1]=T[1]!==!1?be-T[1]:0}else I[0]=T[0]!==!1?p-T[0]:0,I[1]=T[1]!==!1?b-T[1]:0;this.restrictToAxis&&!r._blocked&&this.restrictToAxis(I);const O=r.offset,z=r._active&&!r._blocked||r.active;z&&(r.first=r._active&&!r.active,r.last=!r._active&&r.active,r.active=u[this.ingKey]=r._active,t&&(r.first&&("bounds"in l&&(r._bounds=w_(l.bounds,r)),this.setup&&this.setup()),r.movement=I,this.computeOffset()));const[U,N]=r.offset,[[V,X],[J,te]]=r._bounds;r.overflow=[U<V?-1:U>X?1:0,N<J?-1:N>te?1:0],r._movementBound[0]=r.overflow[0]?r._movementBound[0]===!1?r._movement[0]:r._movementBound[0]:!1,r._movementBound[1]=r.overflow[1]?r._movementBound[1]===!1?r._movement[1]:r._movementBound[1]:!1;const ue=r._active?l.rubberband||[0,0]:[0,0];if(r.offset=sF(r._bounds,r.offset,ue),r.delta=ma.sub(r.offset,O),this.computeMovement(),z&&(!r.last||d>bF)){r.delta=ma.sub(r.offset,O);const ae=r.delta.map(Math.abs);ma.addTo(r.distance,ae),r.direction=r.delta.map(Math.sign),r._direction=r._delta.map(Math.sign),!r.first&&d>0&&(r.velocity=[ae[0]/d,ae[1]/d],r.timeDelta=d)}}emit(){const t=this.state,r=this.shared,l=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!l.triggerAllEvents)return;const u=this.handler(vo(vo(vo({},r),t),{},{[this.aliasKey]:t.values}));u!==void 0&&(t.memo=u)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function EF([n,t],r){const l=Math.abs(n),u=Math.abs(t);if(l>u&&l>r)return"x";if(u>l&&u>r)return"y"}class CF extends wF{constructor(...t){super(...t),ml(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=ma.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=ma.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const r=this.state,l=this.config;if(!r.axis&&t){const u=typeof l.axisThreshold=="object"?l.axisThreshold[kM(t)]:l.axisThreshold;r.axis=EF(r._movement,u)}r._blocked=(l.lockDirection||!!l.axis)&&!r.axis||!!l.axis&&l.axis!==r.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const AF=n=>n,EC=.15,FM={enabled(n=!0){return n},eventOptions(n,t,r){return vo(vo({},r.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[EC,EC];case!1:return[0,0];default:return ma.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return ma.toVector(n)},transform(n,t,r){const l=n||r.shared.transform;return this.hasCustomTransform=!!l,l||AF},threshold(n){return ma.toVector(n,0)}},TF=0,Gm=vo(vo({},FM),{},{axis(n,t,{axis:r}){if(this.lockDirection=r==="lock",!this.lockDirection)return r},axisThreshold(n=TF){return n},bounds(n={}){if(typeof n=="function")return d=>Gm.bounds(n(d));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:t=-1/0,right:r=1/0,top:l=-1/0,bottom:u=1/0}=n;return[[t,r],[l,u]]}}),CC={ArrowRight:(n,t=1)=>[n*t,0],ArrowLeft:(n,t=1)=>[-1*n*t,0],ArrowUp:(n,t=1)=>[0,-1*n*t],ArrowDown:(n,t=1)=>[0,n*t]};class SF extends CF{constructor(...t){super(...t),ml(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const r=t._bounds.getBoundingClientRect(),l=t.currentTarget.getBoundingClientRect(),u={left:r.left-l.left+t.offset[0],right:r.right-l.right+t.offset[0],top:r.top-l.top+t.offset[1],bottom:r.bottom-l.bottom+t.offset[1]};t._bounds=Gm.bounds(u)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const r=this.config,l=this.state;if(t.buttons!=null&&(Array.isArray(r.pointerButtons)?!r.pointerButtons.includes(t.buttons):r.pointerButtons!==-1&&r.pointerButtons!==t.buttons))return;const u=this.ctrl.setEventIds(t);r.pointerCapture&&t.target.setPointerCapture(t.pointerId),!(u&&u.size>1&&l._pointerActive)&&(this.start(t),this.setupPointer(t),l._pointerId=K0(t),l._pointerActive=!0,this.computeValues(bC(t)),this.computeInitial(),r.preventScrollAxis&&kM(t)!=="mouse"?(l._active=!1,this.setupScrollPrevention(t)):r.delay>0?(this.setupDelayTrigger(t),r.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const r=this.state;r._active=!0,r._preventScroll=!0,r._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const r=this.state,l=this.config;if(!r._pointerActive)return;const u=K0(t);if(r._pointerId!==void 0&&u!==r._pointerId)return;const d=bC(t);if(document.pointerLockElement===t.target?r._delta=[t.movementX,t.movementY]:(r._delta=ma.sub(d,r._values),this.computeValues(d)),ma.addTo(r._movement,r._delta),this.compute(t),r._delayed&&r.intentional){this.timeoutStore.remove("dragDelay"),r.active=!1,this.startPointerDrag(t);return}if(l.preventScrollAxis&&!r._preventScroll)if(r.axis)if(r.axis===l.preventScrollAxis||l.preventScrollAxis==="xy"){r._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(t);return}else return;this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch{}const r=this.state,l=this.config;if(!r._active||!r._pointerActive)return;const u=K0(t);if(r._pointerId!==void 0&&u!==r._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[d,p]=r._distance;if(r.tap=d<=l.tapsThreshold&&p<=l.tapsThreshold,r.tap&&l.filterTaps)r._force=!0;else{const[b,i]=r._delta,[E,T]=r._movement,[A,I]=l.swipe.velocity,[O,z]=l.swipe.distance,U=l.swipe.duration;if(r.elapsedTime<U){const N=Math.abs(b/r.timeDelta),V=Math.abs(i/r.timeDelta);N>A&&Math.abs(E)>O&&(r.swipe[0]=Math.sign(b)),V>I&&Math.abs(T)>z&&(r.swipe[1]=Math.sign(i))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const r=this.config,l=r.device;r.pointerLock&&t.currentTarget.requestPointerLock(),r.pointerCapture||(this.eventStore.add(this.sharedConfig.window,l,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,l,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,l,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,MF(t);const r=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",r),this.eventStore.add(this.sharedConfig.window,"touch","cancel",r),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const r=CC[t.key];if(r){const l=this.state,u=t.shiftKey?10:t.altKey?.1:1;this.start(t),l._delta=r(this.config.keyboardDisplacement,u),l._keyboardActive=!0,ma.addTo(l._movement,l._delta),this.compute(t),this.emit()}}keyUp(t){t.key in CC&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const r=this.config.device;t(r,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(r,"change",this.pointerMove.bind(this)),t(r,"end",this.pointerUp.bind(this)),t(r,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function MF(n){"persist"in n&&typeof n.persist=="function"&&n.persist()}const Vm=typeof window<"u"&&window.document&&window.document.createElement;function jM(){return Vm&&"ontouchstart"in window}function IF(){return jM()||Vm&&window.navigator.maxTouchPoints>1}function PF(){return Vm&&"onpointerdown"in window}function LF(){return Vm&&"exitPointerLock"in window.document}function BF(){try{return"constructor"in GestureEvent}catch{return!1}}const sc={isBrowser:Vm,gesture:BF(),touch:jM(),touchscreen:IF(),pointer:PF(),pointerLock:LF()},RF=250,DF=180,OF=.5,kF=50,zF=250,FF=10,AC={mouse:0,touch:0,pen:8},jF=vo(vo({},Gm),{},{device(n,t,{pointer:{touch:r=!1,lock:l=!1,mouse:u=!1}={}}){return this.pointerLock=l&&sc.pointerLock,sc.touch&&r?"touch":this.pointerLock?"mouse":sc.pointer&&!u?"pointer":sc.touch?"touch":"mouse"},preventScrollAxis(n,t,{preventScroll:r}){if(this.preventScrollDelay=typeof r=="number"?r:r||r===void 0&&n?RF:void 0,!(!sc.touchscreen||r===!1))return n||(r!==void 0?"y":void 0)},pointerCapture(n,t,{pointer:{capture:r=!0,buttons:l=1,keys:u=!0}={}}){return this.pointerButtons=l,this.keys=u,!this.pointerLock&&this.device==="pointer"&&r},threshold(n,t,{filterTaps:r=!1,tapsThreshold:l=3,axis:u=void 0}){const d=ma.toVector(n,r?l:u?1:0);return this.filterTaps=r,this.tapsThreshold=l,d},swipe({velocity:n=OF,distance:t=kF,duration:r=zF}={}){return{velocity:this.transform(ma.toVector(n)),distance:this.transform(ma.toVector(t)),duration:r}},delay(n=0){switch(n){case!0:return DF;case!1:return 0;default:return n}},axisThreshold(n){return n?vo(vo({},AC),n):AC},keyboardDisplacement(n=FF){return n}});vo(vo({},FM),{},{device(n,t,{shared:r,pointer:{touch:l=!1}={}}){if(r.target&&!sc.touch&&sc.gesture)return"gesture";if(sc.touch&&l)return"touch";if(sc.touchscreen){if(sc.pointer)return"pointer";if(sc.touch)return"touch"}},bounds(n,t,{scaleBounds:r={},angleBounds:l={}}){const u=p=>{const b=wC(w_(r,p),{min:-1/0,max:1/0});return[b.min,b.max]},d=p=>{const b=wC(w_(l,p),{min:-1/0,max:1/0});return[b.min,b.max]};return typeof r!="function"&&typeof l!="function"?[u(),d()]:p=>[u(p),d(p)]},threshold(n,t,r){return this.lockDirection=r.axis==="lock",ma.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});vo(vo({},Gm),{},{mouseOnly:(n=!0)=>n});vo(vo({},Gm),{},{mouseOnly:(n=!0)=>n});const UM=new Map,Zv=new Map;function UF(n){UM.set(n.key,n.engine),Zv.set(n.key,n.resolver)}const NF={key:"drag",engine:SF,resolver:jF};function GF(n,t){if(n==null)return{};var r={},l=Object.keys(n),u,d;for(d=0;d<l.length;d++)u=l[d],!(t.indexOf(u)>=0)&&(r[u]=n[u]);return r}function VF(n,t){if(n==null)return{};var r=GF(n,t),l,u;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(u=0;u<d.length;u++)l=d[u],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(n,l)&&(r[l]=n[l])}return r}const $F={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=sc.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:t=!1}={}){return{passive:n,capture:t}},transform(n){return n}},HF=["target","eventOptions","window","enabled","transform"];function c_(n={},t){const r={};for(const[l,u]of Object.entries(t))switch(typeof u){case"function":r[l]=u.call(r,n[l],l,n);break;case"object":r[l]=c_(n[l],u);break;case"boolean":u&&(r[l]=n[l]);break}return r}function WF(n,t,r={}){const l=n,{target:u,eventOptions:d,window:p,enabled:b,transform:i}=l,E=VF(l,HF);if(r.shared=c_({target:u,eventOptions:d,window:p,enabled:b,transform:i},$F),t){const T=Zv.get(t);r[t]=c_(vo({shared:r.shared},E),T)}else for(const T in E){const A=Zv.get(T);A&&(r[T]=c_(vo({shared:r.shared},E[T]),A))}return r}class NM{constructor(t,r){ml(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=r}add(t,r,l,u,d){const p=this._listeners,b=pF(r,l),i=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},E=vo(vo({},i),d);t.addEventListener(b,u,E);const T=()=>{t.removeEventListener(b,u,E),p.delete(T)};return p.add(T),T}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}}class ZF{constructor(){ml(this,"_timeouts",new Map)}add(t,r,l=140,...u){this.remove(t),this._timeouts.set(t,window.setTimeout(r,l,...u))}remove(t){const r=this._timeouts.get(t);r&&window.clearTimeout(r)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class XF{constructor(t){ml(this,"gestures",new Set),ml(this,"_targetEventStore",new NM(this)),ml(this,"gestureEventStores",{}),ml(this,"gestureTimeoutStores",{}),ml(this,"handlers",{}),ml(this,"config",{}),ml(this,"pointerIds",new Set),ml(this,"touchIds",new Set),ml(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),qF(this,t)}setEventIds(t){if(J_(t))return this.touchIds=new Set(_F(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,r){this.handlers=t,this.nativeHandlers=r}applyConfig(t,r){this.config=WF(t,r,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const r=this.config.shared,l={};let u;if(!(r.target&&(u=r.target(),!u))){if(r.enabled){for(const p of this.gestures){const b=this.config[p],i=TC(l,b.eventOptions,!!u);if(b.enabled){const E=UM.get(p);new E(this,t,p).bind(i)}}const d=TC(l,r.eventOptions,!!u);for(const p in this.nativeHandlers)d(p,"",b=>this.nativeHandlers[p](vo(vo({},this.state.shared),{},{event:b,args:t})),void 0,!0)}for(const d in l)l[d]=xF(...l[d]);if(!u)return l;for(const d in l){const{device:p,capture:b,passive:i}=fF(d);this._targetEventStore.add(u,p,"",l[d],{capture:b,passive:i})}}}}function kf(n,t){n.gestures.add(t),n.gestureEventStores[t]=new NM(n,t),n.gestureTimeoutStores[t]=new ZF}function qF(n,t){t.drag&&kf(n,"drag"),t.wheel&&kf(n,"wheel"),t.scroll&&kf(n,"scroll"),t.move&&kf(n,"move"),t.pinch&&kf(n,"pinch"),t.hover&&kf(n,"hover")}const TC=(n,t,r)=>(l,u,d,p={},b=!1)=>{var i,E;const T=(i=p.capture)!==null&&i!==void 0?i:t.capture,A=(E=p.passive)!==null&&E!==void 0?E:t.passive;let I=b?l:hF(l,u,T);r&&A&&(I+="Passive"),n[I]=n[I]||[],n[I].push(d)};function KF(n,t={},r,l){const u=Pe.useMemo(()=>new XF(n),[]);if(u.applyHandlers(n,l),u.applyConfig(t,r),Pe.useEffect(u.effect.bind(u)),Pe.useEffect(()=>u.clean.bind(u),[]),t.target===void 0)return u.bind.bind(u)}function JF(n,t){return UF(NF),KF({drag:n},t||{},"drag")}function rh(n,t,{checkForDefaultPrevented:r=!0}={}){return function(u){if(n==null||n(u),r===!1||!u.defaultPrevented)return t==null?void 0:t(u)}}function GM(n,t=[]){let r=[];function l(d,p){const b=k.createContext(p),i=r.length;r=[...r,p];function E(A){const{scope:I,children:O,...z}=A,U=(I==null?void 0:I[n][i])||b,N=k.useMemo(()=>z,Object.values(z));return k.createElement(U.Provider,{value:N},O)}function T(A,I){const O=(I==null?void 0:I[n][i])||b,z=k.useContext(O);if(z)return z;if(p!==void 0)return p;throw new Error(`\`${A}\` must be used within \`${d}\``)}return E.displayName=d+"Provider",[E,T]}const u=()=>{const d=r.map(p=>k.createContext(p));return function(b){const i=(b==null?void 0:b[n])||d;return k.useMemo(()=>({[`__scope${n}`]:{...b,[n]:i}}),[b,i])}};return u.scopeName=n,[l,YF(u,...t)]}function YF(...n){const t=n[0];if(n.length===1)return t;const r=()=>{const l=n.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(d){const p=l.reduce((b,{useScope:i,scopeName:E})=>{const A=i(d)[`__scope${E}`];return{...b,...A}},{});return k.useMemo(()=>({[`__scope${t.scopeName}`]:p}),[p])}};return r.scopeName=t.scopeName,r}function vp(n){const t=k.useRef(n);return k.useEffect(()=>{t.current=n}),k.useMemo(()=>(...r)=>{var l;return(l=t.current)===null||l===void 0?void 0:l.call(t,...r)},[])}function QF(n,t=globalThis==null?void 0:globalThis.document){const r=vp(n);k.useEffect(()=>{const l=u=>{u.key==="Escape"&&r(u)};return t.addEventListener("keydown",l),()=>t.removeEventListener("keydown",l)},[r,t])}const Xv="dismissableLayer.update",e9="dismissableLayer.pointerDownOutside",t9="dismissableLayer.focusOutside";let SC;const n9=k.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),r9=k.forwardRef((n,t)=>{var r;const{disableOutsidePointerEvents:l=!1,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:p,onInteractOutside:b,onDismiss:i,...E}=n,T=k.useContext(n9),[A,I]=k.useState(null),O=(r=A==null?void 0:A.ownerDocument)!==null&&r!==void 0?r:globalThis==null?void 0:globalThis.document,[,z]=k.useState({}),U=_p(t,Ce=>I(Ce)),N=Array.from(T.layers),[V]=[...T.layersWithOutsidePointerEventsDisabled].slice(-1),X=N.indexOf(V),J=A?N.indexOf(A):-1,te=T.layersWithOutsidePointerEventsDisabled.size>0,ue=J>=X,ae=i9(Ce=>{const je=Ce.target,me=[...T.branches].some(Ne=>Ne.contains(je));!ue||me||(d==null||d(Ce),b==null||b(Ce),Ce.defaultPrevented||i==null||i())},O),be=o9(Ce=>{const je=Ce.target;[...T.branches].some(Ne=>Ne.contains(je))||(p==null||p(Ce),b==null||b(Ce),Ce.defaultPrevented||i==null||i())},O);return QF(Ce=>{J===T.layers.size-1&&(u==null||u(Ce),!Ce.defaultPrevented&&i&&(Ce.preventDefault(),i()))},O),k.useEffect(()=>{if(A)return l&&(T.layersWithOutsidePointerEventsDisabled.size===0&&(SC=O.body.style.pointerEvents,O.body.style.pointerEvents="none"),T.layersWithOutsidePointerEventsDisabled.add(A)),T.layers.add(A),MC(),()=>{l&&T.layersWithOutsidePointerEventsDisabled.size===1&&(O.body.style.pointerEvents=SC)}},[A,O,l,T]),k.useEffect(()=>()=>{A&&(T.layers.delete(A),T.layersWithOutsidePointerEventsDisabled.delete(A),MC())},[A,T]),k.useEffect(()=>{const Ce=()=>z({});return document.addEventListener(Xv,Ce),()=>document.removeEventListener(Xv,Ce)},[]),k.createElement(jd.div,Gr({},E,{ref:U,style:{pointerEvents:te?ue?"auto":"none":void 0,...n.style},onFocusCapture:rh(n.onFocusCapture,be.onFocusCapture),onBlurCapture:rh(n.onBlurCapture,be.onBlurCapture),onPointerDownCapture:rh(n.onPointerDownCapture,ae.onPointerDownCapture)}))});function i9(n,t=globalThis==null?void 0:globalThis.document){const r=vp(n),l=k.useRef(!1),u=k.useRef(()=>{});return k.useEffect(()=>{const d=b=>{if(b.target&&!l.current){let E=function(){VM(e9,r,i,{discrete:!0})};const i={originalEvent:b};b.pointerType==="touch"?(t.removeEventListener("click",u.current),u.current=E,t.addEventListener("click",u.current,{once:!0})):E()}else t.removeEventListener("click",u.current);l.current=!1},p=window.setTimeout(()=>{t.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(p),t.removeEventListener("pointerdown",d),t.removeEventListener("click",u.current)}},[t,r]),{onPointerDownCapture:()=>l.current=!0}}function o9(n,t=globalThis==null?void 0:globalThis.document){const r=vp(n),l=k.useRef(!1);return k.useEffect(()=>{const u=d=>{d.target&&!l.current&&VM(t9,r,{originalEvent:d},{discrete:!1})};return t.addEventListener("focusin",u),()=>t.removeEventListener("focusin",u)},[t,r]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function MC(){const n=new CustomEvent(Xv);document.dispatchEvent(n)}function VM(n,t,r,{discrete:l}){const u=r.originalEvent.target,d=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:r});t&&u.addEventListener(n,t,{once:!0}),l?Cz(u,d):u.dispatchEvent(d)}const op=globalThis!=null&&globalThis.document?k.useLayoutEffect:()=>{},s9=bR.useId||(()=>{});let a9=0;function l9(n){const[t,r]=k.useState(s9());return op(()=>{r(l=>l??String(a9++))},[n]),t?`radix-${t}`:""}const c9=k.forwardRef((n,t)=>{const{children:r,width:l=10,height:u=5,...d}=n;return k.createElement(jd.svg,Gr({},d,{ref:t,width:l,height:u,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),n.asChild?r:k.createElement("polygon",{points:"0,0 30,0 15,10"}))}),u9=c9;function h9(n){const[t,r]=k.useState(void 0);return op(()=>{if(n){r({width:n.offsetWidth,height:n.offsetHeight});const l=new ResizeObserver(u=>{if(!Array.isArray(u)||!u.length)return;const d=u[0];let p,b;if("borderBoxSize"in d){const i=d.borderBoxSize,E=Array.isArray(i)?i[0]:i;p=E.inlineSize,b=E.blockSize}else p=n.offsetWidth,b=n.offsetHeight;r({width:p,height:b})});return l.observe(n,{box:"border-box"}),()=>l.unobserve(n)}else r(void 0)},[n]),t}const $M="Popper",[HM,WM]=GM($M),[d9,ZM]=HM($M),f9=n=>{const{__scopePopper:t,children:r}=n,[l,u]=k.useState(null);return k.createElement(d9,{scope:t,anchor:l,onAnchorChange:u},r)},p9="PopperAnchor",m9=k.forwardRef((n,t)=>{const{__scopePopper:r,virtualRef:l,...u}=n,d=ZM(p9,r),p=k.useRef(null),b=_p(t,p);return k.useEffect(()=>{d.onAnchorChange((l==null?void 0:l.current)||p.current)}),l?null:k.createElement(jd.div,Gr({},u,{ref:b}))}),XM="PopperContent",[g9,_9]=HM(XM),y9=k.forwardRef((n,t)=>{var r,l,u,d,p,b,i,E;const{__scopePopper:T,side:A="bottom",sideOffset:I=0,align:O="center",alignOffset:z=0,arrowPadding:U=0,avoidCollisions:N=!0,collisionBoundary:V=[],collisionPadding:X=0,sticky:J="partial",hideWhenDetached:te=!1,updatePositionStrategy:ue="optimized",onPlaced:ae,...be}=n,Ce=ZM(XM,T),[je,me]=k.useState(null),Ne=_p(t,Ji=>me(Ji)),[ht,_t]=k.useState(null),Bt=h9(ht),Kt=(r=Bt==null?void 0:Bt.width)!==null&&r!==void 0?r:0,Gt=(l=Bt==null?void 0:Bt.height)!==null&&l!==void 0?l:0,hn=A+(O!=="center"?"-"+O:""),wt=typeof X=="number"?X:{top:0,right:0,bottom:0,left:0,...X},bt=Array.isArray(V)?V:[V],$t=bt.length>0,Zt={padding:wt,boundary:bt.filter(w9),altBoundary:$t},{refs:mn,floatingStyles:yn,placement:On,isPositioned:rr,middlewareData:Yn}=LO({strategy:"fixed",placement:hn,whileElementsMounted:(...Ji)=>EO(...Ji,{animationFrame:ue==="always"}),elements:{reference:Ce.anchor},middleware:[tO({mainAxis:I+Gt,alignmentAxis:z}),N&&CO({mainAxis:!0,crossAxis:!1,limiter:J==="partial"?MO():void 0,...Zt}),N&&AO({...Zt}),TO({...Zt,apply:({elements:Ji,rects:wn,availableWidth:ki,availableHeight:Bs})=>{const{width:Do,height:Tr}=wn.reference,xo=Ji.floating.style;xo.setProperty("--radix-popper-available-width",`${ki}px`),xo.setProperty("--radix-popper-available-height",`${Bs}px`),xo.setProperty("--radix-popper-anchor-width",`${Do}px`),xo.setProperty("--radix-popper-anchor-height",`${Tr}px`)}}),ht&&PO({element:ht,padding:U}),E9({arrowWidth:Kt,arrowHeight:Gt}),te&&SO({strategy:"referenceHidden",...Zt})]}),[Vr,Jr]=qM(On),kr=vp(ae);op(()=>{rr&&(kr==null||kr())},[rr,kr]);const Ln=(u=Yn.arrow)===null||u===void 0?void 0:u.x,li=(d=Yn.arrow)===null||d===void 0?void 0:d.y,kn=((p=Yn.arrow)===null||p===void 0?void 0:p.centerOffset)!==0,[Br,ci]=k.useState();return op(()=>{je&&ci(window.getComputedStyle(je).zIndex)},[je]),k.createElement("div",{ref:mn.setFloating,"data-radix-popper-content-wrapper":"",style:{...yn,transform:rr?yn.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Br,"--radix-popper-transform-origin":[(b=Yn.transformOrigin)===null||b===void 0?void 0:b.x,(i=Yn.transformOrigin)===null||i===void 0?void 0:i.y].join(" ")},dir:n.dir},k.createElement(g9,{scope:T,placedSide:Vr,onArrowChange:_t,arrowX:Ln,arrowY:li,shouldHideArrow:kn},k.createElement(jd.div,Gr({"data-side":Vr,"data-align":Jr},be,{ref:Ne,style:{...be.style,animation:rr?void 0:"none",opacity:(E=Yn.hide)!==null&&E!==void 0&&E.referenceHidden?0:void 0}}))))}),v9="PopperArrow",x9={top:"bottom",right:"left",bottom:"top",left:"right"},b9=k.forwardRef(function(t,r){const{__scopePopper:l,...u}=t,d=_9(v9,l),p=x9[d.placedSide];return k.createElement("span",{ref:d.onArrowChange,style:{position:"absolute",left:d.arrowX,top:d.arrowY,[p]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[d.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[d.placedSide],visibility:d.shouldHideArrow?"hidden":void 0}},k.createElement(u9,Gr({},u,{ref:r,style:{...u.style,display:"block"}})))});function w9(n){return n!==null}const E9=n=>({name:"transformOrigin",options:n,fn(t){var r,l,u,d,p;const{placement:b,rects:i,middlewareData:E}=t,A=((r=E.arrow)===null||r===void 0?void 0:r.centerOffset)!==0,I=A?0:n.arrowWidth,O=A?0:n.arrowHeight,[z,U]=qM(b),N={start:"0%",center:"50%",end:"100%"}[U],V=((l=(u=E.arrow)===null||u===void 0?void 0:u.x)!==null&&l!==void 0?l:0)+I/2,X=((d=(p=E.arrow)===null||p===void 0?void 0:p.y)!==null&&d!==void 0?d:0)+O/2;let J="",te="";return z==="bottom"?(J=A?N:`${V}px`,te=`${-O}px`):z==="top"?(J=A?N:`${V}px`,te=`${i.floating.height+O}px`):z==="right"?(J=`${-O}px`,te=A?N:`${X}px`):z==="left"&&(J=`${i.floating.width+O}px`,te=A?N:`${X}px`),{data:{x:J,y:te}}}});function qM(n){const[t,r="center"]=n.split("-");return[t,r]}const C9=f9,A9=m9,T9=y9,S9=b9;function M9(n,t){return k.useReducer((r,l)=>{const u=t[r][l];return u??r},n)}const KM=n=>{const{present:t,children:r}=n,l=I9(t),u=typeof r=="function"?r({present:l.isPresent}):k.Children.only(r),d=_p(l.ref,u.ref);return typeof r=="function"||l.isPresent?k.cloneElement(u,{ref:d}):null};KM.displayName="Presence";function I9(n){const[t,r]=k.useState(),l=k.useRef({}),u=k.useRef(n),d=k.useRef("none"),p=n?"mounted":"unmounted",[b,i]=M9(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return k.useEffect(()=>{const E=qg(l.current);d.current=b==="mounted"?E:"none"},[b]),op(()=>{const E=l.current,T=u.current;if(T!==n){const I=d.current,O=qg(E);n?i("MOUNT"):O==="none"||(E==null?void 0:E.display)==="none"?i("UNMOUNT"):i(T&&I!==O?"ANIMATION_OUT":"UNMOUNT"),u.current=n}},[n,i]),op(()=>{if(t){const E=A=>{const O=qg(l.current).includes(A.animationName);A.target===t&&O&&cp.flushSync(()=>i("ANIMATION_END"))},T=A=>{A.target===t&&(d.current=qg(l.current))};return t.addEventListener("animationstart",T),t.addEventListener("animationcancel",E),t.addEventListener("animationend",E),()=>{t.removeEventListener("animationstart",T),t.removeEventListener("animationcancel",E),t.removeEventListener("animationend",E)}}else i("ANIMATION_END")},[t,i]),{isPresent:["mounted","unmountSuspended"].includes(b),ref:k.useCallback(E=>{E&&(l.current=getComputedStyle(E)),r(E)},[])}}function qg(n){return(n==null?void 0:n.animationName)||"none"}function P9({prop:n,defaultProp:t,onChange:r=()=>{}}){const[l,u]=L9({defaultProp:t,onChange:r}),d=n!==void 0,p=d?n:l,b=vp(r),i=k.useCallback(E=>{if(d){const A=typeof E=="function"?E(n):E;A!==n&&b(A)}else u(E)},[d,n,u,b]);return[p,i]}function L9({defaultProp:n,onChange:t}){const r=k.useState(n),[l]=r,u=k.useRef(l),d=vp(t);return k.useEffect(()=>{u.current!==l&&(d(l),u.current=l)},[l,u,d]),r}const B9=k.forwardRef((n,t)=>k.createElement(jd.span,Gr({},n,{ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}))),R9=B9,[Y_,SH]=GM("Tooltip",[WM]),Q_=WM(),D9="TooltipProvider",qv="tooltip.open",[MH,tx]=Y_(D9),nx="Tooltip",[O9,ey]=Y_(nx),k9=n=>{const{__scopeTooltip:t,children:r,open:l,defaultOpen:u=!1,onOpenChange:d,disableHoverableContent:p,delayDuration:b}=n,i=tx(nx,n.__scopeTooltip),E=Q_(t),[T,A]=k.useState(null),I=l9(),O=k.useRef(0),z=p??i.disableHoverableContent,U=b??i.delayDuration,N=k.useRef(!1),[V=!1,X]=P9({prop:l,defaultProp:u,onChange:be=>{be?(i.onOpen(),document.dispatchEvent(new CustomEvent(qv))):i.onClose(),d==null||d(be)}}),J=k.useMemo(()=>V?N.current?"delayed-open":"instant-open":"closed",[V]),te=k.useCallback(()=>{window.clearTimeout(O.current),N.current=!1,X(!0)},[X]),ue=k.useCallback(()=>{window.clearTimeout(O.current),X(!1)},[X]),ae=k.useCallback(()=>{window.clearTimeout(O.current),O.current=window.setTimeout(()=>{N.current=!0,X(!0)},U)},[U,X]);return k.useEffect(()=>()=>window.clearTimeout(O.current),[]),k.createElement(C9,E,k.createElement(O9,{scope:t,contentId:I,open:V,stateAttribute:J,trigger:T,onTriggerChange:A,onTriggerEnter:k.useCallback(()=>{i.isOpenDelayed?ae():te()},[i.isOpenDelayed,ae,te]),onTriggerLeave:k.useCallback(()=>{z?ue():window.clearTimeout(O.current)},[ue,z]),onOpen:te,onClose:ue,disableHoverableContent:z},r))},IC="TooltipTrigger",z9=k.forwardRef((n,t)=>{const{__scopeTooltip:r,...l}=n,u=ey(IC,r),d=tx(IC,r),p=Q_(r),b=k.useRef(null),i=_p(t,b,u.onTriggerChange),E=k.useRef(!1),T=k.useRef(!1),A=k.useCallback(()=>E.current=!1,[]);return k.useEffect(()=>()=>document.removeEventListener("pointerup",A),[A]),k.createElement(A9,Gr({asChild:!0},p),k.createElement(jd.button,Gr({"aria-describedby":u.open?u.contentId:void 0,"data-state":u.stateAttribute},l,{ref:i,onPointerMove:rh(n.onPointerMove,I=>{I.pointerType!=="touch"&&!T.current&&!d.isPointerInTransitRef.current&&(u.onTriggerEnter(),T.current=!0)}),onPointerLeave:rh(n.onPointerLeave,()=>{u.onTriggerLeave(),T.current=!1}),onPointerDown:rh(n.onPointerDown,()=>{E.current=!0,document.addEventListener("pointerup",A,{once:!0})}),onFocus:rh(n.onFocus,()=>{E.current||u.onOpen()}),onBlur:rh(n.onBlur,u.onClose),onClick:rh(n.onClick,u.onClose)})))}),F9="TooltipPortal",[IH,j9]=Y_(F9,{forceMount:void 0}),Dm="TooltipContent",U9=k.forwardRef((n,t)=>{const r=j9(Dm,n.__scopeTooltip),{forceMount:l=r.forceMount,side:u="top",...d}=n,p=ey(Dm,n.__scopeTooltip);return k.createElement(KM,{present:l||p.open},p.disableHoverableContent?k.createElement(JM,Gr({side:u},d,{ref:t})):k.createElement(N9,Gr({side:u},d,{ref:t})))}),N9=k.forwardRef((n,t)=>{const r=ey(Dm,n.__scopeTooltip),l=tx(Dm,n.__scopeTooltip),u=k.useRef(null),d=_p(t,u),[p,b]=k.useState(null),{trigger:i,onClose:E}=r,T=u.current,{onPointerInTransitChange:A}=l,I=k.useCallback(()=>{b(null),A(!1)},[A]),O=k.useCallback((z,U)=>{const N=z.currentTarget,V={x:z.clientX,y:z.clientY},X=W9(V,N.getBoundingClientRect()),J=Z9(V,X),te=X9(U.getBoundingClientRect()),ue=K9([...J,...te]);b(ue),A(!0)},[A]);return k.useEffect(()=>()=>I(),[I]),k.useEffect(()=>{if(i&&T){const z=N=>O(N,T),U=N=>O(N,i);return i.addEventListener("pointerleave",z),T.addEventListener("pointerleave",U),()=>{i.removeEventListener("pointerleave",z),T.removeEventListener("pointerleave",U)}}},[i,T,O,I]),k.useEffect(()=>{if(p){const z=U=>{const N=U.target,V={x:U.clientX,y:U.clientY},X=(i==null?void 0:i.contains(N))||(T==null?void 0:T.contains(N)),J=!q9(V,p);X?I():J&&(I(),E())};return document.addEventListener("pointermove",z),()=>document.removeEventListener("pointermove",z)}},[i,T,p,E,I]),k.createElement(JM,Gr({},n,{ref:d}))}),[G9,V9]=Y_(nx,{isInside:!1}),JM=k.forwardRef((n,t)=>{const{__scopeTooltip:r,children:l,"aria-label":u,onEscapeKeyDown:d,onPointerDownOutside:p,...b}=n,i=ey(Dm,r),E=Q_(r),{onClose:T}=i;return k.useEffect(()=>(document.addEventListener(qv,T),()=>document.removeEventListener(qv,T)),[T]),k.useEffect(()=>{if(i.trigger){const A=I=>{const O=I.target;O!=null&&O.contains(i.trigger)&&T()};return window.addEventListener("scroll",A,{capture:!0}),()=>window.removeEventListener("scroll",A,{capture:!0})}},[i.trigger,T]),k.createElement(r9,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:A=>A.preventDefault(),onDismiss:T},k.createElement(T9,Gr({"data-state":i.stateAttribute},E,b,{ref:t,style:{...b.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}}),k.createElement(MM,null,l),k.createElement(G9,{scope:r,isInside:!0},k.createElement(R9,{id:i.contentId,role:"tooltip"},u||l))))}),$9="TooltipArrow",H9=k.forwardRef((n,t)=>{const{__scopeTooltip:r,...l}=n,u=Q_(r);return V9($9,r).isInside?null:k.createElement(S9,Gr({},u,l,{ref:t}))});function W9(n,t){const r=Math.abs(t.top-n.y),l=Math.abs(t.bottom-n.y),u=Math.abs(t.right-n.x),d=Math.abs(t.left-n.x);switch(Math.min(r,l,u,d)){case d:return"left";case u:return"right";case r:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function Z9(n,t,r=5){const l=[];switch(t){case"top":l.push({x:n.x-r,y:n.y+r},{x:n.x+r,y:n.y+r});break;case"bottom":l.push({x:n.x-r,y:n.y-r},{x:n.x+r,y:n.y-r});break;case"left":l.push({x:n.x+r,y:n.y-r},{x:n.x+r,y:n.y+r});break;case"right":l.push({x:n.x-r,y:n.y-r},{x:n.x-r,y:n.y+r});break}return l}function X9(n){const{top:t,right:r,bottom:l,left:u}=n;return[{x:u,y:t},{x:r,y:t},{x:r,y:l},{x:u,y:l}]}function q9(n,t){const{x:r,y:l}=n;let u=!1;for(let d=0,p=t.length-1;d<t.length;p=d++){const b=t[d].x,i=t[d].y,E=t[p].x,T=t[p].y;i>l!=T>l&&r<(E-b)*(l-i)/(T-i)+b&&(u=!u)}return u}function K9(n){const t=n.slice();return t.sort((r,l)=>r.x<l.x?-1:r.x>l.x?1:r.y<l.y?-1:r.y>l.y?1:0),J9(t)}function J9(n){if(n.length<=1)return n.slice();const t=[];for(let l=0;l<n.length;l++){const u=n[l];for(;t.length>=2;){const d=t[t.length-1],p=t[t.length-2];if((d.x-p.x)*(u.y-p.y)>=(d.y-p.y)*(u.x-p.x))t.pop();else break}t.push(u)}t.pop();const r=[];for(let l=n.length-1;l>=0;l--){const u=n[l];for(;r.length>=2;){const d=r[r.length-1],p=r[r.length-2];if((d.x-p.x)*(u.y-p.y)>=(d.y-p.y)*(u.x-p.x))r.pop();else break}r.push(u)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}const Y9=k9,Q9=z9,e6=U9,t6=H9;function n6(n,t){if(n==null)return{};var r={},l=Object.keys(n),u,d;for(d=0;d<l.length;d++)u=l[d],!(t.indexOf(u)>=0)&&(r[u]=n[u]);return r}function Li(n,t){if(n==null)return{};var r=n6(n,t),l,u;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(u=0;u<d.length;u++)l=d[u],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(n,l)&&(r[l]=n[l])}return r}let yo;(function(n){n[n.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",n[n.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",n[n.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",n[n.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",n[n.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",n[n.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",n[n.THEME_ERROR=6]="THEME_ERROR",n[n.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",n[n.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",n[n.EMPTY_KEY=9]="EMPTY_KEY"})(yo||(yo={}));const r6={[yo.UNSUPPORTED_INPUT]:(n,t)=>[`An input with type \`${n}\` input was found at path \`${t}\` but it's not supported yet.`],[yo.NO_COMPONENT_FOR_TYPE]:(n,t)=>[`Type \`${n}\` found at path \`${t}\` can't be displayed in panel because no component supports it yet.`],[yo.UNKNOWN_INPUT]:(n,t)=>[`input at path \`${n}\` is not recognized.`,t],[yo.DUPLICATE_KEYS]:(n,t,r)=>[`Key \`${n}\` of path \`${t}\` already exists at path \`${r}\`. Even nested keys need to be unique. Rename one of the keys.`],[yo.ALREADY_REGISTERED_TYPE]:n=>[`Type ${n} has already been registered. You can't register a component with the same type.`],[yo.CLIPBOARD_ERROR]:n=>["Error copying the value",n],[yo.THEME_ERROR]:(n,t)=>[`Error accessing the theme \`${n}.${t}\` value.`],[yo.PATH_DOESNT_EXIST]:n=>[`Error getting the value at path \`${n}\`. There is probably an error in your \`render\` function.`],[yo.PATH_DOESNT_EXIST]:n=>[`Error accessing the value at path \`${n}\``],[yo.INPUT_TYPE_OVERRIDE]:(n,t,r)=>[`Input at path \`${n}\` already exists with type: \`${t}\`. Its type cannot be overridden with type \`${r}\`.`],[yo.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function YM(n,t,...r){const[l,...u]=r6[t](...r);console[n]("LEVA: "+l,...u)}const ih=YM.bind(null,"warn"),i6=YM.bind(null,"log"),o6=["value"],s6=["schema"],a6=["value"],QM=[],kd={};function PC(n){let{value:t}=n,r=Li(n,o6);for(let l of QM){const u=l(t,r);if(u)return u}}function ph(n,t){let{schema:r}=t,l=Li(t,s6);if(n in kd){ih(yo.ALREADY_REGISTERED_TYPE,n);return}QM.push((u,d)=>r(u,d)&&n),kd[n]=l}function J0(n,t,r,l){const{normalize:u}=kd[n];if(u)return u(t,r,l);if(typeof t!="object"||!("value"in t))return{value:t};const{value:d}=t,p=Li(t,a6);return{value:d,settings:p}}function l6(n,t,r,l,u,d){const{sanitize:p}=kd[n];return p?p(t,r,l,u,d):t}function LC(n,t,r){const{format:l}=kd[n];return l?l(t,r):t}function c6(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function BC(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable})),r.push.apply(r,l)}return r}function tr(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BC(Object(r),!0).forEach(function(l){c6(n,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):BC(Object(r)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(r,l))})}return n}const Zh=(n,t,r)=>n>r?r:n<t?t:n,u6=n=>{if(n===""||typeof n=="number")return n;try{const t=Uh(n);if(!isNaN(t))return t}catch{}return parseFloat(n)},h6=Math.log(10);function RC(n){let t=Math.abs(+String(n).replace(".",""));if(t===0)return .01;for(;t!==0&&t%10===0;)t/=10;const r=Math.floor(Math.log(t)/h6)+1,l=Math.floor(Math.log10(Math.abs(n))),u=Math.pow(10,l-r);return Math.max(u,.001)}const E_=(n,t,r)=>r===t?0:(Zh(n,t,r)-t)/(r-t),C_=(n,t,r)=>n*(r-t)+t,d6=()=>"_"+Math.random().toString(36).substr(2,9),DC=/\(([0-9+\-*/^ .]+)\)/,OC=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,kC=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,zC=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,FC=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,jC=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function Uh(n){if(isNaN(Number(n)))if(DC.test(n)){const t=n.replace(DC,(r,l)=>String(Uh(l)));return Uh(t)}else if(OC.test(n)){const t=n.replace(OC,(r,l,u)=>String(Math.pow(Number(l),Number(u))));return Uh(t)}else if(kC.test(n)){const t=n.replace(kC,(r,l,u)=>String(Number(l)*Number(u)));return Uh(t)}else if(zC.test(n)){const t=n.replace(zC,(r,l,u)=>{if(u!=0)return String(Number(l)/Number(u));throw new Error("Division by zero")});return Uh(t)}else if(FC.test(n)){const t=n.replace(FC,(r,l,u)=>String(Number(l)+Number(u)));return Uh(t)}else if(jC.test(n)){const t=n.replace(jC,(r,l,u)=>String(Number(l)-Number(u)));return Uh(t)}else return Number(n);return Number(n)}function f6(n,t){return t.reduce((r,l)=>(n&&n.hasOwnProperty(l)&&(r[l]=n[l]),r),{})}function p6(n,t){const r=tr({},n);return t.forEach(l=>l in n&&delete r[l]),r}function m6(n,t){return n.reduce((r,l,u)=>Object.assign(r,{[t[u]]:l}),{})}function eI(n){return Object.prototype.toString.call(n)==="[object Object]"}const g6=n=>eI(n)&&Object.keys(n).length===0;let Fc;(function(n){n.BUTTON="BUTTON",n.BUTTON_GROUP="BUTTON_GROUP",n.MONITOR="MONITOR",n.FOLDER="FOLDER"})(Fc||(Fc={}));let jc;(function(n){n.SELECT="SELECT",n.IMAGE="IMAGE",n.NUMBER="NUMBER",n.COLOR="COLOR",n.STRING="STRING",n.BOOLEAN="BOOLEAN",n.INTERVAL="INTERVAL",n.VECTOR3D="VECTOR3D",n.VECTOR2D="VECTOR2D"})(jc||(jc={}));const _6=["type","__customInput"],y6=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],v6=["type"];function tI(n,t,r={},l){var u,d;if(typeof n!="object"||Array.isArray(n))return{type:l,input:n,options:tr({key:t,label:t,optional:!1,disabled:!1,order:0},r)};if("__customInput"in n){const{type:ue,__customInput:ae}=n,be=Li(n,_6);return tI(ae,t,be,ue)}const{render:p,label:b,optional:i,order:E=0,disabled:T,hint:A,onChange:I,onEditStart:O,onEditEnd:z,transient:U}=n,N=Li(n,y6),V=tr({render:p,key:t,label:b??t,hint:A,transient:U??!!I,onEditStart:O,onEditEnd:z,disabled:T,optional:i,order:E},r);let{type:X}=N,J=Li(N,v6);if(X=l??X,X in Fc)return{type:X,input:J,options:V};let te;return l&&eI(J)&&"value"in J?te=J.value:te=g6(J)?void 0:J,{type:X,input:te,options:tr(tr({},V),{},{onChange:I,optional:(u=V.optional)!==null&&u!==void 0?u:!1,disabled:(d=V.disabled)!==null&&d!==void 0?d:!1})}}function x6(n,t,r,l){const u=tI(n,t),{type:d,input:p,options:b}=u;if(d)return d in Fc?u:{type:d,input:J0(d,p,r,l),options:b};let i=PC(p);return i?{type:i,input:J0(i,p,r,l),options:b}:(i=PC({value:p}),i?{type:i,input:J0(i,{value:p},r,l),options:b}:!1)}function UC(n,t,r,l,u){const{value:d,type:p,settings:b}=n;n.value=nI({type:p,value:d,settings:b},t,r,l),n.fromPanel=u}const b6=function(t,r,l){this.type="LEVA_ERROR",this.message="LEVA: "+t,this.previousValue=r,this.error=l};function nI({type:n,value:t,settings:r},l,u,d){const p=n!=="SELECT"&&typeof l=="function"?l(t):l;let b;try{b=l6(n,p,r,t,u,d)}catch(i){throw new b6(`The value \`${l}\` did not result in a correct value.`,t,i)}return Bm(b,t)?t:b}const rI=(n,t,r=!1)=>{let l=0;return function(){const u=arguments,d=r&&!l,p=()=>n.apply(this,u);window.clearTimeout(l),l=window.setTimeout(p,t),d&&p()}},iI=n=>n.shiftKey?5:n.altKey?1/5:1;function w6(n,t){const r=console.error;console.error=()=>{},$T.render(n,t),console.error=r}const E6=["value"],C6=["min","max"],A6=n=>{if(typeof n=="number")return!0;if(typeof n=="string"){const t=parseFloat(n);return isNaN(t)?!1:n.substring((""+t).length).trim().length<4}return!1},oI=(n,{min:t=-1/0,max:r=1/0,suffix:l})=>{const u=parseFloat(n);if(n===""||isNaN(u))throw Error("Invalid number");const d=Zh(u,t,r);return l?d+l:d},T6=(n,{pad:t=0,suffix:r})=>{const l=parseFloat(n).toFixed(t);return r?l+r:l},sI=n=>{let{value:t}=n,r=Li(n,E6);const{min:l=-1/0,max:u=1/0}=r,d=Li(r,C6);let p=parseFloat(t);const b=typeof t=="string"?t.substring((""+p).length):void 0;p=Zh(p,l,u);let i=r.step;i||(Number.isFinite(l)?Number.isFinite(u)?i=+(Math.abs(u-l)/100).toPrecision(1):i=+(Math.abs(p-l)/100).toPrecision(1):Number.isFinite(u)&&(i=+(Math.abs(u-p)/100).toPrecision(1)));const E=i?RC(i)*10:RC(p);i=i||E/10;const T=Math.round(Zh(Math.log10(1/E),0,2));return{value:b?p+b:p,settings:tr({initialValue:p,step:i,pad:T,min:l,max:u,suffix:b},d)}},aI=(n,{step:t,initialValue:r})=>{const l=Math.round((n-r)/t);return r+l*t};var lI=Object.freeze({__proto__:null,schema:A6,sanitize:oI,format:T6,normalize:sI,sanitizeStep:aI});function Bo(){return Bo=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(n[l]=r[l])}return n},Bo.apply(this,arguments)}const cI=k.createContext({});function ga(){return k.useContext(cI)}const rx=k.createContext(null),uI=k.createContext(null),hI=k.createContext(null);function $m(){return k.useContext(uI)}function S6(){return k.useContext(hI)}const dI=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function Kg(n,t){const[r,l]=n.split(" "),u={};return r!=="none"&&(u.boxShadow=`${t.inset?"inset ":""}0 0 0 $borderWidths${[t.key]} $colors${r!=="default"&&r||t.borderColor}`),l&&(u.backgroundColor=l),u}const dm={$inputStyle:()=>n=>Kg(n,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>n=>Kg(n,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>n=>Kg(n,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>n=>Kg(n,{key:"$active",borderColor:"$accent1",inset:!0})},{styled:Vn,css:PH,createTheme:M6,globalCss:I6,keyframes:LH}=DM({prefix:"leva",theme:dI(),utils:tr(tr({},dm),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:n=>({"&:focus":dm.$focusStyle()(n)}),$focusWithin:n=>({"&:focus-within":dm.$focusStyle()(n)}),$hover:n=>({"&:hover":dm.$hoverStyle()(n)}),$active:n=>({"&:active":dm.$activeStyle()(n)})})}),P6=I6({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function L6(n){const t=dI();if(!n)return{theme:t,className:""};Object.keys(n).forEach(l=>{Object.assign(t[l],n[l])});const r=M6(t);return{theme:t,className:r.className}}function sh(n,t){const{theme:r}=k.useContext(rx);if(!(n in r)||!(t in r[n]))return ih(yo.THEME_ERROR,n,t),"";let l=t;for(;;){let u=r[n][l];if(typeof u=="string"&&u.charAt(0)==="$")l=u.substr(1);else return u}}const fI=Vn("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),pI=Vn("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${fI}`]:{paddingLeft:0}}),B6=Vn(pI,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),R6=Vn("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),D6=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],O6=["onUpdate"];function ix(n){let{innerLabel:t,value:r,onUpdate:l,onChange:u,onKeyDown:d,type:p,id:b,inputType:i="text",rows:E=0}=n,T=Li(n,D6);const{id:A,emitOnEditStart:I,emitOnEditEnd:O,disabled:z}=ga(),U=b||A,N=k.useRef(null),V=E>0,X=V?"textarea":"input",J=k.useCallback(ae=>be=>{const Ce=be.currentTarget.value;ae(Ce)},[]);Pe.useEffect(()=>{const ae=N.current,be=J(Ce=>{l(Ce),O()});return ae==null||ae.addEventListener("blur",be),()=>ae==null?void 0:ae.removeEventListener("blur",be)},[J,l,O]);const te=k.useCallback(ae=>{ae.key==="Enter"&&J(l)(ae)},[J,l]),ue=Object.assign({as:X},V?{rows:E}:{},T);return Pe.createElement(R6,{textArea:V},t&&typeof t=="string"?Pe.createElement(pI,null,t):t,Pe.createElement(fI,Bo({levaType:p,ref:N,id:U,type:i,autoComplete:"off",spellCheck:"false",value:r,onChange:J(u),onFocus:()=>I(),onKeyPress:te,onKeyDown:d,disabled:z},ue)))}function k6(n){let{onUpdate:t}=n,r=Li(n,O6);const l=k.useCallback(d=>t(u6(d)),[t]),u=k.useCallback(d=>{const p=d.key==="ArrowUp"?1:d.key==="ArrowDown"?-1:0;if(p){d.preventDefault();const b=d.altKey?.1:d.shiftKey?10:1;t(i=>parseFloat(i)+p*b)}},[t]);return Pe.createElement(ix,Bo({},r,{onUpdate:l,onKeyDown:u,type:"number"}))}const A_=Vn("div",{}),Kv=Vn("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),z6=Vn("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${Kv}::after`]:{opacity:.6},[`${A_}:hover > & + ${Kv}::after`]:{opacity:.6},[`${A_}:hover > & > svg`]:{opacity:1}}),mI=Vn("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${A_}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),gI=Vn("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${mI} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),_I=Vn(gI,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),F6=Vn("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),j6=Vn("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),Jv=Vn("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),U6=Vn("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${Jv}`]:{pointerEvents:"auto"}}}}}),yI=Vn("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),N6=Vn("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),G6=Vn(t6,{fill:"$toolTipBackground"});function ox({children:n}){const{className:t}=k.useContext(rx);return Pe.createElement(Tz,{className:t},n)}const V6=["align"];function $6(){const{id:n,disable:t,disabled:r}=ga();return Pe.createElement(Pe.Fragment,null,Pe.createElement(j6,{id:n+"__disable",type:"checkbox",checked:!r,onChange:()=>t(!r)}),Pe.createElement("label",{htmlFor:n+"__disable"}))}function H6(n){const{id:t,optional:r,hint:l}=ga(),u=n.htmlFor||(t?{htmlFor:t}:null),d=!l&&typeof n.children=="string"?{title:n.children}:null;return Pe.createElement(Pe.Fragment,null,r&&Pe.createElement($6,null),l!==void 0?Pe.createElement(Y9,null,Pe.createElement(Q9,{asChild:!0},Pe.createElement(Jv,Bo({},u,n))),Pe.createElement(e6,{side:"top",sideOffset:2},Pe.createElement(N6,null,l,Pe.createElement(G6,null)))):Pe.createElement(Jv,Bo({},u,d,n)))}function Uc(n){let{align:t}=n,r=Li(n,V6);const{value:l,label:u,key:d,disabled:p}=ga(),{hideCopyButton:b}=S6(),i=!b&&d!==void 0,[E,T]=k.useState(!1),A=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[d]:l??""})),T(!0)}catch{ih(yo.CLIPBOARD_ERROR,{[d]:l})}};return Pe.createElement(F6,{align:t,onPointerLeave:()=>T(!1)},Pe.createElement(H6,r),i&&!p&&Pe.createElement("div",{title:`Click to copy ${typeof u=="string"?u:d} value`},E?Pe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},Pe.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),Pe.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):Pe.createElement("svg",{onClick:A,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},Pe.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),Pe.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const W6=["toggled"],Z6=Vn("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function sx(n){let{toggled:t}=n,r=Li(n,W6);return Pe.createElement(Z6,Bo({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${t?0:-90}deg)`}},r),Pe.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const X6=["input"];function gc(n){let{input:t}=n,r=Li(n,X6);return t?Pe.createElement(_I,r):Pe.createElement(gI,r)}function vI({value:n,type:t,settings:r,setValue:l}){const[u,d]=k.useState(LC(t,n,r)),p=k.useRef(n),b=k.useRef(r);b.current=r;const i=k.useCallback(T=>d(LC(t,T,b.current)),[t]),E=k.useCallback(T=>{try{l(T)}catch(A){const{type:I,previousValue:O}=A;if(I!=="LEVA_ERROR")throw A;i(O)}},[i,l]);return k.useEffect(()=>{Bm(n,p.current)||i(n),p.current=n},[n,i]),{displayValue:u,onChange:d,onUpdate:E}}function Hm(n,t){const{emitOnEditStart:r,emitOnEditEnd:l}=ga();return JF(u=>{u.first&&(document.body.classList.add("leva__panel__dragged"),r==null||r());const d=n(u);return u.last&&(document.body.classList.remove("leva__panel__dragged"),l==null||l()),d},t)}function q6(n){const t=k.useRef(null),r=k.useRef(null),l=k.useRef(!1);return k.useEffect(()=>{const u=rI(()=>{t.current.width=t.current.offsetWidth*window.devicePixelRatio,t.current.height=t.current.offsetHeight*window.devicePixelRatio,n(t.current,r.current)},250);return window.addEventListener("resize",u),l.current||(u(),l.current=!0),()=>window.removeEventListener("resize",u)},[n]),k.useEffect(()=>{r.current=t.current.getContext("2d")},[]),[t,r]}function xI(){const n=k.useRef(null),t=k.useRef({x:0,y:0}),r=k.useCallback(l=>{Object.assign(t.current,l),n.current&&(n.current.style.transform=`translate3d(${t.current.x}px, ${t.current.y}px, 0)`)},[]);return[n,r]}const K6=["__refCount"],Y0=(n,t)=>{if(!n[t])return null;const r=n[t];return Li(r,K6)};function J6(n){const t=$m(),[r,l]=k.useState(Y0(t.getData(),n)),u=k.useCallback(E=>t.setValueAtPath(n,E,!0),[n,t]),d=k.useCallback(E=>t.setSettingsAtPath(n,E),[n,t]),p=k.useCallback(E=>t.disableInputAtPath(n,E),[n,t]),b=k.useCallback(()=>t.emitOnEditStart(n),[n,t]),i=k.useCallback(()=>t.emitOnEditEnd(n),[n,t]);return k.useEffect(()=>{l(Y0(t.getData(),n));const E=t.useStore.subscribe(T=>Y0(T.data,n),l,{equalityFn:X_});return()=>E()},[t,n]),[r,{set:u,setSettings:d,disable:p,storeId:t.storeId,emitOnEditStart:b,emitOnEditEnd:i}]}const Y6=Vn("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),bI=Vn("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),Yv=Vn("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),wI=Vn("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),EI=Vn("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function Q6({value:n,min:t,max:r,onDrag:l,step:u,initialValue:d}){const p=k.useRef(null),b=k.useRef(null),i=k.useRef(0),E=sh("sizes","scrubberWidth"),T=Hm(({event:I,first:O,xy:[z],movement:[U],memo:N})=>{if(O){const{width:X,left:J}=p.current.getBoundingClientRect();i.current=X-parseFloat(E),N=(I==null?void 0:I.target)===b.current?n:C_((z-J)/X,t,r)}const V=N+C_(U/i.current,0,r-t);return l(aI(V,{step:u,initialValue:d})),N}),A=E_(n,t,r);return Pe.createElement(wI,Bo({ref:p},T()),Pe.createElement(bI,null,Pe.createElement(EI,{style:{left:0,right:`${(1-A)*100}%`}})),Pe.createElement(Yv,{ref:b,style:{left:`calc(${A} * (100% - ${E}))`}}))}const e8=Pe.memo(({label:n,onUpdate:t,step:r,innerLabelTrim:l})=>{const[u,d]=k.useState(!1),p=Hm(({active:b,delta:[i],event:E,memo:T=0})=>(d(b),T+=i/2,Math.abs(T)>=1&&(t(A=>parseFloat(A)+Math.floor(T)*r*iI(E)),T=0),T));return Pe.createElement(B6,Bo({dragging:u,title:n.length>1?n:""},p()),n.slice(0,l))});function CI({label:n,id:t,displayValue:r,onUpdate:l,onChange:u,settings:d,innerLabelTrim:p=1}){const b=p>0&&Pe.createElement(e8,{label:n,step:d.step,onUpdate:l,innerLabelTrim:p});return Pe.createElement(k6,{id:t,value:String(r),onUpdate:l,onChange:u,innerLabel:b})}function t8(){const n=ga(),{label:t,value:r,onUpdate:l,settings:u,id:d}=n,{min:p,max:b}=u,i=b!==1/0&&p!==-1/0;return Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,t),Pe.createElement(Y6,{hasRange:i},i&&Pe.createElement(Q6,Bo({value:parseFloat(r),onDrag:l},u)),Pe.createElement(CI,Bo({},n,{id:d,label:"value",innerLabelTrim:i?0:1}))))}const{sanitizeStep:n8}=lI,r8=Li(lI,["sanitizeStep"]);var i8=tr({component:t8},r8);const o8=(n,t)=>yl().schema({options:yl().passesAnyOf(yl().object(),yl().array())}).test(t),s8=(n,{values:t})=>{if(t.indexOf(n)<0)throw Error("Selected value doesn't match Select options");return n},a8=(n,{values:t})=>t.indexOf(n),l8=n=>{let{value:t,options:r}=n,l,u;return Array.isArray(r)?(u=r,l=r.map(d=>String(d))):(u=Object.values(r),l=Object.keys(r)),"value"in n?u.includes(t)||(l.unshift(String(t)),u.unshift(t)):t=u[0],Object.values(r).includes(t)||(r[String(t)]=t),{value:t,settings:{keys:l,values:u}}};var c8=Object.freeze({__proto__:null,schema:o8,sanitize:s8,format:a8,normalize:l8});const u8=Vn("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),Qv=Vn("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),h8=Vn("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${Qv}:focus + &`]:{$focusStyle:""},[`${Qv}:hover + &`]:{$hoverStyle:""}});function d8({displayValue:n,value:t,onUpdate:r,id:l,settings:u,disabled:d}){const{keys:p,values:b}=u,i=k.useRef();return t===b[n]&&(i.current=p[n]),Pe.createElement(u8,null,Pe.createElement(Qv,{id:l,value:n,onChange:E=>r(b[Number(E.currentTarget.value)]),disabled:d},p.map((E,T)=>Pe.createElement("option",{key:E,value:T},E))),Pe.createElement(h8,null,i.current),Pe.createElement(sx,{toggled:!0}))}function f8(){const{label:n,value:t,displayValue:r,onUpdate:l,id:u,disabled:d,settings:p}=ga();return Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,n),Pe.createElement(d8,{id:u,value:t,displayValue:r,onUpdate:l,settings:p,disabled:d}))}var p8=tr({component:f8},c8);const m8=n=>yl().string().test(n),g8=n=>{if(typeof n!="string")throw Error("Invalid string");return n},_8=({value:n,editable:t=!0,rows:r=!1})=>({value:n,settings:{editable:t,rows:typeof r=="number"?r:r?5:0}});var y8=Object.freeze({__proto__:null,schema:m8,sanitize:g8,normalize:_8});const v8=["displayValue","onUpdate","onChange","editable"],x8=Vn("div",{whiteSpace:"pre-wrap"});function b8(n){let{displayValue:t,onUpdate:r,onChange:l,editable:u=!0}=n,d=Li(n,v8);return u?Pe.createElement(ix,Bo({value:t,onUpdate:r,onChange:l},d)):Pe.createElement(x8,null,t)}function w8(){const{label:n,settings:t,displayValue:r,onUpdate:l,onChange:u}=ga();return Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,n),Pe.createElement(b8,Bo({displayValue:r,onUpdate:l,onChange:u},t)))}var E8=tr({component:w8},y8);const C8=n=>yl().boolean().test(n),A8=n=>{if(typeof n!="boolean")throw Error("Invalid boolean");return n};var T8=Object.freeze({__proto__:null,schema:C8,sanitize:A8});const S8=Vn("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function M8({value:n,onUpdate:t,id:r,disabled:l}){return Pe.createElement(S8,null,Pe.createElement("input",{id:r,type:"checkbox",checked:n,onChange:u=>t(u.currentTarget.checked),disabled:l}),Pe.createElement("label",{htmlFor:r},Pe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Pe.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function I8(){const{label:n,value:t,onUpdate:r,disabled:l,id:u}=ga();return Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,n),Pe.createElement(M8,{value:t,onUpdate:r,id:u,disabled:l}))}var P8=tr({component:I8},T8);const L8=["locked"];function B8({value:n,id:t,valueKey:r,settings:l,onUpdate:u,innerLabelTrim:d}){const p=k.useRef(n[r]);p.current=n[r];const b=k.useCallback(E=>u({[r]:nI({type:"NUMBER",value:p.current,settings:l},E)}),[u,l,r]),i=vI({type:"NUMBER",value:n[r],settings:l,setValue:b});return Pe.createElement(CI,{id:t,label:r,value:n[r],displayValue:i.displayValue,onUpdate:i.onUpdate,onChange:i.onChange,settings:l,innerLabelTrim:d})}const R8=Vn("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function D8(n){let{locked:t}=n,r=Li(n,L8);return Pe.createElement("svg",Bo({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),t?Pe.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):Pe.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function ax({value:n,onUpdate:t,settings:r,innerLabelTrim:l}){const{id:u,setSettings:d}=ga(),{lock:p,locked:b}=r;return Pe.createElement(R8,{withLock:p},p&&Pe.createElement(D8,{locked:b,onClick:()=>d({locked:!b})}),Object.keys(n).map((i,E)=>Pe.createElement(B8,{id:E===0?u:`${u}.${i}`,key:i,valueKey:i,value:n,settings:r[i],onUpdate:t,innerLabelTrim:l})))}const AI=(n,t)=>{const r={};let l=0,u=1/0;Object.entries(n).forEach(([d,p])=>{r[d]=sI(tr({value:p},t[d])).settings,l=Math.max(l,r[d].step),u=Math.min(u,r[d].pad)});for(let d in r){const{step:p,min:b,max:i}=t[d]||{};!isFinite(p)&&(!isFinite(b)||!isFinite(i))&&(r[d].step=l,r[d].pad=u)}return r},O8=["lock"],k8=["value"];function z8(n){const t=yl().array().length(n).every.number(),r=l=>{if(!l||typeof l!="object")return!1;const u=Object.values(l);return u.length===n&&u.every(d=>isFinite(d))};return l=>t.test(l)||r(l)}function F8(n){return Array.isArray(n)?"array":"object"}function bm(n,t,r){return F8(n)===t?n:t==="array"?Object.values(n):m6(n,r)}const j8=(n,t,r)=>{const l=bm(n,"object",t.keys);for(let p in l)l[p]=oI(l[p],t[p]);const u=Object.keys(l);let d={};if(u.length===t.keys.length)d=l;else{const p=bm(r,"object",t.keys);if(u.length===1&&t.locked){const b=u[0],i=l[b],E=p[b],T=E!==0?i/E:1;for(let A in p)A===b?d[b]=i:d[A]=p[A]*T}else d=tr(tr({},p),l)}return bm(d,t.format,t.keys)},U8=(n,t)=>bm(n,"object",t.keys),N8=n=>!!n&&("step"in n||"min"in n||"max"in n);function G8(n,t,r=[]){const{lock:l=!1}=t,u=Li(t,O8),d=Array.isArray(n)?"array":"object",p=d==="object"?Object.keys(n):r,b=bm(n,"object",p),i=N8(u)?p.reduce((T,A)=>Object.assign(T,{[A]:u}),{}):u,E=AI(b,i);return{value:d==="array"?n:b,settings:tr(tr({},E),{},{format:d,keys:p,lock:l,locked:!1})}}function TI(n){return{schema:z8(n.length),normalize:t=>{let{value:r}=t,l=Li(t,k8);return G8(r,l,n)},format:(t,r)=>U8(t,r),sanitize:(t,r,l)=>j8(t,r,l)}}var V8={grad:.9,turn:360,rad:360/(2*Math.PI)},eh=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},Ls=function(n,t,r){return t===void 0&&(t=0),r===void 0&&(r=Math.pow(10,t)),Math.round(r*n)/r+0},lc=function(n,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),n>r?r:n>t?n:t},SI=function(n){return(n=isFinite(n)?n%360:0)>0?n:n+360},NC=function(n){return{r:lc(n.r,0,255),g:lc(n.g,0,255),b:lc(n.b,0,255),a:lc(n.a)}},Q0=function(n){return{r:Ls(n.r),g:Ls(n.g),b:Ls(n.b),a:Ls(n.a,3)}},$8=/^#([0-9a-f]{3,8})$/i,Jg=function(n){var t=n.toString(16);return t.length<2?"0"+t:t},MI=function(n){var t=n.r,r=n.g,l=n.b,u=n.a,d=Math.max(t,r,l),p=d-Math.min(t,r,l),b=p?d===t?(r-l)/p:d===r?2+(l-t)/p:4+(t-r)/p:0;return{h:60*(b<0?b+6:b),s:d?p/d*100:0,v:d/255*100,a:u}},II=function(n){var t=n.h,r=n.s,l=n.v,u=n.a;t=t/360*6,r/=100,l/=100;var d=Math.floor(t),p=l*(1-r),b=l*(1-(t-d)*r),i=l*(1-(1-t+d)*r),E=d%6;return{r:255*[l,b,p,p,i,l][E],g:255*[i,l,l,b,p,p][E],b:255*[p,p,i,l,l,b][E],a:u}},GC=function(n){return{h:SI(n.h),s:lc(n.s,0,100),l:lc(n.l,0,100),a:lc(n.a)}},VC=function(n){return{h:Ls(n.h),s:Ls(n.s),l:Ls(n.l),a:Ls(n.a,3)}},$C=function(n){return II((r=(t=n).s,{h:t.h,s:(r*=((l=t.l)<50?l:100-l)/100)>0?2*r/(l+r)*100:0,v:l+r,a:t.a}));var t,r,l},wm=function(n){return{h:(t=MI(n)).h,s:(u=(200-(r=t.s))*(l=t.v)/100)>0&&u<200?r*l/100/(u<=100?u:200-u)*100:0,l:u/2,a:t.a};var t,r,l,u},H8=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,W8=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Z8=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,X8=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,e1={string:[[function(n){var t=$8.exec(n);return t?(n=t[1]).length<=4?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?Ls(parseInt(n[3]+n[3],16)/255,2):1}:n.length===6||n.length===8?{r:parseInt(n.substr(0,2),16),g:parseInt(n.substr(2,2),16),b:parseInt(n.substr(4,2),16),a:n.length===8?Ls(parseInt(n.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(n){var t=Z8.exec(n)||X8.exec(n);return t?t[2]!==t[4]||t[4]!==t[6]?null:NC({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(n){var t=H8.exec(n)||W8.exec(n);if(!t)return null;var r,l,u=GC({h:(r=t[1],l=t[2],l===void 0&&(l="deg"),Number(r)*(V8[l]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return $C(u)},"hsl"]],object:[[function(n){var t=n.r,r=n.g,l=n.b,u=n.a,d=u===void 0?1:u;return eh(t)&&eh(r)&&eh(l)?NC({r:Number(t),g:Number(r),b:Number(l),a:Number(d)}):null},"rgb"],[function(n){var t=n.h,r=n.s,l=n.l,u=n.a,d=u===void 0?1:u;if(!eh(t)||!eh(r)||!eh(l))return null;var p=GC({h:Number(t),s:Number(r),l:Number(l),a:Number(d)});return $C(p)},"hsl"],[function(n){var t=n.h,r=n.s,l=n.v,u=n.a,d=u===void 0?1:u;if(!eh(t)||!eh(r)||!eh(l))return null;var p=function(b){return{h:SI(b.h),s:lc(b.s,0,100),v:lc(b.v,0,100),a:lc(b.a)}}({h:Number(t),s:Number(r),v:Number(l),a:Number(d)});return II(p)},"hsv"]]},HC=function(n,t){for(var r=0;r<t.length;r++){var l=t[r][0](n);if(l)return[l,t[r][1]]}return[null,void 0]},PI=function(n){return typeof n=="string"?HC(n.trim(),e1.string):typeof n=="object"&&n!==null?HC(n,e1.object):[null,void 0]},q8=function(n){return PI(n)[1]},ev=function(n,t){var r=wm(n);return{h:r.h,s:lc(r.s+100*t,0,100),l:r.l,a:r.a}},tv=function(n){return(299*n.r+587*n.g+114*n.b)/1e3/255},WC=function(n,t){var r=wm(n);return{h:r.h,s:r.s,l:lc(r.l+100*t,0,100),a:r.a}},t1=function(){function n(t){this.parsed=PI(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return n.prototype.isValid=function(){return this.parsed!==null},n.prototype.brightness=function(){return Ls(tv(this.rgba),2)},n.prototype.isDark=function(){return tv(this.rgba)<.5},n.prototype.isLight=function(){return tv(this.rgba)>=.5},n.prototype.toHex=function(){return t=Q0(this.rgba),r=t.r,l=t.g,u=t.b,p=(d=t.a)<1?Jg(Ls(255*d)):"","#"+Jg(r)+Jg(l)+Jg(u)+p;var t,r,l,u,d,p},n.prototype.toRgb=function(){return Q0(this.rgba)},n.prototype.toRgbString=function(){return t=Q0(this.rgba),r=t.r,l=t.g,u=t.b,(d=t.a)<1?"rgba("+r+", "+l+", "+u+", "+d+")":"rgb("+r+", "+l+", "+u+")";var t,r,l,u,d},n.prototype.toHsl=function(){return VC(wm(this.rgba))},n.prototype.toHslString=function(){return t=VC(wm(this.rgba)),r=t.h,l=t.s,u=t.l,(d=t.a)<1?"hsla("+r+", "+l+"%, "+u+"%, "+d+")":"hsl("+r+", "+l+"%, "+u+"%)";var t,r,l,u,d},n.prototype.toHsv=function(){return t=MI(this.rgba),{h:Ls(t.h),s:Ls(t.s),v:Ls(t.v),a:Ls(t.a,3)};var t},n.prototype.invert=function(){return La({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},n.prototype.saturate=function(t){return t===void 0&&(t=.1),La(ev(this.rgba,t))},n.prototype.desaturate=function(t){return t===void 0&&(t=.1),La(ev(this.rgba,-t))},n.prototype.grayscale=function(){return La(ev(this.rgba,-1))},n.prototype.lighten=function(t){return t===void 0&&(t=.1),La(WC(this.rgba,t))},n.prototype.darken=function(t){return t===void 0&&(t=.1),La(WC(this.rgba,-t))},n.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},n.prototype.alpha=function(t){return typeof t=="number"?La({r:(r=this.rgba).r,g:r.g,b:r.b,a:t}):Ls(this.rgba.a,3);var r},n.prototype.hue=function(t){var r=wm(this.rgba);return typeof t=="number"?La({h:t,s:r.s,l:r.l,a:r.a}):Ls(r.h)},n.prototype.isEqual=function(t){return this.toHex()===La(t).toHex()},n}(),La=function(n){return n instanceof t1?n:new t1(n)},ZC=[],K8=function(n){n.forEach(function(t){ZC.indexOf(t)<0&&(t(t1,e1),ZC.push(t))})};function J8(n,t){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},l={};for(var u in r)l[r[u]]=u;var d={};n.prototype.toName=function(p){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var b,i,E=l[this.toHex()];if(E)return E;if(p!=null&&p.closest){var T=this.toRgb(),A=1/0,I="black";if(!d.length)for(var O in r)d[O]=new n(r[O]).toRgb();for(var z in r){var U=(b=T,i=d[z],Math.pow(b.r-i.r,2)+Math.pow(b.g-i.g,2)+Math.pow(b.b-i.b,2));U<A&&(A=U,I=z)}return I}},t.string.push([function(p){var b=p.toLowerCase(),i=b==="transparent"?"#0000":r[b];return i?new n(i).toRgb():null},"name"])}function xp(){return(xp=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(n[l]=r[l])}return n}).apply(this,arguments)}function lx(n,t){if(n==null)return{};var r,l,u={},d=Object.keys(n);for(l=0;l<d.length;l++)t.indexOf(r=d[l])>=0||(u[r]=n[r]);return u}function n1(n){var t=k.useRef(n),r=k.useRef(function(l){t.current&&t.current(l)});return t.current=n,r.current}var sp=function(n,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),n>r?r:n<t?t:n},Em=function(n){return"touches"in n},r1=function(n){return n&&n.ownerDocument.defaultView||self},XC=function(n,t,r){var l=n.getBoundingClientRect(),u=Em(t)?function(d,p){for(var b=0;b<d.length;b++)if(d[b].identifier===p)return d[b];return d[0]}(t.touches,r):t;return{left:sp((u.pageX-(l.left+r1(n).pageXOffset))/l.width),top:sp((u.pageY-(l.top+r1(n).pageYOffset))/l.height)}},qC=function(n){!Em(n)&&n.preventDefault()},cx=Pe.memo(function(n){var t=n.onMove,r=n.onKey,l=lx(n,["onMove","onKey"]),u=k.useRef(null),d=n1(t),p=n1(r),b=k.useRef(null),i=k.useRef(!1),E=k.useMemo(function(){var O=function(N){qC(N),(Em(N)?N.touches.length>0:N.buttons>0)&&u.current?d(XC(u.current,N,b.current)):U(!1)},z=function(){return U(!1)};function U(N){var V=i.current,X=r1(u.current),J=N?X.addEventListener:X.removeEventListener;J(V?"touchmove":"mousemove",O),J(V?"touchend":"mouseup",z)}return[function(N){var V=N.nativeEvent,X=u.current;if(X&&(qC(V),!function(te,ue){return ue&&!Em(te)}(V,i.current)&&X)){if(Em(V)){i.current=!0;var J=V.changedTouches||[];J.length&&(b.current=J[0].identifier)}X.focus(),d(XC(X,V,b.current)),U(!0)}},function(N){var V=N.which||N.keyCode;V<37||V>40||(N.preventDefault(),p({left:V===39?.05:V===37?-.05:0,top:V===40?.05:V===38?-.05:0}))},U]},[p,d]),T=E[0],A=E[1],I=E[2];return k.useEffect(function(){return I},[I]),Pe.createElement("div",xp({},l,{onTouchStart:T,onMouseDown:T,className:"react-colorful__interactive",ref:u,onKeyDown:A,tabIndex:0,role:"slider"}))}),Wm=function(n){return n.filter(Boolean).join(" ")},ux=function(n){var t=n.color,r=n.left,l=n.top,u=l===void 0?.5:l,d=Wm(["react-colorful__pointer",n.className]);return Pe.createElement("div",{className:d,style:{top:100*u+"%",left:100*r+"%"}},Pe.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},Ra=function(n,t,r){return t===void 0&&(t=0),r===void 0&&(r=Math.pow(10,t)),Math.round(r*n)/r},LI=function(n){var t=n.s,r=n.v,l=n.a,u=(200-t)*r/100;return{h:Ra(n.h),s:Ra(u>0&&u<200?t*r/100/(u<=100?u:200-u)*100:0),l:Ra(u/2),a:Ra(l,2)}},i1=function(n){var t=LI(n);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},nv=function(n){var t=LI(n);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},BI=function(n){var t=n.h,r=n.s,l=n.v,u=n.a;t=t/360*6,r/=100,l/=100;var d=Math.floor(t),p=l*(1-r),b=l*(1-(t-d)*r),i=l*(1-(1-t+d)*r),E=d%6;return{r:Ra(255*[l,b,p,p,i,l][E]),g:Ra(255*[i,l,l,b,p,p][E]),b:Ra(255*[p,p,i,l,l,b][E]),a:Ra(u,2)}},RI=function(n){var t=n.r,r=n.g,l=n.b,u=n.a,d=Math.max(t,r,l),p=d-Math.min(t,r,l),b=p?d===t?(r-l)/p:d===r?2+(l-t)/p:4+(t-r)/p:0;return{h:Ra(60*(b<0?b+6:b)),s:Ra(d?p/d*100:0),v:Ra(d/255*100),a:u}},DI=Pe.memo(function(n){var t=n.hue,r=n.onChange,l=Wm(["react-colorful__hue",n.className]);return Pe.createElement("div",{className:l},Pe.createElement(cx,{onMove:function(u){r({h:360*u.left})},onKey:function(u){r({h:sp(t+360*u.left,0,360)})},"aria-label":"Hue","aria-valuenow":Ra(t),"aria-valuemax":"360","aria-valuemin":"0"},Pe.createElement(ux,{className:"react-colorful__hue-pointer",left:t/360,color:i1({h:t,s:100,v:100,a:1})})))}),OI=Pe.memo(function(n){var t=n.hsva,r=n.onChange,l={backgroundColor:i1({h:t.h,s:100,v:100,a:1})};return Pe.createElement("div",{className:"react-colorful__saturation",style:l},Pe.createElement(cx,{onMove:function(u){r({s:100*u.left,v:100-100*u.top})},onKey:function(u){r({s:sp(t.s+100*u.left,0,100),v:sp(t.v-100*u.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Ra(t.s)+"%, Brightness "+Ra(t.v)+"%"},Pe.createElement(ux,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:i1(t)})))}),hx=function(n,t){if(n===t)return!0;for(var r in n)if(n[r]!==t[r])return!1;return!0};function kI(n,t,r){var l=n1(r),u=k.useState(function(){return n.toHsva(t)}),d=u[0],p=u[1],b=k.useRef({color:t,hsva:d});k.useEffect(function(){if(!n.equal(t,b.current.color)){var E=n.toHsva(t);b.current={hsva:E,color:t},p(E)}},[t,n]),k.useEffect(function(){var E;hx(d,b.current.hsva)||n.equal(E=n.fromHsva(d),b.current.color)||(b.current={hsva:d,color:E},l(E))},[d,n,l]);var i=k.useCallback(function(E){p(function(T){return Object.assign({},T,E)})},[]);return[d,i]}var Y8=typeof window<"u"?k.useLayoutEffect:k.useEffect,Q8=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},KC=new Map,zI=function(n){Y8(function(){var t=n.current?n.current.ownerDocument:document;if(t!==void 0&&!KC.has(t)){var r=t.createElement("style");r.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,KC.set(t,r);var l=Q8();l&&r.setAttribute("nonce",l),t.head.appendChild(r)}},[])},ej=function(n){var t=n.className,r=n.colorModel,l=n.color,u=l===void 0?r.defaultColor:l,d=n.onChange,p=lx(n,["className","colorModel","color","onChange"]),b=k.useRef(null);zI(b);var i=kI(r,u,d),E=i[0],T=i[1],A=Wm(["react-colorful",t]);return Pe.createElement("div",xp({},p,{ref:b,className:A}),Pe.createElement(OI,{hsva:E,onChange:T}),Pe.createElement(DI,{hue:E.h,onChange:T,className:"react-colorful__last-control"}))},tj=function(n){var t=n.className,r=n.hsva,l=n.onChange,u={backgroundImage:"linear-gradient(90deg, "+nv(Object.assign({},r,{a:0}))+", "+nv(Object.assign({},r,{a:1}))+")"},d=Wm(["react-colorful__alpha",t]),p=Ra(100*r.a);return Pe.createElement("div",{className:d},Pe.createElement("div",{className:"react-colorful__alpha-gradient",style:u}),Pe.createElement(cx,{onMove:function(b){l({a:b.left})},onKey:function(b){l({a:sp(r.a+b.left)})},"aria-label":"Alpha","aria-valuetext":p+"%","aria-valuenow":p,"aria-valuemin":"0","aria-valuemax":"100"},Pe.createElement(ux,{className:"react-colorful__alpha-pointer",left:r.a,color:nv(r)})))},nj=function(n){var t=n.className,r=n.colorModel,l=n.color,u=l===void 0?r.defaultColor:l,d=n.onChange,p=lx(n,["className","colorModel","color","onChange"]),b=k.useRef(null);zI(b);var i=kI(r,u,d),E=i[0],T=i[1],A=Wm(["react-colorful",t]);return Pe.createElement("div",xp({},p,{ref:b,className:A}),Pe.createElement(OI,{hsva:E,onChange:T}),Pe.createElement(DI,{hue:E.h,onChange:T}),Pe.createElement(tj,{hsva:E,onChange:T,className:"react-colorful__last-control"}))},rj={defaultColor:{r:0,g:0,b:0,a:1},toHsva:RI,fromHsva:BI,equal:hx},ij=function(n){return Pe.createElement(nj,xp({},n,{colorModel:rj}))},oj={defaultColor:{r:0,g:0,b:0},toHsva:function(n){return RI({r:n.r,g:n.g,b:n.b,a:1})},fromHsva:function(n){return{r:(t=BI(n)).r,g:t.g,b:t.b};var t},equal:hx},sj=function(n){return Pe.createElement(ej,xp({},n,{colorModel:oj}))},aj=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function Zm(n,t){var r=lj(n);if(typeof r.path!="string"){var l=n.webkitRelativePath;Object.defineProperty(r,"path",{value:typeof t=="string"?t:typeof l=="string"&&l.length>0?l:n.name,writable:!1,configurable:!1,enumerable:!0})}return r}function lj(n){var t=n.name,r=t&&t.lastIndexOf(".")!==-1;if(r&&!n.type){var l=t.split(".").pop().toLowerCase(),u=aj.get(l);u&&Object.defineProperty(n,"type",{value:u,writable:!1,configurable:!1,enumerable:!0})}return n}var cj=[".DS_Store","Thumbs.db"];function uj(n){return fp(this,void 0,void 0,function(){return pp(this,function(t){return T_(n)&&hj(n)?[2,mj(n.dataTransfer,n.type)]:dj(n)?[2,fj(n)]:Array.isArray(n)&&n.every(function(r){return"getFile"in r&&typeof r.getFile=="function"})?[2,pj(n)]:[2,[]]})})}function hj(n){return T_(n.dataTransfer)}function dj(n){return T_(n)&&T_(n.target)}function T_(n){return typeof n=="object"&&n!==null}function fj(n){return o1(n.target.files).map(function(t){return Zm(t)})}function pj(n){return fp(this,void 0,void 0,function(){var t;return pp(this,function(r){switch(r.label){case 0:return[4,Promise.all(n.map(function(l){return l.getFile()}))];case 1:return t=r.sent(),[2,t.map(function(l){return Zm(l)})]}})})}function mj(n,t){return fp(this,void 0,void 0,function(){var r,l;return pp(this,function(u){switch(u.label){case 0:return n===null?[2,[]]:n.items?(r=o1(n.items).filter(function(d){return d.kind==="file"}),t!=="drop"?[2,r]:[4,Promise.all(r.map(gj))]):[3,2];case 1:return l=u.sent(),[2,JC(FI(l))];case 2:return[2,JC(o1(n.files).map(function(d){return Zm(d)}))]}})})}function JC(n){return n.filter(function(t){return cj.indexOf(t.name)===-1})}function o1(n){if(n===null)return[];for(var t=[],r=0;r<n.length;r++){var l=n[r];t.push(l)}return t}function gj(n){if(typeof n.webkitGetAsEntry!="function")return YC(n);var t=n.webkitGetAsEntry();return t&&t.isDirectory?jI(t):YC(n)}function FI(n){return n.reduce(function(t,r){return wR(t,Array.isArray(r)?FI(r):[r])},[])}function YC(n){var t=n.getAsFile();if(!t)return Promise.reject(n+" is not a File");var r=Zm(t);return Promise.resolve(r)}function _j(n){return fp(this,void 0,void 0,function(){return pp(this,function(t){return[2,n.isDirectory?jI(n):yj(n)]})})}function jI(n){var t=n.createReader();return new Promise(function(r,l){var u=[];function d(){var p=this;t.readEntries(function(b){return fp(p,void 0,void 0,function(){var i,E,T;return pp(this,function(A){switch(A.label){case 0:if(b.length)return[3,5];A.label=1;case 1:return A.trys.push([1,3,,4]),[4,Promise.all(u)];case 2:return i=A.sent(),r(i),[3,4];case 3:return E=A.sent(),l(E),[3,4];case 4:return[3,6];case 5:T=Promise.all(b.map(_j)),u.push(T),d(),A.label=6;case 6:return[2]}})})},function(b){l(b)})}d()})}function yj(n){return fp(this,void 0,void 0,function(){return pp(this,function(t){return[2,new Promise(function(r,l){n.file(function(u){var d=Zm(u,n.fullPath);r(d)},function(u){l(u)})})]})})}var vj=function(n,t){if(n&&t){var r=Array.isArray(t)?t:t.split(","),l=n.name||"",u=(n.type||"").toLowerCase(),d=u.replace(/\/.*$/,"");return r.some(function(p){var b=p.trim().toLowerCase();return b.charAt(0)==="."?l.toLowerCase().endsWith(b):b.endsWith("/*")?d===b.replace(/\/.*$/,""):u===b})}return!0};function QC(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable})),r.push.apply(r,l)}return r}function eA(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QC(Object(r),!0).forEach(function(l){UI(n,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):QC(Object(r)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(r,l))})}return n}function UI(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function tA(n,t){return Ej(n)||wj(n,t)||bj(n,t)||xj()}function xj(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bj(n,t){if(n){if(typeof n=="string")return nA(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nA(n,t)}}function nA(n,t){(t==null||t>n.length)&&(t=n.length);for(var r=0,l=new Array(t);r<t;r++)l[r]=n[r];return l}function wj(n,t){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var l=[],u=!0,d=!1,p,b;try{for(r=r.call(n);!(u=(p=r.next()).done)&&(l.push(p.value),!(t&&l.length===t));u=!0);}catch(i){d=!0,b=i}finally{try{!u&&r.return!=null&&r.return()}finally{if(d)throw b}}return l}}function Ej(n){if(Array.isArray(n))return n}var Cj="file-invalid-type",Aj="file-too-large",Tj="file-too-small",Sj="too-many-files",Mj=function(t){t=Array.isArray(t)&&t.length===1?t[0]:t;var r=Array.isArray(t)?"one of ".concat(t.join(", ")):t;return{code:Cj,message:"File type must be ".concat(r)}},rA=function(t){return{code:Aj,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},iA=function(t){return{code:Tj,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},Ij={code:Sj,message:"Too many files"};function NI(n,t){var r=n.type==="application/x-moz-file"||vj(n,t);return[r,r?null:Mj(t)]}function GI(n,t,r){if(fm(n.size))if(fm(t)&&fm(r)){if(n.size>r)return[!1,rA(r)];if(n.size<t)return[!1,iA(t)]}else{if(fm(t)&&n.size<t)return[!1,iA(t)];if(fm(r)&&n.size>r)return[!1,rA(r)]}return[!0,null]}function fm(n){return n!=null}function Pj(n){var t=n.files,r=n.accept,l=n.minSize,u=n.maxSize,d=n.multiple,p=n.maxFiles;return!d&&t.length>1||d&&p>=1&&t.length>p?!1:t.every(function(b){var i=NI(b,r),E=tA(i,1),T=E[0],A=GI(b,l,u),I=tA(A,1),O=I[0];return T&&O})}function S_(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function Yg(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!n.target&&!!n.target.files}function oA(n){n.preventDefault()}function Lj(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function Bj(n){return n.indexOf("Edge/")!==-1}function Rj(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Lj(n)||Bj(n)}function xu(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return function(l){for(var u=arguments.length,d=new Array(u>1?u-1:0),p=1;p<u;p++)d[p-1]=arguments[p];return t.some(function(b){return!S_(l)&&b&&b.apply(void 0,[l].concat(d)),S_(l)})}}function Dj(){return"showOpenFilePicker"in window}function Oj(n){return n=typeof n=="string"?n.split(","):n,[{description:"everything",accept:Array.isArray(n)?n.filter(function(t){return t==="audio/*"||t==="video/*"||t==="image/*"||t==="text/*"||/\w+\/[-+.\w]+/g.test(t)}).reduce(function(t,r){return eA(eA({},t),{},UI({},r,[]))},{}):{}}]}function kj(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function zj(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}var Fj=["children"],jj=["open"],Uj=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Nj=["refKey","onChange","onClick"];function Gj(n){return Hj(n)||$j(n)||VI(n)||Vj()}function Vj(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $j(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Hj(n){if(Array.isArray(n))return s1(n)}function rv(n,t){return Xj(n)||Zj(n,t)||VI(n,t)||Wj()}function Wj(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VI(n,t){if(n){if(typeof n=="string")return s1(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s1(n,t)}}function s1(n,t){(t==null||t>n.length)&&(t=n.length);for(var r=0,l=new Array(t);r<t;r++)l[r]=n[r];return l}function Zj(n,t){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var l=[],u=!0,d=!1,p,b;try{for(r=r.call(n);!(u=(p=r.next()).done)&&(l.push(p.value),!(t&&l.length===t));u=!0);}catch(i){d=!0,b=i}finally{try{!u&&r.return!=null&&r.return()}finally{if(d)throw b}}return l}}function Xj(n){if(Array.isArray(n))return n}function sA(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable})),r.push.apply(r,l)}return r}function _o(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sA(Object(r),!0).forEach(function(l){a1(n,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):sA(Object(r)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(r,l))})}return n}function a1(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function M_(n,t){if(n==null)return{};var r=qj(n,t),l,u;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(u=0;u<d.length;u++)l=d[u],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(n,l)&&(r[l]=n[l])}return r}function qj(n,t){if(n==null)return{};var r={},l=Object.keys(n),u,d;for(d=0;d<l.length;d++)u=l[d],!(t.indexOf(u)>=0)&&(r[u]=n[u]);return r}var dx=k.forwardRef(function(n,t){var r=n.children,l=M_(n,Fj),u=HI(l),d=u.open,p=M_(u,jj);return k.useImperativeHandle(t,function(){return{open:d}},[d]),Pe.createElement(k.Fragment,null,r(_o(_o({},p),{},{open:d})))});dx.displayName="Dropzone";var $I={disabled:!1,getFilesFromEvent:uj,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};dx.defaultProps=$I;dx.propTypes={children:Gi.func,accept:Gi.oneOfType([Gi.string,Gi.arrayOf(Gi.string)]),multiple:Gi.bool,preventDropOnDocument:Gi.bool,noClick:Gi.bool,noKeyboard:Gi.bool,noDrag:Gi.bool,noDragEventsBubbling:Gi.bool,minSize:Gi.number,maxSize:Gi.number,maxFiles:Gi.number,disabled:Gi.bool,getFilesFromEvent:Gi.func,onFileDialogCancel:Gi.func,onFileDialogOpen:Gi.func,useFsAccessApi:Gi.bool,onDragEnter:Gi.func,onDragLeave:Gi.func,onDragOver:Gi.func,onDrop:Gi.func,onDropAccepted:Gi.func,onDropRejected:Gi.func,validator:Gi.func};var l1={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function HI(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=_o(_o({},$I),n),r=t.accept,l=t.disabled,u=t.getFilesFromEvent,d=t.maxSize,p=t.minSize,b=t.multiple,i=t.maxFiles,E=t.onDragEnter,T=t.onDragLeave,A=t.onDragOver,I=t.onDrop,O=t.onDropAccepted,z=t.onDropRejected,U=t.onFileDialogCancel,N=t.onFileDialogOpen,V=t.useFsAccessApi,X=t.preventDropOnDocument,J=t.noClick,te=t.noKeyboard,ue=t.noDrag,ae=t.noDragEventsBubbling,be=t.validator,Ce=k.useMemo(function(){return typeof N=="function"?N:aA},[N]),je=k.useMemo(function(){return typeof U=="function"?U:aA},[U]),me=k.useRef(null),Ne=k.useRef(null),ht=k.useReducer(Kj,l1),_t=rv(ht,2),Bt=_t[0],Kt=_t[1],Gt=Bt.isFocused,hn=Bt.isFileDialogActive,wt=Bt.draggedFiles,bt=k.useRef(typeof window<"u"&&window.isSecureContext&&V&&Dj()),$t=function(){!bt.current&&hn&&setTimeout(function(){if(Ne.current){var xn=Ne.current.files;xn.length||(Kt({type:"closeDialog"}),je())}},300)};k.useEffect(function(){return window.addEventListener("focus",$t,!1),function(){window.removeEventListener("focus",$t,!1)}},[Ne,hn,je,bt]);var Zt=k.useRef([]),mn=function(xn){me.current&&me.current.contains(xn.target)||(xn.preventDefault(),Zt.current=[])};k.useEffect(function(){return X&&(document.addEventListener("dragover",oA,!1),document.addEventListener("drop",mn,!1)),function(){X&&(document.removeEventListener("dragover",oA),document.removeEventListener("drop",mn))}},[me,X]);var yn=k.useCallback(function(an){an.preventDefault(),an.persist(),wn(an),Zt.current=[].concat(Gj(Zt.current),[an.target]),Yg(an)&&Promise.resolve(u(an)).then(function(xn){S_(an)&&!ae||(Kt({draggedFiles:xn,isDragActive:!0,type:"setDraggedFiles"}),E&&E(an))})},[u,E,ae]),On=k.useCallback(function(an){an.preventDefault(),an.persist(),wn(an);var xn=Yg(an);if(xn&&an.dataTransfer)try{an.dataTransfer.dropEffect="copy"}catch{}return xn&&A&&A(an),!1},[A,ae]),rr=k.useCallback(function(an){an.preventDefault(),an.persist(),wn(an);var xn=Zt.current.filter(function(Hr){return me.current&&me.current.contains(Hr)}),$r=xn.indexOf(an.target);$r!==-1&&xn.splice($r,1),Zt.current=xn,!(xn.length>0)&&(Kt({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),Yg(an)&&T&&T(an))},[me,T,ae]),Yn=k.useCallback(function(an,xn){var $r=[],Hr=[];an.forEach(function(Bi){var ui=NI(Bi,r),Hi=rv(ui,2),Oo=Hi[0],no=Hi[1],ko=GI(Bi,p,d),bo=rv(ko,2),Ko=bo[0],wo=bo[1],Je=be?be(Bi):null;if(Oo&&Ko&&!Je)$r.push(Bi);else{var Vt=[no,wo];Je&&(Vt=Vt.concat(Je)),Hr.push({file:Bi,errors:Vt.filter(function(In){return In})})}}),(!b&&$r.length>1||b&&i>=1&&$r.length>i)&&($r.forEach(function(Bi){Hr.push({file:Bi,errors:[Ij]})}),$r.splice(0)),Kt({acceptedFiles:$r,fileRejections:Hr,type:"setFiles"}),I&&I($r,Hr,xn),Hr.length>0&&z&&z(Hr,xn),$r.length>0&&O&&O($r,xn)},[Kt,b,r,p,d,i,I,O,z,be]),Vr=k.useCallback(function(an){an.preventDefault(),an.persist(),wn(an),Zt.current=[],Yg(an)&&Promise.resolve(u(an)).then(function(xn){S_(an)&&!ae||Yn(xn,an)}),Kt({type:"reset"})},[u,Yn,ae]),Jr=k.useCallback(function(){if(bt.current){Kt({type:"openDialog"}),Ce();var an={multiple:b,types:Oj(r)};window.showOpenFilePicker(an).then(function(xn){return u(xn)}).then(function(xn){Yn(xn,null),Kt({type:"closeDialog"})}).catch(function(xn){kj(xn)?(je(xn),Kt({type:"closeDialog"})):zj(xn)&&(bt.current=!1,Ne.current&&(Ne.current.value=null,Ne.current.click()))});return}Ne.current&&(Kt({type:"openDialog"}),Ce(),Ne.current.value=null,Ne.current.click())},[Kt,Ce,je,V,Yn,r,b]),kr=k.useCallback(function(an){!me.current||!me.current.isEqualNode(an.target)||(an.key===" "||an.key==="Enter"||an.keyCode===32||an.keyCode===13)&&(an.preventDefault(),Jr())},[me,Jr]),Ln=k.useCallback(function(){Kt({type:"focus"})},[]),li=k.useCallback(function(){Kt({type:"blur"})},[]),kn=k.useCallback(function(){J||(Rj()?setTimeout(Jr,0):Jr())},[J,Jr]),Br=function(xn){return l?null:xn},ci=function(xn){return te?null:Br(xn)},Ji=function(xn){return ue?null:Br(xn)},wn=function(xn){ae&&xn.stopPropagation()},ki=k.useMemo(function(){return function(){var an=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},xn=an.refKey,$r=xn===void 0?"ref":xn,Hr=an.role,Bi=an.onKeyDown,ui=an.onFocus,Hi=an.onBlur,Oo=an.onClick,no=an.onDragEnter,ko=an.onDragOver,bo=an.onDragLeave,Ko=an.onDrop,wo=M_(an,Uj);return _o(_o(a1({onKeyDown:ci(xu(Bi,kr)),onFocus:ci(xu(ui,Ln)),onBlur:ci(xu(Hi,li)),onClick:Br(xu(Oo,kn)),onDragEnter:Ji(xu(no,yn)),onDragOver:Ji(xu(ko,On)),onDragLeave:Ji(xu(bo,rr)),onDrop:Ji(xu(Ko,Vr)),role:typeof Hr=="string"&&Hr!==""?Hr:"button"},$r,me),!l&&!te?{tabIndex:0}:{}),wo)}},[me,kr,Ln,li,kn,yn,On,rr,Vr,te,ue,l]),Bs=k.useCallback(function(an){an.stopPropagation()},[]),Do=k.useMemo(function(){return function(){var an=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},xn=an.refKey,$r=xn===void 0?"ref":xn,Hr=an.onChange,Bi=an.onClick,ui=M_(an,Nj),Hi=a1({accept:r,multiple:b,type:"file",style:{display:"none"},onChange:Br(xu(Hr,Vr)),onClick:Br(xu(Bi,Bs)),tabIndex:-1},$r,Ne);return _o(_o({},Hi),ui)}},[Ne,r,b,Vr,l]),Tr=wt.length,xo=Tr>0&&Pj({files:wt,accept:r,minSize:p,maxSize:d,multiple:b,maxFiles:i}),bs=Tr>0&&!xo;return _o(_o({},Bt),{},{isDragAccept:xo,isDragReject:bs,isFocused:Gt&&!l,getRootProps:ki,getInputProps:Do,rootRef:me,inputRef:Ne,open:Br(Jr)})}function Kj(n,t){switch(t.type){case"focus":return _o(_o({},n),{},{isFocused:!0});case"blur":return _o(_o({},n),{},{isFocused:!1});case"openDialog":return _o(_o({},l1),{},{isFileDialogActive:!0});case"closeDialog":return _o(_o({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":var r=t.isDragActive,l=t.draggedFiles;return _o(_o({},n),{},{draggedFiles:l,isDragActive:r});case"setFiles":return _o(_o({},n),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return _o({},l1);default:return n}}function aA(){}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Jj=function(t){return t!=null&&typeof t=="object"&&Array.isArray(t)===!1};/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Yj=Jj;function lA(n){return Yj(n)===!0&&Object.prototype.toString.call(n)==="[object Object]"}var ty=function(t){var r,l;return!(lA(t)===!1||(r=t.constructor,typeof r!="function")||(l=r.prototype,lA(l)===!1)||l.hasOwnProperty("isPrototypeOf")===!1)};/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Qj=ty,eU=function(t){return Qj(t)||typeof t=="function"||Array.isArray(t)};/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var tU=ty,nU=function(t){return tU(t)||typeof t=="function"||Array.isArray(t)};/*!
 * for-in <https://github.com/jonschlinkert/for-in>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var rU=function(t,r,l){for(var u in t)if(r.call(l,t[u],u,t)===!1)break},iU=nU,oU=rU;function WI(n,t){for(var r=arguments.length,l=0;++l<r;){var u=arguments[l];c1(u)&&oU(u,sU,n)}return n}function sU(n,t){if(aU(t)){var r=this[t];c1(n)&&c1(r)?WI(r,n):this[t]=n}}function c1(n){return iU(n)&&!Array.isArray(n)}function aU(n){return n!=="__proto__"&&n!=="constructor"&&n!=="prototype"}var lU=WI;/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var cU=function(n,t,r,l,u){if(!uU(n)||!t)return n;if(t=Qg(t),r&&(t+="."+Qg(r)),l&&(t+="."+Qg(l)),u&&(t+="."+Qg(u)),t in n)return n[t];for(var d=t.split("."),p=d.length,b=-1;n&&++b<p;){for(var i=d[b];i[i.length-1]==="\\";)i=i.slice(0,-1)+"."+d[++b];n=n[i]}return n};function uU(n){return n!==null&&(typeof n=="object"||typeof n=="function")}function Qg(n){return n?Array.isArray(n)?n.join("."):n:""}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var hU=ty,dU=function(t){return hU(t)||typeof t=="function"||Array.isArray(t)};/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var fU=function(n,t){if(n===null||typeof n>"u")throw new TypeError("expected first argument to be an object.");if(typeof t>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return n;for(var r=Object.prototype.propertyIsEnumerable,l=Object(n),u=arguments.length,d=0;++d<u;)for(var p=Object(arguments[d]),b=Object.getOwnPropertySymbols(p),i=0;i<b.length;i++){var E=b[i];r.call(p,E)&&(l[E]=p[E])}return l},pU=dU,mU=fU,gU=Object.assign||function(n){if(n===null||typeof n>"u")throw new TypeError("Cannot convert undefined or null to object");cA(n)||(n={});for(var t=1;t<arguments.length;t++){var r=arguments[t];yU(r)&&(r=vU(r)),cA(r)&&(_U(n,r),mU(n,r))}return n};function _U(n,t){for(var r in t)xU(t,r)&&(n[r]=t[r])}function yU(n){return n&&typeof n=="string"}function vU(n){var t={};for(var r in n)t[r]=n[r];return t}function cA(n){return n&&typeof n=="object"||pU(n)}function xU(n,t){return Object.prototype.hasOwnProperty.call(n,t)}/*!
 * split-string <https://github.com/jonschlinkert/split-string>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var bU=gU,wU=function(n,t,r){if(typeof n!="string")throw new TypeError("expected a string");typeof t=="function"&&(r=t,t=null),typeof t=="string"&&(t={sep:t});var l=bU({sep:"."},t),u=l.quotes||['"',"'","`"],d;l.brackets===!0?d={"<":">","(":")","[":"]","{":"}"}:l.brackets&&(d=l.brackets);var p=[],b=[],i=[""],E=l.sep,T=n.length,A=-1,I;function O(){if(d&&b.length)return d[b[b.length-1]]}for(;++A<T;){var z=n[A],U=n[A+1],N={val:z,idx:A,arr:i,str:n};if(p.push(N),z==="\\"){N.val=CU(l,n,A)===!0?z+U:U,N.escaped=!0,typeof r=="function"&&r(N),i[i.length-1]+=N.val,A++;continue}if(d&&d[z]){b.push(z);var V=O(),X=A+1;if(n.indexOf(V,X+1)!==-1)for(;b.length&&X<T;){var J=n[++X];if(J==="\\"){J++;continue}if(u.indexOf(J)!==-1){X=u1(n,J,X+1);continue}if(V=O(),b.length&&n.indexOf(V,X+1)===-1)break;if(d[J]){b.push(J);continue}V===J&&b.pop()}if(I=X,I===-1){i[i.length-1]+=z;continue}z=n.slice(A,I+1),N.val=z,N.idx=A=I}if(u.indexOf(z)!==-1){if(I=u1(n,z,A+1),I===-1){i[i.length-1]+=z;continue}EU(z,l)===!0?z=n.slice(A,I+1):z=n.slice(A+1,I),N.val=z,N.idx=A=I}if(typeof r=="function"&&(r(N,p),z=N.val,A=N.idx),N.val===E&&N.split!==!1){i.push("");continue}i[i.length-1]+=N.val}return i};function u1(n,t,r,l){var u=n.indexOf(t,r);return n.charAt(u-1)==="\\"?u1(n,t,u+1):u}function EU(n,t){return t.keepDoubleQuotes===!0&&n==='"'||t.keepSingleQuotes===!0&&n==="'"?!0:t.keepQuotes}function CU(n,t,r){return typeof n.keepEscaping=="function"?n.keepEscaping(t,r):n.keepEscaping===!0||t[r+1]==="\\"}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var ZI=function(t){return typeof t<"u"&&t!==null&&(typeof t=="object"||typeof t=="function")},uA=ZI,AU=function(t){uA(t)||(t={});for(var r=arguments.length,l=1;l<r;l++){var u=arguments[l];uA(u)&&TU(t,u)}return t};function TU(n,t){for(var r in t)SU(t,r)&&(n[r]=t[r])}function SU(n,t){return Object.prototype.hasOwnProperty.call(n,t)}/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) 2014-2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var MU=wU,IU=AU,hA=ty,dA=ZI,PU=function(n,t,r){if(!dA(n)||(Array.isArray(t)&&(t=[].concat.apply([],t).join(".")),typeof t!="string"))return n;for(var l=MU(t,{sep:".",brackets:!0}).filter(LU),u=l.length,d=-1,p=n;++d<u;){var b=l[d];if(d!==u-1){dA(p[b])||(p[b]={}),p=p[b];continue}hA(p[b])&&hA(r)?p[b]=IU({},p[b],r):p[b]=r}return n};function LU(n){return n!=="__proto__"&&n!=="constructor"&&n!=="prototype"}var iv=eU,fA=lU,BU=cU,pA=PU,RU=function(t,r,l){if(!iv(t))throw new TypeError("expected an object");if(typeof r!="string"||l==null)return fA.apply(null,arguments);if(typeof l=="string")return pA(t,r,l),t;var u=BU(t,r);return iv(l)&&iv(u)&&(l=fA({},u,l)),pA(t,r,l),t};const DU=F_(RU),fx=(...n)=>n.filter(Boolean).join(".");function OU(n){const t=n.split(".");return[t.pop(),t.join(".")||void 0]}function kU(n,t){return Object.entries(f6(n,t)).reduce((r,[,{value:l,disabled:u,key:d}])=>(r[d]=u?void 0:l,r),{})}function zU(n,t){const r=k.useRef();return Bm(n,r.current)||(r.current=n),r.current}function XI(n,t){return k.useMemo(n,zU(t))}function FU(n){const t=k.useRef(null),r=k.useRef(null),l=k.useRef(!0);return k.useLayoutEffect(()=>{n||(t.current.style.height="0px",t.current.style.overflow="hidden")},[]),k.useEffect(()=>{if(l.current){l.current=!1;return}let u;const d=t.current,p=()=>{n&&(d.style.removeProperty("height"),d.style.removeProperty("overflow"),r.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};d.addEventListener("transitionend",p,{once:!0});const{height:b}=r.current.getBoundingClientRect();return d.style.height=b+"px",n||(d.style.overflow="hidden",u=window.setTimeout(()=>d.style.height="0px",50)),()=>{d.removeEventListener("transitionend",p),clearTimeout(u)}},[n]),{wrapperRef:t,contentRef:r}}const jU=n=>{const[t,r]=k.useState(n.getVisiblePaths());return k.useEffect(()=>{r(n.getVisiblePaths());const l=n.useStore.subscribe(n.getVisiblePaths,r,{equalityFn:X_});return()=>l()},[n]),t};function UU(n,t,r){return n.useStore(u=>{const d=tr(tr({},r),u.data);return kU(d,t)},X_)}function qI(n=3){const t=k.useRef(null),r=k.useRef(null),[l,u]=k.useState(!1),d=k.useCallback(()=>u(!0),[]),p=k.useCallback(()=>u(!1),[]);return k.useLayoutEffect(()=>{if(l){const{bottom:b,top:i,left:E}=t.current.getBoundingClientRect(),{height:T}=r.current.getBoundingClientRect(),A=b+T>window.innerHeight-40?"up":"down";r.current.style.position="fixed",r.current.style.zIndex="10000",r.current.style.left=E+"px",A==="down"?r.current.style.top=b+n+"px":r.current.style.bottom=window.innerHeight-i+n+"px"}},[n,l]),{popinRef:t,wrapperRef:r,shown:l,show:d,hide:p}}K8([J8]);const NU={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};yl.extend({color:()=>n=>La(n).isValid()});const GU=n=>yl().color().test(n);function KI(n,{format:t,hasAlpha:r,isString:l}){const u=NU[t]+(l&&t!=="hex"?"String":""),d=n[u]();return typeof d=="object"&&!r?p6(d,["a"]):d}const JI=(n,t)=>{const r=La(n);if(!r.isValid())throw Error("Invalid color");return KI(r,t)},VU=(n,t)=>KI(La(n),tr(tr({},t),{},{isString:!0,format:"hex"})),$U=({value:n})=>{const t=q8(n),r=t==="name"?"hex":t,l=typeof n=="object"?"a"in n:t==="hex"&&n.length===8||/^(rgba)|(hsla)|(hsva)/.test(n),u={format:r,hasAlpha:l,isString:typeof n=="string"};return{value:JI(n,u),settings:u}};var HU=Object.freeze({__proto__:null,schema:GU,sanitize:JI,format:VU,normalize:$U});const WU=Vn("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),ZU=Vn("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),XU=Vn("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function mA(n,t){return t!=="rgb"?La(n).toRgb():n}function qU({value:n,displayValue:t,settings:r,onUpdate:l}){const{emitOnEditStart:u,emitOnEditEnd:d}=ga(),{format:p,hasAlpha:b}=r,{popinRef:i,wrapperRef:E,shown:T,show:A,hide:I}=qI(),O=k.useRef(0),[z,U]=k.useState(()=>mA(n,p)),N=b?ij:sj,V=()=>{U(mA(n,p)),A(),u()},X=()=>{I(),d(),window.clearTimeout(O.current)},J=()=>{O.current=window.setTimeout(X,500)};return k.useEffect(()=>()=>window.clearTimeout(O.current),[]),Pe.createElement(Pe.Fragment,null,Pe.createElement(WU,{ref:i,active:T,onClick:()=>V(),style:{color:t}}),T&&Pe.createElement(ox,null,Pe.createElement(yI,{onPointerUp:X}),Pe.createElement(XU,{ref:E,onMouseEnter:()=>window.clearTimeout(O.current),onMouseLeave:te=>te.buttons===0&&J()},Pe.createElement(N,{color:z,onChange:l}))))}function KU(){const{value:n,displayValue:t,label:r,onChange:l,onUpdate:u,settings:d}=ga();return Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,r),Pe.createElement(ZU,null,Pe.createElement(qU,{value:n,displayValue:t,onChange:l,onUpdate:u,settings:d}),Pe.createElement(ix,{value:t,onChange:l,onUpdate:u})))}var JU=tr({component:KU},HU);function YU(){const{label:n,displayValue:t,onUpdate:r,settings:l}=ga();return Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,n),Pe.createElement(ax,{value:t,settings:l,onUpdate:r}))}var QU=tr({component:YU},TI(["x","y","z"]));const eN=Vn("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),tN=Vn("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function nN({value:n,settings:t,onUpdate:r}){const l=k.useRef(),u=k.useRef(0),d=k.useRef(0),p=k.useRef(1),[b,i]=k.useState(!1),[E,T]=k.useState(!1),[A,I]=xI(),O=k.useRef(null),z=k.useRef(null);k.useLayoutEffect(()=>{if(b){const{top:ht,left:_t,width:Bt,height:Kt}=O.current.getBoundingClientRect();z.current.style.left=_t+Bt/2+"px",z.current.style.top=ht+Kt/2+"px"}},[b]);const{keys:[U,N],joystick:V}=t,X=V==="invertY"?1:-1,{[U]:{step:J},[N]:{step:te}}=t,ue=sh("sizes","joystickWidth"),ae=sh("sizes","joystickHeight"),be=parseFloat(ue)*.8/2,Ce=parseFloat(ae)*.8/2,je=k.useCallback(()=>{l.current||(T(!0),u.current&&I({x:u.current*be}),d.current&&I({y:d.current*-Ce}),l.current=window.setInterval(()=>{r(ht=>{const _t=J*u.current*p.current,Bt=X*te*d.current*p.current;return Array.isArray(ht)?{[U]:ht[0]+_t,[N]:ht[1]+Bt}:{[U]:ht[U]+_t,[N]:ht[N]+Bt}})},16))},[be,Ce,r,I,J,te,U,N,X]),me=k.useCallback(()=>{window.clearTimeout(l.current),l.current=void 0,T(!1)},[]);k.useEffect(()=>{function ht(_t){p.current=iI(_t)}return window.addEventListener("keydown",ht),window.addEventListener("keyup",ht),()=>{window.clearTimeout(l.current),window.removeEventListener("keydown",ht),window.removeEventListener("keyup",ht)}},[]);const Ne=Hm(({first:ht,active:_t,delta:[Bt,Kt],movement:[Gt,hn]})=>{ht&&i(!0);const wt=Zh(Gt,-be,be),bt=Zh(hn,-Ce,Ce);u.current=Math.abs(Gt)>Math.abs(wt)?Math.sign(Gt-wt):0,d.current=Math.abs(hn)>Math.abs(bt)?Math.sign(bt-hn):0;let $t=n[U],Zt=n[N];_t?(u.current||($t+=Bt*J*p.current,I({x:wt})),d.current||(Zt-=X*Kt*te*p.current,I({y:bt})),u.current||d.current?je():me(),r({[U]:$t,[N]:Zt})):(i(!1),u.current=0,d.current=0,I({x:0,y:0}),me())});return Pe.createElement(eN,Bo({ref:O},Ne()),b&&Pe.createElement(ox,null,Pe.createElement(tN,{ref:z,isOutOfBounds:E},Pe.createElement("div",null),Pe.createElement("span",{ref:A}))))}const rN=Vn("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function iN(){const{label:n,displayValue:t,onUpdate:r,settings:l}=ga();return Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,n),Pe.createElement(rN,{withJoystick:!!l.joystick},l.joystick&&Pe.createElement(nN,{value:t,settings:l,onUpdate:r}),Pe.createElement(ax,{value:t,settings:l,onUpdate:r})))}const oN=["joystick"],YI=TI(["x","y"]),sN=n=>{let{joystick:t=!0}=n,r=Li(n,oN);const{value:l,settings:u}=YI.normalize(r);return{value:l,settings:tr(tr({},u),{},{joystick:t})}};var aN=tr(tr({component:iN},YI),{},{normalize:sN});const lN=n=>{if(n!==void 0){if(n instanceof File)try{return URL.createObjectURL(n)}catch{return}if(typeof n=="string"&&n.indexOf("blob:")===0)return n;throw Error("Invalid image format [undefined | blob | File].")}},cN=(n,t)=>typeof t=="object"&&"image"in t,uN=({image:n})=>({value:n});var hN=Object.freeze({__proto__:null,sanitize:lN,schema:cN,normalize:uN});const dN=Vn("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),fN=Vn("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),pN=Vn("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),mN=Vn("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),gN=Vn("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),_N=Vn("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function yN(){const{label:n,value:t,onUpdate:r,disabled:l}=ga(),{popinRef:u,wrapperRef:d,shown:p,show:b,hide:i}=qI(),E=k.useCallback(z=>{z.length&&r(z[0])},[r]),T=k.useCallback(z=>{z.stopPropagation(),r(void 0)},[r]),{getRootProps:A,getInputProps:I,isDragAccept:O}=HI({maxFiles:1,accept:"image/*",onDrop:E,disabled:l});return Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,n),Pe.createElement(dN,null,Pe.createElement(pN,{ref:u,hasImage:!!t,onPointerDown:()=>!!t&&b(),onPointerUp:i,style:{backgroundImage:t?`url(${t})`:"none"}}),p&&!!t&&Pe.createElement(ox,null,Pe.createElement(yI,{onPointerUp:i,style:{cursor:"pointer"}}),Pe.createElement(mN,{ref:d,style:{backgroundImage:`url(${t})`}})),Pe.createElement(fN,A({isDragAccept:O}),Pe.createElement("input",I()),Pe.createElement(gN,null,O?"drop image":"click or drop")),Pe.createElement(_N,{onClick:T,disabled:!t})))}var vN=tr({component:yN},hN);const gA=yl().number(),xN=(n,t)=>yl().array().length(2).every.number().test(n)&&yl().schema({min:gA,max:gA}).test(t),I_=n=>({min:n[0],max:n[1]}),QI=(n,{bounds:[t,r]},l)=>{const u=Array.isArray(n)?I_(n):n,d={min:l[0],max:l[1]},{min:p,max:b}=tr(tr({},d),u);return[Zh(Number(p),t,Math.max(t,b)),Zh(Number(b),Math.min(r,p),r)]},bN=({value:n,min:t,max:r})=>{const l={min:t,max:r},u=AI(I_(n),{min:l,max:l}),d=[t,r],p=tr(tr({},u),{},{bounds:d});return{value:QI(I_(n),p,n),settings:p}};var wN=Object.freeze({__proto__:null,schema:xN,format:I_,sanitize:QI,normalize:bN});const EN=["value","bounds","onDrag"],CN=["bounds"],AN=Vn("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function TN(n){let{value:t,bounds:[r,l],onDrag:u}=n,d=Li(n,EN);const p=k.useRef(null),b=k.useRef(null),i=k.useRef(null),E=k.useRef(0),T=sh("sizes","scrubberWidth"),A=Hm(({event:z,first:U,xy:[N],movement:[V],memo:X={}})=>{if(U){const{width:te,left:ue}=p.current.getBoundingClientRect();E.current=te-parseFloat(T);const ae=(z==null?void 0:z.target)===b.current||(z==null?void 0:z.target)===i.current;X.pos=C_((N-ue)/te,r,l);const be=Math.abs(X.pos-t.min)-Math.abs(X.pos-t.max);X.key=be<0||be===0&&X.pos<=t.min?"min":"max",ae&&(X.pos=t[X.key])}const J=X.pos+C_(V/E.current,0,l-r);return u({[X.key]:n8(J,d[X.key])}),X}),I=`calc(${E_(t.min,r,l)} * (100% - ${T} - 8px) + 4px)`,O=`calc(${1-E_(t.max,r,l)} * (100% - ${T} - 8px) + 4px)`;return Pe.createElement(wI,Bo({ref:p},A()),Pe.createElement(bI,null,Pe.createElement(EI,{style:{left:I,right:O}})),Pe.createElement(Yv,{position:"left",ref:b,style:{left:I}}),Pe.createElement(Yv,{position:"right",ref:i,style:{right:O}}))}function SN(){const{label:n,displayValue:t,onUpdate:r,settings:l}=ga(),u=Li(l,CN);return Pe.createElement(Pe.Fragment,null,Pe.createElement(gc,{input:!0},Pe.createElement(Uc,null,n),Pe.createElement(AN,null,Pe.createElement(TN,Bo({value:t},l,{onDrag:r})),Pe.createElement(ax,{value:t,settings:u,onUpdate:r,innerLabelTrim:0}))))}var MN=tr({component:SN},wN);const IN=()=>{const n=new Map;return{on:(t,r)=>{let l=n.get(t);l===void 0&&(l=new Set,n.set(t,l)),l.add(r)},off:(t,r)=>{const l=n.get(t);l!==void 0&&(l.delete(r),l.size===0&&n.delete(t))},emit:(t,...r)=>{const l=n.get(t);if(l!==void 0)for(const u of l)u(...r)}}},PN=["type","value"],LN=["onChange","transient","onEditStart","onEditEnd"],BN=function(){const t=$1(i5(()=>({data:{}}))),r=IN();this.storeId=d6(),this.useStore=t;const l={},u=new Set;this.getVisiblePaths=()=>{const p=this.getData(),b=Object.keys(p),i=[];Object.entries(l).forEach(([T,A])=>{A.render&&b.some(I=>I.indexOf(T)===0)&&!A.render(this.get)&&i.push(T+".")});const E=[];return u.forEach(T=>{T in p&&p[T].__refCount>0&&i.every(A=>T.indexOf(A)===-1)&&(!p[T].render||p[T].render(this.get))&&E.push(T)}),E},this.setOrderedPaths=p=>{p.forEach(b=>u.add(b))},this.orderPaths=p=>(this.setOrderedPaths(p),p),this.disposePaths=p=>{t.setState(b=>{const i=b.data;return p.forEach(E=>{if(E in i){const T=i[E];T.__refCount--,T.__refCount===0&&T.type in Fc&&delete i[E]}}),{data:i}})},this.dispose=()=>{t.setState(()=>({data:{}}))},this.getFolderSettings=p=>l[p]||{},this.getData=()=>t.getState().data,this.addData=(p,b)=>{t.setState(i=>{const E=i.data;return Object.entries(p).forEach(([T,A])=>{let I=E[T];if(I){const{type:O,value:z}=A,U=Li(A,PN);O!==I.type?ih(yo.INPUT_TYPE_OVERRIDE,O):((I.__refCount===0||b)&&Object.assign(I,U),I.__refCount++)}else E[T]=tr(tr({},A),{},{__refCount:1})}),{data:E}})},this.setValueAtPath=(p,b,i)=>{t.setState(E=>{const T=E.data;return UC(T[p],b,p,this,i),{data:T}})},this.setSettingsAtPath=(p,b)=>{t.setState(i=>{const E=i.data;return E[p].settings=tr(tr({},E[p].settings),b),{data:E}})},this.disableInputAtPath=(p,b)=>{t.setState(i=>{const E=i.data;return E[p].disabled=b,{data:E}})},this.set=(p,b)=>{t.setState(i=>{const E=i.data;return Object.entries(p).forEach(([T,A])=>{try{UC(E[T],A,void 0,void 0,b)}catch{}}),{data:E}})},this.getInput=p=>{try{return this.getData()[p]}catch{ih(yo.PATH_DOESNT_EXIST,p)}},this.get=p=>{var b;return(b=this.getInput(p))===null||b===void 0?void 0:b.value},this.emitOnEditStart=p=>{r.emit(`onEditStart:${p}`,this.get(p),p,tr(tr({},this.getInput(p)),{},{get:this.get}))},this.emitOnEditEnd=p=>{r.emit(`onEditEnd:${p}`,this.get(p),p,tr(tr({},this.getInput(p)),{},{get:this.get}))},this.subscribeToEditStart=(p,b)=>{const i=`onEditStart:${p}`;return r.on(i,b),()=>r.off(i,b)},this.subscribeToEditEnd=(p,b)=>{const i=`onEditEnd:${p}`;return r.on(i,b),()=>r.off(i,b)};const d=(p,b,i)=>{const E={};return Object.entries(p).forEach(([T,A])=>{if(T==="")return ih(yo.EMPTY_KEY);let I=fx(b,T);if(A.type===Fc.FOLDER){const O=d(A.schema,I,i);Object.assign(E,O),I in l||(l[I]=A.settings)}else if(T in i)ih(yo.DUPLICATE_KEYS,T,I,i[T].path);else{const O=x6(A,T,I,E);if(O){const{type:z,options:U,input:N}=O,{onChange:V,transient:X,onEditStart:J,onEditEnd:te}=U,ue=Li(U,LN);E[I]=tr(tr(tr({type:z},ue),N),{},{fromPanel:!0}),i[T]={path:I,onChange:V,transient:X,onEditStart:J,onEditEnd:te}}else ih(yo.UNKNOWN_INPUT,I,A)}}),E};this.getDataFromSchema=p=>{const b={};return[d(p,"",b),b]}},e3=new BN,RN={collapsed:!1};function Ud(n,t){return{type:Fc.FOLDER,schema:n,settings:tr(tr({},RN),t)}}const _A=n=>"__levaInput"in n,DN=(n,t)=>{const r={},l=t?t.toLowerCase():null;return n.forEach(u=>{const[d,p]=OU(u);(!l||d.toLowerCase().indexOf(l)>-1)&&DU(r,p,{[d]:{__levaInput:!0,path:u}})}),r},ON=["type","label","path","valueKey","value","settings","setValue","disabled"];function kN(n){let{type:t,label:r,path:l,valueKey:u,value:d,settings:p,setValue:b,disabled:i}=n,E=Li(n,ON);const{displayValue:T,onChange:A,onUpdate:I}=vI({type:t,value:d,settings:p,setValue:b}),O=kd[t].component;return O?Pe.createElement(cI.Provider,{value:tr({key:u,path:l,id:""+l,label:r,displayValue:T,value:d,onChange:A,onUpdate:I,settings:p,setValue:b,disabled:i},E)},Pe.createElement(U6,{disabled:i},Pe.createElement(O,null))):(ih(yo.NO_COMPONENT_FOR_TYPE,t,l),null)}const zN=Vn("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function FN({onClick:n,settings:t,label:r}){const l=$m();return Pe.createElement(gc,null,Pe.createElement(zN,{disabled:t.disabled,onClick:()=>n(l.get)},r))}const jN=Vn("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),UN=Vn("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),NN=({label:n,opts:t})=>{let r=typeof n=="string"&&n.trim()===""?null:n,l=t;return typeof t.opts=="object"&&(l.label!==void 0&&(r=t.label),l=t.opts),{label:r,opts:l}};function GN(n){const{label:t,opts:r}=NN(n),l=$m();return Pe.createElement(gc,{input:!!t},t&&Pe.createElement(Uc,null,t),Pe.createElement(jN,null,Object.entries(r).map(([u,d])=>Pe.createElement(UN,{key:u,onClick:()=>d(l.get)},u))))}const VN=Vn("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),t3=100;function $N(n,t){n.push(t),n.length>t3&&n.shift()}const HN=k.forwardRef(function({initialValue:n},t){const r=sh("colors","highlight3"),l=sh("colors","elevation2"),u=sh("colors","highlight1"),[d,p]=k.useMemo(()=>[La(u).alpha(.4).toRgbString(),La(u).alpha(.1).toRgbString()],[u]),b=k.useRef([n]),i=k.useRef(n),E=k.useRef(n),T=k.useRef(),A=k.useCallback((z,U)=>{if(!z)return;const{width:N,height:V}=z,X=new Path2D,J=N/t3,te=V*.05;for(let be=0;be<b.current.length;be++){const Ce=E_(b.current[be],i.current,E.current),je=J*be,me=V-Ce*(V-te*2)-te;X.lineTo(je,me)}U.clearRect(0,0,N,V);const ue=new Path2D(X);ue.lineTo(J*(b.current.length+1),V),ue.lineTo(0,V),ue.lineTo(0,0);const ae=U.createLinearGradient(0,0,0,V);ae.addColorStop(0,d),ae.addColorStop(1,p),U.fillStyle=ae,U.fill(ue),U.strokeStyle=l,U.lineJoin="round",U.lineWidth=14,U.stroke(X),U.strokeStyle=r,U.lineWidth=2,U.stroke(X)},[r,l,d,p]),[I,O]=q6(A);return k.useImperativeHandle(t,()=>({frame:z=>{(i.current===void 0||z<i.current)&&(i.current=z),(E.current===void 0||z>E.current)&&(E.current=z),$N(b.current,z),T.current=requestAnimationFrame(()=>A(I.current,O.current))}}),[I,O,A]),k.useEffect(()=>()=>cancelAnimationFrame(T.current),[]),Pe.createElement(VN,{ref:I})}),yA=n=>Number.isFinite(n)?n.toPrecision(2):n.toString(),WN=k.forwardRef(function({initialValue:n},t){const[r,l]=k.useState(yA(n));return k.useImperativeHandle(t,()=>({frame:u=>l(yA(u))}),[]),Pe.createElement("div",null,r)});function vA(n){return typeof n=="function"?n():n.current}function ZN({label:n,objectOrFn:t,settings:r}){const l=k.useRef(),u=k.useRef(vA(t));return k.useEffect(()=>{const d=window.setInterval(()=>{var p;document.hidden||(p=l.current)===null||p===void 0||p.frame(vA(t))},r.interval);return()=>window.clearInterval(d)},[t,r.interval]),Pe.createElement(gc,{input:!0},Pe.createElement(Uc,{align:"top"},n),r.graph?Pe.createElement(HN,{ref:l,initialValue:u.current}):Pe.createElement(WN,{ref:l,initialValue:u.current}))}const XN=["type","label","key"],qN={[Fc.BUTTON]:FN,[Fc.BUTTON_GROUP]:GN,[Fc.MONITOR]:ZN},KN=Pe.memo(({path:n})=>{const[t,{set:r,setSettings:l,disable:u,storeId:d,emitOnEditStart:p,emitOnEditEnd:b}]=J6(n);if(!t)return null;const{type:i,label:E,key:T}=t,A=Li(t,XN);if(i in Fc){const I=qN[i];return Pe.createElement(I,Bo({label:E,path:n},A))}return i in kd?Pe.createElement(kN,Bo({key:d+n,type:i,label:E,storeId:d,path:n,valueKey:T,setValue:r,setSettings:l,disable:u,emitOnEditStart:p,emitOnEditEnd:b},A)):(i6(yo.UNSUPPORTED_INPUT,i,n),null)});function JN({toggle:n,toggled:t,name:r}){return Pe.createElement(z6,{onClick:()=>n()},Pe.createElement(sx,{toggled:t}),Pe.createElement("div",null,r))}const YN=({name:n,path:t,tree:r})=>{const l=$m(),u=fx(t,n),{collapsed:d,color:p}=l.getFolderSettings(u),[b,i]=k.useState(!d),E=k.useRef(null),T=sh("colors","folderWidgetColor"),A=sh("colors","folderTextColor");return k.useLayoutEffect(()=>{E.current.style.setProperty("--leva-colors-folderWidgetColor",p||T),E.current.style.setProperty("--leva-colors-folderTextColor",p||A)},[p,T,A]),Pe.createElement(A_,{ref:E},Pe.createElement(JN,{name:n,toggled:b,toggle:()=>i(I=>!I)}),Pe.createElement(n3,{parent:u,tree:r,toggled:b}))},n3=Pe.memo(({isRoot:n=!1,fill:t=!1,flat:r=!1,parent:l,tree:u,toggled:d})=>{const{wrapperRef:p,contentRef:b}=FU(d),i=$m(),E=([A,I])=>{var O;return(_A(I)?(O=i.getInput(I.path))===null||O===void 0?void 0:O.order:i.getFolderSettings(fx(l,A)).order)||0},T=Object.entries(u).sort((A,I)=>E(A)-E(I));return Pe.createElement(Kv,{ref:p,isRoot:n,fill:t,flat:r},Pe.createElement(mI,{ref:b,isRoot:n,toggled:d},T.map(([A,I])=>_A(I)?Pe.createElement(KN,{key:I.path,valueKey:I.valueKey,path:I.path}):Pe.createElement(YN,{key:A,name:A,path:l,tree:I}))))}),QN=Vn("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${_I}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),r3=40,P_=Vn("i",{$flexCenter:"",width:r3,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),e7=Vn("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),t7=Vn("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${P_}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),n7=Vn("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),r7=Vn("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:r3}}}}),i7=Pe.forwardRef(({setFilter:n,toggle:t},r)=>{const[l,u]=k.useState(""),d=k.useMemo(()=>rI(n,250),[n]),p=()=>{n(""),u("")},b=i=>{const E=i.currentTarget.value;t(!0),u(E)};return k.useEffect(()=>{d(l)},[l,d]),Pe.createElement(Pe.Fragment,null,Pe.createElement(n7,{ref:r,value:l,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:i=>i.stopPropagation(),onChange:b}),Pe.createElement(P_,{onClick:()=>p(),style:{visibility:l?"visible":"hidden"}},Pe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},Pe.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function o7({setFilter:n,onDrag:t,onDragStart:r,onDragEnd:l,toggle:u,toggled:d,title:p,drag:b,filterEnabled:i,from:E}){const[T,A]=k.useState(!1),I=k.useRef(null);k.useEffect(()=>{var z,U;T?(z=I.current)===null||z===void 0||z.focus():(U=I.current)===null||U===void 0||U.blur()},[T]);const O=Hm(({offset:[z,U],first:N,last:V})=>{t({x:z,y:U}),N&&r({x:z,y:U}),V&&l({x:z,y:U})},{filterTaps:!0,from:({offset:[z,U]})=>[(E==null?void 0:E.x)||z,(E==null?void 0:E.y)||U]});return k.useEffect(()=>{const z=U=>{U.key==="L"&&U.shiftKey&&U.metaKey&&A(N=>!N)};return window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)},[]),Pe.createElement(Pe.Fragment,null,Pe.createElement(e7,{mode:b?"drag":void 0},Pe.createElement(P_,{active:!d,onClick:()=>u()},Pe.createElement(sx,{toggled:d,width:12,height:8})),Pe.createElement(r7,Bo({},b?O():{},{drag:b,filterEnabled:i}),p===void 0&&b?Pe.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},Pe.createElement("circle",{cx:"2",cy:"2",r:"2"}),Pe.createElement("circle",{cx:"14",cy:"2",r:"2"}),Pe.createElement("circle",{cx:"26",cy:"2",r:"2"}),Pe.createElement("circle",{cx:"2",cy:"12",r:"2"}),Pe.createElement("circle",{cx:"14",cy:"12",r:"2"}),Pe.createElement("circle",{cx:"26",cy:"12",r:"2"})):p),i&&Pe.createElement(P_,{active:T,onClick:()=>A(z=>!z)},Pe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},Pe.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),Pe.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),Pe.createElement(t7,{toggled:T},Pe.createElement(i7,{ref:I,setFilter:n,toggle:u})))}const s7=["store","hidden","theme","collapsed"];function a7(n){let{store:t,hidden:r=!1,theme:l,collapsed:u=!1}=n,d=Li(n,s7);const p=XI(()=>L6(l),[l]),[b,i]=k.useState(!u),E=typeof u=="object"?!u.collapsed:b,T=k.useMemo(()=>typeof u=="object"?A=>{typeof A=="function"?u.onChange(!A(!u.collapsed)):u.onChange(!A)}:i,[u]);return!t||r?null:Pe.createElement(rx.Provider,{value:p},Pe.createElement(l7,Bo({store:t},d,{toggled:E,setToggle:T,rootClass:p.className})))}const l7=Pe.memo(({store:n,rootClass:t,fill:r=!1,flat:l=!1,neverHide:u=!1,oneLineLabels:d=!1,titleBar:p={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:b=!1,toggled:i,setToggle:E})=>{var T,A;const I=jU(n),[O,z]=k.useState(""),U=k.useMemo(()=>DN(I,O),[I,O]),[N,V]=xI(),X=u||I.length>0,J=typeof p=="object"&&p.title||void 0,te=typeof p=="object"&&(T=p.drag)!==null&&T!==void 0?T:!0,ue=typeof p=="object"&&(A=p.filter)!==null&&A!==void 0?A:!0,ae=typeof p=="object"&&p.position||void 0,be=typeof p=="object"&&p.onDrag||void 0,Ce=typeof p=="object"&&p.onDragStart||void 0,je=typeof p=="object"&&p.onDragEnd||void 0;return Pe.useEffect(()=>{V({x:ae==null?void 0:ae.x,y:ae==null?void 0:ae.y})},[ae,V]),P6(),Pe.createElement(hI.Provider,{value:{hideCopyButton:b}},Pe.createElement(QN,{ref:N,className:t,fill:r,flat:l,oneLineLabels:d,hideTitleBar:!p,style:{display:X?"block":"none"}},p&&Pe.createElement(o7,{onDrag:me=>{V(me),be==null||be(me)},onDragStart:me=>Ce==null?void 0:Ce(me),onDragEnd:me=>je==null?void 0:je(me),setFilter:z,toggle:me=>E(Ne=>me??!Ne),toggled:i,title:J,drag:te,filterEnabled:ue,from:ae}),X&&Pe.createElement(uI.Provider,{value:n},Pe.createElement(n3,{isRoot:!0,fill:r,flat:l,tree:U,toggled:i}))))}),c7=["isRoot"];let L_=!1,Sd=null;function i3(n){let{isRoot:t=!1}=n,r=Li(n,c7);return k.useEffect(()=>(L_=!0,!t&&Sd&&(Sd.remove(),Sd=null),()=>{t||(L_=!1)}),[t]),Pe.createElement(a7,Bo({store:e3},r))}function u7(n){k.useEffect(()=>{n&&!L_&&(Sd||(Sd=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(Sd),w6(Pe.createElement(i3,{isRoot:!0}),Sd))),L_=!0)},[n])}function h7(n,t,r,l,u){let d,p,b,i,E;return typeof n=="string"?(p=n,d=t,Array.isArray(r)?E=r:r&&("store"in r?(i=r,E=l):(b=r,Array.isArray(l)?E=l:(i=l,E=u)))):(d=n,Array.isArray(t)?E=t:(i=t,E=r)),{schema:d,folderName:p,folderSettings:b,hookSettings:i,deps:E||[]}}function bp(n,t,r,l,u){const{folderName:d,schema:p,folderSettings:b,hookSettings:i,deps:E}=h7(n,t,r,l,u),T=typeof p=="function",A=k.useRef(!1),I=k.useRef(!0),O=XI(()=>{A.current=!0;const Ne=typeof p=="function"?p():p;return d?{[d]:Ud(Ne,b)}:Ne},E),z=!(i!=null&&i.store);u7(z);const[U]=k.useState(()=>(i==null?void 0:i.store)||e3),[N,V]=k.useMemo(()=>U.getDataFromSchema(O),[U,O]),[X,J,te,ue,ae]=k.useMemo(()=>{const Ne=[],ht=[],_t={},Bt={},Kt={};return Object.values(V).forEach(({path:Gt,onChange:hn,onEditStart:wt,onEditEnd:bt,transient:$t})=>{Ne.push(Gt),hn?(_t[Gt]=hn,$t||ht.push(Gt)):ht.push(Gt),wt&&(Bt[Gt]=wt),bt&&(Kt[Gt]=bt)}),[Ne,ht,_t,Bt,Kt]},[V]),be=k.useMemo(()=>U.orderPaths(X),[X,U]),Ce=UU(U,J,N),je=k.useCallback(Ne=>{const ht=Object.entries(Ne).reduce((_t,[Bt,Kt])=>Object.assign(_t,{[V[Bt].path]:Kt}),{});U.set(ht,!1)},[U,V]),me=k.useCallback(Ne=>U.get(V[Ne].path),[U,V]);return k.useEffect(()=>{const Ne=!I.current&&A.current;return U.addData(N,Ne),I.current=!1,A.current=!1,()=>U.disposePaths(be)},[U,be,N]),k.useEffect(()=>{const Ne=[];return Object.entries(te).forEach(([ht,_t])=>{_t(U.get(ht),ht,tr({initial:!0,get:U.get},U.getInput(ht)));const Bt=U.useStore.subscribe(Kt=>{const Gt=Kt.data[ht];return[Gt.disabled?void 0:Gt.value,Gt]},([Kt,Gt])=>_t(Kt,ht,tr({initial:!1,get:U.get},Gt)),{equalityFn:X_});Ne.push(Bt)}),()=>Ne.forEach(ht=>ht())},[U,te]),k.useEffect(()=>{const Ne=[];return Object.entries(ue).forEach(([ht,_t])=>Ne.push(U.subscribeToEditStart(ht,_t))),Object.entries(ae).forEach(([ht,_t])=>Ne.push(U.subscribeToEditEnd(ht,_t))),()=>Ne.forEach(ht=>ht())},[ue,ae,U]),T?[Ce,je,me]:Ce}ph(jc.SELECT,p8);ph(jc.IMAGE,vN);ph(jc.NUMBER,i8);ph(jc.COLOR,JU);ph(jc.STRING,E8);ph(jc.BOOLEAN,P8);ph(jc.INTERVAL,MN);ph(jc.VECTOR3D,QU);ph(jc.VECTOR2D,aN);const d7=n=>{if(!n.asset)return null;const t=Object.keys(n.asset??[]).find(r=>r.endsWith("Url"));return n.asset[t]},o3=n=>{var r;if(((r=n.name)==null?void 0:r.length)>0)return n.name;const t=d7(n);return t?t.split("/").pop().split(".")[0]:`unknown-${n.asset.constructor.name}`},f7=n=>{if(!n)return null;const t=(r,l)=>{var u;if(((u=r.children)==null?void 0:u.length)>0){const d=r.name.charAt(0).toUpperCase()+r.name.slice(1),p=r.children.map(b=>t(b));return{[d]:Ud({[r.name]:{value:r.visible,label:r.name},...p.reduce((b,i)=>({...b,...i}),{})})}}return{[r.name]:r.visible}};return n.children.map(r=>t(r)).reduce((r,l)=>({...r,...l}),{})},p7=(n,t)=>{let r;if(Array.isArray(n.urls)){const l=n.urls.find(u=>u.field===t);r=(l==null?void 0:l.url)??n.urls[0].url}else r=n.urls[t];return r},m7=n=>n.replace(/(\/[^/]*\.fo3d$|\\[^\\]*\.fo3d$)/,"/"),Iu=(n,t)=>n.startsWith("s3://")||n.startsWith("gcp://")||n.startsWith("http://")||n.startsWith("https://")||n.startsWith("/")||n.startsWith("data:")?n:t+n,g7=n=>{const{_type:t,...r}=n;if(r.transparent=r.opacity<1,r.side=x1,n._type==="MeshBasicMaterial")return new Uf(r);if(n._type==="MeshStandardMaterial"){const{emissiveColor:l,...u}=r;return new km({...u,emissive:l})}else if(n._type==="MeshLambertMaterial"){const{emissiveColor:l,...u}=r;return new kT({...u,emissive:l})}else if(n._type==="MeshPhongMaterial"){const{emissiveColor:l,specularColor:u,...d}=r;return new Xf({specular:u,emissive:l,...d})}else{if(n._type==="MeshDepthMaterial")return new AR(r);if(n._type==="PointCloudMaterial")return new Cd(r);throw new Error("Unknown material "+JSON.stringify(n,null,2))}},_7=n=>n!=null&&n.length?(n instanceof Tt&&(n=n.toArray()),n[0]===1&&n[1]===0&&n[2]===0?"X":n[0]===0&&n[1]===1&&n[2]===0?"Y":n[0]===0&&n[1]===0&&n[2]===1?"Z":null):null,ny=(n,t)=>{const r=new URL(decodeURIComponent(t)),l=r.searchParams;if(ER(n)!==CR.URL&&l.has("filepath")){const E=l.get("filepath").replace(/[^/]*$/,"");return`${r.origin}${r.pathname}?filepath=${E}`}const p=r.pathname.replace(/[^/]*$/,"");return`${n.slice(0,n.lastIndexOf(p))}${p}`},y7=()=>k.useCallback(async(t,r)=>await hp()("GET",t),[]);class s3{constructor(t,r,l,u){this.width=t,this.height=r,this.depth=l,this.defaultMaterial=u}}class a3{constructor(t,r,l,u,d,p,b,i,E){this.radiusTop=t,this.radiusBottom=r,this.height=l,this.radialSegments=u,this.heightSegments=d,this.openEnded=p,this.thetaStart=b,this.thetaLength=i,this.defaultMaterial=E}}class l3{constructor(t,r,l){this.width=t,this.height=r,this.defaultMaterial=l}}class c3{constructor(t,r,l,u,d,p,b,i){this.radius=t,this.widthSegments=r,this.heightSegments=l,this.phiStart=u,this.phiLength=d,this.thetaStart=p,this.thetaLength=b,this.defaultMaterial=i}}class u3{constructor(t,r,l){this.fbxPath=t,this.preTransformedFbxPath=r,this.defaultMaterial=l}}class h3{constructor(t,r,l){this.gltfPath=t,this.preTransformedGltfPath=r,this.defaultMaterial=l}}class d3{constructor(t,r,l,u,d){this.objPath=t,this.mtlPath=r,this.preTransformedObjPath=l,this.preTransformedMtlPath=u,this.defaultMaterial=d}}class f3{constructor(t,r,l){this.pcdPath=t,this.preTransformedPcdPath=r,this.defaultMaterial=l}}class p3{constructor(t,r,l,u){this.plyPath=t,this.preTransformedPlyPath=r,this.defaultMaterial=l,this.isPcd=u}}class m3{constructor(t,r,l){this.stlPath=t,this.preTransformedStlPath=r,this.defaultMaterial=l}}const v7=(n,t,r)=>{const[l,u]=k.useState(!0),[d,p]=k.useState(null),b=ah(HT),i=y7();k.useEffect(()=>{i(n,t).then(T=>{p(T),u(!1)})},[n,t,i]),k.useEffect(()=>{if(!d)return;const T=A=>{for(const I in A)I.startsWith("preTransformed")&&delete A[I];A.children&&A.children.forEach(T)};T(d),b(d)},[d]);const E=k.useMemo(()=>{var I,O;if(!d)return null;const T=z=>{var V;let U;const N=z.defaultMaterial;return z._type.toLocaleLowerCase().endsWith("mesh")?z._type.toLocaleLowerCase().startsWith("fbx")?z.fbxPath&&(U=new u3(z.fbxPath,z.preTransformedFbxPath,N)):z._type.toLocaleLowerCase().startsWith("gltf")?z.gltfPath&&(U=new h3(z.gltfPath,z.preTransformedGltfPath,N)):z._type.toLocaleLowerCase().startsWith("obj")?z.objPath&&(U=new d3(z.objPath,z.mtlPath,z.preTransformedObjPath,z.preTransformedMtlPath,N)):z._type.toLocaleLowerCase().startsWith("stl")?z.stlPath&&(U=new m3(z.stlPath,z.preTransformedStlPath,N)):z._type.toLocaleLowerCase().startsWith("ply")&&z.plyPath&&(U=new p3(z.plyPath,z.preTransformedPlyPath,N,z.isPointCloud??!1)):z._type.endsWith("PointCloud")?z.pcdPath&&(U=new f3(z.pcdPath,z.preTransformedPcdPath,N)):z._type.endsWith("Geometry")&&(z._type.startsWith("Box")?U=new s3(z.width,z.height,z.depth,N):z._type.startsWith("Cylinder")?U=new a3(z.radiusTop,z.radiusBottom,z.height,z.radialSegments,z.heightSegments,z.openEnded,z.thetaStart,z.thetaLength,N):z._type.endsWith("PlaneGeometry")?U=new l3(z.width,z.height,N):z._type.endsWith("SphereGeometry")&&(U=new c3(z.radius,z.widthSegments,z.heightSegments,z.phiStart,z.phiLength,z.thetaStart,z.thetaLength,N))),{asset:U,name:z.name,visible:z.visible,position:new Tt(z.position[0],z.position[1],z.position[2]),quaternion:new kl(z.quaternion[0],z.quaternion[1],z.quaternion[2],z.quaternion[3]),scale:new Tt(z.scale[0],z.scale[1],z.scale[2]),children:((V=z.children)==null?void 0:V.length)>0?z.children.map(T):null}};return(I=d.background)!=null&&I.image&&(d.background.image=Iu(d.background.image,r)),(O=d.background)!=null&&O.cube&&(d.background.cube=d.background.cube.map(z=>Iu(z,r))),{cameraProps:d.camera,lights:d.lights,background:d.background,position:new Tt(d.position[0],d.position[1],d.position[2]),quaternion:new kl(d.quaternion[0],d.quaternion[1],d.quaternion[2],d.quaternion[3]),scale:new Tt(d.scale[0],d.scale[1],d.scale[2]),children:d.children.map(T)}},[d,r]);return l?{foScene:null,isLoading:l}:{foScene:E,isLoading:!1}},xA="keydown",Au=(n,t,r=[],l=!0)=>{const u=l?TR(p=>()=>t(p),r):m1(p=>()=>t(p),r),d=k.useCallback(p=>{!(p.target.tagName.toLowerCase()==="input")&&p.code===n&&u()},[u,n]);k.useEffect(()=>(window.addEventListener(xA,d),()=>{window.removeEventListener(xA,d)}),[d])},x7=()=>{const n=k.useRef(()=>!0),t=SR(MR(!0));return t.state==="hasValue"&&(n.current=t.contents),n.current},g3="All loading complete!",b7=()=>{const n=sn(z_),[t,r]=Pi(W_(n));_m.onStart=l=>{const u="Started loading file: "+l;r([...t,{message:u,status:"info"}])},_m.onLoad=()=>{const l=g3;r([...t,{message:l,status:"success"}])},_m.onProgress=(l,u,d)=>{const p=`Loading file: ${l}. Loaded ${u} of ${d} files.`;r([...t,{message:p,status:"info"}])},_m.onError=l=>{const u="There was an error loading "+l;r([...t,{message:u,status:"error"}])}};qf.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Zo(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};o_.line={uniforms:Sm.merge([qf.common,qf.fog,qf.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class wp extends w1{constructor(t){super({type:"LineMaterial",uniforms:Sm.clone(o_.line.uniforms),vertexShader:o_.line.vertexShader,fragmentShader:o_.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(t===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),t===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const bA=new dh,e_=new Tt;class ry extends zT{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],r=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],l=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(l),this.setAttribute("position",new Ti(t,3)),this.setAttribute("uv",new Ti(r,2))}applyMatrix4(t){const r=this.attributes.instanceStart,l=this.attributes.instanceEnd;return r!==void 0&&(r.applyMatrix4(t),l.applyMatrix4(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let r;t instanceof Float32Array?r=t:Array.isArray(t)&&(r=new Float32Array(t));const l=new np(r,6,1);return this.setAttribute("instanceStart",new zl(l,3,0)),this.setAttribute("instanceEnd",new zl(l,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let r;t instanceof Float32Array?r=t:Array.isArray(t)&&(r=new Float32Array(t));const l=new np(r,6,1);return this.setAttribute("instanceColorStart",new zl(l,3,0)),this.setAttribute("instanceColorEnd",new zl(l,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new FT(t.geometry)),this}fromLineSegments(t){const r=t.geometry;return this.setPositions(r.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new dh);const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;t!==void 0&&r!==void 0&&(this.boundingBox.setFromBufferAttribute(t),bA.setFromBufferAttribute(r),this.boundingBox.union(bA))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new dp),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(t!==void 0&&r!==void 0){const l=this.boundingSphere.center;this.boundingBox.getCenter(l);let u=0;for(let d=0,p=t.count;d<p;d++)e_.fromBufferAttribute(t,d),u=Math.max(u,l.distanceToSquared(e_)),e_.fromBufferAttribute(r,d),u=Math.max(u,l.distanceToSquared(e_));this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}}const ov=new za,wA=new Tt,EA=new Tt,Gs=new za,Vs=new za,bu=new za,sv=new Tt,av=new Ci,$s=new jT,CA=new Tt,t_=new dh,n_=new dp,wu=new za;let Cu,Dd;function AA(n,t,r){return wu.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),wu.multiplyScalar(1/wu.w),wu.x=Dd/r.width,wu.y=Dd/r.height,wu.applyMatrix4(n.projectionMatrixInverse),wu.multiplyScalar(1/wu.w),Math.abs(Math.max(wu.x,wu.y))}function w7(n,t){const r=n.matrixWorld,l=n.geometry,u=l.attributes.instanceStart,d=l.attributes.instanceEnd,p=Math.min(l.instanceCount,u.count);for(let b=0,i=p;b<i;b++){$s.start.fromBufferAttribute(u,b),$s.end.fromBufferAttribute(d,b),$s.applyMatrix4(r);const E=new Tt,T=new Tt;Cu.distanceSqToSegment($s.start,$s.end,T,E),T.distanceTo(E)<Dd*.5&&t.push({point:T,pointOnLine:E,distance:Cu.origin.distanceTo(T),object:n,face:null,faceIndex:b,uv:null,uv1:null})}}function E7(n,t,r){const l=t.projectionMatrix,d=n.material.resolution,p=n.matrixWorld,b=n.geometry,i=b.attributes.instanceStart,E=b.attributes.instanceEnd,T=Math.min(b.instanceCount,i.count),A=-t.near;Cu.at(1,bu),bu.w=1,bu.applyMatrix4(t.matrixWorldInverse),bu.applyMatrix4(l),bu.multiplyScalar(1/bu.w),bu.x*=d.x/2,bu.y*=d.y/2,bu.z=0,sv.copy(bu),av.multiplyMatrices(t.matrixWorldInverse,p);for(let I=0,O=T;I<O;I++){if(Gs.fromBufferAttribute(i,I),Vs.fromBufferAttribute(E,I),Gs.w=1,Vs.w=1,Gs.applyMatrix4(av),Vs.applyMatrix4(av),Gs.z>A&&Vs.z>A)continue;if(Gs.z>A){const J=Gs.z-Vs.z,te=(Gs.z-A)/J;Gs.lerp(Vs,te)}else if(Vs.z>A){const J=Vs.z-Gs.z,te=(Vs.z-A)/J;Vs.lerp(Gs,te)}Gs.applyMatrix4(l),Vs.applyMatrix4(l),Gs.multiplyScalar(1/Gs.w),Vs.multiplyScalar(1/Vs.w),Gs.x*=d.x/2,Gs.y*=d.y/2,Vs.x*=d.x/2,Vs.y*=d.y/2,$s.start.copy(Gs),$s.start.z=0,$s.end.copy(Vs),$s.end.z=0;const U=$s.closestPointToPointParameter(sv,!0);$s.at(U,CA);const N=fa.lerp(Gs.z,Vs.z,U),V=N>=-1&&N<=1,X=sv.distanceTo(CA)<Dd*.5;if(V&&X){$s.start.fromBufferAttribute(i,I),$s.end.fromBufferAttribute(E,I),$s.start.applyMatrix4(p),$s.end.applyMatrix4(p);const J=new Tt,te=new Tt;Cu.distanceSqToSegment($s.start,$s.end,te,J),r.push({point:te,pointOnLine:J,distance:Cu.origin.distanceTo(te),object:n,face:null,faceIndex:I,uv:null,uv1:null})}}}class _3 extends Oa{constructor(t=new ry,r=new wp({color:Math.random()*16777215})){super(t,r),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,r=t.attributes.instanceStart,l=t.attributes.instanceEnd,u=new Float32Array(2*r.count);for(let p=0,b=0,i=r.count;p<i;p++,b+=2)wA.fromBufferAttribute(r,p),EA.fromBufferAttribute(l,p),u[b]=b===0?0:u[b-1],u[b+1]=u[b]+wA.distanceTo(EA);const d=new np(u,2,1);return t.setAttribute("instanceDistanceStart",new zl(d,1,0)),t.setAttribute("instanceDistanceEnd",new zl(d,1,1)),this}raycast(t,r){const l=this.material.worldUnits,u=t.camera;u===null&&!l&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const d=t.params.Line2!==void 0&&t.params.Line2.threshold||0;Cu=t.ray;const p=this.matrixWorld,b=this.geometry,i=this.material;Dd=i.linewidth+d,b.boundingSphere===null&&b.computeBoundingSphere(),n_.copy(b.boundingSphere).applyMatrix4(p);let E;if(l)E=Dd*.5;else{const A=Math.max(u.near,n_.distanceToPoint(Cu.origin));E=AA(u,A,i.resolution)}if(n_.radius+=E,Cu.intersectsSphere(n_)===!1)return;b.boundingBox===null&&b.computeBoundingBox(),t_.copy(b.boundingBox).applyMatrix4(p);let T;if(l)T=Dd*.5;else{const A=Math.max(u.near,t_.distanceToPoint(Cu.origin));T=AA(u,A,i.resolution)}t_.expandByScalar(T),Cu.intersectsBox(t_)!==!1&&(l?w7(this,r):E7(this,u,r))}onBeforeRender(t){const r=this.material.uniforms;r&&r.resolution&&(t.getViewport(ov),this.material.uniforms.resolution.value.set(ov.z,ov.w))}}jm({LineSegments2:_3,LineMaterial:wp,LineSegmentsGeometry:ry});const C7=({itemRotation:n,dimensions:t,opacity:r,rotation:l,location:u,selected:d,onClick:p,tooltip:b,label:i,color:E,useLegacyCoordinates:T})=>{const A=sn(PS),I=k.useMemo(()=>t&&new WT(...t),[t]),O=k.useMemo(()=>{const[ae,be,Ce]=u;return T?new Tt(ae,be-.5*t[1],Ce):new Tt(ae,be,Ce)},[u,t,T]),z=k.useMemo(()=>new Tt(...n),[n]),U=k.useMemo(()=>new Tt(...l),[l]),N=k.useMemo(()=>U.add(z).toArray(),[U,z]),[V,X]=k.useState(!1);nM(V);const J=k.useMemo(()=>new IR(I),[I]),te=k.useMemo(()=>new ry().fromLineSegments(new d_(J)),[J]),ue=k.useMemo(()=>new wp({opacity:r,transparent:!1,color:d?"orange":E,linewidth:A}),[d,A,E,r]);return!u||!t?null:Q.jsxs("group",{onPointerOver:()=>X(!0),onPointerOut:()=>{X(!1)},children:[Q.jsx("mesh",{position:O,rotation:N,children:Q.jsx("lineSegments2",{geometry:te,material:ue})}),Q.jsxs("mesh",{onClick:p,...b.getMeshProps(i),position:O,rotation:N,children:[Q.jsx("boxGeometry",{args:t}),Q.jsx("meshBasicMaterial",{transparent:!0,opacity:r*.5,color:d?"orange":E})]})]})},A7=["Detection","Polyline"],T7=["Detections","Polylines"],y3=(n,t,r,l=[],u,d=[])=>{let p=[];const b=Array.isArray(t)?null:Object.keys(t),i=Array.isArray(t)?t:Object.values(t);for(let E=0;E<i.length;E++){const T=i[E],A=b?b[E]:"";if(!T)continue;const I=[...l,A].filter(z=>!!z).join("."),O=PR([I,...d].join("."),u);A7.includes(O)?p.push({...T,sampleId:n,path:I,selected:T._id in r,type:O}):T7.includes(O)&&T[f0[O]]&&(p=[...p,...y3(n,T[f0[O]],r,[...l,A],u,[f0[O]])])}return p},S7=(n,t,r=[],l)=>{var d;const u=[];for(const[p,b]of Object.entries(n)){if(!((d=b==null?void 0:b.sample)!=null&&d._id))return;u.push(y3(b.sample._id,b.sample,t,r,l))}return u.flat()};class px extends ry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const r=t.length-3,l=new Float32Array(2*r);for(let u=0;u<r;u+=3)l[2*u]=t[u],l[2*u+1]=t[u+1],l[2*u+2]=t[u+2],l[2*u+3]=t[u+3],l[2*u+4]=t[u+4],l[2*u+5]=t[u+5];return super.setPositions(l),this}setColors(t){const r=t.length-3,l=new Float32Array(2*r);for(let u=0;u<r;u+=3)l[2*u]=t[u],l[2*u+1]=t[u+1],l[2*u+2]=t[u+2],l[2*u+3]=t[u+3],l[2*u+4]=t[u+4],l[2*u+5]=t[u+5];return super.setColors(l),this}fromLine(t){const r=t.geometry;return this.setPositions(r.attributes.position.array),this}}class M7 extends _3{constructor(t=new px,r=new wp({color:Math.random()*16777215})){super(t,r),this.isLine2=!0,this.type="Line2"}}jm({Line2:M7,LineMaterial:wp,LineGeometry:px});const I7=({rotation:n,points:t,color:r,opacity:l,onClick:u,tooltip:d,label:p})=>{const b=sn(LS),i=Pe.useMemo(()=>{const I=new _l().setFromPoints(t.map(O=>new Tt(...O)));return I.rotateX(n[0]),I.rotateY(n[1]),I.rotateZ(n[2]),I},[t,n]),E=Pe.useMemo(()=>d.getMeshProps(p),[d,p]),T=Pe.useMemo(()=>new px().fromLine(new b1(i)),[i]),A=Pe.useMemo(()=>new wp({color:r,linewidth:b,opacity:l}),[r,b,l]);return Q.jsx("mesh",{onClick:u,rotation:n,...E,children:Q.jsx("line2",{geometry:T,material:A})})},P7=({opacity:n,filled:t,closed:r,rotation:l,points3d:u,color:d,selected:p,onClick:b,tooltip:i,label:E})=>{const T=k.useMemo(()=>u.map(O=>Q.jsx(I7,{rotation:l,points:O,opacity:n,color:p?"orange":d,onClick:b,tooltip:i,label:E},`polyline-${E}-${u[0][0]}`)),[u,l,n,d,p,b,i,E]),[A,I]=k.useState(!1);return nM(A),t?null:Q.jsx("group",{onPointerOver:()=>I(!0),onPointerOut:()=>I(!1),children:T})},v3=({sampleMap:n})=>{const t=sn(LR({space:BR.SPACE.SAMPLE})),{coloring:r,selectedLabelTags:l,customizeColorSetting:u,labelTagColors:d}=sn(RR({withFilter:!0,modal:!0})),p=U_("3d",X3),b=DR(),i=x7(),E=sn(gv),[T,A]=Pi(PS),[I,O]=Pi(LS),z=sn(ZT),U=OR(),N=E.opacity,V={cuboidLineWidget:{value:T,min:0,max:20,step:1,label:"Cuboid Line Width",onChange:Ce=>{A(Ce)}},polylineLineWidget:{value:I,min:0,max:20,step:1,label:"Polyline Line Width",onChange:Ce=>{O(Ce)}}};bp(()=>({Labels:Ud(V,{order:FR,collapsed:!0})}),[A,O]);const X=k.useCallback(Ce=>{b({detail:{id:Ce._id,field:Ce.path,sampleId:Ce.sampleId}})},[b]),[J,te]=k.useMemo(()=>[Av(f_.get(p,"overlay.rotation",[0,0,0])),Av(f_.get(p,"overlay.itemRotation",[0,0,0]))],[p]),ue=k.useMemo(()=>S7(n,z,[],t).map(Ce=>{const je=Ce.path,me=kR(l,Ce.tags),Ne=zR({coloring:r,path:je,isTagged:me,labelTagColors:d,customizeColorSetting:u,label:Ce,embeddedDocType:Ce._cls});return{...Ce,color:Ne,id:Ce._id}}).filter(Ce=>i(Ce.path,Ce)),[r,i,n,z,t,l,d,u]),[ae,be]=k.useMemo(()=>{const Ce=[],je=[];for(const me of ue)me._cls==="Detection"?Ce.push(Q.jsx(C7,{rotation:J,itemRotation:te,opacity:N,...me,onClick:()=>X(me),label:me,tooltip:U,useLegacyCoordinates:p.useLegacyCoordinates},`cuboid-${me.id??me._id}-${me.sampleId}`)):me._cls==="Polyline"&&me.points3d&&je.push(Q.jsx(P7,{rotation:J,opacity:N,...me,label:me,onClick:()=>X(me),tooltip:U},`polyline-${me._id??me.id}-${me.sampleId}`));return[Ce,je]},[ue,te,N,J,X,U,p]);return Q.jsxs("group",{children:[Q.jsx("mesh",{rotation:J,children:ae}),be]})};class x3 extends Jh{constructor(t){super(t),this.littleEndian=!0}load(t,r,l,u){const d=this,p=new Tu(d.manager);p.setPath(d.path),p.setResponseType("arraybuffer"),p.setRequestHeader(d.requestHeader),p.setWithCredentials(d.withCredentials),p.load(t,function(b){try{r(d.parse(b))}catch(i){u?u(i):console.error(i),d.manager.itemError(t)}},l,u)}parse(t){function r(z,U){const N=z.length,V=new Uint8Array(U);let X=0,J=0,te,ue,ae;do if(te=z[X++],te<32){if(te++,J+te>U)throw new Error("Output buffer is not large enough");if(X+te>N)throw new Error("Invalid compressed data");do V[J++]=z[X++];while(--te)}else{if(ue=te>>5,ae=J-((te&31)<<8)-1,X>=N)throw new Error("Invalid compressed data");if(ue===7&&(ue+=z[X++],X>=N))throw new Error("Invalid compressed data");if(ae-=z[X++],J+ue+2>U)throw new Error("Output buffer is not large enough");if(ae<0)throw new Error("Invalid compressed data");if(ae>=J)throw new Error("Invalid compressed data");do V[J++]=V[ae++];while(--ue+2)}while(X<N);return V}function l(z){const U={},N=z.search(/[\r\n]DATA\s(\S*)\s/i),V=/[\r\n]DATA\s(\S*)\s/i.exec(z.slice(N-1));if(U.data=V[1],U.headerLen=V[0].length+N,U.str=z.slice(0,U.headerLen),U.str=U.str.replace(/#.*/gi,""),U.version=/VERSION (.*)/i.exec(U.str),U.fields=/FIELDS (.*)/i.exec(U.str),U.size=/SIZE (.*)/i.exec(U.str),U.type=/TYPE (.*)/i.exec(U.str),U.count=/COUNT (.*)/i.exec(U.str),U.width=/WIDTH (.*)/i.exec(U.str),U.height=/HEIGHT (.*)/i.exec(U.str),U.viewpoint=/VIEWPOINT (.*)/i.exec(U.str),U.points=/POINTS (.*)/i.exec(U.str),U.version!==null&&(U.version=parseFloat(U.version[1])),U.fields=U.fields!==null?U.fields[1].split(" "):[],U.type!==null&&(U.type=U.type[1].split(" ")),U.width!==null&&(U.width=parseInt(U.width[1])),U.height!==null&&(U.height=parseInt(U.height[1])),U.viewpoint!==null&&(U.viewpoint=U.viewpoint[1]),U.points!==null&&(U.points=parseInt(U.points[1],10)),U.points===null&&(U.points=U.width*U.height),U.size!==null&&(U.size=U.size[1].split(" ").map(function(J){return parseInt(J,10)})),U.count!==null)U.count=U.count[1].split(" ").map(function(J){return parseInt(J,10)});else{U.count=[];for(let J=0,te=U.fields.length;J<te;J++)U.count.push(1)}U.offset={};let X=0;for(let J=0,te=U.fields.length;J<te;J++)U.data==="ascii"?U.offset[U.fields[J]]=J:(U.offset[U.fields[J]]=X,X+=U.size[J]*U.count[J]);return U.rowSize=X,U}const u=new TextDecoder().decode(t),d=l(u),p=[],b=[],i=[],E=[],T=[],A=new Ai;if(d.data==="ascii"){const z=d.offset,N=u.slice(d.headerLen).split(`
`);for(let V=0,X=N.length;V<X;V++){if(N[V]==="")continue;const J=N[V].split(" ");if(z.x!==void 0&&(p.push(parseFloat(J[z.x])),p.push(parseFloat(J[z.y])),p.push(parseFloat(J[z.z]))),z.rgb!==void 0){const te=d.fields.findIndex(Ne=>Ne==="rgb"),ue=d.type[te],ae=parseFloat(J[z.rgb]);let be=ae;if(ue==="F"){const Ne=new Float32Array(1);Ne[0]=ae,be=new Int32Array(Ne.buffer)[0]}const Ce=(be>>16&255)/255,je=(be>>8&255)/255,me=(be>>0&255)/255;A.set(Ce,je,me).convertSRGBToLinear(),i.push(A.r,A.g,A.b)}z.normal_x!==void 0&&(b.push(parseFloat(J[z.normal_x])),b.push(parseFloat(J[z.normal_y])),b.push(parseFloat(J[z.normal_z]))),z.intensity!==void 0&&E.push(parseFloat(J[z.intensity])),z.label!==void 0&&T.push(parseInt(J[z.label]))}}if(d.data==="binary_compressed"){const z=new Uint32Array(t.slice(d.headerLen,d.headerLen+8)),U=z[0],N=z[1],V=r(new Uint8Array(t,d.headerLen+8,U),N),X=new DataView(V.buffer),J=d.offset;for(let te=0;te<d.points;te++){if(J.x!==void 0){const ue=d.fields.indexOf("x"),ae=d.fields.indexOf("y"),be=d.fields.indexOf("z");p.push(X.getFloat32(d.points*J.x+d.size[ue]*te,this.littleEndian)),p.push(X.getFloat32(d.points*J.y+d.size[ae]*te,this.littleEndian)),p.push(X.getFloat32(d.points*J.z+d.size[be]*te,this.littleEndian))}if(J.rgb!==void 0){const ue=d.fields.indexOf("rgb"),ae=X.getUint8(d.points*J.rgb+d.size[ue]*te+2)/255,be=X.getUint8(d.points*J.rgb+d.size[ue]*te+1)/255,Ce=X.getUint8(d.points*J.rgb+d.size[ue]*te+0)/255;A.set(ae,be,Ce).convertSRGBToLinear(),i.push(A.r,A.g,A.b)}if(J.normal_x!==void 0){const ue=d.fields.indexOf("normal_x"),ae=d.fields.indexOf("normal_y"),be=d.fields.indexOf("normal_z");b.push(X.getFloat32(d.points*J.normal_x+d.size[ue]*te,this.littleEndian)),b.push(X.getFloat32(d.points*J.normal_y+d.size[ae]*te,this.littleEndian)),b.push(X.getFloat32(d.points*J.normal_z+d.size[be]*te,this.littleEndian))}if(J.intensity!==void 0){const ue=d.fields.indexOf("intensity");E.push(X.getFloat32(d.points*J.intensity+d.size[ue]*te,this.littleEndian))}if(J.label!==void 0){const ue=d.fields.indexOf("label");T.push(X.getInt32(d.points*J.label+d.size[ue]*te,this.littleEndian))}}}if(d.data==="binary"){const z=new DataView(t,d.headerLen),U=d.offset;for(let N=0,V=0;N<d.points;N++,V+=d.rowSize){if(U.x!==void 0&&(p.push(z.getFloat32(V+U.x,this.littleEndian)),p.push(z.getFloat32(V+U.y,this.littleEndian)),p.push(z.getFloat32(V+U.z,this.littleEndian))),U.rgb!==void 0){const X=z.getUint8(V+U.rgb+2)/255,J=z.getUint8(V+U.rgb+1)/255,te=z.getUint8(V+U.rgb+0)/255;A.set(X,J,te).convertSRGBToLinear(),i.push(A.r,A.g,A.b)}U.normal_x!==void 0&&(b.push(z.getFloat32(V+U.normal_x,this.littleEndian)),b.push(z.getFloat32(V+U.normal_y,this.littleEndian)),b.push(z.getFloat32(V+U.normal_z,this.littleEndian))),U.intensity!==void 0&&E.push(z.getFloat32(V+U.intensity,this.littleEndian)),U.label!==void 0&&T.push(z.getInt32(V+U.label,this.littleEndian))}}const I=new _l;p.length>0&&I.setAttribute("position",new Ti(p,3)),b.length>0&&I.setAttribute("normal",new Ti(b,3)),i.length>0&&I.setAttribute("color",new Ti(i,3)),E.length>0&&I.setAttribute("intensity",new Ti(E,1)),T.length>0&&I.setAttribute("label",new jR(T,1)),I.computeBoundingSphere();const O=new Cd({size:.005});return i.length>0&&(O.vertexColors=!0),new Id(I,O)}}const b3=n=>{const t=k.useCallback(r=>{const u=document.createElement("canvas");u.width=512,u.height=512;const d=u.getContext("2d");d.rect(0,0,512,512);const p=d.createLinearGradient(0,0,0,512);for(const b of r)p.addColorStop(...b);return d.fillStyle=p,d.fill(),u},[]);return Pe.useMemo(()=>new UT(t(n)),[n,t])},TA={vertexShader:`
  // this uniform is used to pass the point size to the vertex shader from JS
  uniform float pointSize;

  // this uniform is used to indicate whether the point size should be attenuated based on distance from camera
  uniform bool isPointSizeAttenuated;

  // these attributes are injected into the vertex shader based on geometry
  attribute vec3 color;

  // this attribute is used to pass the color to the fragment shader
  varying vec3 vColor;

  void main() {
    // assign color to the varying variable so that it can be used in fragment shader
    vColor = color;

    // do a model-view transform to get the position of the point in camera space
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    // (1.0 / length(mvPosition.xyz)) is used to scale the point size based on distance from camera
    gl_PointSize = pointSize * (isPointSizeAttenuated ? (1.0 / length(mvPosition.xyz)) : 1.0);

    // do a projection transform to get the position of the point in clip space
    gl_Position = projectionMatrix * mvPosition;
  }

  `,fragmentShader:`
  varying vec3 vColor;
  
  // this uniform is used to pass the opacity
  uniform float opacity;

  void main() {
    gl_FragColor = vec4(vColor, opacity);
  } 
  `},SA={vertexShader:`
  uniform float max;
  uniform float min;
  uniform vec3 upVector;
  uniform float pointSize;
  uniform bool isPointSizeAttenuated;

  varying vec2 vUv;
  varying float hValue;

  float remap(float minval, float maxval, float curval) {
    return (curval - minval) / (maxval - minval);
  }

  void main() {
    vUv = uv;
    vec3 pos = position;
    float projectedHeight = dot(pos, upVector);
    hValue = remap(min, max, projectedHeight);

    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);

    gl_PointSize = pointSize * (isPointSizeAttenuated ? (1.0 / length(mvPosition.xyz)) : 1.0);
    gl_Position = projectionMatrix * mvPosition;
  }`,fragmentShader:`
  uniform sampler2D gradientMap;
  varying float hValue;

  uniform float opacity;

  void main() {
    float v = clamp(hValue, 0., 1.);
    vec3 col = texture2D(gradientMap, vec2(0, v)).rgb;
    gl_FragColor = vec4(col, opacity);
  }`},MA={vertexShader:`
  uniform float max;
  uniform float min;
  uniform float pointSize;
  uniform bool isPointSizeAttenuated;

  varying vec2 vUv;
  varying float hValue;
  attribute vec3 color;

  float remap ( float minval, float maxval, float curval ) {
    return ( curval - minval ) / ( maxval - minval );
  }

  void main() {
    vUv = uv;
    vec3 pos = position;
    hValue = remap(min, max, color.r);

    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);

    gl_PointSize = pointSize * (isPointSizeAttenuated ? (1.0 / length(mvPosition.xyz)) : 1.0);
    gl_Position = projectionMatrix * mvPosition;
  }
`,fragmentShader:`
  uniform sampler2D gradientMap;
  varying float hValue;

  uniform float opacity;

  void main() {
    float v = clamp(hValue, 0., 1.);
    vec3 col = texture2D(gradientMap, vec2(0, v)).rgb;
    gl_FragColor = vec4(col, opacity);
  }
`},IA={vertexShader:`
  uniform float pointSize;
  uniform bool isPointSizeAttenuated;
  uniform vec3 color;

  // vColor will be assigned to color for frgament shader
  varying vec3 vColor;

  void main() {
    vColor = color;

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_PointSize = pointSize * (isPointSizeAttenuated ? (1.0 / length(mvPosition.xyz)) : 1.0);    gl_Position = projectionMatrix * mvPosition;
    gl_Position = projectionMatrix * mvPosition;
  }
`,fragmentShader:`
  varying vec3 vColor;

  uniform float opacity;

  void main() {
    gl_FragColor = vec4(vColor, opacity);
  }
`},w3=({gradients:n,min:t,max:r,upVector:l,pointSize:u,opacity:d,isPointSizeAttenuated:p})=>{const b=b3(n),i=k.useMemo(()=>[l.x,l.y,l.z],[l]);return Q.jsx("shaderMaterial",{uniforms:{opacity:{value:d??1},min:{value:t},max:{value:r},upVector:{value:i},gradientMap:{value:b},pointSize:{value:u},isPointSizeAttenuated:{value:p}},vertexShader:SA.vertexShader,fragmentShader:SA.fragmentShader})},E3=({gradients:n,min:t,max:r,opacity:l,pointSize:u,isPointSizeAttenuated:d})=>{const p=b3(n);return Q.jsx("shaderMaterial",{uniforms:{min:{value:t},max:{value:r},opacity:{value:l??1},gradientMap:{value:p},pointSize:{value:u},isPointSizeAttenuated:{value:d}},vertexShader:MA.vertexShader,fragmentShader:MA.fragmentShader})},C3=({pointSize:n,isPointSizeAttenuated:t,opacity:r})=>Q.jsx("shaderMaterial",{scale:{value:1},uniforms:{pointSize:{value:n},isPointSizeAttenuated:{value:t},opacity:{value:r??1}},vertexShader:TA.vertexShader,fragmentShader:TA.fragmentShader}),A3=({pointSize:n,isPointSizeAttenuated:t,color:r,opacity:l})=>{const u=k.useMemo(()=>{const d=new Ai(r);return[d.r,d.g,d.b]},[r]);return Q.jsx("shaderMaterial",{scale:{value:1},uniforms:{pointSize:{value:n},isPointSizeAttenuated:{value:t},color:{value:u},opacity:{value:l??1}},vertexShader:IA.vertexShader,fragmentShader:IA.fragmentShader})},L7=({defaultShadingColor:n,isPointSizeAttenuated:t,upVector:r,minZ:l,shadeBy:u,customColor:d,pointSize:p,src:b,rotation:i,onLoad:E})=>{const T=ka(x3,b),[A,I]=k.useState({min:0,max:1}),O=T.geometry,z=k.useMemo(()=>(O.computeBoundingBox(),O.boundingBox),[O]);k.useEffect(()=>{if(!z)return;E(z);const X=O.getAttribute("color");X&&I(XT(X))},[z,O,T,E]);const U=k.useMemo(()=>r?z.max.dot(r):null,[z,r]),N=k.useMemo(()=>r?l||z.min.dot(r):null,[z,r,l]),V=k.useMemo(()=>{const X=Number(p);switch(u){case Md:return Q.jsx(w3,{upVector:r,gradients:m_,min:N,max:U,pointSize:X,isPointSizeAttenuated:t});case p_:return Q.jsx(E3,{...A,gradients:m_,pointSize:X,isPointSizeAttenuated:t});case E1:return Q.jsx(C3,{pointSize:X,isPointSizeAttenuated:t});case Mm:return Q.jsx(A3,{pointSize:X,isPointSizeAttenuated:t,color:d});default:return Q.jsx("pointsMaterial",{color:n,size:t?X/1e3:X/2,sizeAttenuation:t})}},[A,u,l,p,z,n,t,d]);return Q.jsx("primitive",{scale:1,object:T,rotation:i,children:V},`${p}-${u}-${t}-${d}`)},PA="#00ff00",LA="sample3d-canvas-wrapper",B7=()=>{const n=U_("3d",X3),t=Pe.useRef(),r=Pe.useRef(),[l,u]=Pe.useState(),d=sn(qT),p=sn(KT(!0)),b=sn(C1);k.useLayoutEffect(()=>{var me;const je=document.getElementById(LA);je&&((me=je.querySelector("canvas"))==null||me.setAttribute("canvas-loaded","true"))},[]);const i=sn(xS),[E,T]=Pi(bS),A=sn(wS),I=sn(ES),O=sn(A1)==="point_cloud",z=k.useMemo(()=>n.defaultUp?new Tt(...n.defaultUp).normalize():new Tt(0,0,1),[n]);k.useEffect(()=>{Ba.DEFAULT_UP=z.clone()},[z]);const U=k.useMemo(()=>{var ht,_t,Bt;if(!l)return[1,1,20];const je=Math.max((ht=l.max)==null?void 0:ht.x,(_t=l.max)==null?void 0:_t.y,(Bt=l.max)==null?void 0:Bt.z),me=Number.isNaN(je)?20:je*2,Ne=z.multiplyScalar(me);return[Ne.x,Ne.y,Ne.z]},[l,z]),N=k.useMemo(()=>{const je=window==null?void 0:window.localStorage.getItem(CM);return(je==null?void 0:je.length)>0?JSON.parse(je):n.defaultCameraPosition?[n.defaultCameraPosition.x,n.defaultCameraPosition.y,n.defaultCameraPosition.z]:U},[U,n]),V=k.useCallback(je=>{const me=t.current,Ne=r.current;if(me&&Ne){Ne.target;const ht=me.position.clone(),_t=Ne.target.clone();switch(Ne.target.set(0,0,0),je){case"top":me.position.set(U[0],U[1],U[2]);break;case"pov":me.position.set(0,-10,1);break}return me.updateProjectionMatrix(),!(_t.equals(Ne.target)&&ht.distanceTo(me.position)<1)}},[U]);Nf(window,T1,()=>{V("top")}),Nf(window,S1,()=>{V("pov")});const X=$w.get(n,"pointCloud.rotation",[0,0,0]),J=$w.get(n,"pointCloud.minZ",null),te=k.useMemo(()=>Av(X),[X]),ue=ah(Pd);Au("KeyT",()=>V("top"),[V],!1),Au("KeyE",()=>V("pov"),[V],!1),k.useEffect(()=>{var me;const je=(me=t.current)==null?void 0:me.position;!je||je.x===N[0]&&je.y===N[1]&&je.z===N[2]||t.current.position.set(N[0],N[1],N[2])},[N]),k.useEffect(()=>{if(O)T(je=>je&&Object.hasOwn(je,"default")?je:{...je??{},default:PA});else{const je={};for(const me of d)je[me]=PA;T(me=>({...je,...me??{}}))}},[O,d,T]);const ae=fc(),be=sn(Z_),Ce=k.useMemo(()=>Object.entries(b).map(([je,me])=>{let Ne;if(Array.isArray(me.urls)){const Bt=me.urls.find(Kt=>Kt.field===p);if(Bt)Ne=Bt.url;else return null}else Ne=me.urls[p];if(!Ne)return null;const ht=uc(Ne),_t=(E==null?void 0:E[O?"default":je])??"#00ff00";return Q.jsx(L7,{minZ:J,upVector:z,shadeBy:i,customColor:_t,pointSize:A,src:ht,rotation:te,onLoad:Bt=>{l||u(Bt)},defaultShadingColor:ae.text.primary,isPointSizeAttenuated:I},je)}).filter(je=>je!==null),[b,p,i,A,te,J,ae,I,l,E,O,z]);return Ce.length===0?Q.jsx(AM,{style:{padding:"2em"},children:Q.jsxs(nh,{children:['No point-cloud samples detected for media field "',p,'"']})}):Q.jsx(Q.Fragment,{children:Q.jsxs(x_,{id:LA,onClick:()=>ue(null),children:[Q.jsx(hz,{}),Q.jsx(uz,{controlsRef:r,cameraRef:t,settings:n,isGridOn:be,bounds:l}),Q.jsx(v3,{sampleMap:b}),Ce]})})};var mx={},R7=Kh;Object.defineProperty(mx,"__esModule",{value:!0});var T3=mx.default=void 0,D7=R7(Xh()),O7=qh();T3=mx.default=(0,D7.default)((0,O7.jsx)("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"}),"Done");var gx={},k7=Kh;Object.defineProperty(gx,"__esModule",{value:!0});var S3=gx.default=void 0,z7=k7(Xh()),F7=qh();S3=gx.default=(0,z7.default)((0,F7.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 12h-2v-2h2zm0-4h-2V6h2z"}),"Feedback");const j7=Ro.div`
  width: 70%;
  margin-left: 0.25em;
  display: flex;
  align-content: center;
  overflow: hidden;
  align-items: center;
`,U7=()=>{const n=sn(z_),t=sn(W_(n)),r=k.useMemo(()=>t.filter(p=>p.status==="error"),[t]),l=k.useMemo(()=>t.length===0||t[t.length-1].status==="error"?!1:t[t.length-1].message!==g3,[t]),u=k.useMemo(()=>!t.some(p=>p.status==="error"),[t]),d=k.useMemo(()=>t.length===0?null:l?Q.jsx(UR,{size:14}):u?Q.jsx(T3,{fontSize:"small",style:{color:"green"}}):Q.jsx(S3,{fontSize:"small",style:{color:"red"}}),[t,u,l]);return t.length===0?null:Q.jsxs(j7,{children:[d,Q.jsx(nh,{variant:"caption",fontSize:10,color:"GrayText",style:{marginLeft:"0.75em"},children:l?t[t.length-1].message:u?"All assets loaded successfully!":r[r.length-1].message})]})};var _x={},N7=Kh;Object.defineProperty(_x,"__esModule",{value:!0});var M3=_x.default=void 0,G7=N7(Xh()),V7=qh();M3=_x.default=(0,G7.default)((0,V7.jsx)("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8m-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12m3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8m5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8m3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"ColorLens");const iy=k.forwardRef((n,t)=>{const{children:r}=n;return Q.jsx(pz,{ref:t,children:Q.jsx(mz,{children:r})})}),$7=()=>{const[n,t]=Pi(Pd);return Q.jsxs(Q.Fragment,{children:[Q.jsx(Lu,{title:"Shade By",children:Q.jsx(M3,{sx:{fontSize:24},color:"inherit",onClick:r=>{const l=Hw;return t(n===l?null:l),r.stopPropagation(),r.preventDefault(),!1}})}),n===Hw&&Q.jsx(H7,{})]})},H7=()=>{const[n,t]=Pi(xS),r=k.useCallback(l=>()=>{n!==l&&t(l)},[n,t]);return Q.jsxs(iy,{children:[Q.jsx(N_,{children:"Shade by"}),n===Mm&&Q.jsx(Z7,{}),Q.jsx(NR,{active:n,options:GR.map(({label:l,value:u})=>({text:u,title:`Shade by ${l}`,onClick:r(u)}))})]})},BA=Ro.div`
  margin-top: 0.5em;
  margin-right: 0.5em;
  display: flex;
  margin: 0.5em auto;
`,RA=Ro.div`
  width: 100%;
  min-height: 2rem;
  margin: 0.5em 0.5em 0.25em 0.5em;
  background-color: ${n=>n.backgroundColor};
`,W7=Ro.div`
  display: flex;
  align-items: center;
  margin-left: 0.25em;
`,Z7=()=>{const n=JT({from:{opacity:0},to:{opacity:1},config:{duration:400}}),t=sn(M1),r=sn(VR),[l,u]=Pi(bS),[d,p]=k.useState(!1),[b,i]=k.useState(""),E=k.useCallback(T=>({hex:A})=>{u(I=>({...I,[T]:A}))},[u]);if(!r||(t==null?void 0:t.length)<2){const T=(t==null?void 0:t.length)>0?(t==null?void 0:t.at(0))??r:"default";return Q.jsxs(Tv.div,{style:{display:"flex",...n},children:[Q.jsx(RA,{backgroundColor:l[T],onClick:()=>p(A=>!A)}),d&&Q.jsx(BA,{children:Q.jsx(Ww,{color:l[T],onChange:E(T),disableAlpha:!0})})]})}return Q.jsxs(Tv.div,{style:{display:"flex",flexDirection:"column",justifyItems:"center",...n},children:[(b==null?void 0:b.length)>0&&Q.jsx(BA,{children:Q.jsx(Ww,{color:l[b],onChange:E(b),disableAlpha:!0})}),t.map(T=>Q.jsxs(W7,{children:[Q.jsxs("span",{children:[T," "]}),Q.jsx(RA,{backgroundColor:l[T],onClick:()=>{i(A=>A===T?"":T)}})]},T))]})},DA=({exit:n})=>{const t=k.useRef();return k.useEffect(()=>{t&&(t.current.innerHTML="",t.current.appendChild(n?HR:WR))},[n]),Q.jsx("div",{style:{display:"flex"},ref:t})},X7=()=>{const[n,t]=Pi(s_),r=k.useCallback(()=>{t(l=>!l)},[]);return Q.jsx(Lu,{title:"Toggle Fullscreen (F)",children:Q.jsx($R,{onClick:r,sx:{fontSize:24,padding:0},children:n?Q.jsx(DA,{exit:!0}):Q.jsx(DA,{exit:!1})})})},q7="_pointSizeSliderThumb_wbc6q_1",K7="_pointSizeTextField_wbc6q_9",J7="_pointSizeSlider_wbc6q_1",Y7="_pointSizeContainer_wbc6q_31",Q7="_gridConfigContainer_wbc6q_38",e2="_gridSizeContainer_wbc6q_44",t2="_gridLabel_wbc6q_49",n2="_pointSizeBaseContainer_wbc6q_66",r2="_pointSizeAttenuationLabel_wbc6q_70",Bl={pointSizeSliderThumb:q7,pointSizeTextField:K7,pointSizeSlider:J7,pointSizeContainer:Y7,gridConfigContainer:Q7,gridSizeContainer:e2,gridLabel:t2,pointSizeBaseContainer:n2,pointSizeAttenuationLabel:r2},i2=/^([0-9]+([.][0-9]*)?|[.][0-9]+)$/,o2=()=>{const n=fc(),[t,r]=Pi(wS),[l,u]=Pi(ES),d=k.useMemo(()=>Number(t),[t]),[p,b]=k.useState(d/10),[i,E]=k.useState(()=>d===0?2:d*2),[T,A]=k.useState(!1),I=k.useMemo(()=>d===0?.01:d/10,[p,i]),O=k.useCallback((N,V)=>{r(String(V)),A(!1)},[r]),z=k.useCallback(N=>{if(!i2.test(N.target.value)){A(!0);return}A(!1);const V=N.target.value;r(V),b(Number(V)/10),Number.parseInt(V)===0?E(2):E(Number(V)*2)},[r,A]),U=k.useCallback(N=>{u(N.target.checked)},[u]);return Q.jsxs(iy,{children:[Q.jsx(N_,{children:"Set point size"}),Q.jsxs("div",{className:Bl.pointSizeBaseContainer,children:[Q.jsx(ZR,{control:Q.jsx(Sv,{checked:l,size:"small",disableFocusRipple:!0,onChange:U}),classes:{label:Bl.pointSizeAttenuationLabel},label:"Point Size Attenuation"}),Q.jsxs("div",{className:Bl.pointSizeContainer,children:[Q.jsx(XR,{className:Bl.pointSizeSlider,sx:{color:n.primary.main},classes:{thumb:Bl.pointSizeSliderThumb,dragging:Bl.pointSizeSliderThumb},value:d,min:p,step:I,max:i,onChange:O,valueLabelDisplay:"auto",valueLabelFormat:N=>`${N.toFixed(2)}`}),Q.jsx("input",{className:Bl.pointSizeTextField,value:T?"":t,onChange:z})]})]})]})},s2=()=>{const[n,t]=Pi(Pd),r=k.useCallback(l=>{const u=Zw;return t(d=>d===u?null:u),l.stopPropagation(),l.preventDefault(),!1},[t]);return Q.jsxs(Q.Fragment,{children:[Q.jsx(Lu,{title:"Set Point Size",children:Q.jsx(k1,{sx:{fontSize:24},color:"inherit",onClick:r})}),n===Zw&&Q.jsx(o2,{})]})},OA=n=>{const{onChangeView:t,view:r,label:l,hint:u}=n;return Q.jsx(Lu,{onClick:()=>t(r),children:Q.jsx(vz,{title:u,children:l})})},a2=()=>{const n=sn(M1),t=sn(qT),[r,l]=Pi(Pd),u=k.useMemo(()=>!n||n.length===0?"":n.length===1?`Showing ${n[0]}`:n.length===2?`Showing ${n.join(" and ")}`:n.length===t.length?"Showing all point clouds":`Showing ${n.length} point clouds`,[n,t]),d=k.useCallback(()=>{l(r===p0?null:p0)},[l,r]);return!n||n.length===0?null:Q.jsxs(Q.Fragment,{children:[Q.jsx(Lu,{"data-cy":"looker3d-select-slices",title:"Select point clouds",children:Q.jsx("div",{onClick:d,children:u})}),r===p0&&Q.jsx(l2,{})]})},l2=()=>{const[n,t]=Pi(M1),r=Object.keys(sn(qR)),l=k.useRef(null),[u,d]=k.useState(!1);return YT(l,()=>u&&d(!1)),r.length===0?null:Q.jsxs(iy,{children:[Q.jsx(N_,{children:"Select point clouds"}),Q.jsx("div",{"data-cy":"looker3d-slice-checkboxes",children:r.map(p=>Q.jsx(KR,{name:p,value:n.includes(p),muted:n.includes(p)&&n.length===1,setValue:b=>{t(b?[...n,p]:n.filter(i=>i!==p))}},p))})]})};var yx={},c2=Kh;Object.defineProperty(yx,"__esModule",{value:!0});var I3=yx.default=void 0,u2=c2(Xh()),h2=qh();I3=yx.default=(0,u2.default)((0,h2.jsx)("path",{d:"M4 4h7V2H4c-1.1 0-2 .9-2 2v7h2zm6 9-4 5h12l-3-4-2.03 2.71zm7-4.5c0-.83-.67-1.5-1.5-1.5S14 7.67 14 8.5s.67 1.5 1.5 1.5S17 9.33 17 8.5M20 2h-7v2h7v7h2V4c0-1.1-.9-2-2-2m0 18h-7v2h7c1.1 0 2-.9 2-2v-7h-2zM4 13H2v7c0 1.1.9 2 2 2h7v-2H4z"}),"Wallpaper");const d2=()=>{const[n,t]=Pi(G1),{primary:r}=fc();return Q.jsx(Lu,{title:"Toggle Background (B)",children:Q.jsx(I3,{sx:{fontSize:24},style:{color:n?r.main:"inherit"},onClick:l=>{t(u=>!u),l.stopPropagation(),l.preventDefault()}})})};var vx={},f2=Kh;Object.defineProperty(vx,"__esModule",{value:!0});var P3=vx.default=void 0,p2=f2(Xh()),m2=qh();P3=vx.default=(0,p2.default)((0,m2.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M8 20H4v-4h4zm0-6H4v-4h4zm0-6H4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4z"}),"GridOn");const g2=()=>{const[n,t]=k.useState(!0),r=k.useRef(null);fc();const[l,u]=Pi(CS),[d,p]=Pi(AS),[b,i]=Pi(SS),[E,T]=Pi(TS),[A,I]=Pi(MS);return n?Q.jsxs(iy,{ref:r,children:[Q.jsxs(N_,{children:[Q.jsx(nh,{children:"Configure Grid"}),Q.jsx(Mv,{onClick:()=>t(!1),children:Q.jsx(RO,{fontSize:"small"})})]}),Q.jsxs("div",{"data-cy":"looker3d-grid-configurator",className:Bl.gridConfigContainer,children:[Q.jsxs("div",{className:Bl.gridLabel,children:[Q.jsx(nh,{variant:"body2",children:"Cell Size"}),Q.jsx(m0,{value:l,setter:u,min:1,max:1e4,step:1})]}),Q.jsxs("div",{className:Bl.gridLabel,children:[Q.jsx(nh,{variant:"body2",children:"Section Size"}),Q.jsx(m0,{value:d,setter:p,min:1,max:1e5,step:1})]}),!E&&Q.jsxs("div",{className:Bl.gridLabel,children:[Q.jsx(nh,{variant:"body2",children:"Grid Size"}),Q.jsx(m0,{value:b,setter:i,min:1,max:1e5,step:1})]}),Q.jsxs("div",{className:Bl.gridLabel,children:[Q.jsx(nh,{variant:"body2",children:"Infinite Grid"}),Q.jsx(Sv,{checked:E,size:"small",disableFocusRipple:!0,onChange:O=>T(O.target.checked)})]}),Q.jsxs("div",{className:Bl.gridLabel,children:[Q.jsx(nh,{variant:"body2",children:"Fade"}),Q.jsx(Sv,{checked:A,size:"small",disableFocusRipple:!0,onChange:O=>I(O.target.checked)})]})]})]}):null},_2=()=>{const[n,t]=Pi(Z_),[r,l]=k.useState(!0),{primary:u}=fc(),d=k.useCallback(p=>{t(b=>(r&&l(!1),!b)),p.stopPropagation(),p.preventDefault()},[]);return Q.jsxs(Q.Fragment,{children:[Q.jsx(Lu,{title:"Toggle Grid (G)",children:Q.jsx(P3,{sx:{fontSize:24},style:{color:n?u.main:"inherit"},onClick:d})}),n&&!r&&Q.jsx(g2,{})]})},y2=n=>{const{jsonPanel:t}=n,r=sn(HT),[l,u]=k.useState(!1),{primary:d}=fc(),p=k.useRef(null),b=k.useCallback(i=>(u(E=>!E),t.toggle(r),i==null||i.stopPropagation(),i==null||i.preventDefault(),!1),[t,r]);return Au("KeyI",()=>(u(i=>!i),t.toggle(r),()=>{}),[t],!1),YT(p,()=>{u(!1)}),Q.jsx(Lu,{title:"Inspect FO3D (I)",children:Q.jsx(BO,{ref:p,onClick:b,"data-for-panel":QT,style:{color:l?d.main:"inherit"}})})},v2=[{shortcut:"Left drag",title:"Rotate",detail:"Rotate the camera"},{shortcut:"T",title:"Top-down",detail:"Reset camera to top-down view"},{shortcut:"Ctrl + left drag / Wheel",title:"Zoom",detail:"Zoom in and out"},{shortcut:"E",title:"Ego-view",detail:"Reset the camera to ego view"},{shortcut:"Shift + left drag / Right drag",title:"Translate",detail:"Translate the camera"},{shortcut:"B",title:"Background",detail:"Toggle background"},{shortcut:"C",title:"Controls",detail:"Toggle controls"},{shortcut:"G",title:"Grid",detail:"Toggle grid"},{shortcut:"F",title:"Full-screen",detail:"Toggle full-screen"},{shortcut:"J",title:"Json ",detail:"Toggle JSON view"},{shortcut:"I",title:"FO3D ",detail:"Toggle FO3D JSON view"},{shortcut:"?",title:"Display help",detail:"Display this help window"},{shortcut:"ESC",title:"Escape ",detail:"Escape the current context"}],x2=n=>{const{helpPanel:t}=n;return Q.jsx(Q.Fragment,{children:Q.jsx(Lu,{children:Q.jsx(JR,{sx:{fontSize:24},color:"inherit",onClick:r=>(t.toggle(v2),r.stopPropagation(),r.preventDefault(),!1),"data-for-panel":YR})})})},b2=n=>{const{sample:t,jsonPanel:r}=n;return Q.jsx(Q.Fragment,{children:Q.jsx(Lu,{children:Q.jsx(QR,{sx:{fontSize:24},color:"inherit",onClick:l=>(r.toggle(t),l.stopPropagation(),l.preventDefault(),!1),"data-for-panel":QT})})})},w2=({onMouseEnter:n,onMouseLeave:t})=>{const r=sn(eD),l=sn(A1),u=k.useMemo(()=>r||l==="three_d",[r,l]),d=sn(tD),p=sn(C1),b=sn(eS),i=k.useMemo(()=>u?b:p,[p,b,u]),E=sn(N1),T=nD(),A=rD();Au("KeyJ",()=>{T.toggle(i)},[i],!1);const I=k.useMemo(()=>{const O=[];return u&&O.push(Q.jsx(y2,{jsonPanel:T},"inspect-fo3d")),O.push(Q.jsx(_2,{},"grid-helper")),E&&O.push(Q.jsx(d2,{},"toggle-background")),u||(O.push(Q.jsx(s2,{},"set-point-size")),O.push(Q.jsx($7,{},"choose-color-space"))),O.push(Q.jsx(OA,{onChangeView:()=>{window.dispatchEvent(new CustomEvent(T1))},view:"top",label:"T",hint:"Top View (T)"},"set-top-view")),O.push(Q.jsx(OA,{onChangeView:()=>{window.dispatchEvent(new CustomEvent(S1))},view:"pov",label:"E",hint:"Ego View (E)"},"set-ego-view")),O.push(Q.jsx(b2,{jsonPanel:T,sample:i},"view-json")),O.push(Q.jsx(x2,{helpPanel:A},"view-help")),O},[E,u,T,A,i]);return Q.jsxs(dz,{"data-cy":"looker3d-action-bar",onMouseEnter:n,onMouseLeave:t,children:[d&&Q.jsx(a2,{}),Q.jsx(U7,{}),Q.jsxs(fz,{children:[I,Q.jsx(X7,{})]})]})},kA=()=>{const n=k.useRef(),t=sn(z_),r=sn(W_(t)),l=k.useMemo(()=>r.some(u=>u.status==="error"),[r]);return mc(()=>{l||(n.current.rotation.x=n.current.rotation.y+=Math.random()/30,n.current.rotation.y=n.current.rotation.y+=.007)}),l?null:Q.jsxs("group",{children:[Q.jsx("directionalLight",{position:[100,100,10]}),Q.jsx("ambientLight",{intensity:.5}),Q.jsxs("mesh",{ref:n,children:[Q.jsx("boxGeometry",{args:[.1,.1,.1]}),Q.jsx(Y4,{attach:"material",color:new Ai("#fe6d05"),speed:2,factor:.6})]})]})};var xx={},E2=Kh;Object.defineProperty(xx,"__esModule",{value:!0});var L3=xx.default=void 0,C2=E2(Xh()),A2=qh();L3=xx.default=(0,C2.default)((0,A2.jsx)("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam");var T2={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const zA=n=>{let t;const r=new Set,l=(T,A)=>{const I=typeof T=="function"?T(t):T;if(!Object.is(I,t)){const O=t;t=A??(typeof I!="object"||I===null)?I:Object.assign({},t,I),r.forEach(z=>z(t,O))}},u=()=>t,i={setState:l,getState:u,getInitialState:()=>E,subscribe:T=>(r.add(T),()=>r.delete(T)),destroy:()=>{(T2?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},E=t=n(l,u,i);return i},S2=n=>n?zA(n):zA,{useDebugValue:M2}=Pe,{useSyncExternalStoreWithSelector:I2}=NT,P2=n=>n;function L2(n,t=P2,r){const l=I2(n.subscribe,n.getState,n.getServerState||n.getInitialState,t,r);return M2(l),l}const FA=(n,t)=>{const r=S2(n),l=(u,d=t)=>L2(r,u,d);return Object.assign(l,r),l},B2=(n,t)=>n?FA(n,t):FA;function R2(n,t){if(Object.is(n,t))return!0;if(typeof n!="object"||n===null||typeof t!="object"||t===null)return!1;if(n instanceof Map&&t instanceof Map){if(n.size!==t.size)return!1;for(const[l,u]of n)if(!Object.is(u,t.get(l)))return!1;return!0}if(n instanceof Set&&t instanceof Set){if(n.size!==t.size)return!1;for(const l of n)if(!t.has(l))return!1;return!0}const r=Object.keys(n);if(r.length!==Object.keys(t).length)return!1;for(const l of r)if(!Object.prototype.hasOwnProperty.call(t,l)||!Object.is(n[l],t[l]))return!1;return!0}const bx=B2((n,t)=>{function r(){var l;const{accumulated:u,startTime:d,infos:p}=t(),b=(l=t().log)==null?void 0:l.maxMemory,{totalFrames:i,log:E,gl:T,max:A}=u,I={calls:T.calls/i,triangles:T.triangles/i,points:T.points/i,lines:T.lines/i},O={gpu:E.gpu/i,cpu:E.cpu/i,mem:E.mem/i,fps:E.fps/i};return{sessionTime:(window.performance.now()-d)/1e3,infos:p,log:O,gl:I,max:A,maxMemory:b,totalFrames:i}}return{log:null,paused:!1,triggerProgramsUpdate:0,startTime:0,customData:0,fpsLimit:60,overclockingFps:!1,accumulated:{totalFrames:0,gl:{calls:0,triangles:0,points:0,lines:0,counts:0},log:{gpu:0,cpu:0,mem:0,fps:0},max:{gl:{calls:0,triangles:0,points:0,lines:0,counts:0},log:{gpu:0,cpu:0,mem:0,fps:0}}},chart:{data:{fps:[],cpu:[],gpu:[],mem:[]},circularId:0},gl:void 0,objectWithMaterials:null,scene:void 0,programs:new Map,sceneLength:void 0,tab:"infos",getReport:r}}),dc=n=>bx(n,R2);Object.assign(dc,bx);const{getState:cc,setState:Ll}=bx,ic={value:0,fpsLimit:60,isOverLimit:0},pm=n=>(n==null?void 0:n.reduce((t,r)=>t+r,0))/n.length;class D2{constructor(t={}){this.names=[""],this.finished=[],this.paused=!1,this.overClock=!1,this.queryHasResult=!1,this.queryCreated=!1,this.isWebGL2=!0,this.memAccums=[],this.gpuAccums=[],this.activeAccums=[],this.logsAccums={mem:[],gpu:[],cpu:[],fps:[],fpsFixed:[]},this.fpsChart=[],this.gpuChart=[],this.cpuChart=[],this.memChart=[],this.paramLogger=()=>{},this.glFinish=()=>{},this.chartLogger=()=>{},this.chartLen=60,this.logsPerSecond=10,this.maxMemory=1500,this.chartHz=10,this.startCpuProfiling=!1,this.lastCalculateFixed=0,this.chartFrame=0,this.gpuTimeProcess=0,this.chartTime=0,this.activeQueries=0,this.circularId=0,this.detected=0,this.frameId=0,this.rafId=0,this.idleCbId=0,this.checkQueryId=0,this.uuid=void 0,this.currentCpu=0,this.currentMem=0,this.paramFrame=0,this.paramTime=0,this.now=()=>{},this.t0=0,window.GLPerf=window.GLPerf||{},Object.assign(this,t),this.fpsChart=new Array(this.chartLen).fill(0),this.gpuChart=new Array(this.chartLen).fill(0),this.cpuChart=new Array(this.chartLen).fill(0),this.memChart=new Array(this.chartLen).fill(0),this.now=()=>window.performance&&window.performance.now?window.performance.now():Date.now(),this.initGpu(),this.is120hz()}initGpu(){this.uuid=fa.generateUUID(),this.gl&&(this.isWebGL2=!0,this.extension||(this.extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")),this.extension===null&&(this.isWebGL2=!1))}is120hz(){let t=0;const r=l=>{++t<20?this.rafId=window.requestAnimationFrame(r):(this.detected=Math.ceil(1e3*t/(l-this.t0)/70),window.cancelAnimationFrame(this.rafId)),this.t0||(this.t0=l)};this.rafId=window.requestAnimationFrame(r)}addUI(t){this.names.indexOf(t)===-1&&(this.names.push(t),this.gpuAccums.push(0),this.activeAccums.push(!1))}nextFps(t){const r=16.666666666666668,l=r-t.timeRemaining(),u=r*ic.fpsLimit/10/l;u<0||(ic.value=u,ic.isOverLimit<25?ic.isOverLimit++:Ll({overclockingFps:!0}))}nextFrame(t){this.frameId++;const r=t||this.now();let l=r-this.paramTime,u=0;if(this.frameId<=1)this.paramFrame=this.frameId,this.paramTime=r;else if(r>=this.paramTime){this.maxMemory=window.performance.memory?window.performance.memory.jsHeapSizeLimit/1048576:0;const d=this.frameId-this.paramFrame,p=d*1e3/l,b=cc().overclockingFps?ic.value:p;if(u=this.isWebGL2?this.gpuAccums[0]:this.gpuAccums[0]/l,this.isWebGL2?this.gpuAccums[0]=0:Promise.all(this.finished).then(()=>{this.gpuAccums[0]=0,this.finished=[]}),this.currentMem=Math.round(window.performance&&window.performance.memory?window.performance.memory.usedJSHeapSize/1048576:0),window.performance&&this.startCpuProfiling){window.performance.mark("cpu-finished");const i=performance.measure("cpu-duration","cpu-started","cpu-finished");this.currentCpu=(i==null?void 0:i.duration)||0,this.logsAccums.cpu.push(this.currentCpu),this.startCpuProfiling=!1}this.logsAccums.mem.push(this.currentMem),this.logsAccums.fpsFixed.push(p),this.logsAccums.fps.push(b),this.logsAccums.gpu.push(u),this.overClock&&typeof window.requestIdleCallback<"u"&&(ic.isOverLimit>0&&b>p?ic.isOverLimit--:cc().overclockingFps&&Ll({overclockingFps:!1})),r>=this.paramTime+1e3/this.logsPerSecond&&(this.paramLogger({cpu:pm(this.logsAccums.cpu),gpu:pm(this.logsAccums.gpu),mem:pm(this.logsAccums.mem),fps:pm(this.logsAccums.fps),duration:Math.round(l),maxMemory:this.maxMemory,frameCount:d}),this.logsAccums.mem=[],this.logsAccums.fps=[],this.logsAccums.gpu=[],this.logsAccums.cpu=[],this.paramFrame=this.frameId,this.paramTime=r),this.overClock&&r-this.lastCalculateFixed>=2*1e3&&(this.lastCalculateFixed=t,ic.fpsLimit=Math.round(pm(this.logsAccums.fpsFixed)/10)*100,Ll({fpsLimit:ic.fpsLimit/10}),this.logsAccums.fpsFixed=[],this.paramFrame=this.frameId,this.paramTime=r)}if(!this.detected||!this.chartFrame)this.chartFrame=this.frameId,this.chartTime=r,this.circularId=0;else{const d=r-this.chartTime;let p=this.chartHz*d/1e3;for(;--p>0&&this.detected;){const i=(this.frameId-this.chartFrame)/d*1e3,E=cc().overclockingFps?ic.value:i;this.fpsChart[this.circularId%this.chartLen]=E;const T=1e3/this.currentMem,A=this.currentCpu,I=(this.isWebGL2?this.gpuAccums[1]*2:Math.round(this.gpuAccums[1]/l*100))+4;I>0&&(this.gpuChart[this.circularId%this.chartLen]=I),A>0&&(this.cpuChart[this.circularId%this.chartLen]=A),T>0&&(this.memChart[this.circularId%this.chartLen]=T);for(let O=0;O<this.names.length;O++)this.chartLogger({i:O,data:{fps:this.fpsChart,gpu:this.gpuChart,cpu:this.cpuChart,mem:this.memChart},circularId:this.circularId});this.circularId++,this.chartFrame=this.frameId,this.chartTime=r}}}startGpu(){const t=this.gl,r=this.extension;if(!(!t||!r)&&this.isWebGL2){let l=!1,u,d;if(this.query){this.queryHasResult=!1;let p=this.query;if(l=t.getQueryParameter(p,t.QUERY_RESULT_AVAILABLE),u=t.getParameter(r.GPU_DISJOINT_EXT),l&&!u){d=t.getQueryParameter(this.query,t.QUERY_RESULT);const b=d*1e-6;(l||u)&&(t.deleteQuery(this.query),p=null),l&&b>0&&(u||this.activeAccums.forEach((i,E)=>{this.gpuAccums[E]=b}))}}(l||!this.query)&&(this.queryCreated=!0,this.query=t.createQuery(),t.beginQuery(r.TIME_ELAPSED_EXT,this.query))}}endGpu(){const t=this.extension,r=this.gl;this.isWebGL2&&this.queryCreated&&r.getQuery(t.TIME_ELAPSED_EXT,r.CURRENT_QUERY)&&r.endQuery(t.TIME_ELAPSED_EXT)}begin(t){this.startGpu(),this.updateAccums(t)}end(t){this.endGpu(),this.updateAccums(t)}updateAccums(t){let r=this.names.indexOf(t);r===-1&&(r=this.names.length,this.addUI(t));const l=this.now();this.activeAccums[r]=!this.activeAccums[r],this.t0=l}}const O2=n=>{n.forEach((t,r)=>{const{meshes:l}=t;if(!l)return;let u={total:0,type:"Triangle",data:[]};Object.keys(l).forEach(d=>{const p=l[d],{geometry:b,material:i}=p;let E=b.index;const T=b.attributes.position;if(!T)return;let A=1;i.wireframe===!0&&(A=0);const I=E!==null?E.count:T.count,O=b.drawRange.start*A,z=b.drawRange.count*A,U=O,N=Math.min(I,O+z)-1;let V=1;const X=p.count||1;let J="Triangle",te=0;p.isMesh?i.wireframe===!0?(J="Line",V=V/2):(J="Triangle",V=V/3):p.isLine?(J="Line",p.isLineSegments?V=V/2:p.isLineLoop?V=V:V=V-1):p.isPoints?(J="Point",V=V):p.isSprite&&(J="Triangle",V=V/3);const ue=Math.round(Math.max(0,N-U+1)*(V*X));ue>te&&(te=ue,u.type=J),u.total+=ue,u.data.push({drawCount:ue,type:J}),p.userData.drawCount={type:J,count:ue}}),t.drawCounts=u})},wx=new iD;function k2(n,t,r){return wx.on(n,t)}function z2(n,t,r){var l;wx.removeListener(n,t,(l=r==null?void 0:r.context)!=null?l:null,r==null?void 0:r.once)}function F2(n,t){wx.emit(n,t)}function j2(n,t,r=[],l){const u=k.useRef(t);k.useEffect(()=>void(u.current=t),[t]),k.useEffect(()=>{const d=b=>{var i;return(i=u.current)==null?void 0:i.call(u,b)},p=k2(n,d);return()=>z2(n,d,{...l,context:p})},[n,void 0,...r])}const U2=Ba.prototype.updateMatrixWorld,N2=Ba.prototype.updateWorldMatrix,jA=Ba.prototype.updateMatrix,UA=["calls","triangles","points","lines"],NA=["gpu","cpu","mem","fps"];let Hf={value:0},Fl={value:0};const G2=n=>{let t=""+n;return t=t.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"),t!==null},GA=(n,t)=>{n.defines||(n.defines={}),n.defines&&!n.defines.muiPerf&&(n.defines=Object.assign(n.defines||{},{muiPerf:n.uuid}));const r=n.uuid;return t[r]||(t[r]={meshes:{},material:n},n.needsUpdate=!0),n.needsUpdate=!1,r},V2=n=>n==="muiPerf",$2=({overClock:n,logsPerSecond:t,chart:r,deepAnalyze:l,matrixUpdate:u})=>{const{gl:d,scene:p}=ar();Ll({gl:d,scene:p});const b=k.useMemo(()=>{const i=new D2({trackGPU:!0,overClock:n,chartLen:r?r.length:120,chartHz:r?r.hz:60,logsPerSecond:t||10,gl:d.getContext(),chartLogger:N=>{Ll({chart:N})},paramLogger:N=>{const V={maxMemory:N.maxMemory,gpu:N.gpu,cpu:N.cpu,mem:N.mem,fps:N.fps,totalTime:N.duration,frameCount:N.frameCount};Ll({log:V});const{accumulated:X}=cc(),J=d.info.render;X.totalFrames++,X.gl.calls+=J.calls,X.gl.triangles+=J.triangles,X.gl.points+=J.points,X.gl.lines+=J.lines,X.log.gpu+=N.gpu,X.log.cpu+=N.cpu,X.log.mem+=N.mem,X.log.fps+=N.fps;for(let te=0;te<UA.length;te++){const ue=UA[te],ae=J[ue];ae>X.max.gl[ue]&&(X.max.gl[ue]=ae)}for(let te=0;te<NA.length;te++){const ue=NA[te],ae=N[ue];ae>X.max.log[ue]&&(X.max.log[ue]=ae)}Ll({accumulated:X}),F2("log",[V,d])}}),E=d.getContext();let T=null,A=null;const I=E.getExtension("WEBGL_debug_renderer_info"),O=E.getParameter(E.VERSION);I!=null&&(T=E.getParameter(I.UNMASKED_RENDERER_WEBGL),A=E.getParameter(I.UNMASKED_VENDOR_WEBGL)),A||(A="Unknown vendor"),T||(T=E.getParameter(E.RENDERER)),Ll({startTime:window.performance.now(),infos:{version:O,renderer:T,vendor:A}});const z=new Map,U=new Map;return Object.defineProperty(Am.prototype,"onBeforeRender",{get(){return(...N)=>{var V;i&&i.begin("profiler"),(V=z.get(this))==null||V(...N)}},set(N){z.set(this,N)},configurable:!0}),Object.defineProperty(Am.prototype,"onAfterRender",{get(){return(...N)=>{var V;i&&i.end("profiler"),(V=U.get(this))==null||V(...N)}},set(N){U.set(this,N)},configurable:!0}),i},[]);return k.useEffect(()=>{b&&(b.overClock=n||!1,n===!1&&(Ll({overclockingFps:!1}),ic.value=0,ic.isOverLimit=0),b.chartHz=(r==null?void 0:r.hz)||60,b.chartLen=(r==null?void 0:r.length)||120)},[n,b,r==null?void 0:r.length,r==null?void 0:r.hz]),k.useEffect(()=>{u&&(Ba.prototype.updateMatrixWorld=function(){(this.matrixWorldNeedsUpdate||arguments[0])&&Hf.value++,U2.apply(this,arguments)},Ba.prototype.updateWorldMatrix=function(){Hf.value++,N2.apply(this,arguments)},Ba.prototype.updateMatrix=function(){Fl.value++,jA.apply(this,arguments)}),d.info.autoReset=!1;let i=null,E=null;if(d.info)return i=zk(function(){cc().paused&&Ll({paused:!1}),window.performance&&(window.performance.mark("cpu-started"),b.startCpuProfiling=!0),Fl.value-=1,Hf.value=0,Fl.value=0,d.info&&d.info.reset()}),E=Fk(function(){var A,I;if(b&&!b.paused&&(b.nextFrame(window.performance.now()),n&&typeof window.requestIdleCallback<"u"&&(b.idleCbId=requestIdleCallback(b.nextFps))),l){const O={},z=new Map;p.traverse(function(N){if((N instanceof Oa||N instanceof Id)&&N.material){let V=N.material.uuid;Array.isArray(N.material)&&N.material.length>1?V=GA(N.material[1],O):V=GA(N.material,O),O[V].meshes[N.uuid]=N}}),(I=(A=d==null?void 0:d.info)==null?void 0:A.programs)==null||I.forEach(U=>{const N=U.cacheKey.split(","),V=N[N.findIndex(V2)+1];if(G2(V)&&O[V]){const{material:X,meshes:J}=O[V];z.set(V,{program:U,material:X,meshes:J,drawCounts:{total:0,type:"triangle",data:[]},expand:!1,visible:!0})}}),z.size!==cc().programs.size&&(O2(z),Ll({programs:z,triggerProgramsUpdate:cc().triggerProgramsUpdate++}))}}),()=>{b&&(typeof window.cancelIdleCallback<"u"&&window.cancelIdleCallback(b.idleCbId),window.cancelAnimationFrame(b.rafId),window.cancelAnimationFrame(b.checkQueryId)),u&&(Ba.prototype.updateMatrixWorld=jA),i(),E()}},[b,d,r,u]),k.useEffect(()=>{const i=jk(function(){return b&&(b.paused=!0,Fl.value=0,Hf.value=0,Ll({paused:!0,log:{maxMemory:0,gpu:0,mem:0,cpu:0,fps:0,totalTime:0,frameCount:0}})),!1});return()=>{i()}},[]),null},H2=xs("div",{position:"fixed",top:0,right:0,zIndex:9999,fontFamily:`-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif`,backgroundColor:"rgba(36, 36, 36, .9)",color:"#fff",margin:0,minHeight:"100px",padding:"4px 0","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale",userSelect:"none","&.top-left":{right:"initial",left:0},"&.bottom-left":{right:"initial",top:"initial",bottom:0,left:0,".__perf_toggle":{top:"-20px",bottom:"initial"}},"&.bottom-right":{top:"initial",bottom:0,".__perf_toggle":{top:"-20px",bottom:"initial"}},"&.minimal":{backgroundColor:"rgba(36, 36, 36, .75)"},"*":{margin:"0",padding:"0",border:"0",fontSize:"100%",lineHeight:"1",verticalAlign:"baseline"}}),lv=xs("small",{position:"absolute",right:0,fontSize:"10px"}),da=xs("div",{display:"inline-flex",fontStyle:"normal",padding:0,lineHeight:"13px",fontSize:"14px",width:"62px",position:"relative",pointerEvents:"auto",cursor:"default",fontWeight:500,letterSpacing:"0px",textAlign:"left",height:"29px",whiteSpace:"nowrap",justifyContent:"space-evenly",fontVariantNumeric:"tabular-nums",small:{paddingLeft:"12px"},svg:{padding:0,color:"rgba(145, 145, 145, 0.3)",fontSize:"40px",position:"absolute",zIndex:1,maxHeight:"20px",left:" 50%",marginLeft:"-23px",top:"4px"}}),gl=xs("span",{verticalAlign:"bottom",position:"absolute",bottom:"5px",color:"rgba(101, 197, 188, 1)",textAlign:"right",letterSpacing:"1px",fontSize:"8px",fontWeight:"500",width:"60px"}),W2=xs("div",{display:"flex"}),Z2=xs("div",{backgroundColor:"#404040",padding:"6px",display:"block",fontSize:"12px",marginBottom:"6px",cursor:"pointer","*":{cursor:"pointer !important"},"> span":{},small:{fontSize:"9px"},"> b":{marginRight:"4px",cursor:"pointer"}}),X2=xs("div",{height:"66px",overflow:"hidden",position:"absolute",pointerEvents:"none",display:"flex",top:"0px",justifyContent:"center",width:"100%",minWidth:"310px",margin:"0 auto",canvas:{background:"transparent !important",position:"absolute !important"}}),q2=xs("div",{textAlign:"center",fontWeight:700,fontSize:"12px",lineHeight:"12px",display:"flex",justifyContent:"center",alignItems:"center",verticalAlign:"middle",color:"#f1f1f1",padding:"7px",width:"100%",backgroundColor:"rgba(36, 36, 37, 0.8)",zIndex:1,position:"absolute",height:"100%"}),Ex=xs("div",{pointerEvents:"auto",justifyContent:"center",cursor:"pointer",fontSize:"12px",backgroundColor:"rgb(41, 43, 45)",marginTop:"6px",width:"auto",margin:"0",color:"rgba(145, 145, 145, 1)",textAlign:"center",display:"inline-block",verticalAlign:"middle",padding:"4px 6px","&.__perf_toggle_tab_active":{backgroundColor:"rgb(31 31 31)"},svg:{width:"12px",height:"12px",float:"left"}}),K2=xs("div",{pointerEvents:"auto",justifyContent:"center",cursor:"pointer",fontSize:"12px",float:"right",backgroundColor:"rgb(41, 43, 45)",width:"auto",margin:"0",color:"rgba(145, 145, 145, 1)",textAlign:"center",display:"inline-block",verticalAlign:"middle",padding:"4px 6px","&.__perf_toggle_tab_active":{backgroundColor:"rgb(31 31 31)"},svg:{width:"12px",height:"12px",float:"left"}}),J2=xs("div",{padding:"4px 6px",fontSize:"12px",pointerEvents:"auto"}),Y2=xs("span",{fontWeight:"bold",letterSpacing:"0.08em",maxWidth:"145px",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",verticalAlign:"middle",fontSize:"11px",marginRight:"10px"}),Q2=xs("div",{maxHeight:"50vh",overflowY:"auto",marginTop:"38px"}),eG=xs("div",{marginTop:"0"}),VA=xs("div",{display:"flex",position:"relative",fontWeight:"bold",color:"#fff",lineHeight:"14px",svg:{marginRight:"4px",display:"inline-block"}}),B3=xs("ul",{display:"block",position:"relative",paddingLeft:"10px",margin:"6px 6px",img:{maxHeight:"60px",maxWidth:"100%",margin:"6px auto",display:"block"},"&:after":{content:"",position:"absolute",left:"0px",top:"0px",width:"1px",height:"100%",backgroundColor:"grey",transform:"translateX(-50%)",maxHeight:"50vh",overflowY:"auto"},li:{borderBottom:"1px solid #313131",display:"block",padding:"4px",margin:0,lineHeight:1,verticalAlign:"middle",height:"24px"},b:{fontWeight:"bold"},small:{textAlign:"revert",letterSpacing:"1px",fontSize:"10px",fontWeight:"500",marginLeft:"2px",color:"rgb(101, 197, 188)"}}),R3=xs("button",{fontWeight:"bold",letterSpacing:"0.02em",backgroundColor:"rgb(41, 43, 45)",color:"rgb(211, 211, 211)",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer",display:"block",verticalAlign:"middle",fontSize:"11px",padding:"5px",margin:"4px auto"}),tG=xs("div",{display:"flex",justifyContent:"center",cursor:"pointer",fontSize:"12px",backgroundColor:"rgb(41, 43, 45)",marginTop:"6px",width:"auto",margin:"0 auto",color:"rgba(145, 145, 145, 1)",textAlign:"center",position:"absolute",right:0,bottom:" -20px",svg:{width:"12px",height:"12px",float:"left"}}),nG=xs("li",{display:"flex !important",height:"auto !important",span:{height:"40px",display:"block",position:"relative"},b:{paddingLeft:"12px"}});function qo(n,t){if(n==null)return{};var r={},l=Object.keys(n),u,d;for(d=0;d<l.length;d++)u=l[d],!(t.indexOf(u)>=0)&&(r[u]=n[u]);return r}var rG=["color"],D3=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,rG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M0 1.5C0 1.22386 0.223858 1 0.5 1H2.5C2.77614 1 3 1.22386 3 1.5C3 1.77614 2.77614 2 2.5 2H0.5C0.223858 2 0 1.77614 0 1.5ZM4 1.5C4 1.22386 4.22386 1 4.5 1H14.5C14.7761 1 15 1.22386 15 1.5C15 1.77614 14.7761 2 14.5 2H4.5C4.22386 2 4 1.77614 4 1.5ZM4 4.5C4 4.22386 4.22386 4 4.5 4H11.5C11.7761 4 12 4.22386 12 4.5C12 4.77614 11.7761 5 11.5 5H4.5C4.22386 5 4 4.77614 4 4.5ZM0 7.5C0 7.22386 0.223858 7 0.5 7H2.5C2.77614 7 3 7.22386 3 7.5C3 7.77614 2.77614 8 2.5 8H0.5C0.223858 8 0 7.77614 0 7.5ZM4 7.5C4 7.22386 4.22386 7 4.5 7H14.5C14.7761 7 15 7.22386 15 7.5C15 7.77614 14.7761 8 14.5 8H4.5C4.22386 8 4 7.77614 4 7.5ZM4 10.5C4 10.2239 4.22386 10 4.5 10H11.5C11.7761 10 12 10.2239 12 10.5C12 10.7761 11.7761 11 11.5 11H4.5C4.22386 11 4 10.7761 4 10.5ZM0 13.5C0 13.2239 0.223858 13 0.5 13H2.5C2.77614 13 3 13.2239 3 13.5C3 13.7761 2.77614 14 2.5 14H0.5C0.223858 14 0 13.7761 0 13.5ZM4 13.5C4 13.2239 4.22386 13 4.5 13H14.5C14.7761 13 15 13.2239 15 13.5C15 13.7761 14.7761 14 14.5 14H4.5C4.22386 14 4 13.7761 4 13.5Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),iG=["color"],oG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,iG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M11.5 1C11.7761 1 12 1.22386 12 1.5V13.5C12 13.7761 11.7761 14 11.5 14C11.2239 14 11 13.7761 11 13.5V1.5C11 1.22386 11.2239 1 11.5 1ZM9.5 3C9.77614 3 10 3.22386 10 3.5V13.5C10 13.7761 9.77614 14 9.5 14C9.22386 14 9 13.7761 9 13.5V3.5C9 3.22386 9.22386 3 9.5 3ZM13.5 3C13.7761 3 14 3.22386 14 3.5V13.5C14 13.7761 13.7761 14 13.5 14C13.2239 14 13 13.7761 13 13.5V3.5C13 3.22386 13.2239 3 13.5 3ZM5.5 4C5.77614 4 6 4.22386 6 4.5V13.5C6 13.7761 5.77614 14 5.5 14C5.22386 14 5 13.7761 5 13.5V4.5C5 4.22386 5.22386 4 5.5 4ZM1.5 5C1.77614 5 2 5.22386 2 5.5V13.5C2 13.7761 1.77614 14 1.5 14C1.22386 14 1 13.7761 1 13.5V5.5C1 5.22386 1.22386 5 1.5 5ZM7.5 5C7.77614 5 8 5.22386 8 5.5V13.5C8 13.7761 7.77614 14 7.5 14C7.22386 14 7 13.7761 7 13.5V5.5C7 5.22386 7.22386 5 7.5 5ZM3.5 7C3.77614 7 4 7.22386 4 7.5V13.5C4 13.7761 3.77614 14 3.5 14C3.22386 14 3 13.7761 3 13.5V7.5C3 7.22386 3.22386 7 3.5 7Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),sG=["color"],aG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,sG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M2 5H13C13.5523 5 14 5.44772 14 6V9C14 9.55228 13.5523 10 13 10H2C1.44772 10 1 9.55228 1 9V6C1 5.44772 1.44772 5 2 5ZM0 6C0 4.89543 0.895431 4 2 4H13C14.1046 4 15 4.89543 15 6V9C15 10.1046 14.1046 11 13 11H2C0.89543 11 0 10.1046 0 9V6ZM4.5 6.75C4.08579 6.75 3.75 7.08579 3.75 7.5C3.75 7.91421 4.08579 8.25 4.5 8.25C4.91421 8.25 5.25 7.91421 5.25 7.5C5.25 7.08579 4.91421 6.75 4.5 6.75ZM6.75 7.5C6.75 7.08579 7.08579 6.75 7.5 6.75C7.91421 6.75 8.25 7.08579 8.25 7.5C8.25 7.91421 7.91421 8.25 7.5 8.25C7.08579 8.25 6.75 7.91421 6.75 7.5ZM10.5 6.75C10.0858 6.75 9.75 7.08579 9.75 7.5C9.75 7.91421 10.0858 8.25 10.5 8.25C10.9142 8.25 11.25 7.91421 11.25 7.5C11.25 7.08579 10.9142 6.75 10.5 6.75Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),lG=["color"],cG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,lG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M7.28856 0.796908C7.42258 0.734364 7.57742 0.734364 7.71144 0.796908L13.7114 3.59691C13.8875 3.67906 14 3.85574 14 4.05V10.95C14 11.1443 13.8875 11.3209 13.7114 11.4031L7.71144 14.2031C7.57742 14.2656 7.42258 14.2656 7.28856 14.2031L1.28856 11.4031C1.11252 11.3209 1 11.1443 1 10.95V4.05C1 3.85574 1.11252 3.67906 1.28856 3.59691L7.28856 0.796908ZM2 4.80578L7 6.93078V12.9649L2 10.6316V4.80578ZM8 12.9649L13 10.6316V4.80578L8 6.93078V12.9649ZM7.5 6.05672L12.2719 4.02866L7.5 1.80176L2.72809 4.02866L7.5 6.05672Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),uG=["color"],hG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,uG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M7.5 9.125C8.39746 9.125 9.125 8.39746 9.125 7.5C9.125 6.60254 8.39746 5.875 7.5 5.875C6.60254 5.875 5.875 6.60254 5.875 7.5C5.875 8.39746 6.60254 9.125 7.5 9.125ZM7.5 10.125C8.94975 10.125 10.125 8.94975 10.125 7.5C10.125 6.05025 8.94975 4.875 7.5 4.875C6.05025 4.875 4.875 6.05025 4.875 7.5C4.875 8.94975 6.05025 10.125 7.5 10.125Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),dG=["color"],fG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,dG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M7.49999 3.09998C7.27907 3.09998 7.09999 3.27906 7.09999 3.49998C7.09999 3.72089 7.27907 3.89998 7.49999 3.89998H14.5C14.7209 3.89998 14.9 3.72089 14.9 3.49998C14.9 3.27906 14.7209 3.09998 14.5 3.09998H7.49999ZM7.49998 5.1C7.27907 5.1 7.09998 5.27908 7.09998 5.5C7.09998 5.72091 7.27907 5.9 7.49998 5.9H14.5C14.7209 5.9 14.9 5.72091 14.9 5.5C14.9 5.27908 14.7209 5.1 14.5 5.1H7.49998ZM7.1 7.5C7.1 7.27908 7.27909 7.1 7.5 7.1H14.5C14.7209 7.1 14.9 7.27908 14.9 7.5C14.9 7.72091 14.7209 7.9 14.5 7.9H7.5C7.27909 7.9 7.1 7.72091 7.1 7.5ZM7.49998 9.1C7.27907 9.1 7.09998 9.27908 7.09998 9.5C7.09998 9.72091 7.27907 9.9 7.49998 9.9H14.5C14.7209 9.9 14.9 9.72091 14.9 9.5C14.9 9.27908 14.7209 9.1 14.5 9.1H7.49998ZM7.09998 11.5C7.09998 11.2791 7.27907 11.1 7.49998 11.1H14.5C14.7209 11.1 14.9 11.2791 14.9 11.5C14.9 11.7209 14.7209 11.9 14.5 11.9H7.49998C7.27907 11.9 7.09998 11.7209 7.09998 11.5ZM2.5 9.25003L5 6.00003H0L2.5 9.25003Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),pG=["color"],mG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,pG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M13.3536 2.35355C13.5488 2.15829 13.5488 1.84171 13.3536 1.64645C13.1583 1.45118 12.8417 1.45118 12.6464 1.64645L10.6828 3.61012C9.70652 3.21671 8.63759 3 7.5 3C4.30786 3 1.65639 4.70638 0.0760002 7.23501C-0.0253338 7.39715 -0.0253334 7.60288 0.0760014 7.76501C0.902945 9.08812 2.02314 10.1861 3.36061 10.9323L1.64645 12.6464C1.45118 12.8417 1.45118 13.1583 1.64645 13.3536C1.84171 13.5488 2.15829 13.5488 2.35355 13.3536L4.31723 11.3899C5.29348 11.7833 6.36241 12 7.5 12C10.6921 12 13.3436 10.2936 14.924 7.76501C15.0253 7.60288 15.0253 7.39715 14.924 7.23501C14.0971 5.9119 12.9769 4.81391 11.6394 4.06771L13.3536 2.35355ZM9.90428 4.38861C9.15332 4.1361 8.34759 4 7.5 4C4.80285 4 2.52952 5.37816 1.09622 7.50001C1.87284 8.6497 2.89609 9.58106 4.09974 10.1931L9.90428 4.38861ZM5.09572 10.6114L10.9003 4.80685C12.1039 5.41894 13.1272 6.35031 13.9038 7.50001C12.4705 9.62183 10.1971 11 7.5 11C6.65241 11 5.84668 10.8639 5.09572 10.6114Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),gG=["color"],_G=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,gG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M7.5 11C4.80285 11 2.52952 9.62184 1.09622 7.50001C2.52952 5.37816 4.80285 4 7.5 4C10.1971 4 12.4705 5.37816 13.9038 7.50001C12.4705 9.62183 10.1971 11 7.5 11ZM7.5 3C4.30786 3 1.65639 4.70638 0.0760002 7.23501C-0.0253338 7.39715 -0.0253334 7.60288 0.0760014 7.76501C1.65639 10.2936 4.30786 12 7.5 12C10.6921 12 13.3436 10.2936 14.924 7.76501C15.0253 7.60288 15.0253 7.39715 14.924 7.23501C13.3436 4.70638 10.6921 3 7.5 3ZM7.5 9.5C8.60457 9.5 9.5 8.60457 9.5 7.5C9.5 6.39543 8.60457 5.5 7.5 5.5C6.39543 5.5 5.5 6.39543 5.5 7.5C5.5 8.60457 6.39543 9.5 7.5 9.5Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),yG=["color"],h1=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,yG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M2.5 1H12.5C13.3284 1 14 1.67157 14 2.5V12.5C14 13.3284 13.3284 14 12.5 14H2.5C1.67157 14 1 13.3284 1 12.5V2.5C1 1.67157 1.67157 1 2.5 1ZM2.5 2C2.22386 2 2 2.22386 2 2.5V8.3636L3.6818 6.6818C3.76809 6.59551 3.88572 6.54797 4.00774 6.55007C4.12975 6.55216 4.24568 6.60372 4.32895 6.69293L7.87355 10.4901L10.6818 7.6818C10.8575 7.50607 11.1425 7.50607 11.3182 7.6818L13 9.3636V2.5C13 2.22386 12.7761 2 12.5 2H2.5ZM2 12.5V9.6364L3.98887 7.64753L7.5311 11.4421L8.94113 13H2.5C2.22386 13 2 12.7761 2 12.5ZM12.5 13H10.155L8.48336 11.153L11 8.6364L13 10.6364V12.5C13 12.7761 12.7761 13 12.5 13ZM6.64922 5.5C6.64922 5.03013 7.03013 4.64922 7.5 4.64922C7.96987 4.64922 8.35078 5.03013 8.35078 5.5C8.35078 5.96987 7.96987 6.35078 7.5 6.35078C7.03013 6.35078 6.64922 5.96987 6.64922 5.5ZM7.5 3.74922C6.53307 3.74922 5.74922 4.53307 5.74922 5.5C5.74922 6.46693 6.53307 7.25078 7.5 7.25078C8.46693 7.25078 9.25078 6.46693 9.25078 5.5C9.25078 4.53307 8.46693 3.74922 7.5 3.74922Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),vG=["color"],xG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,vG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M5.49998 0.5C5.49998 0.223858 5.72383 0 5.99998 0H7.49998H8.99998C9.27612 0 9.49998 0.223858 9.49998 0.5C9.49998 0.776142 9.27612 1 8.99998 1H7.99998V2.11922C9.09832 2.20409 10.119 2.56622 10.992 3.13572C11.0116 3.10851 11.0336 3.08252 11.058 3.05806L12.058 2.05806C12.3021 1.81398 12.6978 1.81398 12.9419 2.05806C13.186 2.30214 13.186 2.69786 12.9419 2.94194L11.967 3.91682C13.1595 5.07925 13.9 6.70314 13.9 8.49998C13.9 12.0346 11.0346 14.9 7.49998 14.9C3.96535 14.9 1.09998 12.0346 1.09998 8.49998C1.09998 5.13361 3.69904 2.3743 6.99998 2.11922V1H5.99998C5.72383 1 5.49998 0.776142 5.49998 0.5ZM2.09998 8.49998C2.09998 5.51764 4.51764 3.09998 7.49998 3.09998C10.4823 3.09998 12.9 5.51764 12.9 8.49998C12.9 11.4823 10.4823 13.9 7.49998 13.9C4.51764 13.9 2.09998 11.4823 2.09998 8.49998ZM7.49998 8.49998V4.09998C5.06992 4.09998 3.09998 6.06992 3.09998 8.49998C3.09998 10.93 5.06992 12.9 7.49998 12.9C8.715 12.9 9.815 12.4075 10.6112 11.6112L7.49998 8.49998Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),bG=["color"],wG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,bG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M7.75432 0.819537C7.59742 0.726821 7.4025 0.726821 7.24559 0.819537L1.74559 4.06954C1.59336 4.15949 1.49996 4.32317 1.49996 4.5C1.49996 4.67683 1.59336 4.84051 1.74559 4.93046L7.24559 8.18046C7.4025 8.27318 7.59742 8.27318 7.75432 8.18046L13.2543 4.93046C13.4066 4.84051 13.5 4.67683 13.5 4.5C13.5 4.32317 13.4066 4.15949 13.2543 4.06954L7.75432 0.819537ZM7.49996 7.16923L2.9828 4.5L7.49996 1.83077L12.0171 4.5L7.49996 7.16923ZM1.5695 7.49564C1.70998 7.2579 2.01659 7.17906 2.25432 7.31954L7.49996 10.4192L12.7456 7.31954C12.9833 7.17906 13.2899 7.2579 13.4304 7.49564C13.5709 7.73337 13.4921 8.03998 13.2543 8.18046L7.75432 11.4305C7.59742 11.5232 7.4025 11.5232 7.24559 11.4305L1.74559 8.18046C1.50786 8.03998 1.42901 7.73337 1.5695 7.49564ZM1.56949 10.4956C1.70998 10.2579 2.01658 10.1791 2.25432 10.3195L7.49996 13.4192L12.7456 10.3195C12.9833 10.1791 13.2899 10.2579 13.4304 10.4956C13.5709 10.7334 13.4921 11.04 13.2543 11.1805L7.75432 14.4305C7.59742 14.5232 7.4025 14.5232 7.24559 14.4305L1.74559 11.1805C1.50785 11.04 1.42901 10.7334 1.56949 10.4956Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),EG=["color"],CG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,EG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M8.69667 0.0403541C8.90859 0.131038 9.03106 0.354857 8.99316 0.582235L8.0902 6.00001H12.5C12.6893 6.00001 12.8625 6.10701 12.9472 6.27641C13.0319 6.4458 13.0136 6.6485 12.8999 6.80001L6.89997 14.8C6.76167 14.9844 6.51521 15.0503 6.30328 14.9597C6.09135 14.869 5.96888 14.6452 6.00678 14.4178L6.90974 9H2.49999C2.31061 9 2.13748 8.893 2.05278 8.72361C1.96809 8.55422 1.98636 8.35151 2.09999 8.2L8.09997 0.200038C8.23828 0.0156255 8.48474 -0.0503301 8.69667 0.0403541ZM3.49999 8.00001H7.49997C7.64695 8.00001 7.78648 8.06467 7.88148 8.17682C7.97648 8.28896 8.01733 8.43723 7.99317 8.5822L7.33027 12.5596L11.5 7.00001H7.49997C7.353 7.00001 7.21347 6.93534 7.11846 6.8232C7.02346 6.71105 6.98261 6.56279 7.00678 6.41781L7.66968 2.44042L3.49999 8.00001Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),AG=["color"],TG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,AG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M1.49988 2.00012C1.77602 2.00012 1.99988 1.77626 1.99988 1.50012C1.99988 1.22398 1.77602 1.00012 1.49988 1.00012C1.22374 1.00012 0.999878 1.22398 0.999878 1.50012C0.999878 1.77626 1.22374 2.00012 1.49988 2.00012ZM4.49988 2.00012C4.77602 2.00012 4.99988 1.77626 4.99988 1.50012C4.99988 1.22398 4.77602 1.00012 4.49988 1.00012C4.22374 1.00012 3.99988 1.22398 3.99988 1.50012C3.99988 1.77626 4.22374 2.00012 4.49988 2.00012ZM7.99988 1.50012C7.99988 1.77626 7.77602 2.00012 7.49988 2.00012C7.22374 2.00012 6.99988 1.77626 6.99988 1.50012C6.99988 1.22398 7.22374 1.00012 7.49988 1.00012C7.77602 1.00012 7.99988 1.22398 7.99988 1.50012ZM10.4999 2.00012C10.776 2.00012 10.9999 1.77626 10.9999 1.50012C10.9999 1.22398 10.776 1.00012 10.4999 1.00012C10.2237 1.00012 9.99988 1.22398 9.99988 1.50012C9.99988 1.77626 10.2237 2.00012 10.4999 2.00012ZM13.9999 1.50012C13.9999 1.77626 13.776 2.00012 13.4999 2.00012C13.2237 2.00012 12.9999 1.77626 12.9999 1.50012C12.9999 1.22398 13.2237 1.00012 13.4999 1.00012C13.776 1.00012 13.9999 1.22398 13.9999 1.50012ZM1.49988 14.0001C1.77602 14.0001 1.99988 13.7763 1.99988 13.5001C1.99988 13.224 1.77602 13.0001 1.49988 13.0001C1.22374 13.0001 0.999878 13.224 0.999878 13.5001C0.999878 13.7763 1.22374 14.0001 1.49988 14.0001ZM1.99988 10.5001C1.99988 10.7763 1.77602 11.0001 1.49988 11.0001C1.22374 11.0001 0.999878 10.7763 0.999878 10.5001C0.999878 10.224 1.22374 10.0001 1.49988 10.0001C1.77602 10.0001 1.99988 10.224 1.99988 10.5001ZM1.49988 8.00012C1.77602 8.00012 1.99988 7.77626 1.99988 7.50012C1.99988 7.22398 1.77602 7.00012 1.49988 7.00012C1.22374 7.00012 0.999878 7.22398 0.999878 7.50012C0.999878 7.77626 1.22374 8.00012 1.49988 8.00012ZM1.99988 4.50012C1.99988 4.77626 1.77602 5.00012 1.49988 5.00012C1.22374 5.00012 0.999878 4.77626 0.999878 4.50012C0.999878 4.22398 1.22374 4.00012 1.49988 4.00012C1.77602 4.00012 1.99988 4.22398 1.99988 4.50012ZM13.4999 11.0001C13.776 11.0001 13.9999 10.7763 13.9999 10.5001C13.9999 10.224 13.776 10.0001 13.4999 10.0001C13.2237 10.0001 12.9999 10.224 12.9999 10.5001C12.9999 10.7763 13.2237 11.0001 13.4999 11.0001ZM13.9999 7.50012C13.9999 7.77626 13.776 8.00012 13.4999 8.00012C13.2237 8.00012 12.9999 7.77626 12.9999 7.50012C12.9999 7.22398 13.2237 7.00012 13.4999 7.00012C13.776 7.00012 13.9999 7.22398 13.9999 7.50012ZM13.4999 5.00012C13.776 5.00012 13.9999 4.77626 13.9999 4.50012C13.9999 4.22398 13.776 4.00012 13.4999 4.00012C13.2237 4.00012 12.9999 4.22398 12.9999 4.50012C12.9999 4.77626 13.2237 5.00012 13.4999 5.00012ZM4.99988 13.5001C4.99988 13.7763 4.77602 14.0001 4.49988 14.0001C4.22374 14.0001 3.99988 13.7763 3.99988 13.5001C3.99988 13.224 4.22374 13.0001 4.49988 13.0001C4.77602 13.0001 4.99988 13.224 4.99988 13.5001ZM7.49988 14.0001C7.77602 14.0001 7.99988 13.7763 7.99988 13.5001C7.99988 13.224 7.77602 13.0001 7.49988 13.0001C7.22374 13.0001 6.99988 13.224 6.99988 13.5001C6.99988 13.7763 7.22374 14.0001 7.49988 14.0001ZM10.9999 13.5001C10.9999 13.7763 10.776 14.0001 10.4999 14.0001C10.2237 14.0001 9.99988 13.7763 9.99988 13.5001C9.99988 13.224 10.2237 13.0001 10.4999 13.0001C10.776 13.0001 10.9999 13.224 10.9999 13.5001ZM13.4999 14.0001C13.776 14.0001 13.9999 13.7763 13.9999 13.5001C13.9999 13.224 13.776 13.0001 13.4999 13.0001C13.2237 13.0001 12.9999 13.224 12.9999 13.5001C12.9999 13.7763 13.2237 14.0001 13.4999 14.0001ZM3.99988 5.00012C3.99988 4.44784 4.44759 4.00012 4.99988 4.00012H9.99988C10.5522 4.00012 10.9999 4.44784 10.9999 5.00012V10.0001C10.9999 10.5524 10.5522 11.0001 9.99988 11.0001H4.99988C4.44759 11.0001 3.99988 10.5524 3.99988 10.0001V5.00012ZM4.99988 5.00012H9.99988V10.0001H4.99988V5.00012Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),SG=["color"],MG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,SG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M2.25 7.5C2.25 7.22386 2.47386 7 2.75 7H12.25C12.5261 7 12.75 7.22386 12.75 7.5C12.75 7.77614 12.5261 8 12.25 8H2.75C2.47386 8 2.25 7.77614 2.25 7.5Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),IG=["color"],PG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,IG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M6.04995 2.74998C6.04995 2.44623 5.80371 2.19998 5.49995 2.19998C5.19619 2.19998 4.94995 2.44623 4.94995 2.74998V12.25C4.94995 12.5537 5.19619 12.8 5.49995 12.8C5.80371 12.8 6.04995 12.5537 6.04995 12.25V2.74998ZM10.05 2.74998C10.05 2.44623 9.80371 2.19998 9.49995 2.19998C9.19619 2.19998 8.94995 2.44623 8.94995 2.74998V12.25C8.94995 12.5537 9.19619 12.8 9.49995 12.8C9.80371 12.8 10.05 12.5537 10.05 12.25V2.74998Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),LG=["color"],BG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,LG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M6.85357 3.85355L7.65355 3.05353C8.2981 2.40901 9.42858 1.96172 10.552 1.80125C11.1056 1.72217 11.6291 1.71725 12.0564 1.78124C12.4987 1.84748 12.7698 1.97696 12.8965 2.10357C13.0231 2.23018 13.1526 2.50125 13.2188 2.94357C13.2828 3.37086 13.2779 3.89439 13.1988 4.44801C13.0383 5.57139 12.591 6.70188 11.9464 7.34645L7.49999 11.7929L6.35354 10.6465C6.15827 10.4512 5.84169 10.4512 5.64643 10.6465C5.45117 10.8417 5.45117 11.1583 5.64643 11.3536L7.14644 12.8536C7.34171 13.0488 7.65829 13.0488 7.85355 12.8536L8.40073 12.3064L9.57124 14.2572C9.65046 14.3893 9.78608 14.4774 9.9389 14.4963C10.0917 14.5151 10.2447 14.4624 10.3535 14.3536L12.3535 12.3536C12.4648 12.2423 12.5172 12.0851 12.495 11.9293L12.0303 8.67679L12.6536 8.05355C13.509 7.19808 14.0117 5.82855 14.1887 4.58943C14.2784 3.9618 14.2891 3.33847 14.2078 2.79546C14.1287 2.26748 13.9519 1.74482 13.6035 1.39645C13.2552 1.04809 12.7325 0.871332 12.2045 0.792264C11.6615 0.710945 11.0382 0.721644 10.4105 0.8113C9.17143 0.988306 7.80189 1.491 6.94644 2.34642L6.32322 2.96968L3.07071 2.50504C2.91492 2.48278 2.75773 2.53517 2.64645 2.64646L0.646451 4.64645C0.537579 4.75533 0.484938 4.90829 0.50375 5.0611C0.522563 5.21391 0.61073 5.34954 0.742757 5.42876L2.69364 6.59928L2.14646 7.14645C2.0527 7.24022 2.00002 7.3674 2.00002 7.50001C2.00002 7.63261 2.0527 7.75979 2.14646 7.85356L3.64647 9.35356C3.84173 9.54883 4.15831 9.54883 4.35357 9.35356C4.54884 9.1583 4.54884 8.84172 4.35357 8.64646L3.20712 7.50001L3.85357 6.85356L6.85357 3.85355ZM10.0993 13.1936L9.12959 11.5775L11.1464 9.56067L11.4697 11.8232L10.0993 13.1936ZM3.42251 5.87041L5.43935 3.85356L3.17678 3.53034L1.80638 4.90074L3.42251 5.87041ZM2.35356 10.3535C2.54882 10.1583 2.54882 9.8417 2.35356 9.64644C2.1583 9.45118 1.84171 9.45118 1.64645 9.64644L0.646451 10.6464C0.451188 10.8417 0.451188 11.1583 0.646451 11.3535C0.841713 11.5488 1.1583 11.5488 1.35356 11.3535L2.35356 10.3535ZM3.85358 11.8536C4.04884 11.6583 4.04885 11.3417 3.85359 11.1465C3.65833 10.9512 3.34175 10.9512 3.14648 11.1465L1.14645 13.1464C0.95119 13.3417 0.951187 13.6583 1.14645 13.8535C1.34171 14.0488 1.65829 14.0488 1.85355 13.8536L3.85358 11.8536ZM5.35356 13.3535C5.54882 13.1583 5.54882 12.8417 5.35356 12.6464C5.1583 12.4512 4.84171 12.4512 4.64645 12.6464L3.64645 13.6464C3.45119 13.8417 3.45119 14.1583 3.64645 14.3535C3.84171 14.5488 4.1583 14.5488 4.35356 14.3535L5.35356 13.3535ZM9.49997 6.74881C10.1897 6.74881 10.7488 6.1897 10.7488 5.5C10.7488 4.8103 10.1897 4.25118 9.49997 4.25118C8.81026 4.25118 8.25115 4.8103 8.25115 5.5C8.25115 6.1897 8.81026 6.74881 9.49997 6.74881Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),RG=["color"],DG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,RG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M0.5 4C0.223858 4 0 4.22386 0 4.5V10.5C0 10.7761 0.223858 11 0.5 11H14.5C14.7761 11 15 10.7761 15 10.5V4.5C15 4.22386 14.7761 4 14.5 4H0.5ZM1 10V5H2.075V7.5C2.075 7.73472 2.26528 7.925 2.5 7.925C2.73472 7.925 2.925 7.73472 2.925 7.5V5H4.075V6.5C4.075 6.73472 4.26528 6.925 4.5 6.925C4.73472 6.925 4.925 6.73472 4.925 6.5V5H6.075V6.5C6.075 6.73472 6.26528 6.925 6.5 6.925C6.73472 6.925 6.925 6.73472 6.925 6.5V5H8.075V7.5C8.075 7.73472 8.26528 7.925 8.5 7.925C8.73472 7.925 8.925 7.73472 8.925 7.5V5H10.075V6.5C10.075 6.73472 10.2653 6.925 10.5 6.925C10.7347 6.925 10.925 6.73472 10.925 6.5V5H12.075V6.5C12.075 6.73472 12.2653 6.925 12.5 6.925C12.7347 6.925 12.925 6.73472 12.925 6.5V5H14V10H1Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),OG=["color"],kG=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,OG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M2.5 4C2.22386 4 2 4.22386 2 4.5C2 4.77614 2.22386 5 2.5 5H12.5C12.7761 5 13 4.77614 13 4.5C13 4.22386 12.7761 4 12.5 4H2.5ZM2 7.5C2 7.22386 2.22386 7 2.5 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H2.5C2.22386 8 2 7.77614 2 7.5ZM2 10.5C2 10.2239 2.22386 10 2.5 10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H2.5C2.22386 11 2 10.7761 2 10.5Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))}),zG=["color"],O3=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,zG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M4 6H11L7.5 10.5L4 6Z",fill:l}))}),FG=["color"],k3=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,FG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M4 9H11L7.5 4.5L4 9Z",fill:l}))}),jG=["color"],z3=k.forwardRef(function(n,t){var r=n.color,l=r===void 0?"currentColor":r,u=qo(n,jG);return k.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u,{ref:t}),k.createElement("path",{d:"M7.49998 1L6.92321 2.00307L1.17498 12L0.599976 13H1.7535H13.2464H14.4L13.825 12L8.07674 2.00307L7.49998 1ZM7.49998 3.00613L2.3285 12H12.6714L7.49998 3.00613Z",fill:l,fillRule:"evenodd",clipRule:"evenodd"}))});const $A=k.forwardRef(({sdfGlyphSize:n=64,anchorX:t="center",anchorY:r="middle",font:l,fontSize:u=1,children:d,characters:p,onSync:b,...i},E)=>{const{Text:T,preloadFont:A}=Dv(async()=>tS(()=>import("./troika-three-text.esm-D8EKBBIg.js"),__vite__mapDeps([0,1,2]),import.meta.url),[]),I=ar(({invalidate:N})=>N),[O]=k.useState(()=>new T),[z,U]=k.useMemo(()=>{const N=[];let V="";return k.Children.forEach(d,X=>{typeof X=="string"||typeof X=="number"?V+=X:N.push(X)}),[N,V]},[d]);return Dv(()=>new Promise(N=>A({font:l,characters:p},N)),["troika-text",l,p]),k.useLayoutEffect(()=>void O.sync(()=>{I(),b&&b(O)})),k.useEffect(()=>()=>O.dispose(),[O]),k.createElement("primitive",Gr({object:O,ref:E,font:l,text:U,anchorX:t,anchorY:r,fontSize:u,sdfGlyphSize:n},i),z)}),nc=k.memo(({isPerf:n,color:t,colorBlind:r,customData:l,isMemory:u,isShadersInfo:d,metric:p,fontSize:b,offsetY:i=0,offsetX:E,round:T,hasInstance:A})=>{const{width:I,height:O}=ar(N=>N.viewport),z=k.useRef(null),U=k.useRef(null);return j2("log",function([V,X]){var J;if(!V||!z.current||(l&&(z.current.text=(Math.round(cc().customData*Math.pow(10,T))/Math.pow(10,T)).toFixed(T)),!p))return;let te=V[p];if(d?te=(J=X.info.programs)==null?void 0:J.length:p==="matriceCount"?te=Fl.value:!n&&X.info.render&&(te=(u?X.info.memory:X.info.render)[p]),p==="fps"&&(z.current.color=cc().overclockingFps?pa(r).overClock.toString():`rgb(${pa(r).fps.toString()})`),z.current.text=(Math.round(te*Math.pow(10,T))/Math.pow(10,T)).toFixed(T),A){const ue=X.info.instance;if(typeof ue>"u"&&p!=="matriceCount")return;let ae;p==="matriceCount"?ae=Hf.value:ae=ue[p],ae>0?(z.current.fontSize=b/1.15,U.current.fontSize=te>0?b/1.4:b,z.current.position.y=O/2-i-b/1.9,U.current.text=" ±	"+(Math.round(ae*Math.pow(10,T))/Math.pow(10,T)).toFixed(T)):(U.current.text&&(U.current.text=""),z.current.position.y=O/2-i-b,z.current.fontSize=b)}Fl.value-=1,z.current.updateMatrix(),z.current.matrixWorld.copy(z.current.matrix)}),Q.jsxs(k.Suspense,{fallback:null,children:[Q.jsxs($A,{textAlign:"justify",matrixAutoUpdate:!1,ref:z,fontSize:b,position:[-I/2+E+b,O/2-i-b,0],color:t,characters:"0123456789",onUpdate:N=>{N.updateMatrix(),Fl.value-=1,N.matrixWorld.copy(N.matrix)},children:[Q.jsx("meshBasicMaterial",{blending:Xw}),"0"]}),A&&Q.jsx($A,{textAlign:"justify",matrixAutoUpdate:!1,ref:U,fontSize:8,position:[-I/2+E+b,O/2-i-b*1.15,0],color:"lightgrey",characters:"0123456789",onUpdate:N=>{N.updateMatrix(),Fl.value-=1,N.matrixWorld.copy(N.matrix)},children:Q.jsx("meshBasicMaterial",{blending:Xw})})]})}),UG=({colorBlind:n,customData:t,minimal:r,matrixUpdate:l})=>Q.jsxs(Q.Fragment,{children:[Q.jsx(nc,{colorBlind:n,color:`rgb(${pa(n).fps.toString()})`,isPerf:!0,metric:"fps",fontSize:14,offsetX:140,round:0}),Q.jsx(nc,{color:`rgb(${pa(n).cpu.toString()})`,isPerf:!0,metric:"cpu",fontSize:14,offsetX:72,round:3}),Q.jsx(nc,{color:`rgb(${pa(n).gpu.toString()})`,isPerf:!0,metric:"gpu",fontSize:14,offsetX:10,round:3}),r?null:Q.jsxs(Q.Fragment,{children:[Q.jsx(nc,{metric:"calls",fontSize:14,offsetX:200,round:0,hasInstance:!0}),Q.jsx(nc,{metric:"triangles",fontSize:14,offsetX:260,round:0,hasInstance:!0}),Q.jsx(nc,{isMemory:!0,metric:"geometries",fontSize:14,offsetY:30,offsetX:0,round:0}),Q.jsx(nc,{isMemory:!0,metric:"textures",fontSize:14,offsetY:30,offsetX:80,round:0}),Q.jsx(nc,{isShadersInfo:!0,metric:"programs",fontSize:14,offsetY:30,offsetX:140,round:0}),Q.jsx(nc,{metric:"lines",fontSize:14,offsetY:30,offsetX:200,round:0,hasInstance:!0}),Q.jsx(nc,{metric:"points",fontSize:14,offsetY:30,offsetX:260,round:0,hasInstance:!0}),l&&Q.jsx(nc,{isPerf:!0,metric:"matriceCount",fontSize:14,offsetY:30,offsetX:320,round:0,hasInstance:!0})]}),t&&Q.jsx(nc,{color:`rgb(${pa(n).custom.toString()})`,customData:t,fontSize:14,offsetY:0,offsetX:r?200:320,round:t.round||2})]}),NG=({colorBlind:n,minimal:t,chart:r={length:120,hz:60}})=>{const l=k.useMemo(()=>({fps:new Float32Array(r.length*3),cpu:new Float32Array(r.length*3),gpu:new Float32Array(r.length*3)}),[r]),u=k.useRef(null),d=k.useRef(null),p=k.useRef(null),b=k.useRef(null),i=k.useMemo(()=>new Tt(0,0,0),[]),E=(T,A=1,I,O)=>{let z=0;const{width:U,height:N}=O,V=cc().chart.data[T];if(!V||V.length===0)return;const X=t?2:6,J=t?12:50;let te=V.length;for(let ue=0;ue<te;ue++){let ae=(cc().chart.circularId+ue+1)%te;V[ae]!==void 0&&(V[ae]>z&&(z=V[ae]*A),i.set(X+ue/(te-1)*(U-X*2)-U/2,Math.min(100,V[ae])*A/100*(N-X*2-J)-N/2,0),i.toArray(I.attributes.position.array,ue*3))}I.attributes.position.needsUpdate=!0};return mc(function({viewport:A}){E("fps",1,u.current,A),d.current&&d.current.color.set(cc().overclockingFps?pa(n).overClock.toString():`rgb(${pa(n).fps.toString()})`),E("gpu",5,p.current,A),E("cpu",5,b.current,A)}),Q.jsxs(Q.Fragment,{children:[Q.jsxs("line",{onUpdate:T=>{T.updateMatrix(),Fl.value-=1,T.matrixWorld.copy(T.matrix)},children:[Q.jsx("bufferGeometry",{ref:u,children:Q.jsx("bufferAttribute",{attach:"attributes-position",count:r.length,array:l.fps,itemSize:3,usage:g0,needsUpdate:!0})}),Q.jsx("lineBasicMaterial",{ref:d,color:`rgb(${pa(n).fps.toString()})`,transparent:!0,opacity:.5})]}),Q.jsxs("line",{onUpdate:T=>{T.updateMatrix(),Fl.value-=1,T.matrixWorld.copy(T.matrix)},children:[Q.jsx("bufferGeometry",{ref:p,children:Q.jsx("bufferAttribute",{attach:"attributes-position",count:r.length,array:l.gpu,itemSize:3,usage:g0,needsUpdate:!0})}),Q.jsx("lineBasicMaterial",{color:`rgb(${pa(n).gpu.toString()})`,transparent:!0,opacity:.5})]}),Q.jsxs("line",{onUpdate:T=>{T.updateMatrix(),Fl.value-=1,T.matrixWorld.copy(T.matrix)},children:[Q.jsx("bufferGeometry",{ref:b,children:Q.jsx("bufferAttribute",{attach:"attributes-position",count:r.length,array:l.cpu,itemSize:3,usage:g0,needsUpdate:!0})}),Q.jsx("lineBasicMaterial",{color:`rgb(${pa(n).cpu.toString()})`,transparent:!0,opacity:.5})]})]})},GG=({colorBlind:n,chart:t,customData:r,matrixUpdate:l,showGraph:u=!0,antialias:d=!0,minimal:p})=>{const b=k.useRef(void 0),i=dc(E=>E.paused);return Q.jsxs(X2,{style:{display:"flex",position:"absolute",height:`${p?37:u?100:60}px`,minWidth:`${p?"100px":r?"370px":"310px"}`},children:[Q.jsx(x_,{ref:b,orthographic:!0,camera:{rotation:[0,0,0]},dpr:d?[1,2]:1,gl:{antialias:!0,alpha:!0,stencil:!1,depth:!1},onCreated:({scene:E})=>{E.traverse(T=>{T.matrixWorldAutoUpdate=!1,T.matrixAutoUpdate=!1})},flat:!0,style:{marginBottom:"-42px",position:"relative",pointerEvents:"none",background:"transparent !important",height:`${p?37:u?100:60}px`},children:i?null:Q.jsxs(Q.Fragment,{children:[Q.jsx(VG,{}),Q.jsx(UG,{customData:r,minimal:p,matrixUpdate:l}),u&&Q.jsx(NG,{colorBlind:n,minimal:p,chart:t})]})}),i&&Q.jsxs(q2,{children:[Q.jsx(PG,{})," PAUSED"]})]})},VG=()=>(mc(function({gl:t,scene:r,camera:l}){l.updateMatrix(),Fl.value-=1,l.matrixWorld.copy(l.matrix),l.matrixWorldInverse.copy(l.matrixWorld).invert(),t.render(r,l),Hf.value=0,Fl.value=0},1/0),null),$G=k.forwardRef(({portal:n,className:t,children:r,name:l,...u},d)=>{const p=ar(T=>T.gl),b=k.useRef(null),i=k.useRef(null),E=(n==null?void 0:n.current)!=null?n.current:p.domElement.parentNode;return k.useLayoutEffect(()=>{if(!b.current||!E)return;const T=document.createElement("div"),A=i.current=oD(T);return E.appendChild(T),()=>{A.unmount(),i.current=null,E.removeChild(T)}},[E]),k.useLayoutEffect(()=>{const T=i.current;T&&T.render(Q.jsx("div",{ref:d,className:t,children:r}))}),Q.jsx("group",{name:l,...u,ref:b})});function HG(n){let t=0;for(let l in n.attributes){const u=n.getAttribute(l);t+=u.count*u.itemSize*u.array.BYTES_PER_ELEMENT}const r=n.getIndex();return t+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0,t}const HA=(n,t)=>{const r=u=>{switch(u){case 1e3:return"RepeatWrapping";case 1001:return"ClampToEdgeWrapping";case 1002:return"MirroredRepeatWrapping";default:return"ClampToEdgeWrapping"}},l=u=>{switch(u){case 3e3:return"LinearEncoding";case 3001:return"sRGBEncoding";case 3002:return"RGBEEncoding";case 3003:return"LogLuvEncoding";case 3004:return"RGBM7Encoding";case 3005:return"RGBM16Encoding";case 3006:return"RGBDEncoding";case 3007:return"GammaEncoding";default:return"ClampToEdgeWrapping"}};return{name:n,url:t.image.currentSrc,encoding:l(t.encoding),wrapT:r(t.wrapT),flipY:t.flipY.toString()}},WG=({program:n,material:t,setTexNumber:r})=>{const l=dc(p=>p.gl),[u,d]=k.useState(null);return k.useEffect(()=>{if(l){const p=n==null?void 0:n.getUniforms();let b=0;const i=new Map;p.seq.forEach(E=>{if(!E.id.includes("uTroika")&&E.id!=="isOrthographic"&&E.id!=="uvTransform"&&E.id!=="lightProbe"&&E.id!=="projectionMatrix"&&E.id!=="viewMatrix"&&E.id!=="normalMatrix"&&E.id!=="modelMatrix"&&E.id!=="modelViewMatrix"){let T=[],A={name:E.id};E.cache&&(E.cache.forEach(I=>{typeof I<"u"&&T.push(I.toString().substring(0,4))}),A.value=T.join(),t[E.id]&&t[E.id].image&&t[E.id].image&&(b++,A.value=HA(E.id,t[E.id])),A.value||(A.value="empty"),i.set(E.id,A))}}),t.uniforms&&Object.keys(t.uniforms).forEach(E=>{const T=t.uniforms[E];if(T.value){const{value:A}=T;let I={name:E};if(E.includes("uTroika"))return;if(A.isTexture)b++,I.value=HA(E,A);else{let O=JSON.stringify(A);try{O=JSON.stringify(A)}catch{O=A.toString()}I.value=O}i.set(E,I)}}),b>0&&r(b),d(i)}},[]),Q.jsx(B3,{children:u&&Array.from(u.values()).map(p=>Q.jsx("span",{children:typeof p.value=="string"?Q.jsx("li",{children:Q.jsxs("span",{children:[p.name," :"," ",Q.jsxs("b",{children:[p.value.substring(0,30),p.value.length>30?"...":""]})]})}):Q.jsxs(Q.Fragment,{children:[Q.jsx("li",{children:Q.jsxs("b",{children:[p.value.name,":"]})}),Q.jsxs("div",{children:[Object.keys(p.value).map(b=>b!=="name"?Q.jsx("div",{children:b==="url"?Q.jsx("a",{href:p.value[b],target:"_blank",children:Q.jsx("img",{src:p.value[b]})}):Q.jsxs("li",{children:[b,": ",Q.jsx("b",{children:p.value[b]})]})},b):null),Q.jsxs(R3,{onClick:()=>{var b;console.info(t[p.value.name]||((b=t==null?void 0:t.uniforms[p.value.name])==null?void 0:b.value))},children:["console.info(",p.value.name,");"]})]})]})},p.name))})},ZG=({el:n})=>{dc(l=>l.log);const t=dc(l=>l.gl),r=l=>{if(!t)return 0;const u=Math.round(l.drawCounts.total/(t.info.render.triangles+t.info.render.lines+t.info.render.points)*100*10)/10;return isFinite(u)&&u||0};return Q.jsx(Q.Fragment,{children:n.drawCounts.total>0&&Q.jsxs(da,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[n.drawCounts.type==="Triangle"?Q.jsx(z3,{style:{top:"-1px"}}):Q.jsx(D3,{style:{top:"-1px"}}),n.drawCounts.total,Q.jsxs("small",{children:[n.drawCounts.type,"s"]}),t&&Q.jsxs(gl,{style:{bottom:"-10px",width:"40px",fontWeight:"bold"},children:[n.visible&&!n.material.wireframe?r(n):0,"%"]})]})})},XG=({el:n})=>{const[t,r]=k.useState(n.visible),[l,u]=k.useState(n.expand),[d,p]=k.useState(0),{meshes:b,program:i,material:E}=n;return Q.jsxs(J2,{children:[Q.jsxs(Z2,{onClick:()=>{n.expand=!l,Object.keys(b).forEach(T=>{const A=b[T];A.material.wireframe=!1}),u(!l)},children:[Q.jsx(Ex,{style:{marginRight:"6px"},children:l?Q.jsx("span",{children:Q.jsx(O3,{})}):Q.jsx("span",{children:Q.jsx(k3,{})})}),i&&Q.jsxs("span",{children:[Q.jsx(Y2,{children:i.name}),Q.jsxs(da,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[Q.jsx(wG,{style:{top:"-1px"}}),Object.keys(b).length,Q.jsx("small",{children:Object.keys(b).length>1?"users":"user"})]}),d>0&&Q.jsxs(da,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[d>1?Q.jsx(h1,{style:{top:"-1px"}}):Q.jsx(h1,{style:{top:"-1px"}}),d,Q.jsx("small",{children:"tex"})]}),Q.jsx(ZG,{el:n}),E.glslVersion==="300 es"&&Q.jsxs(da,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[Q.jsx(BG,{style:{top:"-1px"}}),"300",Q.jsx("small",{children:"es"}),Q.jsx(gl,{style:{bottom:"-10px",width:"40px"},children:"glsl"})]})]}),Q.jsx(K2,{onPointerEnter:()=>{Object.keys(b).forEach(T=>{const A=b[T];A.material.wireframe=!0})},onPointerLeave:()=>{Object.keys(b).forEach(T=>{const A=b[T];A.material.wireframe=!1})},onClick:T=>{T.stopPropagation(),Object.keys(b).forEach(A=>{const I=b[A],O=!t;I.visible=O,n.visible=O,r(O)})},children:t?Q.jsx(_G,{}):Q.jsx(mG,{})})]}),Q.jsxs("div",{style:{maxHeight:l?"9999px":0,overflow:"hidden"},children:[Q.jsxs(VA,{children:[Q.jsx(aG,{})," Uniforms:"]}),Q.jsx(WG,{program:i,material:E,setTexNumber:p}),Q.jsxs(VA,{children:[Q.jsx(cG,{})," Geometries:"]}),Q.jsx(B3,{children:b&&Object.keys(b).map(T=>b[T]&&b[T].geometry&&Q.jsxs(nG,{children:[Q.jsxs("span",{children:[b[T].geometry.type,": "]}),b[T].userData&&b[T].userData.drawCount&&Q.jsxs("b",{children:[Q.jsxs("div",{children:[b[T].userData.drawCount.count,Q.jsxs("small",{children:[" ",b[T].userData.drawCount.type,"s"]})]}),Q.jsx("br",{}),Q.jsxs("div",{children:[Math.round(HG(b[T].geometry)/1024*1e3)/1e3,"Kb",Q.jsx("small",{children:" memory used"})]})]})]},T))}),Q.jsxs(R3,{onClick:()=>{console.info(E)},children:["console.info(",E.type,")"]})]})]})},qG=()=>{dc(t=>t.triggerProgramsUpdate);const n=dc(t=>t.programs);return Q.jsx(eG,{children:n&&Array.from(n.values()).map(t=>t&&t?Q.jsx(XG,{el:t},t.material.uuid):null)})},pa=n=>({overClock:"#ff6eff",fps:n?"100, 143, 255":"238,38,110",cpu:n?"254, 254, 98":"66,226,46",gpu:n?"254,254,254":"253,151,31",custom:n?"86,180,233":"40,255,255"}),KG=({showGraph:n,colorBlind:t})=>{const r=dc(u=>u.overclockingFps),l=dc(u=>u.fpsLimit);return Q.jsxs(gl,{style:n?{color:r?pa(t).overClock.toString():`rgb(${pa(t).fps})`}:{},children:["FPS ",r?`${l}🚀`:""]})},JG=({showGraph:n,colorBlind:t,customData:r,minimal:l})=>{const u=dc(d=>d.gl);return u?Q.jsxs(W2,{children:[Q.jsxs(da,{children:[Q.jsx(CG,{}),Q.jsx(gl,{style:n?{color:`rgb(${pa(t).gpu.toString()})`}:{},children:"GPU"}),Q.jsx(lv,{children:"ms"})]}),Q.jsxs(da,{children:[Q.jsx(DG,{}),Q.jsx(gl,{style:n?{color:`rgb(${pa(t).cpu.toString()})`}:{},children:"CPU"}),Q.jsx(lv,{children:"ms"})]}),Q.jsxs(da,{children:[Q.jsx(xG,{}),Q.jsx(KG,{showGraph:n,colorBlind:t})]}),!l&&u&&Q.jsxs(da,{children:[Q.jsx(kG,{}),Q.jsx(gl,{children:u.info.render.calls===1?"call":"calls"})]}),!l&&u&&Q.jsxs(da,{children:[Q.jsx(z3,{}),Q.jsx(gl,{children:"Triangles"})]}),r&&Q.jsxs(da,{children:[Q.jsx(oG,{}),Q.jsx(gl,{style:n?{color:`rgb(${pa(t).custom})`}:{},children:r.name}),r.info&&Q.jsx(lv,{children:r.info})]})]}):null},YG=({showGraph:n,colorBlind:t,deepAnalyze:r,customData:l,matrixUpdate:u,openByDefault:d,minimal:p})=>Q.jsxs(Q.Fragment,{children:[Q.jsx(JG,{showGraph:n,colorBlind:t,customData:l,minimal:p}),!p&&Q.jsx(eV,{matrixUpdate:u,openByDefault:d,deepAnalyze:r,showGraph:n})]}),QG=({matrixUpdate:n})=>Q.jsxs("div",{children:[Q.jsxs(da,{children:[Q.jsx(TG,{}),Q.jsx(gl,{children:"Geometries"})]}),Q.jsxs(da,{children:[Q.jsx(h1,{}),Q.jsx(gl,{children:"Textures"})]}),Q.jsxs(da,{children:[Q.jsx(D3,{}),Q.jsx(gl,{children:"shaders"})]}),Q.jsxs(da,{children:[Q.jsx(MG,{}),Q.jsx(gl,{children:"Lines"})]}),Q.jsxs(da,{children:[Q.jsx(hG,{}),Q.jsx(gl,{children:"Points"})]}),n&&Q.jsxs(da,{children:[Q.jsx(fG,{}),Q.jsx(gl,{children:"Matrices"})]})]}),WA=({tab:n,title:t,set:r})=>{const l=dc(u=>u.tab);return Q.jsx(Ex,{className:`${l===n?" __perf_toggle_tab_active":""}`,onClick:()=>{r(!0),Ll({tab:n})},children:Q.jsx("span",{children:t})})},eV=({openByDefault:n,showGraph:t,deepAnalyze:r,matrixUpdate:l})=>{const[u,d]=Pe.useState(n);return Q.jsxs("span",{children:[Q.jsx(tV,{show:u,showGraph:t,matrixUpdate:l}),n&&!r?null:Q.jsxs(tG,{className:"__perf_toggle",children:[r&&Q.jsx(WA,{tab:"programs",title:"Programs",set:d}),r&&Q.jsx(WA,{tab:"infos",title:"Infos",set:d}),Q.jsx(Ex,{onClick:()=>{d(!u)},children:u?Q.jsxs("span",{children:[Q.jsx(O3,{})," Minimize"]}):Q.jsxs("span",{children:[Q.jsx(k3,{})," More"]})})]})]})},tV=({show:n,showGraph:t,matrixUpdate:r})=>{const l=dc(u=>u.tab);return Q.jsxs(Q.Fragment,{children:[Q.jsx(QG,{matrixUpdate:r}),n&&Q.jsx("div",{children:Q.jsx(Q2,{style:{marginTop:t?"38px":0},children:l==="programs"&&Q.jsx(qG,{})})})]})},nV=({showGraph:n=!0,colorBlind:t=!1,openByDefault:r=!0,className:l,overClock:u=!1,style:d,position:p="top-right",chart:b,logsPerSecond:i,deepAnalyze:E=!1,antialias:T=!0,customData:A,matrixUpdate:I,minimal:O})=>{const z=k.useRef(null);return Q.jsxs(Q.Fragment,{children:[Q.jsx($2,{logsPerSecond:i,chart:b,overClock:u,deepAnalyze:E,matrixUpdate:I}),Q.jsx($G,{name:"r3f-perf",children:Q.jsxs(H2,{className:(l?" ".concat(l):" ")+` ${p||""} ${O?"minimal":""}`,style:{minHeight:O?"37px":n?"100px":"60px",...d},ref:z,children:[Q.jsx(GG,{perfContainerRef:z,colorBlind:t,chart:b,showGraph:n,antialias:T,customData:A,minimal:O,matrixUpdate:I}),Q.jsx(YG,{colorBlind:t,showGraph:n,deepAnalyze:E,openByDefault:r,customData:A,matrixUpdate:I,minimal:O})]})})]})},F3=lz(),rV=({cameraRef:n})=>{const[t,r]=k.useState();return k.useEffect(()=>{let l=-1;const u=()=>{l=requestAnimationFrame(()=>{u(),n.current&&r(n.current.position.clone())})};return u(),()=>{cancelAnimationFrame(l)}},[n]),!t||!n.current?null:Q.jsxs("div",{style:{display:"flex",alignItems:"center",opacity:.5},children:[Q.jsx(L3,{fontSize:"small"}),Q.jsx("div",{style:{marginLeft:"0.5em",marginTop:"-5px"},children:Q.jsxs(nh,{variant:"caption",children:[t.x.toFixed(2),", ",t.y.toFixed(2),","," ",t.z.toFixed(2)]})})]})},iV=({cameraRef:n})=>{const t=k.useRef(null),[r,l]=Pi(gk),u=ah(IS),d=JT({transform:r?"translateY(10%)":"translateY(0%)"}),p=k.useCallback(()=>{l(b=>!b),u(null)},[]);return Q.jsxs(Tv.div,{ref:t,style:{...d},children:[!r&&Q.jsx(Mv,{style:{opacity:.5},onClick:p,children:Q.jsx(sD,{})}),r&&Q.jsxs(yz,{children:[Q.jsx("div",{style:{display:"flex",width:"100%",justifyContent:"right",backgroundColor:"rgb(255 109 5 / 6%)"},children:Q.jsx(Mv,{onClick:p,children:Q.jsx(O_,{})})}),Q.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingLeft:"1em",justifyContent:"space-between",position:"relative",height:"100%",width:"100%",backgroundColor:"hsl(208.46deg 87% 53% / 20%)"},children:[Q.jsx(rV,{cameraRef:n}),Q.jsx(F3.In,{children:Q.jsx(nV,{style:{position:"absolute",top:"4em"}})})]})]})]})},cv=50,j3=(n,t)=>{const[r,l]=k.useState(null);return k.useLayoutEffect(()=>{if(t&&!t())return;const u=()=>{var p;if(!n.current){setTimeout(u,cv);return}const d=new dh().setFromObject(n.current);Math.abs((p=d.max)==null?void 0:p.x)===Number.POSITIVE_INFINITY?setTimeout(u,cv):l(d)};setTimeout(u,cv)},[n,t]),r};class oV extends Pe.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return console.error(t),{hasError:!0}}render(){return this.state.hasError?null:this.props.children}}const sV=({cube:n,intensity:t})=>{const{scene:r}=ar(),l=k.useMemo(()=>n.map(uc),[n]),[u]=ka(aD,[l]);return k.useEffect(()=>(u&&(r.background=u,r.backgroundIntensity=t),()=>{r.background=null}),[r,u,t]),null},aV=({image:n,intensity:t})=>{const{scene:r}=ar(),l=k.useMemo(()=>uc(n),[n]),u=ka(j_,l);return k.useEffect(()=>(r.background=u,r.backgroundIntensity=t,()=>{r.background=null}),[r,u,t]),null},lV=({color:n})=>{const{scene:t}=ar();return k.useEffect(()=>(t.background=new Ai(n),()=>{t.background=null}),[t,n]),null},cV=({background:n})=>n.cube?Q.jsx(sV,{cube:n.cube,intensity:n.intensity}):n.image?Q.jsx(aV,{image:n.image,intensity:n.intensity}):n.color?Q.jsx(lV,{color:n.color}):null,uV={isSceneInitialized:!1,upVector:null,sceneBoundingBox:null,pluginSettings:null,fo3dRoot:null},U3=k.createContext(uV),Ul=()=>k.useContext(U3),N3=(n,t,r)=>{const[l,u]=k.useState(t.length>0?0:null);k.useEffect(()=>{if(l===null)return;const p=r.clipAction(t[l]);return p&&p.play(),()=>{r.stopAllAction()}},[t,l,r]),mc((p,b)=>{r.update(b)});const d=k.useMemo(()=>{const p=Object.fromEntries(t.map((b,i)=>[b.name.split("|").pop(),i]));return p["NO ANIMATION"]=null,p},[t]);bp(()=>({Animations:Ud({[n]:{value:l,options:d,onChange:p=>{u(p)}}},{order:lD,render:()=>t.length>0})}),[t,l,d])},Bu=(n,t,r=!1)=>{const[l,u]=k.useState(t.opacity),[d,p]=k.useState(t.wireframe),[b,i]=k.useState(t.color??"#ffffff"),[E,T]=k.useState(t.metalness??0),[A,I]=k.useState(t.roughness??1),[O,z]=k.useState(t.emissive??"#000000"),[U,N]=k.useState(t.emissiveIntensity??.1),V=k.useMemo(()=>r?{}:{color:{value:b,label:"Color",onChange:i,render:()=>t._type!=="MeshDepthMaterial",order:1004},metalness:{value:E,min:0,max:1,step:.1,label:"Metalness",onChange:T,render:()=>t._type==="MeshStandardMaterial",order:1005},roughness:{value:A,min:0,max:1,step:.1,label:"Roughness",onChange:I,render:()=>t._type==="MeshStandardMaterial",order:1006},emissiveIntensity:{value:U,min:0,max:1,step:.1,label:"Emissive Intensity",onChange:N,render:()=>t._type!=="MeshDepthMaterial"&&t._type!=="MeshBasicMaterial",order:1007},emissiveColor:{value:O,label:"Emissive Color",onChange:z,render:J=>J(`${n}.emissiveIntensity`)>0,order:1008}},[b,O,U,t._type,E,A,n,r]);return bp(()=>({[n]:Ud({materialTypeLabel:{value:r?"Custom":t._type,label:"Material Type",editable:!1,order:-1},opacity:{value:l,min:0,max:1,step:.1,onChange:u,label:"Opacity",order:1e3},wireframe:{value:d,label:"Wireframe",onChange:p,order:1002},...V},{order:nS,collapsed:!0})}),[r,t,l,d,n,V]),{material:k.useMemo(()=>g7({...t,opacity:l,wireframe:d,color:b,metalness:E,roughness:A,emissiveColor:O,emissiveIntensity:U}),[t,l,d,b,E,A,O,U])}},ZA=(n,t,r)=>{r.foOriginalMaterialConfig||(r.foOriginalMaterialConfig={transparent:n.transparent,depthWrite:n.depthWrite,alphaTest:n.alphaTest}),t.opacity<1?(n.transparent=!0,n.depthWrite=!1,n.alphaTest=Number.EPSILON):(n.transparent=r.foOriginalMaterialConfig.transparent,n.depthWrite=r.foOriginalMaterialConfig.depthWrite,n.alphaTest=r.foOriginalMaterialConfig.alphaTest),n.opacity=t.opacity,Object.prototype.hasOwnProperty.call(n,"wireframe")&&(n.wireframe=t.wireframe??!1)},G3=(n,t)=>{k.useEffect(()=>{n.traverse(r=>{if(r.material)if(Array.isArray(r.material))for(const l of r.material)ZA(l,t,r.userData);else ZA(r.material,t,r.userData)})},[n,t])},hV=({name:n,fbx:{fbxPath:t,preTransformedFbxPath:r,defaultMaterial:l},position:u,quaternion:d,scale:p,children:b})=>{const{fo3dRoot:i}=Ul(),E=k.useMemo(()=>r??uc(Iu(t,i)),[t,r,i]),T=k.useMemo(()=>ny(i,E),[i,E]),{material:A}=Bu(n,l,!0),I=ka(d4,E,U=>{U.setResourcePath(T)});G3(I,A);const O=k.useMemo(()=>(I==null?void 0:I.animations)||[],[I]),z=k.useMemo(()=>new rS(I),[I]);return N3(n,O,z),I?Q.jsx("primitive",{object:I,position:u,quaternion:d,scale:p,children:b??null}):null},dV=({name:n,gltf:{gltfPath:t,preTransformedGltfPath:r,defaultMaterial:l},position:u,quaternion:d,scale:p,children:b})=>{const{fo3dRoot:i}=Ul(),E=k.useMemo(()=>r??uc(Iu(t,i)),[t,r,i]),T=k.useMemo(()=>ny(i,E),[i,E]),{material:A}=Bu(n,l,!0),{scene:I,animations:O}=q_(E,!0,void 0,N=>{N.setResourcePath(T)});G3(I,A);const z=k.useRef(),U=k.useMemo(()=>new rS(I),[I]);return N3(n,O,U),I?Q.jsx("primitive",{ref:z,object:I,position:u,quaternion:d,scale:p,dispose:null,children:b??null}):null};class fV extends Jh{constructor(t){super(t)}load(t,r,l,u){const d=this,p=this.path===""?Dl.extractUrlBase(t):this.path,b=new Tu(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(t,function(i){try{r(d.parse(i,p))}catch(E){u?u(E):console.error(E),d.manager.itemError(t)}},l,u)}setMaterialOptions(t){return this.materialOptions=t,this}parse(t,r){const l=t.split(`
`);let u={};const d=/\s+/,p={};for(let i=0;i<l.length;i++){let E=l[i];if(E=E.trim(),E.length===0||E.charAt(0)==="#")continue;const T=E.indexOf(" ");let A=T>=0?E.substring(0,T):E;A=A.toLowerCase();let I=T>=0?E.substring(T+1):"";if(I=I.trim(),A==="newmtl")u={name:I},p[I]=u;else if(A==="ka"||A==="kd"||A==="ks"||A==="ke"){const O=I.split(d,3);u[A]=[parseFloat(O[0]),parseFloat(O[1]),parseFloat(O[2])]}else u[A]=I}const b=new pV(this.resourcePath||r,this.materialOptions);return b.setCrossOrigin(this.crossOrigin),b.setManager(this.manager),b.setMaterials(p),b}}class pV{constructor(t="",r={}){this.baseUrl=t,this.options=r,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:OT,this.wrap=this.options.wrap!==void 0?this.options.wrap:tp}setCrossOrigin(t){return this.crossOrigin=t,this}setManager(t){this.manager=t}setMaterials(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(t){if(!this.options)return t;const r={};for(const l in t){const u=t[l],d={};r[l]=d;for(const p in u){let b=!0,i=u[p];const E=p.toLowerCase();switch(E){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(i=[i[0]/255,i[1]/255,i[2]/255]),this.options&&this.options.ignoreZeroRGBs&&i[0]===0&&i[1]===0&&i[2]===0&&(b=!1);break}b&&(d[E]=i)}}return r}preload(){for(const t in this.materialsInfo)this.create(t)}getIndex(t){return this.nameLookup[t]}getAsArray(){let t=0;for(const r in this.materialsInfo)this.materialsArray[t]=this.create(r),this.nameLookup[r]=t,t++;return this.materialsArray}create(t){return this.materials[t]===void 0&&this.createMaterial_(t),this.materials[t]}createMaterial_(t){const r=this,l=this.materialsInfo[t],u={name:t,side:this.side};function d(b,i){return typeof i!="string"||i===""?"":/^https?:\/\//i.test(i)?i:b+i}function p(b,i){if(u[b])return;const E=r.getTextureParams(i,u),T=r.loadTexture(d(r.baseUrl,E.url));T.repeat.copy(E.scale),T.offset.copy(E.offset),T.wrapS=r.wrap,T.wrapT=r.wrap,(b==="map"||b==="emissiveMap")&&(T.colorSpace=cD),u[b]=T}for(const b in l){const i=l[b];let E;if(i!=="")switch(b.toLowerCase()){case"kd":u.color=new Ai().fromArray(i).convertSRGBToLinear();break;case"ks":u.specular=new Ai().fromArray(i).convertSRGBToLinear();break;case"ke":u.emissive=new Ai().fromArray(i).convertSRGBToLinear();break;case"map_kd":p("map",i);break;case"map_ks":p("specularMap",i);break;case"map_ke":p("emissiveMap",i);break;case"norm":p("normalMap",i);break;case"map_bump":case"bump":p("bumpMap",i);break;case"map_d":p("alphaMap",i),u.transparent=!0;break;case"ns":u.shininess=parseFloat(i);break;case"d":E=parseFloat(i),E<1&&(u.opacity=E,u.transparent=!0);break;case"tr":E=parseFloat(i),this.options&&this.options.invertTrProperty&&(E=1-E),E>0&&(u.opacity=1-E,u.transparent=!0);break}}return this.materials[t]=new Xf(u),this.materials[t]}getTextureParams(t,r){const l={scale:new Zo(1,1),offset:new Zo(0,0)},u=t.split(/\s+/);let d;return d=u.indexOf("-bm"),d>=0&&(r.bumpScale=parseFloat(u[d+1]),u.splice(d,2)),d=u.indexOf("-s"),d>=0&&(l.scale.set(parseFloat(u[d+1]),parseFloat(u[d+2])),u.splice(d,4)),d=u.indexOf("-o"),d>=0&&(l.offset.set(parseFloat(u[d+1]),parseFloat(u[d+2])),u.splice(d,4)),l.url=u.join(" ").trim(),l}loadTexture(t,r,l,u,d){const p=this.manager!==void 0?this.manager:_m;let b=p.getHandler(t);b===null&&(b=new j_(p)),b.setCrossOrigin&&b.setCrossOrigin(this.crossOrigin);const i=b.load(t,l,u,d);return r!==void 0&&(i.mapping=r),i}}const mV=/^[og]\s*(.+)?/,gV=/^mtllib /,_V=/^usemtl /,yV=/^usemap /,XA=/\s+/,qA=new Tt,uv=new Tt,KA=new Tt,JA=new Tt,rc=new Tt,r_=new Ai;function vV(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,r){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=r!==!1;return}const l=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:r!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(u,d){const p=this._finalize(!1);p&&(p.inherited||p.groupCount<=0)&&this.materials.splice(p.index,1);const b={index:this.materials.length,name:u||"",mtllib:Array.isArray(d)&&d.length>0?d[d.length-1]:"",smooth:p!==void 0?p.smooth:this.smooth,groupStart:p!==void 0?p.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(i){const E={index:typeof i=="number"?i:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return E.clone=this.clone.bind(E),E}};return this.materials.push(b),b},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(u){const d=this.currentMaterial();if(d&&d.groupEnd===-1&&(d.groupEnd=this.geometry.vertices.length/3,d.groupCount=d.groupEnd-d.groupStart,d.inherited=!1),u&&this.materials.length>1)for(let p=this.materials.length-1;p>=0;p--)this.materials[p].groupCount<=0&&this.materials.splice(p,1);return u&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),d}},l&&l.name&&typeof l.clone=="function"){const u=l.clone(0);u.inherited=!0,this.object.materials.push(u)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,r){const l=parseInt(t,10);return(l>=0?l-1:l+r/3)*3},parseNormalIndex:function(t,r){const l=parseInt(t,10);return(l>=0?l-1:l+r/3)*3},parseUVIndex:function(t,r){const l=parseInt(t,10);return(l>=0?l-1:l+r/2)*2},addVertex:function(t,r,l){const u=this.vertices,d=this.object.geometry.vertices;d.push(u[t+0],u[t+1],u[t+2]),d.push(u[r+0],u[r+1],u[r+2]),d.push(u[l+0],u[l+1],u[l+2])},addVertexPoint:function(t){const r=this.vertices;this.object.geometry.vertices.push(r[t+0],r[t+1],r[t+2])},addVertexLine:function(t){const r=this.vertices;this.object.geometry.vertices.push(r[t+0],r[t+1],r[t+2])},addNormal:function(t,r,l){const u=this.normals,d=this.object.geometry.normals;d.push(u[t+0],u[t+1],u[t+2]),d.push(u[r+0],u[r+1],u[r+2]),d.push(u[l+0],u[l+1],u[l+2])},addFaceNormal:function(t,r,l){const u=this.vertices,d=this.object.geometry.normals;qA.fromArray(u,t),uv.fromArray(u,r),KA.fromArray(u,l),rc.subVectors(KA,uv),JA.subVectors(qA,uv),rc.cross(JA),rc.normalize(),d.push(rc.x,rc.y,rc.z),d.push(rc.x,rc.y,rc.z),d.push(rc.x,rc.y,rc.z)},addColor:function(t,r,l){const u=this.colors,d=this.object.geometry.colors;u[t]!==void 0&&d.push(u[t+0],u[t+1],u[t+2]),u[r]!==void 0&&d.push(u[r+0],u[r+1],u[r+2]),u[l]!==void 0&&d.push(u[l+0],u[l+1],u[l+2])},addUV:function(t,r,l){const u=this.uvs,d=this.object.geometry.uvs;d.push(u[t+0],u[t+1]),d.push(u[r+0],u[r+1]),d.push(u[l+0],u[l+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const r=this.uvs;this.object.geometry.uvs.push(r[t+0],r[t+1])},addFace:function(t,r,l,u,d,p,b,i,E){const T=this.vertices.length;let A=this.parseVertexIndex(t,T),I=this.parseVertexIndex(r,T),O=this.parseVertexIndex(l,T);if(this.addVertex(A,I,O),this.addColor(A,I,O),b!==void 0&&b!==""){const z=this.normals.length;A=this.parseNormalIndex(b,z),I=this.parseNormalIndex(i,z),O=this.parseNormalIndex(E,z),this.addNormal(A,I,O)}else this.addFaceNormal(A,I,O);if(u!==void 0&&u!==""){const z=this.uvs.length;A=this.parseUVIndex(u,z),I=this.parseUVIndex(d,z),O=this.parseUVIndex(p,z),this.addUV(A,I,O),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const r=this.vertices.length;for(let l=0,u=t.length;l<u;l++){const d=this.parseVertexIndex(t[l],r);this.addVertexPoint(d),this.addColor(d)}},addLineGeometry:function(t,r){this.object.geometry.type="Line";const l=this.vertices.length,u=this.uvs.length;for(let d=0,p=t.length;d<p;d++)this.addVertexLine(this.parseVertexIndex(t[d],l));for(let d=0,p=r.length;d<p;d++)this.addUVLine(this.parseUVIndex(r[d],u))}};return n.startObject("",!1),n}class V3 extends Jh{constructor(t){super(t),this.materials=null}load(t,r,l,u){const d=this,p=new Tu(this.manager);p.setPath(this.path),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(t,function(b){try{r(d.parse(b))}catch(i){u?u(i):console.error(i),d.manager.itemError(t)}},l,u)}setMaterials(t){return this.materials=t,this}parse(t){const r=new vV;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));const l=t.split(`
`);let u=[];for(let b=0,i=l.length;b<i;b++){const E=l[b].trimStart();if(E.length===0)continue;const T=E.charAt(0);if(T!=="#")if(T==="v"){const A=E.split(XA);switch(A[0]){case"v":r.vertices.push(parseFloat(A[1]),parseFloat(A[2]),parseFloat(A[3])),A.length>=7?(r_.setRGB(parseFloat(A[4]),parseFloat(A[5]),parseFloat(A[6])).convertSRGBToLinear(),r.colors.push(r_.r,r_.g,r_.b)):r.colors.push(void 0,void 0,void 0);break;case"vn":r.normals.push(parseFloat(A[1]),parseFloat(A[2]),parseFloat(A[3]));break;case"vt":r.uvs.push(parseFloat(A[1]),parseFloat(A[2]));break}}else if(T==="f"){const I=E.slice(1).trim().split(XA),O=[];for(let U=0,N=I.length;U<N;U++){const V=I[U];if(V.length>0){const X=V.split("/");O.push(X)}}const z=O[0];for(let U=1,N=O.length-1;U<N;U++){const V=O[U],X=O[U+1];r.addFace(z[0],V[0],X[0],z[1],V[1],X[1],z[2],V[2],X[2])}}else if(T==="l"){const A=E.substring(1).trim().split(" ");let I=[];const O=[];if(E.indexOf("/")===-1)I=A;else for(let z=0,U=A.length;z<U;z++){const N=A[z].split("/");N[0]!==""&&I.push(N[0]),N[1]!==""&&O.push(N[1])}r.addLineGeometry(I,O)}else if(T==="p"){const I=E.slice(1).trim().split(" ");r.addPointGeometry(I)}else if((u=mV.exec(E))!==null){const A=(" "+u[0].slice(1).trim()).slice(1);r.startObject(A)}else if(_V.test(E))r.object.startMaterial(E.substring(7).trim(),r.materialLibraries);else if(gV.test(E))r.materialLibraries.push(E.substring(7).trim());else if(yV.test(E))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(T==="s"){if(u=E.split(" "),u.length>1){const I=u[1].trim().toLowerCase();r.object.smooth=I!=="0"&&I!=="off"}else r.object.smooth=!0;const A=r.object.currentMaterial();A&&(A.smooth=r.object.smooth)}else{if(E==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+E+'"')}}r.finalize();const d=new Zf;if(d.materialLibraries=[].concat(r.materialLibraries),!(r.objects.length===1&&r.objects[0].geometry.vertices.length===0)===!0)for(let b=0,i=r.objects.length;b<i;b++){const E=r.objects[b],T=E.geometry,A=E.materials,I=T.type==="Line",O=T.type==="Points";let z=!1;if(T.vertices.length===0)continue;const U=new _l;U.setAttribute("position",new Ti(T.vertices,3)),T.normals.length>0&&U.setAttribute("normal",new Ti(T.normals,3)),T.colors.length>0&&(z=!0,U.setAttribute("color",new Ti(T.colors,3))),T.hasUVIndices===!0&&U.setAttribute("uv",new Ti(T.uvs,2));const N=[];for(let X=0,J=A.length;X<J;X++){const te=A[X],ue=te.name+"_"+te.smooth+"_"+z;let ae=r.materials[ue];if(this.materials!==null){if(ae=this.materials.create(te.name),I&&ae&&!(ae instanceof vm)){const be=new vm;Wf.prototype.copy.call(be,ae),be.color.copy(ae.color),ae=be}else if(O&&ae&&!(ae instanceof Cd)){const be=new Cd({size:10,sizeAttenuation:!1});Wf.prototype.copy.call(be,ae),be.color.copy(ae.color),be.map=ae.map,ae=be}}ae===void 0&&(I?ae=new vm:O?ae=new Cd({size:1,sizeAttenuation:!1}):ae=new Xf,ae.name=te.name,ae.flatShading=!te.smooth,ae.vertexColors=z,r.materials[ue]=ae),N.push(ae)}let V;if(N.length>1){for(let X=0,J=A.length;X<J;X++){const te=A[X];U.addGroup(te.groupStart,te.groupCount,X)}I?V=new d_(U,N):O?V=new Id(U,N):V=new Oa(U,N)}else I?V=new d_(U,N[0]):O?V=new Id(U,N[0]):V=new Oa(U,N[0]);V.name=E.name,d.add(V)}else if(r.vertices.length>0){const b=new Cd({size:1,sizeAttenuation:!1}),i=new _l;i.setAttribute("position",new Ti(r.vertices,3)),r.colors.length>0&&r.colors[0]!==void 0&&(i.setAttribute("color",new Ti(r.colors,3)),b.vertexColors=!0);const E=new Id(i,b);d.add(E)}return d}}const xV=({name:n,obj:t,onLoad:r})=>{const{objPath:l}=t,{fo3dRoot:u}=Ul(),d=k.useMemo(()=>uc(Iu(l,u)),[l,u]),p=ka(V3,d),{material:b}=Bu(n,t.defaultMaterial);return k.useEffect(()=>{p&&(p.traverse(i=>{if(i instanceof Oa)try{i.material=b}catch{i.material=new km({color:uD(d)})}}),r==null||r())},[p,d,b,r]),Q.jsx("primitive",{object:p})},bV=({obj:n,onLoad:t})=>{const{objPath:r,mtlPath:l,preTransformedObjPath:u,preTransformedMtlPath:d}=n,{fo3dRoot:p}=Ul(),b=k.useMemo(()=>u??uc(Iu(r,p)),[r,u,p]),i=k.useMemo(()=>d??uc(Iu(l,p)),[l,d,p]),E=k.useMemo(()=>i?ny(p,i):null,[p,i]),T=ka(fV,i,I=>{E&&I.setResourcePath(E)}),A=ka(V3,b,I=>{i&&(T.preload(),I.setMaterials(T))});return k.useEffect(()=>{A&&(t==null||t())},[A,t]),Q.jsx("primitive",{object:A})},wV=({name:n,obj:t,position:r,quaternion:l,scale:u,children:d})=>Q.jsxs("group",{position:r,quaternion:l,scale:u,children:[t.mtlPath?Q.jsx(bV,{name:n,obj:t}):Q.jsx(xV,{name:n,obj:t}),d??null]}),fl=new Ai;class EV extends Jh{constructor(t){super(t),this.propertyNameMapping={},this.customPropertyMapping={}}load(t,r,l,u){const d=this,p=new Tu(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(t,function(b){try{r(d.parse(b))}catch(i){u?u(i):console.error(i),d.manager.itemError(t)}},l,u)}setPropertyNameMapping(t){this.propertyNameMapping=t}setCustomPropertyNameMapping(t){this.customPropertyMapping=t}parse(t){function r(N,V=0){const X=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let J="";const te=X.exec(N);te!==null&&(J=te[1]);const ue={comments:[],elements:[],headerLength:V,objInfo:""},ae=J.split(/\r\n|\r|\n/);let be;function Ce(je,me){const Ne={type:je[0]};return Ne.type==="list"?(Ne.name=je[3],Ne.countType=je[1],Ne.itemType=je[2]):Ne.name=je[1],Ne.name in me&&(Ne.name=me[Ne.name]),Ne}for(let je=0;je<ae.length;je++){let me=ae[je];if(me=me.trim(),me==="")continue;const Ne=me.split(/\s+/),ht=Ne.shift();switch(me=Ne.join(" "),ht){case"format":ue.format=Ne[0],ue.version=Ne[1];break;case"comment":ue.comments.push(me);break;case"element":be!==void 0&&ue.elements.push(be),be={},be.name=Ne[0],be.count=parseInt(Ne[1]),be.properties=[];break;case"property":be.properties.push(Ce(Ne,U.propertyNameMapping));break;case"obj_info":ue.objInfo=me;break;default:console.log("unhandled",ht,Ne)}}return be!==void 0&&ue.elements.push(be),ue}function l(N,V){switch(V){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(N);case"float":case"double":case"float32":case"float64":return parseFloat(N)}}function u(N,V){const X={};for(let J=0;J<N.length;J++){if(V.empty())return null;if(N[J].type==="list"){const te=[],ue=l(V.next(),N[J].countType);for(let ae=0;ae<ue;ae++){if(V.empty())return null;te.push(l(V.next(),N[J].itemType))}X[N[J].name]=te}else X[N[J].name]=l(V.next(),N[J].type)}return X}function d(){const N={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const V of Object.keys(U.customPropertyMapping))N[V]=[];return N}function p(N){const V=N.map(J=>J.name);function X(J){for(let te=0,ue=J.length;te<ue;te++){const ae=J[te];if(V.includes(ae))return ae}return null}return{attrX:X(["x","px","posx"])||"x",attrY:X(["y","py","posy"])||"y",attrZ:X(["z","pz","posz"])||"z",attrNX:X(["nx","normalx"]),attrNY:X(["ny","normaly"]),attrNZ:X(["nz","normalz"]),attrS:X(["s","u","texture_u","tx"]),attrT:X(["t","v","texture_v","ty"]),attrR:X(["red","diffuse_red","r","diffuse_r"]),attrG:X(["green","diffuse_green","g","diffuse_g"]),attrB:X(["blue","diffuse_blue","b","diffuse_b"])}}function b(N,V){const X=d(),J=/end_header\s+(\S[\s\S]*\S|\S)\s*$/;let te,ue;(ue=J.exec(N))!==null?te=ue[1].split(/\s+/):te=[];const ae=new CV(te);e:for(let be=0;be<V.elements.length;be++){const Ce=V.elements[be],je=p(Ce.properties);for(let me=0;me<Ce.count;me++){const Ne=u(Ce.properties,ae);if(!Ne)break e;E(X,Ce.name,Ne,je)}}return i(X)}function i(N){let V=new _l;N.indices.length>0&&V.setIndex(N.indices),V.setAttribute("position",new Ti(N.vertices,3)),N.normals.length>0&&V.setAttribute("normal",new Ti(N.normals,3)),N.uvs.length>0&&V.setAttribute("uv",new Ti(N.uvs,2)),N.colors.length>0&&V.setAttribute("color",new Ti(N.colors,3)),(N.faceVertexUvs.length>0||N.faceVertexColors.length>0)&&(V=V.toNonIndexed(),N.faceVertexUvs.length>0&&V.setAttribute("uv",new Ti(N.faceVertexUvs,2)),N.faceVertexColors.length>0&&V.setAttribute("color",new Ti(N.faceVertexColors,3)));for(const X of Object.keys(U.customPropertyMapping))N[X].length>0&&V.setAttribute(X,new Ti(N[X],U.customPropertyMapping[X].length));return V.computeBoundingSphere(),V}function E(N,V,X,J){if(V==="vertex"){N.vertices.push(X[J.attrX],X[J.attrY],X[J.attrZ]),J.attrNX!==null&&J.attrNY!==null&&J.attrNZ!==null&&N.normals.push(X[J.attrNX],X[J.attrNY],X[J.attrNZ]),J.attrS!==null&&J.attrT!==null&&N.uvs.push(X[J.attrS],X[J.attrT]),J.attrR!==null&&J.attrG!==null&&J.attrB!==null&&(fl.setRGB(X[J.attrR]/255,X[J.attrG]/255,X[J.attrB]/255).convertSRGBToLinear(),N.colors.push(fl.r,fl.g,fl.b));for(const te of Object.keys(U.customPropertyMapping))for(const ue of U.customPropertyMapping[te])N[te].push(X[ue])}else if(V==="face"){const te=X.vertex_indices||X.vertex_index,ue=X.texcoord;te.length===3?(N.indices.push(te[0],te[1],te[2]),ue&&ue.length===6&&(N.faceVertexUvs.push(ue[0],ue[1]),N.faceVertexUvs.push(ue[2],ue[3]),N.faceVertexUvs.push(ue[4],ue[5]))):te.length===4&&(N.indices.push(te[0],te[1],te[3]),N.indices.push(te[1],te[2],te[3])),J.attrR!==null&&J.attrG!==null&&J.attrB!==null&&(fl.setRGB(X[J.attrR]/255,X[J.attrG]/255,X[J.attrB]/255).convertSRGBToLinear(),N.faceVertexColors.push(fl.r,fl.g,fl.b),N.faceVertexColors.push(fl.r,fl.g,fl.b),N.faceVertexColors.push(fl.r,fl.g,fl.b))}}function T(N,V){const X={};let J=0;for(let te=0;te<V.length;te++){const ue=V[te],ae=ue.valueReader;if(ue.type==="list"){const be=[],Ce=ue.countReader.read(N+J);J+=ue.countReader.size;for(let je=0;je<Ce;je++)be.push(ae.read(N+J)),J+=ae.size;X[ue.name]=be}else X[ue.name]=ae.read(N+J),J+=ae.size}return[X,J]}function A(N,V,X){function J(te,ue,ae){switch(ue){case"int8":case"char":return{read:be=>te.getInt8(be),size:1};case"uint8":case"uchar":return{read:be=>te.getUint8(be),size:1};case"int16":case"short":return{read:be=>te.getInt16(be,ae),size:2};case"uint16":case"ushort":return{read:be=>te.getUint16(be,ae),size:2};case"int32":case"int":return{read:be=>te.getInt32(be,ae),size:4};case"uint32":case"uint":return{read:be=>te.getUint32(be,ae),size:4};case"float32":case"float":return{read:be=>te.getFloat32(be,ae),size:4};case"float64":case"double":return{read:be=>te.getFloat64(be,ae),size:8}}}for(let te=0,ue=N.length;te<ue;te++){const ae=N[te];ae.type==="list"?(ae.countReader=J(V,ae.countType,X),ae.valueReader=J(V,ae.itemType,X)):ae.valueReader=J(V,ae.type,X)}}function I(N,V){const X=d(),J=V.format==="binary_little_endian",te=new DataView(N,V.headerLength);let ue,ae=0;for(let be=0;be<V.elements.length;be++){const Ce=V.elements[be],je=Ce.properties,me=p(je);A(je,te,J);for(let Ne=0;Ne<Ce.count;Ne++){ue=T(ae,je),ae+=ue[1];const ht=ue[0];E(X,Ce.name,ht,me)}}return i(X)}function O(N){let V=0,X=!0,J="";const te=[],ue=new TextDecoder().decode(N.subarray(0,5)),ae=/^ply\r\n/.test(ue);do{const be=String.fromCharCode(N[V++]);be!==`
`&&be!=="\r"?J+=be:(J==="end_header"&&(X=!1),J!==""&&(te.push(J),J=""))}while(X&&V<N.length);return ae===!0&&V++,{headerText:te.join("\r")+"\r",headerLength:V}}let z;const U=this;if(t instanceof ArrayBuffer){const N=new Uint8Array(t),{headerText:V,headerLength:X}=O(N),J=r(V,X);if(J.format==="ascii"){const te=new TextDecoder().decode(N);z=b(te,J)}else z=I(t,J)}else z=b(t,r(t));return z}}class CV{constructor(t){this.arr=t,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}const AV=(n,t)=>{const[r,l]=k.useState(t.shadingMode),[u,d]=k.useState(t.customColor),[p,b]=k.useState(t.pointSize),[i,E]=k.useState(t.attenuateByDistance),[T,A]=k.useState(t.opacity),I=k.useCallback(O=>{b(O)},[]);return bp(()=>({[n]:Ud({pointSize:{value:p??1,min:.01,max:50,step:.01,onChange:I,label:"Points Size",order:-2},shadeBy:{value:r??Md,options:[hD,Md,p_,E1,Mm],label:"Shade By",onChange:l,order:-1},[`${n} color`]:{value:u||"#ffffff",label:`${n} color`,onChange:O=>{d(O)},render:()=>r===Mm},isPointSizeAttenuated:{value:i??!1,onChange:E,label:"Attenuated",order:1e3}},{order:nS,collapsed:!0})}),[t,T,p,r,u,I]),{shadeBy:r,customColor:u,isPointSizeAttenuated:i,opacity:T,pointSize:p}},$3=(n,t,r,l)=>{const{upVector:u,pluginSettings:d}=Ul(),{customColor:p,pointSize:b,isPointSizeAttenuated:i,shadeBy:E,opacity:T}=AV(n,r),A=j3(l,k.useCallback(()=>!!t&&E===Md,[t,E])),I=k.useMemo(()=>{var X;if(E!==Md||!A||!u)return null;if((X=d==null?void 0:d.pointCloud)!=null&&X.minZ)return[d.pointCloud.minZ,A.max.z];const N=A.min.dot(u),V=A.max.dot(u);return[N,V]},[u,A,E,d]),{min:O,max:z}=k.useMemo(()=>{if(E!==p_||!t)return{min:0,max:1};const N=t.getAttribute("color")??t.getAttribute("intensity");return N?XT(N):{min:0,max:1}},[t,E]);return k.useMemo(()=>{const N=`${n}-${T}-${b}-${i}-${E}-${p}-${I}-${O}-${z}-${u}`;switch(E){case Md:return Q.jsx(w3,{gradients:m_,min:(I==null?void 0:I.at(0))??0,max:(I==null?void 0:I.at(1))??100,upVector:u,pointSize:b,opacity:T,isPointSizeAttenuated:i},N);case p_:return Q.jsx(E3,{min:O,max:z,gradients:m_,pointSize:b,opacity:T,isPointSizeAttenuated:i},N);case E1:return Q.jsx(C3,{pointSize:b,opacity:T,isPointSizeAttenuated:i},N);case Mm:return Q.jsx(A3,{pointSize:b,opacity:T,isPointSizeAttenuated:i,color:p||"#ffffff"},N);default:return Q.jsx("pointsMaterial",{color:"#ffffff",size:i?b/1e3:b/2,opacity:T,sizeAttenuation:i})}},[E,b,i,p,I,O,z,t,u,T,n])},TV=({name:n,geometry:t,defaultMaterial:r})=>{const l={shadingMode:"height",customColor:r.color??"#ffffff",pointSize:2,attenuateByDistance:!1,opacity:r.opacity},u=k.useRef(),d=$3(n,t,l,u),p=k.useMemo(()=>new Id(t),[t]);return!t||!d?null:Q.jsx("primitive",{ref:u,object:p,children:d})},SV=({name:n,geometry:t,defaultMaterial:r})=>{const l=k.useMemo(()=>({...r,vertexColors:!0,color:"#ffffff"}),[r]),{material:u}=Bu(n,l),d=k.useMemo(()=>new Oa(t,u),[t,u]);return d?Q.jsx("primitive",{object:d}):null},MV=({name:n,geometry:t,defaultMaterial:r})=>{const{material:l}=Bu(n,r),u=k.useMemo(()=>new Oa(t,l),[t,l]);return u?Q.jsx("primitive",{object:u}):null},IV=({name:n,ply:{plyPath:t,preTransformedPlyPath:r,defaultMaterial:l,isPcd:u},position:d,quaternion:p,scale:b,children:i})=>{const{fo3dRoot:E}=Ul(),T=k.useMemo(()=>r??uc(Iu(t,E)),[t,r,E]),A=k.useMemo(()=>ny(E,T),[E,T]),I=ka(EV,T,X=>{X.resourcePath=A}),[O,z]=k.useState(!1),[U,N]=k.useState(!1);k.useEffect(()=>{var X,J,te,ue,ae;I&&((J=(X=I.attributes)==null?void 0:X.position)!=null&&J.count&&!((te=I.attributes.normal)!=null&&te.count)&&(I.computeVertexNormals(),I.center()),(ae=(ue=I.attributes)==null?void 0:ue.color)!=null&&ae.count&&z(!0),N(!0))},[I]);const V=k.useMemo(()=>U?u?Q.jsx(TV,{name:n,geometry:I,defaultMaterial:l}):O?Q.jsx(SV,{name:n,geometry:I,defaultMaterial:l}):Q.jsx(MV,{name:n,geometry:I,defaultMaterial:l}):null,[U,O,I,u,n,l]);return V?Q.jsxs("group",{position:d,quaternion:p,scale:b,children:[V,Q.jsx("group",{children:i??null})]}):null};class PV extends Jh{constructor(t){super(t)}load(t,r,l,u){const d=this,p=new Tu(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(t,function(b){try{r(d.parse(b))}catch(i){u?u(i):console.error(i),d.manager.itemError(t)}},l,u)}parse(t){function r(E){const T=new DataView(E),A=32/8*3+32/8*3*3+16/8,I=T.getUint32(80,!0);if(80+32/8+I*A===T.byteLength)return!0;const z=[115,111,108,105,100];for(let U=0;U<5;U++)if(l(z,T,U))return!1;return!0}function l(E,T,A){for(let I=0,O=E.length;I<O;I++)if(E[I]!==T.getUint8(A+I))return!1;return!0}function u(E){const T=new DataView(E),A=T.getUint32(80,!0);let I,O,z,U=!1,N,V,X,J,te;for(let Ne=0;Ne<70;Ne++)T.getUint32(Ne,!1)==1129270351&&T.getUint8(Ne+4)==82&&T.getUint8(Ne+5)==61&&(U=!0,N=new Float32Array(A*3*3),V=T.getUint8(Ne+6)/255,X=T.getUint8(Ne+7)/255,J=T.getUint8(Ne+8)/255,te=T.getUint8(Ne+9)/255);const ue=84,ae=12*4+2,be=new _l,Ce=new Float32Array(A*3*3),je=new Float32Array(A*3*3),me=new Ai;for(let Ne=0;Ne<A;Ne++){const ht=ue+Ne*ae,_t=T.getFloat32(ht,!0),Bt=T.getFloat32(ht+4,!0),Kt=T.getFloat32(ht+8,!0);if(U){const Gt=T.getUint16(ht+48,!0);Gt&32768?(I=V,O=X,z=J):(I=(Gt&31)/31,O=(Gt>>5&31)/31,z=(Gt>>10&31)/31)}for(let Gt=1;Gt<=3;Gt++){const hn=ht+Gt*12,wt=Ne*3*3+(Gt-1)*3;Ce[wt]=T.getFloat32(hn,!0),Ce[wt+1]=T.getFloat32(hn+4,!0),Ce[wt+2]=T.getFloat32(hn+8,!0),je[wt]=_t,je[wt+1]=Bt,je[wt+2]=Kt,U&&(me.set(I,O,z).convertSRGBToLinear(),N[wt]=me.r,N[wt+1]=me.g,N[wt+2]=me.b)}}return be.setAttribute("position",new Vh(Ce,3)),be.setAttribute("normal",new Vh(je,3)),U&&(be.setAttribute("color",new Vh(N,3)),be.hasColors=!0,be.alpha=te),be}function d(E){const T=new _l,A=/solid([\s\S]*?)endsolid/g,I=/facet([\s\S]*?)endfacet/g,O=/solid\s(.+)/;let z=0;const U=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,N=new RegExp("vertex"+U+U+U,"g"),V=new RegExp("normal"+U+U+U,"g"),X=[],J=[],te=[],ue=new Tt;let ae,be=0,Ce=0,je=0;for(;(ae=A.exec(E))!==null;){Ce=je;const me=ae[0],Ne=(ae=O.exec(me))!==null?ae[1]:"";for(te.push(Ne);(ae=I.exec(me))!==null;){let Bt=0,Kt=0;const Gt=ae[0];for(;(ae=V.exec(Gt))!==null;)ue.x=parseFloat(ae[1]),ue.y=parseFloat(ae[2]),ue.z=parseFloat(ae[3]),Kt++;for(;(ae=N.exec(Gt))!==null;)X.push(parseFloat(ae[1]),parseFloat(ae[2]),parseFloat(ae[3])),J.push(ue.x,ue.y,ue.z),Bt++,je++;Kt!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+z),Bt!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+z),z++}const ht=Ce,_t=je-Ce;T.userData.groupNames=te,T.addGroup(ht,_t,be),be++}return T.setAttribute("position",new Ti(X,3)),T.setAttribute("normal",new Ti(J,3)),T}function p(E){return typeof E!="string"?new TextDecoder().decode(E):E}function b(E){if(typeof E=="string"){const T=new Uint8Array(E.length);for(let A=0;A<E.length;A++)T[A]=E.charCodeAt(A)&255;return T.buffer||T}else return E}const i=b(t);return r(i)?u(i):d(p(t))}}const LV=({name:n,stl:{stlPath:t,preTransformedStlPath:r,defaultMaterial:l},position:u,quaternion:d,scale:p,children:b})=>{const{fo3dRoot:i}=Ul(),E=k.useMemo(()=>r??uc(Iu(t,i)),[t,r,i]),T=ka(PV,E),[A,I]=k.useState(null),{material:O}=Bu(n,l);return k.useEffect(()=>{if(O&&T){T.computeVertexNormals();const z=new Oa(T,O);I(z)}},[T,E,O]),A?Q.jsx("primitive",{object:A,position:u,quaternion:d,scale:p,children:b??null}):null},BV=({name:n,pcd:{pcdPath:t,preTransformedPcdPath:r,defaultMaterial:l},position:u,quaternion:d,scale:p,children:b})=>{const{fo3dRoot:i}=Ul(),E=k.useMemo(()=>r??uc(Iu(t,i)),[t,r,i]),T=ka(x3,E),A=k.useMemo(()=>T.clone(!1),[T]),I=k.useRef(),O=$3(n,A.geometry,l,I);return A?Q.jsxs("primitive",{ref:I,object:A,position:u,quaternion:d,scale:p,children:[O,b??null]}):null},hv=3,RV=({name:n,box:t,position:r,quaternion:l,scale:u,children:d})=>{const p=k.useMemo(()=>new WT(t.width,t.height,t.depth,hv,hv,hv),[t]),{material:b}=Bu(n,t.defaultMaterial),i=k.useMemo(()=>b?new Oa(p,b):null,[p,b]);return Q.jsx("primitive",{position:r,quaternion:l,scale:u,object:i,children:d??null})},DV=({name:n,cylinder:t,position:r,quaternion:l,scale:u,children:d})=>{const p=k.useMemo(()=>new dD(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength),[t]),{material:b}=Bu(n,t.defaultMaterial),i=k.useMemo(()=>b?new Oa(p,b):null,[p,b]);return Q.jsx("primitive",{position:r,quaternion:l,scale:u,object:i,children:d??null})},YA=3,OV=({name:n,plane:t,position:r,quaternion:l,scale:u,children:d})=>{const p=k.useMemo(()=>new fD(t.width,t.height,YA,YA),[t]),{material:b}=Bu(n,t.defaultMaterial),i=k.useMemo(()=>b?(b.side=2,new Oa(p,b)):null,[p,b]);return Q.jsx("primitive",{position:r,quaternion:l,scale:u,object:i,children:d??null})},kV=({name:n,sphere:t,position:r,quaternion:l,scale:u,children:d})=>{const p=k.useMemo(()=>new pD(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength),[t]),{material:b}=Bu(n,t.defaultMaterial),i=k.useMemo(()=>b?new Oa(p,b):null,[p,b]);return Q.jsx("primitive",{position:r,quaternion:l,scale:u,object:i,children:d??null})},zV=(n,t)=>{if(!n.asset)return null;const r=o3(n);let l=null;const u=`${r}-${n.position.x}-${n.position.y}-${n.position.z}`;return n.asset instanceof d3?l=Q.jsx(wV,{name:n.name,obj:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof f3?l=Q.jsx(BV,{name:n.name,pcd:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof p3?l=Q.jsx(IV,{name:n.name,ply:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof m3?l=Q.jsx(LV,{name:n.name,stl:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof h3?l=Q.jsx(dV,{name:n.name,gltf:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof u3?l=Q.jsx(hV,{name:n.name,fbx:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof s3?l=Q.jsx(RV,{name:n.name,box:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof a3?l=Q.jsx(DV,{name:n.name,cylinder:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof c3?l=Q.jsx(kV,{name:n.name,sphere:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u):n.asset instanceof l3&&(l=Q.jsx(OV,{name:n.name,plane:n.asset,position:n.position,quaternion:n.quaternion,scale:n.scale,children:t},u)),l?Q.jsx(oV,{children:Q.jsx(k.Suspense,{fallback:null,children:l})}):null},H3=({node:n,visibilityMap:t})=>{const r=k.useMemo(()=>!n.children||n.children.length===0?null:n.children.map(p=>Q.jsx(H3,{node:p,visibilityMap:t},p.name)),[n,t]),l=k.useMemo(()=>o3(n),[n]),u=k.useMemo(()=>!!t[l],[l,t]);return k.useMemo(()=>u?zV(n,r):null,[n,r,u])},FV=({scene:n,visibilityMap:t})=>Q.jsx("group",{position:n.position,quaternion:n.quaternion,scale:n.scale,children:n.children.map(r=>Q.jsx(H3,{node:r,visibilityMap:t},r.name))}),jV=({scene:n})=>{const t=k.useMemo(()=>f7(n),[n]),{isSceneInitialized:r,fo3dRoot:l}=Ul(),u=bp("Visibility",t??{},{order:mD},[t]),d=sn(G1),p=ah(N1);return k.useEffect(()=>{r&&(n==null?void 0:n.background)!==null?p(!0):p(!1)},[n,r]),l?Q.jsxs(Q.Fragment,{children:[d&&n.background&&Q.jsx(V1,{ignoreError:!0,boundaryName:"background",children:Q.jsx(k.Suspense,{fallback:null,children:Q.jsx(cV,{background:n.background})})}),Q.jsx(FV,{scene:n,visibilityMap:u})]}):null},QA="#FF2160",eT="#21DF80",tT="#2280FF",UV="#6f6f6f",NV="#736f73",GV=({maxInOrthonormalPlane:n})=>{const{upVector:t}=Ul(),r=k.useMemo(()=>n*10+100,[n]),l=k.useMemo(()=>[{start:new Tt(-r/2,0,0),end:new Tt(r/2,0,0),color:QA},{start:new Tt(0,-r/2,0),end:new Tt(0,r/2,0),color:eT},{start:new Tt(0,0,-r/2),end:new Tt(0,0,r/2),color:tT}],[r]),u=k.useMemo(()=>l.filter(d=>!(d.color===QA&&t.x===1||d.color===eT&&t.y===1||d.color===tT&&t.z===1)).map(d=>Q.jsx(I4,{points:[d.start,d.end],color:d.color,lineWidth:1.1,opacity:.3,transparent:!0},d.color)),[t,l]);return Q.jsx(Q.Fragment,{children:u})},VV=()=>{const{upVector:n,sceneBoundingBox:t}=Ul(),r=sn(Z_),l=k.useMemo(()=>GT(n),[n]),u=k.useMemo(()=>t?t.getSize(new Tt):0,[t]),d=k.useMemo(()=>u?n.x===1?Math.max(u.y,u.z):n.y===1?Math.max(u.x,u.z):Math.max(u.x,u.y):0,[u,n]),[p,b]=Pi(CS),[i,E]=Pi(AS),T=sn(TS),A=sn(MS),I=sn(SS);k.useEffect(()=>{if(!u)return;const U=Math.max(u.x,u.y,u.z)/10,N=U<=1?1:Math.ceil(U/10)*10,V=N*10;b(N),E(V)},[u]);const O=k.useMemo(()=>d*10+100,[d]);return Q.jsxs(Q.Fragment,{children:[r&&Q.jsxs(Q.Fragment,{children:[Q.jsx(q4,{quaternion:l,infiniteGrid:T,side:x1,args:[I,I],cellSize:p,sectionSize:i,sectionColor:NV,cellColor:UV,fadeDistance:O,fadeStrength:A?1:0,followCamera:A,fadeFrom:.5,cellThickness:.5,sectionThickness:.4}),Q.jsx(GV,{maxInOrthonormalPlane:d})]}),Q.jsx(W4,{alignment:"top-left",margin:[80,100],children:Q.jsx(Z4,{})})]})},mm="fo-leva-container",nT="fo-leva-container-position";function $V(){const n=fc(),t=gD(),r=sn(_D(!0)),[l,u]=k.useState(!1),d=k.useCallback(A=>{const I=A.getBoundingClientRect(),O={x:I.x,y:I.y};localStorage.setItem(nT,JSON.stringify(O))},[]),p=k.useCallback(()=>{u(!0);const A=document.getElementById(mm).firstElementChild;d(A)},[d]),b=k.useCallback(()=>{if(!l)return;const A=document.getElementById(mm).firstElementChild;d(A)},[l,d]),i=k.useCallback(()=>{l&&u(!1)},[l]);k.useLayoutEffect(()=>{const A=document.getElementById(mm);if(!A)return;const I=A.firstElementChild;I.setAttribute("data-cy","leva-container");const O=I.firstElementChild;return O.setAttribute("data-cy","leva-container-header"),O.addEventListener("mousedown",p),O.addEventListener("mouseup",i),O.addEventListener("mousemove",b),()=>{O.removeEventListener("mousedown",p),O.removeEventListener("mouseup",i),O.removeEventListener("mousemove",b)}},[b,i,p]),k.useLayoutEffect(()=>{const A=document.getElementById(mm);if(!A)return;const I=localStorage.getItem(nT);if(I){const{x:O,y:z}=JSON.parse(I);A.style.left=`${O}px`,A.style.right="unset",A.style.top=`${z}px`}},[]);const[E,T]=yD("fo-is-leva-collapsed",!1);return Q.jsx(Q.Fragment,{children:cp.createPortal(Q.jsx(gz,{isSidebarVisible:r,id:mm,children:Q.jsx(i3,{theme:{colors:{accent1:n.primary.main,accent2:n.primary.main,accent3:n.background.default,elevation1:n.background.level3,elevation2:n.background.level1,elevation3:n.background.level2,highlight1:n.text.secondary,highlight2:n.text.secondary,highlight3:n.text.primary,folderWidgetColor:n.primary.main},fonts:{mono:t,sans:t}},fill:!0,hideCopyButton:!0,flat:!0,collapsed:{collapsed:E,onChange:T}})}),document.getElementById("modal"))})}const Cx=n=>`${n}Intensity`,Ax=n=>`${n}Color`,Tx=n=>`${n}Position`,W3=n=>`${n}Decay`,Z3=(n,t)=>{const{sceneBoundingBox:r}=Ul(),[l,u]=k.useState(null),d=k.useCallback((I,O)=>{u({type:I,lightIndex:O})},[]),p=k.useCallback(()=>{u(null)},[]),b=k.useMemo(()=>{const I={};for(let O=0;O<n.length;O++){const z=n[O],U=Cx(z.name),N=Ax(z.name),V=Tx(z.name),X=W3(z.name);I[U]={value:z.intensity,min:0,max:1,step:.01,label:`${z.name} intensity`},I[N]={value:z.color,label:`${z.name} color`,render:()=>z._type==="AmbientLight"},z._type!=="AmbientLight"&&(I[V]={value:z.position,label:`${z.name} position`,step:1,onEditStart:()=>{d(z._type,O)},onEditEnd:p}),z._type==="SpotLight"&&(I[X]={value:z.decay??2,min:0,max:4,step:.1,onEditStart:()=>{d(z._type,O)},onEditEnd:p,label:`${z.name} decay`})}return I},[n,p,d]),[i]=bp(()=>({Lights:Ud(b,{order:bD,collapsed:!0})}),[b]),E=k.useMemo(()=>{if(!r)return 0;const{min:I,max:O}=r;return I.distanceTo(O)/10},[r]),T=fc(),A=k.useMemo(()=>{if(!l)return null;const{type:I}=l;switch(I){case"DirectionalLight":return[qw,E,T.primary.main];case"SpotLight":return[xD,T.primary.main];case"PointLight":return[vD,E,T.primary.main];default:return null}},[l,E]);return K4(A?t:!1,(A==null?void 0:A.at(0))??qw,...(A??[]).slice(1)),[i,l]},HV=["top","bottom","right","left","back","front"],WV=()=>{const{upVector:n,sceneBoundingBox:t}=Ul(),r=k.useRef(),l=k.useMemo(()=>{if(!t)return[];const i=t.getCenter(new Tt),E=t.getSize(new Tt),T=Math.max(Math.max(E.x,E.y,E.z))+1;if(n.y===1)return[new Tt(0,i.y+T,0),new Tt(0,i.y-T,0),new Tt(i.x+T,0,0),new Tt(i.x-T,0,0),new Tt(0,0,i.z+T),new Tt(0,0,i.z-T)];if(n.x===1)return[new Tt(i.x+T,0,0),new Tt(i.x-T,0,0),new Tt(0,i.y+T,0),new Tt(0,i.y-T,0),new Tt(0,0,i.z+T),new Tt(0,0,i.z-T)];if(n.z===1)return[new Tt(0,0,i.z+T),new Tt(0,0,i.z-T),new Tt(i.x+T,0,0),new Tt(i.x-T,0,0),new Tt(0,i.y+T,0),new Tt(0,i.y-T,0)]},[n,t]),u=k.useMemo(()=>{if((l==null?void 0:l.length)===0)return[];const i=[{_type:"AmbientLight",name:"Ambient light",color:"#ffffff",intensity:.1}];for(let E=0;E<l.length;E++){const T=l[E];i.push({_type:"DirectionalLight",name:`Directional light-${HV[E]}`,color:"#ffffff",intensity:1,position:[T.x,T.y,T.z]})}return i},[l]),[d,p]=Z3(u,r);return k.useMemo(()=>!d||!u?null:u.map((i,E)=>{const T=Cx(i.name),A=Ax(i.name),I=Tx(i.name),O=d[T],z=d[A],U=d[I],N=(p==null?void 0:p.lightIndex)===E?{ref:r}:{};switch(i._type){case"AmbientLight":return Q.jsx("ambientLight",{color:z,intensity:O},i.name);case"DirectionalLight":return Q.jsx("directionalLight",{position:U,intensity:O,color:z,...N},i.name);default:return null}}),[d,p,u])},ZV=({lights:n})=>{const t=k.useMemo(()=>{const[b,i]=f_.partition(n,E=>E._type==="AmbientLight");return b.length>1?(console.warn("Only one ambient light is allowed"),[b[0],...i]):n},[n]),r=k.useRef(),[l,u]=Z3(t,r),d=k.useMemo(()=>{for(const b of t)if((b._type==="DirectionalLight"||b._type==="SpotLight")&&b.target){const i=new Ba;return i.position.set(...b.target),i}return null},[t]),p=k.useMemo(()=>!t||!l?null:t.map((b,i)=>{const E=Cx(b.name),T=Ax(b.name),A=Tx(b.name),I=W3(b.name),O=l[E],z=l[T],U=l[A],N=l[I],V=(u==null?void 0:u.lightIndex)===i?{ref:r}:{};switch(b._type){case"AmbientLight":return Q.jsx("ambientLight",{color:z,intensity:O,...V},b.name);case"DirectionalLight":return Q.jsx("directionalLight",{color:z,intensity:O,position:U,quaternion:b.quaternion,target:d,...V},b.name);case"SpotLight":return Q.jsx("spotLight",{color:z,intensity:O,position:U,quaternion:b.quaternion,angle:b.angle,penumbra:b.penumbra,decay:N,distance:b.distance,target:d,...V},b.name);case"PointLight":return Q.jsx("pointLight",{color:z,intensity:O,position:U,decay:N,distance:b.distance,...V},b.name);default:return null}}),[t,l,d,u]);return Q.jsx("group",{children:p})},XV=({lights:n})=>n?Q.jsx(ZV,{lights:n}):Q.jsx(WV,{}),rT="sample3d-canvas-wrapper",qV=()=>{const n=sn(eS),t=sn(KT(!0)),r=U_("3d"),l=k.useMemo(()=>p7(n,t),[t,n]),u=k.useMemo(()=>uc(l),[l]),d=k.useMemo(()=>m7(n.sample.filepath),[n]),{foScene:p,isLoading:b}=v7(u,n.sample.filepath,d),[i,E]=k.useState(!1);Au("KeyB",({set:Ce})=>{Ce(G1,je=>!je)},[]);const T=k.useMemo(()=>{if(p!=null&&p.cameraProps.up){const Ce=p.cameraProps.up;if(Ce==="X")return new Tt(1,0,0);if(Ce==="Y")return new Tt(0,1,0);if(Ce==="Z")return new Tt(0,0,1)}return r.defaultUp&&_7(r.defaultUp)?new Tt(r.defaultUp[0],r.defaultUp[1],r.defaultUp[2]):new Tt(0,1,0)},[p,r]),A=k.useRef(),I=k.useRef(),O=k.useRef({shiftRight:!1,shiftLeft:!1,controlRight:!1,controlLeft:!1}),z=k.useCallback(()=>{O.current.shiftRight||O.current.shiftLeft?I.current.mouseButtons.left=Yf.ACTION.TRUCK:O.current.controlRight||O.current.controlLeft?I.current.mouseButtons.left=Yf.ACTION.DOLLY:I.current.mouseButtons.left=Yf.ACTION.ROTATE},[O]);Nf(document,"keydown",Ce=>{Ce.code==="ShiftRight"&&(O.current.shiftRight=!0),Ce.code==="ShiftLeft"&&(O.current.shiftLeft=!0),Ce.code==="ControlRight"&&(O.current.controlRight=!0),Ce.code==="ControlLeft"&&(O.current.controlLeft=!0),z()}),Nf(document,"keyup",Ce=>{Ce.code==="ShiftRight"&&(O.current.shiftRight=!1),Ce.code==="ShiftLeft"&&(O.current.shiftLeft=!1),Ce.code==="ControlRight"&&(O.current.controlRight=!1),Ce.code==="ControlLeft"&&(O.current.controlLeft=!1),z()});const U=k.useRef(),N=j3(U),V=k.useMemo(()=>{if(!N||Math.abs(N.max.x)===Number.POSITIVE_INFINITY)return _0();const Ce=N.getCenter(new Tt),je=N.getSize(new Tt);return T.y===1?new Tt(Ce.x,Ce.y+Math.max(je.y,je.x,je.z)*2.5,0):T.x===1?new Tt(Ce.x+Math.max(je.x,je.z,je.y)*2.5,Ce.y,0):new Tt(Ce.x,0,Ce.z+Math.max(je.z,je.x,je.y)*2.5)},[N,T]),X=sn(mk),J=k.useMemo(()=>{if(b)return _0();if((X==null?void 0:X.length)===3)return new Tt(X[0],X[1],X[2]);const Ce=p==null?void 0:p.cameraProps.position;if(Ce)return new Tt(Ce[0],Ce[1],Ce[2]);if(r.defaultCameraPosition)return new Tt(r.defaultCameraPosition.x,r.defaultCameraPosition.y,r.defaultCameraPosition.z);if(N&&Math.abs(N.max.x)!==Number.POSITIVE_INFINITY){const je=N.getCenter(new Tt),me=N.getSize(new Tt);return T.y===1?new Tt(je.x,je.y+Math.max(me.y/2,1.5),je.z+Math.max(me.x,me.y,me.z)*2):T.x===1?new Tt(je.x+Math.max(me.x/2,1.5),je.y+Math.max(me.x,me.y,me.z)*2,je.z):new Tt(je.x,je.y-Math.max(me.x,me.y,me.z)*2,je.z+Math.max(1.5,me.z/2))}return _0()},[r,X,b,p,N,T]),te=k.useCallback(Ce=>{A.current=Ce.camera},[]),ue=m1(({set:Ce})=>()=>{Ce(IS,null)},[]);k.useLayoutEffect(()=>{var je;const Ce=document.getElementById(rT);Ce&&((je=Ce.querySelector("canvas"))==null||je.setAttribute("canvas-loaded","true"))},[i]),k.useEffect(()=>{A.current&&E(!0)},[J]),k.useEffect(()=>{ue()},[i,ue]);const ae=k.useMemo(()=>{const Ce={position:J,up:T,fov:(p==null?void 0:p.cameraProps.fov)??50,near:(p==null?void 0:p.cameraProps.near)??.1,far:(p==null?void 0:p.cameraProps.far)??2500};return p!=null&&p.cameraProps.lookAt&&(Ce.lookAt=p.cameraProps.lookAt),p!=null&&p.cameraProps.aspect&&(Ce.aspect=p.cameraProps.aspect),Ce},[p,T,J]),be=k.useCallback((Ce,je=!0)=>{if(!N||!A.current||!I.current)return;let me=[J.x,J.y,J.z];Ce==="top"&&(me=[V.x,V.y,V.z]);const Ne=N.getCenter(new Tt),ht=[Ne.x,Ne.y,Ne.z];I.current.setLookAt(...me,...ht,je)},[N,V,J]);return Nf(window,T1,()=>{be("top")}),Nf(window,S1,()=>{be("pov")}),Au("KeyT",({})=>{be("top")},[be]),Au("KeyE",({})=>{be("pov")},[be]),k.useEffect(()=>{var Ce;if(I.current)if(((Ce=p==null?void 0:p.cameraProps.lookAt)==null?void 0:Ce.length)===3){I.current.setTarget(p.cameraProps.lookAt[0],p.cameraProps.lookAt[1],p.cameraProps.lookAt[2]);return}else be("pov",!1)},[p,be]),b7(),b?Q.jsx(x_,{children:Q.jsx(kA,{})}):Q.jsxs(Q.Fragment,{children:[Q.jsx($V,{}),Q.jsx(x_,{id:rT,camera:ae,onCreated:te,onPointerMissed:ue,children:Q.jsxs(U3.Provider,{value:{isSceneInitialized:i,upVector:T,fo3dRoot:d,sceneBoundingBox:N,pluginSettings:r},children:[Q.jsx(Q4,{pixelated:!0}),Q.jsx(ez,{}),Q.jsx(U4,{ref:I,makeDefault:!0}),Q.jsx(XV,{lights:p==null?void 0:p.lights}),Q.jsx(VV,{}),!i&&Q.jsx(kA,{}),Q.jsx("group",{ref:U,visible:i,children:Q.jsx(jV,{scene:p})}),Q.jsx(F3.Out,{}),Q.jsx(v3,{sampleMap:{fo3d:n}})]})}),Q.jsx(_z,{children:Q.jsx(iV,{cameraRef:A})})]})},KV=()=>{const n=sn(A1),t=sn(wD),r=sn(ED).has("point_cloud"),l=sn(CD),u=sn(AD),[d,p]=k.useState(!1),b=k.useRef(null),i=k.useRef(!1),E=ah(Pd),T=ah(N1);k.useEffect(()=>()=>{T(!1)},[]);const A=k.useMemo(()=>n==="point_cloud"||n==="group"&&r||l&&u==="point_cloud",[n,r,l,u]),I=k.useMemo(()=>n==="three_d"||n==="group"&&t||l&&u==="three_d",[n,t,l,u]),O=sn(C1);Au("KeyG",async({set:V})=>{V(Z_,X=>!X)},[]),Au("KeyF",async({set:V})=>{V(s_,X=>!X)},[]),Au("Escape",async({snapshot:V,set:X})=>{if(await V.getPromise(Kw)){X(Kw,!1);return}const te=await V.getPromise(Jw);if(await V.getPromise(Pd)){X(Pd,null);return}for(const me of["help","json"])if(te[me].isOpen){X(Jw,{...te,[me]:{...te[me],isOpen:!1}});return}const ae=await V.getPromise(TD);if(ae&&!Object.values(O).find(me=>me.sample._id===ae._id))return;if(await V.getPromise(s_)){X(s_,!1);return}const je=await V.getPromise(SD);if(je&&je.length>0){X(ZT,{});return}X(MD,{}),X(ID,null)},[O,d],!1);const z=k.useCallback(()=>{i.current||(b.current&&clearTimeout(b.current),p(!1),E(null))},[E]),U=k.useCallback(()=>(!d&&p(!0),b.current&&clearTimeout(b.current),b.current=setTimeout(z,3e3),()=>{b.current&&clearTimeout(b.current)}),[z,d]);if(!A&&!I)return Q.jsxs("div",{children:["Unsupported media type: ",n]});const N=I?Q.jsx(qV,{}):Q.jsx(B7,{});return Q.jsx(V1,{boundaryName:"fo3d",children:Q.jsxs(AM,{onMouseOver:U,onMouseMove:U,"data-cy":"looker3d",children:[N,Q.jsx(w2,{onMouseEnter:()=>{i.current=!0},onMouseLeave:()=>{i.current=!1}})]})})},X3={useLegacyCoordinates:!1,defaultUp:[0,0,1]};typeof window<"u"&&g1({name:"Looker3d",component:KV,type:_1.Visualizer,activator:({dataset:n})=>n.mediaType??n.groupMediaTypes.find(t=>t.mediaType==="point_cloud"||t.mediaType==="three_d")!==void 0,label:""});const JV="_container_1wrzk_1";var q3={exports:{}};(function(n,t){(function(r,l){n.exports=l()})(zf,function(){var r=function(B,H){var ce={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Se={on:function(De,Ke,It){if(ce[De]===void 0)throw new Error("Invalid event type: "+De);ce[De].push({selector:Ke,fn:It})},render:function(De){H.store.featureChanged(De)}},ze=function(De,Ke){for(var It=ce[De],Ft=It.length;Ft--;){var Jt=It[Ft];if(Jt.selector(Ke)){Jt.fn.call(Se,Ke)||H.store.render(),H.ui.updateMapClasses();break}}};return B.start.call(Se),{render:B.render,stop:function(){B.stop&&B.stop()},trash:function(){B.trash&&(B.trash(),H.store.render())},combineFeatures:function(){B.combineFeatures&&B.combineFeatures()},uncombineFeatures:function(){B.uncombineFeatures&&B.uncombineFeatures()},drag:function(De){ze("drag",De)},click:function(De){ze("click",De)},mousemove:function(De){ze("mousemove",De)},mousedown:function(De){ze("mousedown",De)},mouseup:function(De){ze("mouseup",De)},mouseout:function(De){ze("mouseout",De)},keydown:function(De){ze("keydown",De)},keyup:function(De){ze("keyup",De)},touchstart:function(De){ze("touchstart",De)},touchmove:function(De){ze("touchmove",De)},touchend:function(De){ze("touchend",De)},tap:function(De){ze("tap",De)}}};function l(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}function u(B){if(B.__esModule)return B;var H=B.default;if(typeof H=="function"){var ce=function Se(){if(this instanceof Se){var ze=[null];ze.push.apply(ze,arguments);var De=Function.bind.apply(H,ze);return new De}return H.apply(this,arguments)};ce.prototype=H.prototype}else ce={};return Object.defineProperty(ce,"__esModule",{value:!0}),Object.keys(B).forEach(function(Se){var ze=Object.getOwnPropertyDescriptor(B,Se);Object.defineProperty(ce,Se,ze.get?ze:{enumerable:!0,get:function(){return B[Se]}})}),ce}var d={},p={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},b=p;function i(B){var H=0;if(B&&B.length>0){H+=Math.abs(E(B[0]));for(var ce=1;ce<B.length;ce++)H-=Math.abs(E(B[ce]))}return H}function E(B){var H,ce,Se,ze,De,Ke,It=0,Ft=B.length;if(Ft>2){for(Ke=0;Ke<Ft;Ke++)Ke===Ft-2?(Se=Ft-2,ze=Ft-1,De=0):Ke===Ft-1?(Se=Ft-1,ze=0,De=1):(Se=Ke,ze=Ke+1,De=Ke+2),H=B[Se],ce=B[ze],It+=(T(B[De][0])-T(H[0]))*Math.sin(T(ce[1]));It=It*b.RADIUS*b.RADIUS/2}return It}function T(B){return B*Math.PI/180}d.geometry=function B(H){var ce,Se=0;switch(H.type){case"Polygon":return i(H.coordinates);case"MultiPolygon":for(ce=0;ce<H.coordinates.length;ce++)Se+=i(H.coordinates[ce]);return Se;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ce=0;ce<H.geometries.length;ce++)Se+=B(H.geometries[ce]);return Se}},d.ring=E;var A={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},I={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},O={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},z={POLYGON:"polygon",LINE:"line_string",POINT:"point"},U={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},N={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},V={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},X={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},J={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},te={ACTIVE:"true",INACTIVE:"false"},ue=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],ae=-85,be=Object.freeze({__proto__:null,classes:A,sources:I,cursors:O,types:z,geojsonTypes:U,modes:N,events:V,updateActions:X,meta:J,activeStates:te,interactions:ue,LAT_MIN:-90,LAT_RENDERED_MIN:ae,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),Ce={Point:0,LineString:1,MultiLineString:1,Polygon:2};function je(B,H){var ce=Ce[B.geometry.type]-Ce[H.geometry.type];return ce===0&&B.geometry.type===U.POLYGON?B.area-H.area:ce}function me(B){return B.map(function(H){return H.geometry.type===U.POLYGON&&(H.area=d.geometry({type:U.FEATURE,property:{},geometry:H.geometry})),H}).sort(je).map(function(H){return delete H.area,H})}function Ne(B,H){return H===void 0&&(H=0),[[B.point.x-H,B.point.y-H],[B.point.x+H,B.point.y+H]]}function ht(B){if(this._items={},this._nums={},this._length=B?B.length:0,B)for(var H=0,ce=B.length;H<ce;H++)this.add(B[H]),B[H]!==void 0&&(typeof B[H]=="string"?this._items[B[H]]=H:this._nums[B[H]]=H)}ht.prototype.add=function(B){return this.has(B)||(this._length++,typeof B=="string"?this._items[B]=this._length:this._nums[B]=this._length),this},ht.prototype.delete=function(B){return this.has(B)===!1||(this._length--,delete this._items[B],delete this._nums[B]),this},ht.prototype.has=function(B){return(typeof B=="string"||typeof B=="number")&&(this._items[B]!==void 0||this._nums[B]!==void 0)},ht.prototype.values=function(){var B=this,H=[];return Object.keys(this._items).forEach(function(ce){H.push({k:ce,v:B._items[ce]})}),Object.keys(this._nums).forEach(function(ce){H.push({k:JSON.parse(ce),v:B._nums[ce]})}),H.sort(function(ce,Se){return ce.v-Se.v}).map(function(ce){return ce.k})},ht.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var _t=[J.FEATURE,J.MIDPOINT,J.VERTEX],Bt={click:function(B,H,ce){return Kt(B,H,ce,ce.options.clickBuffer)},touch:function(B,H,ce){return Kt(B,H,ce,ce.options.touchBuffer)}};function Kt(B,H,ce,Se){if(ce.map===null)return[];var ze=B?Ne(B,Se):H,De={};ce.options.styles&&(De.layers=ce.options.styles.map(function(Jt){return Jt.id}).filter(function(Jt){return ce.map.getLayer(Jt)!=null}));var Ke=ce.map.queryRenderedFeatures(ze,De).filter(function(Jt){return _t.indexOf(Jt.properties.meta)!==-1}),It=new ht,Ft=[];return Ke.forEach(function(Jt){var Yt=Jt.properties.id;It.has(Yt)||(It.add(Yt),Ft.push(Jt))}),me(Ft)}function Gt(B,H){var ce=Bt.click(B,null,H),Se={mouse:O.NONE};return ce[0]&&(Se.mouse=ce[0].properties.active===te.ACTIVE?O.MOVE:O.POINTER,Se.feature=ce[0].properties.meta),H.events.currentModeName().indexOf("draw")!==-1&&(Se.mouse=O.ADD),H.ui.queueMapClasses(Se),H.ui.updateMapClasses(),ce[0]}function hn(B,H){var ce=B.x-H.x,Se=B.y-H.y;return Math.sqrt(ce*ce+Se*Se)}function wt(B,H,ce){ce===void 0&&(ce={});var Se=ce.fineTolerance!=null?ce.fineTolerance:4,ze=ce.grossTolerance!=null?ce.grossTolerance:12,De=ce.interval!=null?ce.interval:500;B.point=B.point||H.point,B.time=B.time||H.time;var Ke=hn(B.point,H.point);return Ke<Se||Ke<ze&&H.time-B.time<De}function bt(B,H,ce){ce===void 0&&(ce={});var Se=ce.tolerance!=null?ce.tolerance:25,ze=ce.interval!=null?ce.interval:250;return B.point=B.point||H.point,B.time=B.time||H.time,hn(B.point,H.point)<Se&&H.time-B.time<ze}var $t={exports:{}},Zt=$t.exports=function(B,H){if(H||(H=16),B===void 0&&(B=128),B<=0)return"0";for(var ce=Math.log(Math.pow(2,B))/Math.log(H),Se=2;ce===1/0;Se*=2)ce=Math.log(Math.pow(2,B/Se))/Math.log(H)*Se;var ze=ce-Math.floor(ce),De="";for(Se=0;Se<Math.floor(ce);Se++)De=Math.floor(Math.random()*H).toString(H)+De;if(ze){var Ke=Math.pow(H,ze);De=Math.floor(Math.random()*Ke).toString(H)+De}var It=parseInt(De,H);return It!==1/0&&It>=Math.pow(2,B)?Zt(B,H):De};Zt.rack=function(B,H,ce){var Se=function(De){var Ke=0;do{if(Ke++>10){if(!ce)throw new Error("too many ID collisions, use more bits");B+=ce}var It=Zt(B,H)}while(Object.hasOwnProperty.call(ze,It));return ze[It]=De,It},ze=Se.hats={};return Se.get=function(De){return Se.hats[De]},Se.set=function(De,Ke){return Se.hats[De]=Ke,Se},Se.bits=B||128,Se.base=H||16,Se};var mn=l($t.exports),yn=function(B,H){this.ctx=B,this.properties=H.properties||{},this.coordinates=H.geometry.coordinates,this.id=H.id||mn(),this.type=H.geometry.type};yn.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},yn.prototype.incomingCoords=function(B){this.setCoordinates(B)},yn.prototype.setCoordinates=function(B){this.coordinates=B,this.changed()},yn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},yn.prototype.setProperty=function(B,H){this.properties[B]=H},yn.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:U.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},yn.prototype.internal=function(B){var H={id:this.id,meta:J.FEATURE,"meta:type":this.type,active:te.INACTIVE,mode:B};if(this.ctx.options.userProperties)for(var ce in this.properties)H["user_"+ce]=this.properties[ce];return{type:U.FEATURE,properties:H,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var On=function(B,H){yn.call(this,B,H)};(On.prototype=Object.create(yn.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},On.prototype.updateCoordinate=function(B,H,ce){this.coordinates=arguments.length===3?[H,ce]:[B,H],this.changed()},On.prototype.getCoordinate=function(){return this.getCoordinates()};var rr=function(B,H){yn.call(this,B,H)};(rr.prototype=Object.create(yn.prototype)).isValid=function(){return this.coordinates.length>1},rr.prototype.addCoordinate=function(B,H,ce){this.changed();var Se=parseInt(B,10);this.coordinates.splice(Se,0,[H,ce])},rr.prototype.getCoordinate=function(B){var H=parseInt(B,10);return JSON.parse(JSON.stringify(this.coordinates[H]))},rr.prototype.removeCoordinate=function(B){this.changed(),this.coordinates.splice(parseInt(B,10),1)},rr.prototype.updateCoordinate=function(B,H,ce){var Se=parseInt(B,10);this.coordinates[Se]=[H,ce],this.changed()};var Yn=function(B,H){yn.call(this,B,H),this.coordinates=this.coordinates.map(function(ce){return ce.slice(0,-1)})};(Yn.prototype=Object.create(yn.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(B){return B.length>2})},Yn.prototype.incomingCoords=function(B){this.coordinates=B.map(function(H){return H.slice(0,-1)}),this.changed()},Yn.prototype.setCoordinates=function(B){this.coordinates=B,this.changed()},Yn.prototype.addCoordinate=function(B,H,ce){this.changed();var Se=B.split(".").map(function(ze){return parseInt(ze,10)});this.coordinates[Se[0]].splice(Se[1],0,[H,ce])},Yn.prototype.removeCoordinate=function(B){this.changed();var H=B.split(".").map(function(Se){return parseInt(Se,10)}),ce=this.coordinates[H[0]];ce&&(ce.splice(H[1],1),ce.length<3&&this.coordinates.splice(H[0],1))},Yn.prototype.getCoordinate=function(B){var H=B.split(".").map(function(Se){return parseInt(Se,10)}),ce=this.coordinates[H[0]];return JSON.parse(JSON.stringify(ce[H[1]]))},Yn.prototype.getCoordinates=function(){return this.coordinates.map(function(B){return B.concat([B[0]])})},Yn.prototype.updateCoordinate=function(B,H,ce){this.changed();var Se=B.split("."),ze=parseInt(Se[0],10),De=parseInt(Se[1],10);this.coordinates[ze]===void 0&&(this.coordinates[ze]=[]),this.coordinates[ze][De]=[H,ce]};var Vr={MultiPoint:On,MultiLineString:rr,MultiPolygon:Yn},Jr=function(B,H,ce,Se,ze){var De=ce.split("."),Ke=parseInt(De[0],10),It=De[1]?De.slice(1).join("."):null;return B[Ke][H](It,Se,ze)},kr=function(B,H){if(yn.call(this,B,H),delete this.coordinates,this.model=Vr[H.geometry.type],this.model===void 0)throw new TypeError(H.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(H.geometry.coordinates)};function Ln(B){this.map=B.map,this.drawConfig=JSON.parse(JSON.stringify(B.options||{})),this._ctx=B}(kr.prototype=Object.create(yn.prototype))._coordinatesToFeatures=function(B){var H=this,ce=this.model.bind(this);return B.map(function(Se){return new ce(H.ctx,{id:mn(),type:U.FEATURE,properties:{},geometry:{coordinates:Se,type:H.type.replace("Multi","")}})})},kr.prototype.isValid=function(){return this.features.every(function(B){return B.isValid()})},kr.prototype.setCoordinates=function(B){this.features=this._coordinatesToFeatures(B),this.changed()},kr.prototype.getCoordinate=function(B){return Jr(this.features,"getCoordinate",B)},kr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(B){return B.type===U.POLYGON?B.getCoordinates():B.coordinates})))},kr.prototype.updateCoordinate=function(B,H,ce){Jr(this.features,"updateCoordinate",B,H,ce),this.changed()},kr.prototype.addCoordinate=function(B,H,ce){Jr(this.features,"addCoordinate",B,H,ce),this.changed()},kr.prototype.removeCoordinate=function(B){Jr(this.features,"removeCoordinate",B),this.changed()},kr.prototype.getFeatures=function(){return this.features},Ln.prototype.setSelected=function(B){return this._ctx.store.setSelected(B)},Ln.prototype.setSelectedCoordinates=function(B){var H=this;this._ctx.store.setSelectedCoordinates(B),B.reduce(function(ce,Se){return ce[Se.feature_id]===void 0&&(ce[Se.feature_id]=!0,H._ctx.store.get(Se.feature_id).changed()),ce},{})},Ln.prototype.getSelected=function(){return this._ctx.store.getSelected()},Ln.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Ln.prototype.isSelected=function(B){return this._ctx.store.isSelected(B)},Ln.prototype.getFeature=function(B){return this._ctx.store.get(B)},Ln.prototype.select=function(B){return this._ctx.store.select(B)},Ln.prototype.deselect=function(B){return this._ctx.store.deselect(B)},Ln.prototype.deleteFeature=function(B,H){return H===void 0&&(H={}),this._ctx.store.delete(B,H)},Ln.prototype.addFeature=function(B){return this._ctx.store.add(B)},Ln.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Ln.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Ln.prototype.setActionableState=function(B){B===void 0&&(B={});var H={trash:B.trash||!1,combineFeatures:B.combineFeatures||!1,uncombineFeatures:B.uncombineFeatures||!1};return this._ctx.events.actionable(H)},Ln.prototype.changeMode=function(B,H,ce){return H===void 0&&(H={}),ce===void 0&&(ce={}),this._ctx.events.changeMode(B,H,ce)},Ln.prototype.updateUIClasses=function(B){return this._ctx.ui.queueMapClasses(B)},Ln.prototype.activateUIButton=function(B){return this._ctx.ui.setActiveButton(B)},Ln.prototype.featuresAt=function(B,H,ce){if(ce===void 0&&(ce="click"),ce!=="click"&&ce!=="touch")throw new Error("invalid buffer type");return Bt[ce](B,H,this._ctx)},Ln.prototype.newFeature=function(B){var H=B.geometry.type;return H===U.POINT?new On(this._ctx,B):H===U.LINE_STRING?new rr(this._ctx,B):H===U.POLYGON?new Yn(this._ctx,B):new kr(this._ctx,B)},Ln.prototype.isInstanceOf=function(B,H){if(B===U.POINT)return H instanceof On;if(B===U.LINE_STRING)return H instanceof rr;if(B===U.POLYGON)return H instanceof Yn;if(B==="MultiFeature")return H instanceof kr;throw new Error("Unknown feature class: "+B)},Ln.prototype.doRender=function(B){return this._ctx.store.featureChanged(B)},Ln.prototype.onSetup=function(){},Ln.prototype.onDrag=function(){},Ln.prototype.onClick=function(){},Ln.prototype.onMouseMove=function(){},Ln.prototype.onMouseDown=function(){},Ln.prototype.onMouseUp=function(){},Ln.prototype.onMouseOut=function(){},Ln.prototype.onKeyUp=function(){},Ln.prototype.onKeyDown=function(){},Ln.prototype.onTouchStart=function(){},Ln.prototype.onTouchMove=function(){},Ln.prototype.onTouchEnd=function(){},Ln.prototype.onTap=function(){},Ln.prototype.onStop=function(){},Ln.prototype.onTrash=function(){},Ln.prototype.onCombineFeature=function(){},Ln.prototype.onUncombineFeature=function(){},Ln.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var li={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},kn=Object.keys(li);function Br(B){var H=Object.keys(B);return function(ce,Se){Se===void 0&&(Se={});var ze={},De=H.reduce(function(Ke,It){return Ke[It]=B[It],Ke},new Ln(ce));return{start:function(){var Ke=this;ze=De.onSetup(Se),kn.forEach(function(It){var Ft,Jt=li[It],Yt=function(){return!1};B[Jt]&&(Yt=function(){return!0}),Ke.on(It,Yt,(Ft=Jt,function(Wt){return De[Ft](ze,Wt)}))})},stop:function(){De.onStop(ze)},trash:function(){De.onTrash(ze)},combineFeatures:function(){De.onCombineFeatures(ze)},uncombineFeatures:function(){De.onUncombineFeatures(ze)},render:function(Ke,It){De.toDisplayFeatures(ze,Ke,It)}}}}function ci(B){return[].concat(B).filter(function(H){return H!==void 0})}function Ji(){var B=this;if(!(B.ctx.map&&B.ctx.map.getSource(I.HOT)!==void 0))return Ft();var H=B.ctx.events.currentModeName();B.ctx.ui.queueMapClasses({mode:H});var ce=[],Se=[];B.isDirty?Se=B.getAllIds():(ce=B.getChangedIds().filter(function(Jt){return B.get(Jt)!==void 0}),Se=B.sources.hot.filter(function(Jt){return Jt.properties.id&&ce.indexOf(Jt.properties.id)===-1&&B.get(Jt.properties.id)!==void 0}).map(function(Jt){return Jt.properties.id})),B.sources.hot=[];var ze=B.sources.cold.length;B.sources.cold=B.isDirty?[]:B.sources.cold.filter(function(Jt){var Yt=Jt.properties.id||Jt.properties.parent;return ce.indexOf(Yt)===-1});var De=ze!==B.sources.cold.length||Se.length>0;function Ke(Jt,Yt){var Wt=B.get(Jt).internal(H);B.ctx.events.currentModeRender(Wt,function(Rn){B.sources[Yt].push(Rn)})}if(ce.forEach(function(Jt){return Ke(Jt,"hot")}),Se.forEach(function(Jt){return Ke(Jt,"cold")}),De&&B.ctx.map.getSource(I.COLD).setData({type:U.FEATURE_COLLECTION,features:B.sources.cold}),B.ctx.map.getSource(I.HOT).setData({type:U.FEATURE_COLLECTION,features:B.sources.hot}),B._emitSelectionChange&&(B.ctx.map.fire(V.SELECTION_CHANGE,{features:B.getSelected().map(function(Jt){return Jt.toGeoJSON()}),points:B.getSelectedCoordinates().map(function(Jt){return{type:U.FEATURE,properties:{},geometry:{type:U.POINT,coordinates:Jt.coordinates}}})}),B._emitSelectionChange=!1),B._deletedFeaturesToEmit.length){var It=B._deletedFeaturesToEmit.map(function(Jt){return Jt.toGeoJSON()});B._deletedFeaturesToEmit=[],B.ctx.map.fire(V.DELETE,{features:It})}function Ft(){B.isDirty=!1,B.clearChangedIds()}Ft(),B.ctx.map.fire(V.RENDER,{})}function wn(B){var H,ce=this;this._features={},this._featureIds=new ht,this._selectedFeatureIds=new ht,this._selectedCoordinates=[],this._changedFeatureIds=new ht,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=B,this.sources={hot:[],cold:[]},this.render=function(){H||(H=requestAnimationFrame(function(){H=null,Ji.call(ce)}))},this.isDirty=!1}function ki(B,H){var ce=B._selectedCoordinates.filter(function(Se){return B._selectedFeatureIds.has(Se.feature_id)});B._selectedCoordinates.length===ce.length||H.silent||(B._emitSelectionChange=!0),B._selectedCoordinates=ce}wn.prototype.createRenderBatch=function(){var B=this,H=this.render,ce=0;return this.render=function(){ce++},function(){B.render=H,ce>0&&B.render()}},wn.prototype.setDirty=function(){return this.isDirty=!0,this},wn.prototype.featureChanged=function(B){return this._changedFeatureIds.add(B),this},wn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},wn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},wn.prototype.getAllIds=function(){return this._featureIds.values()},wn.prototype.add=function(B){return this.featureChanged(B.id),this._features[B.id]=B,this._featureIds.add(B.id),this},wn.prototype.delete=function(B,H){var ce=this;return H===void 0&&(H={}),ci(B).forEach(function(Se){ce._featureIds.has(Se)&&(ce._featureIds.delete(Se),ce._selectedFeatureIds.delete(Se),H.silent||ce._deletedFeaturesToEmit.indexOf(ce._features[Se])===-1&&ce._deletedFeaturesToEmit.push(ce._features[Se]),delete ce._features[Se],ce.isDirty=!0)}),ki(this,H),this},wn.prototype.get=function(B){return this._features[B]},wn.prototype.getAll=function(){var B=this;return Object.keys(this._features).map(function(H){return B._features[H]})},wn.prototype.select=function(B,H){var ce=this;return H===void 0&&(H={}),ci(B).forEach(function(Se){ce._selectedFeatureIds.has(Se)||(ce._selectedFeatureIds.add(Se),ce._changedFeatureIds.add(Se),H.silent||(ce._emitSelectionChange=!0))}),this},wn.prototype.deselect=function(B,H){var ce=this;return H===void 0&&(H={}),ci(B).forEach(function(Se){ce._selectedFeatureIds.has(Se)&&(ce._selectedFeatureIds.delete(Se),ce._changedFeatureIds.add(Se),H.silent||(ce._emitSelectionChange=!0))}),ki(this,H),this},wn.prototype.clearSelected=function(B){return B===void 0&&(B={}),this.deselect(this._selectedFeatureIds.values(),{silent:B.silent}),this},wn.prototype.setSelected=function(B,H){var ce=this;return H===void 0&&(H={}),B=ci(B),this.deselect(this._selectedFeatureIds.values().filter(function(Se){return B.indexOf(Se)===-1}),{silent:H.silent}),this.select(B.filter(function(Se){return!ce._selectedFeatureIds.has(Se)}),{silent:H.silent}),this},wn.prototype.setSelectedCoordinates=function(B){return this._selectedCoordinates=B,this._emitSelectionChange=!0,this},wn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},wn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},wn.prototype.getSelected=function(){var B=this;return this._selectedFeatureIds.values().map(function(H){return B.get(H)})},wn.prototype.getSelectedCoordinates=function(){var B=this;return this._selectedCoordinates.map(function(H){return{coordinates:B.get(H.feature_id).getCoordinate(H.coord_path)}})},wn.prototype.isSelected=function(B){return this._selectedFeatureIds.has(B)},wn.prototype.setFeatureProperty=function(B,H,ce){this.get(B).setProperty(H,ce),this.featureChanged(B)},wn.prototype.storeMapConfig=function(){var B=this;ue.forEach(function(H){B.ctx.map[H]&&(B._mapInitialConfig[H]=B.ctx.map[H].isEnabled())})},wn.prototype.restoreMapConfig=function(){var B=this;Object.keys(this._mapInitialConfig).forEach(function(H){B._mapInitialConfig[H]?B.ctx.map[H].enable():B.ctx.map[H].disable()})},wn.prototype.getInitialConfigValue=function(B){return this._mapInitialConfig[B]===void 0||this._mapInitialConfig[B]};var Bs=function(){for(var B=arguments,H={},ce=0;ce<arguments.length;ce++){var Se=B[ce];for(var ze in Se)Do.call(Se,ze)&&(H[ze]=Se[ze])}return H},Do=Object.prototype.hasOwnProperty,Tr=l(Bs),xo=["mode","feature","mouse"];function bs(B){var H=null,ce=null,Se={onRemove:function(){return B.map.off("load",Se.connect),clearInterval(ce),Se.removeLayers(),B.store.restoreMapConfig(),B.ui.removeButtons(),B.events.removeEventListeners(),B.ui.clearMapClasses(),B.boxZoomInitial&&B.map.boxZoom.enable(),B.map=null,B.container=null,B.store=null,H&&H.parentNode&&H.parentNode.removeChild(H),H=null,this},connect:function(){B.map.off("load",Se.connect),clearInterval(ce),Se.addLayers(),B.store.storeMapConfig(),B.events.addEventListeners()},onAdd:function(ze){var De=ze.fire;return ze.fire=function(Ke,It){var Ft=arguments;return De.length===1&&arguments.length!==1&&(Ft=[Tr({},{type:Ke},It)]),De.apply(ze,Ft)},B.map=ze,B.events=function(Ke){var It=Object.keys(Ke.options.modes).reduce(function(yt,en){return yt[en]=Br(Ke.options.modes[en]),yt},{}),Ft={},Jt={},Yt={},Wt=null,Rn=null;Yt.drag=function(yt,en){en({point:yt.point,time:new Date().getTime()})?(Ke.ui.queueMapClasses({mouse:O.DRAG}),Rn.drag(yt)):yt.originalEvent.stopPropagation()},Yt.mousedrag=function(yt){Yt.drag(yt,function(en){return!wt(Ft,en)})},Yt.touchdrag=function(yt){Yt.drag(yt,function(en){return!bt(Jt,en)})},Yt.mousemove=function(yt){if((yt.originalEvent.buttons!==void 0?yt.originalEvent.buttons:yt.originalEvent.which)===1)return Yt.mousedrag(yt);var en=Gt(yt,Ke);yt.featureTarget=en,Rn.mousemove(yt)},Yt.mousedown=function(yt){Ft={time:new Date().getTime(),point:yt.point};var en=Gt(yt,Ke);yt.featureTarget=en,Rn.mousedown(yt)},Yt.mouseup=function(yt){var en=Gt(yt,Ke);yt.featureTarget=en,wt(Ft,{point:yt.point,time:new Date().getTime()})?Rn.click(yt):Rn.mouseup(yt)},Yt.mouseout=function(yt){Rn.mouseout(yt)},Yt.touchstart=function(yt){if(Ke.options.touchEnabled){Jt={time:new Date().getTime(),point:yt.point};var en=Bt.touch(yt,null,Ke)[0];yt.featureTarget=en,Rn.touchstart(yt)}},Yt.touchmove=function(yt){if(Ke.options.touchEnabled)return Rn.touchmove(yt),Yt.touchdrag(yt)},Yt.touchend=function(yt){if(yt.originalEvent.preventDefault(),Ke.options.touchEnabled){var en=Bt.touch(yt,null,Ke)[0];yt.featureTarget=en,bt(Jt,{time:new Date().getTime(),point:yt.point})?Rn.tap(yt):Rn.touchend(yt)}};var Sn=function(yt){return!(yt===8||yt===46||yt>=48&&yt<=57)};function jn(yt,en,Mr){Mr===void 0&&(Mr={}),Rn.stop();var dr=It[yt];if(dr===void 0)throw new Error(yt+" is not valid");Wt=yt;var gr=dr(Ke,en);Rn=r(gr,Ke),Mr.silent||Ke.map.fire(V.MODE_CHANGE,{mode:yt}),Ke.store.setDirty(),Ke.store.render()}Yt.keydown=function(yt){(yt.srcElement||yt.target).classList.contains("mapboxgl-canvas")&&(yt.keyCode!==8&&yt.keyCode!==46||!Ke.options.controls.trash?Sn(yt.keyCode)?Rn.keydown(yt):yt.keyCode===49&&Ke.options.controls.point?jn(N.DRAW_POINT):yt.keyCode===50&&Ke.options.controls.line_string?jn(N.DRAW_LINE_STRING):yt.keyCode===51&&Ke.options.controls.polygon&&jn(N.DRAW_POLYGON):(yt.preventDefault(),Rn.trash()))},Yt.keyup=function(yt){Sn(yt.keyCode)&&Rn.keyup(yt)},Yt.zoomend=function(){Ke.store.changeZoom()},Yt.data=function(yt){if(yt.dataType==="style"){var en=Ke.setup,Mr=Ke.map,dr=Ke.options,gr=Ke.store;dr.styles.some(function(Qo){return Mr.getLayer(Qo.id)})||(en.addLayers(),gr.setDirty(),gr.render())}};var Wr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Wt=Ke.options.defaultMode,Rn=r(It[Wt](Ke),Ke)},changeMode:jn,actionable:function(yt){var en=!1;Object.keys(yt).forEach(function(Mr){if(Wr[Mr]===void 0)throw new Error("Invalid action type");Wr[Mr]!==yt[Mr]&&(en=!0),Wr[Mr]=yt[Mr]}),en&&Ke.map.fire(V.ACTIONABLE,{actions:Wr})},currentModeName:function(){return Wt},currentModeRender:function(yt,en){return Rn.render(yt,en)},fire:function(yt,en){Yt[yt]&&Yt[yt](en)},addEventListeners:function(){Ke.map.on("mousemove",Yt.mousemove),Ke.map.on("mousedown",Yt.mousedown),Ke.map.on("mouseup",Yt.mouseup),Ke.map.on("data",Yt.data),Ke.map.on("touchmove",Yt.touchmove),Ke.map.on("touchstart",Yt.touchstart),Ke.map.on("touchend",Yt.touchend),Ke.container.addEventListener("mouseout",Yt.mouseout),Ke.options.keybindings&&(Ke.container.addEventListener("keydown",Yt.keydown),Ke.container.addEventListener("keyup",Yt.keyup))},removeEventListeners:function(){Ke.map.off("mousemove",Yt.mousemove),Ke.map.off("mousedown",Yt.mousedown),Ke.map.off("mouseup",Yt.mouseup),Ke.map.off("data",Yt.data),Ke.map.off("touchmove",Yt.touchmove),Ke.map.off("touchstart",Yt.touchstart),Ke.map.off("touchend",Yt.touchend),Ke.container.removeEventListener("mouseout",Yt.mouseout),Ke.options.keybindings&&(Ke.container.removeEventListener("keydown",Yt.keydown),Ke.container.removeEventListener("keyup",Yt.keyup))},trash:function(yt){Rn.trash(yt)},combineFeatures:function(){Rn.combineFeatures()},uncombineFeatures:function(){Rn.uncombineFeatures()},getMode:function(){return Wt}}}(B),B.ui=function(Ke){var It={},Ft=null,Jt={mode:null,feature:null,mouse:null},Yt={mode:null,feature:null,mouse:null};function Wt(yt){Yt=Tr(Yt,yt)}function Rn(){var yt,en;if(Ke.container){var Mr=[],dr=[];xo.forEach(function(gr){Yt[gr]!==Jt[gr]&&(Mr.push(gr+"-"+Jt[gr]),Yt[gr]!==null&&dr.push(gr+"-"+Yt[gr]))}),Mr.length>0&&(yt=Ke.container.classList).remove.apply(yt,Mr),dr.length>0&&(en=Ke.container.classList).add.apply(en,dr),Jt=Tr(Jt,Yt)}}function Sn(yt,en){en===void 0&&(en={});var Mr=document.createElement("button");return Mr.className=A.CONTROL_BUTTON+" "+en.className,Mr.setAttribute("title",en.title),en.container.appendChild(Mr),Mr.addEventListener("click",function(dr){if(dr.preventDefault(),dr.stopPropagation(),dr.target===Ft)return jn(),void en.onDeactivate();Wr(yt),en.onActivate()},!0),Mr}function jn(){Ft&&(Ft.classList.remove(A.ACTIVE_BUTTON),Ft=null)}function Wr(yt){jn();var en=It[yt];en&&en&&yt!=="trash"&&(en.classList.add(A.ACTIVE_BUTTON),Ft=en)}return{setActiveButton:Wr,queueMapClasses:Wt,updateMapClasses:Rn,clearMapClasses:function(){Wt({mode:null,feature:null,mouse:null}),Rn()},addButtons:function(){var yt=Ke.options.controls,en=document.createElement("div");return en.className=A.CONTROL_GROUP+" "+A.CONTROL_BASE,yt&&(yt[z.LINE]&&(It[z.LINE]=Sn(z.LINE,{container:en,className:A.CONTROL_BUTTON_LINE,title:"LineString tool "+(Ke.options.keybindings?"(l)":""),onActivate:function(){return Ke.events.changeMode(N.DRAW_LINE_STRING)},onDeactivate:function(){return Ke.events.trash()}})),yt[z.POLYGON]&&(It[z.POLYGON]=Sn(z.POLYGON,{container:en,className:A.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Ke.options.keybindings?"(p)":""),onActivate:function(){return Ke.events.changeMode(N.DRAW_POLYGON)},onDeactivate:function(){return Ke.events.trash()}})),yt[z.POINT]&&(It[z.POINT]=Sn(z.POINT,{container:en,className:A.CONTROL_BUTTON_POINT,title:"Marker tool "+(Ke.options.keybindings?"(m)":""),onActivate:function(){return Ke.events.changeMode(N.DRAW_POINT)},onDeactivate:function(){return Ke.events.trash()}})),yt.trash&&(It.trash=Sn("trash",{container:en,className:A.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Ke.events.trash()}})),yt.combine_features&&(It.combine_features=Sn("combineFeatures",{container:en,className:A.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Ke.events.combineFeatures()}})),yt.uncombine_features&&(It.uncombine_features=Sn("uncombineFeatures",{container:en,className:A.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Ke.events.uncombineFeatures()}}))),en},removeButtons:function(){Object.keys(It).forEach(function(yt){var en=It[yt];en.parentNode&&en.parentNode.removeChild(en),delete It[yt]})}}}(B),B.container=ze.getContainer(),B.store=new wn(B),H=B.ui.addButtons(),B.options.boxSelect&&(B.boxZoomInitial=ze.boxZoom.isEnabled(),ze.boxZoom.disable(),ze.dragPan.disable(),ze.dragPan.enable()),ze.loaded()?Se.connect():(ze.on("load",Se.connect),ce=setInterval(function(){ze.loaded()&&Se.connect()},16)),B.events.start(),H},addLayers:function(){B.map.addSource(I.COLD,{data:{type:U.FEATURE_COLLECTION,features:[]},type:"geojson"}),B.map.addSource(I.HOT,{data:{type:U.FEATURE_COLLECTION,features:[]},type:"geojson"}),B.options.styles.forEach(function(ze){B.map.addLayer(ze)}),B.store.setDirty(!0),B.store.render()},removeLayers:function(){B.options.styles.forEach(function(ze){B.map.getLayer(ze.id)&&B.map.removeLayer(ze.id)}),B.map.getSource(I.COLD)&&B.map.removeSource(I.COLD),B.map.getSource(I.HOT)&&B.map.removeSource(I.HOT)}};return B.setup=Se,Se}var an=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function xn(B){return function(H){var ce=H.featureTarget;return!!ce&&!!ce.properties&&ce.properties.meta===B}}function $r(B){return!!B.originalEvent&&!!B.originalEvent.shiftKey&&B.originalEvent.button===0}function Hr(B){return!!B.featureTarget&&!!B.featureTarget.properties&&B.featureTarget.properties.active===te.ACTIVE&&B.featureTarget.properties.meta===J.FEATURE}function Bi(B){return!!B.featureTarget&&!!B.featureTarget.properties&&B.featureTarget.properties.active===te.INACTIVE&&B.featureTarget.properties.meta===J.FEATURE}function ui(B){return B.featureTarget===void 0}function Hi(B){return!!B.featureTarget&&!!B.featureTarget.properties&&B.featureTarget.properties.meta===J.FEATURE}function Oo(B){var H=B.featureTarget;return!!H&&!!H.properties&&H.properties.meta===J.VERTEX}function no(B){return!!B.originalEvent&&B.originalEvent.shiftKey===!0}function ko(B){return B.keyCode===27}function bo(B){return B.keyCode===13}var Ko=Object.freeze({__proto__:null,isOfMetaType:xn,isShiftMousedown:$r,isActiveFeature:Hr,isInactiveFeature:Bi,noTarget:ui,isFeature:Hi,isVertex:Oo,isShiftDown:no,isEscapeKey:ko,isEnterKey:bo,isTrue:function(){return!0}}),wo=Je;function Je(B,H){this.x=B,this.y=H}Je.prototype={clone:function(){return new Je(this.x,this.y)},add:function(B){return this.clone()._add(B)},sub:function(B){return this.clone()._sub(B)},multByPoint:function(B){return this.clone()._multByPoint(B)},divByPoint:function(B){return this.clone()._divByPoint(B)},mult:function(B){return this.clone()._mult(B)},div:function(B){return this.clone()._div(B)},rotate:function(B){return this.clone()._rotate(B)},rotateAround:function(B,H){return this.clone()._rotateAround(B,H)},matMult:function(B){return this.clone()._matMult(B)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(B){return this.x===B.x&&this.y===B.y},dist:function(B){return Math.sqrt(this.distSqr(B))},distSqr:function(B){var H=B.x-this.x,ce=B.y-this.y;return H*H+ce*ce},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(B){return Math.atan2(this.y-B.y,this.x-B.x)},angleWith:function(B){return this.angleWithSep(B.x,B.y)},angleWithSep:function(B,H){return Math.atan2(this.x*H-this.y*B,this.x*B+this.y*H)},_matMult:function(B){var H=B[0]*this.x+B[1]*this.y,ce=B[2]*this.x+B[3]*this.y;return this.x=H,this.y=ce,this},_add:function(B){return this.x+=B.x,this.y+=B.y,this},_sub:function(B){return this.x-=B.x,this.y-=B.y,this},_mult:function(B){return this.x*=B,this.y*=B,this},_div:function(B){return this.x/=B,this.y/=B,this},_multByPoint:function(B){return this.x*=B.x,this.y*=B.y,this},_divByPoint:function(B){return this.x/=B.x,this.y/=B.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var B=this.y;return this.y=this.x,this.x=-B,this},_rotate:function(B){var H=Math.cos(B),ce=Math.sin(B),Se=H*this.x-ce*this.y,ze=ce*this.x+H*this.y;return this.x=Se,this.y=ze,this},_rotateAround:function(B,H){var ce=Math.cos(B),Se=Math.sin(B),ze=H.x+ce*(this.x-H.x)-Se*(this.y-H.y),De=H.y+Se*(this.x-H.x)+ce*(this.y-H.y);return this.x=ze,this.y=De,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Je.convert=function(B){return B instanceof Je?B:Array.isArray(B)?new Je(B[0],B[1]):B};var Vt=l(wo);function In(B,H){var ce=H.getBoundingClientRect();return new Vt(B.clientX-ce.left-(H.clientLeft||0),B.clientY-ce.top-(H.clientTop||0))}function ir(B,H,ce,Se){return{type:U.FEATURE,properties:{meta:J.VERTEX,parent:B,coord_path:ce,active:Se?te.ACTIVE:te.INACTIVE},geometry:{type:U.POINT,coordinates:H}}}function Ae(B,H,ce){var Se=H.geometry.coordinates,ze=ce.geometry.coordinates;if(Se[1]>85||Se[1]<ae||ze[1]>85||ze[1]<ae)return null;var De={lng:(Se[0]+ze[0])/2,lat:(Se[1]+ze[1])/2};return{type:U.FEATURE,properties:{meta:J.MIDPOINT,parent:B,lng:De.lng,lat:De.lat,coord_path:ce.properties.coord_path},geometry:{type:U.POINT,coordinates:[De.lng,De.lat]}}}function se(B,H,ce){H===void 0&&(H={}),ce===void 0&&(ce=null);var Se,ze=B.geometry,De=ze.type,Ke=ze.coordinates,It=B.properties&&B.properties.id,Ft=[];function Jt(Wt,Rn){var Sn="",jn=null;Wt.forEach(function(Wr,yt){var en=Rn!=null?Rn+"."+yt:String(yt),Mr=ir(It,Wr,en,Yt(en));if(H.midpoints&&jn){var dr=Ae(It,jn,Mr);dr&&Ft.push(dr)}jn=Mr;var gr=JSON.stringify(Wr);Sn!==gr&&Ft.push(Mr),yt===0&&(Sn=gr)})}function Yt(Wt){return!!H.selectedPaths&&H.selectedPaths.indexOf(Wt)!==-1}return De===U.POINT?Ft.push(ir(It,Ke,ce,Yt(ce))):De===U.POLYGON?Ke.forEach(function(Wt,Rn){Jt(Wt,ce!==null?ce+"."+Rn:String(Rn))}):De===U.LINE_STRING?Jt(Ke,ce):De.indexOf(U.MULTI_PREFIX)===0&&(Se=De.replace(U.MULTI_PREFIX,""),Ke.forEach(function(Wt,Rn){var Sn={type:U.FEATURE,properties:B.properties,geometry:{type:Se,coordinates:Wt}};Ft=Ft.concat(se(Sn,H,Rn))})),Ft}var le={enable:function(B){setTimeout(function(){B.map&&B.map.doubleClickZoom&&B._ctx&&B._ctx.store&&B._ctx.store.getInitialConfigValue&&B._ctx.store.getInitialConfigValue("doubleClickZoom")&&B.map.doubleClickZoom.enable()},0)},disable:function(B){setTimeout(function(){B.map&&B.map.doubleClickZoom&&B.map.doubleClickZoom.disable()},0)}},Te={exports:{}},Be=function(B){if(!B||!B.type)return null;var H=Ge[B.type];if(!H)return null;if(H==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:B}]};if(H==="feature")return{type:"FeatureCollection",features:[B]};if(H==="featurecollection")return B},Ge={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Xe=l(Be),qe=Object.freeze({__proto__:null,default:function B(H){switch(H&&H.type||null){case"FeatureCollection":return H.features=H.features.reduce(function(ce,Se){return ce.concat(B(Se))},[]),H;case"Feature":return H.geometry?B(H.geometry).map(function(ce){var Se={type:"Feature",properties:JSON.parse(JSON.stringify(H.properties)),geometry:ce};return H.id!==void 0&&(Se.id=H.id),Se}):[H];case"MultiPoint":return H.coordinates.map(function(ce){return{type:"Point",coordinates:ce}});case"MultiPolygon":return H.coordinates.map(function(ce){return{type:"Polygon",coordinates:ce}});case"MultiLineString":return H.coordinates.map(function(ce){return{type:"LineString",coordinates:ce}});case"GeometryCollection":return H.geometries.map(B).reduce(function(ce,Se){return ce.concat(Se)},[]);case"Point":case"Polygon":case"LineString":return[H]}}}),Ve=Be,rt=u(qe),Rt=function(B){return function H(ce){return Array.isArray(ce)&&ce.length&&typeof ce[0]=="number"?[ce]:ce.reduce(function(Se,ze){return Array.isArray(ze)&&Array.isArray(ze[0])?Se.concat(H(ze)):(Se.push(ze),Se)},[])}(B)};rt instanceof Function||(rt=rt.default);var jt={exports:{}},Dt=jt.exports=function(B){return new En(B)};function En(B){this.value=B}function Un(B,H,ce){var Se=[],ze=[],De=!0;return function Ke(It){var Ft=ce?Fn(It):It,Jt={},Yt=!0,Wt={node:Ft,node_:It,path:[].concat(Se),parent:ze[ze.length-1],parents:ze,key:Se.slice(-1)[0],isRoot:Se.length===0,level:Se.length,circular:null,update:function(jn,Wr){Wt.isRoot||(Wt.parent.node[Wt.key]=jn),Wt.node=jn,Wr&&(Yt=!1)},delete:function(jn){delete Wt.parent.node[Wt.key],jn&&(Yt=!1)},remove:function(jn){Yr(Wt.parent.node)?Wt.parent.node.splice(Wt.key,1):delete Wt.parent.node[Wt.key],jn&&(Yt=!1)},keys:null,before:function(jn){Jt.before=jn},after:function(jn){Jt.after=jn},pre:function(jn){Jt.pre=jn},post:function(jn){Jt.post=jn},stop:function(){De=!1},block:function(){Yt=!1}};if(!De)return Wt;function Rn(){if(typeof Wt.node=="object"&&Wt.node!==null){Wt.keys&&Wt.node_===Wt.node||(Wt.keys=zn(Wt.node)),Wt.isLeaf=Wt.keys.length==0;for(var jn=0;jn<ze.length;jn++)if(ze[jn].node_===It){Wt.circular=ze[jn];break}}else Wt.isLeaf=!0,Wt.keys=null;Wt.notLeaf=!Wt.isLeaf,Wt.notRoot=!Wt.isRoot}Rn();var Sn=H.call(Wt,Wt.node);return Sn!==void 0&&Wt.update&&Wt.update(Sn),Jt.before&&Jt.before.call(Wt,Wt.node),Yt&&(typeof Wt.node!="object"||Wt.node===null||Wt.circular||(ze.push(Wt),Rn(),yi(Wt.keys,function(jn,Wr){Se.push(jn),Jt.pre&&Jt.pre.call(Wt,Wt.node[jn],jn);var yt=Ke(Wt.node[jn]);ce&&Wi.call(Wt.node,jn)&&(Wt.node[jn]=yt.node),yt.isLast=Wr==Wt.keys.length-1,yt.isFirst=Wr==0,Jt.post&&Jt.post.call(Wt,yt),Se.pop()}),ze.pop()),Jt.after&&Jt.after.call(Wt,Wt.node)),Wt}(B).node}function Fn(B){if(typeof B=="object"&&B!==null){var H;if(Yr(B))H=[];else if($n(B)==="[object Date]")H=new Date(B.getTime?B.getTime():B);else if(function(ze){return $n(ze)==="[object RegExp]"}(B))H=new RegExp(B);else if(function(ze){return $n(ze)==="[object Error]"}(B))H={message:B.message};else if(function(ze){return $n(ze)==="[object Boolean]"}(B))H=new Boolean(B);else if(function(ze){return $n(ze)==="[object Number]"}(B))H=new Number(B);else if(function(ze){return $n(ze)==="[object String]"}(B))H=new String(B);else if(Object.create&&Object.getPrototypeOf)H=Object.create(Object.getPrototypeOf(B));else if(B.constructor===Object)H={};else{var ce=B.constructor&&B.constructor.prototype||B.__proto__||{},Se=function(){};Se.prototype=ce,H=new Se}return yi(zn(B),function(ze){H[ze]=B[ze]}),H}return B}En.prototype.get=function(B){for(var H=this.value,ce=0;ce<B.length;ce++){var Se=B[ce];if(!H||!Wi.call(H,Se)){H=void 0;break}H=H[Se]}return H},En.prototype.has=function(B){for(var H=this.value,ce=0;ce<B.length;ce++){var Se=B[ce];if(!H||!Wi.call(H,Se))return!1;H=H[Se]}return!0},En.prototype.set=function(B,H){for(var ce=this.value,Se=0;Se<B.length-1;Se++){var ze=B[Se];Wi.call(ce,ze)||(ce[ze]={}),ce=ce[ze]}return ce[B[Se]]=H,H},En.prototype.map=function(B){return Un(this.value,B,!0)},En.prototype.forEach=function(B){return this.value=Un(this.value,B,!1),this.value},En.prototype.reduce=function(B,H){var ce=arguments.length===1,Se=ce?this.value:H;return this.forEach(function(ze){this.isRoot&&ce||(Se=B.call(this,Se,ze))}),Se},En.prototype.paths=function(){var B=[];return this.forEach(function(H){B.push(this.path)}),B},En.prototype.nodes=function(){var B=[];return this.forEach(function(H){B.push(this.node)}),B},En.prototype.clone=function(){var B=[],H=[];return function ce(Se){for(var ze=0;ze<B.length;ze++)if(B[ze]===Se)return H[ze];if(typeof Se=="object"&&Se!==null){var De=Fn(Se);return B.push(Se),H.push(De),yi(zn(Se),function(Ke){De[Ke]=ce(Se[Ke])}),B.pop(),H.pop(),De}return Se}(this.value)};var zn=Object.keys||function(B){var H=[];for(var ce in B)H.push(ce);return H};function $n(B){return Object.prototype.toString.call(B)}var Yr=Array.isArray||function(B){return Object.prototype.toString.call(B)==="[object Array]"},yi=function(B,H){if(B.forEach)return B.forEach(H);for(var ce=0;ce<B.length;ce++)H(B[ce],ce,B)};yi(zn(En.prototype),function(B){Dt[B]=function(H){var ce=[].slice.call(arguments,1),Se=new En(H);return Se[B].apply(Se,ce)}});var Wi=Object.hasOwnProperty||function(B,H){return H in B},zi=jt.exports,Hs=br;function br(B){if(!(this instanceof br))return new br(B);this._bbox=B||[1/0,1/0,-1/0,-1/0],this._valid=!!B}br.prototype.include=function(B){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],B[0]),this._bbox[1]=Math.min(this._bbox[1],B[1]),this._bbox[2]=Math.max(this._bbox[2],B[0]),this._bbox[3]=Math.max(this._bbox[3],B[1]),this},br.prototype.equals=function(B){var H;return H=B instanceof br?B.bbox():B,this._bbox[0]==H[0]&&this._bbox[1]==H[1]&&this._bbox[2]==H[2]&&this._bbox[3]==H[3]},br.prototype.center=function(B){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},br.prototype.union=function(B){var H;return this._valid=!0,H=B instanceof br?B.bbox():B,this._bbox[0]=Math.min(this._bbox[0],H[0]),this._bbox[1]=Math.min(this._bbox[1],H[1]),this._bbox[2]=Math.max(this._bbox[2],H[2]),this._bbox[3]=Math.max(this._bbox[3],H[3]),this},br.prototype.bbox=function(){return this._valid?this._bbox:null},br.prototype.contains=function(B){if(!B)return this._fastContains();if(!this._valid)return null;var H=B[0],ce=B[1];return this._bbox[0]<=H&&this._bbox[1]<=ce&&this._bbox[2]>=H&&this._bbox[3]>=ce},br.prototype.intersect=function(B){return this._valid?(H=B instanceof br?B.bbox():B,!(this._bbox[0]>H[2]||this._bbox[2]<H[0]||this._bbox[3]<H[1]||this._bbox[1]>H[3])):null;var H},br.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var B="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",B)},br.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Eo=function(B){if(!B)return[];var H=rt(Ve(B)),ce=[];return H.features.forEach(function(Se){Se.geometry&&(ce=ce.concat(Rt(Se.geometry.coordinates)))}),ce},Nl=zi,Yh=Hs,Ru={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},vr=Object.keys(Ru);function _c(B){for(var H=Yh(),ce=Eo(B),Se=0;Se<ce.length;Se++)H.include(ce[Se]);return H}Te.exports=function(B){return _c(B).bbox()},Te.exports.polygon=function(B){return _c(B).polygon()},Te.exports.bboxify=function(B){return Nl(B).map(function(H){H&&vr.some(function(ce){return!!H[ce]&&Ru[ce].indexOf(H.type)!==-1})&&(H.bbox=_c(H).bbox(),this.update(H))})};var yc=l(Te.exports),Fa=-90;function Ws(B,H){var ce=Fa,Se=90,ze=Fa,De=90,Ke=270,It=-270;B.forEach(function(Jt){var Yt=yc(Jt),Wt=Yt[1],Rn=Yt[3],Sn=Yt[0],jn=Yt[2];Wt>ce&&(ce=Wt),Rn<Se&&(Se=Rn),Rn>ze&&(ze=Rn),Wt<De&&(De=Wt),Sn<Ke&&(Ke=Sn),jn>It&&(It=jn)});var Ft=H;return ce+Ft.lat>85&&(Ft.lat=85-ce),ze+Ft.lat>90&&(Ft.lat=90-ze),Se+Ft.lat<-85&&(Ft.lat=-85-Se),De+Ft.lat<Fa&&(Ft.lat=Fa-De),Ke+Ft.lng<=-270&&(Ft.lng+=360*Math.ceil(Math.abs(Ft.lng)/360)),It+Ft.lng>=270&&(Ft.lng-=360*Math.ceil(Math.abs(Ft.lng)/360)),Ft}function Jo(B,H){var ce=Ws(B.map(function(Se){return Se.toGeoJSON()}),H);B.forEach(function(Se){var ze,De=Se.getCoordinates(),Ke=function(Ft){var Jt={lng:Ft[0]+ce.lng,lat:Ft[1]+ce.lat};return[Jt.lng,Jt.lat]},It=function(Ft){return Ft.map(function(Jt){return Ke(Jt)})};Se.type===U.POINT?ze=Ke(De):Se.type===U.LINE_STRING||Se.type===U.MULTI_POINT?ze=De.map(Ke):Se.type===U.POLYGON||Se.type===U.MULTI_LINE_STRING?ze=De.map(It):Se.type===U.MULTI_POLYGON&&(ze=De.map(function(Ft){return Ft.map(function(Jt){return It(Jt)})})),Se.incomingCoords(ze)})}var zr={onSetup:function(B){var H=this,ce={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:B.featureIds||[]};return this.setSelected(ce.initiallySelectedFeatureIds.filter(function(Se){return H.getFeature(Se)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),ce},fireUpdate:function(){this.map.fire(V.UPDATE,{action:X.MOVE,features:this.getSelected().map(function(B){return B.toGeoJSON()})})},fireActionable:function(){var B=this,H=this.getSelected(),ce=H.filter(function(It){return B.isInstanceOf("MultiFeature",It)}),Se=!1;if(H.length>1){Se=!0;var ze=H[0].type.replace("Multi","");H.forEach(function(It){It.type.replace("Multi","")!==ze&&(Se=!1)})}var De=ce.length>0,Ke=H.length>0;this.setActionableState({combineFeatures:Se,uncombineFeatures:De,trash:Ke})},getUniqueIds:function(B){return B.length?B.map(function(H){return H.properties.id}).filter(function(H){return H!==void 0}).reduce(function(H,ce){return H.add(ce),H},new ht).values():[]},stopExtendedInteractions:function(B){B.boxSelectElement&&(B.boxSelectElement.parentNode&&B.boxSelectElement.parentNode.removeChild(B.boxSelectElement),B.boxSelectElement=null),this.map.dragPan.enable(),B.boxSelecting=!1,B.canBoxSelect=!1,B.dragMoving=!1,B.canDragMove=!1},onStop:function(){le.enable(this)},onMouseMove:function(B,H){return Hi(H)&&B.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(B),!0},onMouseOut:function(B){return!B.dragMoving||this.fireUpdate()}};zr.onTap=zr.onClick=function(B,H){return ui(H)?this.clickAnywhere(B,H):xn(J.VERTEX)(H)?this.clickOnVertex(B,H):Hi(H)?this.clickOnFeature(B,H):void 0},zr.clickAnywhere=function(B){var H=this,ce=this.getSelectedIds();ce.length&&(this.clearSelectedFeatures(),ce.forEach(function(Se){return H.doRender(Se)})),le.enable(this),this.stopExtendedInteractions(B)},zr.clickOnVertex=function(B,H){this.changeMode(N.DIRECT_SELECT,{featureId:H.featureTarget.properties.parent,coordPath:H.featureTarget.properties.coord_path,startPos:H.lngLat}),this.updateUIClasses({mouse:O.MOVE})},zr.startOnActiveFeature=function(B,H){this.stopExtendedInteractions(B),this.map.dragPan.disable(),this.doRender(H.featureTarget.properties.id),B.canDragMove=!0,B.dragMoveLocation=H.lngLat},zr.clickOnFeature=function(B,H){var ce=this;le.disable(this),this.stopExtendedInteractions(B);var Se=no(H),ze=this.getSelectedIds(),De=H.featureTarget.properties.id,Ke=this.isSelected(De);if(!Se&&Ke&&this.getFeature(De).type!==U.POINT)return this.changeMode(N.DIRECT_SELECT,{featureId:De});Ke&&Se?(this.deselect(De),this.updateUIClasses({mouse:O.POINTER}),ze.length===1&&le.enable(this)):!Ke&&Se?(this.select(De),this.updateUIClasses({mouse:O.MOVE})):Ke||Se||(ze.forEach(function(It){return ce.doRender(It)}),this.setSelected(De),this.updateUIClasses({mouse:O.MOVE})),this.doRender(De)},zr.onMouseDown=function(B,H){return Hr(H)?this.startOnActiveFeature(B,H):this.drawConfig.boxSelect&&$r(H)?this.startBoxSelect(B,H):void 0},zr.startBoxSelect=function(B,H){this.stopExtendedInteractions(B),this.map.dragPan.disable(),B.boxSelectStartLocation=In(H.originalEvent,this.map.getContainer()),B.canBoxSelect=!0},zr.onTouchStart=function(B,H){if(Hr(H))return this.startOnActiveFeature(B,H)},zr.onDrag=function(B,H){return B.canDragMove?this.dragMove(B,H):this.drawConfig.boxSelect&&B.canBoxSelect?this.whileBoxSelect(B,H):void 0},zr.whileBoxSelect=function(B,H){B.boxSelecting=!0,this.updateUIClasses({mouse:O.ADD}),B.boxSelectElement||(B.boxSelectElement=document.createElement("div"),B.boxSelectElement.classList.add(A.BOX_SELECT),this.map.getContainer().appendChild(B.boxSelectElement));var ce=In(H.originalEvent,this.map.getContainer()),Se=Math.min(B.boxSelectStartLocation.x,ce.x),ze=Math.max(B.boxSelectStartLocation.x,ce.x),De=Math.min(B.boxSelectStartLocation.y,ce.y),Ke=Math.max(B.boxSelectStartLocation.y,ce.y),It="translate("+Se+"px, "+De+"px)";B.boxSelectElement.style.transform=It,B.boxSelectElement.style.WebkitTransform=It,B.boxSelectElement.style.width=ze-Se+"px",B.boxSelectElement.style.height=Ke-De+"px"},zr.dragMove=function(B,H){B.dragMoving=!0,H.originalEvent.stopPropagation();var ce={lng:H.lngLat.lng-B.dragMoveLocation.lng,lat:H.lngLat.lat-B.dragMoveLocation.lat};Jo(this.getSelected(),ce),B.dragMoveLocation=H.lngLat},zr.onTouchEnd=zr.onMouseUp=function(B,H){var ce=this;if(B.dragMoving)this.fireUpdate();else if(B.boxSelecting){var Se=[B.boxSelectStartLocation,In(H.originalEvent,this.map.getContainer())],ze=this.featuresAt(null,Se,"click"),De=this.getUniqueIds(ze).filter(function(Ke){return!ce.isSelected(Ke)});De.length&&(this.select(De),De.forEach(function(Ke){return ce.doRender(Ke)}),this.updateUIClasses({mouse:O.MOVE}))}this.stopExtendedInteractions(B)},zr.toDisplayFeatures=function(B,H,ce){H.properties.active=this.isSelected(H.properties.id)?te.ACTIVE:te.INACTIVE,ce(H),this.fireActionable(),H.properties.active===te.ACTIVE&&H.geometry.type!==U.POINT&&se(H).forEach(ce)},zr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},zr.onCombineFeatures=function(){var B=this.getSelected();if(!(B.length===0||B.length<2)){for(var H=[],ce=[],Se=B[0].type.replace("Multi",""),ze=0;ze<B.length;ze++){var De=B[ze];if(De.type.replace("Multi","")!==Se)return;De.type.includes("Multi")?De.getCoordinates().forEach(function(It){H.push(It)}):H.push(De.getCoordinates()),ce.push(De.toGeoJSON())}if(ce.length>1){var Ke=this.newFeature({type:U.FEATURE,properties:ce[0].properties,geometry:{type:"Multi"+Se,coordinates:H}});this.addFeature(Ke),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Ke.id]),this.map.fire(V.COMBINE_FEATURES,{createdFeatures:[Ke.toGeoJSON()],deletedFeatures:ce})}this.fireActionable()}},zr.onUncombineFeatures=function(){var B=this,H=this.getSelected();if(H.length!==0){for(var ce=[],Se=[],ze=function(Ke){var It=H[Ke];B.isInstanceOf("MultiFeature",It)&&(It.getFeatures().forEach(function(Ft){B.addFeature(Ft),Ft.properties=It.properties,ce.push(Ft.toGeoJSON()),B.select([Ft.id])}),B.deleteFeature(It.id,{silent:!0}),Se.push(It.toGeoJSON()))},De=0;De<H.length;De++)ze(De);ce.length>1&&this.map.fire(V.UNCOMBINE_FEATURES,{createdFeatures:ce,deletedFeatures:Se}),this.fireActionable()}};var Nc=xn(J.VERTEX),Gl=xn(J.MIDPOINT),Zi={fireUpdate:function(){this.map.fire(V.UPDATE,{action:X.CHANGE_COORDINATES,features:this.getSelected().map(function(B){return B.toGeoJSON()})})},fireActionable:function(B){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:B.selectedCoordPaths.length>0})},startDragging:function(B,H){this.map.dragPan.disable(),B.canDragMove=!0,B.dragMoveLocation=H.lngLat},stopDragging:function(B){this.map.dragPan.enable(),B.dragMoving=!1,B.canDragMove=!1,B.dragMoveLocation=null},onVertex:function(B,H){this.startDragging(B,H);var ce=H.featureTarget.properties,Se=B.selectedCoordPaths.indexOf(ce.coord_path);no(H)||Se!==-1?no(H)&&Se===-1&&B.selectedCoordPaths.push(ce.coord_path):B.selectedCoordPaths=[ce.coord_path];var ze=this.pathsToCoordinates(B.featureId,B.selectedCoordPaths);this.setSelectedCoordinates(ze)},onMidpoint:function(B,H){this.startDragging(B,H);var ce=H.featureTarget.properties;B.feature.addCoordinate(ce.coord_path,ce.lng,ce.lat),this.fireUpdate(),B.selectedCoordPaths=[ce.coord_path]},pathsToCoordinates:function(B,H){return H.map(function(ce){return{feature_id:B,coord_path:ce}})},onFeature:function(B,H){B.selectedCoordPaths.length===0?this.startDragging(B,H):this.stopDragging(B)},dragFeature:function(B,H,ce){Jo(this.getSelected(),ce),B.dragMoveLocation=H.lngLat},dragVertex:function(B,H,ce){for(var Se=B.selectedCoordPaths.map(function(It){return B.feature.getCoordinate(It)}),ze=Ws(Se.map(function(It){return{type:U.FEATURE,properties:{},geometry:{type:U.POINT,coordinates:It}}}),ce),De=0;De<Se.length;De++){var Ke=Se[De];B.feature.updateCoordinate(B.selectedCoordPaths[De],Ke[0]+ze.lng,Ke[1]+ze.lat)}},clickNoTarget:function(){this.changeMode(N.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(N.SIMPLE_SELECT)},clickActiveFeature:function(B){B.selectedCoordPaths=[],this.clearSelectedCoordinates(),B.feature.changed()},onSetup:function(B){var H=B.featureId,ce=this.getFeature(H);if(!ce)throw new Error("You must provide a featureId to enter direct_select mode");if(ce.type===U.POINT)throw new TypeError("direct_select mode doesn't handle point features");var Se={featureId:H,feature:ce,dragMoveLocation:B.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:B.coordPath?[B.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(H,Se.selectedCoordPaths)),this.setSelected(H),le.disable(this),this.setActionableState({trash:!0}),Se},onStop:function(){le.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(B,H,ce){B.featureId===H.properties.id?(H.properties.active=te.ACTIVE,ce(H),se(H,{map:this.map,midpoints:!0,selectedPaths:B.selectedCoordPaths}).forEach(ce)):(H.properties.active=te.INACTIVE,ce(H)),this.fireActionable(B)},onTrash:function(B){B.selectedCoordPaths.sort(function(H,ce){return ce.localeCompare(H,"en",{numeric:!0})}).forEach(function(H){return B.feature.removeCoordinate(H)}),this.fireUpdate(),B.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(B),B.feature.isValid()===!1&&(this.deleteFeature([B.featureId]),this.changeMode(N.SIMPLE_SELECT,{}))},onMouseMove:function(B,H){var ce=Hr(H),Se=Nc(H),ze=Gl(H),De=B.selectedCoordPaths.length===0;return ce&&De||Se&&!De?this.updateUIClasses({mouse:O.MOVE}):this.updateUIClasses({mouse:O.NONE}),(Se||ce||ze)&&B.dragMoving&&this.fireUpdate(),this.stopDragging(B),!0},onMouseOut:function(B){return B.dragMoving&&this.fireUpdate(),!0}};Zi.onTouchStart=Zi.onMouseDown=function(B,H){return Nc(H)?this.onVertex(B,H):Hr(H)?this.onFeature(B,H):Gl(H)?this.onMidpoint(B,H):void 0},Zi.onDrag=function(B,H){if(B.canDragMove===!0){B.dragMoving=!0,H.originalEvent.stopPropagation();var ce={lng:H.lngLat.lng-B.dragMoveLocation.lng,lat:H.lngLat.lat-B.dragMoveLocation.lat};B.selectedCoordPaths.length>0?this.dragVertex(B,H,ce):this.dragFeature(B,H,ce),B.dragMoveLocation=H.lngLat}},Zi.onClick=function(B,H){return ui(H)?this.clickNoTarget(B,H):Hr(H)?this.clickActiveFeature(B,H):Bi(H)?this.clickInactive(B,H):void this.stopDragging(B)},Zi.onTap=function(B,H){return ui(H)?this.clickNoTarget(B,H):Hr(H)?this.clickActiveFeature(B,H):Bi(H)?this.clickInactive(B,H):void 0},Zi.onTouchEnd=Zi.onMouseUp=function(B){B.dragMoving&&this.fireUpdate(),this.stopDragging(B)};var hi={};function wr(B,H){return!!B.lngLat&&B.lngLat.lng===H[0]&&B.lngLat.lat===H[1]}hi.onSetup=function(){var B=this.newFeature({type:U.FEATURE,properties:{},geometry:{type:U.POINT,coordinates:[]}});return this.addFeature(B),this.clearSelectedFeatures(),this.updateUIClasses({mouse:O.ADD}),this.activateUIButton(z.POINT),this.setActionableState({trash:!0}),{point:B}},hi.stopDrawingAndRemove=function(B){this.deleteFeature([B.point.id],{silent:!0}),this.changeMode(N.SIMPLE_SELECT)},hi.onTap=hi.onClick=function(B,H){this.updateUIClasses({mouse:O.MOVE}),B.point.updateCoordinate("",H.lngLat.lng,H.lngLat.lat),this.map.fire(V.CREATE,{features:[B.point.toGeoJSON()]}),this.changeMode(N.SIMPLE_SELECT,{featureIds:[B.point.id]})},hi.onStop=function(B){this.activateUIButton(),B.point.getCoordinate().length||this.deleteFeature([B.point.id],{silent:!0})},hi.toDisplayFeatures=function(B,H,ce){var Se=H.properties.id===B.point.id;if(H.properties.active=Se?te.ACTIVE:te.INACTIVE,!Se)return ce(H)},hi.onTrash=hi.stopDrawingAndRemove,hi.onKeyUp=function(B,H){if(ko(H)||bo(H))return this.stopDrawingAndRemove(B,H)};var et={onSetup:function(){var B=this.newFeature({type:U.FEATURE,properties:{},geometry:{type:U.POLYGON,coordinates:[[]]}});return this.addFeature(B),this.clearSelectedFeatures(),le.disable(this),this.updateUIClasses({mouse:O.ADD}),this.activateUIButton(z.POLYGON),this.setActionableState({trash:!0}),{polygon:B,currentVertexPosition:0}},clickAnywhere:function(B,H){if(B.currentVertexPosition>0&&wr(H,B.polygon.coordinates[0][B.currentVertexPosition-1]))return this.changeMode(N.SIMPLE_SELECT,{featureIds:[B.polygon.id]});this.updateUIClasses({mouse:O.ADD}),B.polygon.updateCoordinate("0."+B.currentVertexPosition,H.lngLat.lng,H.lngLat.lat),B.currentVertexPosition++,B.polygon.updateCoordinate("0."+B.currentVertexPosition,H.lngLat.lng,H.lngLat.lat)},clickOnVertex:function(B){return this.changeMode(N.SIMPLE_SELECT,{featureIds:[B.polygon.id]})},onMouseMove:function(B,H){B.polygon.updateCoordinate("0."+B.currentVertexPosition,H.lngLat.lng,H.lngLat.lat),Oo(H)&&this.updateUIClasses({mouse:O.POINTER})}};et.onTap=et.onClick=function(B,H){return Oo(H)?this.clickOnVertex(B,H):this.clickAnywhere(B,H)},et.onKeyUp=function(B,H){ko(H)?(this.deleteFeature([B.polygon.id],{silent:!0}),this.changeMode(N.SIMPLE_SELECT)):bo(H)&&this.changeMode(N.SIMPLE_SELECT,{featureIds:[B.polygon.id]})},et.onStop=function(B){this.updateUIClasses({mouse:O.NONE}),le.enable(this),this.activateUIButton(),this.getFeature(B.polygon.id)!==void 0&&(B.polygon.removeCoordinate("0."+B.currentVertexPosition),B.polygon.isValid()?this.map.fire(V.CREATE,{features:[B.polygon.toGeoJSON()]}):(this.deleteFeature([B.polygon.id],{silent:!0}),this.changeMode(N.SIMPLE_SELECT,{},{silent:!0})))},et.toDisplayFeatures=function(B,H,ce){var Se=H.properties.id===B.polygon.id;if(H.properties.active=Se?te.ACTIVE:te.INACTIVE,!Se)return ce(H);if(H.geometry.coordinates.length!==0){var ze=H.geometry.coordinates[0].length;if(!(ze<3)){if(H.properties.meta=J.FEATURE,ce(ir(B.polygon.id,H.geometry.coordinates[0][0],"0.0",!1)),ze>3){var De=H.geometry.coordinates[0].length-3;ce(ir(B.polygon.id,H.geometry.coordinates[0][De],"0."+De,!1))}if(ze<=4){var Ke=[[H.geometry.coordinates[0][0][0],H.geometry.coordinates[0][0][1]],[H.geometry.coordinates[0][1][0],H.geometry.coordinates[0][1][1]]];if(ce({type:U.FEATURE,properties:H.properties,geometry:{coordinates:Ke,type:U.LINE_STRING}}),ze===3)return}return ce(H)}}},et.onTrash=function(B){this.deleteFeature([B.polygon.id],{silent:!0}),this.changeMode(N.SIMPLE_SELECT)};var Si={onSetup:function(B){var H,ce,Se=(B=B||{}).featureId,ze="forward";if(Se){if(!(H=this.getFeature(Se)))throw new Error("Could not find a feature with the provided featureId");var De=B.from;if(De&&De.type==="Feature"&&De.geometry&&De.geometry.type==="Point"&&(De=De.geometry),De&&De.type==="Point"&&De.coordinates&&De.coordinates.length===2&&(De=De.coordinates),!De||!Array.isArray(De))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Ke=H.coordinates.length-1;if(H.coordinates[Ke][0]===De[0]&&H.coordinates[Ke][1]===De[1])ce=Ke+1,H.addCoordinate.apply(H,[ce].concat(H.coordinates[Ke]));else{if(H.coordinates[0][0]!==De[0]||H.coordinates[0][1]!==De[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ze="backwards",ce=0,H.addCoordinate.apply(H,[ce].concat(H.coordinates[0]))}}else H=this.newFeature({type:U.FEATURE,properties:{},geometry:{type:U.LINE_STRING,coordinates:[]}}),ce=0,this.addFeature(H);return this.clearSelectedFeatures(),le.disable(this),this.updateUIClasses({mouse:O.ADD}),this.activateUIButton(z.LINE),this.setActionableState({trash:!0}),{line:H,currentVertexPosition:ce,direction:ze}},clickAnywhere:function(B,H){if(B.currentVertexPosition>0&&wr(H,B.line.coordinates[B.currentVertexPosition-1])||B.direction==="backwards"&&wr(H,B.line.coordinates[B.currentVertexPosition+1]))return this.changeMode(N.SIMPLE_SELECT,{featureIds:[B.line.id]});this.updateUIClasses({mouse:O.ADD}),B.line.updateCoordinate(B.currentVertexPosition,H.lngLat.lng,H.lngLat.lat),B.direction==="forward"?(B.currentVertexPosition++,B.line.updateCoordinate(B.currentVertexPosition,H.lngLat.lng,H.lngLat.lat)):B.line.addCoordinate(0,H.lngLat.lng,H.lngLat.lat)},clickOnVertex:function(B){return this.changeMode(N.SIMPLE_SELECT,{featureIds:[B.line.id]})},onMouseMove:function(B,H){B.line.updateCoordinate(B.currentVertexPosition,H.lngLat.lng,H.lngLat.lat),Oo(H)&&this.updateUIClasses({mouse:O.POINTER})}};Si.onTap=Si.onClick=function(B,H){if(Oo(H))return this.clickOnVertex(B,H);this.clickAnywhere(B,H)},Si.onKeyUp=function(B,H){bo(H)?this.changeMode(N.SIMPLE_SELECT,{featureIds:[B.line.id]}):ko(H)&&(this.deleteFeature([B.line.id],{silent:!0}),this.changeMode(N.SIMPLE_SELECT))},Si.onStop=function(B){le.enable(this),this.activateUIButton(),this.getFeature(B.line.id)!==void 0&&(B.line.removeCoordinate(""+B.currentVertexPosition),B.line.isValid()?this.map.fire(V.CREATE,{features:[B.line.toGeoJSON()]}):(this.deleteFeature([B.line.id],{silent:!0}),this.changeMode(N.SIMPLE_SELECT,{},{silent:!0})))},Si.onTrash=function(B){this.deleteFeature([B.line.id],{silent:!0}),this.changeMode(N.SIMPLE_SELECT)},Si.toDisplayFeatures=function(B,H,ce){var Se=H.properties.id===B.line.id;if(H.properties.active=Se?te.ACTIVE:te.INACTIVE,!Se)return ce(H);H.geometry.coordinates.length<2||(H.properties.meta=J.FEATURE,ce(ir(B.line.id,H.geometry.coordinates[B.direction==="forward"?H.geometry.coordinates.length-2:1],""+(B.direction==="forward"?H.geometry.coordinates.length-2:1),!1)),ce(H))};var hr={simple_select:zr,direct_select:Zi,draw_point:hi,draw_polygon:et,draw_line_string:Si},Sr={defaultMode:N.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:an,modes:hr,controls:{},userProperties:!1},ja={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},zo={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ro(B,H){return B.map(function(ce){return ce.source?ce:Tr(ce,{id:ce.id+"."+H,source:H==="hot"?I.HOT:I.COLD})})}var vl={exports:{}};(function(B,H){var ce="__lodash_hash_undefined__",Se=9007199254740991,ze="[object Arguments]",De="[object Array]",Ke="[object Boolean]",It="[object Date]",Ft="[object Error]",Jt="[object Function]",Yt="[object Map]",Wt="[object Number]",Rn="[object Object]",Sn="[object Promise]",jn="[object RegExp]",Wr="[object Set]",yt="[object String]",en="[object Symbol]",Mr="[object WeakMap]",dr="[object ArrayBuffer]",gr="[object DataView]",Qo=/^\[object .+?Constructor\]$/,Gc=/^(?:0|[1-9]\d*)$/,Fr={};Fr["[object Float32Array]"]=Fr["[object Float64Array]"]=Fr["[object Int8Array]"]=Fr["[object Int16Array]"]=Fr["[object Int32Array]"]=Fr["[object Uint8Array]"]=Fr["[object Uint8ClampedArray]"]=Fr["[object Uint16Array]"]=Fr["[object Uint32Array]"]=!0,Fr[ze]=Fr[De]=Fr[dr]=Fr[Ke]=Fr[gr]=Fr[It]=Fr[Ft]=Fr[Jt]=Fr[Yt]=Fr[Wt]=Fr[Rn]=Fr[jn]=Fr[Wr]=Fr[yt]=Fr[Mr]=!1;var Zr=typeof zf=="object"&&zf&&zf.Object===Object&&zf,es=typeof self=="object"&&self&&self.Object===Object&&self,Rs=Zr||es||Function("return this")(),Na=H&&!H.nodeType&&H,Xr=Na&&B&&!B.nodeType&&B,ws=Xr&&Xr.exports===Na,Ga=ws&&Zr.process,Es=function(){try{return Ga&&Ga.binding&&Ga.binding("util")}catch{}}(),Zs=Es&&Es.isTypedArray;function Vc(We,dt){for(var Ut=-1,Cn=We==null?0:We.length;++Ut<Cn;)if(dt(We[Ut],Ut,We))return!0;return!1}function Xs(We){var dt=-1,Ut=Array(We.size);return We.forEach(function(Cn,Er){Ut[++dt]=[Er,Cn]}),Ut}function Du(We){var dt=-1,Ut=Array(We.size);return We.forEach(function(Cn){Ut[++dt]=Cn}),Ut}var qs,Ds,ts,Ks=Array.prototype,Cs=Function.prototype,ds=Object.prototype,fs=Rs["__core-js_shared__"],xl=Cs.toString,Co=ds.hasOwnProperty,Va=(qs=/[^.]+$/.exec(fs&&fs.keys&&fs.keys.IE_PROTO||""))?"Symbol(src)_1."+qs:"",vc=ds.toString,_a=RegExp("^"+xl.call(Co).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fo=ws?Rs.Buffer:void 0,jo=Rs.Symbol,ns=Rs.Uint8Array,fr=ds.propertyIsEnumerable,mh=Ks.splice,io=jo?jo.toStringTag:void 0,Js=Object.getOwnPropertySymbols,Vl=Fo?Fo.isBuffer:void 0,Ou=(Ds=Object.keys,ts=Object,function(We){return Ds(ts(We))}),$a=Ja(Rs,"DataView"),Os=Ja(Rs,"Map"),bl=Ja(Rs,"Promise"),Ys=Ja(Rs,"Set"),rs=Ja(Rs,"WeakMap"),As=Ja(Object,"create"),xc=Ao($a),ku=Ao(Os),wl=Ao(bl),Ha=Ao(Ys),Wa=Ao(rs),Za=jo?jo.prototype:void 0,ya=Za?Za.valueOf:void 0;function Fi(We){var dt=-1,Ut=We==null?0:We.length;for(this.clear();++dt<Ut;){var Cn=We[dt];this.set(Cn[0],Cn[1])}}function Pn(We){var dt=-1,Ut=We==null?0:We.length;for(this.clear();++dt<Ut;){var Cn=We[dt];this.set(Cn[0],Cn[1])}}function oo(We){var dt=-1,Ut=We==null?0:We.length;for(this.clear();++dt<Ut;){var Cn=We[dt];this.set(Cn[0],Cn[1])}}function ps(We){var dt=-1,Ut=We==null?0:We.length;for(this.__data__=new oo;++dt<Ut;)this.add(We[dt])}function Yi(We){var dt=this.__data__=new Pn(We);this.size=dt.size}function Xa(We,dt){var Ut=ea(We),Cn=!Ut&&El(We),Er=!Ut&&!Cn&&Uo(We),pr=!Ut&&!Cn&&!Er&&Ya(We),ei=Ut||Cn||Er||pr,Qn=ei?function(vi,ss){for(var di=-1,ji=Array(vi);++di<vi;)ji[di]=ss(di);return ji}(We.length,String):[],Qi=Qn.length;for(var Mi in We)!Co.call(We,Mi)||ei&&(Mi=="length"||Er&&(Mi=="offset"||Mi=="parent")||pr&&(Mi=="buffer"||Mi=="byteLength"||Mi=="byteOffset")||$l(Mi,Qi))||Qn.push(Mi);return Qn}function ks(We,dt){for(var Ut=We.length;Ut--;)if(xa(We[Ut][0],dt))return Ut;return-1}function va(We){return We==null?We===void 0?"[object Undefined]":"[object Null]":io&&io in Object(We)?function(dt){var Ut=Co.call(dt,io),Cn=dt[io];try{dt[io]=void 0;var Er=!0}catch{}var pr=vc.call(dt);return Er&&(Ut?dt[io]=Cn:delete dt[io]),pr}(We):function(dt){return vc.call(dt)}(We)}function $c(We){return Cl(We)&&va(We)==ze}function is(We,dt,Ut,Cn,Er){return We===dt||(We==null||dt==null||!Cl(We)&&!Cl(dt)?We!=We&&dt!=dt:function(pr,ei,Qn,Qi,Mi,vi){var ss=ea(pr),di=ea(ei),ji=ss?De:Qs(pr),Rr=di?De:Qs(ei),Ri=(ji=ji==ze?Rn:ji)==Rn,Di=(Rr=Rr==ze?Rn:Rr)==Rn,ba=ji==Rr;if(ba&&Uo(pr)){if(!Uo(ei))return!1;ss=!0,Ri=!1}if(ba&&!Ri)return vi||(vi=new Yi),ss||Ya(pr)?qa(pr,ei,Qn,Qi,Mi,vi):function(Dr,cr,Ea,qr,To,Xi,eo){switch(Ea){case gr:if(Dr.byteLength!=cr.byteLength||Dr.byteOffset!=cr.byteOffset)return!1;Dr=Dr.buffer,cr=cr.buffer;case dr:return!(Dr.byteLength!=cr.byteLength||!Xi(new ns(Dr),new ns(cr)));case Ke:case It:case Wt:return xa(+Dr,+cr);case Ft:return Dr.name==cr.name&&Dr.message==cr.message;case jn:case yt:return Dr==cr+"";case Yt:var So=Xs;case Wr:var Ca=1&qr;if(So||(So=Du),Dr.size!=cr.size&&!Ca)return!1;var Qa=eo.get(Dr);if(Qa)return Qa==cr;qr|=2,eo.set(Dr,cr);var nr=qa(So(Dr),So(cr),qr,To,Xi,eo);return eo.delete(Dr),nr;case en:if(ya)return ya.call(Dr)==ya.call(cr)}return!1}(pr,ei,ji,Qn,Qi,Mi,vi);if(!(1&Qn)){var na=Ri&&Co.call(pr,"__wrapped__"),wa=Di&&Co.call(ei,"__wrapped__");if(na||wa){var Wl=na?pr.value():pr,so=wa?ei.value():ei;return vi||(vi=new Yi),Mi(Wl,so,Qn,Qi,vi)}}return ba?(vi||(vi=new Yi),function(Dr,cr,Ea,qr,To,Xi){var eo=1&Ea,So=os(Dr),Ca=So.length,Qa=os(cr).length;if(Ca!=Qa&&!eo)return!1;for(var nr=Ca;nr--;){var Ss=So[nr];if(!(eo?Ss in cr:Co.call(cr,Ss)))return!1}var Wc=Xi.get(Dr);if(Wc&&Xi.get(cr))return Wc==cr;var el=!0;Xi.set(Dr,cr),Xi.set(cr,Dr);for(var ra=eo;++nr<Ca;){var Aa=Dr[Ss=So[nr]],tl=cr[Ss];if(qr)var gs=eo?qr(tl,Aa,Ss,cr,Dr,Xi):qr(Aa,tl,Ss,Dr,cr,Xi);if(!(gs===void 0?Aa===tl||To(Aa,tl,Ea,qr,Xi):gs)){el=!1;break}ra||(ra=Ss=="constructor")}if(el&&!ra){var nl=Dr.constructor,Ta=cr.constructor;nl==Ta||!("constructor"in Dr)||!("constructor"in cr)||typeof nl=="function"&&nl instanceof nl&&typeof Ta=="function"&&Ta instanceof Ta||(el=!1)}return Xi.delete(Dr),Xi.delete(cr),el}(pr,ei,Qn,Qi,Mi,vi)):!1}(We,dt,Ut,Cn,is,Er))}function ms(We){return!(!ta(We)||function(dt){return!!Va&&Va in dt}(We))&&(Hl(We)?_a:Qo).test(Ao(We))}function Qr(We){if(Ut=(dt=We)&&dt.constructor,Cn=typeof Ut=="function"&&Ut.prototype||ds,dt!==Cn)return Ou(We);var dt,Ut,Cn,Er=[];for(var pr in Object(We))Co.call(We,pr)&&pr!="constructor"&&Er.push(pr);return Er}function qa(We,dt,Ut,Cn,Er,pr){var ei=1&Ut,Qn=We.length,Qi=dt.length;if(Qn!=Qi&&!(ei&&Qi>Qn))return!1;var Mi=pr.get(We);if(Mi&&pr.get(dt))return Mi==dt;var vi=-1,ss=!0,di=2&Ut?new ps:void 0;for(pr.set(We,dt),pr.set(dt,We);++vi<Qn;){var ji=We[vi],Rr=dt[vi];if(Cn)var Ri=ei?Cn(Rr,ji,vi,dt,We,pr):Cn(ji,Rr,vi,We,dt,pr);if(Ri!==void 0){if(Ri)continue;ss=!1;break}if(di){if(!Vc(dt,function(Di,ba){if(na=ba,!di.has(na)&&(ji===Di||Er(ji,Di,Ut,Cn,pr)))return di.push(ba);var na})){ss=!1;break}}else if(ji!==Rr&&!Er(ji,Rr,Ut,Cn,pr)){ss=!1;break}}return pr.delete(We),pr.delete(dt),ss}function os(We){return function(dt,Ut,Cn){var Er=Ut(dt);return ea(dt)?Er:function(pr,ei){for(var Qn=-1,Qi=ei.length,Mi=pr.length;++Qn<Qi;)pr[Mi+Qn]=ei[Qn];return pr}(Er,Cn(dt))}(We,Ts,Hc)}function Ka(We,dt){var Ut,Cn,Er=We.__data__;return((Cn=typeof(Ut=dt))=="string"||Cn=="number"||Cn=="symbol"||Cn=="boolean"?Ut!=="__proto__":Ut===null)?Er[typeof dt=="string"?"string":"hash"]:Er.map}function Ja(We,dt){var Ut=function(Cn,Er){return Cn==null?void 0:Cn[Er]}(We,dt);return ms(Ut)?Ut:void 0}Fi.prototype.clear=function(){this.__data__=As?As(null):{},this.size=0},Fi.prototype.delete=function(We){var dt=this.has(We)&&delete this.__data__[We];return this.size-=dt?1:0,dt},Fi.prototype.get=function(We){var dt=this.__data__;if(As){var Ut=dt[We];return Ut===ce?void 0:Ut}return Co.call(dt,We)?dt[We]:void 0},Fi.prototype.has=function(We){var dt=this.__data__;return As?dt[We]!==void 0:Co.call(dt,We)},Fi.prototype.set=function(We,dt){var Ut=this.__data__;return this.size+=this.has(We)?0:1,Ut[We]=As&&dt===void 0?ce:dt,this},Pn.prototype.clear=function(){this.__data__=[],this.size=0},Pn.prototype.delete=function(We){var dt=this.__data__,Ut=ks(dt,We);return!(Ut<0)&&(Ut==dt.length-1?dt.pop():mh.call(dt,Ut,1),--this.size,!0)},Pn.prototype.get=function(We){var dt=this.__data__,Ut=ks(dt,We);return Ut<0?void 0:dt[Ut][1]},Pn.prototype.has=function(We){return ks(this.__data__,We)>-1},Pn.prototype.set=function(We,dt){var Ut=this.__data__,Cn=ks(Ut,We);return Cn<0?(++this.size,Ut.push([We,dt])):Ut[Cn][1]=dt,this},oo.prototype.clear=function(){this.size=0,this.__data__={hash:new Fi,map:new(Os||Pn),string:new Fi}},oo.prototype.delete=function(We){var dt=Ka(this,We).delete(We);return this.size-=dt?1:0,dt},oo.prototype.get=function(We){return Ka(this,We).get(We)},oo.prototype.has=function(We){return Ka(this,We).has(We)},oo.prototype.set=function(We,dt){var Ut=Ka(this,We),Cn=Ut.size;return Ut.set(We,dt),this.size+=Ut.size==Cn?0:1,this},ps.prototype.add=ps.prototype.push=function(We){return this.__data__.set(We,ce),this},ps.prototype.has=function(We){return this.__data__.has(We)},Yi.prototype.clear=function(){this.__data__=new Pn,this.size=0},Yi.prototype.delete=function(We){var dt=this.__data__,Ut=dt.delete(We);return this.size=dt.size,Ut},Yi.prototype.get=function(We){return this.__data__.get(We)},Yi.prototype.has=function(We){return this.__data__.has(We)},Yi.prototype.set=function(We,dt){var Ut=this.__data__;if(Ut instanceof Pn){var Cn=Ut.__data__;if(!Os||Cn.length<199)return Cn.push([We,dt]),this.size=++Ut.size,this;Ut=this.__data__=new oo(Cn)}return Ut.set(We,dt),this.size=Ut.size,this};var Hc=Js?function(We){return We==null?[]:(We=Object(We),function(dt,Ut){for(var Cn=-1,Er=dt==null?0:dt.length,pr=0,ei=[];++Cn<Er;){var Qn=dt[Cn];Ut(Qn,Cn,dt)&&(ei[pr++]=Qn)}return ei}(Js(We),function(dt){return fr.call(We,dt)}))}:function(){return[]},Qs=va;function $l(We,dt){return!!(dt=dt??Se)&&(typeof We=="number"||Gc.test(We))&&We>-1&&We%1==0&&We<dt}function Ao(We){if(We!=null){try{return xl.call(We)}catch{}try{return We+""}catch{}}return""}function xa(We,dt){return We===dt||We!=We&&dt!=dt}($a&&Qs(new $a(new ArrayBuffer(1)))!=gr||Os&&Qs(new Os)!=Yt||bl&&Qs(bl.resolve())!=Sn||Ys&&Qs(new Ys)!=Wr||rs&&Qs(new rs)!=Mr)&&(Qs=function(We){var dt=va(We),Ut=dt==Rn?We.constructor:void 0,Cn=Ut?Ao(Ut):"";if(Cn)switch(Cn){case xc:return gr;case ku:return Yt;case wl:return Sn;case Ha:return Wr;case Wa:return Mr}return dt});var El=$c(function(){return arguments}())?$c:function(We){return Cl(We)&&Co.call(We,"callee")&&!fr.call(We,"callee")},ea=Array.isArray,Uo=Vl||function(){return!1};function Hl(We){if(!ta(We))return!1;var dt=va(We);return dt==Jt||dt=="[object GeneratorFunction]"||dt=="[object AsyncFunction]"||dt=="[object Proxy]"}function bc(We){return typeof We=="number"&&We>-1&&We%1==0&&We<=Se}function ta(We){var dt=typeof We;return We!=null&&(dt=="object"||dt=="function")}function Cl(We){return We!=null&&typeof We=="object"}var Ya=Zs?function(We){return function(dt){return We(dt)}}(Zs):function(We){return Cl(We)&&bc(We.length)&&!!Fr[va(We)]};function Ts(We){return(dt=We)!=null&&bc(dt.length)&&!Hl(dt)?Xa(We):Qr(We);var dt}B.exports=function(We,dt){return is(We,dt)}})(vl,vl.exports);var Ua=l(vl.exports);function Ht(B,H){return B.length===H.length&&JSON.stringify(B.map(function(ce){return ce}).sort())===JSON.stringify(H.map(function(ce){return ce}).sort())}var Xn={Polygon:Yn,LineString:rr,Point:On,MultiPolygon:kr,MultiLineString:kr,MultiPoint:kr},qn=Object.freeze({__proto__:null,CommonSelectors:Ko,constrainFeatureMovement:Ws,createMidPoint:Ae,createSupplementaryPoints:se,createVertex:ir,doubleClickZoom:le,euclideanDistance:hn,featuresAt:Bt,getFeatureAtAndSetCursors:Gt,isClick:wt,isEventAtCoordinates:wr,isTap:bt,mapEventToBoundingBox:Ne,ModeHandler:r,moveFeatures:Jo,sortFeatures:me,stringSetsAreEqual:Ht,StringSet:ht,theme:an,toDenseArray:ci}),wi=function(B,H){var ce={options:B=function(ze){ze===void 0&&(ze={});var De=Tr(ze);return ze.controls||(De.controls={}),ze.displayControlsDefault===!1?De.controls=Tr(zo,ze.controls):De.controls=Tr(ja,ze.controls),(De=Tr(Sr,De)).styles=ro(De.styles,"cold").concat(ro(De.styles,"hot")),De}(B)};H=function(ze,De){return De.modes=N,De.getFeatureIdsAt=function(Ke){return Bt.click({point:Ke},null,ze).map(function(It){return It.properties.id})},De.getSelectedIds=function(){return ze.store.getSelectedIds()},De.getSelected=function(){return{type:U.FEATURE_COLLECTION,features:ze.store.getSelectedIds().map(function(Ke){return ze.store.get(Ke)}).map(function(Ke){return Ke.toGeoJSON()})}},De.getSelectedPoints=function(){return{type:U.FEATURE_COLLECTION,features:ze.store.getSelectedCoordinates().map(function(Ke){return{type:U.FEATURE,properties:{},geometry:{type:U.POINT,coordinates:Ke.coordinates}}})}},De.set=function(Ke){if(Ke.type===void 0||Ke.type!==U.FEATURE_COLLECTION||!Array.isArray(Ke.features))throw new Error("Invalid FeatureCollection");var It=ze.store.createRenderBatch(),Ft=ze.store.getAllIds().slice(),Jt=De.add(Ke),Yt=new ht(Jt);return(Ft=Ft.filter(function(Wt){return!Yt.has(Wt)})).length&&De.delete(Ft),It(),Jt},De.add=function(Ke){var It=JSON.parse(JSON.stringify(Xe(Ke))).features.map(function(Ft){if(Ft.id=Ft.id||mn(),Ft.geometry===null)throw new Error("Invalid geometry: null");if(ze.store.get(Ft.id)===void 0||ze.store.get(Ft.id).type!==Ft.geometry.type){var Jt=Xn[Ft.geometry.type];if(Jt===void 0)throw new Error("Invalid geometry type: "+Ft.geometry.type+".");var Yt=new Jt(ze,Ft);ze.store.add(Yt)}else{var Wt=ze.store.get(Ft.id);Wt.properties=Ft.properties,Ua(Wt.properties,Ft.properties)||ze.store.featureChanged(Wt.id),Ua(Wt.getCoordinates(),Ft.geometry.coordinates)||Wt.incomingCoords(Ft.geometry.coordinates)}return Ft.id});return ze.store.render(),It},De.get=function(Ke){var It=ze.store.get(Ke);if(It)return It.toGeoJSON()},De.getAll=function(){return{type:U.FEATURE_COLLECTION,features:ze.store.getAll().map(function(Ke){return Ke.toGeoJSON()})}},De.delete=function(Ke){return ze.store.delete(Ke,{silent:!0}),De.getMode()!==N.DIRECT_SELECT||ze.store.getSelectedIds().length?ze.store.render():ze.events.changeMode(N.SIMPLE_SELECT,void 0,{silent:!0}),De},De.deleteAll=function(){return ze.store.delete(ze.store.getAllIds(),{silent:!0}),De.getMode()===N.DIRECT_SELECT?ze.events.changeMode(N.SIMPLE_SELECT,void 0,{silent:!0}):ze.store.render(),De},De.changeMode=function(Ke,It){return It===void 0&&(It={}),Ke===N.SIMPLE_SELECT&&De.getMode()===N.SIMPLE_SELECT?(Ht(It.featureIds||[],ze.store.getSelectedIds())||(ze.store.setSelected(It.featureIds,{silent:!0}),ze.store.render()),De):(Ke===N.DIRECT_SELECT&&De.getMode()===N.DIRECT_SELECT&&It.featureId===ze.store.getSelectedIds()[0]||ze.events.changeMode(Ke,It,{silent:!0}),De)},De.getMode=function(){return ze.events.getMode()},De.trash=function(){return ze.events.trash({silent:!0}),De},De.combineFeatures=function(){return ze.events.combineFeatures({silent:!0}),De},De.uncombineFeatures=function(){return ze.events.uncombineFeatures({silent:!0}),De},De.setFeatureProperty=function(Ke,It,Ft){return ze.store.setFeatureProperty(Ke,It,Ft),De},De}(ce,H),ce.api=H;var Se=bs(ce);return H.onAdd=Se.onAdd,H.onRemove=Se.onRemove,H.types=z,H.options=B,H};function Yo(B){wi(B,this)}return Yo.modes=hr,Yo.constants=be,Yo.lib=qn,Yo})})(q3);var YV=q3.exports;const QV=F_(YV);function K3(n,t,r){if(n!==null)for(var l,u,d,p,b,i,E,T=0,A=0,I,O=n.type,z=O==="FeatureCollection",U=O==="Feature",N=z?n.features.length:1,V=0;V<N;V++){E=z?n.features[V].geometry:U?n.geometry:n,I=E?E.type==="GeometryCollection":!1,b=I?E.geometries.length:1;for(var X=0;X<b;X++){var J=0,te=0;if(p=I?E.geometries[X]:E,p!==null){i=p.coordinates;var ue=p.type;switch(T=0,ue){case null:break;case"Point":if(t(i,A,V,J,te)===!1)return!1;A++,J++;break;case"LineString":case"MultiPoint":for(l=0;l<i.length;l++){if(t(i[l],A,V,J,te)===!1)return!1;A++,ue==="MultiPoint"&&J++}ue==="LineString"&&J++;break;case"Polygon":case"MultiLineString":for(l=0;l<i.length;l++){for(u=0;u<i[l].length-T;u++){if(t(i[l][u],A,V,J,te)===!1)return!1;A++}ue==="MultiLineString"&&J++,ue==="Polygon"&&te++}ue==="Polygon"&&J++;break;case"MultiPolygon":for(l=0;l<i.length;l++){for(te=0,u=0;u<i[l].length;u++){for(d=0;d<i[l][u].length-T;d++){if(t(i[l][u][d],A,V,J,te)===!1)return!1;A++}te++}J++}break;case"GeometryCollection":for(l=0;l<p.geometries.length;l++)if(K3(p.geometries[l],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ap(n){var t=[1/0,1/0,-1/0,-1/0];return K3(n,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}ap.default=ap;function J3(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function e$(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function B_(n){return n.type==="Feature"?n.geometry:n}function oy(n,t,r){if(r===void 0&&(r={}),!n)throw new Error("point is required");if(!t)throw new Error("polygon is required");var l=J3(n),u=B_(t),d=u.type,p=t.bbox,b=u.coordinates;if(p&&t$(l,p)===!1)return!1;d==="Polygon"&&(b=[b]);for(var i=!1,E=0;E<b.length&&!i;E++)if(iT(l,b[E][0],r.ignoreBoundary)){for(var T=!1,A=1;A<b[E].length&&!T;)iT(l,b[E][A],!r.ignoreBoundary)&&(T=!0),A++;T||(i=!0)}return i}function iT(n,t,r){var l=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var u=0,d=t.length-1;u<t.length;d=u++){var p=t[u][0],b=t[u][1],i=t[d][0],E=t[d][1],T=n[1]*(p-i)+b*(i-n[0])+E*(n[0]-p)===0&&(p-n[0])*(i-n[0])<=0&&(b-n[1])*(E-n[1])<=0;if(T)return!r;var A=b>n[1]!=E>n[1]&&n[0]<(i-p)*(n[1]-b)/(E-b)+p;A&&(l=!l)}return l}function t$(n,t){return t[0]<=n[0]&&t[1]<=n[1]&&t[2]>=n[0]&&t[3]>=n[1]}function Om(n,t,r){r===void 0&&(r={});for(var l=J3(n),u=e$(t),d=0;d<u.length-1;d++){var p=!1;if(r.ignoreEndVertices&&(d===0&&(p="start"),d===u.length-2&&(p="end"),d===0&&d+1===u.length-1&&(p="both")),n$(u[d],u[d+1],l,p,typeof r.epsilon>"u"?null:r.epsilon))return!0}return!1}function n$(n,t,r,l,u){var d=r[0],p=r[1],b=n[0],i=n[1],E=t[0],T=t[1],A=r[0]-b,I=r[1]-i,O=E-b,z=T-i,U=A*z-I*O;if(u!==null){if(Math.abs(U)>u)return!1}else if(U!==0)return!1;if(l){if(l==="start")return Math.abs(O)>=Math.abs(z)?O>0?b<d&&d<=E:E<=d&&d<b:z>0?i<p&&p<=T:T<=p&&p<i;if(l==="end")return Math.abs(O)>=Math.abs(z)?O>0?b<=d&&d<E:E<d&&d<=b:z>0?i<=p&&p<T:T<p&&p<=i;if(l==="both")return Math.abs(O)>=Math.abs(z)?O>0?b<d&&d<E:E<d&&d<b:z>0?i<p&&p<T:T<p&&p<i}else return Math.abs(O)>=Math.abs(z)?O>0?b<=d&&d<=E:E<=d&&d<=b:z>0?i<=p&&p<=T:T<=p&&p<=i;return!1}function r$(n,t){var r=B_(n),l=B_(t),u=r.type,d=l.type,p=r.coordinates,b=l.coordinates;switch(u){case"Point":switch(d){case"Point":return Sx(p,b);default:throw new Error("feature2 "+d+" geometry not supported")}case"MultiPoint":switch(d){case"Point":return i$(r,l);case"MultiPoint":return o$(r,l);default:throw new Error("feature2 "+d+" geometry not supported")}case"LineString":switch(d){case"Point":return Om(l,r,{ignoreEndVertices:!0});case"LineString":return l$(r,l);case"MultiPoint":return s$(r,l);default:throw new Error("feature2 "+d+" geometry not supported")}case"Polygon":switch(d){case"Point":return oy(l,r,{ignoreBoundary:!0});case"LineString":return c$(r,l);case"Polygon":return u$(r,l);case"MultiPoint":return a$(r,l);default:throw new Error("feature2 "+d+" geometry not supported")}default:throw new Error("feature1 "+u+" geometry not supported")}}function i$(n,t){var r,l=!1;for(r=0;r<n.coordinates.length;r++)if(Sx(n.coordinates[r],t.coordinates)){l=!0;break}return l}function o$(n,t){for(var r=0,l=t.coordinates;r<l.length;r++){for(var u=l[r],d=!1,p=0,b=n.coordinates;p<b.length;p++){var i=b[p];if(Sx(u,i)){d=!0;break}}if(!d)return!1}return!0}function s$(n,t){for(var r=!1,l=0,u=t.coordinates;l<u.length;l++){var d=u[l];if(Om(d,n,{ignoreEndVertices:!0})&&(r=!0),!Om(d,n))return!1}return!!r}function a$(n,t){for(var r=0,l=t.coordinates;r<l.length;r++){var u=l[r];if(!oy(u,n,{ignoreBoundary:!0}))return!1}return!0}function l$(n,t){for(var r=!1,l=0,u=t.coordinates;l<u.length;l++){var d=u[l];if(Om({type:"Point",coordinates:d},n,{ignoreEndVertices:!0})&&(r=!0),!Om({type:"Point",coordinates:d},n,{ignoreEndVertices:!1}))return!1}return r}function c$(n,t){var r=!1,l=0,u=ap(n),d=ap(t);if(!Y3(u,d))return!1;for(l;l<t.coordinates.length-1;l++){var p=h$(t.coordinates[l],t.coordinates[l+1]);if(oy({type:"Point",coordinates:p},n,{ignoreBoundary:!0})){r=!0;break}}return r}function u$(n,t){if(n.type==="Feature"&&n.geometry===null||t.type==="Feature"&&t.geometry===null)return!1;var r=ap(n),l=ap(t);if(!Y3(r,l))return!1;for(var u=B_(t).coordinates,d=0,p=u;d<p.length;d++)for(var b=p[d],i=0,E=b;i<E.length;i++){var T=E[i];if(!oy(T,n))return!1}return!0}function Y3(n,t){return!(n[0]>t[0]||n[2]<t[2]||n[1]>t[1]||n[3]<t[3])}function Sx(n,t){return n[0]===t[0]&&n[1]===t[1]}function h$(n,t){return[(n[0]+t[0])/2,(n[1]+t[1])/2]}var Q3={exports:{}};(function(n,t){var r={};(function(l,u){n.exports=u()})(zf,function(){var l,u,d;function p(i,E){if(!l)l=E;else if(!u)u=E;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",A={};l(A),d=E(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}p(["exports"],function(i){var E=typeof self<"u"?self:{},T="2.15.0";let A;const I={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(A==null){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{A=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):o}catch{A=o}}return A},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!I.API_URL)return null;try{const o=new URL(I.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},O={supported:!1,testSupport:function(o){!N&&U&&(V?X(o):z=o)}};let z,U,N=!1,V=!1;function X(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,U),o.isContextLost())return;O.supported=!0}catch{}o.deleteTexture(e),N=!0}E.document&&(U=E.document.createElement("img"),U.onload=function(){z&&X(z),z=null,V=!0},U.onerror=function(){N=!0,z=null},U.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const J="01";function te(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ue=ae;function ae(o,e,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=e,this.p2x=s,this.p2y=c}ae.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,e){if(e===void 0&&(e=1e-6),o<0)return 0;if(o>1)return 1;for(var s=o,c=0;c<8;c++){var f=this.sampleCurveX(s)-o;if(Math.abs(f)<e)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=f/g}var x=0,C=1;for(s=o,c=0;c<20&&(f=this.sampleCurveX(s),!(Math.abs(f-o)<e));c++)o>f?x=s:C=s,s=.5*(C-x)+x;return s},solve:function(o,e){return this.sampleCurveY(this.solveCurveX(o,e))}};var be=te(ue),Ce=je;function je(o,e){this.x=o,this.y=e}je.prototype={clone:function(){return new je(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,e){return this.clone()._rotateAround(o,e)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var e=o.x-this.x,s=o.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult:function(o){var e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var e=Math.cos(o),s=Math.sin(o),c=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,e){var s=Math.cos(o),c=Math.sin(o),f=e.y+c*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-c*(this.y-e.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},je.convert=function(o){return o instanceof je?o:Array.isArray(o)?new je(o[0],o[1]):o};var me=te(Ce);const Ne=Math.PI/180,ht=180/Math.PI;function _t(o){return o*Ne}function Bt(o){return o*ht}const Kt=[[0,0],[1,0],[1,1],[0,1]];function Gt(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,s=e*o;return 4*(o<.5?s:3*(o-e)+s-.75)}function hn(o,e,s,c){const f=new be(o,e,s,c);return function(g){return f.solve(g)}}const wt=hn(.25,.1,.25,1);function bt(o,e,s){return Math.min(s,Math.max(e,o))}function $t(o,e,s){return(s=bt((s-o)/(e-o),0,1))*s*(3-2*s)}function Zt(o,e,s){const c=s-e,f=((o-e)%c+c)%c+e;return f===e?s:f}function mn(o,e,s){if(!o.length)return s(null,[]);let c=o.length;const f=new Array(o.length);let g=null;o.forEach((x,C)=>{e(x,(M,P)=>{M&&(g=M),f[C]=P,--c==0&&s(g,f)})})}function yn(o){const e=[];for(const s in o)e.push(o[s]);return e}function On(o,...e){for(const s of e)for(const c in s)o[c]=s[c];return o}let rr=1;function Yn(){return rr++}function Vr(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Jr(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function kr(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Ln(o,e){o.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function li(o,e){return o.indexOf(e,o.length-e.length)!==-1}function kn(o,e,s){const c={};for(const f in o)c[f]=e.call(this,o[f],f,o);return c}function Br(o,e,s){const c={};for(const f in o)e.call(s||this,o[f],f,o)&&(c[f]=o[f]);return c}function ci(o){return Array.isArray(o)?o.map(ci):typeof o=="object"&&o?kn(o,ci):o}const Ji={};function wn(o){Ji[o]||(typeof console<"u"&&console.warn(o),Ji[o]=!0)}function ki(o,e,s){return(s.y-o.y)*(e.x-o.x)>(e.y-o.y)*(s.x-o.x)}function Bs(o){let e=0;for(let s,c,f=0,g=o.length,x=g-1;f<g;x=f++)s=o[f],c=o[x],e+=(c.x-s.x)*(s.y+c.y);return e}function Do(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Tr(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,f,g)=>{const x=f||g;return e[c]=!x||x.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let xo=null;function bs(o){if(xo==null){const e=o.navigator?o.navigator.userAgent:null;xo=!!o.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return xo}function an(o){try{const e=E[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function xn(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}const $r="mapbox-tiles";let Hr=500,Bi=50,ui,Hi;function Oo(){try{return E.caches}catch{}}function no(){Oo()&&!ui&&(ui=E.caches.open($r))}function ko(o){const e=o.indexOf("?");if(e<0)return o;const s=function(f){const g=f.indexOf("?");return g>0?f.slice(g+1).split("&"):[]}(o),c=s.filter(f=>{const g=f.split("=");return g[0]==="language"||g[0]==="worldview"});return c.length?`${o.slice(0,e)}?${c.join("&")}`:o.slice(0,e)}let bo=1/0;const Ko={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ko);class wo extends Error{constructor(e,s,c){s===401&&Xe(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Je=Do()?()=>self.worker&&self.worker.referrer:()=>(E.location.protocol==="blob:"?E.parent:E).location.href,Vt=function(o,e){if(!(/^file:/.test(s=o.url)||/^file:/.test(Je())&&!/^\w+:/.test(s))){if(E.fetch&&E.Request&&E.AbortController&&E.Request.prototype.hasOwnProperty("signal"))return function(c,f){const g=new E.AbortController,x=new E.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Je(),referrerPolicy:c.referrerPolicy,signal:g.signal});let C=!1,M=!1;const P=(j=x.url).indexOf("sku=")>0&&Xe(j);var j;c.type==="json"&&x.headers.set("Accept","application/json");const $=(Y,ee,oe)=>{if(M)return;if(Y&&Y.message!=="SecurityError"&&wn(Y.toString()),ee&&oe)return W(ee);const de=Date.now();E.fetch(x).then(ve=>{if(ve.ok){const Le=P?ve.clone():null;return W(ve,Le,de)}return f(new wo(ve.statusText,ve.status,c.url))}).catch(ve=>{ve.name!=="AbortError"&&f(new Error(`${ve.message} ${c.url}`))})},W=(Y,ee,oe)=>{(c.type==="arrayBuffer"?Y.arrayBuffer():c.type==="json"?Y.json():Y.text()).then(de=>{M||(ee&&oe&&function(ve,Le,xe){if(no(),!ui)return;const Me={status:Le.status,statusText:Le.statusText,headers:new E.Headers};Le.headers.forEach((ot,nt)=>Me.headers.set(nt,ot));const Oe=Tr(Le.headers.get("Cache-Control")||"");if(Oe["no-store"])return;Oe["max-age"]&&Me.headers.set("Expires",new Date(xe+1e3*Oe["max-age"]).toUTCString());const Re=Me.headers.get("Expires");Re&&(new Date(Re).getTime()-xe<42e4||function(ot,nt){if(Hi===void 0)try{new Response(new ReadableStream),Hi=!0}catch{Hi=!1}Hi?nt(ot.body):ot.blob().then(nt)}(Le,ot=>{const nt=new E.Response(ot,Me);no(),ui&&ui.then(pt=>pt.put(ko(ve.url),nt)).catch(pt=>wn(pt.message))}))}(x,ee,oe),C=!0,f(null,de,Y.headers.get("Cache-Control"),Y.headers.get("Expires")))}).catch(de=>{M||f(new Error(de.message))})};return P?function(Y,ee){if(no(),!ui)return ee(null);const oe=ko(Y.url);ui.then(de=>{de.match(oe).then(ve=>{const Le=function(xe){if(!xe)return!1;const Me=new Date(xe.headers.get("Expires")||0),Oe=Tr(xe.headers.get("Cache-Control")||"");return Me>Date.now()&&!Oe["no-cache"]}(ve);de.delete(oe),Le&&de.put(oe,ve.clone()),ee(null,ve,Le)}).catch(ee)}).catch(ee)}(x,$):$(null,null),{cancel:()=>{M=!0,C||g.abort()}}}(o,e);if(Do()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var s;return function(c,f){const g=new E.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const x in c.headers)g.setRequestHeader(x,c.headers[x]);return c.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=c.credentials==="include",g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let x=g.response;if(c.type==="json")try{x=JSON.parse(g.response)}catch(C){return f(C)}f(null,x,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else f(new wo(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(o,e)},In=function(o,e){return Vt(On(o,{type:"arrayBuffer"}),e)};function ir(o){const e=E.document.createElement("a");return e.href=o,e.protocol===E.document.location.protocol&&e.host===E.document.location.host}const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let se,le;se=[],le=0;const Te=function(o,e){if(O.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),le>=I.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return se.push(g),g}le++;let s=!1;const c=()=>{if(!s)for(s=!0,le--;se.length&&le<I.MAX_PARALLEL_IMAGE_REQUESTS;){const g=se.shift(),{requestParameters:x,callback:C,cancelled:M}=g;M||(g.cancel=Te(x,C).cancel)}},f=In(o,(g,x,C,M)=>{c(),g?e(g):x&&(E.createImageBitmap?function(P,j){const $=new E.Blob([new Uint8Array(P)],{type:"image/png"});E.createImageBitmap($).then(W=>{j(null,W)}).catch(W=>{j(new Error(`Could not load image because of ${W.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(P,j)=>e(P,j,C,M)):function(P,j){const $=new E.Image,W=E.URL;$.onload=()=>{j(null,$),W.revokeObjectURL($.src),$.onload=null,E.requestAnimationFrame(()=>{$.src=Ae})},$.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Y=new E.Blob([new Uint8Array(P)],{type:"image/png"});$.src=P.byteLength?W.createObjectURL(Y):Ae}(x,(P,j)=>e(P,j,C,M)))});return{cancel:()=>{f.cancel(),c()}}},Be="NO_ACCESS_TOKEN";function Ge(o){return o.indexOf("mapbox:")===0}function Xe(o){return I.API_URL_REGEX.test(o)}function qe(o){return I.API_CDN_URL_REGEX.test(o)}function Ve(o){return I.API_STYLE_REGEX.test(o)&&!rt(o)}function rt(o){return I.API_SPRITE_REGEX.test(o)}const Rt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function jt(o){const e=o.match(Rt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Dt(o){const e=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${e}`}const En="mapbox.eventData";function Un(o){if(!o)return null;const e=o.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(E.atob(e[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Fn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const s=Un(I.ACCESS_TOKEN);let c="";return c=s&&s.u?E.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(f,g)=>String.fromCharCode(+("0x"+g)))):I.ACCESS_TOKEN||"",e?`${En}.${e}:${c}`:`${En}:${c}`}fetchEventData(){const e=an("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{const f=E.localStorage.getItem(s);f&&(this.eventData=JSON.parse(f));const g=E.localStorage.getItem(c);g&&(this.anonId=g)}catch{wn("Unable to read from LocalStorage")}}saveEventData(){const e=an("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{E.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&E.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{wn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,s,c,f){if(!I.EVENTS_URL)return;const g=jt(I.EVENTS_URL);g.params.push(`access_token=${f||I.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(e).toISOString()},C=s?On(x,s):x,M={url:Dt(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=function(P,j){return Vt(On(P,{method:"POST"}),j)}(M,P=>{this.pendingRequest=null,c(P),this.saveEventData(),this.processRequests(f)})}queueRequest(e,s){this.queue.push(e),this.processRequests(s)}}const zn=new class extends Fn{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,e){I.EVENTS_URL&&I.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>Ge(s)||Xe(s))&&this.queueRequest(Date.now(),e)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Un(I.ACCESS_TOKEN),s=e?e.u:I.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;kr(this.anonId)||(this.anonId=Vr(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),x=new Date(f),C=(f-this.eventData.lastSuccess)/864e5;c=c||C>=1||C<-1||g.getDate()!==x.getDate()}else c=!0;c?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:J,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=f,this.eventData.tokenU=s)},o):this.processRequests()}},$n=zn.postTurnstileEvent.bind(zn),Yr=new class extends Fn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,e,s,c){this.skuToken=e,this.errorCb=c,I.EVENTS_URL&&(s||I.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Be)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),kr(this.anonId)||(this.anonId=Vr()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:J,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},o))}},yi=Yr.postMapLoadEvent.bind(Yr),Wi=new class extends Fn{constructor(){super("gljs.performance")}postPerformanceEvent(o,e){I.EVENTS_URL&&(o||I.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:s}=this.queue.shift(),c=function(f){const g=E.performance.getEntriesByType("resource"),x=E.performance.getEntriesByType("mark"),C=function(W){const Y={};if(W){for(const ee in W)if(ee!=="other")for(const oe of W[ee]){const de=`${ee}ResolveRangeMin`,ve=`${ee}ResolveRangeMax`,Le=`${ee}RequestCount`,xe=`${ee}RequestCachedCount`;Y[de]=Math.min(Y[de]||1/0,oe.startTime),Y[ve]=Math.max(Y[ve]||-1/0,oe.responseEnd);const Me=Oe=>{Y[Oe]===void 0&&(Y[Oe]=0),++Y[Oe]};oe.transferSize!==void 0&&oe.transferSize===0&&Me(xe),Me(Le)}}return Y}(function(W,Y){const ee={};if(W)for(const oe of W){const de=Y(oe);ee[de]===void 0&&(ee[de]=[]),ee[de].push(oe)}return ee}(g,Ru)),M=E.devicePixelRatio,P=E.navigator.connection||E.navigator.mozConnection||E.navigator.webkitConnection,j={counters:[],metadata:[],attributes:[]},$=(W,Y,ee)=>{ee!=null&&W.push({name:Y,value:ee.toString()})};for(const W in C)$(j.counters,W,C[W]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&($(j.counters,"interactionRangeMin",f.interactionRange[0]),$(j.counters,"interactionRangeMax",f.interactionRange[1])),x)for(const W of Object.keys(Nl)){const Y=Nl[W],ee=x.find(oe=>oe.name===Y);ee&&$(j.counters,Y,ee.startTime)}return $(j.counters,"visibilityHidden",f.visibilityHidden),$(j.attributes,"style",function(W){if(W)for(const Y of W){const ee=Y.name.split("?")[0];if(Ve(ee)){const oe=ee.split("/").slice(-2);if(oe.length===2)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(g)),$(j.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),$(j.attributes,"fogEnabled",f.fogEnabled?"true":"false"),$(j.attributes,"projection",f.projection),$(j.attributes,"zoom",f.zoom),$(j.metadata,"devicePixelRatio",M),$(j.metadata,"connectionEffectiveType",P?P.effectiveType:void 0),$(j.metadata,"navigatorUserAgent",E.navigator.userAgent),$(j.metadata,"screenWidth",E.screen.width),$(j.metadata,"screenHeight",E.screen.height),$(j.metadata,"windowWidth",E.innerWidth),$(j.metadata,"windowHeight",E.innerHeight),$(j.metadata,"mapWidth",f.width/M),$(j.metadata,"mapHeight",f.height/M),$(j.metadata,"webglRenderer",f.renderer),$(j.metadata,"webglVendor",f.vendor),$(j.metadata,"sdkVersion",T),$(j.metadata,"sdkIdentifier","mapbox-gl-js"),j}(s);for(const f of c.metadata);for(const f of c.counters);for(const f of c.attributes);this.postEvent(e,c,()=>{},o)}},zi=Wi.postPerformanceEvent.bind(Wi),Hs=new class extends Fn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,e,s,c){if(!I.API_URL||!I.SESSION_PATH)return;const f=jt(I.API_URL+I.SESSION_PATH);f.params.push(`sku=${e||""}`),f.params.push(`access_token=${c||I.ACCESS_TOKEN||""}`);const g={url:Dt(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(x,C){return Vt(On(x,{method:"GET"}),C)}(g,x=>{this.pendingRequest=null,s(x),this.saveEventData(),this.processRequests(c)})}getSessionAPI(o,e,s,c){this.skuToken=e,this.errorCb=c,I.SESSION_PATH&&I.API_URL&&(s||I.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Be)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},o)}},br=Hs.getSessionAPI.bind(Hs),Eo=new Set,Nl={create:"create",load:"load",fullLoad:"fullLoad"},Yh={mark(o){E.performance.mark(o)},measure(o,e,s){E.performance.measure(o,e,s)}};function Ru(o){const e=o.name.split("?")[0];return qe(e)&&e.includes("mapbox-gl.js")?"javascript":qe(e)&&e.includes("mapbox-gl.css")?"css":function(s){return I.API_FONTS_REGEX.test(s)}(e)?"fontRange":rt(e)?"sprite":Ve(e)?"style":function(s){return I.API_TILEJSON_REGEX.test(s)}(e)?"tilejson":"other"}const vr=E.performance;function _c(o){const e=o?o.url.toString():void 0;return vr.getEntriesByName(e)}let yc,Fa,Ws,Jo;const zr={now:()=>Ws!==void 0?Ws:E.performance.now(),setNow(o){Ws=o},restoreNow(){Ws=void 0},frame(o){const e=E.requestAnimationFrame(o);return{cancel:()=>E.cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:s,height:c}=o;Jo||(Jo=E.document.createElement("canvas"));const f=Jo.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(s>Jo.width||c>Jo.height)&&(Jo.width=s,Jo.height=c),f.clearRect(-e,-e,s+2*e,c+2*e),f.drawImage(o,0,0,s,c),f.getImageData(-e,-e,s+2*e,c+2*e)},resolveURL:o=>(yc||(yc=E.document.createElement("a")),yc.href=o,yc.href),get devicePixelRatio(){return E.devicePixelRatio},get prefersReducedMotion(){return!!E.matchMedia&&(Fa==null&&(Fa=E.matchMedia("(prefers-reduced-motion: reduce)")),Fa.matches)}};function Nc(o,e,s){s[o]&&s[o].indexOf(e)!==-1||(s[o]=s[o]||[],s[o].push(e))}function Gl(o,e,s){if(s&&s[o]){const c=s[o].indexOf(e);c!==-1&&s[o].splice(c,1)}}class Zi{constructor(e,s={}){On(this,s),this.type=e}}class hi extends Zi{constructor(e,s={}){super("error",On({error:e},s))}}class wr{on(e,s){return this._listeners=this._listeners||{},Nc(e,s,this._listeners),this}off(e,s){return Gl(e,s,this._listeners),Gl(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Nc(e,s,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,s){typeof e=="string"&&(e=new Zi(e,s||{}));const c=e.type;if(this.listens(c)){e.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const C of f)C.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const C of g)Gl(c,C,this._oneTimeListeners),C.call(this,e);const x=this._eventedParent;x&&(On(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof hi&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var et=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Si(o,...e){for(const s of e)for(const c in s)o[c]=s[c];return o}function hr(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Sr(o){if(Array.isArray(o))return o.map(Sr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const s in o)e[s]=Sr(o[s]);return e}return hr(o)}class ja extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}var zo=ja;class ro{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[c,f]of s)this.bindings[c]=f}concat(e){return new ro(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var vl=ro;const Ua={kind:"null"},Ht={kind:"number"},Xn={kind:"string"},qn={kind:"boolean"},wi={kind:"color"},Yo={kind:"object"},B={kind:"value"},H={kind:"collator"},ce={kind:"formatted"},Se={kind:"resolvedImage"};function ze(o,e){return{kind:"array",itemType:o,N:e}}function De(o){if(o.kind==="array"){const e=De(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const Ke=[Ua,Ht,Xn,qn,wi,ce,Yo,ze(B),Se];function It(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!It(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const s of Ke)if(!It(s,e))return null}}return`Expected ${De(o)} but found ${De(e)} instead.`}function Ft(o,e){return e.some(s=>s.kind===o.kind)}function Jt(o,e){return e.some(s=>s==="null"?o===null:s==="array"?Array.isArray(o):s==="object"?o&&!Array.isArray(o)&&typeof o=="object":s===typeof o)}var Yt,Wt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rn(o){return(o=Math.round(o))<0?0:o>255?255:o}function Sn(o){return Rn(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function jn(o){return(e=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:e>1?1:e;var e}function Wr(o,e,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?o+(e-o)*s*6:2*s<1?e:3*s<2?o+(e-o)*(2/3-s)*6:o}try{Yt={}.parseCSSColor=function(o){var e,s=o.replace(/ /g,"").toLowerCase();if(s in Wt)return Wt[s].slice();if(s[0]==="#")return s.length===4?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:s.length===7&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var c=s.indexOf("("),f=s.indexOf(")");if(c!==-1&&f+1===s.length){var g=s.substr(0,c),x=s.substr(c+1,f-(c+1)).split(","),C=1;switch(g){case"rgba":if(x.length!==4)return null;C=jn(x.pop());case"rgb":return x.length!==3?null:[Sn(x[0]),Sn(x[1]),Sn(x[2]),C];case"hsla":if(x.length!==4)return null;C=jn(x.pop());case"hsl":if(x.length!==3)return null;var M=(parseFloat(x[0])%360+360)%360/360,P=jn(x[1]),j=jn(x[2]),$=j<=.5?j*(P+1):j+P-j*P,W=2*j-$;return[Rn(255*Wr(W,$,M+1/3)),Rn(255*Wr(W,$,M)),Rn(255*Wr(W,$,M-1/3)),C];default:return null}}return null}}catch{}class yt{constructor(e,s,c,f=1){this.r=e,this.g=s,this.b=c,this.a=f}static parse(e){if(!e)return;if(e instanceof yt)return e;if(typeof e!="string")return;const s=Yt(e);return s?new yt(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,c,f]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(c)},${f})`}toArray(){const{r:e,g:s,b:c,a:f}=this;return f===0?[0,0,0,0]:[255*e/f,255*s/f,255*c/f,f]}toArray01(){const{r:e,g:s,b:c,a:f}=this;return f===0?[0,0,0,0]:[e/f,s/f,c/f,f]}toArray01PremultipliedAlpha(){const{r:e,g:s,b:c,a:f}=this;return[e,s,c,f]}}yt.black=new yt(0,0,0,1),yt.white=new yt(1,1,1,1),yt.transparent=new yt(0,0,0,0),yt.red=new yt(1,0,0,1),yt.blue=new yt(0,0,1,1);var en=yt;class Mr{constructor(e,s,c){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dr{constructor(e,s,c,f,g){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=c,this.fontStack=f,this.textColor=g}}class gr{constructor(e){this.sections=e}static fromString(e){return new gr([new dr(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof gr?e:gr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){e.push(["image",s.image.name]);continue}e.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),e.push(c)}return e}}class Qo{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Qo({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Gc(o,e,s,c){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[o,e,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[o,e,s,c]:[o,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fr(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof en||o instanceof Mr||o instanceof gr||o instanceof Qo)return!0;if(Array.isArray(o)){for(const e of o)if(!Fr(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!Fr(o[e]))return!1;return!0}return!1}function Zr(o){if(o===null)return Ua;if(typeof o=="string")return Xn;if(typeof o=="boolean")return qn;if(typeof o=="number")return Ht;if(o instanceof en)return wi;if(o instanceof Mr)return H;if(o instanceof gr)return ce;if(o instanceof Qo)return Se;if(Array.isArray(o)){const e=o.length;let s;for(const c of o){const f=Zr(c);if(s){if(s===f)continue;s=B;break}s=f}return ze(s||B,e)}return Yo}function es(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof en||o instanceof gr||o instanceof Qo?o.toString():JSON.stringify(o)}class Rs{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Fr(e[1]))return s.error("invalid value");const c=e[1];let f=Zr(c);const g=s.expectedType;return f.kind!=="array"||f.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(f=g),new Rs(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof en?["rgba"].concat(this.value.toArray()):this.value instanceof gr?this.value.serialize():this.value}}var Na=Rs,Xr=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const ws={string:Xn,number:Ht,boolean:qn,object:Yo};class Ga{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let c,f=1;const g=e[0];if(g==="array"){let C,M;if(e.length>2){const P=e[1];if(typeof P!="string"||!(P in ws)||P==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);C=ws[P],f++}else C=B;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);M=e[2],f++}c=ze(C,M)}else c=ws[g];const x=[];for(;f<e.length;f++){const C=s.parse(e[f],f,B);if(!C)return null;x.push(C)}return new Ga(c,x)}evaluate(e){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(e);if(!It(this.type,Zr(c)))return c;if(s===this.args.length-1)throw new Xr(`Expected value to be of type ${De(this.type)}, but found ${De(Zr(c))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if(e.kind==="array"){const c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const f=e.N;(typeof f=="number"||this.args.length>1)&&s.push(f)}}return s.concat(this.args.map(c=>c.serialize()))}}var Es=Ga;class Zs{constructor(e){this.type=ce,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const f=[];let g=!1;for(let x=1;x<=e.length-1;++x){const C=e[x];if(g&&typeof C=="object"&&!Array.isArray(C)){g=!1;let M=null;if(C["font-scale"]&&(M=s.parse(C["font-scale"],1,Ht),!M))return null;let P=null;if(C["text-font"]&&(P=s.parse(C["text-font"],1,ze(Xn)),!P))return null;let j=null;if(C["text-color"]&&(j=s.parse(C["text-color"],1,wi),!j))return null;const $=f[f.length-1];$.scale=M,$.font=P,$.textColor=j}else{const M=s.parse(e[x],1,B);if(!M)return null;const P=M.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:M,scale:null,font:null,textColor:null})}}return new Zs(f)}evaluate(e){return new gr(this.sections.map(s=>{const c=s.content.evaluate(e);return Zr(c)===Se?new dr("",c,null,null,null):new dr(es(c),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),e.push(c)}return e}}class Vc{constructor(e){this.type=Se,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const c=s.parse(e[1],1,Xn);return c?new Vc(c):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),c=Qo.fromString(s);return c&&e.availableImages&&(c.available=e.availableImages.indexOf(s)>-1),c}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Xs={"to-boolean":qn,"to-color":wi,"to-number":Ht,"to-string":Xn};class Du{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const c=e[0];if((c==="to-boolean"||c==="to-string")&&e.length!==2)return s.error("Expected one argument.");const f=Xs[c],g=[];for(let x=1;x<e.length;x++){const C=s.parse(e[x],x,B);if(!C)return null;g.push(C)}return new Du(f,g)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let s,c;for(const f of this.args){if(s=f.evaluate(e),c=null,s instanceof en)return s;if(typeof s=="string"){const g=e.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Gc(s[0],s[1],s[2],s[3]),!c))return new en(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Xr(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(e),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new Xr(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?gr.fromString(es(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Qo.fromString(es(this.args[0].evaluate(e))):es(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Zs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}var qs=Du;const Ds=["Unknown","Point","LineString","Polygon"];var ts=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ds[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*e-o[0])+this.featureDistanceData.bearing[1]*(c*e-o[1])}return 0}parseColor(o){let e=this._parseColorCache[o];return e||(e=this._parseColorCache[o]=en.parse(o)),e}};class Ks{constructor(e,s,c,f){this.name=e,this.type=s,this._evaluate=c,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const c=e[0],f=Ks.definitions[c];if(!f)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,C=x.filter(([P])=>!Array.isArray(P)||P.length===e.length-1);let M=null;for(const[P,j]of C){M=new Ha(s.registry,s.path,null,s.scope);const $=[];let W=!1;for(let Y=1;Y<e.length;Y++){const ee=e[Y],oe=Array.isArray(P)?P[Y-1]:P.type,de=M.parse(ee,1+$.length,oe);if(!de){W=!0;break}$.push(de)}if(!W)if(Array.isArray(P)&&P.length!==$.length)M.error(`Expected ${P.length} arguments, but found ${$.length} instead.`);else{for(let Y=0;Y<$.length;Y++){const ee=Array.isArray(P)?P[Y]:P.type,oe=$[Y];M.concat(Y+1).checkSubtype(ee,oe.type)}if(M.errors.length===0)return new Ks(c,g,j,$)}}if(C.length===1)s.errors.push(...M.errors);else{const P=(C.length?C:x).map(([$])=>{return W=$,Array.isArray(W)?`(${W.map(De).join(", ")})`:`(${De(W.type)}...)`;var W}).join(" | "),j=[];for(let $=1;$<e.length;$++){const W=s.parse(e[$],1+j.length);if(!W)return null;j.push(De(W.type))}s.error(`Expected arguments of type ${P}, but found (${j.join(", ")}) instead.`)}return null}static register(e,s){Ks.definitions=s;for(const c in s)e[c]=Ks}}var Cs=Ks;class ds{constructor(e,s,c){this.type=H,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const f=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,qn);if(!f)return null;const g=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,qn);if(!g)return null;let x=null;return c.locale&&(x=s.parse(c.locale,1,Xn),!x)?null:new ds(f,g,x)}evaluate(e){return new Mr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const fs=8192;function xl(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function Co(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function Va(o,e){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(s*f*fs),Math.round(c*f*fs)]}function vc(o,e,s){const c=o[0]-e[0],f=o[1]-e[1],g=o[0]-s[0],x=o[1]-s[1];return c*x-g*f==0&&c*g<=0&&f*x<=0}function _a(o,e){let s=!1;for(let x=0,C=e.length;x<C;x++){const M=e[x];for(let P=0,j=M.length;P<j-1;P++){if(vc(o,M[P],M[P+1]))return!1;(f=M[P])[1]>(c=o)[1]!=(g=M[P+1])[1]>c[1]&&c[0]<(g[0]-f[0])*(c[1]-f[1])/(g[1]-f[1])+f[0]&&(s=!s)}}var c,f,g;return s}function Fo(o,e){for(let s=0;s<e.length;s++)if(_a(o,e[s]))return!0;return!1}function jo(o,e,s,c){const f=c[0]-s[0],g=c[1]-s[1],x=(o[0]-s[0])*g-f*(o[1]-s[1]),C=(e[0]-s[0])*g-f*(e[1]-s[1]);return x>0&&C<0||x<0&&C>0}function ns(o,e,s){for(const P of s)for(let j=0;j<P.length-1;++j)if((C=[(x=P[j+1])[0]-(g=P[j])[0],x[1]-g[1]])[0]*(M=[(f=e)[0]-(c=o)[0],f[1]-c[1]])[1]-C[1]*M[0]!=0&&jo(c,f,g,x)&&jo(g,x,c,f))return!0;var c,f,g,x,C,M;return!1}function fr(o,e){for(let s=0;s<o.length;++s)if(!_a(o[s],e))return!1;for(let s=0;s<o.length-1;++s)if(ns(o[s],o[s+1],e))return!1;return!0}function mh(o,e){for(let s=0;s<e.length;s++)if(fr(o,e[s]))return!0;return!1}function io(o,e,s){const c=[];for(let f=0;f<o.length;f++){const g=[];for(let x=0;x<o[f].length;x++){const C=Va(o[f][x],s);xl(e,C),g.push(C)}c.push(g)}return c}function Js(o,e,s){const c=[];for(let f=0;f<o.length;f++){const g=io(o[f],e,s);c.push(g)}return c}function Vl(o,e,s,c){if(o[0]<s[0]||o[0]>s[2]){const f=.5*c;let g=o[0]-s[0]>f?-c:s[0]-o[0]>f?c:0;g===0&&(g=o[0]-s[2]>f?-c:s[2]-o[0]>f?c:0),o[0]+=g}xl(e,o)}function Ou(o,e,s,c){const f=Math.pow(2,c.z)*fs,g=[c.x*fs,c.y*fs],x=[];if(!o)return x;for(const C of o)for(const M of C){const P=[M.x+g[0],M.y+g[1]];Vl(P,e,s,f),x.push(P)}return x}function $a(o,e,s,c){const f=Math.pow(2,c.z)*fs,g=[c.x*fs,c.y*fs],x=[];if(!o)return x;for(const M of o){const P=[];for(const j of M){const $=[j.x+g[0],j.y+g[1]];xl(e,$),P.push($)}x.push(P)}if(e[2]-e[0]<=f/2){(C=e)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const M of x)for(const P of M)Vl(P,e,s,f)}var C;return x}class Os{constructor(e,s){this.type=qn,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Fr(e[1])){const c=e[1];if(c.type==="FeatureCollection")for(let f=0;f<c.features.length;++f){const g=c.features[f].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Os(c,c.features[f].geometry)}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Os(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Os(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(!x)return!1;if(c.type==="Polygon"){const C=io(c.coordinates,g,x),M=Ou(s.geometry(),f,g,x);if(!Co(f,g))return!1;for(const P of M)if(!_a(P,C))return!1}if(c.type==="MultiPolygon"){const C=Js(c.coordinates,g,x),M=Ou(s.geometry(),f,g,x);if(!Co(f,g))return!1;for(const P of M)if(!Fo(P,C))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(!x)return!1;if(c.type==="Polygon"){const C=io(c.coordinates,g,x),M=$a(s.geometry(),f,g,x);if(!Co(f,g))return!1;for(const P of M)if(!fr(P,C))return!1}if(c.type==="MultiPolygon"){const C=Js(c.coordinates,g,x),M=$a(s.geometry(),f,g,x);if(!Co(f,g))return!1;for(const P of M)if(!mh(P,C))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var bl=Os;function Ys(o){if(o instanceof Cs&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof bl)return!1;let e=!0;return o.eachChild(s=>{e&&!Ys(s)&&(e=!1)}),e}function rs(o){if(o instanceof Cs&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(s=>{e&&!rs(s)&&(e=!1)}),e}function As(o,e){if(o instanceof Cs&&e.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!As(c,e)&&(s=!1)}),s}class xc{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=e[1];return s.scope.has(c)?new xc(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ku=xc;class wl{constructor(e,s=[],c,f=new vl,g=[]){this.registry=e,this.path=s,this.key=s.map(x=>`[${x}]`).join(""),this.scope=f,this.errors=g,this.expectedType=c}parse(e,s,c,f,g={}){return s?this.concat(s,c,f)._parse(e,g):this._parse(e,g)}_parse(e,s){function c(f,g,x){return x==="assert"?new Es(g,[f]):x==="coerce"?new qs(g,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[f];if(g){let x=g.parse(e,this);if(!x)return null;if(this.expectedType){const C=this.expectedType,M=x.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||M.kind!=="value")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(C,M))return null}else x=c(x,C,s.typeAnnotation||"coerce");else x=c(x,C,s.typeAnnotation||"assert")}if(!(x instanceof Na)&&x.type.kind!=="resolvedImage"&&Wa(x)){const C=new ts;try{x=new Na(x.type,x.evaluate(C))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,c){const f=typeof e=="number"?this.path.concat(e):this.path,g=c?this.scope.concat(c):this.scope;return new wl(this.registry,f,s||null,g,this.errors)}error(e,...s){const c=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new zo(c,e))}checkSubtype(e,s){const c=It(e,s);return c&&this.error(c),c}}var Ha=wl;function Wa(o){if(o instanceof ku)return Wa(o.boundExpression);if(o instanceof Cs&&o.name==="error"||o instanceof ds||o instanceof bl)return!1;const e=o instanceof qs||o instanceof Es;let s=!0;return o.eachChild(c=>{s=e?s&&Wa(c):s&&c instanceof Na}),!!s&&Ys(o)&&As(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Za(o,e){const s=o.length-1;let c,f,g=0,x=s,C=0;for(;g<=x;)if(C=Math.floor((g+x)/2),c=o[C],f=o[C+1],c<=e){if(C===s||e<f)return C;g=C+1}else{if(!(c>e))throw new Xr("Input is not a number.");x=C-1}return 0}class ya{constructor(e,s,c){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[f,g]of c)this.labels.push(f),this.outputs.push(g)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(e[1],1,Ht);if(!c)return null;const f=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let x=1;x<e.length;x+=2){const C=x===1?-1/0:e[x],M=e[x+1],P=x,j=x+1;if(typeof C!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(f.length&&f[f.length-1][0]>=C)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const $=s.parse(M,j,g);if(!$)return null;g=g||$.type,f.push([C,$])}return new ya(g,c,f)}evaluate(e){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(e);const f=this.input.evaluate(e);if(f<=s[0])return c[0].evaluate(e);const g=s.length;return f>=s[g-1]?c[g-1].evaluate(e):c[Za(s,f)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}var Fi=ya;function Pn(o,e,s){return o*(1-s)+e*s}var oo=Object.freeze({__proto__:null,array:function(o,e,s){return o.map((c,f)=>Pn(c,e[f],s))},color:function(o,e,s){return new en(Pn(o.r,e.r,s),Pn(o.g,e.g,s),Pn(o.b,e.b,s),Pn(o.a,e.a,s))},number:Pn});const ps=.95047,Yi=1.08883,Xa=4/29,ks=6/29,va=3*ks*ks,$c=ks*ks*ks,is=Math.PI/180,ms=180/Math.PI;function Qr(o){return o>$c?Math.pow(o,1/3):o/va+Xa}function qa(o){return o>ks?o*o*o:va*(o-Xa)}function os(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Ka(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Ja(o){const e=Ka(o.r),s=Ka(o.g),c=Ka(o.b),f=Qr((.4124564*e+.3575761*s+.1804375*c)/ps),g=Qr((.2126729*e+.7151522*s+.072175*c)/1);return{l:116*g-16,a:500*(f-g),b:200*(g-Qr((.0193339*e+.119192*s+.9503041*c)/Yi)),alpha:o.a}}function Hc(o){let e=(o.l+16)/116,s=isNaN(o.a)?e:e+o.a/500,c=isNaN(o.b)?e:e-o.b/200;return e=1*qa(e),s=ps*qa(s),c=Yi*qa(c),new en(os(3.2404542*s-1.5371385*e-.4985314*c),os(-.969266*s+1.8760108*e+.041556*c),os(.0556434*s-.2040259*e+1.0572252*c),o.alpha)}function Qs(o,e,s){const c=e-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const $l={forward:Ja,reverse:Hc,interpolate:function(o,e,s){return{l:Pn(o.l,e.l,s),a:Pn(o.a,e.a,s),b:Pn(o.b,e.b,s),alpha:Pn(o.alpha,e.alpha,s)}}},Ao={forward:function(o){const{l:e,a:s,b:c}=Ja(o),f=Math.atan2(c,s)*ms;return{h:f<0?f+360:f,c:Math.sqrt(s*s+c*c),l:e,alpha:o.a}},reverse:function(o){const e=o.h*is,s=o.c;return Hc({l:o.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:o.alpha})},interpolate:function(o,e,s){return{h:Qs(o.h,e.h,s),c:Pn(o.c,e.c,s),l:Pn(o.l,e.l,s),alpha:Pn(o.alpha,e.alpha,s)}}};var xa=Object.freeze({__proto__:null,hcl:Ao,lab:$l});class El{constructor(e,s,c,f,g){this.type=e,this.operator=s,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[x,C]of g)this.labels.push(x),this.outputs.push(C)}static interpolationFactor(e,s,c,f){let g=0;if(e.name==="exponential")g=ea(s,e.base,c,f);else if(e.name==="linear")g=ea(s,1,c,f);else if(e.name==="cubic-bezier"){const x=e.controlPoints;g=new be(x[0],x[1],x[2],x[3]).solve(ea(s,1,c,f))}return g}static parse(e,s){let[c,f,g,...x]=e;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const P=f[1];if(typeof P!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:P}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const P=f.slice(1);if(P.length!==4||P.some(j=>typeof j!="number"||j<0||j>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,Ht),!g)return null;const C=[];let M=null;c==="interpolate-hcl"||c==="interpolate-lab"?M=wi:s.expectedType&&s.expectedType.kind!=="value"&&(M=s.expectedType);for(let P=0;P<x.length;P+=2){const j=x[P],$=x[P+1],W=P+3,Y=P+4;if(typeof j!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(C.length&&C[C.length-1][0]>=j)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);const ee=s.parse($,Y,M);if(!ee)return null;M=M||ee.type,C.push([j,ee])}return M.kind==="number"||M.kind==="color"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new El(M,c,f,g,C):s.error(`Type ${De(M)} is not interpolatable.`)}evaluate(e){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(e);const f=this.input.evaluate(e);if(f<=s[0])return c[0].evaluate(e);const g=s.length;if(f>=s[g-1])return c[g-1].evaluate(e);const x=Za(s,f),C=El.interpolationFactor(this.interpolation,f,s[x],s[x+1]),M=c[x].evaluate(e),P=c[x+1].evaluate(e);return this.operator==="interpolate"?oo[this.type.kind.toLowerCase()](M,P,C):this.operator==="interpolate-hcl"?Ao.reverse(Ao.interpolate(Ao.forward(M),Ao.forward(P),C)):$l.reverse($l.interpolate($l.forward(M),$l.forward(P),C))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function ea(o,e,s,c){const f=c-s,g=o-s;return f===0?0:e===1?g/f:(Math.pow(e,g)-1)/(Math.pow(e,f)-1)}var Uo=El;class Hl{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let c=null;const f=s.expectedType;f&&f.kind!=="value"&&(c=f);const g=[];for(const C of e.slice(1)){const M=s.parse(C,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,g.push(M)}const x=f&&g.some(C=>It(f,C.type));return new Hl(x?B:c,g)}evaluate(e){let s,c=null,f=0;for(const g of this.args){if(f++,c=g.evaluate(e),c&&c instanceof Qo&&!c.available&&(s||(s=c),c=null,f===this.args.length))return s;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}var bc=Hl;class ta{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let g=1;g<e.length-1;g+=2){const x=e[g];if(typeof x!="string")return s.error(`Expected string, but found ${typeof x} instead.`,g);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const C=s.parse(e[g+1],g+1);if(!C)return null;c.push([x,C])}const f=s.parse(e[e.length-1],e.length-1,s.expectedType,c);return f?new ta(c,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,c]of this.bindings)e.push(s,c.serialize());return e.push(this.result.serialize()),e}}var Cl=ta;class Ya{constructor(e,s,c){this.type=e,this.index=s,this.input=c}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Ht),f=s.parse(e[2],2,ze(s.expectedType||B));return c&&f?new Ya(f.type.itemType,c,f):null}evaluate(e){const s=this.index.evaluate(e),c=this.input.evaluate(e);if(s<0)throw new Xr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Xr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Xr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ts=Ya;class We{constructor(e,s){this.type=qn,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,B),f=s.parse(e[2],2,B);return c&&f?Ft(c.type,[qn,Xn,Ht,Ua,B])?new We(c,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${De(c.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!Jt(s,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${De(Zr(s))} instead.`);if(!Jt(c,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${De(Zr(c))} instead.`);return c.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var dt=We;class Ut{constructor(e,s,c){this.type=Ht,this.needle=e,this.haystack=s,this.fromIndex=c}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,B),f=s.parse(e[2],2,B);if(!c||!f)return null;if(!Ft(c.type,[qn,Xn,Ht,Ua,B]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${De(c.type)} instead`);if(e.length===4){const g=s.parse(e[3],3,Ht);return g?new Ut(c,f,g):null}return new Ut(c,f)}evaluate(e){const s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!Jt(s,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${De(Zr(s))} instead.`);if(!Jt(c,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${De(Zr(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(e);return c.indexOf(s,f)}return c.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Cn=Ut;class Er{constructor(e,s,c,f,g,x){this.inputType=e,this.type=s,this.input=c,this.cases=f,this.outputs=g,this.otherwise=x}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let c,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const g={},x=[];for(let P=2;P<e.length-1;P+=2){let j=e[P];const $=e[P+1];Array.isArray(j)||(j=[j]);const W=s.concat(P);if(j.length===0)return W.error("Expected at least one branch label.");for(const ee of j){if(typeof ee!="number"&&typeof ee!="string")return W.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return W.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ee=="number"&&Math.floor(ee)!==ee)return W.error("Numeric branch labels must be integer values.");if(c){if(W.checkSubtype(c,Zr(ee)))return null}else c=Zr(ee);if(g[String(ee)]!==void 0)return W.error("Branch labels must be unique.");g[String(ee)]=x.length}const Y=s.parse($,P,f);if(!Y)return null;f=f||Y.type,x.push(Y)}const C=s.parse(e[1],1,B);if(!C)return null;const M=s.parse(e[e.length-1],e.length-1,f);return M?C.type.kind!=="value"&&s.concat(1).checkSubtype(c,C.type)?null:new Er(c,f,C,g,x,M):null}evaluate(e){const s=this.input.evaluate(e);return(Zr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],f={};for(const x of s){const C=f[this.cases[x]];C===void 0?(f[this.cases[x]]=c.length,c.push([this.cases[x],[x]])):c[C][1].push(x)}const g=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,C]of c)e.push(C.length===1?g(C[0]):C.map(g)),e.push(this.outputs[x].serialize());return e.push(this.otherwise.serialize()),e}}var pr=Er;class ei{constructor(e,s,c){this.type=e,this.branches=s,this.otherwise=c}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const f=[];for(let x=1;x<e.length-1;x+=2){const C=s.parse(e[x],x,qn);if(!C)return null;const M=s.parse(e[x+1],x+1,c);if(!M)return null;f.push([C,M]),c=c||M.type}const g=s.parse(e[e.length-1],e.length-1,c);return g?new ei(c,f,g):null}evaluate(e){for(const[s,c]of this.branches)if(s.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,c]of this.branches)e(s),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}var Qn=ei;class Qi{constructor(e,s,c,f){this.type=e,this.input=s,this.beginIndex=c,this.endIndex=f}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,B),f=s.parse(e[2],2,Ht);if(!c||!f)return null;if(!Ft(c.type,[ze(B),Xn,B]))return s.error(`Expected first argument to be of type array or string, but found ${De(c.type)} instead`);if(e.length===4){const g=s.parse(e[3],3,Ht);return g?new Qi(c.type,c,f,g):null}return new Qi(c.type,c,f)}evaluate(e){const s=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!Jt(s,["string","array"]))throw new Xr(`Expected first argument to be of type array or string, but found ${De(Zr(s))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(e);return s.slice(c,f)}return s.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Mi=Qi;function vi(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ss(o,e,s,c){return c.compare(e,s)===0}function di(o,e,s){const c=o!=="=="&&o!=="!=";return class eP{constructor(g,x,C){this.type=qn,this.lhs=g,this.rhs=x,this.collator=C,this.hasUntypedArgument=g.type.kind==="value"||x.type.kind==="value"}static parse(g,x){if(g.length!==3&&g.length!==4)return x.error("Expected two or three arguments.");const C=g[0];let M=x.parse(g[1],1,B);if(!M)return null;if(!vi(C,M.type))return x.concat(1).error(`"${C}" comparisons are not supported for type '${De(M.type)}'.`);let P=x.parse(g[2],2,B);if(!P)return null;if(!vi(C,P.type))return x.concat(2).error(`"${C}" comparisons are not supported for type '${De(P.type)}'.`);if(M.type.kind!==P.type.kind&&M.type.kind!=="value"&&P.type.kind!=="value")return x.error(`Cannot compare types '${De(M.type)}' and '${De(P.type)}'.`);c&&(M.type.kind==="value"&&P.type.kind!=="value"?M=new Es(P.type,[M]):M.type.kind!=="value"&&P.type.kind==="value"&&(P=new Es(M.type,[P])));let j=null;if(g.length===4){if(M.type.kind!=="string"&&P.type.kind!=="string"&&M.type.kind!=="value"&&P.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(j=x.parse(g[3],3,H),!j)return null}return new eP(M,P,j)}evaluate(g){const x=this.lhs.evaluate(g),C=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const M=Zr(x),P=Zr(C);if(M.kind!==P.kind||M.kind!=="string"&&M.kind!=="number")throw new Xr(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${M.kind}, ${P.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const M=Zr(x),P=Zr(C);if(M.kind!=="string"||P.kind!=="string")return e(g,x,C)}return this.collator?s(g,x,C,this.collator.evaluate(g)):e(g,x,C)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[o];return this.eachChild(x=>{g.push(x.serialize())}),g}}}const ji=di("==",function(o,e,s){return e===s},ss),Rr=di("!=",function(o,e,s){return e!==s},function(o,e,s,c){return!ss(0,e,s,c)}),Ri=di("<",function(o,e,s){return e<s},function(o,e,s,c){return c.compare(e,s)<0}),Di=di(">",function(o,e,s){return e>s},function(o,e,s,c){return c.compare(e,s)>0}),ba=di("<=",function(o,e,s){return e<=s},function(o,e,s,c){return c.compare(e,s)<=0}),na=di(">=",function(o,e,s){return e>=s},function(o,e,s,c){return c.compare(e,s)>=0});class wa{constructor(e,s,c,f,g,x){this.type=Xn,this.number=e,this.locale=s,this.currency=c,this.unit=f,this.minFractionDigits=g,this.maxFractionDigits=x}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const c=s.parse(e[1],1,Ht);if(!c)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=s.parse(f.locale,1,Xn),!g))return null;let x=null;if(f.currency&&(x=s.parse(f.currency,1,Xn),!x))return null;let C=null;if(f.unit&&(C=s.parse(f.unit,1,Xn),!C))return null;let M=null;if(f["min-fraction-digits"]&&(M=s.parse(f["min-fraction-digits"],1,Ht),!M))return null;let P=null;return f["max-fraction-digits"]&&(P=s.parse(f["max-fraction-digits"],1,Ht),!P)?null:new wa(c,g,x,C,M,P)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Wl{constructor(e){this.type=Ht,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=s.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${De(c.type)} instead.`):new Wl(c):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Xr(`Expected value to be of type string or array, but found ${De(Zr(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}const so={"==":ji,"!=":Rr,">":Di,"<":Ri,">=":na,"<=":ba,array:Es,at:Ts,boolean:Es,case:Qn,coalesce:bc,collator:ds,format:Zs,image:Vc,in:dt,"index-of":Cn,interpolate:Uo,"interpolate-hcl":Uo,"interpolate-lab":Uo,length:Wl,let:Cl,literal:Na,match:pr,number:Es,"number-format":wa,object:Es,slice:Mi,step:Fi,string:Es,"to-boolean":qs,"to-color":qs,"to-number":qs,"to-string":qs,var:ku,within:bl};function Dr(o,[e,s,c,f]){e=e.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const g=f?f.evaluate(o):1,x=Gc(e,s,c,g);if(x)throw new Xr(x);return new en(e/255*g,s/255*g,c/255*g,g)}function cr(o,e){return o in e}function Ea(o,e){const s=e[o];return s===void 0?null:s}function qr(o){return{type:o}}Cs.register(so,{error:[{kind:"error"},[Xn],(o,[e])=>{throw new Xr(e.evaluate(o))}],typeof:[Xn,[B],(o,[e])=>De(Zr(e.evaluate(o)))],"to-rgba":[ze(Ht,4),[wi],(o,[e])=>e.evaluate(o).toArray()],rgb:[wi,[Ht,Ht,Ht],Dr],rgba:[wi,[Ht,Ht,Ht,Ht],Dr],has:{type:qn,overloads:[[[Xn],(o,[e])=>cr(e.evaluate(o),o.properties())],[[Xn,Yo],(o,[e,s])=>cr(e.evaluate(o),s.evaluate(o))]]},get:{type:B,overloads:[[[Xn],(o,[e])=>Ea(e.evaluate(o),o.properties())],[[Xn,Yo],(o,[e,s])=>Ea(e.evaluate(o),s.evaluate(o))]]},"feature-state":[B,[Xn],(o,[e])=>Ea(e.evaluate(o),o.featureState||{})],properties:[Yo,[],o=>o.properties()],"geometry-type":[Xn,[],o=>o.geometryType()],id:[B,[],o=>o.id()],zoom:[Ht,[],o=>o.globals.zoom],pitch:[Ht,[],o=>o.globals.pitch||0],"distance-from-center":[Ht,[],o=>o.distanceFromCenter()],"heatmap-density":[Ht,[],o=>o.globals.heatmapDensity||0],"line-progress":[Ht,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[Ht,[],o=>o.globals.skyRadialProgress||0],accumulated:[B,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Ht,qr(Ht),(o,e)=>{let s=0;for(const c of e)s+=c.evaluate(o);return s}],"*":[Ht,qr(Ht),(o,e)=>{let s=1;for(const c of e)s*=c.evaluate(o);return s}],"-":{type:Ht,overloads:[[[Ht,Ht],(o,[e,s])=>e.evaluate(o)-s.evaluate(o)],[[Ht],(o,[e])=>-e.evaluate(o)]]},"/":[Ht,[Ht,Ht],(o,[e,s])=>e.evaluate(o)/s.evaluate(o)],"%":[Ht,[Ht,Ht],(o,[e,s])=>e.evaluate(o)%s.evaluate(o)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(o,[e,s])=>Math.pow(e.evaluate(o),s.evaluate(o))],sqrt:[Ht,[Ht],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))],log2:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[Ht,[Ht],(o,[e])=>Math.sin(e.evaluate(o))],cos:[Ht,[Ht],(o,[e])=>Math.cos(e.evaluate(o))],tan:[Ht,[Ht],(o,[e])=>Math.tan(e.evaluate(o))],asin:[Ht,[Ht],(o,[e])=>Math.asin(e.evaluate(o))],acos:[Ht,[Ht],(o,[e])=>Math.acos(e.evaluate(o))],atan:[Ht,[Ht],(o,[e])=>Math.atan(e.evaluate(o))],min:[Ht,qr(Ht),(o,e)=>Math.min(...e.map(s=>s.evaluate(o)))],max:[Ht,qr(Ht),(o,e)=>Math.max(...e.map(s=>s.evaluate(o)))],abs:[Ht,[Ht],(o,[e])=>Math.abs(e.evaluate(o))],round:[Ht,[Ht],(o,[e])=>{const s=e.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ht,[Ht],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[Ht,[Ht],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[qn,[Xn,B],(o,[e,s])=>o.properties()[e.value]===s.value],"filter-id-==":[qn,[B],(o,[e])=>o.id()===e.value],"filter-type-==":[qn,[Xn],(o,[e])=>o.geometryType()===e.value],"filter-<":[qn,[Xn,B],(o,[e,s])=>{const c=o.properties()[e.value],f=s.value;return typeof c==typeof f&&c<f}],"filter-id-<":[qn,[B],(o,[e])=>{const s=o.id(),c=e.value;return typeof s==typeof c&&s<c}],"filter->":[qn,[Xn,B],(o,[e,s])=>{const c=o.properties()[e.value],f=s.value;return typeof c==typeof f&&c>f}],"filter-id->":[qn,[B],(o,[e])=>{const s=o.id(),c=e.value;return typeof s==typeof c&&s>c}],"filter-<=":[qn,[Xn,B],(o,[e,s])=>{const c=o.properties()[e.value],f=s.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[qn,[B],(o,[e])=>{const s=o.id(),c=e.value;return typeof s==typeof c&&s<=c}],"filter->=":[qn,[Xn,B],(o,[e,s])=>{const c=o.properties()[e.value],f=s.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[qn,[B],(o,[e])=>{const s=o.id(),c=e.value;return typeof s==typeof c&&s>=c}],"filter-has":[qn,[B],(o,[e])=>e.value in o.properties()],"filter-has-id":[qn,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[qn,[ze(Xn)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[qn,[ze(B)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[qn,[Xn,ze(B)],(o,[e,s])=>s.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[qn,[Xn,ze(B)],(o,[e,s])=>function(c,f,g,x){for(;g<=x;){const C=g+x>>1;if(f[C]===c)return!0;f[C]>c?x=C-1:g=C+1}return!1}(o.properties()[e.value],s.value,0,s.value.length-1)],all:{type:qn,overloads:[[[qn,qn],(o,[e,s])=>e.evaluate(o)&&s.evaluate(o)],[qr(qn),(o,e)=>{for(const s of e)if(!s.evaluate(o))return!1;return!0}]]},any:{type:qn,overloads:[[[qn,qn],(o,[e,s])=>e.evaluate(o)||s.evaluate(o)],[qr(qn),(o,e)=>{for(const s of e)if(s.evaluate(o))return!0;return!1}]]},"!":[qn,[qn],(o,[e])=>!e.evaluate(o)],"is-supported-script":[qn,[Xn],(o,[e])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(e.evaluate(o))}],upcase:[Xn,[Xn],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[Xn,[Xn],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[Xn,qr(B),(o,e)=>e.map(s=>es(s.evaluate(o))).join("")],"resolved-locale":[Xn,[H],(o,[e])=>e.evaluate(o).resolvedLocale()]});var To=so;function Xi(o){return{result:"success",value:o}}function eo(o){return{result:"error",value:o}}function So(o){return o["property-type"]==="data-driven"}function Ca(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Qa(o){return!!o.expression&&o.expression.interpolated}function nr(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Ss(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Wc(o){return o}function el(o,e){const s=e.type==="color",c=o.stops&&typeof o.stops[0][0]=="object",f=c||!(c||o.property!==void 0),g=o.type||(Qa(e)?"exponential":"interval");if(s&&((o=Si({},o)).stops&&(o.stops=o.stops.map(P=>[P[0],en.parse(P[1])])),o.default=en.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!xa[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let x,C,M;if(g==="exponential")x=gs;else if(g==="interval")x=tl;else if(g==="categorical"){x=Aa,C=Object.create(null);for(const P of o.stops)C[P[0]]=P[1];M=typeof o.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);x=nl}if(c){const P={},j=[];for(let Y=0;Y<o.stops.length;Y++){const ee=o.stops[Y],oe=ee[0].zoom;P[oe]===void 0&&(P[oe]={zoom:oe,type:o.type,property:o.property,default:o.default,stops:[]},j.push(oe)),P[oe].stops.push([ee[0].value,ee[1]])}const $=[];for(const Y of j)$.push([P[Y].zoom,el(P[Y],e)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:Uo.interpolationFactor.bind(void 0,W),zoomStops:$.map(Y=>Y[0]),evaluate:({zoom:Y},ee)=>gs({stops:$,base:o.base},e,Y).evaluate(Y,ee)}}if(f){const P=g==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Uo.interpolationFactor.bind(void 0,P),zoomStops:o.stops.map(j=>j[0]),evaluate:({zoom:j})=>x(o,e,j,C,M)}}return{kind:"source",evaluate(P,j){const $=j&&j.properties?j.properties[o.property]:void 0;return $===void 0?ra(o.default,e.default):x(o,e,$,C,M)}}}function ra(o,e,s){return o!==void 0?o:e!==void 0?e:s!==void 0?s:void 0}function Aa(o,e,s,c,f){return ra(typeof s===f?c[s]:void 0,o.default,e.default)}function tl(o,e,s){if(nr(s)!=="number")return ra(o.default,e.default);const c=o.stops.length;if(c===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const f=Za(o.stops.map(g=>g[0]),s);return o.stops[f][1]}function gs(o,e,s){const c=o.base!==void 0?o.base:1;if(nr(s)!=="number")return ra(o.default,e.default);const f=o.stops.length;if(f===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[f-1][0])return o.stops[f-1][1];const g=Za(o.stops.map(j=>j[0]),s),x=function(j,$,W,Y){const ee=Y-W,oe=j-W;return ee===0?0:$===1?oe/ee:(Math.pow($,oe)-1)/(Math.pow($,ee)-1)}(s,c,o.stops[g][0],o.stops[g+1][0]),C=o.stops[g][1],M=o.stops[g+1][1];let P=oo[e.type]||Wc;if(o.colorSpace&&o.colorSpace!=="rgb"){const j=xa[o.colorSpace];P=($,W)=>j.reverse(j.interpolate(j.forward($),j.forward(W),x))}return typeof C.evaluate=="function"?{evaluate(...j){const $=C.evaluate.apply(void 0,j),W=M.evaluate.apply(void 0,j);if($!==void 0&&W!==void 0)return P($,W,x)}}:P(C,M,x)}function nl(o,e,s){return e.type==="color"?s=en.parse(s):e.type==="formatted"?s=gr.fromString(s.toString()):e.type==="resolvedImage"?s=Qo.fromString(s.toString()):nr(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0),ra(s,o.default,e.default)}class Ta{constructor(e,s){this.expression=e,this._warningHistory={},this._evaluator=new ts,this._defaultValue=s?function(c){return c.type==="color"&&(Ss(c.default)||Array.isArray(c.default))?new en(0,0,0,0):c.type==="color"?en.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,c,f,g,x,C,M){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,c,f,g,x,C,M){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=M||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Xr(`Expected value to be one of ${Object.keys(this._enumValues).map(j=>JSON.stringify(j)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function rl(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in To}function wc(o,e){const s=new Ha(To,[],e?function(f){const g={color:wi,string:Xn,number:Ht,enum:Xn,boolean:qn,formatted:ce,resolvedImage:Se};return f.type==="array"?ze(g[f.value]||B,f.length):g[f.type]}(e):void 0),c=s.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Xi(new Ta(c,e)):eo(s.errors)}class gh{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!rs(s.expression)}evaluateWithoutErrorHandling(e,s,c,f,g,x){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,f,g,x)}evaluate(e,s,c,f,g,x){return this._styleExpression.evaluate(e,s,c,f,g,x)}}class Zc{constructor(e,s,c,f){this.kind=e,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!rs(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,s,c,f,g,x){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,f,g,x)}evaluate(e,s,c,f,g,x){return this._styleExpression.evaluate(e,s,c,f,g,x)}interpolationFactor(e,s,c){return this.interpolationType?Uo.interpolationFactor(this.interpolationType,e,s,c):0}}function Xc(o,e){if((o=wc(o,e)).result==="error")return o;const s=o.value.expression,c=Ys(s);if(!c&&!So(e))return eo([new zo("","data expressions not supported")]);const f=As(s,["zoom","pitch","distance-from-center"]);if(!f&&!Ca(e))return eo([new zo("","zoom expressions not supported")]);const g=zu(s);return g||f?g instanceof zo?eo([g]):g instanceof Uo&&!Qa(e)?eo([new zo("",'"interpolate" expressions cannot be used with this property')]):Xi(g?new Zc(c?"camera":"composite",o.value,g.labels,g instanceof Uo?g.interpolation:void 0):new gh(c?"constant":"source",o.value)):eo([new zo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class qc{constructor(e,s){this._parameters=e,this._specification=s,Si(this,el(this._parameters,this._specification))}static deserialize(e){return new qc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zu(o){let e=null;if(o instanceof Cl)e=zu(o.result);else if(o instanceof bc){for(const s of o.args)if(e=zu(s),e)break}else(o instanceof Fi||o instanceof Uo)&&o.input instanceof Cs&&o.input.name==="zoom"&&(e=o);return e instanceof zo||o.eachChild(s=>{const c=zu(s);c instanceof zo?e=c:!e&&c?e=new zo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&c&&e!==c&&(e=new zo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class nn{constructor(e,s,c,f){this.message=(e?`${e}: `:"")+c,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function Sa(o){const e=o.key,s=o.value,c=o.valueSpec||{},f=o.objectElementValidators||{},g=o.style,x=o.styleSpec;let C=[];const M=nr(s);if(M!=="object")return[new nn(e,s,`object expected, ${M} found`)];for(const P in s){const j=P.split(".")[0];let $;f[j]?$=f[j]:c[j]?$=Go:f["*"]?$=f["*"]:c["*"]&&($=Go),$?C=C.concat($({key:(e&&`${e}.`)+P,value:s[P],valueSpec:c[j]||c["*"],style:g,styleSpec:x,object:s,objectKey:P},s)):C.push(new nn(e,s[P],`unknown property "${P}"`))}for(const P in c)f[P]||c[P].required&&c[P].default===void 0&&s[P]===void 0&&C.push(new nn(e,s,`missing required property "${P}"`));return C}function Qh(o){const e=o.value,s=o.valueSpec,c=o.style,f=o.styleSpec,g=o.key,x=o.arrayElementValidator||Go;if(nr(e)!=="array")return[new nn(g,e,`array expected, ${nr(e)} found`)];if(s.length&&e.length!==s.length)return[new nn(g,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new nn(g,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let C={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};f.$version<7&&(C.function=s.function),nr(s.value)==="object"&&(C=s.value);let M=[];for(let P=0;P<e.length;P++)M=M.concat(x({array:e,arrayIndex:P,value:e[P],valueSpec:C,style:c,styleSpec:f,key:`${g}[${P}]`}));return M}function Fu(o){const e=o.key,s=o.value,c=o.valueSpec;let f=nr(s);if(f==="number"&&s!=s&&(f="NaN"),f!=="number")return[new nn(e,s,`number expected, ${f} found`)];if("minimum"in c){let g=c.minimum;if(nr(c.minimum)==="array"&&(g=c.minimum[o.arrayIndex]),s<g)return[new nn(e,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if(nr(c.maximum)==="array"&&(g=c.maximum[o.arrayIndex]),s>g)return[new nn(e,s,`${s} is greater than the maximum value ${g}`)]}return[]}function ju(o){const e=o.valueSpec,s=hr(o.value.type);let c,f,g,x={};const C=s!=="categorical"&&o.value.property===void 0,M=!C,P=nr(o.value.stops)==="array"&&nr(o.value.stops[0])==="array"&&nr(o.value.stops[0][0])==="object",j=Sa({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(Y){if(s==="identity")return[new nn(Y.key,Y.value,'identity function may not have a "stops" property')];let ee=[];const oe=Y.value;return ee=ee.concat(Qh({key:Y.key,value:oe,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:$})),nr(oe)==="array"&&oe.length===0&&ee.push(new nn(Y.key,oe,"array must have at least one stop")),ee},default:function(Y){return Go({key:Y.key,value:Y.value,valueSpec:e,style:Y.style,styleSpec:Y.styleSpec})}}});return s==="identity"&&C&&j.push(new nn(o.key,o.value,'missing required property "property"')),s==="identity"||o.value.stops||j.push(new nn(o.key,o.value,'missing required property "stops"')),s==="exponential"&&o.valueSpec.expression&&!Qa(o.valueSpec)&&j.push(new nn(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(M&&!So(o.valueSpec)?j.push(new nn(o.key,o.value,"property functions not supported")):C&&!Ca(o.valueSpec)&&j.push(new nn(o.key,o.value,"zoom functions not supported"))),s!=="categorical"&&!P||o.value.property!==void 0||j.push(new nn(o.key,o.value,'"property" property is required')),j;function $(Y){let ee=[];const oe=Y.value,de=Y.key;if(nr(oe)!=="array")return[new nn(de,oe,`array expected, ${nr(oe)} found`)];if(oe.length!==2)return[new nn(de,oe,`array length 2 expected, length ${oe.length} found`)];if(P){if(nr(oe[0])!=="object")return[new nn(de,oe,`object expected, ${nr(oe[0])} found`)];if(oe[0].zoom===void 0)return[new nn(de,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new nn(de,oe,"object stop key must have value")];const ve=hr(oe[0].zoom);if(typeof ve!="number")return[new nn(de,oe[0].zoom,"stop zoom values must be numbers")];if(g&&g>ve)return[new nn(de,oe[0].zoom,"stop zoom values must appear in ascending order")];ve!==g&&(g=ve,f=void 0,x={}),ee=ee.concat(Sa({key:`${de}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:Fu,value:W}}))}else ee=ee.concat(W({key:`${de}[0]`,value:oe[0],valueSpec:{},style:Y.style,styleSpec:Y.styleSpec},oe));return rl(Sr(oe[1]))?ee.concat([new nn(`${de}[1]`,oe[1],"expressions are not allowed in function stops.")]):ee.concat(Go({key:`${de}[1]`,value:oe[1],valueSpec:e,style:Y.style,styleSpec:Y.styleSpec}))}function W(Y,ee){const oe=nr(Y.value),de=hr(Y.value),ve=Y.value!==null?Y.value:ee;if(c){if(oe!==c)return[new nn(Y.key,ve,`${oe} stop domain type must match previous stop domain type ${c}`)]}else c=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof de!="number"&&typeof de!="string"&&typeof de!="boolean")return[new nn(Y.key,ve,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&s!=="categorical"){let Le=`number expected, ${oe} found`;return So(e)&&s===void 0&&(Le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new nn(Y.key,ve,Le)]}return s!=="categorical"||oe!=="number"||typeof de=="number"&&isFinite(de)&&Math.floor(de)===de?s!=="categorical"&&oe==="number"&&typeof de=="number"&&typeof f=="number"&&f!==void 0&&de<f?[new nn(Y.key,ve,"stop domain values must appear in ascending order")]:(f=de,s==="categorical"&&de in x?[new nn(Y.key,ve,"stop domain values must be unique")]:(x[de]=!0,[])):[new nn(Y.key,ve,`integer expected, found ${String(de)}`)]}}function ao(o){const e=(o.expressionContext==="property"?Xc:wc)(Sr(o.value),o.valueSpec);if(e.result==="error")return e.value.map(c=>new nn(`${o.key}${c.key}`,o.value,c.message));const s=e.value.expression||e.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!s.outputDefined())return[new nn(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!rs(s))return[new nn(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter")return Kc(s,o);if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!As(s,["zoom","feature-state"]))return[new nn(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Ys(s))return[new nn(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kc(o,e){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const f of e.valueSpec.expression.parameters)s.delete(f);if(s.size===0)return[];const c=[];return o instanceof Cs&&s.has(o.name)?[new nn(e.key,e.value,`["${o.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(o.eachChild(f=>{c.push(...Kc(f,e))}),c)}function Uu(o){const e=o.key,s=o.value,c=o.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(hr(s))===-1&&f.push(new nn(e,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(hr(s))===-1&&f.push(new nn(e,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function _h(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!_h(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ec(o,e="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};_h(o)||(o=Cc(o));const s=o;let c=!0;try{c=function(P){if(!Jc(P))return P;let j=Sr(P);return yh(j),j=Gd(j),j}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}const f=et[`filter_${e}`],g=wc(c,f);let x=null;if(g.result==="error")throw new Error(g.value.map(P=>`${P.key}: ${P.message}`).join(", "));x=(P,j,$)=>g.value.evaluate(P,j,{},$);let C=null,M=null;if(c!==s){const P=wc(s,f);if(P.result==="error")throw new Error(P.value.map(j=>`${j.key}: ${j.message}`).join(", "));C=(j,$,W,Y,ee)=>P.value.evaluate(j,$,{},W,void 0,void 0,Y,ee),M=!Ys(P.value.expression)}return{filter:x,dynamicFilter:C||void 0,needGeometry:Vd(c),needFeature:!!M}}function Gd(o){if(!Array.isArray(o))return o;const e=function(s){if(Nu.has(s[0])){for(let c=1;c<s.length;c++)if(Jc(s[c]))return!0}return s}(o);return e===!0?e:e.map(s=>Gd(s))}function yh(o){let e=!1;const s=[];if(o[0]==="case"){for(let c=1;c<o.length-1;c+=2)e=e||Jc(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if(o[0]==="match"){e=e||Jc(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if(o[0]==="step"){e=e||Jc(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}e&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)yh(o[c])}function Jc(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let s=1;s<o.length;s++)if(Jc(o[s]))return!0;return!1}const Nu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ed(o,e){return o<e?-1:o>e?1:0}function Vd(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let e=1;e<o.length;e++)if(Vd(o[e]))return!0;return!1}function Cc(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?vh(o[1],o[2],"=="):e==="!="?Gu(vh(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?vh(o[1],o[2],e):e==="any"?(s=o.slice(1),["any"].concat(s.map(Cc))):e==="all"?["all"].concat(o.slice(1).map(Cc)):e==="none"?["all"].concat(o.slice(1).map(Cc).map(Gu)):e==="in"?xh(o[1],o.slice(2)):e==="!in"?Gu(xh(o[1],o.slice(2))):e==="has"?bh(o[1]):e==="!has"?Gu(bh(o[1])):e!=="within"||o;var s}function vh(o,e,s){switch(o){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,o,e]}}function xh(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",o,["literal",e.sort(ed)]]:["filter-in-small",o,["literal",e]]}}function bh(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Gu(o){return["!",o]}function Ms(o){return _h(Sr(o.value))?ao(Si({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):Yc(o)}function Yc(o){const e=o.value,s=o.key;if(nr(e)!=="array")return[new nn(s,e,`array expected, ${nr(e)} found`)];const c=o.styleSpec;let f,g=[];if(e.length<1)return[new nn(s,e,"filter array must have at least 1 element")];switch(g=g.concat(Uu({key:`${s}[0]`,value:e[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),hr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&hr(e[1])==="$type"&&g.push(new nn(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new nn(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=nr(e[1]),f!=="string"&&g.push(new nn(`${s}[1]`,e[1],`string expected, ${f} found`)));for(let x=2;x<e.length;x++)f=nr(e[x]),hr(e[1])==="$type"?g=g.concat(Uu({key:`${s}[${x}]`,value:e[x],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&g.push(new nn(`${s}[${x}]`,e[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<e.length;x++)g=g.concat(Yc({key:`${s}[${x}]`,value:e[x],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":f=nr(e[1]),e.length!==2?g.push(new nn(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&g.push(new nn(`${s}[1]`,e[1],`string expected, ${f} found`));break;case"within":f=nr(e[1]),e.length!==2?g.push(new nn(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="object"&&g.push(new nn(`${s}[1]`,e[1],`object expected, ${f} found`))}return g}function Ac(o,e){const s=o.key,c=o.style,f=o.styleSpec,g=o.value,x=o.objectKey,C=f[`${e}_${o.layerType}`];if(!C)return[];const M=x.match(/^(.*)-transition$/);if(e==="paint"&&M&&C[M[1]]&&C[M[1]].transition)return Go({key:s,value:g,valueSpec:f.transition,style:c,styleSpec:f});const P=o.valueSpec||C[x];if(!P)return[new nn(s,g,`unknown property "${x}"`)];let j;if(nr(g)==="string"&&So(P)&&!P.tokens&&(j=/^{([^}]+)}$/.exec(g))){const W=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new nn(s,g,`"${x}" does not support interpolation syntax
Use an identity property function instead: ${W}.`)]}const $=[];return o.layerType==="symbol"&&(x==="text-field"&&c&&!c.glyphs&&$.push(new nn(s,g,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Ss(Sr(g))&&hr(g.type)==="identity"&&$.push(new nn(s,g,'"text-font" does not support identity functions'))),$.concat(Go({key:o.key,value:g,valueSpec:P,style:c,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:x}))}function Qc(o){return Ac(o,"paint")}function eu(o){return Ac(o,"layout")}function Vu(o){let e=[];const s=o.value,c=o.key,f=o.style,g=o.styleSpec;s.type||s.ref||e.push(new nn(c,s,'either "type" or "ref" is required'));let x=hr(s.type);const C=hr(s.ref);if(s.id){const M=hr(s.id);for(let P=0;P<o.arrayIndex;P++){const j=f.layers[P];hr(j.id)===M&&e.push(new nn(c,s.id,`duplicate layer id "${s.id}", previously used at line ${j.id.__line__}`))}}if("ref"in s){let M;["type","source","source-layer","filter","layout"].forEach(P=>{P in s&&e.push(new nn(c,s[P],`"${P}" is prohibited for ref layers`))}),f.layers.forEach(P=>{hr(P.id)===C&&(M=P)}),M?M.ref?e.push(new nn(c,s.ref,"ref cannot reference another ref layer")):x=hr(M.type):typeof C=="string"&&e.push(new nn(c,s.ref,`ref layer "${C}" not found`))}else if(x!=="background"&&x!=="sky")if(s.source){const M=f.sources&&f.sources[s.source],P=M&&hr(M.type);M?P==="vector"&&x==="raster"?e.push(new nn(c,s.source,`layer "${s.id}" requires a raster source`)):P==="raster"&&x!=="raster"?e.push(new nn(c,s.source,`layer "${s.id}" requires a vector source`)):P!=="vector"||s["source-layer"]?P==="raster-dem"&&x!=="hillshade"?e.push(new nn(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||P==="geojson"&&M.lineMetrics||e.push(new nn(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new nn(c,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new nn(c,s.source,`source "${s.source}" not found`))}else e.push(new nn(c,s,'missing required property "source"'));return e=e.concat(Sa({key:c,value:s,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Go({key:`${c}.type`,value:s.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:M=>Ms(Si({layerType:x},M)),layout:M=>Sa({layer:s,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>eu(Si({layerType:x},P))}}),paint:M=>Sa({layer:s,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>Qc(Si({layerType:x},P))}})}})),e}function Al(o){const e=o.value,s=o.key,c=nr(e);return c!=="string"?[new nn(s,e,`string expected, ${c} found`)]:[]}const tu={promoteId:function({key:o,value:e}){if(nr(e)==="string")return Al({key:o,value:e});{const s=[];for(const c in e)s.push(...Al({key:`${o}.${c}`,value:e[c]}));return s}}};function No(o){const e=o.value,s=o.key,c=o.styleSpec,f=o.style;if(!e.type)return[new nn(s,e,'"type" is required')];const g=hr(e.type);let x;switch(g){case"vector":case"raster":case"raster-dem":return x=Sa({key:s,value:e,valueSpec:c[`source_${g.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:tu}),x;case"geojson":if(x=Sa({key:s,value:e,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:tu}),e.cluster)for(const C in e.clusterProperties){const[M,P]=e.clusterProperties[C],j=typeof M=="string"?[M,["accumulated"],["get",C]]:M;x.push(...ao({key:`${s}.${C}.map`,value:P,expressionContext:"cluster-map"})),x.push(...ao({key:`${s}.${C}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return x;case"video":return Sa({key:s,value:e,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return Sa({key:s,value:e,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new nn(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Uu({key:`${s}.type`,value:e.type,valueSpec:{values:Ap(c)},style:f,styleSpec:c})}}function Ap(o){return o.source.reduce((e,s)=>{const c=o[s];return c.type.type==="enum"&&(e=e.concat(Object.keys(c.type.values))),e},[])}function $d(o){const e=o.value,s=o.styleSpec,c=s.light,f=o.style;let g=[];const x=nr(e);if(e===void 0)return g;if(x!=="object")return g=g.concat([new nn("light",e,`object expected, ${x} found`)]),g;for(const C in e){const M=C.match(/^(.*)-transition$/);g=g.concat(M&&c[M[1]]&&c[M[1]].transition?Go({key:C,value:e[C],valueSpec:s.transition,style:f,styleSpec:s}):c[C]?Go({key:C,value:e[C],valueSpec:c[C],style:f,styleSpec:s}):[new nn(C,e[C],`unknown property "${C}"`)])}return g}function _s(o){const e=o.value,s=o.key,c=o.style,f=o.styleSpec,g=f.terrain;let x=[];const C=nr(e);if(e===void 0)return x;if(C!=="object")return x=x.concat([new nn("terrain",e,`object expected, ${C} found`)]),x;for(const M in e){const P=M.match(/^(.*)-transition$/);x=x.concat(P&&g[P[1]]&&g[P[1]].transition?Go({key:M,value:e[M],valueSpec:f.transition,style:c,styleSpec:f}):g[M]?Go({key:M,value:e[M],valueSpec:g[M],style:c,styleSpec:f}):[new nn(M,e[M],`unknown property "${M}"`)])}if(e.source){const M=c.sources&&c.sources[e.source],P=M&&hr(M.type);M?P!=="raster-dem"&&x.push(new nn(s,e.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):x.push(new nn(s,e.source,`source "${e.source}" not found`))}else x.push(new nn(s,e,'terrain is missing required property "source"'));return x}function as(o){const e=o.value,s=o.style,c=o.styleSpec,f=c.fog;let g=[];const x=nr(e);if(e===void 0)return g;if(x!=="object")return g=g.concat([new nn("fog",e,`object expected, ${x} found`)]),g;for(const C in e){const M=C.match(/^(.*)-transition$/);g=g.concat(M&&f[M[1]]&&f[M[1]].transition?Go({key:C,value:e[C],valueSpec:c.transition,style:s,styleSpec:c}):f[C]?Go({key:C,value:e[C],valueSpec:f[C],style:s,styleSpec:c}):[new nn(C,e[C],`unknown property "${C}"`)])}return g}const td={"*":()=>[],array:Qh,boolean:function(o){const e=o.value,s=o.key,c=nr(e);return c!=="boolean"?[new nn(s,e,`boolean expected, ${c} found`)]:[]},number:Fu,color:function(o){const e=o.key,s=o.value,c=nr(s);return c!=="string"?[new nn(e,s,`color expected, ${c} found`)]:Yt(s)===null?[new nn(e,s,`color expected, "${s}" found`)]:[]},enum:Uu,filter:Ms,function:ju,layer:Vu,object:Sa,source:No,light:$d,terrain:_s,fog:as,string:Al,formatted:function(o){return Al(o).length===0?[]:ao(o)},resolvedImage:function(o){return Al(o).length===0?[]:ao(o)},projection:function(o){const e=o.value,s=o.styleSpec,c=s.projection,f=o.style;let g=[];const x=nr(e);if(x==="object")for(const C in e)g=g.concat(Go({key:C,value:e[C],valueSpec:c[C],style:f,styleSpec:s}));else x!=="string"&&(g=g.concat([new nn("projection",e,`object or string expected, ${x} found`)]));return g}};function Go(o){const e=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&Ss(hr(e))?ju(o):s.expression&&rl(Sr(e))?ao(o):s.type&&td[s.type]?td[s.type](o):Sa(Si({},o,{valueSpec:s.type?c[s.type]:s}))}function Hd(o){const e=o.value,s=o.key,c=Al(o);return c.length||(e.indexOf("{fontstack}")===-1&&c.push(new nn(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&c.push(new nn(s,e,'"glyphs" url must include a "{range}" token'))),c}function nd(o,e=et){return zs(Go({key:"",value:o,valueSpec:e.$root,styleSpec:e,style:o,objectElementValidators:{glyphs:Hd,"*":()=>[]}}))}const Wd=o=>zs(Qc(o)),rd=o=>zs(eu(o));function zs(o){return o.slice().sort((e,s)=>e.line&&s.line?e.line-s.line:0)}function wh(o,e){let s=!1;if(e&&e.length)for(const c of e)o.fire(new hi(new Error(c.message))),s=!0;return s}var Zd=Fs,ia=3;function Fs(o,e,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var f=new Int32Array(this.arrayBuffer);o=f[0],this.d=(e=f[1])+2*(s=f[2]);for(var g=0;g<this.d*this.d;g++){var x=f[ia+g],C=f[ia+g+1];c.push(x===C?null:f.subarray(x,C))}var M=f[ia+c.length+1];this.keys=f.subarray(f[ia+c.length],M),this.bboxes=f.subarray(M),this.insert=this._insertReadonly}else{this.d=e+2*s;for(var P=0;P<this.d*this.d;P++)c.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=o,this.padding=s,this.scale=e/o,this.uid=0;var j=s/e*o;this.min=-j,this.max=o+j}Fs.prototype.insert=function(o,e,s,c,f){this._forEachCell(e,s,c,f,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f)},Fs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fs.prototype._insertCell=function(o,e,s,c,f,g){this.cells[f].push(g)},Fs.prototype.query=function(o,e,s,c,f){var g=this.min,x=this.max;if(o<=g&&e<=g&&x<=s&&x<=c&&!f)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(o,e,s,c,this._queryCell,C,{},f),C},Fs.prototype._queryCell=function(o,e,s,c,f,g,x,C){var M=this.cells[f];if(M!==null)for(var P=this.keys,j=this.bboxes,$=0;$<M.length;$++){var W=M[$];if(x[W]===void 0){var Y=4*W;(C?C(j[Y+0],j[Y+1],j[Y+2],j[Y+3]):o<=j[Y+2]&&e<=j[Y+3]&&s>=j[Y+0]&&c>=j[Y+1])?(x[W]=!0,g.push(P[W])):x[W]=!1}}},Fs.prototype._forEachCell=function(o,e,s,c,f,g,x,C){for(var M=this._convertToCellCoord(o),P=this._convertToCellCoord(e),j=this._convertToCellCoord(s),$=this._convertToCellCoord(c),W=M;W<=j;W++)for(var Y=P;Y<=$;Y++){var ee=this.d*Y+W;if((!C||C(this._convertFromCellCoord(W),this._convertFromCellCoord(Y),this._convertFromCellCoord(W+1),this._convertFromCellCoord(Y+1)))&&f.call(this,o,e,s,c,ee,g,x,C))return}},Fs.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Fs.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Fs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,e=ia+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var f=new Int32Array(e+s+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=e,x=0;x<o.length;x++){var C=o[x];f[ia+x]=g,f.set(C,g),g+=C.length}return f[ia+o.length]=g,f.set(this.keys,g),f[ia+o.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer};var il=te(Zd);const $u={};function on(o,e,s={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writeable:!1}),$u[e]={klass:o,omit:s.omit||[]}}on(Object,"Object"),il.serialize=function(o,e){const s=o.toArrayBuffer();return e&&e.push(s),{buffer:s}},il.deserialize=function(o){return new il(o.buffer)},Object.defineProperty(il,"name",{value:"Grid"}),on(il,"Grid"),on(en,"Color"),on(Error,"Error"),on(wo,"AJAXError"),on(Qo,"ResolvedImage"),on(qc,"StylePropertyFunction"),on(Ta,"StyleExpression",{omit:["_evaluator"]}),on(Zc,"ZoomDependentExpression"),on(gh,"ZoomConstantExpression"),on(Cs,"CompoundExpression",{omit:["_evaluate"]});for(const o in To)$u[To[o]._classRegistryKey]||on(To[o],`Expression${o}`);function Eh(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Ch(o){return E.ImageBitmap&&o instanceof E.ImageBitmap}function Tl(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Eh(o)||Ch(o))return e&&e.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return e&&e.push(s.buffer),s}if(o instanceof E.ImageData)return e&&e.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(Tl(c,e));return s}if(typeof o=="object"){const s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const f=s.serialize?s.serialize(o,e):{};if(!s.serialize){for(const g in o)o.hasOwnProperty(g)&&($u[c].omit.indexOf(g)>=0||(f[g]=Tl(o[g],e)));o instanceof Error&&(f.message=o.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof o)}function Zl(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Eh(o)||Ch(o)||ArrayBuffer.isView(o)||o instanceof E.ImageData)return o;if(Array.isArray(o))return o.map(Zl);if(typeof o=="object"){const e=o.$name||"Object",{klass:s}=$u[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const f of Object.keys(o))f!=="$name"&&(c[f]=Zl(o[f]));return c}throw new Error("can't deserialize object of type "+typeof o)}const Xt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Ah(o){for(const e of o)if(id(e.charCodeAt(0)))return!0;return!1}function Sl(o){for(const e of o)if(!Xd(e.charCodeAt(0)))return!1;return!0}function Xd(o){return!(Xt.Arabic(o)||Xt["Arabic Supplement"](o)||Xt["Arabic Extended-A"](o)||Xt["Arabic Presentation Forms-A"](o)||Xt["Arabic Presentation Forms-B"](o))}function id(o){return!(o!==746&&o!==747&&(o<4352||!(Xt["Bopomofo Extended"](o)||Xt.Bopomofo(o)||Xt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Xt["CJK Compatibility Ideographs"](o)||Xt["CJK Compatibility"](o)||Xt["CJK Radicals Supplement"](o)||Xt["CJK Strokes"](o)||!(!Xt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Xt["CJK Unified Ideographs Extension A"](o)||Xt["CJK Unified Ideographs"](o)||Xt["Enclosed CJK Letters and Months"](o)||Xt["Hangul Compatibility Jamo"](o)||Xt["Hangul Jamo Extended-A"](o)||Xt["Hangul Jamo Extended-B"](o)||Xt["Hangul Jamo"](o)||Xt["Hangul Syllables"](o)||Xt.Hiragana(o)||Xt["Ideographic Description Characters"](o)||Xt.Kanbun(o)||Xt["Kangxi Radicals"](o)||Xt["Katakana Phonetic Extensions"](o)||Xt.Katakana(o)&&o!==12540||!(!Xt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Xt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Xt["Unified Canadian Aboriginal Syllabics"](o)||Xt["Unified Canadian Aboriginal Syllabics Extended"](o)||Xt["Vertical Forms"](o)||Xt["Yijing Hexagram Symbols"](o)||Xt["Yi Syllables"](o)||Xt["Yi Radicals"](o))))}function Hu(o){return!(id(o)||function(e){return!!(Xt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Xt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Xt["Letterlike Symbols"](e)||Xt["Number Forms"](e)||Xt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Xt["Control Pictures"](e)&&e!==9251||Xt["Optical Character Recognition"](e)||Xt["Enclosed Alphanumerics"](e)||Xt["Geometric Shapes"](e)||Xt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Xt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Xt["CJK Symbols and Punctuation"](e)||Xt.Katakana(e)||Xt["Private Use Area"](e)||Xt["CJK Compatibility Forms"](e)||Xt["Small Form Variants"](e)||Xt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function Xl(o){return o>=1424&&o<=2303||Xt["Arabic Presentation Forms-A"](o)||Xt["Arabic Presentation Forms-B"](o)}function Tp(o,e){return!(!e&&Xl(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Xt.Khmer(o))}function cn(o){for(const e of o)if(Xl(e.charCodeAt(0)))return!0;return!1}const nu="deferred",Wu="loading",Th="loaded";let ru=null,m="unavailable",a=null;const h=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(m="error"),ru&&ru(o)};function y(){w.fire(new Zi("pluginStateChange",{pluginStatus:m,pluginURL:a}))}const w=new wr,S=function(){return m},R=function(){if(m!==nu||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=Wu,y(),a&&In({url:a},o=>{o?h(o):(m=Th,y())})},D={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===Th||D.applyArabicShaping!=null,isLoading:()=>m===Wu,setState(o){m=o.pluginStatus,a=o.pluginURL},isParsed:()=>D.applyArabicShaping!=null&&D.processBidirectionalText!=null&&D.processStyledBidirectionalText!=null,getPluginURL:()=>a};class G{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(s,c){for(const f of s)if(!Tp(f.charCodeAt(0),c))return!1;return!0}(e,D.isLoaded())}}class q{constructor(e,s){this.property=e,this.value=s,this.expression=function(c,f){if(Ss(c))return new qc(c,f);if(rl(c)){const g=Xc(c,f);if(g.result==="error")throw new Error(g.value.map(x=>`${x.key}: ${x.message}`).join(", "));return g.value}{let g=c;return typeof c=="string"&&f.type==="color"&&(g=en.parse(c)),{kind:"constant",evaluate:()=>g}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,c){return this.property.possiblyEvaluate(this,e,s,c)}}class Z{constructor(e){this.property=e,this.value=new q(e,void 0)}transitioned(e,s){return new he(this.property,this.value,s,On({},e.transition,this.transition),e.now)}untransitioned(){return new he(this.property,this.value,null,{},0)}}class ne{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ci(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Z(this._values[e].property)),this._values[e].value=new q(this._values[e].property,s===null?void 0:ci(s))}getTransition(e){return ci(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Z(this._values[e].property)),this._values[e].transition=ci(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(e[s]=c);const f=this.getTransition(s);f!==void 0&&(e[`${s}-transition`]=f)}return e}transitioned(e,s){const c=new fe(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(e,s._values[f]);return c}untransitioned(){const e=new fe(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class he{constructor(e,s,c,f,g){const x=f.delay||0,C=f.duration||0;g=g||0,this.property=e,this.value=s,this.begin=g+x,this.end=this.begin+C,e.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(e,s,c){const f=e.now||0,g=this.value.possiblyEvaluate(e,s,c),x=this.prior;if(x){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return x.possiblyEvaluate(e,s,c);{const C=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(e,s,c),g,Gt(C))}}return g}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,c){const f=new ye(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(e,s,c);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class _e{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ci(this._values[e].value)}setValue(e,s){this._values[e]=new q(this._values[e].property,s===null?void 0:ci(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(e[s]=c)}return e}possiblyEvaluate(e,s,c){const f=new ye(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(e,s,c);return f}}class ge{constructor(e,s,c){this.property=e,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,c,f){return this.property.evaluate(this.value,this.parameters,e,s,c,f)}}class ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ie{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,c){const f=oo[this.specification.type];return f?f(e,s,c):e}}class pe{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,c,f){return new ge(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},c,f)}:e.expression,s)}interpolate(e,s,c){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new ge(this,{kind:"constant",value:void 0},e.parameters);const f=oo[this.specification.type];return f?new ge(this,{kind:"constant",value:f(e.value.value,s.value.value,c)},e.parameters):e}evaluate(e,s,c,f,g,x){return e.kind==="constant"?e.value:e.evaluate(s,c,f,g,x)}}class we{constructor(e){this.specification=e}possiblyEvaluate(e,s,c,f){return!!e.expression.evaluate(s,null,{},c,f)}interpolate(){return!1}}class Ee{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new G(0,{});for(const c in e){const f=e[c];f.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new q(f,void 0),x=this.defaultTransitionablePropertyValues[c]=new Z(f);this.defaultTransitioningPropertyValues[c]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(s)}}}function ke(o,e){return 256*(o=bt(Math.floor(o),0,255))+bt(Math.floor(e),0,255)}on(pe,"DataDrivenProperty"),on(ie,"DataConstantProperty"),on(we,"ColorRampProperty");const Ue={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fe{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class He{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $e(o,e=1){let s=0,c=0;return{members:o.map(f=>{const g=Ue[f.type].BYTES_PER_ELEMENT,x=s=it(s,Math.max(e,g)),C=f.components||1;return c=Math.max(c,g),s+=g*C,{name:f.name,type:f.type,components:C,offset:x}}),size:it(s,Math.max(c,e)),alignment:e}}function it(o,e){return Math.ceil(o/e)*e}class Pt extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const f=2*e;return this.int16[f+0]=s,this.int16[f+1]=c,e}}Pt.prototype.bytesPerElement=4,on(Pt,"StructArrayLayout2i4");class Qe extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){const g=3*e;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=f,e}}Qe.prototype.bytesPerElement=6,on(Qe,"StructArrayLayout3i6");class gt extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){const x=4*e;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=f,this.int16[x+3]=g,e}}gt.prototype.bytesPerElement=8,on(gt,"StructArrayLayout4i8");class st extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,x,C){const M=this.length;return this.resize(M+1),this.emplace(M,e,s,c,f,g,x,C)}emplace(e,s,c,f,g,x,C,M){const P=6*e,j=12*e,$=3*e;return this.int16[P+0]=s,this.int16[P+1]=c,this.uint8[j+4]=f,this.uint8[j+5]=g,this.uint8[j+6]=x,this.uint8[j+7]=C,this.float32[$+2]=M,e}}st.prototype.bytesPerElement=12,on(st,"StructArrayLayout2i4ub1f12");class Lt extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){const x=4*e;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=f,this.float32[x+3]=g,e}}Lt.prototype.bytesPerElement=16,on(Lt,"StructArrayLayout4f16");class tt extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,c,f,g)}emplace(e,s,c,f,g,x){const C=6*e,M=3*e;return this.uint16[C+0]=s,this.uint16[C+1]=c,this.uint16[C+2]=f,this.uint16[C+3]=g,this.float32[M+2]=x,e}}tt.prototype.bytesPerElement=12,on(tt,"StructArrayLayout4ui1f12");class mt extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){const x=4*e;return this.uint16[x+0]=s,this.uint16[x+1]=c,this.uint16[x+2]=f,this.uint16[x+3]=g,e}}mt.prototype.bytesPerElement=8,on(mt,"StructArrayLayout4ui8");class xt extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,x){const C=this.length;return this.resize(C+1),this.emplace(C,e,s,c,f,g,x)}emplace(e,s,c,f,g,x,C){const M=6*e;return this.int16[M+0]=s,this.int16[M+1]=c,this.int16[M+2]=f,this.int16[M+3]=g,this.int16[M+4]=x,this.int16[M+5]=C,e}}xt.prototype.bytesPerElement=12,on(xt,"StructArrayLayout6i12");class at extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,x,C,M,P,j,$,W){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,s,c,f,g,x,C,M,P,j,$,W)}emplace(e,s,c,f,g,x,C,M,P,j,$,W,Y){const ee=12*e;return this.int16[ee+0]=s,this.int16[ee+1]=c,this.int16[ee+2]=f,this.int16[ee+3]=g,this.uint16[ee+4]=x,this.uint16[ee+5]=C,this.uint16[ee+6]=M,this.uint16[ee+7]=P,this.int16[ee+8]=j,this.int16[ee+9]=$,this.int16[ee+10]=W,this.int16[ee+11]=Y,e}}at.prototype.bytesPerElement=24,on(at,"StructArrayLayout4i4ui4i24");class Et extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,x){const C=this.length;return this.resize(C+1),this.emplace(C,e,s,c,f,g,x)}emplace(e,s,c,f,g,x,C){const M=10*e,P=5*e;return this.int16[M+0]=s,this.int16[M+1]=c,this.int16[M+2]=f,this.float32[P+2]=g,this.float32[P+3]=x,this.float32[P+4]=C,e}}Et.prototype.bytesPerElement=20,on(Et,"StructArrayLayout3i3f20");class rn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}rn.prototype.bytesPerElement=4,on(rn,"StructArrayLayout1ul4");class fn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,x,C,M,P,j,$,W,Y){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,s,c,f,g,x,C,M,P,j,$,W,Y)}emplace(e,s,c,f,g,x,C,M,P,j,$,W,Y,ee){const oe=20*e,de=10*e;return this.int16[oe+0]=s,this.int16[oe+1]=c,this.int16[oe+2]=f,this.int16[oe+3]=g,this.int16[oe+4]=x,this.float32[de+3]=C,this.float32[de+4]=M,this.float32[de+5]=P,this.float32[de+6]=j,this.int16[oe+14]=$,this.uint32[de+8]=W,this.uint16[oe+18]=Y,this.uint16[oe+19]=ee,e}}fn.prototype.bytesPerElement=40,on(fn,"StructArrayLayout5i4f1i1ul2ui40");class qt extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,x,C){const M=this.length;return this.resize(M+1),this.emplace(M,e,s,c,f,g,x,C)}emplace(e,s,c,f,g,x,C,M){const P=8*e;return this.int16[P+0]=s,this.int16[P+1]=c,this.int16[P+2]=f,this.int16[P+4]=g,this.int16[P+5]=x,this.int16[P+6]=C,this.int16[P+7]=M,e}}qt.prototype.bytesPerElement=16,on(qt,"StructArrayLayout3i2i2i16");class gn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,c,f,g)}emplace(e,s,c,f,g,x){const C=4*e,M=8*e;return this.float32[C+0]=s,this.float32[C+1]=c,this.float32[C+2]=f,this.int16[M+6]=g,this.int16[M+7]=x,e}}gn.prototype.bytesPerElement=16,on(gn,"StructArrayLayout2f1f2i16");class An extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){const x=12*e,C=3*e;return this.uint8[x+0]=s,this.uint8[x+1]=c,this.float32[C+1]=f,this.float32[C+2]=g,e}}An.prototype.bytesPerElement=12,on(An,"StructArrayLayout2ub2f12");class Nn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){const g=3*e;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=f,e}}Nn.prototype.bytesPerElement=12,on(Nn,"StructArrayLayout3f12");class un extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){const g=3*e;return this.uint16[g+0]=s,this.uint16[g+1]=c,this.uint16[g+2]=f,e}}un.prototype.bytesPerElement=6,on(un,"StructArrayLayout3ui6");class xr extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,x,C,M,P,j,$,W,Y,ee,oe,de,ve,Le,xe,Me,Oe){const Re=this.length;return this.resize(Re+1),this.emplace(Re,e,s,c,f,g,x,C,M,P,j,$,W,Y,ee,oe,de,ve,Le,xe,Me,Oe)}emplace(e,s,c,f,g,x,C,M,P,j,$,W,Y,ee,oe,de,ve,Le,xe,Me,Oe,Re){const ot=30*e,nt=15*e,pt=60*e;return this.int16[ot+0]=s,this.int16[ot+1]=c,this.int16[ot+2]=f,this.float32[nt+2]=g,this.float32[nt+3]=x,this.uint16[ot+8]=C,this.uint16[ot+9]=M,this.uint32[nt+5]=P,this.uint32[nt+6]=j,this.uint32[nt+7]=$,this.uint16[ot+16]=W,this.uint16[ot+17]=Y,this.uint16[ot+18]=ee,this.float32[nt+10]=oe,this.float32[nt+11]=de,this.uint8[pt+48]=ve,this.uint8[pt+49]=Le,this.uint8[pt+50]=xe,this.uint32[nt+13]=Me,this.int16[ot+28]=Oe,this.uint8[pt+58]=Re,e}}xr.prototype.bytesPerElement=60,on(xr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Or extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,x,C,M,P,j,$,W,Y,ee,oe,de,ve,Le,xe,Me,Oe,Re,ot,nt,pt,Ot,ct,Ct,At,Mt){const kt=this.length;return this.resize(kt+1),this.emplace(kt,e,s,c,f,g,x,C,M,P,j,$,W,Y,ee,oe,de,ve,Le,xe,Me,Oe,Re,ot,nt,pt,Ot,ct,Ct,At,Mt)}emplace(e,s,c,f,g,x,C,M,P,j,$,W,Y,ee,oe,de,ve,Le,xe,Me,Oe,Re,ot,nt,pt,Ot,ct,Ct,At,Mt,kt){const ft=38*e,Qt=19*e;return this.int16[ft+0]=s,this.int16[ft+1]=c,this.int16[ft+2]=f,this.float32[Qt+2]=g,this.float32[Qt+3]=x,this.int16[ft+8]=C,this.int16[ft+9]=M,this.int16[ft+10]=P,this.int16[ft+11]=j,this.int16[ft+12]=$,this.int16[ft+13]=W,this.uint16[ft+14]=Y,this.uint16[ft+15]=ee,this.uint16[ft+16]=oe,this.uint16[ft+17]=de,this.uint16[ft+18]=ve,this.uint16[ft+19]=Le,this.uint16[ft+20]=xe,this.uint16[ft+21]=Me,this.uint16[ft+22]=Oe,this.uint16[ft+23]=Re,this.uint16[ft+24]=ot,this.uint16[ft+25]=nt,this.uint16[ft+26]=pt,this.uint16[ft+27]=Ot,this.uint16[ft+28]=ct,this.uint32[Qt+15]=Ct,this.float32[Qt+16]=At,this.float32[Qt+17]=Mt,this.float32[Qt+18]=kt,e}}Or.prototype.bytesPerElement=76,on(Or,"StructArrayLayout3i2f6i15ui1ul3f76");class Cr extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}Cr.prototype.bytesPerElement=4,on(Cr,"StructArrayLayout1f4");class or extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,c,f,g)}emplace(e,s,c,f,g,x){const C=5*e;return this.float32[C+0]=s,this.float32[C+1]=c,this.float32[C+2]=f,this.float32[C+3]=g,this.float32[C+4]=x,e}}or.prototype.bytesPerElement=20,on(or,"StructArrayLayout5f20");class Mo extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){const x=6*e;return this.uint32[3*e+0]=s,this.uint16[x+2]=c,this.uint16[x+3]=f,this.uint16[x+4]=g,e}}Mo.prototype.bytesPerElement=12,on(Mo,"StructArrayLayout1ul3ui12");class to extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const f=2*e;return this.uint16[f+0]=s,this.uint16[f+1]=c,e}}to.prototype.bytesPerElement=4,on(to,"StructArrayLayout2ui4");class Vo extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}Vo.prototype.bytesPerElement=2,on(Vo,"StructArrayLayout1ui2");class js extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const f=2*e;return this.float32[f+0]=s,this.float32[f+1]=c,e}}js.prototype.bytesPerElement=8,on(js,"StructArrayLayout2f8");class ti extends Fe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ti.prototype.size=40;class _r extends fn{get(e){return new ti(this,e)}}on(_r,"CollisionBoxArray");class mr extends Fe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}mr.prototype.size=60;class ni extends xr{get(e){return new mr(this,e)}}on(ni,"PlacedSymbolArray");class Io extends Fe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Io.prototype.size=76;class jr extends Or{get(e){return new Io(this,e)}}on(jr,"SymbolInstanceArray");class ls extends Cr{getoffsetX(e){return this.float32[1*e+0]}}on(ls,"GlyphOffsetArray");class Tc extends Pt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}on(Tc,"SymbolLineVertexArray");class ol extends Fe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ol.prototype.size=12;class lo extends Mo{get(e){return new ol(this,e)}}on(lo,"FeatureIndexArray");class cs extends to{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}on(cs,"FillExtrusionCentroidArray");const co=$e([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),sl=$e([{name:"a_dash",components:4,type:"Uint16"}]);var $o={exports:{}},iu={exports:{}};iu.exports=function(o,e){var s,c,f,g,x,C,M,P;for(c=o.length-(s=3&o.length),f=e,x=3432918353,C=461845907,P=0;P<c;)M=255&o.charCodeAt(P)|(255&o.charCodeAt(++P))<<8|(255&o.charCodeAt(++P))<<16|(255&o.charCodeAt(++P))<<24,++P,f=27492+(65535&(g=5*(65535&(f=(f^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(M=0,s){case 3:M^=(255&o.charCodeAt(P+2))<<16;case 2:M^=(255&o.charCodeAt(P+1))<<8;case 1:f^=M=(65535&(M=(M=(65535&(M^=255&o.charCodeAt(P)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295}return f^=o.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Zu=iu.exports,qd={exports:{}};qd.exports=function(o,e){for(var s,c=o.length,f=e^c,g=0;c>=4;)s=1540483477*(65535&(s=255&o.charCodeAt(g)|(255&o.charCodeAt(++g))<<8|(255&o.charCodeAt(++g))<<16|(255&o.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++g;switch(c){case 3:f^=(255&o.charCodeAt(g+2))<<16;case 2:f^=(255&o.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&o.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var Xm=Zu,ou=qd.exports;$o.exports=Xm,$o.exports.murmur3=Xm,$o.exports.murmur2=ou;var Kd=te($o.exports);class od{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,c,f){this.ids.push(Jd(e)),this.positions.push(s,c,f)}getPositions(e){const s=Jd(e);let c=0,f=this.ids.length-1;for(;c<f;){const x=c+f>>1;this.ids[x]>=s?f=x:c=x+1}const g=[];for(;this.ids[c]===s;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(e,s){const c=new Float64Array(e.ids),f=new Uint32Array(e.positions);return Sc(c,f,0,c.length-1),s&&s.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(e){const s=new od;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function Jd(o){const e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Kd(String(o))}function Sc(o,e,s,c){for(;s<c;){const f=o[s+c>>1];let g=s-1,x=c+1;for(;;){do g++;while(o[g]<f);do x--;while(o[x]>f);if(g>=x)break;sd(o,g,x),sd(e,3*g,3*x),sd(e,3*g+1,3*x+1),sd(e,3*g+2,3*x+2)}x-s<c-x?(Sc(o,e,s,x),s=x+1):(Sc(o,e,x+1,c),c=x)}}function sd(o,e,s){const c=o[e];o[e]=o[s],o[s]=c}on(od,"FeaturePositionMap");class ql{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,s),this.initialized=!0),!!this.location}}class Sh extends ql{constructor(e){super(e),this.current=0}set(e,s,c){this.fetchUniformLocation(e,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class ad extends ql{constructor(e){super(e),this.current=[0,0,0,0]}set(e,s,c){this.fetchUniformLocation(e,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class qm extends ql{constructor(e){super(e),this.current=en.transparent}set(e,s,c){this.fetchUniformLocation(e,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const sy=new Float32Array(16),Km=new Float32Array(9),Jm=new Float32Array(4);function Mc(o){return[ke(255*o.r,255*o.g),ke(255*o.b,255*o.a)]}class ld{constructor(e,s,c){this.value=e,this.uniformNames=s.map(f=>`u_${f}`),this.type=c}setUniform(e,s,c,f,g){s.set(e,g,f.constantOr(this.value))}getBinding(e,s){return this.type==="color"?new qm(e):new Sh(e)}}class al{constructor(e,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,s,c,f,g){const x=g==="u_pattern"||g==="u_dash"?this.pattern:g==="u_pixel_ratio"?this.pixelRatio:null;x&&s.set(e,g,x)}getBinding(e,s){return s==="u_pattern"||s==="u_dash"?new ad(e):new Sh(e)}}class Kl{constructor(e,s,c,f){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,s,c,f,g,x){const C=this.paintVertexArray.length,M=this.expression.evaluate(new G(0),s,{},g,f,x);this.paintVertexArray.resize(e),this._setPaintValue(C,e,M)}updatePaintArray(e,s,c,f,g){const x=this.expression.evaluate({zoom:0},c,f,void 0,g);this._setPaintValue(e,s,x)}_setPaintValue(e,s,c){if(this.type==="color"){const f=Mc(c);for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=e;f<s;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ui{constructor(e,s,c,f,g,x){this.expression=e,this.uniformNames=s.map(C=>`u_${C}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(C=>({name:`a_${C}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(e,s,c,f,g,x){const C=this.expression.evaluate(new G(this.zoom),s,{},g,f,x),M=this.expression.evaluate(new G(this.zoom+1),s,{},g,f,x),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,C,M)}updatePaintArray(e,s,c,f,g){const x=this.expression.evaluate({zoom:this.zoom},c,f,void 0,g),C=this.expression.evaluate({zoom:this.zoom+1},c,f,void 0,g);this._setPaintValue(e,s,x,C)}_setPaintValue(e,s,c,f){if(this.type==="color"){const g=Mc(c),x=Mc(f);for(let C=e;C<s;C++)this.paintVertexArray.emplace(C,g[0],g[1],x[0],x[1])}else{for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s,c,f,g){const x=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,C=bt(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);s.set(e,g,C)}getBinding(e,s){return new Sh(e)}}class su{constructor(e,s,c,f,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=(c==="array"?sl:co).members;for(let x=0;x<s.length;++x);this.paintVertexArray=new f}populatePaintArray(e,s,c){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(e,s,c,f,g,x){this._setPaintValues(e,s,c.patterns&&c.patterns[this.layerId],x)}_setPaintValues(e,s,c,f){if(!f||!c)return;const g=f[c];if(!g)return;const{tl:x,br:C,pixelRatio:M}=g;for(let P=e;P<s;P++)this.paintVertexArray.emplace(P,x[0],x[1],C[0],C[1],M)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ic{constructor(e,s,c=()=>!0){this.binders={},this._buffers=[];const f=[];for(const g in e.paint._values){if(!c(g))continue;const x=e.paint.get(g);if(!(x instanceof ge&&So(x.property.specification)))continue;const C=Ym(g,e.type),M=x.value,P=x.property.specification.type,j=!!x.property.useIntegerZoom,$=g==="line-dasharray"||g.endsWith("pattern"),W=g==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(M.kind!=="constant"||W)if(M.kind==="source"||W||$){const Y=Ma(g,P,"source");this.binders[g]=$?new su(M,C,P,Y,e.id):new Kl(M,C,P,Y),f.push(`/a_${g}`)}else{const Y=Ma(g,P,"composite");this.binders[g]=new Ui(M,C,P,j,s,Y),f.push(`/z_${g}`)}else this.binders[g]=$?new al(M.value,C):new ld(M.value,C,P),f.push(`/u_${g}`)}this.cacheKey=f.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Kl||s instanceof Ui?s.maxValue:0}populatePaintArrays(e,s,c,f,g,x){for(const C in this.binders){const M=this.binders[C];(M instanceof Kl||M instanceof Ui||M instanceof su)&&M.populatePaintArray(e,s,c,f,g,x)}}setConstantPatternPositions(e){for(const s in this.binders){const c=this.binders[s];c instanceof al&&c.setConstantPatternPositions(e)}}updatePaintArrays(e,s,c,f,g,x){let C=!1;for(const M in e){const P=s.getPositions(M);for(const j of P){const $=c.feature(j.index);for(const W in this.binders){const Y=this.binders[W];if((Y instanceof Kl||Y instanceof Ui||Y instanceof su)&&Y.expression.isStateDependent===!0){const ee=f.paint.get(W);Y.expression=ee.value,Y.updatePaintArray(j.start,j.end,$,e[M],g,x),C=!0}}}}return C}defines(){const e=[];for(const s in this.binders){const c=this.binders[s];(c instanceof ld||c instanceof al)&&e.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Kl||c instanceof Ui||c instanceof su)for(let f=0;f<c.paintVertexAttributes.length;f++)e.push(c.paintVertexAttributes[f].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof ld||c instanceof al||c instanceof Ui)for(const f of c.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof ld||f instanceof al||f instanceof Ui)for(const g of f.uniformNames)s.push({name:g,property:c,binding:f.getBinding(e,g)})}return s}setUniforms(e,s,c,f,g){for(const{name:x,property:C,binding:M}of c)this.binders[C].setUniform(e,M,g,f.get(C),x)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const s=this.binders[e];(s instanceof Kl||s instanceof Ui||s instanceof su)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const s in this.binders){const c=this.binders[s];(c instanceof Kl||c instanceof Ui||c instanceof su)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Kl||s instanceof Ui||s instanceof su)&&s.destroy()}}}class Xu{constructor(e,s,c=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new Ic(f,s,c);this.needsUpload=!1,this._featureMap=new od,this._bufferOffset=0}populatePaintArrays(e,s,c,f,g,x,C){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,s,f,g,x,C);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,c,f,g){for(const x of c)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,s,x,f,g)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ay={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ym(o,e){return ay[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const Qm={"line-pattern":{source:tt,composite:tt},"fill-pattern":{source:tt,composite:tt},"fill-extrusion-pattern":{source:tt,composite:tt},"line-dasharray":{source:mt,composite:mt}},ly={color:{source:js,composite:Lt},number:{source:Cr,composite:js}};function Ma(o,e,s){const c=Qm[o];return c&&c[s]||ly[e][s]}on(ld,"ConstantBinder"),on(al,"PatternConstantBinder"),on(Kl,"SourceExpressionBinder"),on(su,"PatternCompositeBinder"),on(Ui,"CompositeExpressionBinder"),on(Ic,"ProgramConfiguration",{omit:["_buffers"]}),on(Xu,"ProgramConfigurationSet");const Yd="-transition";class Ml extends wr{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new _e(s.layout)),s.paint)){this._transitionablePaint=new ne(s.paint);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ye(s.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,c={}){s!=null&&this._validate(rd,`layers.${this.id}.layout.${e}`,e,s,c)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return li(e,Yd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,c={}){if(s!=null&&this._validate(Wd,`layers.${this.id}.paint.${e}`,e,s,c))return!1;if(li(e,Yd))return this._transitionablePaint.setTransition(e.slice(0,-11),s||void 0),!1;{const f=this._transitionablePaint._values[e],g=f.value.isDataDriven(),x=f.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const C=this._transitionablePaint._values[e].value,M=C.isDataDriven(),P=li(e,"pattern")||e==="line-dasharray";return M||g||P||this._handleOverridablePaintPropertyUpdate(e,x,C)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,s,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Br(e,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(e,s,c,f,g={}){return(!g||g.validate!==!1)&&wh(this,e.call(nd,{key:s,layerType:this.type,objectKey:c,value:f,styleSpec:et,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof ge&&So(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ec(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const au=$e([{name:"a_pos",components:2,type:"Int16"}],4),Qd=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fi{constructor(e=[]){this.segments=e}prepareSegment(e,s,c,f){let g=this.segments[this.segments.length-1];return e>fi.MAX_VERTEX_ARRAY_LENGTH&&wn(`Max vertices per segment is ${fi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>fi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},f!==void 0&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,c,f){return new fi([{vertexOffset:e,primitiveOffset:s,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}fi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,on(fi,"SegmentVector");var _n=8192;class Jl{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ri?new ri(e.lng,e.lat):ri.convert(e),this}setSouthWest(e){return this._sw=e instanceof ri?new ri(e.lng,e.lat):ri.convert(e),this}extend(e){const s=this._sw,c=this._ne;let f,g;if(e instanceof ri)f=e,g=e;else{if(!(e instanceof Jl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Jl.convert(e)):this.extend(ri.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ri.convert(e)):this;if(f=e._sw,g=e._ne,!f||!g)return this}return s||c?(s.lng=Math.min(f.lng,s.lng),s.lat=Math.min(f.lat,s.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new ri(f.lng,f.lat),this._ne=new ri(g.lng,g.lat)),this}getCenter(){return new ri((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ri(this.getWest(),this.getNorth())}getSouthEast(){return new ri(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:c}=ri.convert(e);let f=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(e){return!e||e instanceof Jl?e:new Jl(e)}}var Mh=1e-6,oa=typeof Float32Array<"u"?Float32Array:Array;function Sp(){var o=new oa(9);return oa!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Mp(o,e,s){var c=e[0],f=e[1],g=e[2],x=e[3],C=e[4],M=e[5],P=e[6],j=e[7],$=e[8],W=s[0],Y=s[1],ee=s[2],oe=s[3],de=s[4],ve=s[5],Le=s[6],xe=s[7],Me=s[8];return o[0]=W*c+Y*x+ee*P,o[1]=W*f+Y*C+ee*j,o[2]=W*g+Y*M+ee*$,o[3]=oe*c+de*x+ve*P,o[4]=oe*f+de*C+ve*j,o[5]=oe*g+de*M+ve*$,o[6]=Le*c+xe*x+Me*P,o[7]=Le*f+xe*C+Me*j,o[8]=Le*g+xe*M+Me*$,o}function ll(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ef(o,e){var s=e[0],c=e[1],f=e[2],g=e[3],x=e[4],C=e[5],M=e[6],P=e[7],j=e[8],$=e[9],W=e[10],Y=e[11],ee=e[12],oe=e[13],de=e[14],ve=e[15],Le=s*C-c*x,xe=s*M-f*x,Me=s*P-g*x,Oe=c*M-f*C,Re=c*P-g*C,ot=f*P-g*M,nt=j*oe-$*ee,pt=j*de-W*ee,Ot=j*ve-Y*ee,ct=$*de-W*oe,Ct=$*ve-Y*oe,At=W*ve-Y*de,Mt=Le*At-xe*Ct+Me*ct+Oe*Ot-Re*pt+ot*nt;return Mt?(o[0]=(C*At-M*Ct+P*ct)*(Mt=1/Mt),o[1]=(f*Ct-c*At-g*ct)*Mt,o[2]=(oe*ot-de*Re+ve*Oe)*Mt,o[3]=(W*Re-$*ot-Y*Oe)*Mt,o[4]=(M*Ot-x*At-P*pt)*Mt,o[5]=(s*At-f*Ot+g*pt)*Mt,o[6]=(de*Me-ee*ot-ve*xe)*Mt,o[7]=(j*ot-W*Me+Y*xe)*Mt,o[8]=(x*Ct-C*Ot+P*nt)*Mt,o[9]=(c*Ot-s*Ct-g*nt)*Mt,o[10]=(ee*Re-oe*Me+ve*Le)*Mt,o[11]=($*Me-j*Re-Y*Le)*Mt,o[12]=(C*pt-x*ct-M*nt)*Mt,o[13]=(s*ct-c*pt+f*nt)*Mt,o[14]=(oe*xe-ee*Oe-de*Le)*Mt,o[15]=(j*Oe-$*xe+W*Le)*Mt,o):null}function Pc(o,e,s){var c=e[0],f=e[1],g=e[2],x=e[3],C=e[4],M=e[5],P=e[6],j=e[7],$=e[8],W=e[9],Y=e[10],ee=e[11],oe=e[12],de=e[13],ve=e[14],Le=e[15],xe=s[0],Me=s[1],Oe=s[2],Re=s[3];return o[0]=xe*c+Me*C+Oe*$+Re*oe,o[1]=xe*f+Me*M+Oe*W+Re*de,o[2]=xe*g+Me*P+Oe*Y+Re*ve,o[3]=xe*x+Me*j+Oe*ee+Re*Le,o[4]=(xe=s[4])*c+(Me=s[5])*C+(Oe=s[6])*$+(Re=s[7])*oe,o[5]=xe*f+Me*M+Oe*W+Re*de,o[6]=xe*g+Me*P+Oe*Y+Re*ve,o[7]=xe*x+Me*j+Oe*ee+Re*Le,o[8]=(xe=s[8])*c+(Me=s[9])*C+(Oe=s[10])*$+(Re=s[11])*oe,o[9]=xe*f+Me*M+Oe*W+Re*de,o[10]=xe*g+Me*P+Oe*Y+Re*ve,o[11]=xe*x+Me*j+Oe*ee+Re*Le,o[12]=(xe=s[12])*c+(Me=s[13])*C+(Oe=s[14])*$+(Re=s[15])*oe,o[13]=xe*f+Me*M+Oe*W+Re*de,o[14]=xe*g+Me*P+Oe*Y+Re*ve,o[15]=xe*x+Me*j+Oe*ee+Re*Le,o}function cd(o,e,s){var c,f,g,x,C,M,P,j,$,W,Y,ee,oe=s[0],de=s[1],ve=s[2];return e===o?(o[12]=e[0]*oe+e[4]*de+e[8]*ve+e[12],o[13]=e[1]*oe+e[5]*de+e[9]*ve+e[13],o[14]=e[2]*oe+e[6]*de+e[10]*ve+e[14],o[15]=e[3]*oe+e[7]*de+e[11]*ve+e[15]):(f=e[1],g=e[2],x=e[3],C=e[4],M=e[5],P=e[6],j=e[7],$=e[8],W=e[9],Y=e[10],ee=e[11],o[0]=c=e[0],o[1]=f,o[2]=g,o[3]=x,o[4]=C,o[5]=M,o[6]=P,o[7]=j,o[8]=$,o[9]=W,o[10]=Y,o[11]=ee,o[12]=c*oe+C*de+$*ve+e[12],o[13]=f*oe+M*de+W*ve+e[13],o[14]=g*oe+P*de+Y*ve+e[14],o[15]=x*oe+j*de+ee*ve+e[15]),o}function qu(o,e,s){var c=s[0],f=s[1],g=s[2];return o[0]=e[0]*c,o[1]=e[1]*c,o[2]=e[2]*c,o[3]=e[3]*c,o[4]=e[4]*f,o[5]=e[5]*f,o[6]=e[6]*f,o[7]=e[7]*f,o[8]=e[8]*g,o[9]=e[9]*g,o[10]=e[10]*g,o[11]=e[11]*g,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function _(o,e,s){var c=Math.sin(s),f=Math.cos(s),g=e[4],x=e[5],C=e[6],M=e[7],P=e[8],j=e[9],$=e[10],W=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=g*f+P*c,o[5]=x*f+j*c,o[6]=C*f+$*c,o[7]=M*f+W*c,o[8]=P*f-g*c,o[9]=j*f-x*c,o[10]=$*f-C*c,o[11]=W*f-M*c,o}function v(o,e,s){var c=Math.sin(s),f=Math.cos(s),g=e[0],x=e[1],C=e[2],M=e[3],P=e[8],j=e[9],$=e[10],W=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=g*f-P*c,o[1]=x*f-j*c,o[2]=C*f-$*c,o[3]=M*f-W*c,o[8]=g*c+P*f,o[9]=x*c+j*f,o[10]=C*c+$*f,o[11]=M*c+W*f,o}function L(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function F(o,e,s){var c,f,g,x=s[0],C=s[1],M=s[2],P=Math.hypot(x,C,M);return P<Mh?null:(x*=P=1/P,C*=P,M*=P,c=Math.sin(e),f=Math.cos(e),o[0]=x*x*(g=1-f)+f,o[1]=C*x*g+M*c,o[2]=M*x*g-C*c,o[3]=0,o[4]=x*C*g-M*c,o[5]=C*C*g+f,o[6]=M*C*g+x*c,o[7]=0,o[8]=x*M*g+C*c,o[9]=C*M*g-x*c,o[10]=M*M*g+f,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,e=arguments.length;e--;)o+=arguments[e]*arguments[e];return Math.sqrt(o)});var K=Pc;function re(){var o=new oa(3);return oa!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Ie(o){var e=new oa(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function Ze(o){return Math.hypot(o[0],o[1],o[2])}function vt(o,e,s){var c=new oa(3);return c[0]=o,c[1]=e,c[2]=s,c}function Nt(o,e,s){return o[0]=e[0]+s[0],o[1]=e[1]+s[1],o[2]=e[2]+s[2],o}function vn(o,e,s){return o[0]=e[0]-s[0],o[1]=e[1]-s[1],o[2]=e[2]-s[2],o}function lr(o,e,s){return o[0]=e[0]*s[0],o[1]=e[1]*s[1],o[2]=e[2]*s[2],o}function Dn(o,e,s){return o[0]=Math.min(e[0],s[0]),o[1]=Math.min(e[1],s[1]),o[2]=Math.min(e[2],s[2]),o}function Kr(o,e,s){return o[0]=Math.max(e[0],s[0]),o[1]=Math.max(e[1],s[1]),o[2]=Math.max(e[2],s[2]),o}function pn(o,e,s){return o[0]=e[0]*s,o[1]=e[1]*s,o[2]=e[2]*s,o}function Po(o,e,s,c){return o[0]=e[0]+s[0]*c,o[1]=e[1]+s[1]*c,o[2]=e[2]+s[2]*c,o}function Ei(o,e){var s=e[0],c=e[1],f=e[2],g=s*s+c*c+f*f;return g>0&&(g=1/Math.sqrt(g)),o[0]=e[0]*g,o[1]=e[1]*g,o[2]=e[2]*g,o}function lt(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function Ye(o,e,s){var c=e[0],f=e[1],g=e[2],x=s[0],C=s[1],M=s[2];return o[0]=f*M-g*C,o[1]=g*x-c*M,o[2]=c*C-f*x,o}function ut(o,e,s){var c=e[0],f=e[1],g=e[2],x=s[3]*c+s[7]*f+s[11]*g+s[15];return o[0]=(s[0]*c+s[4]*f+s[8]*g+s[12])/(x=x||1),o[1]=(s[1]*c+s[5]*f+s[9]*g+s[13])/x,o[2]=(s[2]*c+s[6]*f+s[10]*g+s[14])/x,o}function dn(o,e,s){var c=s[0],f=s[1],g=s[2],x=e[0],C=e[1],M=e[2],P=f*M-g*C,j=g*x-c*M,$=c*C-f*x,W=f*$-g*j,Y=g*P-c*$,ee=c*j-f*P,oe=2*s[3];return j*=oe,$*=oe,Y*=2,ee*=2,o[0]=x+(P*=oe)+(W*=2),o[1]=C+j+Y,o[2]=M+$+ee,o}var Mn,Gn=vn,ur=lr,Nr=Ze;function Ho(o,e,s){return o[0]=e[0]*s,o[1]=e[1]*s,o[2]=e[2]*s,o[3]=e[3]*s,o}function Ur(o,e){var s=e[0],c=e[1],f=e[2],g=e[3],x=s*s+c*c+f*f+g*g;return x>0&&(x=1/Math.sqrt(x)),o[0]=s*x,o[1]=c*x,o[2]=f*x,o[3]=g*x,o}function sa(o,e,s){var c=e[0],f=e[1],g=e[2],x=e[3];return o[0]=s[0]*c+s[4]*f+s[8]*g+s[12]*x,o[1]=s[1]*c+s[5]*f+s[9]*g+s[13]*x,o[2]=s[2]*c+s[6]*f+s[10]*g+s[14]*x,o[3]=s[3]*c+s[7]*f+s[11]*g+s[15]*x,o}function eg(){var o=new oa(4);return oa!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Lx(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Bx(o,e,s){s*=.5;var c=e[0],f=e[1],g=e[2],x=e[3],C=Math.sin(s),M=Math.cos(s);return o[0]=c*M+x*C,o[1]=f*M+g*C,o[2]=g*M-f*C,o[3]=x*M-c*C,o}function Rx(o,e,s){s*=.5;var c=e[0],f=e[1],g=e[2],x=e[3],C=Math.sin(s),M=Math.cos(s);return o[0]=c*M-g*C,o[1]=f*M+x*C,o[2]=g*M+c*C,o[3]=x*M-f*C,o}re(),Mn=new oa(4),oa!=Float32Array&&(Mn[0]=0,Mn[1]=0,Mn[2]=0,Mn[3]=0);var cP=Ur;re(),vt(1,0,0),vt(0,1,0),eg(),eg(),Sp();const uP=$e([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Dx}=uP,Ox=$e([{name:"a_pos_3",components:3,type:"Int16"}]);var Ip=$e([{name:"a_pos",type:"Int16",components:2}]);class cy{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,c){const f=lt(s,this.dir);if(Math.abs(f)<1e-6)return!1;const g=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1]+(e[2]-this.pos[2])*s[2])/f;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,s,c){if(function(Y,ee){var oe=Y[0],de=Y[1],ve=Y[2],Le=ee[0],xe=ee[1],Me=ee[2];return Math.abs(oe-Le)<=Mh*Math.max(1,Math.abs(oe),Math.abs(Le))&&Math.abs(de-xe)<=Mh*Math.max(1,Math.abs(de),Math.abs(xe))&&Math.abs(ve-Me)<=Mh*Math.max(1,Math.abs(ve),Math.abs(Me))}(this.pos,e)||s===0)return c[0]=c[1]=c[2]=0,!1;const[f,g,x]=this.dir,C=this.pos[0]-e[0],M=this.pos[1]-e[1],P=this.pos[2]-e[2],j=f*f+g*g+x*x,$=2*(C*f+M*g+P*x),W=$*$-4*j*(C*C+M*M+P*P-s*s);if(W<0){const Y=Math.max(-$/2,0),ee=C+f*Y,oe=M+g*Y,de=P+x*Y,ve=Math.hypot(ee,oe,de);return c[0]=ee*s/ve,c[1]=oe*s/ve,c[2]=de*s/ve,!1}{const Y=(-$-Math.sqrt(W))/(2*j);if(Y<0){const ee=Math.hypot(C,M,P);return c[0]=C*s/ee,c[1]=M*s/ee,c[2]=P*s/ee,!1}return c[0]=C+f*Y,c[1]=M+g*Y,c[2]=P+x*Y,!0}}}class uy{constructor(e,s,c,f,g){this.TL=e,this.TR=s,this.BR=c,this.BL=f,this.horizon=g}static fromInvProjectionMatrix(e,s,c){const f=[-1,1,1],g=[1,1,1],x=[1,-1,1],C=[-1,-1,1],M=ut(f,f,e),P=ut(g,g,e),j=ut(x,x,e),$=ut(C,C,e);return new uy(M,P,j,$,s/c)}}class hy{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,c,f){const g=Math.pow(2,c),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const P=sa([],M,e),j=1/P[3]/s*g;return function($,W,Y){return $[0]=W[0]*Y[0],$[1]=W[1]*Y[1],$[2]=W[2]*Y[2],$[3]=W[3]*Y[3],$}(P,P,[j,j,f?1/P[3]:j,j])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const P=Ei([],Ye([],Gn([],x[M[0]],x[M[1]]),Gn([],x[M[2]],x[M[1]]))),j=-lt(P,x[M[1]]);return P.concat(j)});return new hy(x,C)}}class aa{static fromPoints(e){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const f of e)Dn(s,s,f),Kr(c,c,f);return new aa(s,c)}static applyTransform(e,s){const c=e.getCorners();for(let f=0;f<c.length;++f)ut(c[f],c[f],s);return aa.fromPoints(c)}constructor(e,s){this.min=e,this.max=s,this.center=pn([],Nt([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],c=Ie(this.min),f=Ie(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],f[g]=s[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new aa(c,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){const s=this.getCorners();let c=!0;for(let f=0;f<e.planes.length;f++){const g=e.planes[f];let x=0;for(let C=0;C<s.length;C++)x+=lt(g,s[C])+g[3]>=0;if(x===0)return 0;x!==s.length&&(c=!1)}if(c)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let C=0;C<e.points.length;C++){const M=e.points[C][f]-this.min[f];g=Math.min(g,M),x=Math.max(x,M)}if(x<0||g>this.max[f]-this.min[f])return 0}return 1}}const dy=5,kx=6,lu=_n/Math.PI/2,hP=16383,ud=64,Pp=[ud,32,16],Yl=-lu,Ql=lu,dP=[new aa([Yl,Yl,Yl],[Ql,Ql,Ql]),new aa([Yl,Yl,Yl],[0,0,Ql]),new aa([0,Yl,Yl],[Ql,0,Ql]),new aa([Yl,0,Yl],[0,Ql,Ql]),new aa([0,0,Yl],[Ql,Ql,Ql])];function tg(o){return o*lu/Rp}function zx(o,e,s,c=!0){const f=pn([],o._camera.position,o.worldSize),g=[e,s,1,1];sa(g,g,o.pixelMatrixInverse),Ho(g,g,1/g[3]);const x=Ei([],Gn([],g,f)),C=o.globeMatrix,M=[C[12],C[13],C[14]],P=Gn([],M,f),j=Ze(P),$=Ei([],P),W=o.worldSize/(2*Math.PI),Y=lt($,x),ee=Math.asin(W/j);if(ee<Math.acos(Y)){if(!c)return null;const Ot=[],ct=[];pn(Ot,x,j/Y),Ei(ct,Gn(ct,Ot,P)),Ei(x,Nt(x,P,pn(x,ct,Math.tan(ee)*j)))}const oe=[];new cy(f,x).closestPointOnSphere(M,W,oe);const de=Ei([],xn(C,0)),ve=Ei([],xn(C,1)),Le=Ei([],xn(C,2)),xe=lt(de,oe),Me=lt(ve,oe),Oe=lt(Le,oe),Re=Bt(Math.asin(-Me/W));let ot=Bt(Math.atan2(xe,Oe));ot=o.center.lng+function(Ot,ct){const Ct=(ct-Ot+180)%360-180;return Ct<-180?Ct+360:Ct}(o.center.lng,ot);const nt=uu(ot),pt=bt(hu(Re),0,1);return new of(nt,pt)}class fP{constructor(e,s,c){this.a=Gn([],e,c),this.b=Gn([],s,c),this.center=c;const f=Ei([],this.a),g=Ei([],this.b);this.angle=Math.acos(lt(f,g))}}function fy(o,e){if(o.angle===0)return null;let s;return s=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,f,g,x){const C=Math.sin(g);return c*(Math.sin((1-x)*g)/C)+f*(Math.sin(x*g)/C)}(o.a[e],o.b[e],o.angle,bt(s,0,1))+o.center[e]}function cu(o){if(o.z<=1)return dP[o.z+2*o.y+o.x];const e=py(ng(o));return aa.fromPoints(e)}function hd(o,e,s){return pn(o,o,1-s),Po(o,o,e,s)}function Fx(o,e){const s=rf(e.zoom);if(s===0)return cu(o);const c=ng(o),f=py(c),g=uu(c.getWest())*e.worldSize,x=uu(c.getEast())*e.worldSize,C=hu(c.getNorth())*e.worldSize,M=hu(c.getSouth())*e.worldSize,P=[g,C,0],j=[x,C,0],$=[g,M,0],W=[x,M,0],Y=ef([],e.globeMatrix);return ut(P,P,Y),ut(j,j,Y),ut($,$,Y),ut(W,W,Y),f[0]=hd(f[0],$,s),f[1]=hd(f[1],W,s),f[2]=hd(f[2],j,s),f[3]=hd(f[3],P,s),aa.fromPoints(f)}function jx(o,e,s){for(const c of o)ut(c,c,e),pn(c,c,s)}function pP(o,e,s){const c=e/o.worldSize,f=o.globeMatrix;if(s.z<=1){const nt=cu(s).getCorners();return jx(nt,f,c),aa.fromPoints(nt)}const g=ng(s),x=py(g);jx(x,f,c);const C=Number.MAX_VALUE,M=[-C,-C,-C],P=[C,C,C];if(g.contains(o.center)){for(const Ot of x)Dn(P,P,Ot),Kr(M,M,Ot);M[2]=0;const nt=o.point,pt=[nt.x*c,nt.y*c,0];return Dn(P,P,pt),Kr(M,M,pt),new aa(P,M)}const j=[f[12]*c,f[13]*c,f[14]*c],$=g.getCenter(),W=bt(o.center.lat,-Ps,Ps),Y=bt($.lat,-Ps,Ps),ee=uu(o.center.lng),oe=hu(W);let de=ee-uu($.lng);const ve=oe-hu(Y);de>.5?de-=1:de<-.5&&(de+=1);let Le=0;Math.abs(de)>Math.abs(ve)?Le=de>=0?1:3:(Le=ve>=0?0:2,Po(j,j,[f[4]*c,f[5]*c,f[6]*c],-Math.sin(_t(ve>=0?g.getSouth():g.getNorth()))*lu));const xe=x[Le],Me=x[(Le+1)%4],Oe=new fP(xe,Me,j),Re=[fy(Oe,0)||xe[0],fy(Oe,1)||xe[1],fy(Oe,2)||xe[2]],ot=rf(o.zoom);if(ot>0){const nt=function({x:Ot,y:ct,z:Ct},At,Mt,kt,ft){const Qt=1/(1<<Ct);let ln=Ot*Qt,tn=ln+Qt,Hn=ct*Qt,zt=Hn+Qt,bn=0;const Wn=(ln+tn)/2-kt;return Wn>.5?bn=-1:Wn<-.5&&(bn=1),ln=((ln+bn)*At-(kt*=At))*Mt+kt,tn=((tn+bn)*At-kt)*Mt+kt,Hn=(Hn*At-(ft*=At))*Mt+ft,zt=(zt*At-ft)*Mt+ft,[[ln,zt,0],[tn,zt,0],[tn,Hn,0],[ln,Hn,0]]}(s,e,o._pixelsPerMercatorPixel,ee,oe);for(let Ot=0;Ot<x.length;Ot++)hd(x[Ot],nt[Ot],ot);const pt=Nt([],nt[Le],nt[(Le+1)%4]);pn(pt,pt,.5),hd(Re,pt,ot)}for(const nt of x)Dn(P,P,nt),Kr(M,M,nt);return P[2]=Math.min(xe[2],Me[2]),Dn(P,P,Re),Kr(M,M,Re),new aa(P,M)}function ng({x:o,y:e,z:s}){const c=1/(1<<s),f=new ri(Il(o*c),Is((e+1)*c)),g=new ri(Il((o+1)*c),Is(e*c));return new Jl(f,g)}function py(o){const e=_t(o.getNorth()),s=_t(o.getSouth()),c=Math.cos(e),f=Math.cos(s),g=Math.sin(e),x=Math.sin(s),C=o.getWest(),M=o.getEast();return[tf(f,x,C),tf(f,x,M),tf(c,g,M),tf(c,g,C)]}function tf(o,e,s,c=lu){return s=_t(s),[o*Math.sin(s)*c,-e*c,o*Math.cos(s)*c]}function nf(o,e,s){return tf(Math.cos(_t(o)),Math.sin(_t(o)),e,s)}function Lp(o,e,s,c){const f=1<<s.z,g=(o/_n+s.x)/f;return nf(Is((e/_n+s.y)/f),Il(g),c)}function rg({min:o,max:e}){return hP/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const Ux=new Float64Array(16);function Bp(o){const e=rg(o),s=L(Ux,[e,e,e]);return cd(s,s,((c=[])[0]=-(f=o.min)[0],c[1]=-f[1],c[2]=-f[2],c));var c,f}function my(o){const e=(c=o.min,(s=Ux)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=c[0],s[13]=c[1],s[14]=c[2],s[15]=1,s);var s,c;const f=1/rg(o);return qu(e,e,[f,f,f])}function Nx(o,e,s,c,f){const g=function(M){const P=_n/(2*Math.PI);return M/(2*Math.PI)/P}(s),x=[o,e,-s/(2*Math.PI)],C=ll(new Float64Array(16));return cd(C,C,x),qu(C,C,[g,g,g]),_(C,C,_t(-f)),v(C,C,_t(-c)),C}function rf(o){return $t(dy,kx,o)}function Gx(o,e){const s=nf(e.lat,e.lng),c=function(ee){const oe=nf(ee._center.lat,ee._center.lng);let de=Ye([],vt(0,1,0),oe);const ve=F([],-ee.angle,oe);de=ut(de,de,ve),F(ve,-ee._pitch,de);const Le=Ei([],oe);return pn(Le,Le,tg(ee.cameraToCenterDistance/ee.pixelsPerMeter)),ut(Le,Le,ve),Nt([],oe,Le)}(o);return x=(f=vn([],c,s))[0],C=f[1],M=f[2],P=(g=s)[0],j=g[1],$=g[2],Y=(W=Math.sqrt(x*x+C*C+M*M)*Math.sqrt(P*P+j*j+$*$))&&lt(f,g)/W,Math.acos(Math.min(Math.max(Y,-1),1));var f,g,x,C,M,P,j,$,W,Y}function gy(o,e){return Gx(o,e)>Math.PI/2*1.01}const Vx=_t(85),mP=Math.cos(Vx),gP=Math.sin(Vx),Rp=63710088e-1,$x=2*Math.PI*Rp;class Ih{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ih(Zt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,c=this.lat*s,f=e.lat*s,g=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((e.lng-this.lng)*s);return Rp*Math.acos(Math.min(g,1))}toBounds(e=0){const s=360*e/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Jl(new Ih(this.lng-c,this.lat-s),new Ih(this.lng+c,this.lat+s))}toEcef(e){const s=tg(e);return nf(this.lat,this.lng,lu+s)}static convert(e){if(e instanceof Ih)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ih(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ih(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var ri=Ih;function _y(o){return $x*Math.cos(o*Math.PI/180)}function uu(o){return(180+o)/360}function hu(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Lc(o,e){return o/_y(e)}function Il(o){return 360*o-180}function Is(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Hx(o,e){return o*_y(Is(e))}const Ps=85.051129;function Wx(o){return 1/Math.cos(o*Math.PI/180)}class of{constructor(e,s,c=0){this.x=+e,this.y=+s,this.z=+c}static fromLngLat(e,s=0){const c=ri.convert(e);return new of(uu(c.lng),hu(c.lat),Lc(s,c.lat))}toLngLat(){return new ri(Il(this.x),Is(this.y))}toAltitude(){return Hx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$x*Wx(Is(this.y))}}function yy(o,e,s,c,f,g,x,C,M){const P=(e+c)/2,j=(s+f)/2,$=new me(P,j);C($),function(W,Y,ee,oe,de,ve){const Le=ee-de,xe=oe-ve;return Math.abs((oe-Y)*Le-(ee-W)*xe)/Math.hypot(Le,xe)}($.x,$.y,g.x,g.y,x.x,x.y)>=M?(yy(o,e,s,P,j,g,$,C,M),yy(o,P,j,c,f,$,x,C,M)):o.push(x)}function Zx(o,e,s){let c=o[0],f=c.x,g=c.y;e(c);const x=[c];for(let C=1;C<o.length;C++){const M=o[C],{x:P,y:j}=M;e(M),yy(x,f,g,P,j,c,M,e,s),f=P,g=j,c=M}return x}function vy(o,e,s,c){if(c(e,s)){const f=e.add(s)._mult(.5);vy(o,e,f,c),vy(o,f,s,c)}else o.push(s)}function _P(o,e){let s=o[0];const c=[s];for(let f=1;f<o.length;f++){const g=o[f];vy(c,s,g,e),s=g}return c}const xy=Math.pow(2,14)-1,Xx=-xy-1;function yP(o,e){const s=Math.round(o.x*e),c=Math.round(o.y*e);return o.x=bt(s,Xx,xy),o.y=bt(c,Xx,xy),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&wn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ku(o,e,s){const c=o.loadGeometry(),f=o.extent,g=_n/f;if(e&&s&&s.projection.isReprojectedInTileSpace){const x=1<<e.z,{scale:C,x:M,y:P,projection:j}=s,$=W=>{const Y=Il((e.x+W.x/f)/x),ee=Is((e.y+W.y/f)/x),oe=j.project(Y,ee);W.x=(oe.x*C-M)*f,W.y=(oe.y*C-P)*f};for(let W=0;W<c.length;W++)if(o.type!==1)c[W]=Zx(c[W],$,1);else{const Y=[];for(const ee of c[W])ee.x<0||ee.x>=f||ee.y<0||ee.y>=f||($(ee),Y.push(ee));c[W]=Y}}for(const x of c)for(const C of x)yP(C,g);return c}function dd(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?Ku(o):[]}}function ig(o,e,s,c,f){o.emplaceBack(2*e+(c+1)/2,2*s+(f+1)/2)}function og(o,e,s){o.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class by{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Pt,this.indexArray=new un,this.segments=new fi,this.programConfigurations=new Xu(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c,f){const g=this.layers[0],x=[];let C=null;g.type==="circle"&&(C=g.layout.get("circle-sort-key"));for(const{feature:P,id:j,index:$,sourceLayerIndex:W}of e){const Y=this.layers[0]._featureFilter.needGeometry,ee=dd(P,Y);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),ee,c))continue;const oe=C?C.evaluate(ee,{},c):void 0,de={id:j,properties:P.properties,type:P.type,sourceLayerIndex:W,index:$,geometry:Y?ee.geometry:Ku(P,c,f),patterns:{},sortKey:oe};x.push(de)}C&&x.sort((P,j)=>P.sortKey-j.sortKey);let M=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new xt,M=f.projection);for(const P of x){const{geometry:j,index:$,sourceLayerIndex:W}=P,Y=e[$].feature;this.addFeature(P,j,$,s.availableImages,c,M),s.featureIndex.insert(Y,j,$,W,this.index)}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,au.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Qd.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,s,c,f,g,x){for(const C of s)for(const M of C){const P=M.x,j=M.y;if(P<0||P>=_n||j<0||j>=_n)continue;if(x){const Y=x.projectTilePoint(P,j,g),ee=x.upVector(g,P,j),oe=this.globeExtVertexArray;og(oe,Y,ee),og(oe,Y,ee),og(oe,Y,ee),og(oe,Y,ee)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),W=$.vertexLength;ig(this.layoutVertexArray,P,j,-1,-1),ig(this.layoutVertexArray,P,j,1,-1),ig(this.layoutVertexArray,P,j,1,1),ig(this.layoutVertexArray,P,j,-1,1),this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},f,g)}}function qx(o,e){for(let s=0;s<o.length;s++)if(fd(e,o[s]))return!0;for(let s=0;s<e.length;s++)if(fd(o,e[s]))return!0;return!!wy(o,e)}function vP(o,e,s){return!!fd(o,e)||!!Ey(e,o,s)}function Kx(o,e){if(o.length===1)return Yx(e,o[0]);for(let s=0;s<e.length;s++){const c=e[s];for(let f=0;f<c.length;f++)if(fd(o,c[f]))return!0}for(let s=0;s<o.length;s++)if(Yx(e,o[s]))return!0;for(let s=0;s<e.length;s++)if(wy(o,e[s]))return!0;return!1}function xP(o,e,s){if(o.length>1){if(wy(o,e))return!0;for(let c=0;c<e.length;c++)if(Ey(e[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Ey(o[c],e,s))return!0;return!1}function wy(o,e){if(o.length===0||e.length===0)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],f=o[s+1];for(let g=0;g<e.length-1;g++)if(bP(c,f,e[g],e[g+1]))return!0}return!1}function bP(o,e,s,c){return ki(o,s,c)!==ki(e,s,c)&&ki(o,e,s)!==ki(o,e,c)}function Ey(o,e,s){const c=s*s;if(e.length===1)return o.distSqr(e[0])<c;for(let f=1;f<e.length;f++)if(Jx(o,e[f-1],e[f])<c)return!0;return!1}function Jx(o,e,s){const c=e.distSqr(s);if(c===0)return o.distSqr(e);const f=((o.x-e.x)*(s.x-e.x)+(o.y-e.y)*(s.y-e.y))/c;return o.distSqr(f<0?e:f>1?s:s.sub(e)._mult(f)._add(e))}function Yx(o,e){let s,c,f,g=!1;for(let x=0;x<o.length;x++){s=o[x];for(let C=0,M=s.length-1;C<s.length;M=C++)c=s[C],f=s[M],c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(g=!g)}return g}function fd(o,e){let s=!1;for(let c=0,f=o.length-1;c<o.length;f=c++){const g=o[c],x=o[f];g.y>e.y!=x.y>e.y&&e.x<(x.x-g.x)*(e.y-g.y)/(x.y-g.y)+g.x&&(s=!s)}return s}function Qx(o,e,s,c,f){for(const x of o)if(e<=x.x&&s<=x.y&&c>=x.x&&f>=x.y)return!0;const g=[new me(e,s),new me(e,f),new me(c,f),new me(c,s)];if(o.length>2){for(const x of g)if(fd(o,x))return!0}for(let x=0;x<o.length-1;x++)if(wP(o[x],o[x+1],g))return!0;return!1}function wP(o,e,s){const c=s[0],f=s[2];if(o.x<c.x&&e.x<c.x||o.x>f.x&&e.x>f.x||o.y<c.y&&e.y<c.y||o.y>f.y&&e.y>f.y)return!1;const g=ki(o,e,s[0]);return g!==ki(o,e,s[1])||g!==ki(o,e,s[2])||g!==ki(o,e,s[3])}function sf(o,e,s){const c=e.paint.get(o).value;return c.kind==="constant"?c.value:s.programConfigurations.get(e.id).getMaxValue(o)}function sg(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function eb(o,e,s,c,f){if(!e[0]&&!e[1])return o;const g=me.convert(e)._mult(f);s==="viewport"&&g._rotate(-c);const x=[];for(let C=0;C<o.length;C++)x.push(o[C].sub(g));return x}function tb(o,e,s,c){const f=me.convert(o)._mult(c);return e==="viewport"&&f._rotate(-s),f}on(by,"CircleBucket",{omit:["layers"]});const EP=new Ee({"circle-sort-key":new pe(et.layout_circle["circle-sort-key"])});var CP={paint:new Ee({"circle-radius":new pe(et.paint_circle["circle-radius"]),"circle-color":new pe(et.paint_circle["circle-color"]),"circle-blur":new pe(et.paint_circle["circle-blur"]),"circle-opacity":new pe(et.paint_circle["circle-opacity"]),"circle-translate":new ie(et.paint_circle["circle-translate"]),"circle-translate-anchor":new ie(et.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ie(et.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ie(et.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pe(et.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pe(et.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pe(et.paint_circle["circle-stroke-opacity"])}),layout:EP};function nb(o,e,s,c,f,g,x,C,M){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(M*=o.pixelToTileUnitsFactor);const P=o.tileID.canonical,j=s.projection.upVectorScale(P,s.center.lat,s.worldSize).metersToTile;for(const $ of e)for(const W of $){const Y=W.add(C),ee=f&&s.elevation?s.elevation.exaggeration()*f.getElevationAt(Y.x,Y.y,!0):0,oe=s.projection.projectTilePoint(Y.x,Y.y,P);if(ee>0){const xe=s.projection.upVector(P,Y.x,Y.y);oe.x+=xe[0]*j*ee,oe.y+=xe[1]*j*ee,oe.z+=xe[2]*j*ee}const de=g?Y:AP(oe.x,oe.y,oe.z,c),ve=g?o.tilespaceRays.map(xe=>SP(xe,ee)):o.queryGeometry.screenGeometry,Le=sa([],[oe.x,oe.y,oe.z,1],c);if(!x&&g?M*=Le[3]/s.cameraToCenterDistance:x&&!g&&(M*=s.cameraToCenterDistance/Le[3]),g){const xe=Is((W.y/_n+P.y)/(1<<P.z));M/=s.projection.pixelsPerMeter(xe,1)/Lc(1,xe)}if(vP(ve,de,M))return!0}return!1}function AP(o,e,s,c){const f=sa([],[o,e,s,1],c);return new me(f[0]/f[3],f[1]/f[3])}const rb=vt(0,0,0),TP=vt(0,0,1);function SP(o,e){const s=re();return rb[2]=e,o.intersectsPlane(rb,TP,s),new me(s[0],s[1])}class ib extends by{}function ob(o,{width:e,height:s},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*s*c)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*s*c);return o.width=e,o.height=s,o.data=f,o}function sb(o,e,s){const{width:c,height:f}=e;c===o.width&&f===o.height||(Cy(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,f)},s),o.width=c,o.height=f,o.data=e.data)}function Cy(o,e,s,c,f,g){if(f.width===0||f.height===0)return e;if(f.width>o.width||f.height>o.height||s.x>o.width-f.width||s.y>o.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||c.x>e.width-f.width||c.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=o.data,C=e.data;for(let M=0;M<f.height;M++){const P=((s.y+M)*o.width+s.x)*g,j=((c.y+M)*e.width+c.x)*g;for(let $=0;$<f.width*g;$++)C[j+$]=x[P+$]}return e}on(ib,"HeatmapBucket",{omit:["layers"]});class Ju{constructor(e,s){ob(this,e,1,s)}resize(e){sb(this,new Ju(e),1)}clone(){return new Ju({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,f,g){Cy(e,s,c,f,g,1)}}class cl{constructor(e,s){ob(this,e,4,s)}resize(e){sb(this,new cl(e),4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,f,g){Cy(e,s,c,f,g,4)}}on(Ju,"AlphaImage"),on(cl,"RGBAImage");var MP={paint:new Ee({"heatmap-radius":new pe(et.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pe(et.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ie(et.paint_heatmap["heatmap-intensity"]),"heatmap-color":new we(et.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ie(et.paint_heatmap["heatmap-opacity"])})};function Ay(o){const e={},s=o.resolution||256,c=o.clips?o.clips.length:1,f=o.image||new cl({width:s,height:c}),g=(x,C,M)=>{e[o.evaluationKey]=M;const P=o.expression.evaluate(e);f.data[x+C+0]=Math.floor(255*P.r/P.a),f.data[x+C+1]=Math.floor(255*P.g/P.a),f.data[x+C+2]=Math.floor(255*P.b/P.a),f.data[x+C+3]=Math.floor(255*P.a)};if(o.clips)for(let x=0,C=0;x<c;++x,C+=4*s)for(let M=0,P=0;M<s;M++,P+=4){const j=M/(s-1),{start:$,end:W}=o.clips[x];g(C,P,$*(1-j)+W*j)}else for(let x=0,C=0;x<s;x++,C+=4)g(0,C,x/(s-1));return f}var IP={paint:new Ee({"hillshade-illumination-direction":new ie(et.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ie(et.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ie(et.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ie(et.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ie(et.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ie(et.paint_hillshade["hillshade-accent-color"])})};const PP=$e([{name:"a_pos",components:2,type:"Int16"}],4),{members:LP}=PP;var Ty={exports:{}};function ag(o,e,s){s=s||2;var c,f,g,x,C,M,P,j=e&&e.length,$=j?e[0]*s:o.length,W=ab(o,0,$,s,!0),Y=[];if(!W||W.next===W.prev)return Y;if(j&&(W=function(oe,de,ve,Le){var xe,Me,Oe,Re=[];for(xe=0,Me=de.length;xe<Me;xe++)(Oe=ab(oe,de[xe]*Le,xe<Me-1?de[xe+1]*Le:oe.length,Le,!1))===Oe.next&&(Oe.steiner=!0),Re.push(jP(Oe));for(Re.sort(kP),xe=0;xe<Re.length;xe++)ve=zP(Re[xe],ve);return ve}(o,e,W,s)),o.length>80*s){c=g=o[0],f=x=o[1];for(var ee=s;ee<$;ee+=s)(C=o[ee])<c&&(c=C),(M=o[ee+1])<f&&(f=M),C>g&&(g=C),M>x&&(x=M);P=(P=Math.max(g-c,x-f))!==0?32767/P:0}return Dp(W,Y,s,c,f,P,0),Y}function ab(o,e,s,c,f){var g,x;if(f===Iy(o,e,s,c)>0)for(g=e;g<s;g+=c)x=ub(g,o[g],o[g+1],x);else for(g=s-c;g>=e;g-=c)x=ub(g,o[g],o[g+1],x);return x&&lg(x,x.next)&&(kp(x),x=x.next),x}function pd(o,e){if(!o)return o;e||(e=o);var s,c=o;do if(s=!1,c.steiner||!lg(c,c.next)&&uo(c.prev,c,c.next)!==0)c=c.next;else{if(kp(c),(c=e=c.prev)===c.next)break;s=!0}while(s||c!==e);return e}function Dp(o,e,s,c,f,g,x){if(o){!x&&g&&function(j,$,W,Y){var ee=j;do ee.z===0&&(ee.z=Sy(ee.x,ee.y,$,W,Y)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==j);ee.prevZ.nextZ=null,ee.prevZ=null,function(oe){var de,ve,Le,xe,Me,Oe,Re,ot,nt=1;do{for(ve=oe,oe=null,Me=null,Oe=0;ve;){for(Oe++,Le=ve,Re=0,de=0;de<nt&&(Re++,Le=Le.nextZ);de++);for(ot=nt;Re>0||ot>0&&Le;)Re!==0&&(ot===0||!Le||ve.z<=Le.z)?(xe=ve,ve=ve.nextZ,Re--):(xe=Le,Le=Le.nextZ,ot--),Me?Me.nextZ=xe:oe=xe,xe.prevZ=Me,Me=xe;ve=Le}Me.nextZ=null,nt*=2}while(Oe>1)}(ee)}(o,c,f,g);for(var C,M,P=o;o.prev!==o.next;)if(C=o.prev,M=o.next,g?RP(o,c,f,g):BP(o))e.push(C.i/s|0),e.push(o.i/s|0),e.push(M.i/s|0),kp(o),o=M.next,P=M.next;else if((o=M)===P){x?x===1?Dp(o=DP(pd(o),e,s),e,s,c,f,g,2):x===2&&OP(o,e,s,c,f,g):Dp(pd(o),e,s,c,f,g,1);break}}}function BP(o){var e=o.prev,s=o,c=o.next;if(uo(e,s,c)>=0)return!1;for(var f=e.x,g=s.x,x=c.x,C=e.y,M=s.y,P=c.y,j=f<g?f<x?f:x:g<x?g:x,$=C<M?C<P?C:P:M<P?M:P,W=f>g?f>x?f:x:g>x?g:x,Y=C>M?C>P?C:P:M>P?M:P,ee=c.next;ee!==e;){if(ee.x>=j&&ee.x<=W&&ee.y>=$&&ee.y<=Y&&af(f,C,g,M,x,P,ee.x,ee.y)&&uo(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function RP(o,e,s,c){var f=o.prev,g=o,x=o.next;if(uo(f,g,x)>=0)return!1;for(var C=f.x,M=g.x,P=x.x,j=f.y,$=g.y,W=x.y,Y=C<M?C<P?C:P:M<P?M:P,ee=j<$?j<W?j:W:$<W?$:W,oe=C>M?C>P?C:P:M>P?M:P,de=j>$?j>W?j:W:$>W?$:W,ve=Sy(Y,ee,e,s,c),Le=Sy(oe,de,e,s,c),xe=o.prevZ,Me=o.nextZ;xe&&xe.z>=ve&&Me&&Me.z<=Le;){if(xe.x>=Y&&xe.x<=oe&&xe.y>=ee&&xe.y<=de&&xe!==f&&xe!==x&&af(C,j,M,$,P,W,xe.x,xe.y)&&uo(xe.prev,xe,xe.next)>=0||(xe=xe.prevZ,Me.x>=Y&&Me.x<=oe&&Me.y>=ee&&Me.y<=de&&Me!==f&&Me!==x&&af(C,j,M,$,P,W,Me.x,Me.y)&&uo(Me.prev,Me,Me.next)>=0))return!1;Me=Me.nextZ}for(;xe&&xe.z>=ve;){if(xe.x>=Y&&xe.x<=oe&&xe.y>=ee&&xe.y<=de&&xe!==f&&xe!==x&&af(C,j,M,$,P,W,xe.x,xe.y)&&uo(xe.prev,xe,xe.next)>=0)return!1;xe=xe.prevZ}for(;Me&&Me.z<=Le;){if(Me.x>=Y&&Me.x<=oe&&Me.y>=ee&&Me.y<=de&&Me!==f&&Me!==x&&af(C,j,M,$,P,W,Me.x,Me.y)&&uo(Me.prev,Me,Me.next)>=0)return!1;Me=Me.nextZ}return!0}function DP(o,e,s){var c=o;do{var f=c.prev,g=c.next.next;!lg(f,g)&&lb(f,c,c.next,g)&&Op(f,g)&&Op(g,f)&&(e.push(f.i/s|0),e.push(c.i/s|0),e.push(g.i/s|0),kp(c),kp(c.next),c=o=g),c=c.next}while(c!==o);return pd(c)}function OP(o,e,s,c,f,g){var x=o;do{for(var C=x.next.next;C!==x.prev;){if(x.i!==C.i&&UP(x,C)){var M=cb(x,C);return x=pd(x,x.next),M=pd(M,M.next),Dp(x,e,s,c,f,g,0),void Dp(M,e,s,c,f,g,0)}C=C.next}x=x.next}while(x!==o)}function kP(o,e){return o.x-e.x}function zP(o,e){var s=function(f,g){var x,C=g,M=f.x,P=f.y,j=-1/0;do{if(P<=C.y&&P>=C.next.y&&C.next.y!==C.y){var $=C.x+(P-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if($<=M&&$>j&&(j=$,x=C.x<C.next.x?C:C.next,$===M))return x}C=C.next}while(C!==g);if(!x)return null;var W,Y=x,ee=x.x,oe=x.y,de=1/0;C=x;do M>=C.x&&C.x>=ee&&M!==C.x&&af(P<oe?M:j,P,ee,oe,P<oe?j:M,P,C.x,C.y)&&(W=Math.abs(P-C.y)/(M-C.x),Op(C,f)&&(W<de||W===de&&(C.x>x.x||C.x===x.x&&FP(x,C)))&&(x=C,de=W)),C=C.next;while(C!==Y);return x}(o,e);if(!s)return e;var c=cb(s,o);return pd(c,c.next),pd(s,s.next)}function FP(o,e){return uo(o.prev,o,e.prev)<0&&uo(e.next,o,o.next)<0}function Sy(o,e,s,c,f){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jP(o){var e=o,s=o;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==o);return s}function af(o,e,s,c,f,g,x,C){return(f-x)*(e-C)>=(o-x)*(g-C)&&(o-x)*(c-C)>=(s-x)*(e-C)&&(s-x)*(g-C)>=(f-x)*(c-C)}function UP(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(s,c){var f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==c.i&&f.next.i!==c.i&&lb(f,f.next,s,c))return!0;f=f.next}while(f!==s);return!1}(o,e)&&(Op(o,e)&&Op(e,o)&&function(s,c){var f=s,g=!1,x=(s.x+c.x)/2,C=(s.y+c.y)/2;do f.y>C!=f.next.y>C&&f.next.y!==f.y&&x<(f.next.x-f.x)*(C-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next;while(f!==s);return g}(o,e)&&(uo(o.prev,o,e.prev)||uo(o,e.prev,e))||lg(o,e)&&uo(o.prev,o,o.next)>0&&uo(e.prev,e,e.next)>0)}function uo(o,e,s){return(e.y-o.y)*(s.x-e.x)-(e.x-o.x)*(s.y-e.y)}function lg(o,e){return o.x===e.x&&o.y===e.y}function lb(o,e,s,c){var f=ug(uo(o,e,s)),g=ug(uo(o,e,c)),x=ug(uo(s,c,o)),C=ug(uo(s,c,e));return f!==g&&x!==C||!(f!==0||!cg(o,s,e))||!(g!==0||!cg(o,c,e))||!(x!==0||!cg(s,o,c))||!(C!==0||!cg(s,e,c))}function cg(o,e,s){return e.x<=Math.max(o.x,s.x)&&e.x>=Math.min(o.x,s.x)&&e.y<=Math.max(o.y,s.y)&&e.y>=Math.min(o.y,s.y)}function ug(o){return o>0?1:o<0?-1:0}function Op(o,e){return uo(o.prev,o,o.next)<0?uo(o,e,o.next)>=0&&uo(o,o.prev,e)>=0:uo(o,e,o.prev)<0||uo(o,o.next,e)<0}function cb(o,e){var s=new My(o.i,o.x,o.y),c=new My(e.i,e.x,e.y),f=o.next,g=e.prev;return o.next=e,e.prev=o,s.next=f,f.prev=s,c.next=s,s.prev=c,g.next=c,c.prev=g,c}function ub(o,e,s,c){var f=new My(o,e,s);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function kp(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function My(o,e,s){this.i=o,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Iy(o,e,s,c){for(var f=0,g=e,x=s-c;g<s;g+=c)f+=(o[x]-o[g])*(o[g+1]+o[x+1]),x=g;return f}Ty.exports=ag,Ty.exports.default=ag,ag.deviation=function(o,e,s,c){var f=e&&e.length,g=Math.abs(Iy(o,0,f?e[0]*s:o.length,s));if(f)for(var x=0,C=e.length;x<C;x++)g-=Math.abs(Iy(o,e[x]*s,x<C-1?e[x+1]*s:o.length,s));var M=0;for(x=0;x<c.length;x+=3){var P=c[x]*s,j=c[x+1]*s,$=c[x+2]*s;M+=Math.abs((o[P]-o[$])*(o[j+1]-o[P+1])-(o[P]-o[j])*(o[$+1]-o[P+1]))}return g===0&&M===0?0:Math.abs((M-g)/g)},ag.flatten=function(o){for(var e=o[0][0].length,s={vertices:[],holes:[],dimensions:e},c=0,f=0;f<o.length;f++){for(var g=0;g<o[f].length;g++)for(var x=0;x<e;x++)s.vertices.push(o[f][g][x]);f>0&&s.holes.push(c+=o[f-1].length)}return s};var Py=te(Ty.exports);function NP(o,e,s,c,f){hb(o,e,s,c||o.length-1,f||GP)}function hb(o,e,s,c,f){for(;c>s;){if(c-s>600){var g=c-s+1,x=e-s+1,C=Math.log(g),M=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*M*(g-M)/g)*(x-g/2<0?-1:1);hb(o,e,Math.max(s,Math.floor(e-x*M/g+P)),Math.min(c,Math.floor(e+(g-x)*M/g+P)),f)}var j=o[e],$=s,W=c;for(zp(o,s,e),f(o[c],j)>0&&zp(o,s,c);$<W;){for(zp(o,$,W),$++,W--;f(o[$],j)<0;)$++;for(;f(o[W],j)>0;)W--}f(o[s],j)===0?zp(o,s,W):zp(o,++W,c),W<=e&&(s=W+1),e<=W&&(c=W-1)}}function zp(o,e,s){var c=o[e];o[e]=o[s],o[s]=c}function GP(o,e){return o<e?-1:o>e?1:0}function Ly(o,e){const s=o.length;if(s<=1)return[o];const c=[];let f,g;for(let x=0;x<s;x++){const C=Bs(o[x]);C!==0&&(o[x].area=Math.abs(C),g===void 0&&(g=C<0),g===C<0?(f&&c.push(f),f=[o[x]]):f.push(o[x]))}if(f&&c.push(f),e>1)for(let x=0;x<c.length;x++)c[x].length<=e||(NP(c[x],e,1,c[x].length-1,VP),c[x]=c[x].slice(0,e));return c}function VP(o,e){return e.area-o.area}function By(o,e,s){const c=s.patternDependencies;let f=!1;for(const g of e){const x=g.paint.get(`${o}-pattern`);x.isConstant()||(f=!0);const C=x.constantOr(null);C&&(f=!0,c[C]=!0)}return f}function Ry(o,e,s,c,f){const g=f.patternDependencies;for(const x of e){const C=x.paint.get(`${o}-pattern`).value;if(C.kind!=="constant"){let M=C.evaluate({zoom:c},s,{},f.availableImages);M=M&&M.name?M.name:M,g[M]=!0,s.patterns[x.id]=M}}return s}class hg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Pt,this.indexArray=new un,this.indexArray2=new to,this.programConfigurations=new Xu(e.layers,e.zoom),this.segments=new fi,this.segments2=new fi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection}populate(e,s,c,f){this.hasPattern=By("fill",this.layers,s);const g=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:C,id:M,index:P,sourceLayerIndex:j}of e){const $=this.layers[0]._featureFilter.needGeometry,W=dd(C,$);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),W,c))continue;const Y=g?g.evaluate(W,{},c,s.availableImages):void 0,ee={id:M,properties:C.properties,type:C.type,sourceLayerIndex:j,index:P,geometry:$?W.geometry:Ku(C,c,f),patterns:{},sortKey:Y};x.push(ee)}g&&x.sort((C,M)=>C.sortKey-M.sortKey);for(const C of x){const{geometry:M,index:P,sourceLayerIndex:j}=C;if(this.hasPattern){const $=Ry("fill",this.layers,C,this.zoom,s);this.patternFeatures.push($)}else this.addFeature(C,M,P,c,{},s.availableImages);s.featureIndex.insert(e[P].feature,M,P,j,this.index)}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}addFeatures(e,s,c,f,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,c,f,g,x=[]){for(const C of Ly(s,500)){let M=0;for(const ee of C)M+=ee.length;const P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),j=P.vertexLength,$=[],W=[];for(const ee of C){if(ee.length===0)continue;ee!==C[0]&&W.push($.length/2);const oe=this.segments2.prepareSegment(ee.length,this.layoutVertexArray,this.indexArray2),de=oe.vertexLength;this.layoutVertexArray.emplaceBack(ee[0].x,ee[0].y),this.indexArray2.emplaceBack(de+ee.length-1,de),$.push(ee[0].x),$.push(ee[0].y);for(let ve=1;ve<ee.length;ve++)this.layoutVertexArray.emplaceBack(ee[ve].x,ee[ve].y),this.indexArray2.emplaceBack(de+ve-1,de+ve),$.push(ee[ve].x),$.push(ee[ve].y);oe.vertexLength+=ee.length,oe.primitiveLength+=ee.length}const Y=Py($,W);for(let ee=0;ee<Y.length;ee+=3)this.indexArray.emplaceBack(j+Y[ee],j+Y[ee+1],j+Y[ee+2]);P.vertexLength+=M,P.primitiveLength+=Y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,g,x,f)}}on(hg,"FillBucket",{omit:["layers","patternFeatures"]});const $P=new Ee({"fill-sort-key":new pe(et.layout_fill["fill-sort-key"])});var HP={paint:new Ee({"fill-antialias":new ie(et.paint_fill["fill-antialias"]),"fill-opacity":new pe(et.paint_fill["fill-opacity"]),"fill-color":new pe(et.paint_fill["fill-color"]),"fill-outline-color":new pe(et.paint_fill["fill-outline-color"]),"fill-translate":new ie(et.paint_fill["fill-translate"]),"fill-translate-anchor":new ie(et.paint_fill["fill-translate-anchor"]),"fill-pattern":new pe(et.paint_fill["fill-pattern"])}),layout:$P};const WP=$e([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ZP=$e([{name:"a_centroid_pos",components:2,type:"Uint16"}]),XP=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qP}=WP;var dg={},KP=Ce,db=lf;function lf(o,e,s,c,f){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=f,o.readFields(JP,this,e)}function JP(o,e,s){o==1?e.id=s.readVarint():o==2?function(c,f){for(var g=c.readVarint()+c.pos;c.pos<g;){var x=f._keys[c.readVarint()],C=f._values[c.readVarint()];f.properties[x]=C}}(s,e):o==3?e.type=s.readVarint():o==4&&(e._geometry=s.pos)}function YP(o){for(var e,s,c=0,f=0,g=o.length,x=g-1;f<g;x=f++)c+=((s=o[x]).x-(e=o[f]).x)*(e.y+s.y);return c}lf.types=["Unknown","Point","LineString","Polygon"],lf.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var e,s=o.readVarint()+o.pos,c=1,f=0,g=0,x=0,C=[];o.pos<s;){if(f<=0){var M=o.readVarint();c=7&M,f=M>>3}if(f--,c===1||c===2)g+=o.readSVarint(),x+=o.readSVarint(),c===1&&(e&&C.push(e),e=[]),e.push(new KP(g,x));else{if(c!==7)throw new Error("unknown command "+c);e&&e.push(e[0].clone())}}return e&&C.push(e),C},lf.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var e=o.readVarint()+o.pos,s=1,c=0,f=0,g=0,x=1/0,C=-1/0,M=1/0,P=-1/0;o.pos<e;){if(c<=0){var j=o.readVarint();s=7&j,c=j>>3}if(c--,s===1||s===2)(f+=o.readSVarint())<x&&(x=f),f>C&&(C=f),(g+=o.readSVarint())<M&&(M=g),g>P&&(P=g);else if(s!==7)throw new Error("unknown command "+s)}return[x,M,C,P]},lf.prototype.toGeoJSON=function(o,e,s){var c,f,g=this.extent*Math.pow(2,s),x=this.extent*o,C=this.extent*e,M=this.loadGeometry(),P=lf.types[this.type];function j(Y){for(var ee=0;ee<Y.length;ee++){var oe=Y[ee];Y[ee]=[360*(oe.x+x)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+C)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(c=0;c<M.length;c++)$[c]=M[c][0];j(M=$);break;case 2:for(c=0;c<M.length;c++)j(M[c]);break;case 3:for(M=function(Y){var ee=Y.length;if(ee<=1)return[Y];for(var oe,de,ve=[],Le=0;Le<ee;Le++){var xe=YP(Y[Le]);xe!==0&&(de===void 0&&(de=xe<0),de===xe<0?(oe&&ve.push(oe),oe=[Y[Le]]):oe.push(Y[Le]))}return oe&&ve.push(oe),ve}(M),c=0;c<M.length;c++)for(f=0;f<M[c].length;f++)j(M[c][f])}M.length===1?M=M[0]:P="Multi"+P;var W={type:"Feature",geometry:{type:P,coordinates:M},properties:this.properties};return"id"in this&&(W.id=this.id),W};var QP=db,fb=pb;function pb(o,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(eL,this,e),this.length=this._features.length}function eL(o,e,s){o===15?e.version=s.readVarint():o===1?e.name=s.readString():o===5?e.extent=s.readVarint():o===2?e._features.push(s.pos):o===3?e._keys.push(s.readString()):o===4&&e._values.push(function(c){for(var f=null,g=c.readVarint()+c.pos;c.pos<g;){var x=c.readVarint()>>3;f=x===1?c.readString():x===2?c.readFloat():x===3?c.readDouble():x===4?c.readVarint64():x===5?c.readVarint():x===6?c.readSVarint():x===7?c.readBoolean():null}return f}(s))}pb.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var e=this._pbf.readVarint()+this._pbf.pos;return new QP(this._pbf,e,this.extent,this._keys,this._values)};var tL=fb;function nL(o,e,s){if(o===3){var c=new tL(s,s.readVarint()+s.pos);c.length&&(e[c.name]=c)}}var Dy=dg.VectorTile=function(o,e){this.layers=o.readFields(nL,{},e)},fg=dg.VectorTileFeature=db;function pg(o,e,s,c){const f=[],g=c===0?(x,C,M,P,j,$)=>{x.push(new me($,M+($-C)/(P-C)*(j-M)))}:(x,C,M,P,j,$)=>{x.push(new me(C+($-M)/(j-M)*(P-C),$))};for(const x of o){const C=[];for(const M of x){if(M.length<=2)continue;const P=[];for(let W=0;W<M.length-1;W++){const Y=M[W].x,ee=M[W].y,oe=M[W+1].x,de=M[W+1].y,ve=c===0?Y:ee,Le=c===0?oe:de;ve<e?Le>e&&g(P,Y,ee,oe,de,e):ve>s?Le<s&&g(P,Y,ee,oe,de,s):P.push(M[W]),Le<e&&ve>=e&&g(P,Y,ee,oe,de,e),Le>s&&ve<=s&&g(P,Y,ee,oe,de,s)}let j=M[M.length-1];const $=c===0?j.x:j.y;$>=e&&$<=s&&P.push(j),P.length&&(j=P[P.length-1],P[0].x===j.x&&P[0].y===j.y||P.push(P[0]),C.push(P))}C.length&&f.push(C)}return f}dg.VectorTileLayer=fb;const rL=fg.types,iL=Math.pow(2,13);function Fp(o,e,s,c,f,g,x,C){o.emplaceBack((e<<1)+x,(s<<1)+g,(Math.floor(c*iL)<<1)+f,Math.round(C))}function jp(o,e,s){o.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class mb{constructor(){this.acc=new me(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new me(e.x,e.y),this.max=new me(e.x,e.y))}append(e,s){this.currentPolyCount.edges++,this.acc._add(e);const c=this.min,f=this.max;e.x<c.x?c.x=e.x:e.x>f.x&&(f.x=e.x),e.y<c.y?c.y=e.y:e.y>f.y&&(f.y=e.y),((e.x===0||e.x===_n)&&e.x===s.x)!=((e.y===0||e.y===_n)&&e.y===s.y)&&this.processBorderOverlap(e,s),s.x<0!=e.x<0&&this.addBorderIntersection(0,Pn(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>_n!=e.x>_n&&this.addBorderIntersection(1,Pn(s.y,e.y,(_n-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,Pn(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>_n!=e.y>_n&&this.addBorderIntersection(3,Pn(s.x,e.x,(_n-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[e];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const c=e.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,e.y)}else{const c=e.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,e.x)}}centroid(){const e=this.polyCount.reduce((s,c)=>s+c.edges,0);return e!==0?this.acc.div(e)._round():new me(0,0)}span(){return new me(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0)}}class Up{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new gt,this.centroidVertexArray=new cs,this.indexArray=new un,this.programConfigurations=new Xu(e.layers,e.zoom),this.segments=new fi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=e.enableTerrain}populate(e,s,c,f){this.features=[],this.hasPattern=By("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const x=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*x/(x*x+1)/_n/(1<<g.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:x,index:C,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,j=dd(g,P);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),j,c))continue;const $={id:x,sourceLayerIndex:M,index:C,geometry:P?j.geometry:Ku(g,c,f),properties:g.properties,type:g.type,patterns:{}},W=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ry("fill-extrusion",this.layers,$,this.zoom,s)):this.addFeature($,$.geometry,C,c,{},s.availableImages,f),s.featureIndex.insert(g,$.geometry,C,M,this.index,W)}this.sortBorders()}addFeatures(e,s,c,f,g){for(const x of this.features){const{geometry:C}=x;this.addFeature(x,C,x.index,s,c,f,g)}this.sortBorders()}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,XP.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ZP.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,c,f,g,x,C){const M=[new me(0,0),new me(_n,_n)],P=C.projection,j=P.name==="globe",$=this.enableTerrain&&!j?new mb:null,W=rL[e.type]==="Polygon";j&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new xt);const Y=Ly(s,500);for(let ve=Y.length-1;ve>=0;ve--){const Le=Y[ve];(Le.length===0||(ee=Le[0]).every(xe=>xe.x<=0)||ee.every(xe=>xe.x>=_n)||ee.every(xe=>xe.y<=0)||ee.every(xe=>xe.y>=_n))&&Y.splice(ve,1)}var ee;let oe;if(j)oe=wb(Y,M,f);else{oe=[];for(const ve of Y)oe.push({polygon:ve,bounds:M})}const de=W?this.edgeRadius:0;for(const{polygon:ve,bounds:Le}of oe){let xe=0,Me=0;for(const Re of ve)W&&!Re[0].equals(Re[Re.length-1])&&Re.push(Re[0]),Me+=W?Re.length-1:Re.length;const Oe=this.segments.prepareSegment((W?5:4)*Me,this.layoutVertexArray,this.indexArray);if(W){const Re=[],ot=[];xe=Oe.vertexLength;for(const pt of ve){let Ot,ct;pt.length&&pt!==ve[0]&&ot.push(Re.length/2),Ot=pt[1].sub(pt[0])._perp()._unit();for(let Ct=1;Ct<pt.length;Ct++){const At=pt[Ct],Mt=pt[Ct===pt.length-1?1:Ct+1];let{x:kt,y:ft}=At;if(de){ct=Mt.sub(At)._perp()._unit();const Qt=Ot.add(ct)._unit(),ln=de*Math.min(4,1/(Ot.x*Qt.x+Ot.y*Qt.y));kt+=ln*Qt.x,ft+=ln*Qt.y,Ot=ct}Fp(this.layoutVertexArray,kt,ft,0,0,1,1,0),Oe.vertexLength++,Re.push(At.x,At.y),j&&jp(this.layoutVertexExtArray,P.projectTilePoint(kt,ft,f),P.upVector(f,kt,ft))}}const nt=Py(Re,ot);for(let pt=0;pt<nt.length;pt+=3)this.indexArray.emplaceBack(xe+nt[pt],xe+nt[pt+2],xe+nt[pt+1]),Oe.primitiveLength++}for(const Re of ve){$&&Re.length&&$.startRing(Re[0]);let ot,nt,pt,Ot=Re.length>4&&vb(Re[Re.length-2],Re[0],Re[1]),ct=de?oL(Re[Re.length-2],Re[0],Re[1],de):0;nt=Re[1].sub(Re[0])._perp()._unit();let Ct=!0;for(let At=1,Mt=0;At<Re.length;At++){let kt=Re[At-1],ft=Re[At];const Qt=Re[At===Re.length-1?1:At+1];if($&&W&&$.currentPolyCount.top++,yb(ft,kt,Le)){de&&(nt=Qt.sub(ft)._perp()._unit(),Ct=!Ct);continue}$&&$.append(ft,kt);const ln=ft.sub(kt)._perp(),tn=ln.x/(Math.abs(ln.x)+Math.abs(ln.y)),Hn=ln.y>0?1:0,zt=kt.dist(ft);if(Mt+zt>32768&&(Mt=0),de){pt=Qt.sub(ft)._perp()._unit();let Zn=_b(kt,ft,Qt,gb(nt,pt),de);isNaN(Zn)&&(Zn=0);const Bn=ft.sub(kt)._unit();kt=kt.add(Bn.mult(ct))._round(),ft=ft.add(Bn.mult(-Zn))._round(),ct=Zn,nt=pt}const bn=Oe.vertexLength,Wn=Re.length>4&&vb(kt,ft,Qt);let Ar=xb(Mt,Ot,Ct);if(Fp(this.layoutVertexArray,kt.x,kt.y,tn,Hn,0,0,Ar),Fp(this.layoutVertexArray,kt.x,kt.y,tn,Hn,0,1,Ar),Mt+=zt,Ar=xb(Mt,Wn,!Ct),Ot=Wn,Fp(this.layoutVertexArray,ft.x,ft.y,tn,Hn,0,0,Ar),Fp(this.layoutVertexArray,ft.x,ft.y,tn,Hn,0,1,Ar),Oe.vertexLength+=4,this.indexArray.emplaceBack(bn+0,bn+1,bn+2),this.indexArray.emplaceBack(bn+1,bn+3,bn+2),Oe.primitiveLength+=2,de){const Zn=xe+(At===1?Re.length-2:At-2),Bn=At===1?xe:Zn+1;if(this.indexArray.emplaceBack(bn+1,Zn,bn+3),this.indexArray.emplaceBack(Zn,Bn,bn+3),Oe.primitiveLength+=2,ot===void 0&&(ot=bn),!yb(Qt,Re[At],Le)){const xi=At===Re.length-1?ot:Oe.vertexLength;this.indexArray.emplaceBack(bn+2,bn+3,xi),this.indexArray.emplaceBack(bn+3,xi+1,xi),this.indexArray.emplaceBack(bn+3,Bn,xi+1),Oe.primitiveLength+=3}Ct=!Ct}if(j){const Zn=this.layoutVertexExtArray,Bn=P.projectTilePoint(kt.x,kt.y,f),xi=P.projectTilePoint(ft.x,ft.y,f),Kn=P.upVector(f,kt.x,kt.y),Jn=P.upVector(f,ft.x,ft.y);jp(Zn,Bn,Kn),jp(Zn,Bn,Kn),jp(Zn,xi,Jn),jp(Zn,xi,Jn)}}W&&(xe+=Re.length-1)}}if($&&$.polyCount.length>0){if($.borders){$.vertexArrayOffset=this.centroidVertexArray.length;const ve=$.borders,Le=this.featuresOnBorder.push($)-1;for(let xe=0;xe<4;xe++)ve[xe][0]!==Number.MAX_VALUE&&this.borders[xe].push(Le)}this.encodeCentroid($.borders?void 0:$.centroid(),$)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,g,x,f)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((s,c)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}encodeCentroid(e,s,c=!0){let f,g;if(e)if(e.y!==0){const C=s.span()._mult(this.tileToMeter);f=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(C.x/10)),g=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(C.y/10))}else f=Math.ceil(7*(e.x+450)),g=0;else f=0,g=+c;let x=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const C of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*C.edges+C.top);for(let M=0;M<C.top;M++)this.centroidVertexArray.emplace(x++,f,g);for(let M=0;M<2*C.edges;M++)this.centroidVertexArray.emplace(x++,0,g),this.centroidVertexArray.emplace(x++,f,g)}}}function gb(o,e){const s=o.add(e)._unit();return o.x*s.x+o.y*s.y}function oL(o,e,s,c){const f=e.sub(o)._perp()._unit(),g=s.sub(e)._perp()._unit();return _b(o,e,s,gb(f,g),c)}function _b(o,e,s,c,f){const g=Math.sqrt(1-c*c);return Math.min(o.dist(e)/3,e.dist(s)/3,f*g/c)}function yb(o,e,s){return o.x<s[0].x&&e.x<s[0].x||o.x>s[1].x&&e.x>s[1].x||o.y<s[0].y&&e.y<s[0].y||o.y>s[1].y&&e.y>s[1].y}function vb(o,e,s){if(o.x<0||o.x>=_n||e.x<0||e.x>=_n||s.x<0||s.x>=_n)return!1;const c=s.sub(e),f=c.perp(),g=o.sub(e);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&f.x*g.x+f.y*g.y<0}function xb(o,e,s){const c=e?2|o:-3&o;return s?1|c:-2&c}function bb(){const o=Math.PI/32,e=Math.tan(o),s=Rp;return s*Math.sqrt(1+2*e*e)-s}function wb(o,e,s){const c=1<<s.z,f=Il(s.x/c),g=Il((s.x+1)/c),x=Is(s.y/c),C=Is((s.y+1)/c);return function(M,P,j,$,W=0,Y){const ee=[];if(!M.length||!j||!$)return ee;const oe=(Re,ot)=>{for(const nt of Re)ee.push({polygon:nt,bounds:ot})},de=Math.ceil(Math.log2(j)),ve=Math.ceil(Math.log2($)),Le=de-ve,xe=[];for(let Re=0;Re<Math.abs(Le);Re++)xe.push(Le>0?0:1);for(let Re=0;Re<Math.min(de,ve);Re++)xe.push(0),xe.push(1);let Me=M;if(Me=pg(Me,P[0].y-W,P[1].y+W,1),Me=pg(Me,P[0].x-W,P[1].x+W,0),!Me.length)return ee;const Oe=[];for(xe.length?Oe.push({polygons:Me,bounds:P,depth:0}):oe(Me,P);Oe.length;){const Re=Oe.pop(),ot=Re.depth,nt=xe[ot],pt=Re.bounds[0],Ot=Re.bounds[1],ct=nt===0?pt.x:pt.y,Ct=nt===0?Ot.x:Ot.y,At=Y?Y(nt,ct,Ct):.5*(ct+Ct),Mt=pg(Re.polygons,ct-W,At+W,nt),kt=pg(Re.polygons,At-W,Ct+W,nt);if(Mt.length){const ft=[pt,new me(nt===0?At:Ot.x,nt===1?At:Ot.y)];xe.length>ot+1?Oe.push({polygons:Mt,bounds:ft,depth:ot+1}):oe(Mt,ft)}if(kt.length){const ft=[new me(nt===0?At:pt.x,nt===1?At:pt.y),Ot];xe.length>ot+1?Oe.push({polygons:kt,bounds:ft,depth:ot+1}):oe(kt,ft)}}return ee}(o,e,Math.ceil((g-f)/11.25),Math.ceil((x-C)/11.25),1,(M,P,j)=>{if(M===0)return .5*(P+j);{const $=Is((s.y+P/_n)/c);return(hu(.5*(Is((s.y+j/_n)/c)+$))*c-s.y)*_n}})}on(Up,"FillExtrusionBucket",{omit:["layers","features"]}),on(mb,"PartMetadata");const sL=new Ee({"fill-extrusion-edge-radius":new ie(et["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var aL={paint:new Ee({"fill-extrusion-opacity":new ie(et["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pe(et["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ie(et["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ie(et["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pe(et["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pe(et["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pe(et["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ie(et["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ie(et["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ie(et["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new ie(et["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:sL};function Eb(o,e,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}class mg{constructor(e,s,c){this.z=e,this.x=s,this.y=c,this.key=Np(0,e,e,s,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){const c=function(g,x,C){var M=Eb(256*g,256*(x=Math.pow(2,C)-x-1),C),P=Eb(256*(g+1),256*(x+1),C);return M[0]+","+M[1]+","+P[0]+","+P[1]}(this.x,this.y,this.z),f=function(g,x,C){let M,P="";for(let j=g;j>0;j--)M=1<<j-1,P+=(x&M?1:0)+(C&M?2:0);return P}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cb{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Np(e,s.z,s.z,s.x,s.y)}}class la{constructor(e,s,c,f,g){this.overscaledZ=e,this.wrap=s,this.canonical=new mg(c,+f,+g),this.key=s===0&&e===c?this.canonical.key:Np(s,e,c,f,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new la(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new la(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return Np(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-e;return Np(this.wrap*+s,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new la(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new la(s,this.wrap,s,c,f),new la(s,this.wrap,s,c+1,f),new la(s,this.wrap,s,c,f+1),new la(s,this.wrap,s,c+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new la(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new la(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Np(o,e,s,c,f){const g=1<<Math.min(s,22);let x=g*(f%g)+c%g;return o&&s<22&&(x+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*x+s)+(e-s)}on(mg,"CanonicalTileID"),on(la,"OverscaledTileID",{omit:["projMatrix"]});class cf extends me{constructor(e,s,c){super(e,s),this.z=c}}function Gp(o,e){return o.x*e.x+o.y*e.y}function Ab(o,e){if(o.length===1){let s=0;const c=e[s++];let f;for(;!f||c.equals(f);)if(f=e[s++],!f)return 1/0;for(;s<e.length;s++){const g=e[s],x=o[0],C=f.sub(c),M=g.sub(c),P=x.sub(c),j=Gp(C,C),$=Gp(C,M),W=Gp(M,M),Y=Gp(P,C),ee=Gp(P,M),oe=j*W-$*$,de=(W*Y-$*ee)/oe,ve=(j*ee-$*Y)/oe,Le=c.z*(1-de-ve)+f.z*de+g.z*ve;if(isFinite(Le))return Le}return 1/0}{let s=1/0;for(const c of e)s=Math.min(s,c.z);return s}}function Tb(o,e,s,c,f,g,x,C){const M=x*f.getElevationAt(o,e,!0,!0),P=g[0]!==0,j=P?g[1]===0?x*(g[0]/7-450):x*function($,W,Y){const ee=Math.floor(W[0]/8),oe=Math.floor(W[1]/8),de=10*(W[0]-8*ee),ve=10*(W[1]-8*oe),Le=$.getElevationAt(ee,oe,!0,!0),xe=$.getMeterToDEM(Y),Me=Math.floor(.5*(de*xe-1)),Oe=Math.floor(.5*(ve*xe-1)),Re=$.tileCoordToPixel(ee,oe),ot=2*Me+1,nt=2*Oe+1,pt=function(kt,ft,Qt,ln,tn){return[kt.getElevationAtPixel(ft,Qt,!0),kt.getElevationAtPixel(ft+tn,Qt,!0),kt.getElevationAtPixel(ft,Qt+tn,!0),kt.getElevationAtPixel(ft+ln,Qt+tn,!0)]}($,Re.x-Me,Re.y-Oe,ot,nt),Ot=Math.abs(pt[0]-pt[1]),ct=Math.abs(pt[2]-pt[3]),Ct=Math.abs(pt[0]-pt[2])+Math.abs(pt[1]-pt[3]),At=Math.min(.25,.5*xe*(Ot+ct)/ot),Mt=Math.min(.25,.5*xe*Ct/nt);return Le+Math.max(At*de,Mt*ve)}(f,g,C):M;return{base:M+(s===0)?-1:s,top:P?Math.max(j+c,M+s+2):M+c}}const lL=$e([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:cL}=lL,uL=$e([{name:"a_packed",components:4,type:"Float32"}]),{members:hL}=uL,dL=fg.types,fL=Math.cos(Math.PI/180*37.5);class gg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new st,this.layoutVertexArray2=new Lt,this.indexArray=new un,this.programConfigurations=new Xu(e.layers,e.zoom),this.segments=new fi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c,f){this.hasPattern=By("line",this.layers,s);const g=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:j,id:$,index:W,sourceLayerIndex:Y}of e){const ee=this.layers[0]._featureFilter.needGeometry,oe=dd(j,ee);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),oe,c))continue;const de=g?g.evaluate(oe,{},c):void 0,ve={id:$,properties:j.properties,type:j.type,sourceLayerIndex:Y,index:W,geometry:ee?oe.geometry:Ku(j,c,f),patterns:{},sortKey:de};x.push(ve)}g&&x.sort((j,$)=>j.sortKey-$.sortKey);const{lineAtlas:C,featureIndex:M}=s,P=this.addConstantDashes(C);for(const j of x){const{geometry:$,index:W,sourceLayerIndex:Y}=j;if(P&&this.addFeatureDashes(j,C),this.hasPattern){const ee=Ry("line",this.layers,j,this.zoom,s);this.patternFeatures.push(ee)}else this.addFeature(j,$,W,c,C.positions,s.availableImages);M.insert(e[W].feature,$,W,Y,this.index)}}addConstantDashes(e){let s=!1;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(f.kind!=="constant"||g.kind!=="constant")s=!0;else{const x=g.value,C=f.value;if(!C)continue;e.addDash(C,x)}}return s}addFeatureDashes(e,s){const c=this.zoom;for(const f of this.layers){const g=f.paint.get("line-dasharray").value,x=f.layout.get("line-cap").value;if(g.kind==="constant"&&x.kind==="constant")continue;let C,M;if(g.kind==="constant"){if(C=g.value,!C)continue}else C=g.evaluate({zoom:c},e);M=x.kind==="constant"?x.value:x.evaluate({zoom:c},e),s.addDash(C,M),e.patterns[f.id]=s.getKey(C,M)}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}addFeatures(e,s,c,f,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,hL)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cL),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,c,f,g,x){const C=this.layers[0].layout,M=C.get("line-join").evaluate(e,{}),P=C.get("line-cap").evaluate(e,{}),j=C.get("line-miter-limit"),$=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const W of s)this.addLine(W,e,M,P,j,$);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,g,x,f)}addLine(e,s,c,f,g,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<e.length-1;ve++)this.totalDistance+=e[ve].dist(e[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=dL[s.type]==="Polygon";let M=e.length;for(;M>=2&&e[M-1].equals(e[M-2]);)M--;let P=0;for(;P<M-1&&e[P].equals(e[P+1]);)P++;if(M<(C?3:2))return;c==="bevel"&&(g=1.05);const j=this.overscaling<=16?15*_n/(512*this.overscaling):0,$=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let W,Y,ee,oe,de;this.e1=this.e2=-1,C&&(W=e[M-2],de=e[P].sub(W)._unit()._perp());for(let ve=P;ve<M;ve++){if(ee=ve===M-1?C?e[P+1]:void 0:e[ve+1],ee&&e[ve].equals(ee))continue;de&&(oe=de),W&&(Y=W),W=e[ve],de=ee?ee.sub(W)._unit()._perp():oe,oe=oe||de;let Le=oe.add(de);Le.x===0&&Le.y===0||Le._unit();const xe=oe.x*de.x+oe.y*de.y,Me=Le.x*de.x+Le.y*de.y,Oe=Me!==0?1/Me:1/0,Re=2*Math.sqrt(2-2*Me),ot=Me<fL&&Y&&ee,nt=oe.x*de.y-oe.y*de.x>0;if(ot&&ve>P){const ct=W.dist(Y);if(ct>2*j){const Ct=W.sub(W.sub(Y)._mult(j/ct)._round());this.updateDistance(Y,Ct),this.addCurrentVertex(Ct,oe,0,0,$),Y=Ct}}const pt=Y&&ee;let Ot=pt?c:C?"butt":f;if(pt&&Ot==="round"&&(Oe<x?Ot="miter":Oe<=2&&(Ot="fakeround")),Ot==="miter"&&Oe>g&&(Ot="bevel"),Ot==="bevel"&&(Oe>2&&(Ot="flipbevel"),Oe<g&&(Ot="miter")),Y&&this.updateDistance(Y,W),Ot==="miter")Le._mult(Oe),this.addCurrentVertex(W,Le,0,0,$);else if(Ot==="flipbevel"){if(Oe>100)Le=de.mult(-1);else{const ct=Oe*oe.add(de).mag()/oe.sub(de).mag();Le._perp()._mult(ct*(nt?-1:1))}this.addCurrentVertex(W,Le,0,0,$),this.addCurrentVertex(W,Le.mult(-1),0,0,$)}else if(Ot==="bevel"||Ot==="fakeround"){const ct=-Math.sqrt(Oe*Oe-1),Ct=nt?ct:0,At=nt?0:ct;if(Y&&this.addCurrentVertex(W,oe,Ct,At,$),Ot==="fakeround"){const Mt=Math.round(180*Re/Math.PI/20);for(let kt=1;kt<Mt;kt++){let ft=kt/Mt;if(ft!==.5){const ln=ft-.5;ft+=ft*ln*(ft-1)*((1.0904+xe*(xe*(3.55645-1.43519*xe)-3.2452))*ln*ln+(.848013+xe*(.215638*xe-1.06021)))}const Qt=de.sub(oe)._mult(ft)._add(oe)._unit()._mult(nt?-1:1);this.addHalfVertex(W,Qt.x,Qt.y,!1,nt,0,$)}}ee&&this.addCurrentVertex(W,de,-Ct,-At,$)}else if(Ot==="butt")this.addCurrentVertex(W,Le,0,0,$);else if(Ot==="square"){const ct=Y?1:-1;Y||this.addCurrentVertex(W,Le,ct,ct,$),this.addCurrentVertex(W,Le,0,0,$),Y&&this.addCurrentVertex(W,Le,ct,ct,$)}else Ot==="round"&&(Y&&(this.addCurrentVertex(W,oe,0,0,$),this.addCurrentVertex(W,oe,1,1,$,!0)),ee&&(this.addCurrentVertex(W,de,-1,-1,$,!0),this.addCurrentVertex(W,de,0,0,$)));if(ot&&ve<M-1){const ct=W.dist(ee);if(ct>2*j){const Ct=W.add(ee.sub(W)._mult(j/ct)._round());this.updateDistance(W,Ct),this.addCurrentVertex(Ct,de,0,0,$),W=Ct}}}}addCurrentVertex(e,s,c,f,g,x=!1){const C=s.y*f-s.x,M=-s.y-s.x*f;this.addHalfVertex(e,s.x+s.y*c,s.y-s.x*c,x,!1,c,g),this.addHalfVertex(e,C,M,x,!0,-f,g)}addHalfVertex({x:e,y:s},c,f,g,x,C,M){this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(s<<1)+(x?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(C===0?0:C<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const P=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),M.primitiveLength++),x?this.e2=P:this.e1=P}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}on(gg,"LineBucket",{omit:["layers","patternFeatures"]});const pL=new Ee({"line-cap":new pe(et.layout_line["line-cap"]),"line-join":new pe(et.layout_line["line-join"]),"line-miter-limit":new ie(et.layout_line["line-miter-limit"]),"line-round-limit":new ie(et.layout_line["line-round-limit"]),"line-sort-key":new pe(et.layout_line["line-sort-key"])});var Sb={paint:new Ee({"line-opacity":new pe(et.paint_line["line-opacity"]),"line-color":new pe(et.paint_line["line-color"]),"line-translate":new ie(et.paint_line["line-translate"]),"line-translate-anchor":new ie(et.paint_line["line-translate-anchor"]),"line-width":new pe(et.paint_line["line-width"]),"line-gap-width":new pe(et.paint_line["line-gap-width"]),"line-offset":new pe(et.paint_line["line-offset"]),"line-blur":new pe(et.paint_line["line-blur"]),"line-dasharray":new pe(et.paint_line["line-dasharray"]),"line-pattern":new pe(et.paint_line["line-pattern"]),"line-gradient":new we(et.paint_line["line-gradient"]),"line-trim-offset":new ie(et.paint_line["line-trim-offset"])}),layout:pL};const Mb=new class extends pe{possiblyEvaluate(o,e){return e=new G(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(o,e)}evaluate(o,e,s,c){return e=On({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(o,e,s,c)}}(Sb.paint.properties["line-width"].specification);function Ib(o,e){return e>0?e+2*o:o}Mb.useIntegerZoom=!0;const mL=$e([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gL=$e([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),_L=$e([{name:"a_projected_pos",components:4,type:"Float32"}],4);$e([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yL=$e([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),vL=$e([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Pb=$e([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xL=$e([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$e([{name:"triangle",components:3,type:"Uint16"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),$e([{type:"Float32",name:"offsetX"}]),$e([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ys=24;const Bc=128;function Oy(o,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new G(o+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=s;let g=0;for(;g<c.length&&c[g]<=o;)g++;g=Math.max(0,g-1);let x=g;for(;x<c.length&&c[x]<o+1;)x++;x=Math.min(c.length-1,x);const C=c[g],M=c[x];return s.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:M,interpolationType:f}:{kind:"camera",minZoom:C,maxZoom:M,minSize:s.evaluate(new G(C)),maxSize:s.evaluate(new G(M)),interpolationType:f}}}function _g(o,{uSize:e,uSizeT:s},{lowerSize:c,upperSize:f}){return o.kind==="source"?c/Bc:o.kind==="composite"?Pn(c/Bc,f/Bc,s):e}function uf(o,e){let s=0,c=0;if(o.kind==="constant")c=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:f,minZoom:g,maxZoom:x}=o,C=f?bt(Uo.interpolationFactor(f,e,g,x),0,1):0;o.kind==="camera"?c=Pn(o.minSize,o.maxSize,C):s=C}return{uSizeT:s,uSize:c}}var bL=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Bc,evaluateSizeForFeature:_g,evaluateSizeForZoom:uf,getSizeData:Oy});function wL(o,e,s){return o.sections.forEach(c=>{c.text=function(f,g,x){const C=g.layout.get("text-transform").evaluate(x,{});return C==="uppercase"?f=f.toLocaleUpperCase():C==="lowercase"&&(f=f.toLocaleLowerCase()),D.applyArabicShaping&&(f=D.applyArabicShaping(f)),f}(c.text,e,s)}),o}const Vp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function EL(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function CL(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}var Lb=pi,Bb=function(o,e,s,c,f){var g,x,C=8*f-c-1,M=(1<<C)-1,P=M>>1,j=-7,$=f-1,W=-1,Y=o[e+$];for($+=W,g=Y&(1<<-j)-1,Y>>=-j,j+=C;j>0;g=256*g+o[e+$],$+=W,j-=8);for(x=g&(1<<-j)-1,g>>=-j,j+=c;j>0;x=256*x+o[e+$],$+=W,j-=8);if(g===0)g=1-P;else{if(g===M)return x?NaN:1/0*(Y?-1:1);x+=Math.pow(2,c),g-=P}return(Y?-1:1)*x*Math.pow(2,g-c)},Rb=function(o,e,s,c,f,g){var x,C,M,P=8*g-f-1,j=(1<<P)-1,$=j>>1,W=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=0,ee=1,oe=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(C=isNaN(e)?1:0,x=j):(x=Math.floor(Math.log(e)/Math.LN2),e*(M=Math.pow(2,-x))<1&&(x--,M*=2),(e+=x+$>=1?W/M:W*Math.pow(2,1-$))*M>=2&&(x++,M/=2),x+$>=j?(C=0,x=j):x+$>=1?(C=(e*M-1)*Math.pow(2,f),x+=$):(C=e*Math.pow(2,$-1)*Math.pow(2,f),x=0));f>=8;o[s+Y]=255&C,Y+=ee,C/=256,f-=8);for(x=x<<f|C,P+=f;P>0;o[s+Y]=255&x,Y+=ee,x/=256,P-=8);o[s+Y-ee]|=128*oe};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function pi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}pi.Varint=0,pi.Fixed64=1,pi.Bytes=2,pi.Fixed32=5;var ky=4294967296,Db=1/ky,Ob=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yu(o){return o.type===pi.Bytes?o.readVarint()+o.pos:o.pos+1}function hf(o,e,s){return s?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function kb(o,e,s){var c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(c);for(var f=s.pos-1;f>=o;f--)s.buf[f+c]=s.buf[f]}function AL(o,e){for(var s=0;s<o.length;s++)e.writeVarint(o[s])}function TL(o,e){for(var s=0;s<o.length;s++)e.writeSVarint(o[s])}function SL(o,e){for(var s=0;s<o.length;s++)e.writeFloat(o[s])}function ML(o,e){for(var s=0;s<o.length;s++)e.writeDouble(o[s])}function IL(o,e){for(var s=0;s<o.length;s++)e.writeBoolean(o[s])}function PL(o,e){for(var s=0;s<o.length;s++)e.writeFixed32(o[s])}function LL(o,e){for(var s=0;s<o.length;s++)e.writeSFixed32(o[s])}function BL(o,e){for(var s=0;s<o.length;s++)e.writeFixed64(o[s])}function RL(o,e){for(var s=0;s<o.length;s++)e.writeSFixed64(o[s])}function yg(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16)+16777216*o[e+3]}function df(o,e,s){o[s]=e,o[s+1]=e>>>8,o[s+2]=e>>>16,o[s+3]=e>>>24}function zb(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16)+(o[e+3]<<24)}pi.prototype={destroy:function(){this.buf=null},readFields:function(o,e,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),f=c>>3,g=this.pos;this.type=7&c,o(f,e,this),this.pos===g&&this.skip(c)}return e},readMessage:function(o,e){return this.readFields(o,e,this.readVarint()+this.pos)},readFixed32:function(){var o=yg(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=zb(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=yg(this.buf,this.pos)+yg(this.buf,this.pos+4)*ky;return this.pos+=8,o},readSFixed64:function(){var o=yg(this.buf,this.pos)+zb(this.buf,this.pos+4)*ky;return this.pos+=8,o},readFloat:function(){var o=Bb(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Bb(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var e,s,c=this.buf;return e=127&(s=c[this.pos++]),s<128?e:(e|=(127&(s=c[this.pos++]))<<7,s<128?e:(e|=(127&(s=c[this.pos++]))<<14,s<128?e:(e|=(127&(s=c[this.pos++]))<<21,s<128?e:function(f,g,x){var C,M,P=x.buf;if(C=(112&(M=P[x.pos++]))>>4,M<128||(C|=(127&(M=P[x.pos++]))<<3,M<128)||(C|=(127&(M=P[x.pos++]))<<10,M<128)||(C|=(127&(M=P[x.pos++]))<<17,M<128)||(C|=(127&(M=P[x.pos++]))<<24,M<128)||(C|=(1&(M=P[x.pos++]))<<31,M<128))return hf(f,C,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&Ob?function(s,c,f){return Ob.decode(s.subarray(c,f))}(this.buf,e,o):function(s,c,f){for(var g="",x=c;x<f;){var C,M,P,j=s[x],$=null,W=j>239?4:j>223?3:j>191?2:1;if(x+W>f)break;W===1?j<128&&($=j):W===2?(192&(C=s[x+1]))==128&&($=(31&j)<<6|63&C)<=127&&($=null):W===3?(M=s[x+2],(192&(C=s[x+1]))==128&&(192&M)==128&&(($=(15&j)<<12|(63&C)<<6|63&M)<=2047||$>=55296&&$<=57343)&&($=null)):W===4&&(M=s[x+2],P=s[x+3],(192&(C=s[x+1]))==128&&(192&M)==128&&(192&P)==128&&(($=(15&j)<<18|(63&C)<<12|(63&M)<<6|63&P)<=65535||$>=1114112)&&($=null)),$===null?($=65533,W=1):$>65535&&($-=65536,g+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),g+=String.fromCharCode($),x+=W}return g}(this.buf,e,o)},readBytes:function(){var o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e},readPackedVarint:function(o,e){if(this.type!==pi.Bytes)return o.push(this.readVarint(e));var s=Yu(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(e));return o},readPackedSVarint:function(o){if(this.type!==pi.Bytes)return o.push(this.readSVarint());var e=Yu(this);for(o=o||[];this.pos<e;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==pi.Bytes)return o.push(this.readBoolean());var e=Yu(this);for(o=o||[];this.pos<e;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==pi.Bytes)return o.push(this.readFloat());var e=Yu(this);for(o=o||[];this.pos<e;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==pi.Bytes)return o.push(this.readDouble());var e=Yu(this);for(o=o||[];this.pos<e;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==pi.Bytes)return o.push(this.readFixed32());var e=Yu(this);for(o=o||[];this.pos<e;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==pi.Bytes)return o.push(this.readSFixed32());var e=Yu(this);for(o=o||[];this.pos<e;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==pi.Bytes)return o.push(this.readFixed64());var e=Yu(this);for(o=o||[];this.pos<e;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==pi.Bytes)return o.push(this.readSFixed64());var e=Yu(this);for(o=o||[];this.pos<e;)o.push(this.readSFixed64());return o},skip:function(o){var e=7&o;if(e===pi.Varint)for(;this.buf[this.pos++]>127;);else if(e===pi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===pi.Fixed32)this.pos+=4;else{if(e!==pi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(o,e){this.writeVarint(o<<3|e)},realloc:function(o){for(var e=this.length||16;e<this.pos+o;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),df(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),df(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),df(this.buf,-1&o,this.pos),df(this.buf,Math.floor(o*Db),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),df(this.buf,-1&o,this.pos),df(this.buf,Math.floor(o*Db),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(e,s){var c,f;if(e>=0?(c=e%4294967296|0,f=e/4294967296|0):(f=~(-e/4294967296),4294967295^(c=~(-e%4294967296))?c=c+1|0:(c=0,f=f+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,x,C){C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,C.buf[C.pos]=127&(g>>>=7)}(c,0,s),function(g,x){var C=(7&g)<<4;x.buf[x.pos++]|=C|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))}(f,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var e=this.pos;this.pos=function(c,f,g){for(var x,C,M=0;M<f.length;M++){if((x=f.charCodeAt(M))>55295&&x<57344){if(!C){x>56319||M+1===f.length?(c[g++]=239,c[g++]=191,c[g++]=189):C=x;continue}if(x<56320){c[g++]=239,c[g++]=191,c[g++]=189,C=x;continue}x=C-55296<<10|x-56320|65536,C=null}else C&&(c[g++]=239,c[g++]=191,c[g++]=189,C=null);x<128?c[g++]=x:(x<2048?c[g++]=x>>6|192:(x<65536?c[g++]=x>>12|224:(c[g++]=x>>18|240,c[g++]=x>>12&63|128),c[g++]=x>>6&63|128),c[g++]=63&x|128)}return g}(this.buf,o,this.pos);var s=this.pos-e;s>=128&&kb(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),Rb(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Rb(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var e=o.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,e){this.pos++;var s=this.pos;o(e,this);var c=this.pos-s;c>=128&&kb(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,e,s){this.writeTag(o,pi.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(o,e){e.length&&this.writeMessage(o,AL,e)},writePackedSVarint:function(o,e){e.length&&this.writeMessage(o,TL,e)},writePackedBoolean:function(o,e){e.length&&this.writeMessage(o,IL,e)},writePackedFloat:function(o,e){e.length&&this.writeMessage(o,SL,e)},writePackedDouble:function(o,e){e.length&&this.writeMessage(o,ML,e)},writePackedFixed32:function(o,e){e.length&&this.writeMessage(o,PL,e)},writePackedSFixed32:function(o,e){e.length&&this.writeMessage(o,LL,e)},writePackedFixed64:function(o,e){e.length&&this.writeMessage(o,BL,e)},writePackedSFixed64:function(o,e){e.length&&this.writeMessage(o,RL,e)},writeBytesField:function(o,e){this.writeTag(o,pi.Bytes),this.writeBytes(e)},writeFixed32Field:function(o,e){this.writeTag(o,pi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(o,e){this.writeTag(o,pi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(o,e){this.writeTag(o,pi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(o,e){this.writeTag(o,pi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(o,e){this.writeTag(o,pi.Varint),this.writeVarint(e)},writeSVarintField:function(o,e){this.writeTag(o,pi.Varint),this.writeSVarint(e)},writeStringField:function(o,e){this.writeTag(o,pi.Bytes),this.writeString(e)},writeFloatField:function(o,e){this.writeTag(o,pi.Fixed32),this.writeFloat(e)},writeDoubleField:function(o,e){this.writeTag(o,pi.Fixed64),this.writeDouble(e)},writeBooleanField:function(o,e){this.writeVarintField(o,!!e)}};var vg=te(Lb);const zy=3;function DL(o,e,s){e.glyphs=[],o===1&&s.readMessage(OL,e)}function OL(o,e,s){if(o===3){const{id:c,bitmap:f,width:g,height:x,left:C,top:M,advance:P}=s.readMessage(kL,{});e.glyphs.push({id:c,bitmap:new Ju({width:g+2*zy,height:x+2*zy},f),metrics:{width:g,height:x,left:C,top:M,advance:P}})}else o===4?e.ascender=s.readSVarint():o===5&&(e.descender=s.readSVarint())}function kL(o,e,s){o===1?e.id=s.readVarint():o===2?e.bitmap=s.readBytes():o===3?e.width=s.readVarint():o===4?e.height=s.readVarint():o===5?e.left=s.readSVarint():o===6?e.top=s.readSVarint():o===7&&(e.advance=s.readVarint())}const Fb=zy;function Fy(o){let e=0,s=0;for(const x of o)e+=x.w*x.h,s=Math.max(s,x.w);o.sort((x,C)=>C.h-x.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let f=0,g=0;for(const x of o)for(let C=c.length-1;C>=0;C--){const M=c[C];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,g=Math.max(g,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===M.w&&x.h===M.h){const P=c.pop();C<c.length&&(c[C]=P)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(c.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:f,h:g,fill:e/(f*g)||0}}const Ia=1;class jy{constructor(e,{pixelRatio:s,version:c,stretchX:f,stretchY:g,content:x}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=f,this.stretchY=g,this.content=x,this.version=c}get tl(){return[this.paddedRect.x+Ia,this.paddedRect.y+Ia]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ia,this.paddedRect.y+this.paddedRect.h-Ia]}get displaySize(){return[(this.paddedRect.w-2*Ia)/this.pixelRatio,(this.paddedRect.h-2*Ia)/this.pixelRatio]}}class jb{constructor(e,s){const c={},f={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,c,g),this.addImages(s,f,g);const{w:x,h:C}=Fy(g),M=new cl({width:x||1,height:C||1});for(const P in e){const j=e[P],$=c[P].paddedRect;cl.copy(j.data,M,{x:0,y:0},{x:$.x+Ia,y:$.y+Ia},j.data)}for(const P in s){const j=s[P],$=f[P].paddedRect,W=$.x+Ia,Y=$.y+Ia,ee=j.data.width,oe=j.data.height;cl.copy(j.data,M,{x:0,y:0},{x:W,y:Y},j.data),cl.copy(j.data,M,{x:0,y:oe-1},{x:W,y:Y-1},{width:ee,height:1}),cl.copy(j.data,M,{x:0,y:0},{x:W,y:Y+oe},{width:ee,height:1}),cl.copy(j.data,M,{x:ee-1,y:0},{x:W-1,y:Y},{width:1,height:oe}),cl.copy(j.data,M,{x:0,y:0},{x:W+ee,y:Y},{width:1,height:oe})}this.image=M,this.iconPositions=c,this.patternPositions=f}addImages(e,s,c){for(const f in e){const g=e[f],x={x:0,y:0,w:g.data.width+2*Ia,h:g.data.height+2*Ia};c.push(x),s[f]=new jy(x,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in e.updatedImages)this.patchUpdatedImage(this.iconPositions[c],e.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c),s)}patchUpdatedImage(e,s,c){if(!e||!s||e.version===s.version)return;e.version=s.version;const[f,g]=e.tl;c.update(s.data,void 0,{x:f,y:g})}}on(jy,"ImagePosition"),on(jb,"ImageAtlas");const Pl={horizontal:1,vertical:2,horizontalOnly:3},Ub=-17;class $p{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const c=new $p;return c.scale=e||1,c.fontStack=s,c}static forImage(e){const s=new $p;return s.imageName=e,s}}class ff{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const c=new ff;for(let f=0;f<e.sections.length;f++){const g=e.sections[f];g.image?c.addImageSection(g):c.addTextSection(g,s)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(s,c){let f="";for(let g=0;g<s.length;g++){const x=s.charCodeAt(g+1)||null,C=s.charCodeAt(g-1)||null;f+=!c&&(x&&Hu(x)&&!Vp[s[g+1]]||C&&Hu(C)&&!Vp[s[g-1]])||!Vp[s[g]]?s[g]:Vp[s[g]]}return f}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&xg[this.text.charCodeAt(c)];c++)e++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&xg[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const c=new ff;return c.text=this.text.substring(e,s),c.sectionIndex=this.sectionIndex.slice(e,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push($p.forText(e.scale,e.fontStack||s));const c=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(c)}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void wn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push($p.forImage(s)),this.sectionIndex.push(this.sections.length-1)):wn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Uy(o,e,s,c,f,g,x,C,M,P,j,$,W,Y,ee){const oe=ff.fromFeature(o,f);$===Pl.vertical&&oe.verticalizePunctuation(W);let de=[];const ve=function(Re,ot,nt,pt,Ot,ct){if(!Re)return[];const Ct=[],At=function(Qt,ln,tn,Hn,zt,bn){let Wn=0;for(let Ar=0;Ar<Qt.length();Ar++){const Zn=Qt.getSection(Ar);Wn+=Nb(Qt.getCharCode(Ar),Zn,Hn,zt,ln,bn)}return Wn/Math.max(1,Math.ceil(Wn/tn))}(Re,ot,nt,pt,Ot,ct),Mt=Re.text.indexOf("​")>=0;let kt=0;for(let Qt=0;Qt<Re.length();Qt++){const ln=Re.getSection(Qt),tn=Re.getCharCode(Qt);if(xg[tn]||(kt+=Nb(tn,ln,pt,Ot,ot,ct)),Qt<Re.length()-1){const Hn=!((ft=tn)<11904||!(Xt["Bopomofo Extended"](ft)||Xt.Bopomofo(ft)||Xt["CJK Compatibility Forms"](ft)||Xt["CJK Compatibility Ideographs"](ft)||Xt["CJK Compatibility"](ft)||Xt["CJK Radicals Supplement"](ft)||Xt["CJK Strokes"](ft)||Xt["CJK Symbols and Punctuation"](ft)||Xt["CJK Unified Ideographs Extension A"](ft)||Xt["CJK Unified Ideographs"](ft)||Xt["Enclosed CJK Letters and Months"](ft)||Xt["Halfwidth and Fullwidth Forms"](ft)||Xt.Hiragana(ft)||Xt["Ideographic Description Characters"](ft)||Xt["Kangxi Radicals"](ft)||Xt["Katakana Phonetic Extensions"](ft)||Xt.Katakana(ft)||Xt["Vertical Forms"](ft)||Xt["Yi Radicals"](ft)||Xt["Yi Syllables"](ft)));(zL[tn]||Hn||ln.imageName)&&Ct.push(Vb(Qt+1,kt,At,Ct,FL(tn,Re.getCharCode(Qt+1),Hn&&Mt),!1))}}var ft;return $b(Vb(Re.length(),kt,At,Ct,0,!0))}(oe,P,g,e,c,Y),{processBidirectionalText:Le,processStyledBidirectionalText:xe}=D;if(Le&&oe.sections.length===1){const Re=Le(oe.toString(),ve);for(const ot of Re){const nt=new ff;nt.text=ot,nt.sections=oe.sections;for(let pt=0;pt<ot.length;pt++)nt.sectionIndex.push(0);de.push(nt)}}else if(xe){const Re=xe(oe.text,oe.sectionIndex,ve);for(const ot of Re){const nt=new ff;nt.text=ot[0],nt.sectionIndex=ot[1],nt.sections=oe.sections,de.push(nt)}}else de=function(Re,ot){const nt=[],pt=Re.text;let Ot=0;for(const ct of ot)nt.push(Re.substring(Ot,ct)),Ot=ct;return Ot<pt.length&&nt.push(Re.substring(Ot,pt.length)),nt}(oe,ve);const Me=[],Oe={positionedLines:Me,text:oe.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:$,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Re,ot,nt,pt,Ot,ct,Ct,At,Mt,kt,ft,Qt){let ln=0,tn=0,Hn=0;const zt=At==="right"?1:At==="left"?0:.5;let bn=!1;for(const Kn of Ot){const Jn=Kn.getSections();for(const ii of Jn){if(ii.imageName)continue;const mi=ot[ii.fontStack];if(mi&&(bn=mi.ascender!==void 0&&mi.descender!==void 0,!bn))break}if(!bn)break}let Wn=0;for(const Kn of Ot){Kn.trim();const Jn=Kn.getMaxScale(),ii=(Jn-1)*ys,mi={positionedGlyphs:[],lineOffset:0};Re.positionedLines[Wn]=mi;const gi=mi.positionedGlyphs;let oi=0;if(!Kn.length()){tn+=ct,++Wn;continue}let Oi=0,qi=0;for(let si=0;si<Kn.length();si++){const Lo=Kn.getSection(si),fo=Kn.getSectionIndex(si),Ni=Kn.getCharCode(si);let Ir=Lo.scale,po=null,_i=null,ca=null,mo=ys,vs=0;const us=!(Mt===Pl.horizontal||!ft&&!id(Ni)||ft&&(xg[Ni]||(Ar=Ni,Xt.Arabic(Ar)||Xt["Arabic Supplement"](Ar)||Xt["Arabic Extended-A"](Ar)||Xt["Arabic Presentation Forms-A"](Ar)||Xt["Arabic Presentation Forms-B"](Ar))));if(Lo.imageName){const ua=pt[Lo.imageName];if(!ua)continue;ca=Lo.imageName,Re.iconsInText=Re.iconsInText||!0,_i=ua.paddedRect;const hs=ua.displaySize;Ir=Ir*ys/Qt,po={width:hs[0],height:hs[1],left:Ia,top:-Fb,advance:us?hs[1]:hs[0],localGlyph:!1},vs=bn?-po.height*Ir:Ub+Jn*ys-hs[1]*Ir,mo=po.advance;const Oc=(us?hs[0]:hs[1])*Ir-ys*Jn;Oc>0&&Oc>oi&&(oi=Oc)}else{const ua=nt[Lo.fontStack];if(!ua)continue;ua[Ni]&&(_i=ua[Ni]);const hs=ot[Lo.fontStack];if(!hs)continue;const Oc=hs.glyphs[Ni];if(!Oc)continue;if(po=Oc.metrics,mo=Ni!==8203?ys:0,bn){const xf=hs.ascender!==void 0?Math.abs(hs.ascender):0,em=hs.descender!==void 0?Math.abs(hs.descender):0,tm=(xf+em)*Ir;Oi<tm&&(Oi=tm,qi=(xf-em)/2*Ir),vs=-xf*Ir}else vs=Ub+(Jn-Ir)*ys}us?(Re.verticalizable=!0,gi.push({glyph:Ni,imageName:ca,x:ln,y:tn+vs,vertical:us,scale:Ir,localGlyph:po.localGlyph,fontStack:Lo.fontStack,sectionIndex:fo,metrics:po,rect:_i}),ln+=mo*Ir+kt):(gi.push({glyph:Ni,imageName:ca,x:ln,y:tn+vs,vertical:us,scale:Ir,localGlyph:po.localGlyph,fontStack:Lo.fontStack,sectionIndex:fo,metrics:po,rect:_i}),ln+=po.advance*Ir+kt)}gi.length!==0&&(Hn=Math.max(ln-kt,Hn),bn?Hb(gi,zt,oi,qi,ct*Jn/2):Hb(gi,zt,oi,0,ct/2)),ln=0;const ho=ct*Jn+oi;mi.lineOffset=Math.max(oi,ii),tn+=ho,++Wn}var Ar;const Zn=tn,{horizontalAlign:Bn,verticalAlign:xi}=Ny(Ct);(function(Kn,Jn,ii,mi,gi,oi){const Oi=(Jn-ii)*gi,qi=-oi*mi;for(const ho of Kn)for(const si of ho.positionedGlyphs)si.x+=Oi,si.y+=qi})(Re.positionedLines,zt,Bn,xi,Hn,Zn),Re.top+=-xi*Zn,Re.bottom=Re.top+Zn,Re.left+=-Bn*Hn,Re.right=Re.left+Hn,Re.hasBaseline=bn}(Oe,e,s,c,de,x,C,M,$,P,W,ee),!function(Re){for(const ot of Re)if(ot.positionedGlyphs.length!==0)return!1;return!0}(Me)&&Oe}const xg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Nb(o,e,s,c,f,g){if(e.imageName){const x=c[e.imageName];return x?x.displaySize[0]*e.scale*ys/g+f:0}{const x=s[e.fontStack],C=x&&x.glyphs[o];return C?C.metrics.advance*e.scale+f:0}}function Gb(o,e,s,c){const f=Math.pow(o-e,2);return c?o<e?f/2:2*f:f+Math.abs(s)*s}function FL(o,e,s){let c=0;return o===10&&(c-=1e4),s&&(c+=150),o!==40&&o!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function Vb(o,e,s,c,f,g){let x=null,C=Gb(e,s,f,g);for(const M of c){const P=Gb(e-M.x,s,f,g)+M.badness;P<=C&&(x=M,C=P)}return{index:o,x:e,priorBreak:x,badness:C}}function $b(o){return o?$b(o.priorBreak).concat(o.index):[]}function Ny(o){let e=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function Hb(o,e,s,c,f){if(!(e||s||c||f))return;const g=o.length-1,x=o[g],C=(x.x+x.metrics.advance*x.scale)*e;for(let M=0;M<=g;M++)o[M].x-=C,o[M].y+=s+c+f}function jL(o,e,s){const{horizontalAlign:c,verticalAlign:f}=Ny(s),g=e[0]-o.displaySize[0]*c,x=e[1]-o.displaySize[1]*f;return{image:o,top:x,bottom:x+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function Wb(o,e,s,c,f,g){const x=o.image;let C;if(x.content){const de=x.content,ve=x.pixelRatio||1;C=[de[0]/ve,de[1]/ve,x.displaySize[0]-de[2]/ve,x.displaySize[1]-de[3]/ve]}const M=e.left*g,P=e.right*g;let j,$,W,Y;s==="width"||s==="both"?(Y=f[0]+M-c[3],$=f[0]+P+c[1]):(Y=f[0]+(M+P-x.displaySize[0])/2,$=Y+x.displaySize[0]);const ee=e.top*g,oe=e.bottom*g;return s==="height"||s==="both"?(j=f[1]+ee-c[0],W=f[1]+oe+c[2]):(j=f[1]+(ee+oe-x.displaySize[1])/2,W=j+x.displaySize[1]),{image:x,top:j,right:$,bottom:W,left:Y,collisionPadding:C}}class Qu extends me{constructor(e,s,c,f,g){super(e,s),this.angle=f,this.z=c,g!==void 0&&(this.segment=g)}clone(){return new Qu(this.x,this.y,this.z,this.angle,this.segment)}}function Zb(o,e,s,c,f){if(e.segment===void 0)return!0;let g=e,x=e.segment+1,C=0;for(;C>-s/2;){if(x--,x<0)return!1;C-=o[x].dist(g),g=o[x]}C+=o[x].dist(o[x+1]),x++;const M=[];let P=0;for(;C<s/2;){const j=o[x],$=o[x+1];if(!$)return!1;let W=o[x-1].angleTo(j)-j.angleTo($);for(W=Math.abs((W+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:C,angleDelta:W}),P+=W;C-M[0].distance>c;)P-=M.shift().angleDelta;if(P>f)return!1;x++,C+=j.dist($)}return!0}function Xb(o){let e=0;for(let s=0;s<o.length-1;s++)e+=o[s].dist(o[s+1]);return e}function qb(o,e,s){return o?.6*e*s:0}function Kb(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function UL(o,e,s,c,f,g){const x=qb(s,f,g),C=Kb(s,c)*g;let M=0;const P=Xb(o)/2;for(let j=0;j<o.length-1;j++){const $=o[j],W=o[j+1],Y=$.dist(W);if(M+Y>P){const ee=(P-M)/Y,oe=Pn($.x,W.x,ee),de=Pn($.y,W.y,ee),ve=new Qu(oe,de,0,W.angleTo($),j);return!x||Zb(o,ve,C,x,e)?ve:void 0}M+=Y}}function NL(o,e,s,c,f,g,x,C,M){const P=qb(c,g,x),j=Kb(c,f),$=j*x,W=o[0].x===0||o[0].x===M||o[0].y===0||o[0].y===M;return e-$<e/4&&(e=$+e/4),Jb(o,W?e/2*C%e:(j/2+2*g)*x*C%e,e,P,s,$,W,!1,M)}function Jb(o,e,s,c,f,g,x,C,M){const P=g/2,j=Xb(o);let $=0,W=e-s,Y=[];for(let ee=0;ee<o.length-1;ee++){const oe=o[ee],de=o[ee+1],ve=oe.dist(de),Le=de.angleTo(oe);for(;W+s<$+ve;){W+=s;const xe=(W-$)/ve,Me=Pn(oe.x,de.x,xe),Oe=Pn(oe.y,de.y,xe);if(Me>=0&&Me<M&&Oe>=0&&Oe<M&&W-P>=0&&W+P<=j){const Re=new Qu(Me,Oe,0,Le,ee);Re._round(),c&&!Zb(o,Re,g,c,f)||Y.push(Re)}}$+=ve}return C||Y.length||x||(Y=Jb(o,$/2,s,c,f,g,x,!0,M)),Y}function Yb(o,e,s,c,f){const g=[];for(let x=0;x<o.length;x++){const C=o[x];let M;for(let P=0;P<C.length-1;P++){let j=C[P],$=C[P+1];j.x<e&&$.x<e||(j.x<e?j=new me(e,j.y+(e-j.x)/($.x-j.x)*($.y-j.y))._round():$.x<e&&($=new me(e,j.y+(e-j.x)/($.x-j.x)*($.y-j.y))._round()),j.y<s&&$.y<s||(j.y<s?j=new me(j.x+(s-j.y)/($.y-j.y)*($.x-j.x),s)._round():$.y<s&&($=new me(j.x+(s-j.y)/($.y-j.y)*($.x-j.x),s)._round()),j.x>=c&&$.x>=c||(j.x>=c?j=new me(c,j.y+(c-j.x)/($.x-j.x)*($.y-j.y))._round():$.x>=c&&($=new me(c,j.y+(c-j.x)/($.x-j.x)*($.y-j.y))._round()),j.y>=f&&$.y>=f||(j.y>=f?j=new me(j.x+(f-j.y)/($.y-j.y)*($.x-j.x),f)._round():$.y>=f&&($=new me(j.x+(f-j.y)/($.y-j.y)*($.x-j.x),f)._round()),M&&j.equals(M[M.length-1])||(M=[j],g.push(M)),M.push($)))))}}return g}on(Qu,"Anchor");const Hp=1e20;function Qb(o,e,s,c,f,g,x,C,M){for(let P=e;P<e+c;P++)ew(o,s*g+P,g,f,x,C,M);for(let P=s;P<s+f;P++)ew(o,P*g+e,1,c,x,C,M)}function ew(o,e,s,c,f,g,x){g[0]=0,x[0]=-Hp,x[1]=Hp,f[0]=o[e];for(let C=1,M=0,P=0;C<c;C++){f[C]=o[e+C*s];const j=C*C;do{const $=g[M];P=(f[C]-f[$]+j-$*$)/(C-$)/2}while(P<=x[M]&&--M>-1);M++,g[M]=C,x[M]=P,x[M+1]=Hp}for(let C=0,M=0;C<c;C++){for(;x[M+1]<C;)M++;const P=g[M],j=C-P;o[e+C*s]=f[P]+j*j}}const Rc=2,Gy={none:0,ideographs:1,all:2};class pf{constructor(e,s,c){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){const c=[];for(const f in e)for(const g of e[f])c.push({stack:f,id:g});mn(c,({stack:f,id:g},x)=>{let C=this.entries[f];C||(C=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=C.glyphs[g];if(M!==void 0)return void x(null,{stack:f,id:g,glyph:M});if(M=this._tinySDF(C,f,g),M)return C.glyphs[g]=M,void x(null,{stack:f,id:g,glyph:M});const P=Math.floor(g/256);if(256*P>65535)return void x(new Error("glyphs > 65535 not supported"));if(C.ranges[P])return void x(null,{stack:f,id:g,glyph:M});let j=C.requests[P];j||(j=C.requests[P]=[],pf.loadGlyphRange(f,P,this.url,this.requestManager,($,W)=>{if(W){C.ascender=W.ascender,C.descender=W.descender;for(const Y in W.glyphs)this._doesCharSupportLocalGlyph(+Y)||(C.glyphs[+Y]=W.glyphs[+Y]);C.ranges[P]=!0}for(const Y of j)Y($,W);delete C.requests[P]})),j.push(($,W)=>{$?x($):W&&x(null,{stack:f,id:g,glyph:W.glyphs[g]||null})})},(f,g)=>{if(f)s(f);else if(g){const x={};for(const{stack:C,id:M,glyph:P}of g)x[C]===void 0&&(x[C]={}),x[C].glyphs===void 0&&(x[C].glyphs={}),x[C].glyphs[M]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},x[C].ascender=this.entries[C].ascender,x[C].descender=this.entries[C].descender;s(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Gy.none&&(this.localGlyphMode===Gy.all?!!this.localFontFamily:!!this.localFontFamily&&(Xt["CJK Unified Ideographs"](e)||Xt["Hangul Syllables"](e)||Xt.Hiragana(e)||Xt.Katakana(e)||Xt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,s,c){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let g=e.tinySDF;if(!g){let oe="400";/bold/i.test(s)?oe="900":/medium/i.test(s)?oe="500":/light/i.test(s)&&(oe="200"),g=e.tinySDF=new pf.TinySDF({fontFamily:f,fontWeight:oe,fontSize:24*Rc,buffer:3*Rc,radius:8*Rc}),g.fontWeight=oe}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const x=String.fromCharCode(c),{data:C,width:M,height:P,glyphWidth:j,glyphHeight:$,glyphLeft:W,glyphTop:Y,glyphAdvance:ee}=g.draw(x);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Ju({width:M,height:P},C),metrics:{width:j/Rc,height:$/Rc,left:W/Rc,top:Y/Rc-27,advance:ee/Rc,localGlyph:!0}}}}pf.loadGlyphRange=function(o,e,s,c,f){const g=256*e,x=g+255,C=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${g}-${x}`),Ko.Glyphs);In(C,(M,P)=>{if(M)f(M);else if(P){const j={},$=function(W){return new vg(W).readFields(DL,{})}(P);for(const W of $.glyphs)j[W.id]=W;f(null,{glyphs:j,ascender:$.ascender,descender:$.descender})}})},pf.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:s=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=s;const C=this.size=o+4*e,M=this._createCanvas(C),P=this.ctx=M.getContext("2d",{willReadFrequently:!0});P.font=`${x} ${g} ${o}px ${f}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(o),x=Math.ceil(s),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),M=Math.min(this.size-this.buffer,x+Math.ceil(c)),P=C+2*this.buffer,j=M+2*this.buffer,$=Math.max(P*j,0),W=new Uint8ClampedArray($),Y={data:W,width:P,height:j,glyphWidth:C,glyphHeight:M,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(C===0||M===0)return Y;const{ctx:ee,buffer:oe,gridInner:de,gridOuter:ve}=this;ee.clearRect(oe,oe,C,M),ee.fillText(o,oe,oe+x);const Le=ee.getImageData(oe,oe,C,M);ve.fill(Hp,0,$),de.fill(0,0,$);for(let xe=0;xe<M;xe++)for(let Me=0;Me<C;Me++){const Oe=Le.data[4*(xe*C+Me)+3]/255;if(Oe===0)continue;const Re=(xe+oe)*P+Me+oe;if(Oe===1)ve[Re]=0,de[Re]=Hp;else{const ot=.5-Oe;ve[Re]=ot>0?ot*ot:0,de[Re]=ot<0?ot*ot:0}}Qb(ve,0,0,P,j,P,this.f,this.v,this.z),Qb(de,oe,oe,C,M,P,this.f,this.v,this.z);for(let xe=0;xe<$;xe++){const Me=Math.sqrt(ve[xe])-Math.sqrt(de[xe]);W[xe]=Math.round(255-255*(Me/this.radius+this.cutoff))}return Y}};const mf=Ia;function tw(o,e,s,c){const f=[],g=o.image,x=g.pixelRatio,C=g.paddedRect.w-2*mf,M=g.paddedRect.h-2*mf,P=o.right-o.left,j=o.bottom-o.top,$=g.stretchX||[[0,C]],W=g.stretchY||[[0,M]],Y=(ct,Ct)=>ct+Ct[1]-Ct[0],ee=$.reduce(Y,0),oe=W.reduce(Y,0),de=C-ee,ve=M-oe;let Le=0,xe=ee,Me=0,Oe=oe,Re=0,ot=de,nt=0,pt=ve;if(g.content&&c){const ct=g.content;Le=bg($,0,ct[0]),Me=bg(W,0,ct[1]),xe=bg($,ct[0],ct[2]),Oe=bg(W,ct[1],ct[3]),Re=ct[0]-Le,nt=ct[1]-Me,ot=ct[2]-ct[0]-xe,pt=ct[3]-ct[1]-Oe}const Ot=(ct,Ct,At,Mt)=>{const kt=wg(ct.stretch-Le,xe,P,o.left),ft=Eg(ct.fixed-Re,ot,ct.stretch,ee),Qt=wg(Ct.stretch-Me,Oe,j,o.top),ln=Eg(Ct.fixed-nt,pt,Ct.stretch,oe),tn=wg(At.stretch-Le,xe,P,o.left),Hn=Eg(At.fixed-Re,ot,At.stretch,ee),zt=wg(Mt.stretch-Me,Oe,j,o.top),bn=Eg(Mt.fixed-nt,pt,Mt.stretch,oe),Wn=new me(kt,Qt),Ar=new me(tn,Qt),Zn=new me(tn,zt),Bn=new me(kt,zt),xi=new me(ft/x,ln/x),Kn=new me(Hn/x,bn/x),Jn=e*Math.PI/180;if(Jn){const gi=Math.sin(Jn),oi=Math.cos(Jn),Oi=[oi,-gi,gi,oi];Wn._matMult(Oi),Ar._matMult(Oi),Bn._matMult(Oi),Zn._matMult(Oi)}const ii=ct.stretch+ct.fixed,mi=Ct.stretch+Ct.fixed;return{tl:Wn,tr:Ar,bl:Bn,br:Zn,tex:{x:g.paddedRect.x+mf+ii,y:g.paddedRect.y+mf+mi,w:At.stretch+At.fixed-ii,h:Mt.stretch+Mt.fixed-mi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xi,pixelOffsetBR:Kn,minFontScaleX:ot/x/P,minFontScaleY:pt/x/j,isSDF:s}};if(c&&(g.stretchX||g.stretchY)){const ct=nw($,de,ee),Ct=nw(W,ve,oe);for(let At=0;At<ct.length-1;At++){const Mt=ct[At],kt=ct[At+1];for(let ft=0;ft<Ct.length-1;ft++)f.push(Ot(Mt,Ct[ft],kt,Ct[ft+1]))}}else f.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:M+1}));return f}function bg(o,e,s){let c=0;for(const f of o)c+=Math.max(e,Math.min(s,f[1]))-Math.max(e,Math.min(s,f[0]));return c}function nw(o,e,s){const c=[{fixed:-mf,stretch:0}];for(const[f,g]of o){const x=c[c.length-1];c.push({fixed:f-x.stretch,stretch:x.stretch}),c.push({fixed:f-x.stretch,stretch:x.stretch+(g-f)})}return c.push({fixed:e+mf,stretch:s}),c}function wg(o,e,s,c){return o/e*s+c}function Eg(o,e,s,c){return o-e*s/c}function GL(o,e,s,c){const f=e+o.positionedLines[c].lineOffset;return c===0?s+f/2:s+(f+(e+o.positionedLines[c-1].lineOffset))/2}class VL{constructor(e=[],s=$L){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:c}=this,f=s[e];for(;e>0;){const g=e-1>>1,x=s[g];if(c(f,x)>=0)break;s[e]=x,e=g}s[e]=f}_down(e){const{data:s,compare:c}=this,f=this.length>>1,g=s[e];for(;e<f;){let x=1+(e<<1),C=s[x];const M=x+1;if(M<this.length&&c(s[M],C)<0&&(x=M,C=s[M]),c(C,g)>=0)break;s[e]=C,e=x}s[e]=g}}function $L(o,e){return o<e?-1:o>e?1:0}function HL(o,e=1,s=!1){let c=1/0,f=1/0,g=-1/0,x=-1/0;const C=o[0];for(let Y=0;Y<C.length;Y++){const ee=C[Y];(!Y||ee.x<c)&&(c=ee.x),(!Y||ee.y<f)&&(f=ee.y),(!Y||ee.x>g)&&(g=ee.x),(!Y||ee.y>x)&&(x=ee.y)}const M=Math.min(g-c,x-f);let P=M/2;const j=new VL([],WL);if(M===0)return new me(c,f);for(let Y=c;Y<g;Y+=M)for(let ee=f;ee<x;ee+=M)j.push(new gf(Y+P,ee+P,P,o));let $=function(Y){let ee=0,oe=0,de=0;const ve=Y[0];for(let Le=0,xe=ve.length,Me=xe-1;Le<xe;Me=Le++){const Oe=ve[Le],Re=ve[Me],ot=Oe.x*Re.y-Re.x*Oe.y;oe+=(Oe.x+Re.x)*ot,de+=(Oe.y+Re.y)*ot,ee+=3*ot}return new gf(oe/ee,de/ee,0,Y)}(o),W=j.length;for(;j.length;){const Y=j.pop();(Y.d>$.d||!$.d)&&($=Y,s&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,W)),Y.max-$.d<=e||(P=Y.h/2,j.push(new gf(Y.p.x-P,Y.p.y-P,P,o)),j.push(new gf(Y.p.x+P,Y.p.y-P,P,o)),j.push(new gf(Y.p.x-P,Y.p.y+P,P,o)),j.push(new gf(Y.p.x+P,Y.p.y+P,P,o)),W+=4)}return s&&(console.log(`num probes: ${W}`),console.log(`best distance: ${$.d}`)),$.p}function WL(o,e){return e.max-o.max}class gf{constructor(e,s,c,f){this.p=new me(e,s),this.h=c,this.d=function(g,x){let C=!1,M=1/0;for(let P=0;P<x.length;P++){const j=x[P];for(let $=0,W=j.length,Y=W-1;$<W;Y=$++){const ee=j[$],oe=j[Y];ee.y>g.y!=oe.y>g.y&&g.x<(oe.x-ee.x)*(g.y-ee.y)/(oe.y-ee.y)+ee.x&&(C=!C),M=Math.min(M,Jx(g,ee,oe))}}return(C?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const _f=7,Vy=Number.POSITIVE_INFINITY,ZL=Math.sqrt(2);function rw(o,[e,s]){let c=0,f=0;if(s===Vy){e<0&&(e=0);const g=e/ZL;switch(o){case"top-right":case"top-left":f=g-_f;break;case"bottom-right":case"bottom-left":f=-g+_f;break;case"bottom":f=-e+_f;break;case"top":f=e-_f}switch(o){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),s=Math.abs(s),o){case"top-right":case"top-left":case"top":f=s-_f;break;case"bottom-right":case"bottom-left":case"bottom":f=-s+_f}switch(o){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,f]}function XL(o,e,s,c,f,g,x,C,M,P){o.createArrays(),o.tilePixelRatio=_n/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const j=o.layers[0].layout,$=o.layers[0]._unevaluatedLayout._values,W={};if(o.textSizeData.kind==="composite"){const{minZoom:oe,maxZoom:de}=o.textSizeData;W.compositeTextSizes=[$["text-size"].possiblyEvaluate(new G(oe),C),$["text-size"].possiblyEvaluate(new G(de),C)]}if(o.iconSizeData.kind==="composite"){const{minZoom:oe,maxZoom:de}=o.iconSizeData;W.compositeIconSizes=[$["icon-size"].possiblyEvaluate(new G(oe),C),$["icon-size"].possiblyEvaluate(new G(de),C)]}W.layoutTextSize=$["text-size"].possiblyEvaluate(new G(M+1),C),W.layoutIconSize=$["icon-size"].possiblyEvaluate(new G(M+1),C),W.textMaxSize=$["text-size"].possiblyEvaluate(new G(18),C);const Y=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",ee=j.get("text-size");for(const oe of o.features){const de=j.get("text-font").evaluate(oe,{},C).join(","),ve=ee.evaluate(oe,{},C),Le=W.layoutTextSize.evaluate(oe,{},C),xe=(W.layoutIconSize.evaluate(oe,{},C),{horizontal:{},vertical:void 0}),Me=oe.text;let Oe,Re=[0,0];if(Me){const pt=Me.toString(),Ot=j.get("text-letter-spacing").evaluate(oe,{},C)*ys,ct=j.get("text-line-height").evaluate(oe,{},C)*ys,Ct=Sl(pt)?Ot:0,At=j.get("text-anchor").evaluate(oe,{},C),Mt=j.get("text-variable-anchor");if(!Mt){const tn=j.get("text-radial-offset").evaluate(oe,{},C);Re=tn?rw(At,[tn*ys,Vy]):j.get("text-offset").evaluate(oe,{},C).map(Hn=>Hn*ys)}let kt=Y?"center":j.get("text-justify").evaluate(oe,{},C);const ft=j.get("symbol-placement")==="point",Qt=ft?j.get("text-max-width").evaluate(oe,{},C)*ys:1/0,ln=tn=>{o.allowVerticalPlacement&&Ah(pt)&&(xe.vertical=Uy(Me,e,s,f,de,Qt,ct,At,tn,Ct,Re,Pl.vertical,!0,Le,ve))};if(!Y&&Mt){const tn=kt==="auto"?Mt.map(zt=>$y(zt)):[kt];let Hn=!1;for(let zt=0;zt<tn.length;zt++){const bn=tn[zt];if(!xe.horizontal[bn])if(Hn)xe.horizontal[bn]=xe.horizontal[0];else{const Wn=Uy(Me,e,s,f,de,Qt,ct,"center",bn,Ct,Re,Pl.horizontal,!1,Le,ve);Wn&&(xe.horizontal[bn]=Wn,Hn=Wn.positionedLines.length===1)}}ln("left")}else{if(kt==="auto"&&(kt=$y(At)),ft||j.get("text-writing-mode").indexOf("horizontal")>=0||!Ah(pt)){const tn=Uy(Me,e,s,f,de,Qt,ct,At,kt,Ct,Re,Pl.horizontal,!1,Le,ve);tn&&(xe.horizontal[kt]=tn)}ln(ft?"left":kt)}}let ot=!1;if(oe.icon&&oe.icon.name){const pt=c[oe.icon.name];pt&&(Oe=jL(f[oe.icon.name],j.get("icon-offset").evaluate(oe,{},C),j.get("icon-anchor").evaluate(oe,{},C)),ot=pt.sdf,o.sdfIcons===void 0?o.sdfIcons=pt.sdf:o.sdfIcons!==pt.sdf&&wn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pt.pixelRatio!==o.pixelRatio||j.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const nt=ow(xe.horizontal)||xe.vertical;o.iconsInText||(o.iconsInText=!!nt&&nt.iconsInText),(nt||Oe)&&qL(o,oe,xe,Oe,c,W,Le,0,Re,ot,x,C,P)}g&&o.generateCollisionDebugBuffers(M,o.collisionBoxArray)}function $y(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qL(o,e,s,c,f,g,x,C,M,P,j,$,W){let Y=g.textMaxSize.evaluate(e,{},$);Y===void 0&&(Y=x);const ee=o.layers[0].layout,oe=ee.get("icon-offset").evaluate(e,{},$),de=ow(s.horizontal)||s.vertical,ve=W.name==="globe",Le=ys,xe=x/Le,Me=o.tilePixelRatio*Y/Le,Oe=(At=o.overscaling,o.zoom>18&&At>2&&(At>>=1),Math.max(_n/(512*At),1)*ee.get("symbol-spacing")),Re=ee.get("text-padding")*o.tilePixelRatio,ot=ee.get("icon-padding")*o.tilePixelRatio,nt=_t(ee.get("text-max-angle")),pt=ee.get("text-rotation-alignment")==="map"&&ee.get("symbol-placement")!=="point",Ot=ee.get("icon-rotation-alignment")==="map"&&ee.get("symbol-placement")!=="point",ct=ee.get("symbol-placement"),Ct=Oe/2;var At;const Mt=ee.get("icon-text-fit");let kt;c&&Mt!=="none"&&(o.allowVerticalPlacement&&s.vertical&&(kt=Wb(c,s.vertical,Mt,ee.get("icon-text-fit-padding"),oe,xe)),de&&(c=Wb(c,de,Mt,ee.get("icon-text-fit-padding"),oe,xe)));const ft=(Qt,ln,tn)=>{if(ln.x<0||ln.x>=_n||ln.y<0||ln.y>=_n)return;let Hn=null;if(ve){const{x:zt,y:bn,z:Wn}=W.projectTilePoint(ln.x,ln.y,tn);Hn={anchor:new Qu(zt,bn,Wn,0,void 0),up:W.upVector(tn,ln.x,ln.y)}}(function(zt,bn,Wn,Ar,Zn,Bn,xi,Kn,Jn,ii,mi,gi,oi,Oi,qi,ho,si,Lo,fo,Ni,Ir,po,_i,ca,mo){const vs=zt.addToLineVertexArray(bn,Ar);let us,ua,hs,Oc,xf,em,tm,Fw=0,jw=0,Uw=0,Nw=0,o0=-1,s0=-1;const mu={};let Gw=Kd("");const _d=Wn?Wn.anchor:bn;let a0=0,l0=0;if(Jn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[a0,l0]=Jn.layout.get("text-offset").evaluate(Ir,{},mo).map(ul=>ul*ys):(a0=Jn.layout.get("text-radial-offset").evaluate(Ir,{},mo)*ys,l0=Vy),zt.allowVerticalPlacement&&Zn.vertical){const ul=Zn.vertical;if(qi)em=Hy(ul),Kn&&(tm=Hy(Kn));else{const hl=Jn.layout.get("text-rotate").evaluate(Ir,{},mo)+90;hs=Cg(ii,_d,bn,mi,gi,oi,ul,Oi,hl,ho),Kn&&(Oc=Cg(ii,_d,bn,mi,gi,oi,Kn,Lo,hl))}}if(Bn){const ul=Jn.layout.get("icon-rotate").evaluate(Ir,{},mo),hl=Jn.layout.get("icon-text-fit")!=="none",nm=tw(Bn,ul,_i,hl),u0=Kn?tw(Kn,ul,_i,hl):void 0;ua=Cg(ii,_d,bn,mi,gi,oi,Bn,Lo,ul),Fw=4*nm.length;const Vw=zt.iconSizeData;let yd=null;Vw.kind==="source"?(yd=[Bc*Jn.layout.get("icon-size").evaluate(Ir,{},mo)],yd[0]>Ph&&wn(`${zt.layerIds[0]}: Value for "icon-size" is >= ${Wp}. Reduce your "icon-size".`)):Vw.kind==="composite"&&(yd=[Bc*po.compositeIconSizes[0].evaluate(Ir,{},mo),Bc*po.compositeIconSizes[1].evaluate(Ir,{},mo)],(yd[0]>Ph||yd[1]>Ph)&&wn(`${zt.layerIds[0]}: Value for "icon-size" is >= ${Wp}. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,nm,yd,Ni,fo,Ir,!1,Wn,bn,vs.lineStartIndex,vs.lineLength,-1,ca,mo),o0=zt.icon.placedSymbolArray.length-1,u0&&(jw=4*u0.length,zt.addSymbols(zt.icon,u0,yd,Ni,fo,Ir,Pl.vertical,Wn,bn,vs.lineStartIndex,vs.lineLength,-1,ca,mo),s0=zt.icon.placedSymbolArray.length-1)}for(const ul in Zn.horizontal){const hl=Zn.horizontal[ul];us||(Gw=Kd(hl.text),qi?xf=Hy(hl):us=Cg(ii,_d,bn,mi,gi,oi,hl,Oi,Jn.layout.get("text-rotate").evaluate(Ir,{},mo),ho));const nm=hl.positionedLines.length===1;if(Uw+=iw(zt,Wn,bn,hl,xi,Jn,qi,Ir,ho,vs,Zn.vertical?Pl.horizontal:Pl.horizontalOnly,nm?Object.keys(Zn.horizontal):[ul],mu,o0,po,ca,mo),nm)break}Zn.vertical&&(Nw+=iw(zt,Wn,bn,Zn.vertical,xi,Jn,qi,Ir,ho,vs,Pl.vertical,["vertical"],mu,s0,po,ca,mo));let kh=-1;const c0=(ul,hl)=>ul?Math.max(ul,hl):hl;kh=c0(xf,kh),kh=c0(em,kh),kh=c0(tm,kh);const EB=kh>-1?1:0;zt.glyphOffsetArray.length>=Bh.MAX_GLYPHS&&wn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ir.sortKey!==void 0&&zt.addToSortKeyRanges(zt.symbolInstances.length,Ir.sortKey),zt.symbolInstances.emplaceBack(_d.x,_d.y,_d.z,bn.x,bn.y,mu.right>=0?mu.right:-1,mu.center>=0?mu.center:-1,mu.left>=0?mu.left:-1,mu.vertical>=0?mu.vertical:-1,o0,s0,Gw,us!==void 0?us:zt.collisionBoxArray.length,us!==void 0?us+1:zt.collisionBoxArray.length,hs!==void 0?hs:zt.collisionBoxArray.length,hs!==void 0?hs+1:zt.collisionBoxArray.length,ua!==void 0?ua:zt.collisionBoxArray.length,ua!==void 0?ua+1:zt.collisionBoxArray.length,Oc||zt.collisionBoxArray.length,Oc?Oc+1:zt.collisionBoxArray.length,mi,Uw,Nw,Fw,jw,EB,0,a0,l0,kh)})(o,ln,Hn,Qt,s,c,f,kt,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,Re,pt,M,0,ot,Ot,oe,e,g,P,j,$)};if(ct==="line")for(const Qt of Yb(e.geometry,0,0,_n,_n)){const ln=NL(Qt,Oe,nt,s.vertical||de,c,Le,Me,o.overscaling,_n);for(const tn of ln)de&&KL(o,de.text,Ct,tn)||ft(Qt,tn,$)}else if(ct==="line-center"){for(const Qt of e.geometry)if(Qt.length>1){const ln=UL(Qt,nt,s.vertical||de,c,Le,Me);ln&&ft(Qt,ln,$)}}else if(e.type==="Polygon")for(const Qt of Ly(e.geometry,0)){const ln=HL(Qt,16);ft(Qt[0],new Qu(ln.x,ln.y,0,0,void 0),$)}else if(e.type==="LineString")for(const Qt of e.geometry)ft(Qt,new Qu(Qt[0].x,Qt[0].y,0,0,void 0),$);else if(e.type==="Point")for(const Qt of e.geometry)for(const ln of Qt)ft([ln],new Qu(ln.x,ln.y,0,0,void 0),$)}const Wp=255,Ph=Wp*Bc;function iw(o,e,s,c,f,g,x,C,M,P,j,$,W,Y,ee,oe,de){const ve=function(Me,Oe,Re,ot,nt,pt,Ot,ct){const Ct=[];if(Oe.positionedLines.length===0)return Ct;const At=ot.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,Mt=function(tn){const Hn=tn[0],zt=tn[1],bn=Hn*zt;return bn>0?[Hn,-zt]:bn<0?[-Hn,zt]:Hn===0?[zt,Hn]:[zt,-Hn]}(Re);let kt=Math.abs(Oe.top-Oe.bottom);for(const tn of Oe.positionedLines)kt-=tn.lineOffset;const ft=Oe.positionedLines.length,Qt=kt/ft;let ln=Oe.top-Re[1];for(let tn=0;tn<ft;++tn){const Hn=Oe.positionedLines[tn];ln=GL(Oe,Qt,ln,tn);for(const zt of Hn.positionedGlyphs){if(!zt.rect)continue;const bn=zt.rect||{};let Wn=Fb+1,Ar=!0,Zn=1,Bn=0;if(zt.imageName){const _i=Ot[zt.imageName];if(!_i)continue;if(_i.sdf){wn("SDF images are not supported in formatted text and will be ignored.");continue}Ar=!1,Zn=_i.pixelRatio,Wn=Ia/Zn}const xi=(nt||ct)&&zt.vertical,Kn=zt.metrics.advance*zt.scale/2,Jn=zt.metrics,ii=zt.rect;if(ii===null)continue;ct&&Oe.verticalizable&&(Bn=zt.imageName?Kn-zt.metrics.width*zt.scale/2:0);const mi=nt?[zt.x+Kn,zt.y]:[0,0];let gi=[0,0],oi=[0,0],Oi=!1;nt||(xi?(oi=[zt.x+Kn+Mt[0],zt.y+Mt[1]-Bn],Oi=!0):gi=[zt.x+Kn+Re[0],zt.y+Re[1]-Bn]);const qi=ii.w*zt.scale/(Zn*(zt.localGlyph?Rc:1)),ho=ii.h*zt.scale/(Zn*(zt.localGlyph?Rc:1));let si,Lo,fo,Ni;if(xi){const _i=zt.y-ln,ca=new me(-Kn,Kn-_i),mo=-Math.PI/2,vs=new me(...oi);si=new me(-Kn+gi[0],gi[1]),si._rotateAround(mo,ca)._add(vs),si.x+=-_i+Kn,si.y-=(Jn.left-Wn)*zt.scale;const us=zt.imageName?Jn.advance*zt.scale:ys*zt.scale,ua=String.fromCharCode(zt.glyph);EL(ua)?si.x+=(1-Wn)*zt.scale:CL(ua)?si.x+=us-Jn.height*zt.scale+(-Wn-1)*zt.scale:si.x+=zt.imageName||Jn.width+2*Wn===ii.w&&Jn.height+2*Wn===ii.h?(us-ho)/2:(us-(Jn.height+2*Wn)*zt.scale)/2,Lo=new me(si.x,si.y-qi),fo=new me(si.x+ho,si.y),Ni=new me(si.x+ho,si.y-qi)}else{const _i=(Jn.left-Wn)*zt.scale-Kn+gi[0],ca=(-Jn.top-Wn)*zt.scale+gi[1],mo=_i+qi,vs=ca+ho;si=new me(_i,ca),Lo=new me(mo,ca),fo=new me(_i,vs),Ni=new me(mo,vs)}if(At){let _i;_i=nt?new me(0,0):Oi?new me(Mt[0],Mt[1]):new me(Re[0],Re[1]),si._rotateAround(At,_i),Lo._rotateAround(At,_i),fo._rotateAround(At,_i),Ni._rotateAround(At,_i)}const Ir=new me(0,0),po=new me(0,0);Ct.push({tl:si,tr:Lo,bl:fo,br:Ni,tex:bn,writingMode:Oe.writingMode,glyphOffset:mi,sectionIndex:zt.sectionIndex,isSDF:Ar,pixelOffsetTL:Ir,pixelOffsetBR:po,minFontScaleX:0,minFontScaleY:0})}}return Ct}(0,c,M,g,x,C,f,o.allowVerticalPlacement),Le=o.textSizeData;let xe=null;Le.kind==="source"?(xe=[Bc*g.layout.get("text-size").evaluate(C,{},de)],xe[0]>Ph&&wn(`${o.layerIds[0]}: Value for "text-size" is >= ${Wp}. Reduce your "text-size".`)):Le.kind==="composite"&&(xe=[Bc*ee.compositeTextSizes[0].evaluate(C,{},de),Bc*ee.compositeTextSizes[1].evaluate(C,{},de)],(xe[0]>Ph||xe[1]>Ph)&&wn(`${o.layerIds[0]}: Value for "text-size" is >= ${Wp}. Reduce your "text-size".`)),o.addSymbols(o.text,ve,xe,M,x,C,j,e,s,P.lineStartIndex,P.lineLength,Y,oe,de);for(const Me of $)W[Me]=o.text.placedSymbolArray.length-1;return 4*ve.length}function ow(o){for(const e in o)return o[e];return null}function Cg(o,e,s,c,f,g,x,C,M,P){let j=x.top,$=x.bottom,W=x.left,Y=x.right;const ee=x.collisionPadding;if(ee&&(W-=ee[0],j-=ee[1],Y+=ee[2],$+=ee[3]),M){const oe=new me(W,j),de=new me(Y,j),ve=new me(W,$),Le=new me(Y,$),xe=_t(M);let Me=new me(0,0);P&&(Me=new me(P[0],P[1])),oe._rotateAround(xe,Me),de._rotateAround(xe,Me),ve._rotateAround(xe,Me),Le._rotateAround(xe,Me),W=Math.min(oe.x,de.x,ve.x,Le.x),Y=Math.max(oe.x,de.x,ve.x,Le.x),j=Math.min(oe.y,de.y,ve.y,Le.y),$=Math.max(oe.y,de.y,ve.y,Le.y)}return o.emplaceBack(e.x,e.y,e.z,s.x,s.y,W,j,Y,$,C,c,f,g),o.length-1}function Hy(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function KL(o,e,s,c){const f=o.compareText;if(e in f){const g=f[e];for(let x=g.length-1;x>=0;x--)if(c.dist(g[x])<s)return!0}else f[e]=[];return f[e].push(c),!1}function sw(o,e){const s=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,f=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),g=Math.sin(s)*f/Math.sin(Math.max(Math.PI/2-o._pitch-s,.01)),x=Math.sin(o._pitch)*g+f;return Math.min(1.01*x,f*(1/o._horizonShift))}function md(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const s=Math.pow(2,-o.z),c=o.x*s,f=(o.x+1)*s,g=o.y*s,x=(o.y+1)*s,C=Il(c),M=Il(f),P=Is(g),j=Is(x),$=e.project(C,P),W=e.project(M,P),Y=e.project(M,j),ee=e.project(C,j);let oe=Math.min($.x,W.x,Y.x,ee.x),de=Math.min($.y,W.y,Y.y,ee.y),ve=Math.max($.x,W.x,Y.x,ee.x),Le=Math.max($.y,W.y,Y.y,ee.y);const xe=s/16;function Me(Re,ot,nt,pt,Ot,ct){const Ct=(nt+Ot)/2,At=(pt+ct)/2,Mt=e.project(Il(Ct),Is(At)),kt=Math.max(0,oe-Mt.x,de-Mt.y,Mt.x-ve,Mt.y-Le);oe=Math.min(oe,Mt.x),ve=Math.max(ve,Mt.x),de=Math.min(de,Mt.y),Le=Math.max(Le,Mt.y),kt>xe&&(Me(Re,Mt,nt,pt,Ct,At),Me(Mt,ot,Ct,At,Ot,ct))}Me($,W,c,g,f,g),Me(W,Y,f,g,f,x),Me(Y,ee,f,x,c,x),Me(ee,$,c,x,c,g),oe-=xe,de-=xe,ve+=xe,Le+=xe;const Oe=1/Math.max(ve-oe,Le-de);return{scale:Oe,x:oe*Oe,y:de*Oe,x2:ve*Oe,y2:Le*Oe,projection:e}}const JL=ll(new Float32Array(16));class Lh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,s){return{x:0,y:0,z:0}}unproject(e,s){return new ri(0,0)}projectTilePoint(e,s,c){return{x:e,y:s,z:0}}locationPoint(e,s,c=!0){return e._coordinatePoint(e.locationCoordinate(s),c)}pixelsPerMeter(e,s){return Lc(1,e)*s}pixelSpaceConversion(e,s,c){return 1}farthestPixelDistance(e){return sw(e,e.pixelsPerMeter)}pointCoordinate(e,s,c,f){const g=e.horizonLineFromTop(!1),x=new me(s,Math.max(g,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(x,f))}pointCoordinate3D(e,s,c){const f=new me(s,c);if(e.elevation)return e.elevation.pointCoordinate(f);{const g=this.pointCoordinate(e,f.x,f.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,s){if(e.elevation)return!this.pointCoordinate3D(e,s.x,s.y);const c=e.horizonLineFromTop();return s.y<c}createInversionMatrix(e,s){return JL}createTileMatrix(e,s,c){let f,g,x;const C=c.canonical,M=ll(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=md(C,this);f=1,g=P.x+c.wrap*P.scale,x=P.y,qu(M,M,[f/P.scale,f/P.scale,e.pixelsPerMeter/s])}else f=s/e.zoomScale(C.z),g=(C.x+Math.pow(2,C.z)*c.wrap)*f,x=C.y*f;return cd(M,M,[g,x,0]),qu(M,M,[f/_n,f/_n,1]),M}upVector(e,s,c){return[0,0,1]}upVectorScale(e,s,c){return{metersToTile:1}}}class YL extends Lh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[s,c]=this.parallels=e.parallels||[29.5,45.5],f=Math.sin(_t(s));this.n=(f+Math.sin(_t(c)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(e,s){const{n:c,c:f,r0:g}=this,x=_t(e-this.center[0]),C=_t(s),M=Math.sqrt(f-2*c*Math.sin(C))/c;return{x:M*Math.sin(x*c),y:M*Math.cos(x*c)-g,z:0}}unproject(e,s){const{n:c,c:f,r0:g}=this,x=g+s;let C=Math.atan2(e,Math.abs(x))*Math.sign(x);x*c<0&&(C-=Math.PI*Math.sign(e)*Math.sign(x));const M=_t(this.center[0])*c;C=Zt(C,-Math.PI-M,Math.PI-M);const P=bt(Bt(C/c)+this.center[0],-180,180),j=Math.asin(bt((f-(e*e+x*x)*c*c)/(2*c),-1,1)),$=bt(Bt(j),-Ps,Ps);return new ri(P,$)}}const Zp=1.340264,Xp=-.081106,qp=893e-6,Kp=.003796,Ag=Math.sqrt(3)/2;class QL extends Lh{project(e,s){s=s/180*Math.PI,e=e/180*Math.PI;const c=Math.asin(Ag*Math.sin(s)),f=c*c,g=f*f*f;return{x:.5*(e*Math.cos(c)/(Ag*(Zp+3*Xp*f+g*(7*qp+9*Kp*f)))/Math.PI+.5),y:1-.5*(c*(Zp+Xp*f+g*(qp+Kp*f))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,f=c*c,g=f*f*f;for(let j,$,W,Y=0;Y<12&&($=c*(Zp+Xp*f+g*(qp+Kp*f))-s,W=Zp+3*Xp*f+g*(7*qp+9*Kp*f),j=$/W,c=bt(c-j,-Math.PI/3,Math.PI/3),f=c*c,g=f*f*f,!(Math.abs(j)<1e-12));++Y);const x=Ag*e*(Zp+3*Xp*f+g*(7*qp+9*Kp*f))/Math.cos(c),C=Math.asin(Math.sin(c)/Ag),M=bt(180*x/Math.PI,-180,180),P=bt(180*C/Math.PI,-Ps,Ps);return new ri(M,P)}}class eB extends Lh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){return{x:.5+e/360,y:.5-s/360,z:0}}unproject(e,s){const c=360*(e-.5),f=bt(360*(.5-s),-Ps,Ps);return new ri(c,f)}}const yf=Math.PI/2;function Tg(o){return Math.tan((yf+o)/2)}class tB extends Lh{constructor(e){super(e),this.center=e.center||[0,30];const[s,c]=this.parallels=e.parallels||[30,30];let f=_t(s),g=_t(c);this.southernCenter=f+g<0,this.southernCenter&&(f=-f,g=-g);const x=Math.cos(f),C=Tg(f);this.n=f===g?Math.sin(f):Math.log(x/Math.cos(g))/Math.log(Tg(g)/C),this.f=x*Math.pow(Tg(f),this.n)/this.n}project(e,s){s=_t(s),this.southernCenter&&(s=-s),e=_t(e-this.center[0]);const c=1e-6,{n:f,f:g}=this;g>0?s<-yf+c&&(s=-yf+c):s>yf-c&&(s=yf-c);const x=g/Math.pow(Tg(s),f);let C=x*Math.sin(f*e),M=g-x*Math.cos(f*e);return C=.5*(C/Math.PI+.5),M=.5*(M/Math.PI+.5),{x:C,y:this.southernCenter?M:1-M,z:0}}unproject(e,s){e=(2*e-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f}=this,g=f-s,x=Math.sign(g),C=Math.sign(c)*Math.sqrt(e*e+g*g);let M=Math.atan2(e,Math.abs(g))*x;g*c<0&&(M-=Math.PI*Math.sign(e)*x);const P=bt(Bt(M/c)+this.center[0],-180,180),j=bt(Bt(2*Math.atan(Math.pow(f/C,1/c))-yf),-Ps,Ps);return new ri(P,this.southernCenter?-j:j)}}class aw extends Lh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,s){return{x:uu(e),y:hu(s),z:0}}unproject(e,s){const c=Il(e),f=Is(s);return new ri(c,f)}}const lw=_t(Ps);class nB extends Lh{project(e,s){const c=(s=_t(s))*s,f=c*c;return{x:.5*((e=_t(e))*(.8707-.131979*c+f*(f*(.003971*c-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+f*(.028874*c-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,f=25,g=0,x=c*c;do{x=c*c;const P=x*x;g=(c*(1.007226+x*(.015085+P*(.028874*x-.044475-.005916*P)))-s)/(1.007226+x*(.045255+P*(.259866*x-.311325-.005916*11*P))),c=bt(c-g,-lw,lw)}while(Math.abs(g)>1e-6&&--f>0);x=c*c;const C=bt(Bt(e/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),M=Bt(c);return new ri(C,M)}}const cw=_t(Ps);class rB extends Lh{project(e,s){s=_t(s),e=_t(e);const c=Math.cos(s),f=2/Math.PI,g=Math.acos(c*Math.cos(e/2)),x=Math.sin(g)/g,C=.5*(e*f+2*c*Math.sin(e/2)/x)||0,M=.5*(s+Math.sin(s)/x)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(e,s){let c=e=(2*e-.5)*Math.PI,f=s=(2*(1-s)-1)*Math.PI,g=25;const x=1e-6;let C=0,M=0;do{const P=Math.cos(f),j=Math.sin(f),$=2*j*P,W=j*j,Y=P*P,ee=Math.cos(c/2),oe=Math.sin(c/2),de=2*ee*oe,ve=oe*oe,Le=1-Y*ee*ee,xe=Le?1/Le:0,Me=Le?Math.acos(P*ee)*Math.sqrt(1/Le):0,Oe=.5*(2*Me*P*oe+2*c/Math.PI)-e,Re=.5*(Me*j+f)-s,ot=.5*xe*(Y*ve+Me*P*ee*W)+1/Math.PI,nt=xe*(de*$/4-Me*j*oe),pt=.125*xe*($*oe-Me*j*Y*de),Ot=.5*xe*(W*ee+Me*ve*P)+.5,ct=nt*pt-Ot*ot;C=(Re*nt-Oe*Ot)/ct,M=(Oe*pt-Re*ot)/ct,c=bt(c-C,-Math.PI,Math.PI),f=bt(f-M,-cw,cw)}while((Math.abs(C)>x||Math.abs(M)>x)&&--g>0);return new ri(Bt(c),Bt(f))}}class uw extends Lh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_t(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){const{scale:c,cosPhi:f}=this;return{x:_t(e)*f*c+.5,y:-Math.sin(_t(s))/f*c+.5,z:0}}unproject(e,s){const{scale:c,cosPhi:f}=this,g=-(s-.5)/c,x=bt(Bt((e-.5)/c)/f,-180,180),C=Math.asin(bt(g*f,-1,1)),M=bt(Bt(C),-Ps,Ps);return new ri(x,M)}}class iB extends aw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,s,c){const f=Lp(e,s,c);return ut(f,f,Bp(cu(c))),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,s){const c=nf(s.lat,s.lng),f=Ei([],c),g=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(s),e._centerAltitude):e._centerAltitude;Po(c,c,f,Lc(1,0)*_n*g);const x=ll(new Float64Array(16));return Pc(x,e.pixelMatrix,e.globeMatrix),ut(c,c,x),new me(c[0],c[1])}pixelsPerMeter(e,s){return Lc(1,0)*s}pixelSpaceConversion(e,s,c){const f=Lc(1,e)*s,g=Pn(Lc(1,45)*s,f,c);return this.pixelsPerMeter(e,s)/g}createTileMatrix(e,s,c){const f=my(cu(c.canonical));return Pc(new Float64Array(16),e.globeMatrix,f)}createInversionMatrix(e,s){const{center:c}=e,f=Bp(cu(s));return v(f,f,_t(c.lng)),_(f,f,_t(c.lat)),qu(f,f,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(e,s,c,f){return zx(e,s,c,!0)||new of(0,0)}pointCoordinate3D(e,s,c){const f=this.pointCoordinate(e,s,c,0);return[f.x,f.y,f.z]}isPointAboveHorizon(e,s){return!zx(e,s.x,s.y,!1)}farthestPixelDistance(e){const s=function(f,g){const x=f.cameraToCenterDistance,C=f._centerAltitude*g,M=f._camera,P=f._camera.forward(),j=Nt([],pn([],P,-x),[0,0,C]),$=f.worldSize/(2*Math.PI),W=[0,0,-$],Y=f.width/f.height,ee=Math.tan(f.fovAboveCenter),oe=pn([],M.up(),ee),de=pn([],M.right(),ee*Y),ve=Ei([],Nt([],Nt([],P,oe),de)),Le=[];let xe;if(new cy(j,ve).closestPointOnSphere(W,$,Le)){const Me=Nt([],Le,W),Oe=Gn([],Me,j);xe=Math.cos(f.fovAboveCenter)*Ze(Oe)}else{const Me=Gn([],j,W),Oe=Gn([],W,j);Ei(Oe,Oe);const Re=Ze(Me)-$;xe=Math.sqrt(Re*(Re+2*$));const ot=Math.acos(xe/($+Re))-Math.acos(lt(P,Oe));xe*=Math.cos(ot)}return 1.01*xe}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=rf(e.zoom);if(c>0){const f=sw(e,Lc(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),x=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Pn(s,f+g*(1-Math.cos(x)),Math.pow(c,10))}return s}upVector(e,s,c){return Lp(s,c,e,1)}upVectorScale(e){return{metersToTile:tg(rg(cu(e)))}}}function hw(o){const e=o.parallels,s=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new aw(o);case"equirectangular":return new eB(o);case"naturalEarth":return new nB(o);case"equalEarth":return new QL(o);case"winkelTripel":return new rB(o);case"albers":return s?new uw(o):new YL(o);case"lambertConformalConic":return s?new uw(o):new tB(o);case"globe":return new iB(o)}throw new Error(`Invalid projection name: ${o.name}`)}const oB=fg.types,sB=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sg(o,e,s,c,f,g,x,C,M,P,j,$,W){const Y=C?Math.min(Ph,Math.round(C[0])):0,ee=C?Math.min(Ph,Math.round(C[1])):0;o.emplaceBack(e,s,Math.round(32*c),Math.round(32*f),g,x,(Y<<1)+(M?1:0),ee,16*P,16*j,256*$,256*W)}function Mg(o,e,s,c,f,g,x){o.emplaceBack(e,s,c,f,g,x)}function Ig(o,e,s,c,f){o.emplaceBack(e,s,c,f),o.emplaceBack(e,s,c,f),o.emplaceBack(e,s,c,f),o.emplaceBack(e,s,c,f)}function aB(o){for(const e of o.sections)if(cn(e.text))return!0;return!1}class Wy{constructor(e){this.layoutVertexArray=new at,this.indexArray=new un,this.programConfigurations=e,this.segments=new fi,this.dynamicLayoutVertexArray=new Lt,this.opacityVertexArray=new rn,this.placedSymbolArray=new ni,this.globeExtVertexArray=new Et}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,_L.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sB,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,gL.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}on(Wy,"SymbolBuffers");class Zy{constructor(e,s,c){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new c,this.segments=new fi,this.collisionVertexArray=new An,this.collisionVertexArrayExt=new Nn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,yL.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,vL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}on(Zy,"CollisionBuffers");class Bh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(x=>x.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ll([]),this.placementViewportMatrix=ll([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Oy(this.zoom,s["text-size"]),this.iconSizeData=Oy(this.zoom,s["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(x=>Pl[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Wy(new Xu(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Wy(new Xu(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ls,this.lineVertexArray=new Tc,this.symbolInstances=new jr}calculateGlyphDependencies(e,s,c,f,g){for(let x=0;x<e.length;x++)if(s[e.charCodeAt(x)]=!0,f&&g){const C=Vp[e.charAt(x)];C&&(s[C.charCodeAt(0)]=!0)}}populate(e,s,c,f){const g=this.layers[0],x=g.layout,C=this.projection.name==="globe",M=x.get("text-font"),P=x.get("text-field"),j=x.get("icon-image"),$=(P.value.kind!=="constant"||P.value.value instanceof gr&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),W=j.value.kind!=="constant"||!!j.value.value||Object.keys(j.parameters).length>0,Y=x.get("symbol-sort-key");if(this.features=[],!$&&!W)return;const ee=s.iconDependencies,oe=s.glyphDependencies,de=s.availableImages,ve=new G(this.zoom);for(const{feature:Le,id:xe,index:Me,sourceLayerIndex:Oe}of e){const Re=g._featureFilter.needGeometry,ot=dd(Le,Re);if(!g._featureFilter.filter(ve,ot,c))continue;if(Re||(ot.geometry=Ku(Le,c,f)),C&&Le.type!==1&&c.z<=5){const ct=ot.geometry,Ct=.98078528056,At=(Mt,kt)=>lt(Lp(Mt.x,Mt.y,c,1),Lp(kt.x,kt.y,c,1))<Ct;for(let Mt=0;Mt<ct.length;Mt++)ct[Mt]=_P(ct[Mt],At)}let nt,pt;if($){const ct=g.getValueAndResolveTokens("text-field",ot,c,de),Ct=gr.factory(ct);aB(Ct)&&(this.hasRTLText=!0),(!this.hasRTLText||S()==="unavailable"||this.hasRTLText&&D.isParsed())&&(nt=wL(Ct,g,ot))}if(W){const ct=g.getValueAndResolveTokens("icon-image",ot,c,de);pt=ct instanceof Qo?ct:Qo.fromString(ct)}if(!nt&&!pt)continue;const Ot=this.sortFeaturesByKey?Y.evaluate(ot,{},c):void 0;if(this.features.push({id:xe,text:nt,icon:pt,index:Me,sourceLayerIndex:Oe,geometry:ot.geometry,properties:Le.properties,type:oB[Le.type],sortKey:Ot}),pt&&(ee[pt.name]=!0),nt){const ct=M.evaluate(ot,{},c).join(","),Ct=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pl.vertical)>=0;for(const At of nt.sections)if(At.image)ee[At.image.name]=!0;else{const Mt=Ah(nt.toString()),kt=At.fontStack||ct,ft=oe[kt]=oe[kt]||{};this.calculateGlyphDependencies(At.text,ft,Ct,this.allowVerticalPlacement,Mt)}}}x.get("symbol-placement")==="line"&&(this.features=function(Le){const xe={},Me={},Oe=[];let Re=0;function ot(ct){Oe.push(Le[ct]),Re++}function nt(ct,Ct,At){const Mt=Me[ct];return delete Me[ct],Me[Ct]=Mt,Oe[Mt].geometry[0].pop(),Oe[Mt].geometry[0]=Oe[Mt].geometry[0].concat(At[0]),Mt}function pt(ct,Ct,At){const Mt=xe[Ct];return delete xe[Ct],xe[ct]=Mt,Oe[Mt].geometry[0].shift(),Oe[Mt].geometry[0]=At[0].concat(Oe[Mt].geometry[0]),Mt}function Ot(ct,Ct,At){const Mt=At?Ct[0][Ct[0].length-1]:Ct[0][0];return`${ct}:${Mt.x}:${Mt.y}`}for(let ct=0;ct<Le.length;ct++){const Ct=Le[ct],At=Ct.geometry,Mt=Ct.text?Ct.text.toString():null;if(!Mt){ot(ct);continue}const kt=Ot(Mt,At),ft=Ot(Mt,At,!0);if(kt in Me&&ft in xe&&Me[kt]!==xe[ft]){const Qt=pt(kt,ft,At),ln=nt(kt,ft,Oe[Qt].geometry);delete xe[kt],delete Me[ft],Me[Ot(Mt,Oe[ln].geometry,!0)]=ln,Oe[Qt].geometry=null}else kt in Me?nt(kt,ft,At):ft in xe?pt(kt,ft,At):(ot(ct),xe[kt]=Re-1,Me[ft]=Re-1)}return Oe.filter(ct=>ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Le,xe)=>Le.sortKey-xe.sortKey)}update(e,s,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,c,f),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,c,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=hw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const c=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:f,y:g}of s)this.lineVertexArray.emplaceBack(f,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,s,c,f,g,x,C,M,P,j,$,W,Y,ee){const oe=e.indexArray,de=e.layoutVertexArray,ve=e.globeExtVertexArray,Le=e.segments.prepareSegment(4*s.length,de,oe,this.canOverlap?x.sortKey:void 0),xe=this.glyphOffsetArray.length,Me=Le.vertexLength,Oe=this.allowVerticalPlacement&&C===Pl.vertical?Math.PI/2:0,Re=x.text&&x.text.sections;for(let nt=0;nt<s.length;nt++){const{tl:pt,tr:Ot,bl:ct,br:Ct,tex:At,pixelOffsetTL:Mt,pixelOffsetBR:kt,minFontScaleX:ft,minFontScaleY:Qt,glyphOffset:ln,isSDF:tn,sectionIndex:Hn}=s[nt],zt=Le.vertexLength,bn=ln[1];if(Sg(de,P.x,P.y,pt.x,bn+pt.y,At.x,At.y,c,tn,Mt.x,Mt.y,ft,Qt),Sg(de,P.x,P.y,Ot.x,bn+Ot.y,At.x+At.w,At.y,c,tn,kt.x,Mt.y,ft,Qt),Sg(de,P.x,P.y,ct.x,bn+ct.y,At.x,At.y+At.h,c,tn,Mt.x,kt.y,ft,Qt),Sg(de,P.x,P.y,Ct.x,bn+Ct.y,At.x+At.w,At.y+At.h,c,tn,kt.x,kt.y,ft,Qt),M){const{x:Wn,y:Ar,z:Zn}=M.anchor,[Bn,xi,Kn]=M.up;Mg(ve,Wn,Ar,Zn,Bn,xi,Kn),Mg(ve,Wn,Ar,Zn,Bn,xi,Kn),Mg(ve,Wn,Ar,Zn,Bn,xi,Kn),Mg(ve,Wn,Ar,Zn,Bn,xi,Kn),Ig(e.dynamicLayoutVertexArray,Wn,Ar,Zn,Oe)}else Ig(e.dynamicLayoutVertexArray,P.x,P.y,P.z,Oe);oe.emplaceBack(zt,zt+1,zt+2),oe.emplaceBack(zt+1,zt+2,zt+3),Le.vertexLength+=4,Le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ln[0]),nt!==s.length-1&&Hn===s[nt+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,x,x.index,{},Y,ee,Re&&Re[Hn])}const ot=M?M.anchor:P;e.placedSymbolArray.emplaceBack(ot.x,ot.y,ot.z,P.x,P.y,xe,this.glyphOffsetArray.length-xe,Me,j,$,P.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],C,0,!1,0,W,0)}_commitLayoutVertex(e,s,c,f,g,x,C){e.emplaceBack(s,c,f,g,x,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(e,s,c,f,g,x,C){const M=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),P=M.vertexLength,j=C.tileAnchorX,$=C.tileAnchorY;for(let Y=0;Y<4;Y++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-e.padding,-e.padding),c.collisionVertexArrayExt.emplaceBack(s,e.padding,-e.padding),c.collisionVertexArrayExt.emplaceBack(s,e.padding,e.padding),c.collisionVertexArrayExt.emplaceBack(s,-e.padding,e.padding),this._commitLayoutVertex(c.layoutVertexArray,f,g,x,j,$,new me(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,g,x,j,$,new me(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,g,x,j,$,new me(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,f,g,x,j,$,new me(e.x1,e.y2)),M.vertexLength+=4;const W=c.indexArray;W.emplaceBack(P,P+1),W.emplaceBack(P+1,P+2),W.emplaceBack(P+2,P+3),W.emplaceBack(P+3,P),M.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,c,f,g,x){for(let C=f;C<g;C++){const M=c.get(C),P=this.getSymbolInstanceTextSize(e,x,s,C);this._addCollisionDebugVertices(M,P,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(e,s,c,f,g,x){for(let C=f;C<g;C++){const M=c.get(C),P=this.getSymbolInstanceIconSize(e,s,x.placedIconSymbolIndex);this._addCollisionDebugVertices(M,P,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,x)}}generateCollisionDebugBuffers(e,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zy(qt,Pb.members,to),this.iconCollisionBox=new Zy(qt,Pb.members,to);const c=uf(this.iconSizeData,e),f=uf(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(f,e,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(f,e,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,s,c,f){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:f),x=_g(this.textSizeData,e,g)/ys;return this.tilePixelRatio*x}getSymbolInstanceIconSize(e,s,c){const f=this.icon.placedSymbolArray.get(c),g=_g(this.iconSizeData,e,f);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,s,c){e.emplaceBack(s,-c,-c),e.emplaceBack(s,c,-c),e.emplaceBack(s,c,c),e.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(e,s,c,f,g,x){for(let C=f;C<g;C++){const M=c.get(C),P=this.getSymbolInstanceTextSize(e,x,s,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,M.padding)}}_updateIconDebugCollisionBoxes(e,s,c,f,g,x){for(let C=f;C<g;C++){const M=c.get(C),P=this.getSymbolInstanceIconSize(e,s,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,M.padding)}}updateCollisionDebugBuffers(e,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=uf(this.iconSizeData,e),f=uf(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,e,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(f,e,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(c,e,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,e,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,c,f,g,x,C,M,P){const j={};if(s<c){const{x1:$,y1:W,x2:Y,y2:ee,padding:oe,projectedAnchorX:de,projectedAnchorY:ve,projectedAnchorZ:Le,tileAnchorX:xe,tileAnchorY:Me,featureIndex:Oe}=e.get(s);j.textBox={x1:$,y1:W,x2:Y,y2:ee,padding:oe,projectedAnchorX:de,projectedAnchorY:ve,projectedAnchorZ:Le,tileAnchorX:xe,tileAnchorY:Me},j.textFeatureIndex=Oe}if(f<g){const{x1:$,y1:W,x2:Y,y2:ee,padding:oe,projectedAnchorX:de,projectedAnchorY:ve,projectedAnchorZ:Le,tileAnchorX:xe,tileAnchorY:Me,featureIndex:Oe}=e.get(f);j.verticalTextBox={x1:$,y1:W,x2:Y,y2:ee,padding:oe,projectedAnchorX:de,projectedAnchorY:ve,projectedAnchorZ:Le,tileAnchorX:xe,tileAnchorY:Me},j.verticalTextFeatureIndex=Oe}if(x<C){const{x1:$,y1:W,x2:Y,y2:ee,padding:oe,projectedAnchorX:de,projectedAnchorY:ve,projectedAnchorZ:Le,tileAnchorX:xe,tileAnchorY:Me,featureIndex:Oe}=e.get(x);j.iconBox={x1:$,y1:W,x2:Y,y2:ee,padding:oe,projectedAnchorX:de,projectedAnchorY:ve,projectedAnchorZ:Le,tileAnchorX:xe,tileAnchorY:Me},j.iconFeatureIndex=Oe}if(M<P){const{x1:$,y1:W,x2:Y,y2:ee,padding:oe,projectedAnchorX:de,projectedAnchorY:ve,projectedAnchorZ:Le,tileAnchorX:xe,tileAnchorY:Me,featureIndex:Oe}=e.get(M);j.verticalIconBox={x1:$,y1:W,x2:Y,y2:ee,padding:oe,projectedAnchorX:de,projectedAnchorY:ve,projectedAnchorZ:Le,tileAnchorX:xe,tileAnchorY:Me},j.verticalIconFeatureIndex=Oe}return j}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const c=e.placedSymbolArray.get(s),f=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<f;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),c=Math.cos(e),f=[],g=[],x=[];for(let C=0;C<this.symbolInstances.length;++C){x.push(C);const M=this.symbolInstances.get(C);f.push(0|Math.round(s*M.tileAnchorX+c*M.tileAnchorY)),g.push(M.featureIndex)}return x.sort((C,M)=>f[C]-f[M]||g[M]-g[C]),x}addToSortKeyRanges(e,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:C,placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:P}=c;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&x!==g&&x!==f&&this.addIndicesForPlacedSymbol(this.text,x),C>=0&&this.addIndicesForPlacedSymbol(this.text,C),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}on(Bh,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Bh.MAX_GLYPHS=65535,Bh.addDynamicAttributes=Ig;const lB=new Ee({"symbol-placement":new ie(et.layout_symbol["symbol-placement"]),"symbol-spacing":new ie(et.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ie(et.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pe(et.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ie(et.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ie(et.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ie(et.layout_symbol["icon-ignore-placement"]),"icon-optional":new ie(et.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ie(et.layout_symbol["icon-rotation-alignment"]),"icon-size":new pe(et.layout_symbol["icon-size"]),"icon-text-fit":new ie(et.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ie(et.layout_symbol["icon-text-fit-padding"]),"icon-image":new pe(et.layout_symbol["icon-image"]),"icon-rotate":new pe(et.layout_symbol["icon-rotate"]),"icon-padding":new ie(et.layout_symbol["icon-padding"]),"icon-keep-upright":new ie(et.layout_symbol["icon-keep-upright"]),"icon-offset":new pe(et.layout_symbol["icon-offset"]),"icon-anchor":new pe(et.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ie(et.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ie(et.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ie(et.layout_symbol["text-rotation-alignment"]),"text-field":new pe(et.layout_symbol["text-field"]),"text-font":new pe(et.layout_symbol["text-font"]),"text-size":new pe(et.layout_symbol["text-size"]),"text-max-width":new pe(et.layout_symbol["text-max-width"]),"text-line-height":new pe(et.layout_symbol["text-line-height"]),"text-letter-spacing":new pe(et.layout_symbol["text-letter-spacing"]),"text-justify":new pe(et.layout_symbol["text-justify"]),"text-radial-offset":new pe(et.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ie(et.layout_symbol["text-variable-anchor"]),"text-anchor":new pe(et.layout_symbol["text-anchor"]),"text-max-angle":new ie(et.layout_symbol["text-max-angle"]),"text-writing-mode":new ie(et.layout_symbol["text-writing-mode"]),"text-rotate":new pe(et.layout_symbol["text-rotate"]),"text-padding":new ie(et.layout_symbol["text-padding"]),"text-keep-upright":new ie(et.layout_symbol["text-keep-upright"]),"text-transform":new pe(et.layout_symbol["text-transform"]),"text-offset":new pe(et.layout_symbol["text-offset"]),"text-allow-overlap":new ie(et.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ie(et.layout_symbol["text-ignore-placement"]),"text-optional":new ie(et.layout_symbol["text-optional"])});var Xy={paint:new Ee({"icon-opacity":new pe(et.paint_symbol["icon-opacity"]),"icon-color":new pe(et.paint_symbol["icon-color"]),"icon-halo-color":new pe(et.paint_symbol["icon-halo-color"]),"icon-halo-width":new pe(et.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pe(et.paint_symbol["icon-halo-blur"]),"icon-translate":new ie(et.paint_symbol["icon-translate"]),"icon-translate-anchor":new ie(et.paint_symbol["icon-translate-anchor"]),"text-opacity":new pe(et.paint_symbol["text-opacity"]),"text-color":new pe(et.paint_symbol["text-color"],{runtimeType:wi,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new pe(et.paint_symbol["text-halo-color"]),"text-halo-width":new pe(et.paint_symbol["text-halo-width"]),"text-halo-blur":new pe(et.paint_symbol["text-halo-blur"]),"text-translate":new ie(et.paint_symbol["text-translate"]),"text-translate-anchor":new ie(et.paint_symbol["text-translate-anchor"])}),layout:lB};class dw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ua,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}on(dw,"FormatSectionOverride",{omit:["defaultValue"]});class Pg extends Ml{constructor(e){super(e,Xy)}recalculate(e,s){super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const g of c)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,s,c,f){const g=this.layout.get(e).evaluate(s,{},c,f),x=this._unevaluatedLayout._values[e];return x.isDataDriven()||rl(x.value)||!g?g:function(C,M){return M.replace(/{([^{}]+)}/g,(P,j)=>j in C?String(C[j]):"")}(s.properties,g)}createBucket(e){return new Bh(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Xy.paint.overridableProperties){if(!Pg.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),c=new dw(s),f=new Ta(c,s.property.specification);let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new gh("source",f):new Zc("composite",f,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new ge(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&Pg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const c=e.get("text-field"),f=Xy.paint.properties[s];let g=!1;const x=C=>{for(const M of C)if(f.overrides&&f.overrides.hasOverride(M))return void(g=!0)};if(c.value.kind==="constant"&&c.value.value instanceof gr)x(c.value.value.sections);else if(c.value.kind==="source"){const C=P=>{g||(P instanceof Na&&Zr(P.value)===ce?x(P.value.sections):P instanceof Zs?x(P.sections):P.eachChild(C))},M=c.value;M._styleExpression&&C(M._styleExpression.expression)}return g}getProgramConfiguration(e){return new Ic(this,e)}}var cB={paint:new Ee({"background-color":new ie(et.paint_background["background-color"]),"background-pattern":new ie(et.paint_background["background-pattern"]),"background-opacity":new ie(et.paint_background["background-opacity"])})},uB={paint:new Ee({"raster-opacity":new ie(et.paint_raster["raster-opacity"]),"raster-hue-rotate":new ie(et.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ie(et.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ie(et.paint_raster["raster-brightness-max"]),"raster-saturation":new ie(et.paint_raster["raster-saturation"]),"raster-contrast":new ie(et.paint_raster["raster-contrast"]),"raster-resampling":new ie(et.paint_raster["raster-resampling"]),"raster-fade-duration":new ie(et.paint_raster["raster-fade-duration"])})};class hB extends Ml{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var dB={paint:new Ee({"sky-type":new ie(et.paint_sky["sky-type"]),"sky-atmosphere-sun":new ie(et.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ie(et.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ie(et.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ie(et.paint_sky["sky-gradient-radius"]),"sky-gradient":new we(et.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ie(et.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ie(et.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ie(et.paint_sky["sky-opacity"])})};function qy(o,e,s){const c=[0,0,1],f=Lx([]);return Rx(f,f,s?-_t(o)+Math.PI:_t(o)),Bx(f,f,-_t(e)),dn(c,c,f),Ei(c,c)}const fB={circle:class extends Ml{constructor(o){super(o,CP)}createBucket(o){return new by(o)}queryRadius(o){const e=o;return sf("circle-radius",this,e)+sf("circle-stroke-width",this,e)+sg(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,s,c,f,g,x,C){const M=tb(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return nb(o,c,g,x,C,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",M,P)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Ic(this,o)}},heatmap:class extends Ml{createBucket(o){return new ib(o)}constructor(o){super(o,MP),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ay({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return sf("heatmap-radius",this,o)}queryIntersectsFeature(o,e,s,c,f,g,x,C){const M=this.paint.get("heatmap-radius").evaluate(e,s);return nb(o,c,g,x,C,!0,!0,new me(0,0),M)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Ic(this,o)}},hillshade:class extends Ml{constructor(o){super(o,IP)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ml{constructor(o){super(o,HP)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new Ic(this,o)}recalculate(o,e){super.recalculate(o,e);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new hg(o)}queryRadius(){return sg(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,s,c,f,g){return!o.queryGeometry.isAboveHorizon&&Kx(eb(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Ml{constructor(o){super(o,aL)}createBucket(o){return new Up(o)}queryRadius(){return sg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Ic(this,o)}queryIntersectsFeature(o,e,s,c,f,g,x,C,M){const P=tb(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),j=this.paint.get("fill-extrusion-height").evaluate(e,s),$=this.paint.get("fill-extrusion-base").evaluate(e,s),W=[0,0],Y=C&&g.elevation,ee=g.elevation?g.elevation.exaggeration():1,oe=o.tile.getBucket(this);if(Y&&oe instanceof Up){const Me=oe.centroidVertexArray,Oe=M+1;Oe<Me.length&&(W[0]=Me.geta_centroid_pos0(Oe),W[1]=Me.geta_centroid_pos1(Oe))}if(W[0]===0&&W[1]===1)return!1;g.projection.name==="globe"&&(c=wb([c],[new me(0,0),new me(_n,_n)],o.tileID.canonical).map(Me=>Me.polygon).flat());const de=Y?C:null,[ve,Le]=function(Me,Oe,Re,ot,nt,pt,Ot,ct,Ct,At,Mt){return Me.projection.name==="globe"?function(kt,ft,Qt,ln,tn,Hn,zt,bn,Wn,Ar,Zn){const Bn=[],xi=[],Kn=kt.projection.upVectorScale(Zn,kt.center.lat,kt.worldSize).metersToTile,Jn=[0,0,0,1],ii=[0,0,0,1],mi=(oi,Oi,qi,ho)=>{oi[0]=Oi,oi[1]=qi,oi[2]=ho,oi[3]=1},gi=bb();Qt>0&&(Qt+=gi),ln+=gi;for(const oi of ft){const Oi=[],qi=[];for(const ho of oi){const si=ho.x+tn.x,Lo=ho.y+tn.y,fo=kt.projection.projectTilePoint(si,Lo,Zn),Ni=kt.projection.upVector(Zn,ho.x,ho.y);let Ir=Qt,po=ln;if(zt){const _i=Tb(si,Lo,Qt,ln,zt,bn,Wn,Ar);Ir+=_i.base,po+=_i.top}Qt!==0?mi(Jn,fo.x+Ni[0]*Kn*Ir,fo.y+Ni[1]*Kn*Ir,fo.z+Ni[2]*Kn*Ir):mi(Jn,fo.x,fo.y,fo.z),mi(ii,fo.x+Ni[0]*Kn*po,fo.y+Ni[1]*Kn*po,fo.z+Ni[2]*Kn*po),ut(Jn,Jn,Hn),ut(ii,ii,Hn),Oi.push(new cf(Jn[0],Jn[1],Jn[2])),qi.push(new cf(ii[0],ii[1],ii[2]))}Bn.push(Oi),xi.push(qi)}return[Bn,xi]}(Me,Oe,Re,ot,nt,pt,Ot,ct,Ct,At,Mt):Ot?function(kt,ft,Qt,ln,tn,Hn,zt,bn,Wn){const Ar=[],Zn=[],Bn=[0,0,0,1];for(const xi of kt){const Kn=[],Jn=[];for(const ii of xi){const mi=ii.x+ln.x,gi=ii.y+ln.y,oi=Tb(mi,gi,ft,Qt,Hn,zt,bn,Wn);Bn[0]=mi,Bn[1]=gi,Bn[2]=oi.base,Bn[3]=1,sa(Bn,Bn,tn),Bn[3]=Math.max(Bn[3],1e-5);const Oi=new cf(Bn[0]/Bn[3],Bn[1]/Bn[3],Bn[2]/Bn[3]);Bn[0]=mi,Bn[1]=gi,Bn[2]=oi.top,Bn[3]=1,sa(Bn,Bn,tn),Bn[3]=Math.max(Bn[3],1e-5);const qi=new cf(Bn[0]/Bn[3],Bn[1]/Bn[3],Bn[2]/Bn[3]);Kn.push(Oi),Jn.push(qi)}Ar.push(Kn),Zn.push(Jn)}return[Ar,Zn]}(Oe,Re,ot,nt,pt,Ot,ct,Ct,At):function(kt,ft,Qt,ln,tn){const Hn=[],zt=[],bn=tn[8]*ft,Wn=tn[9]*ft,Ar=tn[10]*ft,Zn=tn[11]*ft,Bn=tn[8]*Qt,xi=tn[9]*Qt,Kn=tn[10]*Qt,Jn=tn[11]*Qt;for(const ii of kt){const mi=[],gi=[];for(const oi of ii){const Oi=oi.x+ln.x,qi=oi.y+ln.y,ho=tn[0]*Oi+tn[4]*qi+tn[12],si=tn[1]*Oi+tn[5]*qi+tn[13],Lo=tn[2]*Oi+tn[6]*qi+tn[14],fo=tn[3]*Oi+tn[7]*qi+tn[15],Ni=ho+bn,Ir=si+Wn,po=Lo+Ar,_i=Math.max(fo+Zn,1e-5),ca=ho+Bn,mo=si+xi,vs=Lo+Kn,us=Math.max(fo+Jn,1e-5);mi.push(new cf(Ni/_i,Ir/_i,po/_i)),gi.push(new cf(ca/us,mo/us,vs/us))}Hn.push(mi),zt.push(gi)}return[Hn,zt]}(Oe,Re,ot,nt,pt)}(g,c,$,j,P,x,de,W,ee,g.center.lat,o.tileID.canonical),xe=o.queryGeometry;return function(Me,Oe,Re){let ot=1/0;Kx(Re,Oe)&&(ot=Ab(Re,Oe[0]));for(let nt=0;nt<Oe.length;nt++){const pt=Oe[nt],Ot=Me[nt];for(let ct=0;ct<pt.length-1;ct++){const Ct=pt[ct],At=[Ct,pt[ct+1],Ot[ct+1],Ot[ct],Ct];qx(Re,At)&&(ot=Math.min(ot,Ab(Re,At)))}}return ot!==1/0&&ot}(ve,Le,xe.isPointQuery()?xe.screenBounds:xe.screenGeometry)}},line:class extends Ml{constructor(o){super(o,Sb),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Fi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=Mb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new gg(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Ic(this,o)}queryRadius(o){const e=o,s=Ib(sf("line-width",this,e),sf("line-gap-width",this,e)),c=sf("line-offset",this,e);return s/2+Math.abs(c)+sg(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,s,c,f,g){if(o.queryGeometry.isAboveHorizon)return!1;const x=eb(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),C=o.pixelToTileUnitsFactor/2*Ib(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),M=this.paint.get("line-offset").evaluate(e,s);return M&&(c=function(P,j){const $=[],W=new me(0,0);for(let Y=0;Y<P.length;Y++){const ee=P[Y],oe=[];for(let de=0;de<ee.length;de++){const ve=ee[de],Le=ee[de+1],xe=de===0?W:ve.sub(ee[de-1])._unit()._perp(),Me=de===ee.length-1?W:Le.sub(ve)._unit()._perp(),Oe=xe._add(Me)._unit();Oe._mult(1/(Oe.x*Me.x+Oe.y*Me.y)),oe.push(Oe._mult(j)._add(ve))}$.push(oe)}return $}(c,M*o.pixelToTileUnitsFactor)),function(P,j,$){for(let W=0;W<j.length;W++){const Y=j[W];if(P.length>=3){for(let ee=0;ee<Y.length;ee++)if(fd(P,Y[ee]))return!0}if(xP(P,Y,$))return!0}return!1}(x,c,C)}isTileClipped(){return!0}},symbol:Pg,background:class extends Ml{constructor(o){super(o,cB)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ml{constructor(o){super(o,uB)}getProgramIds(){return["raster"]}},sky:class extends Ml{constructor(o){super(o,dB),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ay({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),f=!c,g=o.style.light,x=g.properties.get("position");return f&&g.properties.get("anchor")==="viewport"&&wn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?qy(x.azimuthal,90-x.polar,e):qy(c[0],90-c[1],e)}const s=this.paint.get("sky-gradient-center");return qy(s[0],90-s[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}}};class Jp{constructor(e,s,c,f){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(s,f)}update(e,s,c){const{width:f,height:g}=e,{context:x}=this,{gl:C}=x,{HTMLImageElement:M,HTMLCanvasElement:P,HTMLVideoElement:j,ImageData:$,ImageBitmap:W}=E;if(C.bindTexture(C.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!s||s.premultiply!==!1)),c||this.size&&this.size[0]===f&&this.size[1]===g){const{x:Y,y:ee}=c||{x:0,y:0};e instanceof M||e instanceof P||e instanceof j||e instanceof $||W&&e instanceof W?C.texSubImage2D(C.TEXTURE_2D,0,Y,ee,C.RGBA,C.UNSIGNED_BYTE,e):C.texSubImage2D(C.TEXTURE_2D,0,Y,ee,f,g,C.RGBA,C.UNSIGNED_BYTE,e.data)}else this.size=[f,g],e instanceof M||e instanceof P||e instanceof j||e instanceof $||W&&e instanceof W?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,e):C.texImage2D(C.TEXTURE_2D,0,this.format,f,g,0,this.format,C.UNSIGNED_BYTE,e.data);this.useMipmap=!!(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&C.generateMipmap(C.TEXTURE_2D)}bind(e,s){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:e),this.filter=e),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pB{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mB{constructor(){this.tasks={},this.taskQueue=[],Ln(["process"],this),this.invoker=new pB(this.process),this.nextId=0}add(e,s){const c=this.nextId++,f=function({type:g,isSymbolTile:x,zoom:C}){return C=C||0,g==="message"?0:g!=="maybePrepare"||x?g!=="parseTile"||x?g==="parseTile"&&x?300-C:g==="maybePrepare"&&x?400-C:500:200-C:100-C}(s);if(f===0){Do();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:e,metadata:s,priority:f,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Do();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let f=0;f<this.taskQueue.length;f++){const g=this.tasks[this.taskQueue[f]];g.priority<s&&(s=g.priority,e=f)}if(e===null)return null;const c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class fw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const c=e[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const gB=["tile","layer","source","sourceLayer","state"];class pw{constructor(e,s,c,f,g){this.type="Feature",this._vectorTileFeature=e,this._z=s,this._x=c,this._y=f,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const s of gB)this[s]!==void 0&&(e[s]=this[s]);return e}}const ec=32,du=33,Rh=new Uint16Array(8184);for(let o=0;o<2046;o++){let e=o+2,s=0,c=0,f=0,g=0,x=0,C=0;for(1&e?f=g=x=ec:s=c=C=ec;(e>>=1)>1;){const P=s+f>>1,j=c+g>>1;1&e?(f=s,g=c,s=x,c=C):(s=f,c=g,f=x,g=C),x=P,C=j}const M=4*o;Rh[M+0]=s,Rh[M+1]=c,Rh[M+2]=f,Rh[M+3]=g}const fu=new Uint16Array(2178),Dh=new Uint8Array(1089),Lg=new Uint16Array(1089);function mw(o){return o===0?-.03125:o===32?.03125:0}var gw=$e([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const _w={type:2,extent:_n,loadGeometry:()=>[[new me(0,0),new me(_n+1,0),new me(_n+1,_n+1),new me(0,_n+1),new me(0,0)]]};class Ky{constructor(e,s,c,f,g){this.tileID=e,this.uid=Yn(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(e){const s=e+this.timeAdded;s<zr.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=md(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,s,c){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(f,g){const x={};if(!g)return x;for(const C of f){const M=C.layerIds.map(P=>g.getLayer(P)).filter(Boolean);if(M.length!==0){C.layers=M,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(P=>M.filter(j=>j.id===P)[0]));for(const P of M)x[P.id]=C}}return x}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Bh){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Bh&&g.hasRTLText){this.hasRTLText=!0,D.isLoading()||D.isLoaded()||S()!=="deferred"||R();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(f).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new _r}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Jp(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Jp(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Jp(e,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,c,f,g,x,C,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:C,transform:x,params:g,tileTransform:this.tileTransform},e,s,c):{}}querySourceFeatures(e,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),g=s?s.sourceLayer:"",x=f._geojsonTileLayer||f[g];if(!x)return;const C=Ec(s&&s.filter),{z:M,x:P,y:j}=this.tileID.canonical,$={z:M,x:P,y:j};for(let W=0;W<x.length;W++){const Y=x.feature(W);if(C.needGeometry){const de=dd(Y,!0);if(!C.filter(new G(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!C.filter(new G(this.tileID.overscaledZ),Y))continue;const ee=c.getId(Y,g),oe=new pw(Y,M,P,j,ee);oe.tile=$,e.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const c=Tr(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(s)if(this.expirationTime<s)f=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),f=s.style.listImages();for(const g in this.buckets){if(!s.style.hasLayer(g))continue;const x=this.buckets[g],C=x.layers[0].sourceLayer||"_geojsonTileLayer",M=c[C],P=e[C];if(!M||!P||Object.keys(P).length===0)continue;if(x.update(P,M,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof gg||x instanceof hg){const $=s.style._getSourceCache(x.layers[0].source);s._terrain&&s._terrain.enabled&&$&&x.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile($.id,this.tileID)}const j=s&&s.style&&s.style.getLayer(g);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=zr.now()+e}setTexture(e,s){const c=s.context,f=c.gl;this.texture=this.texture||s.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Jp(c,e,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(e,s){const c={};for(const f of s)c[f]=!0;this.dependencies[e]=c}hasDependency(e,s){for(const c of e){const f=this.dependencies[c];if(f){for(const g of s)if(f[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const c=Ku(_w,this.tileID.canonical,this.tileTransform)[0],f=new Pt,g=new Vo;for(let x=0;x<c.length;x++){const{x:C,y:M}=c[x];f.emplaceBack(C,M),g.emplaceBack(x)}g.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(g),this._tileDebugBuffer=e.createVertexBuffer(f,Ip.members),this._tileDebugSegments=fi.simpleSegment(0,0,f.length,g.length)}_makeTileBoundsBuffers(e,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const c=Ku(_w,this.tileID.canonical,this.tileTransform)[0];let f,g;if(this.isRaster){const x=function(C,M){const P=md(C,M),j=Math.pow(2,C.z);for(let de=0;de<du;de++)for(let ve=0;ve<du;ve++){const Le=Il((C.x+(ve+mw(ve))/ec)/j),xe=Is((C.y+(de+mw(de))/ec)/j),Me=M.project(Le,xe),Oe=de*du+ve;fu[2*Oe+0]=Math.round((Me.x*P.scale-P.x)*_n),fu[2*Oe+1]=Math.round((Me.y*P.scale-P.y)*_n)}Dh.fill(0),Lg.fill(0);for(let de=2045;de>=0;de--){const ve=4*de,Le=Rh[ve+0],xe=Rh[ve+1],Me=Rh[ve+2],Oe=Rh[ve+3],Re=Le+Me>>1,ot=xe+Oe>>1,nt=Re+ot-xe,pt=ot+Le-Re,Ot=xe*du+Le,ct=Oe*du+Me,Ct=ot*du+Re,At=Math.hypot((fu[2*Ot+0]+fu[2*ct+0])/2-fu[2*Ct+0],(fu[2*Ot+1]+fu[2*ct+1])/2-fu[2*Ct+1])>=16;Dh[Ct]=Dh[Ct]||(At?1:0),de<1022&&(Dh[Ct]=Dh[Ct]||Dh[(xe+pt>>1)*du+(Le+nt>>1)]||Dh[(Oe+pt>>1)*du+(Me+nt>>1)])}const $=new gt,W=new un;let Y=0;function ee(de,ve){const Le=ve*du+de;return Lg[Le]===0&&($.emplaceBack(fu[2*Le+0],fu[2*Le+1],de*_n/ec,ve*_n/ec),Lg[Le]=++Y),Lg[Le]-1}function oe(de,ve,Le,xe,Me,Oe){const Re=de+Le>>1,ot=ve+xe>>1;if(Math.abs(de-Me)+Math.abs(ve-Oe)>1&&Dh[ot*du+Re])oe(Me,Oe,de,ve,Re,ot),oe(Le,xe,Me,Oe,Re,ot);else{const nt=ee(de,ve),pt=ee(Le,xe),Ot=ee(Me,Oe);W.emplaceBack(nt,pt,Ot)}}return oe(0,0,ec,ec,ec,0),oe(ec,ec,0,0,0,ec),{vertices:$,indices:W}}(this.tileID.canonical,s);f=x.vertices,g=x.indices}else{f=new gt,g=new un;for(const{x:C,y:M}of c)f.emplaceBack(C,M,0,0);const x=Py(f.int16,void 0,4);for(let C=0;C<x.length;C+=3)g.emplaceBack(x[C],x[C+1],x[C+2])}this._tileBoundsBuffer=e.createVertexBuffer(f,gw.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(g),this._tileBoundsSegments=fi.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugBuffers(e,s){const c=s.projection;if(!c||c.name!=="globe"||s.freezeTileCoverage)return;const f=this.tileID.canonical,g=Bp(Fx(f,s)),x=rf(s.zoom);let C;x>0&&(C=ef(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,f,s,g,C,x),this._makeGlobeTileDebugTextBuffer(e,f,s,g,C,x)}_globePoint(e,s,c,f,g,x,C){let M=Lp(e,s,c);if(x){const P=1<<c.z,j=uu(f.center.lng),$=hu(f.center.lat),W=(c.x+.5)/P-j;let Y=0;W>.5?Y=-1:W<-.5&&(Y=1);let ee=(e/_n+c.x)/P+Y,oe=(s/_n+c.y)/P;ee=(ee-j)*f._pixelsPerMercatorPixel+j,oe=(oe-$)*f._pixelsPerMercatorPixel+$;const de=[ee*f.worldSize,oe*f.worldSize,0];ut(de,de,x),M=hd(M,de,C)}return ut(M,M,g)}_makeGlobeTileDebugBorderBuffer(e,s,c,f,g,x){const C=new Pt,M=new Vo,P=new Qe,j=(W,Y,ee,oe,de)=>{const ve=(ee-W)/(de-1),Le=(oe-Y)/(de-1),xe=C.length;for(let Me=0;Me<de;Me++){const Oe=W+Me*ve,Re=Y+Me*Le;C.emplaceBack(Oe,Re);const ot=this._globePoint(Oe,Re,s,c,f,g,x);P.emplaceBack(ot[0],ot[1],ot[2]),M.emplaceBack(xe+Me)}},$=_n;j(0,0,$,0,16),j($,0,$,$,16),j($,$,0,$,16),j(0,$,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(M),this._tileDebugBuffer=e.createVertexBuffer(C,Ip.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(P,Ox.members),this._tileDebugSegments=fi.simpleSegment(0,0,C.length,M.length)}_makeGlobeTileDebugTextBuffer(e,s,c,f,g,x){const C=_n/4,M=new Pt,P=new un,j=new Qe,$=25;P.reserve(32),M.reserve($),j.reserve($);const W=(Y,ee)=>$*Y+ee;for(let Y=0;Y<$;Y++){const ee=Y*C;for(let oe=0;oe<$;oe++){const de=oe*C;M.emplaceBack(de,ee);const ve=this._globePoint(de,ee,s,c,f,g,x);j.emplaceBack(ve[0],ve[1],ve[2])}}for(let Y=0;Y<4;Y++)for(let ee=0;ee<4;ee++){const oe=W(Y,ee),de=W(Y,ee+1),ve=W(Y+1,ee),Le=W(Y+1,ee+1);P.emplaceBack(oe,de,ve),P.emplaceBack(ve,de,Le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(P),this._tileDebugTextBuffer=e.createVertexBuffer(M,Ip.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(j,Ox.members),this._tileDebugTextSegments=fi.simpleSegment(0,0,$,32)}}class _B{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,c){const f=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},On(this.stateChanges[e][f],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==f&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(const g in this.state[e][f])c[g]||(this.deletedStates[e][f][g]=null)}else for(const g in c)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][g]===null&&delete this.deletedStates[e][f][g]}removeFeatureState(e,s,c){if(this.deletedStates[e]===null)return;const f=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&s!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][c]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(c in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][c]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,s){const c=String(s),f=On({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][s];if(g===null)return{};for(const x in g)delete f[x]}return f}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),On(this.state[f][x],this.stateChanges[f][x]),g[x]=this.state[f][x];c[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(this.deletedStates[f]===null)for(const x in this.state[f])g[x]={},this.state[f][x]={};else for(const x in this.deletedStates[f]){if(this.deletedStates[f][x]===null)this.state[f][x]={};else if(this.state[f][x])for(const C of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][C];g[x]=this.state[f][x]}c[f]=c[f]||{},On(c[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in e)e[f].setFeatureState(c,s)}}class yw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const c=this.toIdx(e,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function vw(o,e,s,c){let f=0,g=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(c[x])<1e-15){if(s[x]<o[x]||s[x]>e[x])return null}else{const C=1/c[x];let M=(o[x]-s[x])*C,P=(e[x]-s[x])*C;if(M>P){const j=M;M=P,P=j}if(M>f&&(f=M),P<g&&(g=P),f>g)return null}return f}function xw(o,e,s,c,f,g,x,C,M,P,j){const $=c-o,W=f-e,Y=g-s,ee=x-o,oe=C-e,de=M-s,ve=j[1]*de-j[2]*oe,Le=j[2]*ee-j[0]*de,xe=j[0]*oe-j[1]*ee,Me=$*ve+W*Le+Y*xe;if(Math.abs(Me)<1e-15)return null;const Oe=1/Me,Re=P[0]-o,ot=P[1]-e,nt=P[2]-s,pt=(Re*ve+ot*Le+nt*xe)*Oe;if(pt<0||pt>1)return null;const Ot=ot*Y-nt*W,ct=nt*$-Re*Y,Ct=Re*W-ot*$,At=(j[0]*Ot+j[1]*ct+j[2]*Ct)*Oe;return At<0||pt+At>1?null:(ee*Ot+oe*ct+de*Ct)*Oe}function bw(o,e,s){return(o-e)/(s-e)}function ww(o,e,s,c,f,g,x,C,M){const P=1<<s,j=g-c,$=x-f,W=(o+1)/P*j+c,Y=(e+0)/P*$+f,ee=(e+1)/P*$+f;C[0]=(o+0)/P*j+c,C[1]=Y,M[0]=W,M[1]=ee}class Ew{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const x=Math.ceil(Math.log2(g.dim/8)),C=[];let M=Math.ceil(Math.pow(2,x));const P=1/M,j=(Y,ee,oe,de,ve)=>{const Le=de?1:0,xe=(Y+1)*oe-Le,Me=ee*oe,Oe=(ee+1)*oe-Le;ve[0]=Y*oe,ve[1]=Me,ve[2]=xe,ve[3]=Oe};let $=new yw(M);const W=[];for(let Y=0;Y<M*M;Y++){j(Y%M,Math.floor(Y/M),P,!1,W);const ee=Oh(W[0],W[1],g),oe=Oh(W[2],W[1],g),de=Oh(W[2],W[3],g),ve=Oh(W[0],W[3],g);$.minimums.push(Math.min(ee,oe,de,ve)),$.maximums.push(Math.max(ee,oe,de,ve)),$.leaves.push(1)}for(C.push($),M/=2;M>=1;M/=2){const Y=C[C.length-1];$=new yw(M);for(let ee=0;ee<M*M;ee++){j(ee%M,Math.floor(ee/M),2,!0,W);const oe=Y.getElevation(W[0],W[1]),de=Y.getElevation(W[2],W[1]),ve=Y.getElevation(W[2],W[3]),Le=Y.getElevation(W[0],W[3]),xe=Y.isLeaf(W[0],W[1]),Me=Y.isLeaf(W[2],W[1]),Oe=Y.isLeaf(W[2],W[3]),Re=Y.isLeaf(W[0],W[3]),ot=Math.min(oe.min,de.min,ve.min,Le.min),nt=Math.max(oe.max,de.max,ve.max,Le.max),pt=xe&&Me&&Oe&&Re;$.maximums.push(nt),$.minimums.push(ot),$.leaves.push(nt-ot<=5&&pt?1:0)}C.push($)}return C}(this.dem),c=s.length-1,f=s[c];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(e,s,c,f,g,x,C=1){return vw([e,s,-100],[c,f,this.maximums[0]*C],g,x)}raycast(e,s,c,f,g,x,C=1){if(!this.nodeCount)return null;const M=this.raycastRoot(e,s,c,f,g,x,C);if(M==null)return null;const P=[],j=[],$=[],W=[],Y=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:ee,t:oe,nodex:de,nodey:ve,depth:Le}=Y.pop();if(this.leaves[ee]){ww(de,ve,Le,e,s,c,f,$,W);const Me=1<<Le,Oe=(de+0)/Me,Re=(de+1)/Me,ot=(ve+0)/Me,nt=(ve+1)/Me,pt=Oh(Oe,ot,this.dem)*C,Ot=Oh(Re,ot,this.dem)*C,ct=Oh(Re,nt,this.dem)*C,Ct=Oh(Oe,nt,this.dem)*C,At=xw($[0],$[1],pt,W[0],$[1],Ot,W[0],W[1],ct,g,x),Mt=xw(W[0],W[1],ct,$[0],W[1],Ct,$[0],$[1],pt,g,x),kt=Math.min(At!==null?At:Number.MAX_VALUE,Mt!==null?Mt:Number.MAX_VALUE);if(kt!==Number.MAX_VALUE)return kt;{const ft=Po([],g,x,oe);if(Cw(pt,Ot,Ct,ct,bw(ft[0],$[0],W[0]),bw(ft[1],$[1],W[1]))>=ft[2])return oe}continue}let xe=0;for(let Me=0;Me<this._siblingOffset.length;Me++){ww((de<<1)+this._siblingOffset[Me][0],(ve<<1)+this._siblingOffset[Me][1],Le+1,e,s,c,f,$,W),$[2]=-100,W[2]=this.maximums[this.childOffsets[ee]+Me]*C;const Oe=vw($,W,g,x);if(Oe!=null){const Re=Oe;P[Me]=Re;let ot=!1;for(let nt=0;nt<xe&&!ot;nt++)Re>=P[j[nt]]&&(j.splice(nt,0,Me),ot=!0);ot||(j[xe]=Me),xe++}}for(let Me=0;Me<xe;Me++){const Oe=j[Me];Y.push({idx:this.childOffsets[ee]+Oe,t:P[Oe],nodex:(de<<1)+this._siblingOffset[Oe][0],nodey:(ve<<1)+this._siblingOffset[Oe][1],depth:Le+1})}}return null}_addNode(e,s,c){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,c,f,g){if(e[f].isLeaf(s,c)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const x=f-1,C=e[x];let M=0,P=0;for(let j=0;j<this._siblingOffset.length;j++){const $=2*s+this._siblingOffset[j][0],W=2*c+this._siblingOffset[j][1],Y=C.getElevation($,W),ee=C.isLeaf($,W),oe=this._addNode(Y.min,Y.max,ee);ee&&(M|=1<<j),P||(P=oe)}for(let j=0;j<this._siblingOffset.length;j++)M&1<<j||this._construct(e,2*s+this._siblingOffset[j][0],2*c+this._siblingOffset[j][1],x,P+j)}}function Cw(o,e,s,c,f,g){return Pn(Pn(o,s,g),Pn(e,c,g),f)}function Oh(o,e,s){const c=s.dim,f=bt(o*c-.5,0,c-1),g=bt(e*c-.5,0,c-1),x=Math.floor(f),C=Math.floor(g),M=Math.min(x+1,c-1),P=Math.min(C+1,c-1);return Cw(s.get(x,C),s.get(M,C),s.get(x,P),s.get(M,P),f-x,g-C)}const Aw={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function yB(o,e,s){return(256*o*256+256*e+s)/10-1e4}function vB(o,e,s){return 256*o+e+s/256-32768}class Bg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,c,f=!1,g=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return wn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const x=this.dim=s.height-2,C=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=f,!f){for(let M=0;M<x;M++)C[this._idx(-1,M)]=C[this._idx(0,M)],C[this._idx(x,M)]=C[this._idx(x-1,M)],C[this._idx(M,-1)]=C[this._idx(M,0)],C[this._idx(M,x)]=C[this._idx(M,x-1)];C[this._idx(-1,-1)]=C[this._idx(0,0)],C[this._idx(x,-1)]=C[this._idx(x-1,0)],C[this._idx(-1,x)]=C[this._idx(0,x-1)],C[this._idx(x,x)]=C[this._idx(x-1,x-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ew(this)}get(e,s,c=!1){c&&(e=bt(e,-1,this.dim),s=bt(s,-1,this.dim));const f=4*this._idx(e,s);return(this.encoding==="terrarium"?vB:yB)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(e){return Aw[e]}get unpackVector(){return Aw[this.encoding]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}static pack(e,s){const c=[0,0,0,0],f=Bg.getUnpackVector(s);let g=Math.floor((e+f[3])/f[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new cl({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,s,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,g=s*this.dim+this.dim,x=c*this.dim,C=c*this.dim+this.dim;switch(s){case-1:f=g-1;break;case 1:g=f+1}switch(c){case-1:x=C-1;break;case 1:C=x+1}const M=-s*this.dim,P=-c*this.dim;for(let j=x;j<C;j++)for(let $=f;$<g;$++){const W=4*this._idx($,j),Y=4*this._idx($+M,j+P);this.pixels[W+0]=e.pixels[Y+0],this.pixels[W+1]=e.pixels[Y+1],this.pixels[W+2]=e.pixels[Y+2],this.pixels[W+3]=e.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}on(Bg,"DEMData"),on(Ew,"DemMinMaxQuadTree",{omit:["dem"]});class xB{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,c){const f=e.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const g={value:s,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},c)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const c=e.wrapped().key,f=s===void 0?0:this.data[c].indexOf(s),g=this.data[c][f];return this.data[c].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const c in this.data)for(const f of this.data[c])e(f.value)||s.push(f);for(const c of s)this.remove(c.value.tileID,c)}}class vf{constructor(e,s,c){this.func=e,this.mask=s,this.range=c}}vf.ReadOnly=!1,vf.ReadWrite=!0,vf.disabled=new vf(519,vf.ReadOnly,[0,1]);const Jy=7680;class Yy{constructor(e,s,c,f,g,x){this.test=e,this.ref=s,this.mask=c,this.fail=f,this.depthFail=g,this.pass=x}}Yy.disabled=new Yy({func:519,mask:0},0,0,Jy,Jy,Jy);class pu{constructor(e,s,c){this.blendFunction=e,this.blendColor=s,this.mask=c}}pu.Replace=[1,0],pu.disabled=new pu(pu.Replace,en.transparent,[!1,!1,!1,!1]),pu.unblended=new pu(pu.Replace,en.transparent,[!0,!0,!0,!0]),pu.alphaBlended=new pu([1,771],en.transparent,[!0,!0,!0,!0]);const Qy=1029,e0=2305;class Dc{constructor(e,s,c){this.enable=e,this.mode=s,this.frontFace=c}}Dc.disabled=new Dc(!1,Qy,e0),Dc.backCCW=new Dc(!0,Qy,e0),Dc.backCW=new Dc(!0,Qy,2304),Dc.frontCW=new Dc(!0,1028,2304),Dc.frontCCW=new Dc(!0,1028,e0);class gd extends wr{constructor(e,s,c){super(),this.id=e,this._onlySymbols=c,s.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new xB(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new _B,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,s){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return yn(this._tiles).map(e=>e.tileID).sort(Tw).map(e=>e.key)}getRenderableIds(e){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,e)&&s.push(this._tiles[c]);return e?s.sort((c,f)=>{const g=c.tileID,x=f.tileID,C=new me(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),M=new me(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||M.y-C.y||M.x-C.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Tw).map(c=>c.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,s){const c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,e,s)))}_tileLoaded(e,s,c,f){if(f)if(e.state="errored",f.status!==404)this._source.fire(new hi(f,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=zr.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Zi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const s=this.getRenderableIds();for(let f=0;f<s.length;f++){const g=s[f];if(e.neighboringTiles&&e.neighboringTiles[g]){const x=this.getTileByID(g);c(e,x),c(x,e)}}function c(f,g){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let x=g.tileID.canonical.x-f.tileID.canonical.x;const C=g.tileID.canonical.y-f.tileID.canonical.y,M=Math.pow(2,f.tileID.canonical.z),P=g.tileID.key;x===0&&C===0||Math.abs(C)>1||(Math.abs(x)>1&&(Math.abs(x+M)===1?x+=M:Math.abs(x-M)===1&&(x-=M)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,x,C),f.neighboringTiles&&f.neighboringTiles[P]&&(f.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,c,f){for(const g in this._tiles){let x=this._tiles[g];if(f[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>c)continue;let C=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const P=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[P.key],x&&x.hasData()&&(C=P)}let M=C;for(;M.overscaledZ>s;)if(M=M.scaledTo(M.overscaledZ-1),e[M.key]){f[C.key]=C;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=e.overscaledZ-1;c>=s;c--){const f=e.scaledTo(c),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,s){s=s||this._source.tileSize;const c=Math.ceil(e.width/s)+1,f=Math.ceil(e.height/s)+1,g=Math.floor(c*f*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(C)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const c={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(e,s,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let f;this.updateCacheSize(e,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new la(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(f=e.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(C=>this._source.hasTile(C)))):f=[];const g=this._updateRetainedTiles(f);if(Sw(this._source.type)&&f.length!==0){const C={},M={},P=Object.keys(g);for(const $ of P){const W=g[$],Y=this._tiles[$];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=zr.now())continue;const ee=this.findLoadedParent(W,Math.max(W.overscaledZ-gd.maxOverzooming,this._source.minzoom));ee&&(this._addTile(ee.tileID),C[ee.tileID.key]=ee.tileID),M[$]=W}const j=f[f.length-1].overscaledZ;for(const $ in this._tiles){const W=this._tiles[$];if(g[$]||!W.hasData())continue;let Y=W.tileID;for(;Y.overscaledZ>j;){Y=Y.scaledTo(Y.overscaledZ-1);const ee=this._tiles[Y.key];if(ee&&ee.hasData()&&M[Y.key]){g[$]=W.tileID;break}}}for(const $ in C)g[$]||(this._coveredTiles[$]=!0,g[$]=C[$])}for(const C in g)this._tiles[C].clearFadeHold();const x=function(C,M){const P=[];for(const j in C)j in M||P.push(j);return P}(this._tiles,g);for(const C of x){const M=this._tiles[C];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const s={};if(e.length===0)return s;const c={},f=e.reduce((P,j)=>Math.min(P,j.overscaledZ),1/0),g=e[0].overscaledZ,x=Math.max(g-gd.maxOverzooming,this._source.minzoom),C=Math.max(g+gd.maxUnderzooming,this._source.minzoom),M={};for(const P of e){const j=this._addTile(P);s[P.key]=P,j.hasData()||f<this._source.maxzoom&&(M[P.key]=P)}this._retainLoadedChildren(M,f,C,s);for(const P of e){let j=this._tiles[P.key];if(j.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const W=P.children(this._source.maxzoom)[0],Y=this.getTile(W);if(Y&&Y.hasData()){s[W.key]=W;continue}}else{const W=P.children(this._source.maxzoom);if(s[W[0].key]&&s[W[1].key]&&s[W[2].key]&&s[W[3].key])continue}let $=j.wasRequested();for(let W=P.overscaledZ-1;W>=x;--W){const Y=P.scaledTo(W);if(c[Y.key]||(c[Y.key]=!0,j=this.getTile(Y),!j&&$&&(j=this._addTile(Y)),j&&(s[Y.key]=Y,$=j.wasRequested(),j.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let c,f=this._tiles[e].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}s.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;f=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const c=!!s;if(!c){const f=this.map?this.map.painter:null;s=new Ky(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))}return s?(s.uses++,this._tiles[e.key]=s,c||this._source.fire(new Zi("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const c=s.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,s,c){const f=[],g=this.transform;if(!g)return f;const x=g.projection.name==="globe",C=uu(g.center.lng);for(const M in this._tiles){const P=this._tiles[M];if(c&&P.clearQueryDebugViz(),P.holdingForFade())continue;let j;if(x){const $=P.tileID.canonical;if($.z===0){const W=[Math.abs(bt(C,...Yp($,-1))-C),Math.abs(bt(C,...Yp($,1))-C)];j=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(bt(C,...Yp($,-1))-C),Math.abs(bt(C,...Yp($,0))-C),Math.abs(bt(C,...Yp($,1))-C)];j=[W.indexOf(Math.min(...W))-1]}}else j=[0];for(const $ of j){const W=e.containsTile(P,g,s,$);W&&f.push(W)}}return f}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Sw(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=zr.now())return!0}return!1}setFeatureState(e,s,c){this._state.updateState(e=e||"_geojsonTileLayer",s,c)}removeFeatureState(e,s,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,c)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,c){const f=this._tiles[e];f&&f.setDependencies(s,c)}reloadTilesForDependencies(e,s){for(const c in this._tiles)this._tiles[c].hasDependency(e,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(e,s))}_preloadTiles(e,s){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(e,s))};return void this._source.on("data",C)}const c=new Map,f=Array.isArray(e)?e:[e],g=this.map.painter.terrain,x=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const C of f){const M=C.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of M)c.set(P.key,P);this.usedForTerrain&&C.updateElevation(!1)}mn(Array.from(c.values()),(C,M)=>{const P=new Ky(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,j=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),M(j,P)})},s)}}function Tw(o,e){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return o.overscaledZ-e.overscaledZ||c-s||e.canonical.y-o.canonical.y||e.canonical.x-o.canonical.x}function Sw(o){return o==="raster"||o==="image"||o==="video"||o==="custom"}function Yp(o,e){const s=1<<o.z;return[o.x/s+e,(o.x+1)/s+e]}gd.maxOverzooming=10,gd.maxUnderzooming=3;class Rg{constructor(e,s,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(e,s,c){const f=c||e.findDEMTileFor(s);if(!f||!f.dem)return;const g=f.dem,x=f.tileID,C=1<<s.canonical.z-x.canonical.z;return new Rg(f,f.tileSize/_n/C,[(s.canonical.x/C-x.canonical.x)*g.dim,(s.canonical.y/C-x.canonical.y)*g.dim])}tileCoordToPixel(e,s){const c=s*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),g=Math.floor(c);return new me(f,g)}getElevationAt(e,s,c,f){const g=e*this._scale+this._offset[0],x=s*this._scale+this._offset[1],C=Math.floor(g),M=Math.floor(x),P=this._dem;return f=!!f,c?Pn(Pn(P.get(C,M,f),P.get(C,M+1,f),x-M),Pn(P.get(C+1,M,f),P.get(C+1,M+1,f),x-M),g-C):P.get(C,M,f)}getElevationAtPixel(e,s,c){return this._dem.get(e,s,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Lc(1,e)*this._dem.stride}}class Mw{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new il(_n,16,0),this.featureIndexArray=new lo,this.promoteId=s}insert(e,s,c,f,g,x=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,g,x);const M=this.grid;for(let P=0;P<s.length;P++){const j=s[P],$=[1/0,1/0,-1/0,-1/0];for(let W=0;W<j.length;W++){const Y=j[W];$[0]=Math.min($[0],Y.x),$[1]=Math.min($[1],Y.y),$[2]=Math.max($[2],Y.x),$[3]=Math.max($[3],Y.y)}$[0]<_n&&$[1]<_n&&$[2]>=0&&$[3]>=0&&M.insert(C,$[0],$[1],$[2],$[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Dy(new vg(this.rawTileData)).layers,this.sourceLayerCoder=new fw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s,c,f){this.loadVTLayers();const g=e.params||{},x=Ec(g.filter),C=e.tileResult,M=e.transform,P=C.bufferedTilespaceBounds,j=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,(ee,oe,de,ve)=>Qx(C.bufferedTilespaceGeometry,ee,oe,de,ve));j.sort(bB);let $=null;M.elevation&&j.length>0&&($=Rg.create(M.elevation,this.tileID));const W={};let Y;for(let ee=0;ee<j.length;ee++){const oe=j[ee];if(oe===Y)continue;Y=oe;const de=this.featureIndexArray.get(oe);let ve=null;this.loadMatchingFeature(W,de,x,g.layers,g.availableImages,s,c,f,(Le,xe,Me,Oe=0)=>(ve||(ve=Ku(Le,this.tileID.canonical,e.tileTransform)),xe.queryIntersectsFeature(C,Le,Me,ve,this.z,e.transform,e.pixelPosMatrix,$,Oe)))}return W}loadMatchingFeature(e,s,c,f,g,x,C,M,P){const{featureIndex:j,bucketIndex:$,sourceLayerIndex:W,layoutVertexArrayOffset:Y}=s,ee=this.bucketLayerIDs[$];if(f&&!function(Le,xe){for(let Me=0;Me<Le.length;Me++)if(xe.indexOf(Le[Me])>=0)return!0;return!1}(f,ee))return;const oe=this.sourceLayerCoder.decode(W),de=this.vtLayers[oe].feature(j);if(c.needGeometry){const Le=dd(de,!0);if(!c.filter(new G(this.tileID.overscaledZ),Le,this.tileID.canonical))return}else if(!c.filter(new G(this.tileID.overscaledZ),de))return;const ve=this.getId(de,oe);for(let Le=0;Le<ee.length;Le++){const xe=ee[Le];if(f&&f.indexOf(xe)<0)continue;const Me=x[xe];if(!Me)continue;let Oe={};ve!==void 0&&M&&(Oe=M.getState(Me.sourceLayer||"_geojsonTileLayer",ve));const Re=On({},C[xe]);Re.paint=Iw(Re.paint,Me.paint,de,Oe,g),Re.layout=Iw(Re.layout,Me.layout,de,Oe,g);const ot=!P||P(de,Me,Oe,Y);if(!ot)continue;const nt=new pw(de,this.z,this.x,this.y,ve);nt.layer=Re;let pt=e[xe];pt===void 0&&(pt=e[xe]=[]),pt.push({featureIndex:j,feature:nt,intersectionZ:ot})}}lookupSymbolFeatures(e,s,c,f,g,x,C,M){const P={};this.loadVTLayers();const j=Ec(g);for(const $ of e)this.loadMatchingFeature(P,{bucketIndex:c,sourceLayerIndex:f,featureIndex:$,layoutVertexArrayOffset:0},j,x,C,M,s);return P}loadFeature(e){const{featureIndex:s,sourceLayerIndex:c}=e;this.loadVTLayers();const f=this.sourceLayerCoder.decode(c),g=this.vtFeatures[f];if(g[s])return g[s];const x=this.vtLayers[f].feature(s);return g[s]=x,x}hasLayer(e){for(const s of this.bucketLayerIDs)for(const c of s)if(e===c)return!0;return!1}getId(e,s){let c=e.id;if(this.promoteId){const f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];f!=null&&(c=e.properties[f]),typeof c=="boolean"&&(c=Number(c))}return c}}function Iw(o,e,s,c,f){return kn(o,(g,x)=>{const C=e instanceof ye?e.get(x):null;return C&&C.evaluate?C.evaluate(s,c,f):C})}function bB(o,e){return e-o}on(Mw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Pw{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Ju({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const c=this.getKey(e,s);return this.positions[c]}trim(){const e=this.width,s=this.height=Jr(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,c){const f=[];let g=e.length%2==1?-e[e.length-1]*c:0,x=e[0]*c,C=!0;f.push({left:g,right:x,isDash:C,zeroLength:e[0]===0});let M=e[0];for(let P=1;P<e.length;P++){C=!C;const j=e[P];g=M*c,M+=j,x=M*c,f.push({left:g,right:x,isDash:C,zeroLength:j===0})}return f}addRoundDash(e,s,c){const f=s/2;for(let g=-c;g<=c;g++){const x=this.width*(this.nextRow+c+g);let C=0,M=e[C];for(let P=0;P<this.width;P++){P/M.right>1&&(M=e[++C]);const j=Math.abs(P-M.left),$=Math.abs(P-M.right),W=Math.min(j,$);let Y;const ee=g/c*(f+1);if(M.isDash){const oe=f-Math.abs(ee);Y=Math.sqrt(W*W+oe*oe)}else Y=f-Math.sqrt(W*W+ee*ee);this.image.data[x+P]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(e,s){for(let M=e.length-1;M>=0;--M){const P=e[M],j=e[M+1];P.zeroLength?e.splice(M,1):j&&j.isDash===P.isDash&&(j.left=P.left,e.splice(M,1))}const c=e[0],f=e[e.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const g=this.width*this.nextRow;let x=0,C=e[x];for(let M=0;M<this.width;M++){M/C.right>1&&(C=e[++x]);const P=Math.abs(M-C.left),j=Math.abs(M-C.right),$=Math.min(P,j);this.image.data[g+M]=Math.max(0,Math.min(255,(C.isDash?$:-$)+s+128))}}addDash(e,s){const c=this.getKey(e,s);if(this.positions[c])return this.positions[c];const f=s==="round",g=f?7:0,x=2*g+1;if(this.nextRow+x>this.height)return wn("LineAtlas out of space"),null;e.length===0&&e.push(1);let C=0;for(let j=0;j<e.length;j++)e[j]<0&&(wn("Negative value is found in line dasharray, replacing values with 0"),e[j]=0),C+=e[j];if(C!==0){const j=this.width/C,$=this.getDashRanges(e,this.width,j);f?this.addRoundDash($,j,g):this.addRegularDash($,s==="square"?.5*j:0)}const M=this.nextRow+g;this.nextRow+=x;const P={tl:[M,g],br:[C,0]};return this.positions[c]=P,P}}on(Pw,"LineAtlas");const Lw=1*Rc;class Bw{constructor(e){const s={},c=[];for(const C in e){const M=e[C],P=s[C]={};for(const j in M.glyphs){const $=M.glyphs[+j];if(!$||$.bitmap.width===0||$.bitmap.height===0)continue;const W=$.metrics.localGlyph?Lw:1,Y={x:0,y:0,w:$.bitmap.width+2*W,h:$.bitmap.height+2*W};c.push(Y),P[j]=Y}}const{w:f,h:g}=Fy(c),x=new Ju({width:f||1,height:g||1});for(const C in e){const M=e[C];for(const P in M.glyphs){const j=M.glyphs[+P];if(!j||j.bitmap.width===0||j.bitmap.height===0)continue;const $=s[C][P],W=j.metrics.localGlyph?Lw:1;Ju.copy(j.bitmap,x,{x:0,y:0},{x:$.x+W,y:$.y+W},j.bitmap)}}this.image=x,this.positions=s}}on(Bw,"GlyphAtlas");class wB{constructor(e){this.tileID=new la(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=md(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,s,c,f,g){this.status="parsing",this.data=e,this.collisionBoxArray=new _r;const x=new fw(Object.keys(e.layers).sort()),C=new Mw(this.tileID,this.promoteId);C.bucketLayerIDs=[];const M={},P=new Pw(256,256),j={featureIndex:C,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:P,availableImages:c},$=s.familiesBySource[this.source];for(const Oe in $){const Re=e.layers[Oe];if(!Re)continue;let ot=!1,nt=!1;for(const ct of $[Oe])ct[0].type==="symbol"?ot=!0:nt=!0;if(this.isSymbolTile===!0&&!ot||this.isSymbolTile===!1&&!nt)continue;Re.version===1&&wn(`Vector tile source "${this.source}" layer "${Oe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pt=x.encode(Oe),Ot=[];for(let ct=0;ct<Re.length;ct++){const Ct=Re.feature(ct),At=C.getId(Ct,Oe);Ot.push({feature:Ct,id:At,index:ct,sourceLayerIndex:pt})}for(const ct of $[Oe]){const Ct=ct[0];this.isSymbolTile!==void 0&&Ct.type==="symbol"!==this.isSymbolTile||Ct.minzoom&&this.zoom<Math.floor(Ct.minzoom)||Ct.maxzoom&&this.zoom>=Ct.maxzoom||Ct.visibility!=="none"&&(t0(ct,this.zoom,c),(M[Ct.id]=Ct.createBucket({index:C.bucketLayerIDs.length,layers:ct,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(Ot,j,this.tileID.canonical,this.tileTransform),C.bucketLayerIDs.push(ct.map(At=>At.id)))}}let W,Y,ee,oe;P.trim();const de={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ve=()=>{if(W)return g(W);if(Y&&ee&&oe){const Oe=new Bw(Y),Re=new jb(ee,oe);for(const ot in M){const nt=M[ot];nt instanceof Bh?(t0(nt.layers,this.zoom,c),XL(nt,Y,Oe.positions,ee,Re.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):nt.hasPattern&&(nt instanceof gg||nt instanceof hg||nt instanceof Up)&&(t0(nt.layers,this.zoom,c),nt.addFeatures(j,this.tileID.canonical,Re.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:yn(M).filter(ot=>!ot.isEmpty()),featureIndex:C,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Oe.image,lineAtlas:P,imageAtlas:Re,glyphMap:this.returnDependencies?Y:null,iconMap:this.returnDependencies?ee:null,glyphPositions:this.returnDependencies?Oe.positions:null})}},Le=kn(j.glyphDependencies,Oe=>Object.keys(Oe).map(Number));Object.keys(Le).length?f.send("getGlyphs",{uid:this.uid,stacks:Le},(Oe,Re)=>{W||(W=Oe,Y=Re,ve())},void 0,!1,de):Y={};const xe=Object.keys(j.iconDependencies);xe.length?f.send("getImages",{icons:xe,source:this.source,tileID:this.tileID,type:"icons"},(Oe,Re)=>{W||(W=Oe,ee=Re,ve())},void 0,!1,de):ee={};const Me=Object.keys(j.patternDependencies);Me.length?f.send("getImages",{icons:Me,source:this.source,tileID:this.tileID,type:"patterns"},(Oe,Re)=>{W||(W=Oe,oe=Re,ve())},void 0,!1,de):oe={},ve()}}function t0(o,e,s){const c=new G(e);for(const f of o)f.recalculate(c,s)}class Rw{constructor(e){this.entries={},this.scheduler=e}request(e,s,c,f){const g=this.entries[e]=this.entries[e]||{callbacks:[]};if(g.result){const[x,C]=g.result;return this.scheduler?this.scheduler.add(()=>{f(x,C)},s):f(x,C),()=>{}}return g.callbacks.push(f),g.cancel||(g.cancel=c((x,C)=>{g.result=[x,C];for(const M of g.callbacks)this.scheduler?this.scheduler.add(()=>{M(x,C)},s):M(x,C);setTimeout(()=>delete this.entries[e],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(x=>x!==f),g.callbacks.length||(g.cancel(),delete this.entries[e]))}}}function Dw(o,e,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},f=>{const g=In(o.request,(x,C,M,P)=>{x?f(x):C&&f(null,{vectorTile:s?void 0:new Dy(new vg(C)),rawData:C,cacheControl:M,expires:P})});return()=>{g.cancel(),f()}},e)}const Ow=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class n0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const g=Ow[15&c];if(!g)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(e,2,1),[C]=new Uint32Array(e,4,1);return new n0(C,x,g,e)}constructor(e,s=64,c=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=Ow.indexOf(this.ArrayType),x=2*e*this.ArrayType.BYTES_PER_ELEMENT,C=e*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-C%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+C+M,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+x+C+M),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+C+M,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=s,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return r0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:C}=this,M=[0,g.length-1,0],P=[];for(;M.length;){const j=M.pop()||0,$=M.pop()||0,W=M.pop()||0;if($-W<=C){for(let de=W;de<=$;de++){const ve=x[2*de],Le=x[2*de+1];ve>=e&&ve<=c&&Le>=s&&Le<=f&&P.push(g[de])}continue}const Y=W+$>>1,ee=x[2*Y],oe=x[2*Y+1];ee>=e&&ee<=c&&oe>=s&&oe<=f&&P.push(g[Y]),(j===0?e<=ee:s<=oe)&&(M.push(W),M.push(Y-1),M.push(1-j)),(j===0?c>=ee:f>=oe)&&(M.push(Y+1),M.push($),M.push(1-j))}return P}within(e,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:x}=this,C=[0,f.length-1,0],M=[],P=c*c;for(;C.length;){const j=C.pop()||0,$=C.pop()||0,W=C.pop()||0;if($-W<=x){for(let de=W;de<=$;de++)zw(g[2*de],g[2*de+1],e,s)<=P&&M.push(f[de]);continue}const Y=W+$>>1,ee=g[2*Y],oe=g[2*Y+1];zw(ee,oe,e,s)<=P&&M.push(f[Y]),(j===0?e-c<=ee:s-c<=oe)&&(C.push(W),C.push(Y-1),C.push(1-j)),(j===0?e+c>=ee:s+c>=oe)&&(C.push(Y+1),C.push($),C.push(1-j))}return M}}function r0(o,e,s,c,f,g){if(f-c<=s)return;const x=c+f>>1;kw(o,e,x,c,f,g),r0(o,e,s,c,x-1,1-g),r0(o,e,s,x+1,f,1-g)}function kw(o,e,s,c,f,g){for(;f>c;){if(f-c>600){const P=f-c+1,j=s-c+1,$=Math.log(P),W=.5*Math.exp(2*$/3),Y=.5*Math.sqrt($*W*(P-W)/P)*(j-P/2<0?-1:1);kw(o,e,s,Math.max(c,Math.floor(s-j*W/P+Y)),Math.min(f,Math.floor(s+(P-j)*W/P+Y)),g)}const x=e[2*s+g];let C=c,M=f;for(Qp(o,e,c,s),e[2*f+g]>x&&Qp(o,e,c,f);C<M;){for(Qp(o,e,C,M),C++,M--;e[2*C+g]<x;)C++;for(;e[2*M+g]>x;)M--}e[2*c+g]===x?Qp(o,e,c,M):(M++,Qp(o,e,M,f)),M<=s&&(c=M+1),s<=M&&(f=M-1)}}function Qp(o,e,s,c){i0(o,s,c),i0(e,2*s,2*c),i0(e,2*s+1,2*c+1)}function i0(o,e,s){const c=o[e];o[e]=o[s],o[s]=c}function zw(o,e,s,c){const f=o-s,g=e-c;return f*f+g*g}i.ARRAY_TYPE=oa,i.AUTH_ERR_MSG=Be,i.Aabb=aa,i.Actor=class{constructor(o,e,s){this.target=o,this.parent=e,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Ln(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Do()?o:E,this.scheduler=new mB}send(o,e,s,c,f=!1,g){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[x]=s);const C=bs(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:o,hasCallback:!!s,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:Tl(e,C)},C),{cancel:()=>{s&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const e=o.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(e.mustQueue||Do()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,e),c&&c.metadata||{type:"message"})}else this.processTask(s,e)}processTask(o,e){if(e.type==="<response>"){const s=this.callbacks[o];delete this.callbacks[o],s&&(e.error?s(Zl(e.error)):s(null,Zl(e.data)))}else{const s=bs(this.globalScope)?void 0:[],c=e.hasCallback?(g,x)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?Tl(g):null,data:Tl(x,s)},s)}:g=>{},f=Zl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,f,c);else if(this.parent.getWorkerSource){const g=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,g[0],f.source)[g[1]](f,c)}else c(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.CanonicalTileID=mg,i.Color=en,i.ColorMode=pu,i.CullFaceMode=Dc,i.DEMData=Bg,i.DataConstantProperty=ie,i.DedupedRequest=Rw,i.DepthMode=vf,i.EXTENT=_n,i.Elevation=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const s=e.getSource().maxzoom,c=1<<s,f=Math.floor(o.x),g=Math.floor((o.x-f)*c),x=Math.floor(o.y*c),C=this.findDEMTileFor(new la(s,f,s,g,x));return!(!C||!C.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,s=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const c=this._source();if(!c||o.y<0||o.y>1)return e;const f=c.getSource().maxzoom,g=1<<f,x=Math.floor(o.x),C=o.x-x,M=new la(f,x,f,Math.floor(C*g),Math.floor(o.y*g)),P=this.findDEMTileFor(M);if(!P||!P.dem)return e;const j=P.dem,$=1<<P.tileID.canonical.z,W=(C*$-P.tileID.canonical.x)*j.dim,Y=(o.y*$-P.tileID.canonical.y)*j.dim,ee=Math.floor(W),oe=Math.floor(Y);return(s?this.exaggeration():1)*Pn(Pn(j.get(ee,oe),j.get(ee,oe+1),Y-oe),Pn(j.get(ee+1,oe),j.get(ee+1,oe+1),Y-oe),W-ee)}getAtTileOffset(o,e,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new of(o.wrap+(o.canonical.x+e/_n)/c,(o.canonical.y+s/_n)/c))}getAtTileOffsetFunc(o,e,s,c){return f=>{const g=this.getAtTileOffset(o,f.x,f.y),x=c.upVector(o.canonical,f.x,f.y);return pn(x,x,g*c.upVectorScale(o.canonical,e,s).metersToTile),x}}getForTilePoints(o,e,s,c){if(this.isUsingMockSource())return!1;const f=Rg.create(this,o,c);return!!f&&(e.forEach(g=>{g[2]=this.exaggeration()*f.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const s=e.dem.tree,c=e.tileID,f=1<<o.canonical.z-c.canonical.z;let g=o.canonical.x/f-c.canonical.x,x=o.canonical.y/f-c.canonical.y,C=0;for(let M=0;M<o.canonical.z-c.canonical.z&&!s.leaves[C];M++){g*=2,x*=2;const P=2*Math.floor(x)+Math.floor(g);C=s.childOffsets[C]+P,g%=1,x%=1}return{min:this.exaggeration()*s.minimums[C],max:this.exaggeration()*s.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},i.ErrorEvent=hi,i.EvaluationParameters=G,i.Event=Zi,i.Evented=wr,i.FillExtrusionBucket=Up,i.Frustum=hy,i.FrustumCorners=uy,i.GLOBE_RADIUS=lu,i.GLOBE_SCALE_MATCH_LATITUDE=45,i.GLOBE_ZOOM_THRESHOLD_MAX=kx,i.GLOBE_ZOOM_THRESHOLD_MIN=dy,i.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,e){const s=new Pt,c=new un,f=[],g=o+1+2,x=e[0]+1,C=e[0]+1+(1+e.length),M=(P,j,$)=>{let W=P===g-1?P-2:P===0?P:P-1;return W+=$?24575:0,[W,j]};for(let P=0;P<g;++P)s.emplaceBack(...M(P,0,!0));for(let P=0;P<x;++P)for(let j=0;j<g;++j)s.emplaceBack(...M(j,P,(j===0||j===g-1)&&!0));for(let P=0;P<e.length;++P){const j=e[P];for(let $=0;$<g;++$)s.emplaceBack(...M($,j,!0))}for(let P=0;P<e.length;++P){const j=c.length,$=e[P]+1+2,W=new un;for(let oe=0;oe<$-1;oe++){const de=oe===$-2,ve=de?g*(C-e.length+P-oe):g;for(let Le=0;Le<g-1;Le++){const xe=oe*g+Le;oe===0||de||Le===0||Le===g-2?(W.emplaceBack(xe+1,xe,xe+ve),W.emplaceBack(xe+ve,xe+ve+1,xe+1)):(c.emplaceBack(xe+1,xe,xe+ve),c.emplaceBack(xe+ve,xe+ve+1,xe+1))}}const Y=fi.simpleSegment(0,j,s.length,c.length-j);for(let oe=0;oe<W.uint16.length;oe+=3)c.emplaceBack(W.uint16[oe],W.uint16[oe+1],W.uint16[oe+2]);const ee=fi.simpleSegment(0,j,s.length,c.length-j);f.push({withoutSkirts:Y,withSkirts:ee})}return{vertices:s,indices:c,segments:f}}_createGrid(o){const e=this._fillGridMeshWithLods(ud,Pp);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,Ip.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new un;for(let f=0;f<=ud;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const s=new or,c=new or;this._poleSegments=[];for(let f=0,g=0;f<dy;f++){const x=360/(1<<f);s.emplaceBack(0,-lu,0,.5,0),c.emplaceBack(0,-lu,0,.5,1);for(let C=0;C<=ud;C++){const M=C/ud,P=Pn(0,x,M),[j,$,W]=tf(mP,gP,P,lu);s.emplaceBack(j,$,W,M,0),c.emplaceBack(j,$,W,M,1)}this._poleSegments.push(fi.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,Dx,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,Dx,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,e){if(!this._wireframeSegments){const s=new to,c=ud,f=c+1+2,g=1;this._wireframeSegments=[];for(let x=0,C=0;x<Pp.length;x++){const M=Pp[x];for(let j=g;j<M+g;j++)for(let $=g;$<c+g;$++){const W=j*f+$;s.emplaceBack(W,W+1),s.emplaceBack(W,W+f),s.emplaceBack(W,W+f+1)}const P=M*c*3;this._wireframeSegments.push(fi.simpleSegment(0,C,(M+1)*f,P)),C+=P}this._wireframeIndexBuffer=o.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},i.GlyphManager=pf,i.ImagePosition=jy,i.KDBush=n0,i.LivePerformanceUtils=Yh,i.LngLat=ri,i.LngLatBounds=Jl,i.LocalGlyphMode=Gy,i.MAX_MERCATOR_LATITUDE=Ps,i.MercatorCoordinate=of,i.ONE_EM=ys,i.OverscaledTileID=la,i.PerformanceMarkers=Nl,i.Point=me,i.Properties=Ee,i.RGBAImage=cl,i.Ray=cy,i.RequestManager=class{constructor(o,e,s){this._transformRequestFn=o,this._customAccessToken=e,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let e="";for(let s=0;s<10;s++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",J,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,e){return this._transformRequestFn&&this._transformRequestFn(o,e)||{url:o}}normalizeStyleURL(o,e){if(!Ge(o))return o;const s=jt(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeGlyphsURL(o,e){if(!Ge(o))return o;const s=jt(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeSourceURL(o,e,s,c){if(!Ge(o))return o;const f=jt(o);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),s&&f.params.push(`language=${s}`),c&&f.params.push(`worldview=${c}`),this._makeAPIURL(f,this._customAccessToken||e)}normalizeSpriteURL(o,e,s,c){const f=jt(o);return Ge(o)?(f.path=`/styles/v1${f.path}/sprite${e}${s}`,this._makeAPIURL(f,this._customAccessToken||c)):(f.path+=`${e}${s}`,Dt(f))}normalizeTileURL(o,e,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Ge(o))return o;const c=jt(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||s&&c.authority!=="raster"&&s===512?"@2x":""}${O.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${I.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${I.TILE_URL_VERSION}${c.path}`);const f=this._customAccessToken||function(g){for(const x of g){const C=x.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(c.params)||I.ACCESS_TOKEN;return I.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,f)}canonicalizeTileURL(o,e){const s=jt(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${I.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${I.TILE_URL_VERSION}/`,"")}`;let f=s.params;return e&&(f=f.filter(g=>!g.match(/^access_token=/))),f.length&&(c+=`?${f.join("&")}`),c}canonicalizeTileset(o,e){const s=!!e&&Ge(e),c=[];for(const f of o.tiles||[])Xe(f)?c.push(this.canonicalizeTileURL(f,s)):c.push(f);return c}_makeAPIURL(o,e){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=jt(I.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,o.protocol==="http"){const f=o.params.indexOf("secure");f>=0&&o.params.splice(f,1)}if(c.path!=="/"&&(o.path=`${c.path}${o.path}`),!I.REQUIRE_ACCESS_TOKEN)return Dt(o);if(e=e||I.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(f=>f.indexOf("access_token")===-1),o.params.push(`access_token=${e||""}`),Dt(o)}},i.ResourceType=Ko,i.SegmentVector=fi,i.SourceCache=gd,i.StencilMode=Yy,i.StructArrayLayout1ui2=Vo,i.StructArrayLayout2f1f2i16=gn,i.StructArrayLayout2i4=Pt,i.StructArrayLayout2ui4=to,i.StructArrayLayout3f12=Nn,i.StructArrayLayout3ui6=un,i.StructArrayLayout4i8=gt,i.StructArrayLayout5f20=or,i.Texture=Jp,i.Tile=Ky,i.Transitionable=ne,i.Uniform1f=Sh,i.Uniform1i=class extends ql{constructor(o){super(o),this.current=0}set(o,e,s){this.fetchUniformLocation(o,e)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},i.Uniform2f=class extends ql{constructor(o){super(o),this.current=[0,0]}set(o,e,s){this.fetchUniformLocation(o,e)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}},i.Uniform3f=class extends ql{constructor(o){super(o),this.current=[0,0,0]}set(o,e,s){this.fetchUniformLocation(o,e)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}},i.Uniform4f=ad,i.UniformColor=qm,i.UniformMatrix2f=class extends ql{constructor(o){super(o),this.current=Jm}set(o,e,s){if(this.fetchUniformLocation(o,e)){for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}},i.UniformMatrix3f=class extends ql{constructor(o){super(o),this.current=Km}set(o,e,s){if(this.fetchUniformLocation(o,e)){for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},i.UniformMatrix4f=class extends ql{constructor(o){super(o),this.current=sy}set(o,e,s){if(this.fetchUniformLocation(o,e)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}},i.UnwrappedTileID=Cb,i.ValidationError=nn,i.VectorTileFeature=fg,i.VectorTileWorkerSource=class extends wr{constructor(o,e,s,c,f){super(),this.actor=o,this.layerIndex=e,this.availableImages=s,this.loadVectorData=f||Dw,this.loading={},this.loaded={},this.deduped=new Rw(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,e){const s=o.uid,c=o&&o.request,f=c&&c.collectResourceTiming,g=this.loading[s]=new wB(o);g.abort=this.loadVectorData(o,(x,C)=>{const M=!this.loading[s];if(delete this.loading[s],M||x||!C)return g.status="done",M||(this.loaded[s]=g),e(x);const P=C.rawData,j={};C.expires&&(j.expires=C.expires),C.cacheControl&&(j.cacheControl=C.cacheControl),g.vectorTile=C.vectorTile||new Dy(new vg(P));const $=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(W,Y)=>{if(W||!Y)return e(W);const ee={};if(f){const oe=_c(c);oe.length>0&&(ee.resourceTiming=JSON.parse(JSON.stringify(oe)))}e(null,On({rawTileData:P.slice(0)},Y,j,ee))})};this.isSpriteLoaded?$():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add($,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):$()}),this.loaded=this.loaded||{},this.loaded[s]=g})}reloadTile(o,e){const s=this.loaded,c=o.uid,f=this;if(s&&s[c]){const g=s[c];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=md(o.tileID.canonical,o.projection);const x=(C,M)=>{const P=g.reloadCallback;P&&(delete g.reloadCallback,g.parse(g.vectorTile,f.layerIndex,this.availableImages,f.actor,P)),e(C,M)};g.status==="parsing"?g.reloadCallback=x:g.status==="done"&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(o,e){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),e()}removeTile(o,e){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],e()}},i.WritingMode=Pl,i.ZoomDependentExpression=Zc,i.add=Nt,i.addDynamicAttributes=Ig,i.adjoint=function(o,e){var s=e[0],c=e[1],f=e[2],g=e[3],x=e[4],C=e[5],M=e[6],P=e[7],j=e[8];return o[0]=x*j-C*P,o[1]=f*P-c*j,o[2]=c*C-f*x,o[3]=C*M-g*j,o[4]=s*j-f*M,o[5]=f*g-s*C,o[6]=g*P-x*M,o[7]=c*M-s*P,o[8]=s*x-c*g,o},i.asyncAll=mn,i.bezier=hn,i.bindAll=Ln,i.boundsAttributes=gw,i.bufferConvexPolygon=function(o,e){const s=[];for(let c=0;c<o.length;c++){const f=Zt(c-1,-1,o.length-1),g=Zt(c+1,-1,o.length-1),x=o[c],C=o[g],M=o[f].sub(x).unit(),P=C.sub(x).unit(),j=P.angleWithSep(M.x,M.y),$=M.add(P).unit().mult(-1*e/Math.sin(j/2));s.push(x.add($))}return s},i.cacheEntryPossiblyAdded=function(o){bo++,bo>Bi&&(o.getActor().send("enforceCacheSizeLimit",Hr),bo=0)},i.calculateGlobeLabelMatrix=function(o,e){const{x:s,y:c}=o.point,f=Nx(s,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Pc(f,f,my(cu(e)))},i.calculateGlobeMatrix=function(o){const{x:e,y:s}=o.point,{lng:c,lat:f}=o._center;return Nx(e,s,o.worldSize,c,f)},i.calculateGlobeMercatorMatrix=function(o){const e=o.pixelsPerMeter,s=e/Lc(1,o.center.lat),c=ll(new Float64Array(16));return cd(c,c,[o.point.x,o.point.y,0]),qu(c,c,[s,s,e]),Float32Array.from(c)},i.circumferenceAtLatitude=_y,i.clamp=bt,i.clearTileCache=function(o){if(!Oo())return;const e=E.caches.delete($r);o&&e.catch(o).then(()=>o())},i.clipLine=Yb,i.clone=function(o){var e=new oa(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e},i.clone$1=ci,i.collisionCircleLayout=xL,i.config=I,i.conjugate=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},i.create=function(){var o=new oa(16);return oa!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},i.create$1=Sp,i.createExpression=wc,i.createLayout=$e,i.createStyleLayer=function(o){return o.type==="custom"?new hB(o):new fB[o.type](o)},i.cross=Ye,i.degToRad=_t,i.distance=function(o,e){return Math.hypot(e[0]-o[0],e[1]-o[1],e[2]-o[2])},i.div=function(o,e,s){return o[0]=e[0]/s[0],o[1]=e[1]/s[1],o[2]=e[2]/s[2],o},i.dot=lt,i.earthRadius=Rp,i.ease=wt,i.easeCubicInOut=Gt,i.ecefToLatLng=function([o,e,s]){const c=Math.hypot(o,e,s),f=Math.atan2(o,s),g=.5*Math.PI-Math.acos(-e/c);return new ri(Bt(f),Bt(g))},i.emitValidationErrors=wh,i.endsWith=li,i.enforceCacheSizeLimit=function(o){no(),ui&&ui.then(e=>{e.keys().then(s=>{for(let c=0;c<s.length-o;c++)e.delete(s[c])})})},i.evaluateSizeForFeature=_g,i.evaluateSizeForZoom=uf,i.evaluateVariableOffset=rw,i.evented=w,i.exactEquals=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},i.exactEquals$1=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]},i.exported=zr,i.exported$1=O,i.extend=On,i.extend$1=Si,i.fillExtrusionHeightLift=bb,i.filterObject=Br,i.fromMat4=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},i.fromQuat=function(o,e){var s=e[0],c=e[1],f=e[2],g=e[3],x=s+s,C=c+c,M=f+f,P=s*x,j=c*x,$=c*C,W=f*x,Y=f*C,ee=f*M,oe=g*x,de=g*C,ve=g*M;return o[0]=1-$-ee,o[1]=j+ve,o[2]=W-de,o[3]=0,o[4]=j-ve,o[5]=1-P-ee,o[6]=Y+oe,o[7]=0,o[8]=W+de,o[9]=Y-oe,o[10]=1-P-$,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromRotation=function(o,e){var s=Math.sin(e),c=Math.cos(e);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},i.fromScaling=L,i.furthestTileCorner=function(o){const e=Math.round((o+45+360)%360/90)%4;return Kt[e]},i.getAABBPointSquareDist=function(o,e,s){let c=0;for(let f=0;f<2;++f){const g=s?s[f]:0;o[f]>g&&(c+=(o[f]-g)*(o[f]-g)),e[f]<g&&(c+=(g-e[f])*(g-e[f]))}return c},i.getAnchorAlignment=Ny,i.getAnchorJustification=$y,i.getBounds=function(o){let e=1/0,s=1/0,c=-1/0,f=-1/0;for(const g of o)e=Math.min(e,g.x),s=Math.min(s,g.y),c=Math.max(c,g.x),f=Math.max(f,g.y);return{min:new me(e,s),max:new me(c,f)}},i.getColumn=xn,i.getDefaultExportFromCjs=te,i.getGridMatrix=function(o,e,s,c){const f=e.getNorth(),g=e.getSouth(),x=e.getWest(),C=e.getEast(),M=1<<o.z,P=C-x,j=f-g,$=P/ud,W=-j/Pp[s],Y=[0,$,0,W,0,0,f,x,0];if(o.z>0){const ee=180/c;Mp(Y,Y,[ee/P+1,0,0,0,ee/j+1,0,-.5*ee/$,.5*ee/W,1])}return Y[2]=M,Y[5]=o.x,Y[8]=o.y,Y},i.getImage=Te,i.getJSON=function(o,e){return Vt(On(o,{type:"json"}),e)},i.getLatitudinalLod=function(o){const e=Ps-5;o=bt(o,-e,e)/e*90;const s=Math.pow(Math.abs(Math.sin(_t(o))),3);return Math.round(s*(Pp.length-1))},i.getMapSessionAPI=br,i.getPerformanceMeasurement=_c,i.getProjection=hw,i.getRTLTextPluginStatus=S,i.getReferrer=Je,i.getTilePoint=function(o,{x:e,y:s},c=0){return new me(((e-c)*o.scale-o.x)*_n,(s*o.scale-o.y)*_n)},i.getTileVec3=function(o,e,s=0){return vt(((e.x-s)*o.scale-o.x)*_n,(e.y*o.scale-o.y)*_n,Hx(e.z,e.y))},i.getVideo=function(o,e){const s=E.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let c=0;c<o.length;c++){const f=E.document.createElement("source");ir(o[c])||(s.crossOrigin="Anonymous"),f.src=o[c],s.appendChild(f)}return{cancel:()=>{}}},i.globeCenterToScreenPoint=function(o){const e=[0,0,0],s=ll(new Float64Array(16));return Pc(s,o.pixelMatrix,o.globeMatrix),ut(e,e,s),new me(e[0],e[1])},i.globeDenormalizeECEF=my,i.globeECEFOrigin=function(o,e){const s=[0,0,0];return ut(s,s,Bp(cu(e.canonical))),ut(s,s,o),s},i.globeMetersToEcef=tg,i.globeNormalizeECEF=Bp,i.globePixelsToTileUnits=function(o,e){return _n/(512*Math.pow(2,o))*rg(cu(e))},i.globePoleMatrixForTile=function(o,e,s){const c=ll(new Float64Array(16)),f=(e/(1<<o)-.5)*Math.PI*2;return v(c,s.globeMatrix,f),Float32Array.from(c)},i.globeTileBounds=cu,i.globeTiltAtLngLat=Gx,i.globeToMercatorTransition=rf,i.globeUseCustomAntiAliasing=function(o,e,s){const c=rf(s.zoom),f=o.style.map._antialias,g=!!e.extStandardDerivatives,x=e.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return c===0&&!f&&!x&&g},i.identity=ll,i.identity$1=Lx,i.invert=ef,i.isFullscreen=function(){return!!E.document.fullscreenElement||!!E.document.webkitFullscreenElement},i.isLngLatBehindGlobe=gy,i.isMapAuthenticated=function(o){return Eo.has(o)},i.isMapboxURL=Ge,i.isSafariWithAntialiasingBug=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!bs(o)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.latFromMercatorY=Is,i.latLngToECEF=nf,i.len=Nr,i.length=Ze,i.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},i.lngFromMercatorX=Il,i.loadVectorTile=Dw,i.makeRequest=Vt,i.mapValue=function(o,e,s,c,f){return bt((o-e)/(s-e)*(f-c)+c,c,f)},i.mercatorScale=Wx,i.mercatorXfromLng=uu,i.mercatorYfromLat=hu,i.mercatorZfromAltitude=Lc,i.mul=K,i.mul$1=ur,i.multiply=Pc,i.multiply$1=Mp,i.multiply$2=lr,i.nextPowerOfTwo=Jr,i.normalize=Ei,i.normalize$1=cP,i.normalize$2=Ur,i.number=Pn,i.ortho=function(o,e,s,c,f,g,x){var C=1/(e-s),M=1/(c-f),P=1/(g-x);return o[0]=-2*C,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*M,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*P,o[11]=0,o[12]=(e+s)*C,o[13]=(f+c)*M,o[14]=(x+g)*P,o[15]=1,o},i.pbf=Lb,i.perspective=function(o,e,s,c,f){var g,x=1/Math.tan(e/2);return o[0]=x/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,f!=null&&f!==1/0?(o[10]=(f+c)*(g=1/(c-f)),o[14]=2*f*c*g):(o[10]=-1,o[14]=-2*c),o},i.pick=function(o,e){const s={};for(let c=0;c<e.length;c++){const f=e[c];f in o&&(s[f]=o[f])}return s},i.plugin=D,i.pointGeometry=Ce,i.polesInViewport=function(o){const e=ll(new Float64Array(16));Pc(e,o.pixelMatrix,o.globeMatrix);const s=[0,Yl,0],c=[0,Ql,0];return ut(s,s,e),ut(c,c,e),[s[0]>0&&s[0]<=o.width&&s[1]>0&&s[1]<=o.height&&!gy(o,new ri(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!gy(o,new ri(o.center.lat,-90))]},i.polygonContainsPoint=fd,i.polygonIntersectsBox=Qx,i.polygonIntersectsPolygon=qx,i.polygonizeBounds=function(o,e,s=0,c=!0){const f=new me(s,s),g=o.sub(f),x=e.add(f),C=[g,new me(x.x,g.y),x,new me(g.x,x.y)];return c&&C.push(g.clone()),C},i.posAttributes=Ip,i.postMapLoadEvent=yi,i.postPerformanceEvent=zi,i.postTurnstileEvent=$n,i.potpack=Fy,i.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},i.radToDeg=Bt,i.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.registerForPluginStateChange=function(o){return o({pluginStatus:m,pluginURL:a}),w.on("pluginStateChange",o),o},i.removeAuthState=function(o){Eo.delete(o)},i.renderColorRamp=Ay,i.resample=Zx,i.rotateX=_,i.rotateX$1=Bx,i.rotateY=v,i.rotateY$1=Rx,i.rotateZ=function(o,e,s){var c=Math.sin(s),f=Math.cos(s),g=e[0],x=e[1],C=e[2],M=e[3],P=e[4],j=e[5],$=e[6],W=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=g*f+P*c,o[1]=x*f+j*c,o[2]=C*f+$*c,o[3]=M*f+W*c,o[4]=P*f-g*c,o[5]=j*f-x*c,o[6]=$*f-C*c,o[7]=W*f-M*c,o},i.rotateZ$1=function(o,e,s){s*=.5;var c=e[0],f=e[1],g=e[2],x=e[3],C=Math.sin(s),M=Math.cos(s);return o[0]=c*M+f*C,o[1]=f*M-c*C,o[2]=g*M+x*C,o[3]=x*M-g*C,o},i.scale=qu,i.scale$1=Ho,i.scale$2=pn,i.scaleAndAdd=Po,i.set=function(o,e,s,c){return o[0]=e,o[1]=s,o[2]=c,o},i.setCacheLimits=function(o,e){Hr=o,Bi=e},i.setColumn=function(o,e,s){o[4*e+0]=s[0],o[4*e+1]=s[1],o[4*e+2]=s[2],o[4*e+3]=s[3]},i.setRTLTextPlugin=function(o,e,s=!1){if(m===nu||m===Wu||m===Th)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=zr.resolveURL(o),m=nu,ru=e,y(),s||R()},i.smoothstep=$t,i.spec=et,i.squaredLength=function(o){var e=o[0],s=o[1],c=o[2];return e*e+s*s+c*c},i.storeAuthState=function(o,e){e?Eo.add(o):Eo.delete(o)},i.sub=Gn,i.subtract=vn,i.symbolSize=bL,i.tileAABB=function(o,e,s,c,f,g,x,C,M){if(M.name==="globe")return pP(o,e,new mg(s,c,f));const P=md({z:s,x:c,y:f},M);return new aa([(g+P.x/P.scale)*e,e*(P.y/P.scale),x],[(g+P.x2/P.scale)*e,e*(P.y2/P.scale),C])},i.tileCornersToBounds=ng,i.tileTransform=md,i.transformMat3=function(o,e,s){var c=e[0],f=e[1],g=e[2];return o[0]=c*s[0]+f*s[3]+g*s[6],o[1]=c*s[1]+f*s[4]+g*s[7],o[2]=c*s[2]+f*s[5]+g*s[8],o},i.transformMat4=ut,i.transformMat4$1=sa,i.transformQuat=dn,i.transitionTileAABBinECEF=Fx,i.translate=cd,i.transpose=function(o,e){if(o===e){var s=e[1],c=e[2],f=e[5];o[1]=e[3],o[2]=e[6],o[3]=s,o[5]=e[7],o[6]=c,o[7]=f}else o[0]=e[0],o[1]=e[3],o[2]=e[6],o[3]=e[1],o[4]=e[4],o[5]=e[7],o[6]=e[2],o[7]=e[5],o[8]=e[8];return o},i.triggerPluginCompletionEvent=h,i.uniqueId=Yn,i.updateGlobeVertexNormal=function(o,e,s,c,f){const g=5*e+2;o.float32[g+0]=s,o.float32[g+1]=c,o.float32[g+2]=f},i.validateCustomStyleLayer=function(o){const e=[],s=o.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},i.validateFilter=o=>zs(Ms(o)),i.validateFog=o=>zs(as(o)),i.validateLayer=o=>zs(Vu(o)),i.validateLight=o=>zs($d(o)),i.validateSource=o=>zs(No(o)),i.validateStyle=nd,i.validateTerrain=o=>zs(_s(o)),i.values=yn,i.vectorTile=dg,i.version=T,i.warnOnce=wn,i.window=E,i.wrap=Zt}),p(["./shared"],function(i){function E(Ae){if(typeof Ae=="number"||typeof Ae=="boolean"||typeof Ae=="string"||Ae==null)return JSON.stringify(Ae);if(Array.isArray(Ae)){let le="[";for(const Te of Ae)le+=`${E(Te)},`;return`${le}]`}let se="{";for(const le of Object.keys(Ae).sort())se+=`${le}:${E(Ae[le])},`;return`${se}}`}function T(Ae){let se="";for(const le of i.refProperties)se+=`/${E(Ae[le])}`;return se}class A{constructor(se){this.keyCache={},se&&this.replace(se)}replace(se){this._layerConfigs={},this._layers={},this.update(se,[])}update(se,le){for(const Be of se)this._layerConfigs[Be.id]=Be,(this._layers[Be.id]=i.createStyleLayer(Be)).compileFilter(),this.keyCache[Be.id]&&delete this.keyCache[Be.id];for(const Be of le)delete this.keyCache[Be],delete this._layerConfigs[Be],delete this._layers[Be];this.familiesBySource={};const Te=function(Be,Ge){const Xe={};for(let Ve=0;Ve<Be.length;Ve++){const rt=Ge&&Ge[Be[Ve].id]||T(Be[Ve]);Ge&&(Ge[Be[Ve].id]=rt);let Rt=Xe[rt];Rt||(Rt=Xe[rt]=[]),Rt.push(Be[Ve])}const qe=[];for(const Ve in Xe)qe.push(Xe[Ve]);return qe}(i.values(this._layerConfigs),this.keyCache);for(const Be of Te){const Ge=Be.map(jt=>this._layers[jt.id]),Xe=Ge[0];if(Xe.visibility==="none")continue;const qe=Xe.source||"";let Ve=this.familiesBySource[qe];Ve||(Ve=this.familiesBySource[qe]={});const rt=Xe.sourceLayer||"_geojsonTileLayer";let Rt=Ve[rt];Rt||(Rt=Ve[rt]=[]),Rt.push(Ge)}}}class I{loadTile(se,le){const{uid:Te,encoding:Be,rawImageData:Ge,padding:Xe,buildQuadTree:qe}=se,Ve=i.window.ImageBitmap&&Ge instanceof i.window.ImageBitmap?this.getImageData(Ge,Xe):Ge;le(null,new i.DEMData(Te,Ve,Be,Xe<1,qe))}getImageData(se,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const Te=this.offscreenCanvasContext.getImageData(-le,-le,se.width+2*le,se.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Te}}function O(Ae,se){if(Ae.length!==0){z(Ae[0],se);for(var le=1;le<Ae.length;le++)z(Ae[le],!se)}}function z(Ae,se){for(var le=0,Te=0,Be=0,Ge=Ae.length,Xe=Ge-1;Be<Ge;Xe=Be++){var qe=(Ae[Be][0]-Ae[Xe][0])*(Ae[Xe][1]+Ae[Be][1]),Ve=le+qe;Te+=Math.abs(le)>=Math.abs(qe)?le-Ve+qe:qe-Ve+le,le=Ve}le+Te>=0!=!!se&&Ae.reverse()}var U=i.getDefaultExportFromCjs(function Ae(se,le){var Te,Be=se&&se.type;if(Be==="FeatureCollection")for(Te=0;Te<se.features.length;Te++)Ae(se.features[Te],le);else if(Be==="GeometryCollection")for(Te=0;Te<se.geometries.length;Te++)Ae(se.geometries[Te],le);else if(Be==="Feature")Ae(se.geometry,le);else if(Be==="Polygon")O(se.coordinates,le);else if(Be==="MultiPolygon")for(Te=0;Te<se.coordinates.length;Te++)O(se.coordinates[Te],le);return se});const N=i.VectorTileFeature.prototype.toGeoJSON;var V={exports:{}},X=i.pointGeometry,J=i.vectorTile.VectorTileFeature,te=ue;function ue(Ae,se){this.options=se||{},this.features=Ae,this.length=Ae.length}function ae(Ae,se){this.id=typeof Ae.id=="number"?Ae.id:void 0,this.type=Ae.type,this.rawGeometry=Ae.type===1?[Ae.geometry]:Ae.geometry,this.properties=Ae.tags,this.extent=se||4096}ue.prototype.feature=function(Ae){return new ae(this.features[Ae],this.options.extent)},ae.prototype.loadGeometry=function(){var Ae=this.rawGeometry;this.geometry=[];for(var se=0;se<Ae.length;se++){for(var le=Ae[se],Te=[],Be=0;Be<le.length;Be++)Te.push(new X(le[Be][0],le[Be][1]));this.geometry.push(Te)}return this.geometry},ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ae=this.geometry,se=1/0,le=-1/0,Te=1/0,Be=-1/0,Ge=0;Ge<Ae.length;Ge++)for(var Xe=Ae[Ge],qe=0;qe<Xe.length;qe++){var Ve=Xe[qe];se=Math.min(se,Ve.x),le=Math.max(le,Ve.x),Te=Math.min(Te,Ve.y),Be=Math.max(Be,Ve.y)}return[se,Te,le,Be]},ae.prototype.toGeoJSON=J.prototype.toGeoJSON;var be=i.pbf,Ce=te;function je(Ae){var se=new be;return function(le,Te){for(var Be in le.layers)Te.writeMessage(3,me,le.layers[Be])}(Ae,se),se.finish()}function me(Ae,se){var le;se.writeVarintField(15,Ae.version||1),se.writeStringField(1,Ae.name||""),se.writeVarintField(5,Ae.extent||4096);var Te={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<Ae.length;le++)Te.feature=Ae.feature(le),se.writeMessage(2,Ne,Te);var Be=Te.keys;for(le=0;le<Be.length;le++)se.writeStringField(3,Be[le]);var Ge=Te.values;for(le=0;le<Ge.length;le++)se.writeMessage(4,Gt,Ge[le])}function Ne(Ae,se){var le=Ae.feature;le.id!==void 0&&se.writeVarintField(1,le.id),se.writeMessage(2,ht,Ae),se.writeVarintField(3,le.type),se.writeMessage(4,Kt,le)}function ht(Ae,se){var le=Ae.feature,Te=Ae.keys,Be=Ae.values,Ge=Ae.keycache,Xe=Ae.valuecache;for(var qe in le.properties){var Ve=le.properties[qe],rt=Ge[qe];if(Ve!==null){rt===void 0&&(Te.push(qe),Ge[qe]=rt=Te.length-1),se.writeVarint(rt);var Rt=typeof Ve;Rt!=="string"&&Rt!=="boolean"&&Rt!=="number"&&(Ve=JSON.stringify(Ve));var jt=Rt+":"+Ve,Dt=Xe[jt];Dt===void 0&&(Be.push(Ve),Xe[jt]=Dt=Be.length-1),se.writeVarint(Dt)}}}function _t(Ae,se){return(se<<3)+(7&Ae)}function Bt(Ae){return Ae<<1^Ae>>31}function Kt(Ae,se){for(var le=Ae.loadGeometry(),Te=Ae.type,Be=0,Ge=0,Xe=le.length,qe=0;qe<Xe;qe++){var Ve=le[qe],rt=1;Te===1&&(rt=Ve.length),se.writeVarint(_t(1,rt));for(var Rt=Te===3?Ve.length-1:Ve.length,jt=0;jt<Rt;jt++){jt===1&&Te!==1&&se.writeVarint(_t(2,Rt-1));var Dt=Ve[jt].x-Be,En=Ve[jt].y-Ge;se.writeVarint(Bt(Dt)),se.writeVarint(Bt(En)),Be+=Dt,Ge+=En}Te===3&&se.writeVarint(_t(7,1))}}function Gt(Ae,se){var le=typeof Ae;le==="string"?se.writeStringField(1,Ae):le==="boolean"?se.writeBooleanField(7,Ae):le==="number"&&(Ae%1!=0?se.writeDoubleField(3,Ae):Ae<0?se.writeSVarintField(6,Ae):se.writeVarintField(5,Ae))}V.exports=je,V.exports.fromVectorTileJs=je,V.exports.fromGeojsonVt=function(Ae,se){se=se||{};var le={};for(var Te in Ae)le[Te]=new Ce(Ae[Te].features,se),le[Te].name=Te,le[Te].version=se.version,le[Te].extent=se.extent;return je({layers:le})},V.exports.GeoJSONWrapper=Ce;var hn=i.getDefaultExportFromCjs(V.exports);const wt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},bt=Math.fround||($t=new Float32Array(1),Ae=>($t[0]=+Ae,$t[0]));var $t;const Zt=3,mn=5,yn=6;class On{constructor(se){this.options=Object.assign(Object.create(wt),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:le,minZoom:Te,maxZoom:Be}=this.options;le&&console.time("total time");const Ge=`prepare ${se.length} points`;le&&console.time(Ge),this.points=se;const Xe=[];for(let Ve=0;Ve<se.length;Ve++){const rt=se[Ve];if(!rt.geometry)continue;const[Rt,jt]=rt.geometry.coordinates,Dt=bt(Vr(Rt)),En=bt(Jr(jt));Xe.push(Dt,En,1/0,Ve,-1,1),this.options.reduce&&Xe.push(0)}let qe=this.trees[Be+1]=this._createTree(Xe);le&&console.timeEnd(Ge);for(let Ve=Be;Ve>=Te;Ve--){const rt=+Date.now();qe=this.trees[Ve]=this._createTree(this._cluster(qe,Ve)),le&&console.log("z%d: %d clusters in %dms",Ve,qe.numItems,+Date.now()-rt)}return le&&console.timeEnd("total time"),this}getClusters(se,le){let Te=((se[0]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,se[1]));let Ge=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)Te=-180,Ge=180;else if(Te>Ge){const jt=this.getClusters([Te,Be,180,Xe],le),Dt=this.getClusters([-180,Be,Ge,Xe],le);return jt.concat(Dt)}const qe=this.trees[this._limitZoom(le)],Ve=qe.range(Vr(Te),Jr(Xe),Vr(Ge),Jr(Be)),rt=qe.data,Rt=[];for(const jt of Ve){const Dt=this.stride*jt;Rt.push(rt[Dt+mn]>1?rr(rt,Dt,this.clusterProps):this.points[rt[Dt+Zt]])}return Rt}getChildren(se){const le=this._getOriginId(se),Te=this._getOriginZoom(se),Be="No cluster with the specified id.",Ge=this.trees[Te];if(!Ge)throw new Error(Be);const Xe=Ge.data;if(le*this.stride>=Xe.length)throw new Error(Be);const qe=this.options.radius/(this.options.extent*Math.pow(2,Te-1)),Ve=Ge.within(Xe[le*this.stride],Xe[le*this.stride+1],qe),rt=[];for(const Rt of Ve){const jt=Rt*this.stride;Xe[jt+4]===se&&rt.push(Xe[jt+mn]>1?rr(Xe,jt,this.clusterProps):this.points[Xe[jt+Zt]])}if(rt.length===0)throw new Error(Be);return rt}getLeaves(se,le,Te){const Be=[];return this._appendLeaves(Be,se,le=le||10,Te=Te||0,0),Be}getTile(se,le,Te){const Be=this.trees[this._limitZoom(se)],Ge=Math.pow(2,se),{extent:Xe,radius:qe}=this.options,Ve=qe/Xe,rt=(Te-Ve)/Ge,Rt=(Te+1+Ve)/Ge,jt={features:[]};return this._addTileFeatures(Be.range((le-Ve)/Ge,rt,(le+1+Ve)/Ge,Rt),Be.data,le,Te,Ge,jt),le===0&&this._addTileFeatures(Be.range(1-Ve/Ge,rt,1,Rt),Be.data,Ge,Te,Ge,jt),le===Ge-1&&this._addTileFeatures(Be.range(0,rt,Ve/Ge,Rt),Be.data,-1,Te,Ge,jt),jt.features.length?jt:null}getClusterExpansionZoom(se){let le=this._getOriginZoom(se)-1;for(;le<=this.options.maxZoom;){const Te=this.getChildren(se);if(le++,Te.length!==1)break;se=Te[0].properties.cluster_id}return le}_appendLeaves(se,le,Te,Be,Ge){const Xe=this.getChildren(le);for(const qe of Xe){const Ve=qe.properties;if(Ve&&Ve.cluster?Ge+Ve.point_count<=Be?Ge+=Ve.point_count:Ge=this._appendLeaves(se,Ve.cluster_id,Te,Be,Ge):Ge<Be?Ge++:se.push(qe),se.length===Te)break}return Ge}_createTree(se){const le=new i.KDBush(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Te=0;Te<se.length;Te+=this.stride)le.add(se[Te],se[Te+1]);return le.finish(),le.data=se,le}_addTileFeatures(se,le,Te,Be,Ge,Xe){for(const qe of se){const Ve=qe*this.stride,rt=le[Ve+mn]>1;let Rt,jt,Dt;if(rt)Rt=Yn(le,Ve,this.clusterProps),jt=le[Ve],Dt=le[Ve+1];else{const Fn=this.points[le[Ve+Zt]];Rt=Fn.properties;const[zn,$n]=Fn.geometry.coordinates;jt=Vr(zn),Dt=Jr($n)}const En={type:1,geometry:[[Math.round(this.options.extent*(jt*Ge-Te)),Math.round(this.options.extent*(Dt*Ge-Be))]],tags:Rt};let Un;Un=rt||this.options.generateId?le[Ve+Zt]:this.points[le[Ve+Zt]].id,Un!==void 0&&(En.id=Un),Xe.features.push(En)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,le){const{radius:Te,extent:Be,reduce:Ge,minPoints:Xe}=this.options,qe=Te/(Be*Math.pow(2,le)),Ve=se.data,rt=[],Rt=this.stride;for(let jt=0;jt<Ve.length;jt+=Rt){if(Ve[jt+2]<=le)continue;Ve[jt+2]=le;const Dt=Ve[jt],En=Ve[jt+1],Un=se.within(Ve[jt],Ve[jt+1],qe),Fn=Ve[jt+mn];let zn=Fn;for(const $n of Un){const Yr=$n*Rt;Ve[Yr+2]>le&&(zn+=Ve[Yr+mn])}if(zn>Fn&&zn>=Xe){let $n,Yr=Dt*Fn,yi=En*Fn,Wi=-1;const zi=((jt/Rt|0)<<5)+(le+1)+this.points.length;for(const Hs of Un){const br=Hs*Rt;if(Ve[br+2]<=le)continue;Ve[br+2]=le;const Eo=Ve[br+mn];Yr+=Ve[br]*Eo,yi+=Ve[br+1]*Eo,Ve[br+4]=zi,Ge&&($n||($n=this._map(Ve,jt,!0),Wi=this.clusterProps.length,this.clusterProps.push($n)),Ge($n,this._map(Ve,br)))}Ve[jt+4]=zi,rt.push(Yr/zn,yi/zn,1/0,zi,-1,zn),Ge&&rt.push(Wi)}else{for(let $n=0;$n<Rt;$n++)rt.push(Ve[jt+$n]);if(zn>1)for(const $n of Un){const Yr=$n*Rt;if(!(Ve[Yr+2]<=le)){Ve[Yr+2]=le;for(let yi=0;yi<Rt;yi++)rt.push(Ve[Yr+yi])}}}}return rt}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,le,Te){if(se[le+mn]>1){const Xe=this.clusterProps[se[le+yn]];return Te?Object.assign({},Xe):Xe}const Be=this.points[se[le+Zt]].properties,Ge=this.options.map(Be);return Te&&Ge===Be?Object.assign({},Ge):Ge}}function rr(Ae,se,le){return{type:"Feature",id:Ae[se+Zt],properties:Yn(Ae,se,le),geometry:{type:"Point",coordinates:[(Te=Ae[se],360*(Te-.5)),kr(Ae[se+1])]}};var Te}function Yn(Ae,se,le){const Te=Ae[se+mn],Be=Te>=1e4?`${Math.round(Te/1e3)}k`:Te>=1e3?Math.round(Te/100)/10+"k":Te,Ge=Ae[se+yn],Xe=Ge===-1?{}:Object.assign({},le[Ge]);return Object.assign(Xe,{cluster:!0,cluster_id:Ae[se+Zt],point_count:Te,point_count_abbreviated:Be})}function Vr(Ae){return Ae/360+.5}function Jr(Ae){const se=Math.sin(Ae*Math.PI/180),le=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return le<0?0:le>1?1:le}function kr(Ae){const se=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function Ln(Ae,se,le,Te){for(var Be,Ge=Te,Xe=le-se>>1,qe=le-se,Ve=Ae[se],rt=Ae[se+1],Rt=Ae[le],jt=Ae[le+1],Dt=se+3;Dt<le;Dt+=3){var En=li(Ae[Dt],Ae[Dt+1],Ve,rt,Rt,jt);if(En>Ge)Be=Dt,Ge=En;else if(En===Ge){var Un=Math.abs(Dt-Xe);Un<qe&&(Be=Dt,qe=Un)}}Ge>Te&&(Be-se>3&&Ln(Ae,se,Be,Te),Ae[Be+2]=Ge,le-Be>3&&Ln(Ae,Be,le,Te))}function li(Ae,se,le,Te,Be,Ge){var Xe=Be-le,qe=Ge-Te;if(Xe!==0||qe!==0){var Ve=((Ae-le)*Xe+(se-Te)*qe)/(Xe*Xe+qe*qe);Ve>1?(le=Be,Te=Ge):Ve>0&&(le+=Xe*Ve,Te+=qe*Ve)}return(Xe=Ae-le)*Xe+(qe=se-Te)*qe}function kn(Ae,se,le,Te){var Be={id:Ae===void 0?null:Ae,type:se,geometry:le,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var Xe=Ge.geometry,qe=Ge.type;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")Br(Ge,Xe);else if(qe==="Polygon"||qe==="MultiLineString")for(var Ve=0;Ve<Xe.length;Ve++)Br(Ge,Xe[Ve]);else if(qe==="MultiPolygon")for(Ve=0;Ve<Xe.length;Ve++)for(var rt=0;rt<Xe[Ve].length;rt++)Br(Ge,Xe[Ve][rt])}(Be),Be}function Br(Ae,se){for(var le=0;le<se.length;le+=3)Ae.minX=Math.min(Ae.minX,se[le]),Ae.minY=Math.min(Ae.minY,se[le+1]),Ae.maxX=Math.max(Ae.maxX,se[le]),Ae.maxY=Math.max(Ae.maxY,se[le+1])}function ci(Ae,se,le,Te){if(se.geometry){var Be=se.geometry.coordinates,Ge=se.geometry.type,Xe=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2),qe=[],Ve=se.id;if(le.promoteId?Ve=se.properties[le.promoteId]:le.generateId&&(Ve=Te||0),Ge==="Point")Ji(Be,qe);else if(Ge==="MultiPoint")for(var rt=0;rt<Be.length;rt++)Ji(Be[rt],qe);else if(Ge==="LineString")wn(Be,qe,Xe,!1);else if(Ge==="MultiLineString"){if(le.lineMetrics){for(rt=0;rt<Be.length;rt++)wn(Be[rt],qe=[],Xe,!1),Ae.push(kn(Ve,"LineString",qe,se.properties));return}ki(Be,qe,Xe,!1)}else if(Ge==="Polygon")ki(Be,qe,Xe,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(rt=0;rt<se.geometry.geometries.length;rt++)ci(Ae,{id:Ve,geometry:se.geometry.geometries[rt],properties:se.properties},le,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(rt=0;rt<Be.length;rt++){var Rt=[];ki(Be[rt],Rt,Xe,!0),qe.push(Rt)}}Ae.push(kn(Ve,Ge,qe,se.properties))}}function Ji(Ae,se){se.push(Bs(Ae[0])),se.push(Do(Ae[1])),se.push(0)}function wn(Ae,se,le,Te){for(var Be,Ge,Xe=0,qe=0;qe<Ae.length;qe++){var Ve=Bs(Ae[qe][0]),rt=Do(Ae[qe][1]);se.push(Ve),se.push(rt),se.push(0),qe>0&&(Xe+=Te?(Be*rt-Ve*Ge)/2:Math.sqrt(Math.pow(Ve-Be,2)+Math.pow(rt-Ge,2))),Be=Ve,Ge=rt}var Rt=se.length-3;se[2]=1,Ln(se,0,Rt,le),se[Rt+2]=1,se.size=Math.abs(Xe),se.start=0,se.end=se.size}function ki(Ae,se,le,Te){for(var Be=0;Be<Ae.length;Be++){var Ge=[];wn(Ae[Be],Ge,le,Te),se.push(Ge)}}function Bs(Ae){return Ae/360+.5}function Do(Ae){var se=Math.sin(Ae*Math.PI/180),le=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return le<0?0:le>1?1:le}function Tr(Ae,se,le,Te,Be,Ge,Xe,qe){if(Te/=se,Ge>=(le/=se)&&Xe<Te)return Ae;if(Xe<le||Ge>=Te)return null;for(var Ve=[],rt=0;rt<Ae.length;rt++){var Rt=Ae[rt],jt=Rt.geometry,Dt=Rt.type,En=Be===0?Rt.minX:Rt.minY,Un=Be===0?Rt.maxX:Rt.maxY;if(En>=le&&Un<Te)Ve.push(Rt);else if(!(Un<le||En>=Te)){var Fn=[];if(Dt==="Point"||Dt==="MultiPoint")xo(jt,Fn,le,Te,Be);else if(Dt==="LineString")bs(jt,Fn,le,Te,Be,!1,qe.lineMetrics);else if(Dt==="MultiLineString")xn(jt,Fn,le,Te,Be,!1);else if(Dt==="Polygon")xn(jt,Fn,le,Te,Be,!0);else if(Dt==="MultiPolygon")for(var zn=0;zn<jt.length;zn++){var $n=[];xn(jt[zn],$n,le,Te,Be,!0),$n.length&&Fn.push($n)}if(Fn.length){if(qe.lineMetrics&&Dt==="LineString"){for(zn=0;zn<Fn.length;zn++)Ve.push(kn(Rt.id,Dt,Fn[zn],Rt.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(Fn.length===1?(Dt="LineString",Fn=Fn[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=Fn.length===3?"Point":"MultiPoint"),Ve.push(kn(Rt.id,Dt,Fn,Rt.tags))}}}return Ve.length?Ve:null}function xo(Ae,se,le,Te,Be){for(var Ge=0;Ge<Ae.length;Ge+=3){var Xe=Ae[Ge+Be];Xe>=le&&Xe<=Te&&(se.push(Ae[Ge]),se.push(Ae[Ge+1]),se.push(Ae[Ge+2]))}}function bs(Ae,se,le,Te,Be,Ge,Xe){for(var qe,Ve,rt=an(Ae),Rt=Be===0?Hr:Bi,jt=Ae.start,Dt=0;Dt<Ae.length-3;Dt+=3){var En=Ae[Dt],Un=Ae[Dt+1],Fn=Ae[Dt+2],zn=Ae[Dt+3],$n=Ae[Dt+4],Yr=Be===0?En:Un,yi=Be===0?zn:$n,Wi=!1;Xe&&(qe=Math.sqrt(Math.pow(En-zn,2)+Math.pow(Un-$n,2))),Yr<le?yi>le&&(Ve=Rt(rt,En,Un,zn,$n,le),Xe&&(rt.start=jt+qe*Ve)):Yr>Te?yi<Te&&(Ve=Rt(rt,En,Un,zn,$n,Te),Xe&&(rt.start=jt+qe*Ve)):$r(rt,En,Un,Fn),yi<le&&Yr>=le&&(Ve=Rt(rt,En,Un,zn,$n,le),Wi=!0),yi>Te&&Yr<=Te&&(Ve=Rt(rt,En,Un,zn,$n,Te),Wi=!0),!Ge&&Wi&&(Xe&&(rt.end=jt+qe*Ve),se.push(rt),rt=an(Ae)),Xe&&(jt+=qe)}var zi=Ae.length-3;En=Ae[zi],Un=Ae[zi+1],Fn=Ae[zi+2],(Yr=Be===0?En:Un)>=le&&Yr<=Te&&$r(rt,En,Un,Fn),zi=rt.length-3,Ge&&zi>=3&&(rt[zi]!==rt[0]||rt[zi+1]!==rt[1])&&$r(rt,rt[0],rt[1],rt[2]),rt.length&&se.push(rt)}function an(Ae){var se=[];return se.size=Ae.size,se.start=Ae.start,se.end=Ae.end,se}function xn(Ae,se,le,Te,Be,Ge){for(var Xe=0;Xe<Ae.length;Xe++)bs(Ae[Xe],se,le,Te,Be,Ge,!1)}function $r(Ae,se,le,Te){Ae.push(se),Ae.push(le),Ae.push(Te)}function Hr(Ae,se,le,Te,Be,Ge){var Xe=(Ge-se)/(Te-se);return Ae.push(Ge),Ae.push(le+(Be-le)*Xe),Ae.push(1),Xe}function Bi(Ae,se,le,Te,Be,Ge){var Xe=(Ge-le)/(Be-le);return Ae.push(se+(Te-se)*Xe),Ae.push(Ge),Ae.push(1),Xe}function ui(Ae,se){for(var le=[],Te=0;Te<Ae.length;Te++){var Be,Ge=Ae[Te],Xe=Ge.type;if(Xe==="Point"||Xe==="MultiPoint"||Xe==="LineString")Be=Hi(Ge.geometry,se);else if(Xe==="MultiLineString"||Xe==="Polygon"){Be=[];for(var qe=0;qe<Ge.geometry.length;qe++)Be.push(Hi(Ge.geometry[qe],se))}else if(Xe==="MultiPolygon")for(Be=[],qe=0;qe<Ge.geometry.length;qe++){for(var Ve=[],rt=0;rt<Ge.geometry[qe].length;rt++)Ve.push(Hi(Ge.geometry[qe][rt],se));Be.push(Ve)}le.push(kn(Ge.id,Xe,Be,Ge.tags))}return le}function Hi(Ae,se){var le=[];le.size=Ae.size,Ae.start!==void 0&&(le.start=Ae.start,le.end=Ae.end);for(var Te=0;Te<Ae.length;Te+=3)le.push(Ae[Te]+se,Ae[Te+1],Ae[Te+2]);return le}function Oo(Ae,se){if(Ae.transformed)return Ae;var le,Te,Be,Ge=1<<Ae.z,Xe=Ae.x,qe=Ae.y;for(le=0;le<Ae.features.length;le++){var Ve=Ae.features[le],rt=Ve.geometry,Rt=Ve.type;if(Ve.geometry=[],Rt===1)for(Te=0;Te<rt.length;Te+=2)Ve.geometry.push(no(rt[Te],rt[Te+1],se,Ge,Xe,qe));else for(Te=0;Te<rt.length;Te++){var jt=[];for(Be=0;Be<rt[Te].length;Be+=2)jt.push(no(rt[Te][Be],rt[Te][Be+1],se,Ge,Xe,qe));Ve.geometry.push(jt)}}return Ae.transformed=!0,Ae}function no(Ae,se,le,Te,Be,Ge){return[Math.round(le*(Ae*Te-Be)),Math.round(le*(se*Te-Ge))]}function ko(Ae,se,le,Te,Be){for(var Ge=se===Be.maxZoom?0:Be.tolerance/((1<<se)*Be.extent),Xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:le,y:Te,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},qe=0;qe<Ae.length;qe++){Xe.numFeatures++,bo(Xe,Ae[qe],Ge,Be);var Ve=Ae[qe].minX,rt=Ae[qe].minY,Rt=Ae[qe].maxX,jt=Ae[qe].maxY;Ve<Xe.minX&&(Xe.minX=Ve),rt<Xe.minY&&(Xe.minY=rt),Rt>Xe.maxX&&(Xe.maxX=Rt),jt>Xe.maxY&&(Xe.maxY=jt)}return Xe}function bo(Ae,se,le,Te){var Be=se.geometry,Ge=se.type,Xe=[];if(Ge==="Point"||Ge==="MultiPoint")for(var qe=0;qe<Be.length;qe+=3)Xe.push(Be[qe]),Xe.push(Be[qe+1]),Ae.numPoints++,Ae.numSimplified++;else if(Ge==="LineString")Ko(Xe,Be,Ae,le,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(qe=0;qe<Be.length;qe++)Ko(Xe,Be[qe],Ae,le,Ge==="Polygon",qe===0);else if(Ge==="MultiPolygon")for(var Ve=0;Ve<Be.length;Ve++){var rt=Be[Ve];for(qe=0;qe<rt.length;qe++)Ko(Xe,rt[qe],Ae,le,!0,qe===0)}if(Xe.length){var Rt=se.tags||null;if(Ge==="LineString"&&Te.lineMetrics){for(var jt in Rt={},se.tags)Rt[jt]=se.tags[jt];Rt.mapbox_clip_start=Be.start/Be.size,Rt.mapbox_clip_end=Be.end/Be.size}var Dt={geometry:Xe,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:Rt};se.id!==null&&(Dt.id=se.id),Ae.features.push(Dt)}}function Ko(Ae,se,le,Te,Be,Ge){var Xe=Te*Te;if(Te>0&&se.size<(Be?Xe:Te))le.numPoints+=se.length/3;else{for(var qe=[],Ve=0;Ve<se.length;Ve+=3)(Te===0||se[Ve+2]>Xe)&&(le.numSimplified++,qe.push(se[Ve]),qe.push(se[Ve+1])),le.numPoints++;Be&&function(rt,Rt){for(var jt=0,Dt=0,En=rt.length,Un=En-2;Dt<En;Un=Dt,Dt+=2)jt+=(rt[Dt]-rt[Un])*(rt[Dt+1]+rt[Un+1]);if(jt>0===Rt)for(Dt=0,En=rt.length;Dt<En/2;Dt+=2){var Fn=rt[Dt],zn=rt[Dt+1];rt[Dt]=rt[En-2-Dt],rt[Dt+1]=rt[En-1-Dt],rt[En-2-Dt]=Fn,rt[En-1-Dt]=zn}}(qe,Ge),Ae.push(qe)}}function wo(Ae,se){var le=(se=this.options=function(Be,Ge){for(var Xe in Ge)Be[Xe]=Ge[Xe];return Be}(Object.create(this.options),se)).debug;if(le&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");var Te=function(Be,Ge){var Xe=[];if(Be.type==="FeatureCollection")for(var qe=0;qe<Be.features.length;qe++)ci(Xe,Be.features[qe],Ge,qe);else ci(Xe,Be.type==="Feature"?Be:{geometry:Be},Ge);return Xe}(Ae,se);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(Be,Ge){var Xe=Ge.buffer/Ge.extent,qe=Be,Ve=Tr(Be,1,-1-Xe,Xe,0,-1,2,Ge),rt=Tr(Be,1,1-Xe,2+Xe,0,-1,2,Ge);return(Ve||rt)&&(qe=Tr(Be,1,-Xe,1+Xe,0,-1,2,Ge)||[],Ve&&(qe=ui(Ve,1).concat(qe)),rt&&(qe=qe.concat(ui(rt,-1)))),qe}(Te,se),Te.length&&this.splitTile(Te,0,0,0),le&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Je(Ae,se,le){return 32*((1<<Ae)*le+se)+Ae}function Vt(Ae,se){const le=Ae.tileID.canonical;if(!this._geoJSONIndex)return se(null,null);const Te=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!Te)return se(null,null);const Be=new class{constructor(Xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=Xe.length,this._features=Xe}feature(Xe){return new class{constructor(qe){this._feature=qe,this.extent=i.EXTENT,this.type=qe.type,this.properties=qe.tags,"id"in qe&&!isNaN(qe.id)&&(this.id=parseInt(qe.id,10))}loadGeometry(){if(this._feature.type===1){const qe=[];for(const Ve of this._feature.geometry)qe.push([new i.Point(Ve[0],Ve[1])]);return qe}{const qe=[];for(const Ve of this._feature.geometry){const rt=[];for(const Rt of Ve)rt.push(new i.Point(Rt[0],Rt[1]));qe.push(rt)}return qe}}toGeoJSON(qe,Ve,rt){return N.call(this,qe,Ve,rt)}}(this._features[Xe])}}(Te.features);let Ge=hn(Be);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),se(null,{vectorTile:Be,rawData:Ge.buffer})}wo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},wo.prototype.splitTile=function(Ae,se,le,Te,Be,Ge,Xe){for(var qe=[Ae,se,le,Te],Ve=this.options,rt=Ve.debug;qe.length;){Te=qe.pop(),le=qe.pop(),se=qe.pop(),Ae=qe.pop();var Rt=1<<se,jt=Je(se,le,Te),Dt=this.tiles[jt];if(!Dt&&(rt>1&&console.time("creation"),Dt=this.tiles[jt]=ko(Ae,se,le,Te,Ve),this.tileCoords.push({z:se,x:le,y:Te}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,le,Te,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var En="z"+se;this.stats[En]=(this.stats[En]||0)+1,this.total++}if(Dt.source=Ae,Be){if(se===Ve.maxZoom||se===Be)continue;var Un=1<<Be-se;if(le!==Math.floor(Ge/Un)||Te!==Math.floor(Xe/Un))continue}else if(se===Ve.indexMaxZoom||Dt.numPoints<=Ve.indexMaxPoints)continue;if(Dt.source=null,Ae.length!==0){rt>1&&console.time("clipping");var Fn,zn,$n,Yr,yi,Wi,zi=.5*Ve.buffer/Ve.extent,Hs=.5-zi,br=.5+zi,Eo=1+zi;Fn=zn=$n=Yr=null,yi=Tr(Ae,Rt,le-zi,le+br,0,Dt.minX,Dt.maxX,Ve),Wi=Tr(Ae,Rt,le+Hs,le+Eo,0,Dt.minX,Dt.maxX,Ve),Ae=null,yi&&(Fn=Tr(yi,Rt,Te-zi,Te+br,1,Dt.minY,Dt.maxY,Ve),zn=Tr(yi,Rt,Te+Hs,Te+Eo,1,Dt.minY,Dt.maxY,Ve),yi=null),Wi&&($n=Tr(Wi,Rt,Te-zi,Te+br,1,Dt.minY,Dt.maxY,Ve),Yr=Tr(Wi,Rt,Te+Hs,Te+Eo,1,Dt.minY,Dt.maxY,Ve),Wi=null),rt>1&&console.timeEnd("clipping"),qe.push(Fn||[],se+1,2*le,2*Te),qe.push(zn||[],se+1,2*le,2*Te+1),qe.push($n||[],se+1,2*le+1,2*Te),qe.push(Yr||[],se+1,2*le+1,2*Te+1)}}},wo.prototype.getTile=function(Ae,se,le){var Te=this.options,Be=Te.extent,Ge=Te.debug;if(Ae<0||Ae>24)return null;var Xe=1<<Ae,qe=Je(Ae,se=(se%Xe+Xe)%Xe,le);if(this.tiles[qe])return Oo(this.tiles[qe],Be);Ge>1&&console.log("drilling down to z%d-%d-%d",Ae,se,le);for(var Ve,rt=Ae,Rt=se,jt=le;!Ve&&rt>0;)rt--,Rt=Math.floor(Rt/2),jt=Math.floor(jt/2),Ve=this.tiles[Je(rt,Rt,jt)];return Ve&&Ve.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",rt,Rt,jt),Ge>1&&console.time("drilling down"),this.splitTile(Ve.source,rt,Rt,jt,Ae,se,le),Ge>1&&console.timeEnd("drilling down"),this.tiles[qe]?Oo(this.tiles[qe],Be):null):null};class In extends i.VectorTileWorkerSource{constructor(se,le,Te,Be,Ge){super(se,le,Te,Be,Vt),Ge&&(this.loadGeoJSON=Ge)}loadData(se,le){const Te=se&&se.request,Be=Te&&Te.collectResourceTiming;this.loadGeoJSON(se,(Ge,Xe)=>{if(Ge||!Xe)return le(Ge);if(typeof Xe!="object")return le(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{U(Xe,!0);try{if(se.filter){const Ve=i.createExpression(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(Rt=>`${Rt.key}: ${Rt.message}`).join(", "));Xe={type:"FeatureCollection",features:Xe.features.filter(Rt=>Ve.value.evaluate({zoom:0},Rt))}}this._geoJSONIndex=se.cluster?new On(function({superclusterOptions:Ve,clusterProperties:rt}){if(!rt||!Ve)return Ve;const Rt={},jt={},Dt={accumulated:null,zoom:0},En={properties:null},Un=Object.keys(rt);for(const Fn of Un){const[zn,$n]=rt[Fn],Yr=i.createExpression($n),yi=i.createExpression(typeof zn=="string"?[zn,["accumulated"],["get",Fn]]:zn);Rt[Fn]=Yr.value,jt[Fn]=yi.value}return Ve.map=Fn=>{En.properties=Fn;const zn={};for(const $n of Un)zn[$n]=Rt[$n].evaluate(Dt,En);return zn},Ve.reduce=(Fn,zn)=>{En.properties=zn;for(const $n of Un)Dt.accumulated=Fn[$n],Fn[$n]=jt[$n].evaluate(Dt,En)},Ve}(se)).load(Xe.features):function(Ve,rt){return new wo(Ve,rt)}(Xe,se.geojsonVtOptions)}catch(Ve){return le(Ve)}this.loaded={};const qe={};if(Be){const Ve=i.getPerformanceMeasurement(Te);Ve&&(qe.resourceTiming={},qe.resourceTiming[se.source]=JSON.parse(JSON.stringify(Ve)))}le(null,qe)}})}reloadTile(se,le){const Te=this.loaded;return Te&&Te[se.uid]?super.reloadTile(se,le):this.loadTile(se,le)}loadGeoJSON(se,le){if(se.request)i.getJSON(se.request,le);else{if(typeof se.data!="string")return le(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));try{return le(null,JSON.parse(se.data))}catch{return le(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(se,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(Te){le(Te)}}getClusterChildren(se,le){try{le(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(Te){le(Te)}}getClusterLeaves(se,le){try{le(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(Te){le(Te)}}}class ir{constructor(se){this.self=se,this.actor=new i.Actor(se,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.getProjection({name:"mercator"}),this.workerSourceTypes={vector:i.VectorTileWorkerSource,geojson:In},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,Te)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=Te},this.self.registerRTLTextPlugin=le=>{if(i.plugin.isParsed())throw new Error("RTL text plugin already registered.");i.plugin.applyArabicShaping=le.applyArabicShaping,i.plugin.processBidirectionalText=le.processBidirectionalText,i.plugin.processStyledBidirectionalText=le.processStyledBidirectionalText}}clearCaches(se,le,Te){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se],Te()}checkIfReady(se,le,Te){Te()}setReferrer(se,le){this.referrer=le}spriteLoaded(se,le){this.isSpriteLoaded[se]=le;for(const Te in this.workerSources[se]){const Be=this.workerSources[se][Te];for(const Ge in Be)Be[Ge]instanceof i.VectorTileWorkerSource&&(Be[Ge].isSpriteLoaded=le,Be[Ge].fire(new i.Event("isSpriteLoaded")))}}setImages(se,le,Te){this.availableImages[se]=le;for(const Be in this.workerSources[se]){const Ge=this.workerSources[se][Be];for(const Xe in Ge)Ge[Xe].availableImages=le}Te()}enableTerrain(se,le,Te){this.terrain=le,Te()}setProjection(se,le){this.projections[se]=i.getProjection(le)}setLayers(se,le,Te){this.getLayerIndex(se).replace(le),Te()}updateLayers(se,le,Te){this.getLayerIndex(se).update(le.layers,le.removedIds),Te()}loadTile(se,le,Te){const Be=this.enableTerrain?i.extend({enableTerrain:this.terrain},le):le;Be.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,le.type,le.source).loadTile(Be,Te)}loadDEMTile(se,le,Te){const Be=this.enableTerrain?i.extend({buildQuadTree:this.terrain},le):le;this.getDEMWorkerSource(se,le.source).loadTile(Be,Te)}reloadTile(se,le,Te){const Be=this.enableTerrain?i.extend({enableTerrain:this.terrain},le):le;Be.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,le.type,le.source).reloadTile(Be,Te)}abortTile(se,le,Te){this.getWorkerSource(se,le.type,le.source).abortTile(le,Te)}removeTile(se,le,Te){this.getWorkerSource(se,le.type,le.source).removeTile(le,Te)}removeSource(se,le,Te){if(!this.workerSources[se]||!this.workerSources[se][le.type]||!this.workerSources[se][le.type][le.source])return;const Be=this.workerSources[se][le.type][le.source];delete this.workerSources[se][le.type][le.source],Be.removeSource!==void 0?Be.removeSource(le,Te):Te()}loadWorkerSource(se,le,Te){try{this.self.importScripts(le.url),Te()}catch(Be){Te(Be.toString())}}syncRTLPluginState(se,le,Te){try{i.plugin.setState(le);const Be=i.plugin.getPluginURL();if(i.plugin.isLoaded()&&!i.plugin.isParsed()&&Be!=null){this.self.importScripts(Be);const Ge=i.plugin.isParsed();Te(Ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Be}`),Ge)}}catch(Be){Te(Be.toString())}}getAvailableImages(se){let le=this.availableImages[se];return le||(le=[]),le}getLayerIndex(se){let le=this.layerIndexes[se];return le||(le=this.layerIndexes[se]=new A),le}getWorkerSource(se,le,Te){if(this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][le]||(this.workerSources[se][le]={}),!this.workerSources[se][le][Te]){const Be={send:(Ge,Xe,qe,Ve,rt,Rt)=>{this.actor.send(Ge,Xe,qe,se,rt,Rt)},scheduler:this.actor.scheduler};this.workerSources[se][le][Te]=new this.workerSourceTypes[le](Be,this.getLayerIndex(se),this.getAvailableImages(se),this.isSpriteLoaded[se])}return this.workerSources[se][le][Te]}getDEMWorkerSource(se,le){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][le]||(this.demWorkerSources[se][le]=new I),this.demWorkerSources[se][le]}enforceCacheSizeLimit(se,le){i.enforceCacheSizeLimit(le)}getWorkerPerformanceMetrics(se,le,Te){Te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ir(self)),ir}),p(["./shared"],function(i){function E(m,a){if(Array.isArray(m)){if(!Array.isArray(a)||m.length!==a.length)return!1;for(let h=0;h<m.length;h++)if(!E(m[h],a[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&a!==null){if(typeof a!="object"||Object.keys(m).length!==Object.keys(a).length)return!1;for(const h in m)if(!E(m[h],a[h]))return!1;return!0}return m===a}var T=A;function A(m){return!function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,w,S=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(S);try{w=new Worker(R),y=!0}catch{y=!1}return w&&w.terminate(),URL.revokeObjectURL(R),y}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var y=document.createElement("canvas");y.width=y.height=1;var w=y.getContext("2d");if(!w)return!1;var S=w.getImageData(0,0,1,1);return S&&S.width===y.width}()?(I[h=a&&a.failIfMajorPerformanceCaveat]===void 0&&(I[h]=function(y){var w,S=function(R){var D=document.createElement("canvas"),G=Object.create(A.webGLContextAttributes);return G.failIfMajorPerformanceCaveat=R,D.getContext("webgl",G)||D.getContext("experimental-webgl",G)}(y);if(!S)return!1;try{w=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!w||S.isContextLost())&&(S.shaderSource(w,"void main() {}"),S.compileShader(w),S.getShaderParameter(w,S.COMPILE_STATUS)===!0)}(h)),I[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var I={};function O(m,a,h){const y=i.window.document.createElement(m);return a!==void 0&&(y.className=a),h&&h.appendChild(y),y}function z(m,a,h){const y=i.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const w of Object.keys(a))y.setAttributeNS(null,w,a[w]);return h&&h.appendChild(y),y}A.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const U=i.window.document&&i.window.document.documentElement.style,N=U&&U.userSelect!==void 0?"userSelect":"WebkitUserSelect";let V;function X(){U&&N&&(V=U[N],U[N]="none")}function J(){U&&N&&(U[N]=V)}function te(m){m.preventDefault(),m.stopPropagation(),i.window.removeEventListener("click",te,!0)}function ue(){i.window.addEventListener("click",te,!0),i.window.setTimeout(()=>{i.window.removeEventListener("click",te,!0)},0)}function ae(m,a){const h=m.getBoundingClientRect();return je(m,h,a)}function be(m,a){const h=m.getBoundingClientRect(),y=[];for(let w=0;w<a.length;w++)y.push(je(m,h,a[w]));return y}function Ce(m){return i.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&i.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function je(m,a,h){const y=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new i.Point((h.clientX-a.left)*y,(h.clientY-a.top)*y)}function me(m,a){var h=a[0],y=a[1],w=a[2],S=a[3],R=h*S-w*y;return R?(m[0]=S*(R=1/R),m[1]=-y*R,m[2]=-w*R,m[3]=h*R,m):null}function Ne(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class ht extends i.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:h,callback:y}of this.requestors)this._notify(h,y);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,h){this._validate(a,h)&&(this.images[a]=h)}_validate(a,h){let y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new i.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new i.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new i.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),y=!1),y}_validateStretch(a,h){if(!a)return!0;let y=0;for(const w of a){if(w[0]<y||w[1]<w[0]||h<w[1])return!1;y=w[1]}return!0}_validateContent(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0}removeImage(a){const h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,h){let y=!0;if(!this.isLoaded())for(const w of a)this.images[w]||(y=!1);this.isLoaded()||y?this._notify(a,h):this.requestors.push({ids:a,callback:h})}_notify(a,h){const y={};for(const w of a){this.images[w]||this.fire(new i.Event("styleimagemissing",{id:w}));const S=this.images[w];S?y[w]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:i.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,y)}getPixelSize(){const{width:a,height:h}=this.atlasImage;return{width:a,height:h}}getPattern(a){const h=this.patterns[a],y=this.getImage(a);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{const w={w:y.data.width+2,h:y.data.height+2,x:0,y:0},S=new i.ImagePosition(w,y);this.patterns[a]={bin:w,position:S}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new i.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const S in this.patterns)a.push(this.patterns[S].bin);const{w:h,h:y}=i.potpack(a),w=this.atlasImage;w.resize({width:h||1,height:y||1});for(const S in this.patterns){const{bin:R}=this.patterns[S],D=R.x+1,G=R.y+1,q=this.images[S].data,Z=q.width,ne=q.height;i.RGBAImage.copy(q,w,{x:0,y:0},{x:D,y:G},{width:Z,height:ne}),i.RGBAImage.copy(q,w,{x:0,y:ne-1},{x:D,y:G-1},{width:Z,height:1}),i.RGBAImage.copy(q,w,{x:0,y:0},{x:D,y:G+ne},{width:Z,height:1}),i.RGBAImage.copy(q,w,{x:Z-1,y:0},{x:D-1,y:G},{width:1,height:ne}),i.RGBAImage.copy(q,w,{x:0,y:0},{x:D+Z,y:G},{width:1,height:ne})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const h of a){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const y=this.images[h];Ne(y)&&this.updateImage(h,y)}}}const _t=new i.Properties({anchor:new i.DataConstantProperty(i.spec.light.anchor),position:new class{constructor(){this.specification=i.spec.light.position}possiblyEvaluate(m,a){return function([h,y,w]){const S=i.degToRad(y+90),R=i.degToRad(w);return{x:h*Math.cos(S)*Math.sin(R),y:h*Math.sin(S)*Math.sin(R),z:h*Math.cos(R),azimuthal:y,polar:w}}(m.expression.evaluate(a))}interpolate(m,a,h){return{x:i.number(m.x,a.x,h),y:i.number(m.y,a.y,h),z:i.number(m.z,a.z,h),azimuthal:i.number(m.azimuthal,a.azimuthal,h),polar:i.number(m.polar,a.polar,h)}}},color:new i.DataConstantProperty(i.spec.light.color),intensity:new i.DataConstantProperty(i.spec.light.intensity)});class Bt extends i.Evented{constructor(a){super(),this._transitionable=new i.Transitionable(_t),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h={}){if(!this._validate(i.validateLight,a,h))for(const y in a){const w=a[y];i.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),w):this._transitionable.setValue(y,w)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,y){return(!y||y.validate!==!1)&&i.emitValidationErrors(this,a.call(i.validateStyle,i.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}const Kt=new i.Properties({source:new i.DataConstantProperty(i.spec.terrain.source),exaggeration:new i.DataConstantProperty(i.spec.terrain.exaggeration)});let Gt=class extends i.Evented{constructor(m,a){super(),this._transitionable=new i.Transitionable(Kt),this.set(m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(m){for(const a in m){const h=m[a];i.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),h):this._transitionable.setValue(a,h)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}};function hn(m,a,h,y){const w=i.smoothstep(45,65,h),[S,R]=wt(m,y),D=i.length(a);let G=1-Math.min(1,Math.exp((D-S)/(R-S)*-6));return G*=G*G,G=Math.min(1,1.00747*G),G*w*m.alpha}function wt(m,a){const h=.5/Math.tan(.5*a);return[m.range[0]+h,m.range[1]+h]}const bt=new i.Properties({range:new i.DataConstantProperty(i.spec.fog.range),color:new i.DataConstantProperty(i.spec.fog.color),"high-color":new i.DataConstantProperty(i.spec.fog["high-color"]),"space-color":new i.DataConstantProperty(i.spec.fog["space-color"]),"horizon-blend":new i.DataConstantProperty(i.spec.fog["horizon-blend"]),"star-intensity":new i.DataConstantProperty(i.spec.fog["star-intensity"])});class $t extends i.Evented{constructor(a,h){super(),this._transitionable=new i.Transitionable(bt),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const a=this._transform,h=a.projection.name==="globe",y=i.globeToMercatorTransition(a.zoom),w=this.properties.get("range"),S=[.5,3];return{range:h?[i.number(S[0],w[0],y),i.number(S[1],w[1],y)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h={}){if(!this._validate(i.validateFog,a,h)){for(const y of Object.keys(i.spec.fog))a&&a[y]===void 0&&(a[y]=i.spec.fog[y].default);for(const y in a){const w=a[y];i.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),w):this._transitionable.setValue(y,w)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.smoothstep(45,65,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(y,w,S){const R=i.MercatorCoordinate.fromLngLat(w),D=S.elevation?S.elevation.getAtPointOrZero(R):0,G=[R.x,R.y,D];return i.transformMat4(G,G,S.mercatorFogMatrix),hn(y,G,S.pitch,S._fov)}(this.state,a,h):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?wt(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,y){return(!y||y.validate!==!1)&&i.emitValidationErrors(this,a.call(i.validateStyle,i.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}class Zt{constructor(a,h){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=i.uniqueId();const y=this.workerPool.acquire(this.id);for(let w=0;w<y.length;w++){const S=new Zt.Actor(y[w],h,this.id);S.name=`Worker ${w}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,h,y){i.asyncAll(this.actors,(w,S)=>{w.send(a,h,S)},y=y||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function mn(m,a,h){return a*(i.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}Zt.Actor=i.Actor;class yn{constructor(a,h,y,w){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(a,h){let y,w;if(a instanceof i.Point||typeof a[0]=="number"){const S=i.Point.convert(a);y=[S],w=h.isPointAboveHorizon(S)}else{const S=i.Point.convert(a[0]),R=i.Point.convert(a[1]);y=[S,R],w=i.polygonizeBounds(S,R).every(D=>h.isPointAboveHorizon(D))}return new yn(y,h.getCameraPoint(),w,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return i.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const h=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new i.Point(1,1)):this.screenBounds[1],w=i.polygonizeBounds(h,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<y.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),i.bufferConvexPolygon(w,a)}bufferedCameraGeometryGlobe(a){const h=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new i.Point(1,1)):this.screenBounds[1],w=i.polygonizeBounds(h,y,a),S=this.cameraPoint.clone();switch(3*((S.y>h.y)+(S.y>y.y))+((S.x>h.x)+(S.x>y.x))){case 0:w[0]=S,w[4]=S.clone();break;case 1:w.splice(1,0,S);break;case 2:w[1]=S;break;case 3:w.splice(4,0,S);break;case 5:w.splice(2,0,S);break;case 6:w[3]=S;break;case 7:w.splice(3,0,S);break;case 8:w[2]=S}return w}containsTile(a,h,y,w=0){const S=a.queryPadding/h._pixelsPerMercatorPixel+1,R=y?this._bufferedCameraMercator(S,h):this._bufferedScreenMercator(S,h);let D=a.tileID.wrap+(R.unwrapped?w:0);const G=R.polygon.map(ye=>i.getTilePoint(a.tileTransform,ye,D));if(!i.polygonIntersectsBox(G,0,0,i.EXTENT,i.EXTENT))return;D=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const q=this.screenGeometryMercator.polygon.map(ye=>i.getTileVec3(a.tileTransform,ye,D)),Z=q.map(ye=>new i.Point(ye[0],ye[1])),ne=h.getFreeCameraOptions().position||new i.MercatorCoordinate(0,0,0),he=i.getTileVec3(a.tileTransform,ne,D),fe=q.map(ye=>{const ie=i.sub(ye,ye,he);return i.normalize(ie,ie),new i.Ray(he,ie)}),_e=mn(a,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Z,tilespaceRays:fe,bufferedTilespaceGeometry:G,bufferedTilespaceBounds:(ge=i.getBounds(G),ge.min.x=i.clamp(ge.min.x,0,i.EXTENT),ge.min.y=i.clamp(ge.min.y,0,i.EXTENT),ge.max.x=i.clamp(ge.max.x,0,i.EXTENT),ge.max.y=i.clamp(ge.max.y,0,i.EXTENT),ge),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:_e};var ge}_bufferedScreenMercator(a,h){const y=Yn(a);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let w;return w=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[y]=w,w}}_bufferedCameraMercator(a,h){const y=Yn(a);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let w;return w=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[y]=w,w}}_projectAndResample(a,h){const y=function(S,R){const D=i.multiply([],R.pixelMatrix,R.globeMatrix),G=[0,-i.GLOBE_RADIUS,0,1],q=[0,i.GLOBE_RADIUS,0,1],Z=[0,0,0,1];i.transformMat4$1(G,G,D),i.transformMat4$1(q,q,D),i.transformMat4$1(Z,Z,D);const ne=new i.Point(G[0]/G[3],G[1]/G[3]),he=new i.Point(q[0]/q[3],q[1]/q[3]),fe=i.polygonContainsPoint(S,ne)&&G[3]<Z[3],_e=i.polygonContainsPoint(S,he)&&q[3]<Z[3];if(!fe&&!_e)return null;const ge=function(Fe,He,$e){for(let it=1;it<Fe.length;it++){const Pt=rr(He.pointCoordinate3D(Fe[it-1]).x),Qe=rr(He.pointCoordinate3D(Fe[it]).x);if($e<0){if(Pt<Qe)return{idx:it,t:-Pt/(Qe-1-Pt)}}else if(Qe<Pt)return{idx:it,t:(1-Pt)/(Qe+1-Pt)}}return null}(S,R,fe?-1:1);if(!ge)return null;const{idx:ye,t:ie}=ge;let pe=ye>1?On(S.slice(0,ye),R):[],we=ye<S.length?On(S.slice(ye),R):[];pe=pe.map(Fe=>new i.Point(rr(Fe.x),Fe.y)),we=we.map(Fe=>new i.Point(rr(Fe.x),Fe.y));const Ee=[...pe];Ee.length===0&&Ee.push(we[we.length-1]);const ke=i.number(Ee[Ee.length-1].y,(we.length===0?pe[0]:we[0]).y,ie);let Ue;return Ue=fe?[new i.Point(0,ke),new i.Point(0,0),new i.Point(1,0),new i.Point(1,ke)]:[new i.Point(1,ke),new i.Point(1,1),new i.Point(0,1),new i.Point(0,ke)],Ee.push(...Ue),we.length===0?Ee.push(pe[0]):Ee.push(...we),{polygon:Ee.map(Fe=>new i.MercatorCoordinate(Fe.x,Fe.y)),unwrapped:!1}}(a,h);if(y)return y;const w=function(S,R){let D=!1,G=-1/0,q=0;for(let ne=0;ne<S.length-1;ne++)S[ne].x>G&&(G=S[ne].x,q=ne);for(let ne=0;ne<S.length-1;ne++){const he=(q+ne)%(S.length-1),fe=S[he],_e=S[he+1];Math.abs(fe.x-_e.x)>.5&&(fe.x<_e.x?(fe.x+=1,he===0&&(S[S.length-1].x+=1)):(_e.x+=1,he+1===S.length-1&&(S[0].x+=1)),D=!0)}const Z=i.mercatorXfromLng(R.center.lng);return D&&Z<Math.abs(Z-1)&&S.forEach(ne=>{ne.x-=1}),{polygon:S,unwrapped:D}}(On(a,h).map(S=>new i.Point(rr(S.x),S.y)),h);return{polygon:w.polygon.map(S=>new i.MercatorCoordinate(S.x,S.y)),unwrapped:w.unwrapped}}}function On(m,a){return i.resample(m,h=>{const y=a.pointCoordinate3D(h);h.x=y.x,h.y=y.y},1/256)}function rr(m){return m<0?1+m%1:m%1}function Yn(m){return 100*m|0}function Vr(m,a,h,y,w){const S=function(R,D){if(R)return w(R);if(D){m.url&&D.tiles&&m.tiles&&delete m.tiles;const G=i.pick(i.extend(D,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(G.vectorLayers=D.vector_layers,G.vectorLayerIds=G.vectorLayers.map(q=>q.id)),G.tiles=a.canonicalizeTileset(G,m.url),w(null,G)}};return m.url?i.getJSON(a.transformRequest(a.normalizeSourceURL(m.url,null,h,y),i.ResourceType.Source),S):i.exported.frame(()=>S(null,m))}class Jr{constructor(a,h,y){this.bounds=i.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const h=Math.pow(2,a.z),y=Math.floor(i.mercatorXfromLng(this.bounds.getWest())*h),w=Math.floor(i.mercatorYfromLat(this.bounds.getNorth())*h),S=Math.ceil(i.mercatorXfromLng(this.bounds.getEast())*h),R=Math.ceil(i.mercatorYfromLat(this.bounds.getSouth())*h);return a.x>=y&&a.x<S&&a.y>=w&&a.y<R}}class kr{constructor(a,h,y){this.context=a;const w=a.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ln={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class li{constructor(a,h,y,w){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.context=a;const S=a.gl;this.buffer=S.createBuffer(),a.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let y=0;y<this.attributes.length;y++){const w=h.attributes[this.attributes[y].name];w!==void 0&&a.enableVertexAttribArray(w)}}setVertexAttribPointers(a,h,y){for(let w=0;w<this.attributes.length;w++){const S=this.attributes[w],R=h.attributes[S.name];R!==void 0&&a.vertexAttribPointer(R,S.components,a[Ln[S.type]],!1,this.itemSize,S.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class kn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Br extends kn{getDefault(){return i.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ci extends kn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Ji extends kn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class wn extends kn{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ki extends kn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Bs extends kn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Do extends kn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Tr extends kn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class xo extends kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class bs extends kn{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class an extends kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class xn extends kn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class $r extends kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class Hr extends kn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Bi extends kn{getDefault(){return i.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ui extends kn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Hi extends kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class Oo extends kn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class no extends kn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let ko,bo=class extends kn{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Ko extends kn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class wo extends kn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Je extends kn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Vt extends kn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class In extends kn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ir extends kn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Ae extends kn{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class se extends kn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class le extends kn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Te extends kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Be extends kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Ge extends kn{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class Xe extends Ge{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class qe extends Ge{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ve extends qe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class rt{constructor(a,h,y,w){this.context=a,this.width=h,this.height=y;const S=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Xe(a,S),w&&(this.depthAttachment=new qe(a,S))}destroy(){const a=this.context.gl,h=this.colorAttachment.get();if(h&&a.deleteTexture(h),this.depthAttachment){const y=this.depthAttachment.get();y&&a.deleteRenderbuffer(y)}a.deleteFramebuffer(this.framebuffer)}}class Rt{constructor(a,h=!1){if(this.gl=a,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const y=a;this.extVertexArrayObject={createVertexArrayOES:y.createVertexArray.bind(a),deleteVertexArrayOES:y.deleteVertexArray.bind(a),bindVertexArrayOES:y.bindVertexArray.bind(a)}}this.clearColor=new Br(this),this.clearDepth=new ci(this),this.clearStencil=new Ji(this),this.colorMask=new wn(this),this.depthMask=new ki(this),this.stencilMask=new Bs(this),this.stencilFunc=new Do(this),this.stencilOp=new Tr(this),this.stencilTest=new xo(this),this.depthRange=new bs(this),this.depthTest=new an(this),this.depthFunc=new xn(this),this.blend=new $r(this),this.blendFunc=new Hr(this),this.blendColor=new Bi(this),this.blendEquation=new ui(this),this.cullFace=new Hi(this),this.cullFaceSide=new Oo(this),this.frontFace=new no(this),this.program=new bo(this),this.activeTexture=new Ko(this),this.viewport=new wo(this),this.bindFramebuffer=new Je(this),this.bindRenderbuffer=new Vt(this),this.bindTexture=new In(this),this.bindVertexBuffer=new ir(this),this.bindElementBuffer=new Ae(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new se(this),this.pixelStoreUnpack=new le(this),this.pixelStoreUnpackPremultiplyAlpha=new Te(this),this.pixelStoreUnpackFlipY=new Be(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h){return new kr(this,a,h)}createVertexBuffer(a,h,y){return new li(this,a,h,y)}createRenderbuffer(a,h,y){const w=this.gl,S=w.createRenderbuffer();return this.bindRenderbuffer.set(S),w.renderbufferStorage(w.RENDERBUFFER,a,h,y),this.bindRenderbuffer.set(null),S}createFramebuffer(a,h,y){return new rt(this,a,h,y)}clear({color:a,depth:h,stencil:y}){const w=this.gl;let S=0;a&&(S|=w.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(S|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y!==void 0&&(S|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),w.clear(S)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){E(a.blendFunction,i.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class jt extends i.Evented{constructor(a,h,y,w){if(super(),this.id=a,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.extend(this,i.pick(h,["url","scheme","tileSize","promoteId"])),this._options=i.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new i.DedupedRequest}load(a){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=Vr(this._options,this.map._requestManager,h,y,(w,S)=>{this._tileJSONRequest=null,this._loaded=!0,w?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new i.ErrorEvent(w))):S&&(i.extend(this,S),S.bounds&&(this.tileBounds=new Jr(S.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(S.tiles,this.map._requestManager._customAccessToken),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(w)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}loadTile(a,h){const y=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(y,i.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(w.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",w,S.bind(this));else if(a.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",w,S.bind(this),void 0,!0);else{const R=i.loadVectorTile.call({deduped:this._deduped},w,(D,G)=>{D||!G?S.call(this,D):(w.data={cacheControl:G.cacheControl,expires:G.expires,rawData:G.rawData.slice(0)},a.actor&&a.actor.send("loadTile",w,S.bind(this),void 0,!0))},!0);a.request={cancel:R}}function S(R,D){return delete a.request,a.aborted?h(null):R&&R.status!==404?h(R):(D&&D.resourceTiming&&(a.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&a.setExpiryData(D),a.loadVectorData(D,this.map.painter),i.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Dt extends i.Evented{constructor(a,h,y,w){super(),this.id=a,this.dispatcher=y,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.extend({type:"raster"},h),i.extend(this,i.pick(h,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vr(this._options,this.map._requestManager,null,null,(h,y)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new i.ErrorEvent(h)):y&&(i.extend(this,y),y.bounds&&(this.tileBounds=new Jr(y.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(y.tiles),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(h)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){const y=i.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);a.request=i.getImage(this.map._requestManager.transformRequest(w,i.ResourceType.Tile),(S,R,D,G)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):S?(a.state="errored",h(S)):R?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:D,expires:G}),a.setTexture(R,this.map.painter),a.state="loaded",i.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(a,h,y){a.setTexture(h,y)}static unloadTileData(a,h){a.texture&&h.saveTileTexture(a.texture)}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h()}unloadTile(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function En(m,a,h,y,w,S,R,D){const G=[m,h,w,a,y,S,1,1,1],q=[R,D,1],Z=i.adjoint([],G),[ne,he,fe]=i.transformMat3(q,q,i.transpose(Z,Z));return i.multiply$1(G,[ne,0,0,0,he,0,0,0,fe],G)}class Un extends i.Evented{constructor(a,h,y,w){super(),this.id=a,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=h,this._dirty=!1}load(a,h){this._loaded=h||!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=i.getImage(this.map._requestManager.transformRequest(this.url,i.ResourceType.Image),(y,w)=>{if(this._imageRequest=null,this._loaded=!0,y)this.fire(new i.ErrorEvent(y));else if(w){const{HTMLImageElement:S}=i.window;this.image=w instanceof S?i.exported.getImageData(w):w,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const h=a.map(i.MercatorCoordinate.fromLngLat);return this.tileID=function(y){let w=1/0,S=1/0,R=-1/0,D=-1/0;for(const ne of y)w=Math.min(w,ne.x),S=Math.min(S,ne.y),R=Math.max(R,ne.x),D=Math.max(D,ne.y);const G=Math.max(R-w,D-S),q=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),Z=Math.pow(2,q);return new i.CanonicalTileID(q,Math.floor((w+R)/2*Z),Math.floor((S+D)/2*Z))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const G in this.tiles){const q=this.tiles[G];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray)return;const h=i.tileTransform(this.tileID,this.map.transform.projection),[y,w,S,R]=this.coordinates.map(G=>{const q=h.projection.project(G[0],G[1]);return i.getTilePoint(h,q)._round()});this.perspectiveTransform=function(G,q,Z,ne,he,fe,_e,ge,ye,ie){const pe=En(0,0,G,0,0,q,G,q),we=En(Z,ne,he,fe,_e,ge,ye,ie);return i.multiply$1(we,i.adjoint(pe,pe),we),[we[6]/we[8]*G/i.EXTENT,we[7]/we[8]*q/i.EXTENT]}(this.width,this.height,y.x,y.y,w.x,w.y,R.x,R.y,S.x,S.y);const D=this._boundsArray=new i.StructArrayLayout4i8;D.emplaceBack(y.x,y.y,0,0),D.emplaceBack(w.x,w.y,i.EXTENT,0),D.emplaceBack(R.x,R.y,0,i.EXTENT),D.emplaceBack(S.x,S.y,i.EXTENT,i.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(D,i.boundsAttributes.members),this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,h=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new i.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Fn={vector:jt,raster:Dt,"raster-dem":class extends Dt{constructor(m,a,h,y){super(m,a,h,y),this.type="raster-dem",this.maxzoom=22,this._options=i.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(w,S){w&&(m.state="errored",a(w)),S&&(m.dem=S,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=i.getImage(this.map._requestManager.transformRequest(h,i.ResourceType.Tile),(function(w,S,R,D){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(w)m.state="errored",a(w);else if(S){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:R,expires:D});const G=i.window.ImageBitmap&&S instanceof i.window.ImageBitmap&&(ko==null&&(ko=i.window.OffscreenCanvas&&new i.window.OffscreenCanvas(1,1).getContext("2d")&&typeof i.window.createImageBitmap=="function"),ko),q=1-(S.width-i.prevPowerOfTwo(S.width))/2;q<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const Z=G?S:i.exported.getImageData(S,q),ne={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:Z,encoding:this.encoding,padding:q};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",ne,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const a=m.canonical,h=Math.pow(2,a.z),y=(a.x-1+h)%h,w=a.x===0?m.wrap-1:m.wrap,S=(a.x+1+h)%h,R=a.x+1===h?m.wrap+1:m.wrap,D={};return D[new i.OverscaledTileID(m.overscaledZ,w,a.z,y,a.y).key]={backfilled:!1},D[new i.OverscaledTileID(m.overscaledZ,R,a.z,S,a.y).key]={backfilled:!1},a.y>0&&(D[new i.OverscaledTileID(m.overscaledZ,w,a.z,y,a.y-1).key]={backfilled:!1},D[new i.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},D[new i.OverscaledTileID(m.overscaledZ,R,a.z,S,a.y-1).key]={backfilled:!1}),a.y+1<h&&(D[new i.OverscaledTileID(m.overscaledZ,w,a.z,y,a.y+1).key]={backfilled:!1},D[new i.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},D[new i.OverscaledTileID(m.overscaledZ,R,a.z,S,a.y+1).key]={backfilled:!1}),D}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends i.Evented{constructor(m,a,h,y){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(y),this._data=a.data,this._options=i.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const w=i.EXTENT/this.tileSize;this.workerOptions=i.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*w,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*w,extent:i.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:i.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*w,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},a),this}getClusterLeaves(m,a,h,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:a,offset:h},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=i.extend({},this.workerOptions),a=this._data;typeof a=="string"?(m.request=this.map._requestManager.transformRequest(i.exported.resolveURL(a),i.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(h,y)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new i.ErrorEvent(h));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(w.resourceTiming=y.resourceTiming[this.id]),this.fire(new i.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,a){const h=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(h,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(y,w)=>(delete m.request,m.unloadVectorData(),m.aborted?a(null):y?a(y):(m.loadVectorData(w,this.map.painter,h==="reloadTile"),a(null))),void 0,h==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Un{constructor(m,a,h,y){super(m,a,h,y),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,i.ResourceType.Source).url);i.getVideo(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new i.ErrorEvent(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new i.Texture(m,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Un,canvas:class extends Un{constructor(m,a,h,y){super(m,a,h,y),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(S=>typeof S!="number"))||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof i.window.HTMLCanvasElement||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof i.window.HTMLCanvasElement?this.options.canvas:i.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends i.Evented{constructor(m,a,h,y){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jr(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),i.extend(this,i.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:h,z:y}=m.canonical;return this._implementation.hasTile({x:a,y:h,z:y})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:h,y,z:w}=m.tileID.canonical,S=new i.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:h,y,z:w},{signal:S.signal})).then((function(R){return delete m.request,m.aborted?(m.state="unloaded",a(null)):R===void 0?(m.state="errored",a(null)):R===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null)):function(D){return D instanceof i.window.ImageData||D instanceof i.window.HTMLCanvasElement||D instanceof i.window.ImageBitmap||D instanceof i.window.HTMLImageElement}(R)?(this.loadTileData(m,R),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(R=>{R.code!==20&&(m.state="errored",a(R))}),m.request.cancel=()=>S.abort()}loadTileData(m,a){Dt.loadTileData(m,a,this._map.painter)}unloadTileData(m){Dt.unloadTileData(m,this._map.painter)}unloadTile(m,a){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:h,y,z:w}=m.tileID.canonical;this._implementation.unloadTile({x:h,y,z:w})}a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}}},zn=function(m,a,h,y){const w=new Fn[a.type](m,a,h,y);if(w.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${w.id}`);return i.bindAll(["load","abort","unload","serialize","prepare"],w),w};function $n(m,a){const h=i.identity([]);return i.scale(h,h,[.5*m.width,.5*-m.height,1]),i.translate(h,h,[1,-1,0]),i.multiply(h,h,m.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(h)}function Yr(m,a,h,y,w,S,R,D=!1){const G=m.tilesIn(y,R,D);G.sort(Wi);const q=[];for(const ne of G)q.push({wrappedTileID:ne.tile.tileID.wrapped().key,queryResults:ne.tile.queryRenderedFeatures(a,h,m._state,ne,w,S,$n(m.transform,ne.tile.tileID),D)});const Z=function(ne){const he={},fe={};for(const _e of ne){const ge=_e.queryResults,ye=_e.wrappedTileID,ie=fe[ye]=fe[ye]||{};for(const pe in ge){const we=ge[pe],Ee=ie[pe]=ie[pe]||{},ke=he[pe]=he[pe]||[];for(const Ue of we)Ee[Ue.featureIndex]||(Ee[Ue.featureIndex]=!0,ke.push(Ue))}}return he}(q);for(const ne in Z)Z[ne].forEach(he=>{const fe=he.feature,_e=fe.layer;_e&&_e.type!=="background"&&_e.type!=="sky"&&(fe.source=_e.source,_e["source-layer"]&&(fe.sourceLayer=_e["source-layer"]),fe.state=fe.id!==void 0?m.getFeatureState(_e["source-layer"],fe.id):{})});return Z}function yi(m,a){const h=m.getRenderableIds().map(S=>m.getTileByID(S)),y=[],w={};for(let S=0;S<h.length;S++){const R=h[S],D=R.tileID.canonical.key;w[D]||(w[D]=!0,R.querySourceFeatures(y,a))}return y}function Wi(m,a){const h=m.tileID,y=a.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function zi(){return ru.workerClass!=null?new ru.workerClass:new i.window.Worker(ru.workerUrl)}const Hs="mapboxgl_preloaded_worker_pool";class br{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<br.workerCount;)this.workers.push(new zi);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Hs]}numActive(){return Object.keys(this.active).length}}let Eo;function Nl(){return Eo||(Eo=new br),Eo}function Yh(m,a){const h={};for(const y in m)y!=="ref"&&(h[y]=m[y]);return i.refProperties.forEach(y=>{y in a&&(h[y]=a[y])}),h}function Ru(m){m=m.slice();const a=Object.create(null);for(let h=0;h<m.length;h++)a[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=Yh(m[h],a[m[h].ref]));return m}br.workerCount=2;const vr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function _c(m,a,h){h.push({command:vr.addSource,args:[m,a[m]]})}function yc(m,a,h){a.push({command:vr.removeSource,args:[m]}),h[m]=!0}function Fa(m,a,h,y){yc(m,h,y),_c(m,a,h)}function Ws(m,a,h){let y;for(y in m[h])if(m[h].hasOwnProperty(y)&&y!=="data"&&!E(m[h][y],a[h][y]))return!1;for(y in a[h])if(a[h].hasOwnProperty(y)&&y!=="data"&&!E(m[h][y],a[h][y]))return!1;return!0}function Jo(m,a,h,y,w,S){let R;for(R in a=a||{},m=m||{})m.hasOwnProperty(R)&&(E(m[R],a[R])||h.push({command:S,args:[y,R,a[R],w]}));for(R in a)a.hasOwnProperty(R)&&!m.hasOwnProperty(R)&&(E(m[R],a[R])||h.push({command:S,args:[y,R,a[R],w]}))}function zr(m){return m.id}function Nc(m,a){return m[a.id]=a,m}class Gl{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=i.clamp(a,0,1);let h=1,y=this._distances[h];const w=a*this.paddedLength+this.padding;for(;y<w&&h<this._distances.length;)y=this._distances[++h];const S=h-1,R=this._distances[S],D=y-R,G=D>0?(w-R)/D:0;return this.points[S].mult(1-G).add(this.points[h].mult(G))}}class Zi{constructor(a,h,y){const w=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(a/y),this.yCellCount=Math.ceil(h/y);for(let R=0;R<this.xCellCount*this.yCellCount;R++)w.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,y,w,S){this._forEachCell(h,y,w,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(w),this.bboxes.push(S)}insertCircle(a,h,y,w){this._forEachCell(h-w,y-w,h+w,y+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(y),this.circles.push(w)}_insertBoxCell(a,h,y,w,S,R){this.boxCells[S].push(R)}_insertCircleCell(a,h,y,w,S,R){this.circleCells[S].push(R)}_query(a,h,y,w,S,R){if(y<0||a>this.width||w<0||h>this.height)return!S&&[];const D=[];if(a<=0&&h<=0&&this.width<=y&&this.height<=w){if(S)return!0;for(let G=0;G<this.boxKeys.length;G++)D.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const q=this.circles[3*G],Z=this.circles[3*G+1],ne=this.circles[3*G+2];D.push({key:this.circleKeys[G],x1:q-ne,y1:Z-ne,x2:q+ne,y2:Z+ne})}return R?D.filter(R):D}return this._forEachCell(a,h,y,w,this._queryCell,D,{hitTest:S,seenUids:{box:{},circle:{}}},R),S?D.length>0:D}_queryCircle(a,h,y,w,S){const R=a-y,D=a+y,G=h-y,q=h+y;if(D<0||R>this.width||q<0||G>this.height)return!w&&[];const Z=[];return this._forEachCell(R,G,D,q,this._queryCellCircle,Z,{hitTest:w,circle:{x:a,y:h,radius:y},seenUids:{box:{},circle:{}}},S),w?Z.length>0:Z}query(a,h,y,w,S){return this._query(a,h,y,w,!1,S)}hitTest(a,h,y,w,S){return this._query(a,h,y,w,!0,S)}hitTestCircle(a,h,y,w){return this._queryCircle(a,h,y,!0,w)}_queryCell(a,h,y,w,S,R,D,G){const q=D.seenUids,Z=this.boxCells[S];if(Z!==null){const he=this.bboxes;for(const fe of Z)if(!q.box[fe]){q.box[fe]=!0;const _e=4*fe;if(a<=he[_e+2]&&h<=he[_e+3]&&y>=he[_e+0]&&w>=he[_e+1]&&(!G||G(this.boxKeys[fe]))){if(D.hitTest)return R.push(!0),!0;R.push({key:this.boxKeys[fe],x1:he[_e],y1:he[_e+1],x2:he[_e+2],y2:he[_e+3]})}}}const ne=this.circleCells[S];if(ne!==null){const he=this.circles;for(const fe of ne)if(!q.circle[fe]){q.circle[fe]=!0;const _e=3*fe;if(this._circleAndRectCollide(he[_e],he[_e+1],he[_e+2],a,h,y,w)&&(!G||G(this.circleKeys[fe]))){if(D.hitTest)return R.push(!0),!0;{const ge=he[_e],ye=he[_e+1],ie=he[_e+2];R.push({key:this.circleKeys[fe],x1:ge-ie,y1:ye-ie,x2:ge+ie,y2:ye+ie})}}}}}_queryCellCircle(a,h,y,w,S,R,D,G){const q=D.circle,Z=D.seenUids,ne=this.boxCells[S];if(ne!==null){const fe=this.bboxes;for(const _e of ne)if(!Z.box[_e]){Z.box[_e]=!0;const ge=4*_e;if(this._circleAndRectCollide(q.x,q.y,q.radius,fe[ge+0],fe[ge+1],fe[ge+2],fe[ge+3])&&(!G||G(this.boxKeys[_e])))return R.push(!0),!0}}const he=this.circleCells[S];if(he!==null){const fe=this.circles;for(const _e of he)if(!Z.circle[_e]){Z.circle[_e]=!0;const ge=3*_e;if(this._circlesCollide(fe[ge],fe[ge+1],fe[ge+2],q.x,q.y,q.radius)&&(!G||G(this.circleKeys[_e])))return R.push(!0),!0}}}_forEachCell(a,h,y,w,S,R,D,G){const q=this._convertToXCellCoord(a),Z=this._convertToYCellCoord(h),ne=this._convertToXCellCoord(y),he=this._convertToYCellCoord(w);for(let fe=q;fe<=ne;fe++)for(let _e=Z;_e<=he;_e++)if(S.call(this,a,h,y,w,this.xCellCount*_e+fe,R,D,G))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,y,w,S,R){const D=w-a,G=S-h,q=y+R;return q*q>D*D+G*G}_circleAndRectCollide(a,h,y,w,S,R,D){const G=(R-w)/2,q=Math.abs(a-(w+G));if(q>G+y)return!1;const Z=(D-S)/2,ne=Math.abs(h-(S+Z));if(ne>Z+y)return!1;if(q<=G||ne<=Z)return!0;const he=q-G,fe=ne-Z;return he*he+fe*fe<=y*y}}const hi={unknown:0,flipRequired:1,flipNotRequired:2},wr=Math.tan(85*Math.PI/180);function et(m,a,h,y,w,S,R){const D=i.create();if(h)if(S.name==="globe"){const G=i.calculateGlobeLabelMatrix(w,a);i.multiply(D,D,G)}else{const G=me([],R);D[0]=G[0],D[1]=G[1],D[4]=G[2],D[5]=G[3],y||i.rotateZ(D,D,w.angle)}else i.multiply(D,w.labelPlaneMatrix,m);return D}function Si(m,a,h,y,w,S,R){const D=et(m,a,h,y,w,S,R);return S.name==="globe"&&h||(D[2]=D[6]=D[10]=D[14]=0),D}function hr(m,a,h,y,w,S,R){if(h){if(S.name==="globe"){const D=et(m,a,h,y,w,S,R);return i.invert(D,D),i.multiply(D,m,D),D}{const D=i.clone(m),G=i.identity([]);return G[0]=R[0],G[1]=R[1],G[4]=R[2],G[5]=R[3],i.multiply(D,D,G),y||i.rotateZ(D,D,-w.angle),D}}return w.glCoordMatrix}function Sr(m,a,h,y){const w=[m,a,h,1];h?i.transformMat4$1(w,w,y):B(w,w,y);const S=w[3];return w[0]/=S,w[1]/=S,w[2]/=S,w}function ja(m,a){return Math.min(.5+m/a*.5,1.5)}function zo(m,a){const h=m[0]/m[3],y=m[1]/m[3];return h>=-a[0]&&h<=a[0]&&y>=-a[1]&&y<=a[1]}function ro(m,a,h,y,w,S,R,D,G,q){const Z=h.transform,ne=y?m.textSizeData:m.iconSizeData,he=i.evaluateSizeForZoom(ne,h.transform.zoom),fe=Z.projection.name==="globe",_e=[256/h.width*2+1,256/h.height*2+1],ge=y?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ge.clear();let ye=null;fe&&(ye=y?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const ie=m.lineVertexArray,pe=y?m.text.placedSymbolArray:m.icon.placedSymbolArray,we=h.transform.width/h.transform.height;let Ee,ke=!1;for(let Ue=0;Ue<pe.length;Ue++){const Fe=pe.get(Ue),{numGlyphs:He,writingMode:$e}=Fe;if($e!==i.WritingMode.vertical||ke||Ee===i.WritingMode.horizontal||(ke=!0),Ee=$e,(Fe.hidden||$e===i.WritingMode.vertical)&&!ke){Yo(He,ge);continue}ke=!1;const it=new i.Point(Fe.tileAnchorX,Fe.tileAnchorY);let{x:Pt,y:Qe,z:gt}=Z.projection.projectTilePoint(it.x,it.y,q.canonical);if(G){const[fn,qt,gn]=G(it);Pt+=fn,Qe+=qt,gt+=gn}const st=[Pt,Qe,gt,1];if(i.transformMat4$1(st,st,a),!zo(st,_e)){Yo(He,ge);continue}const Lt=ja(h.transform.cameraToCenterDistance,st[3]),tt=i.evaluateSizeForFeature(ne,he,Fe),mt=R?tt/Lt:tt*Lt,xt=Sr(Pt,Qe,gt,w);if(xt[3]<=0){Yo(He,ge);continue}let at={};const Et=R?null:G,rn=Ht(Fe,mt,!1,D,a,w,S,m.glyphOffsetArray,ie,ge,ye,xt,it,at,we,Et,Z.projection,q,R);ke=rn.useVertical,Et&&rn.needsFlipping&&(at={}),(rn.notEnoughRoom||ke||rn.needsFlipping&&Ht(Fe,mt,!0,D,a,w,S,m.glyphOffsetArray,ie,ge,ye,xt,it,at,we,Et,Z.projection,q,R).notEnoughRoom)&&Yo(He,ge)}y?(m.text.dynamicLayoutVertexBuffer.updateData(ge),ye&&m.text.globeExtVertexBuffer.updateData(ye)):(m.icon.dynamicLayoutVertexBuffer.updateData(ge),ye&&m.icon.globeExtVertexBuffer.updateData(ye))}function vl(m,a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge){const{lineStartIndex:ye,glyphStartIndex:ie,segment:pe}=D,we=ie+D.numGlyphs,Ee=ye+D.lineLength,ke=a.getoffsetX(ie),Ue=a.getoffsetX(we-1),Fe=wi(m*ke,h,y,w,S,R,pe,ye,Ee,G,q,Z,ne,he,!0,fe,_e,ge);if(!Fe)return null;const He=wi(m*Ue,h,y,w,S,R,pe,ye,Ee,G,q,Z,ne,he,!0,fe,_e,ge);return He?{first:Fe,last:He}:null}function Ua(m,a,h,y){return m===i.WritingMode.horizontal&&Math.abs(y)>Math.abs(h)?{useVertical:!0}:m===i.WritingMode.vertical?y>0?{needsFlipping:!0}:null:a!==hi.unknown&&function(w,S){return w===0||Math.abs(S/w)>wr}(h,y)?a===hi.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Ht(m,a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge,ye,ie,pe){const we=a/24,Ee=m.lineOffsetX*we,ke=m.lineOffsetY*we,{lineStartIndex:Ue,glyphStartIndex:Fe,numGlyphs:He,segment:$e,writingMode:it,flipState:Pt}=m,Qe=Ue+m.lineLength,gt=st=>{if(Z){const[xt,at,Et]=st.up,rn=q.length;i.updateGlobeVertexNormal(Z,rn+0,xt,at,Et),i.updateGlobeVertexNormal(Z,rn+1,xt,at,Et),i.updateGlobeVertexNormal(Z,rn+2,xt,at,Et),i.updateGlobeVertexNormal(Z,rn+3,xt,at,Et)}const[Lt,tt,mt]=st.point;i.addDynamicAttributes(q,Lt,tt,mt,st.angle)};if(He>1){const st=vl(we,D,Ee,ke,h,ne,he,m,G,S,fe,ge,!1,ye,ie,pe);if(!st)return{notEnoughRoom:!0};if(y&&!h){let[Lt,tt,mt]=st.first.point,[xt,at,Et]=st.last.point;[Lt,tt]=Sr(Lt,tt,mt,R),[xt,at]=Sr(xt,at,Et,R);const rn=Ua(it,Pt,(xt-Lt)*_e,at-tt);if(m.flipState=rn&&rn.needsFlipping?hi.flipRequired:hi.flipNotRequired,rn)return rn}gt(st.first);for(let Lt=Fe+1;Lt<Fe+He-1;Lt++){const tt=wi(we*D.getoffsetX(Lt),Ee,ke,h,ne,he,$e,Ue,Qe,G,S,fe,ge,!1,!1,ye,ie,pe);if(!tt)return q.length-=4*(Lt-Fe),{notEnoughRoom:!0};gt(tt)}gt(st.last)}else{if(y&&!h){const Lt=Sr(he.x,he.y,0,w),tt=Ue+$e+1,mt=new i.Point(G.getx(tt),G.gety(tt)),xt=Sr(mt.x,mt.y,0,w),at=xt[3]>0?xt:qn(he,mt,Lt,1,w,void 0,ye,ie.canonical),Et=Ua(it,Pt,(at[0]-Lt[0])*_e,at[1]-Lt[1]);if(m.flipState=Et&&Et.needsFlipping?hi.flipRequired:hi.flipNotRequired,Et)return Et}const st=wi(we*D.getoffsetX(Fe),Ee,ke,h,ne,he,$e,Ue,Qe,G,S,fe,ge,!1,!1,ye,ie,pe);if(!st)return{notEnoughRoom:!0};gt(st)}return{}}function Xn(m,a,h,y,w){const{x:S,y:R,z:D}=y.projectTilePoint(m.x,m.y,a);if(!w)return Sr(S,R,D,h);const[G,q,Z]=w(m);return Sr(S+G,R+q,D+Z,h)}function qn(m,a,h,y,w,S,R,D){const G=Xn(m.sub(a)._unit()._add(m),D,w,R,S);return i.sub(G,h,G),i.normalize(G,G),i.scaleAndAdd(G,h,G,y)}function wi(m,a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge,ye,ie){const pe=y?m-a:m+a;let we=pe>0?1:-1,Ee=0;y&&(we*=-1,Ee=Math.PI),we<0&&(Ee+=Math.PI);let ke=D+R+(we>0?0:1)|0,Ue=w,Fe=w,He=0,$e=0;const it=Math.abs(pe),Pt=[],Qe=[];let gt=S,st=gt;const Lt=()=>qn(st,gt,Fe,it-He+1,Z,he,ge,ye.canonical);for(;He+$e<=it;){if(ke+=we,ke<D||ke>=G)return null;if(Fe=Ue,st=gt,Pt.push(Fe),fe&&Qe.push(st),gt=new i.Point(q.getx(ke),q.gety(ke)),Ue=ne[ke],!Ue){const gn=Xn(gt,ye.canonical,Z,ge,he);Ue=gn[3]>0?ne[ke]=gn:Lt()}He+=$e,$e=i.distance(Fe,Ue)}_e&&he&&(ne[ke]&&(Ue=Lt(),$e=i.distance(Fe,Ue)),ne[ke]=Ue);const tt=(it-He)/$e,mt=gt.sub(st)._mult(tt)._add(st),xt=i.sub([],Ue,Fe),at=i.scaleAndAdd([],Fe,xt,tt);let Et=[0,0,1],rn=xt[0],fn=xt[1];if(ie&&(Et=ge.upVector(ye.canonical,mt.x,mt.y),Et[0]!==0||Et[1]!==0||Et[2]!==1)){const gn=[Et[2],0,-Et[0]],An=i.cross([],Et,gn);i.normalize(gn,gn),i.normalize(An,An),rn=i.dot(xt,gn),fn=i.dot(xt,An)}if(h){const gn=i.cross([],Et,xt);i.normalize(gn,gn),i.scaleAndAdd(at,at,gn,h*we)}const qt=Ee+Math.atan2(fn,rn);return Pt.push(at),fe&&Qe.push(mt),{point:at,angle:qt,path:Pt,tilePath:Qe,up:Et}}function Yo(m,a){const h=a.length,y=h+4*m;a.resize(y),a.float32.fill(-1/0,4*h,4*y)}function B(m,a,h){const y=a[0],w=a[1];return m[0]=h[0]*y+h[4]*w+h[12],m[1]=h[1]*y+h[5]*w+h[13],m[3]=h[3]*y+h[7]*w+h[15],m}const H=100;class ce{constructor(a,h,y=new Zi(a.width+200,a.height+200,25),w=new Zi(a.width+200,a.height+200,25)){this.transform=a,this.grid=y,this.ignoredGrid=w,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+H,this.screenBottomBoundary=a.height+H,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,y,w,S,R,D,G){let q=y.projectedAnchorX,Z=y.projectedAnchorY,ne=y.projectedAnchorZ;const he=y.elevation,fe=y.tileID,_e=a.getProjection();if(he&&fe){const[Ue,Fe,He]=_e.upVector(fe.canonical,y.tileAnchorX,y.tileAnchorY),$e=_e.upVectorScale(fe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;q+=Ue*he*$e,Z+=Fe*he*$e,ne+=He*he*$e}const ge=this.projectAndGetPerspectiveRatio(D,q,Z,ne,y.tileID,_e.name==="globe"||!!he||this.transform.pitch>0,_e),ye=R*ge.perspectiveRatio,ie=(y.x1*h+w.x-y.padding)*ye+ge.point.x,pe=(y.y1*h+w.y-y.padding)*ye+ge.point.y,we=(y.x2*h+w.x+y.padding)*ye+ge.point.x,Ee=(y.y2*h+w.y+y.padding)*ye+ge.point.y,ke=ge.perspectiveRatio<=.55||ge.occluded;return!this.isInsideGrid(ie,pe,we,Ee)||!S&&this.grid.hitTest(ie,pe,we,Ee,G)||ke?{box:[],offscreen:!1,occluded:ge.occluded}:{box:[ie,pe,we,Ee],offscreen:this.isOffscreen(ie,pe,we,Ee),occluded:!1}}placeCollisionCircles(a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge){const ye=[],ie=this.transform.elevation,pe=a.getProjection(),we=ie?ie.getAtTileOffsetFunc(ge,this.transform.center.lat,this.transform.worldSize,pe):null,Ee=new i.Point(y.tileAnchorX,y.tileAnchorY);let{x:ke,y:Ue,z:Fe}=pe.projectTilePoint(Ee.x,Ee.y,ge.canonical);if(we){const[mt,xt,at]=we(Ee);ke+=mt,Ue+=xt,Fe+=at}const He=pe.name==="globe",$e=this.projectAndGetPerspectiveRatio(D,ke,Ue,Fe,ge,He||!!ie||this.transform.pitch>0,pe),{perspectiveRatio:it}=$e,Pt=(ne?R/it:R*it)/i.ONE_EM,Qe=Sr(ke,Ue,Fe,G),gt=$e.signedDistanceFromCamera>0?vl(Pt,S,y.lineOffsetX*Pt,y.lineOffsetY*Pt,!1,Qe,Ee,y,w,G,{},ie&&!ne?we:null,ne&&!!ie,pe,ge,ne):null;let st=!1,Lt=!1,tt=!0;if(gt&&!$e.occluded){const mt=.5*fe*it+_e,xt=new i.Point(-100,-100),at=new i.Point(this.screenRightBoundary,this.screenBottomBoundary),Et=new Gl,{first:rn,last:fn}=gt,qt=rn.path.length;let gn=[];for(let un=qt-1;un>=1;un--)gn.push(rn.path[un]);for(let un=1;un<fn.path.length;un++)gn.push(fn.path[un]);const An=2.5*mt;q&&(gn=gn.map(([un,xr,Or],Cr)=>(we&&!He&&(Or=we(Cr<qt-1?rn.tilePath[qt-1-Cr]:fn.tilePath[Cr-qt+2])[2]),Sr(un,xr,Or,q))),gn.some(un=>un[3]<=0)&&(gn=[]));let Nn=[];if(gn.length>0){let un=1/0,xr=-1/0,Or=1/0,Cr=-1/0;for(const or of gn)un=Math.min(un,or[0]),Or=Math.min(Or,or[1]),xr=Math.max(xr,or[0]),Cr=Math.max(Cr,or[1]);xr>=xt.x&&un<=at.x&&Cr>=xt.y&&Or<=at.y&&(Nn=[gn.map(or=>new i.Point(or[0],or[1]))],(un<xt.x||xr>at.x||Or<xt.y||Cr>at.y)&&(Nn=i.clipLine(Nn,xt.x,xt.y,at.x,at.y)))}for(const un of Nn){Et.reset(un,.25*mt);let xr=0;xr=Et.length<=.5*mt?1:Math.ceil(Et.paddedLength/An)+1;for(let Or=0;Or<xr;Or++){const Cr=Or/Math.max(xr-1,1),or=Et.lerp(Cr),Mo=or.x+H,to=or.y+H;ye.push(Mo,to,mt,0);const Vo=Mo-mt,js=to-mt,ti=Mo+mt,_r=to+mt;if(tt=tt&&this.isOffscreen(Vo,js,ti,_r),Lt=Lt||this.isInsideGrid(Vo,js,ti,_r),!h&&this.grid.hitTestCircle(Mo,to,mt,he)&&(st=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:st,occluded:!1}}}}return{circles:!Z&&st||!Lt?[]:ye,offscreen:tt,collisionDetected:st,occluded:$e.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let y=1/0,w=1/0,S=-1/0,R=-1/0;for(const Z of a){const ne=new i.Point(Z.x+H,Z.y+H);y=Math.min(y,ne.x),w=Math.min(w,ne.y),S=Math.max(S,ne.x),R=Math.max(R,ne.y),h.push(ne)}const D=this.grid.query(y,w,S,R).concat(this.ignoredGrid.query(y,w,S,R)),G={},q={};for(const Z of D){const ne=Z.key;if(G[ne.bucketInstanceId]===void 0&&(G[ne.bucketInstanceId]={}),G[ne.bucketInstanceId][ne.featureIndex])continue;const he=[new i.Point(Z.x1,Z.y1),new i.Point(Z.x2,Z.y1),new i.Point(Z.x2,Z.y2),new i.Point(Z.x1,Z.y2)];i.polygonIntersectsPolygon(h,he)&&(G[ne.bucketInstanceId][ne.featureIndex]=!0,q[ne.bucketInstanceId]===void 0&&(q[ne.bucketInstanceId]=[]),q[ne.bucketInstanceId].push(ne.featureIndex))}return q}insertCollisionBox(a,h,y,w,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:S},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,y,w,S){const R=h?this.ignoredGrid:this.grid,D={bucketInstanceId:y,featureIndex:w,collisionGroupID:S};for(let G=0;G<a.length;G+=4)R.insertCircle(D,a[G],a[G+1],a[G+2])}projectAndGetPerspectiveRatio(a,h,y,w,S,R,D){const G=[h,y,w,1];let q=!1;w||this.transform.pitch>0?(i.transformMat4$1(G,G,a),this.fogState&&S&&D.name!=="globe"&&(q=function(he,fe,_e,ge,ye,ie){const pe=ie.calculateFogTileMatrix(ye),we=[fe,_e,ge];return i.transformMat4(we,we,pe),hn(he,we,ie.pitch,ie._fov)}(this.fogState,h,y,w,S.toUnwrapped(),this.transform)>.9)):B(G,G,a);const Z=G[3];return{point:new i.Point((G[0]/Z+1)/2*this.transform.width+H,(-G[1]/Z+1)/2*this.transform.height+H),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/Z*.5,1.5),signedDistanceFromCamera:Z,occluded:R&&G[2]>Z||q}}isOffscreen(a,h,y,w){return y<H||a>=this.screenRightBoundary||w<H||h>this.screenBottomBoundary}isInsideGrid(a,h,y,w){return y>=0&&a<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=i.identity([]);return i.translate(a,a,[-100,-100,0]),a}}function Se(m,a,h){const y=a.createTileMatrix(m,m.worldSize,h.toUnwrapped());return i.multiply(new Float32Array(16),m.projMatrix,y)}function ze(m,a,h){if(a.projection.name===h.projection.name)return m.projMatrix;const y=h.clone();return y.setProjection(a.projection),Se(y,a.getProjection(),m)}function De(m,a,h){return a.name===h.projection.name?m.projMatrix:Se(h,a,m)}class Ke{constructor(a,h,y,w){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):w&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class It{constructor(a,h,y,w,S,R=!1){this.text=new Ke(a?a.text:null,h,y,S),this.icon=new Ke(a?a.icon:null,h,w,S),this.clipped=R}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ft{constructor(a,h,y,w=!1){this.text=a,this.icon=h,this.skipFade=y,this.clipped=w}}class Jt{constructor(){this.invProjMatrix=i.create(),this.viewportMatrix=i.create(),this.circles=[]}}class Yt{constructor(a,h,y,w,S){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=w,this.tileID=S}}class Wt{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[a]}}function Rn(m,a,h,y,w){const{horizontalAlign:S,verticalAlign:R}=i.getAnchorAlignment(m),D=-(S-.5)*a,G=-(R-.5)*h,q=i.evaluateVariableOffset(m,y);return new i.Point(D+q[0]*w,G+q[1]*w)}function Sn(m,a,h,y,w){const S=new i.Point(m,a);return h&&S._rotate(y?w:-w),S}class jn{constructor(a,h,y,w,S){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new ce(this.transform,S),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Wt(y),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,y,w){const S=y.getBucket(h),R=y.latestFeatureIndex;if(!S||!R||h.id!==S.layerIds[0])return;const D=S.layers[0].layout,G=y.collisionBoxArray,q=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),Z=y.tileSize/i.EXTENT,ne=y.tileID.toUnwrapped();this.transform.setProjection(S.projection);const he=(fe=y.tileID,_e=S.getProjection(),ge=this.transform,_e.name===this.projection?ge.calculateProjMatrix(fe.toUnwrapped()):Se(ge,_e,fe));var fe,_e,ge;const ye=D.get("text-pitch-alignment")==="map",ie=D.get("text-rotation-alignment")==="map";h.compileFilter();const pe=h.dynamicFilter(),we=h.dynamicFilterNeedsFeature(),Ee=this.transform.calculatePixelsToTileUnitsMatrix(y),ke=Si(he,y.tileID.canonical,ye,ie,this.transform,S.getProjection(),Ee);let Ue=null;if(ye){const $e=hr(he,y.tileID.canonical,ye,ie,this.transform,S.getProjection(),Ee);Ue=i.multiply([],this.transform.labelPlaneMatrix,$e)}let Fe=null;pe&&y.latestFeatureIndex&&(Fe={unwrappedTileID:ne,dynamicFilter:pe,dynamicFilterNeedsFeature:we,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new Yt(S.bucketInstanceId,R,S.sourceLayerIndex,S.index,y.tileID);const He={bucket:S,layout:D,posMatrix:he,textLabelPlaneMatrix:ke,labelToScreenMatrix:Ue,clippingData:Fe,scale:q,textPixelRatio:Z,holdingForFade:y.holdingForFade(),collisionBoxArray:G,partiallyEvaluatedTextSize:i.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.evaluateSizeForZoom(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(w)for(const $e of S.sortKeyRanges){const{sortKey:it,symbolInstanceStart:Pt,symbolInstanceEnd:Qe}=$e;a.push({sortKey:it,symbolInstanceStart:Pt,symbolInstanceEnd:Qe,parameters:He})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:He})}attemptAnchorPlacement(a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge,ye,ie,pe){const{textOffset0:we,textOffset1:Ee,crossTileID:ke}=he,Ue=[we,Ee],Fe=Rn(a,y,w,Ue,S),He=this.collisionIndex.placeCollisionBox(_e,S,h,Sn(Fe.x,Fe.y,R,D,this.transform.angle),ne,G,q,Z.predicate);if(ye){const $e=_e.getSymbolInstanceIconSize(pe,this.transform.zoom,he.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(_e,$e,ye,Sn(Fe.x,Fe.y,R,D,this.transform.angle),ne,G,q,Z.predicate).box.length===0)return}if(He.box.length>0){let $e;return this.prevPlacement&&this.prevPlacement.variableOffsets[ke]&&this.prevPlacement.placements[ke]&&this.prevPlacement.placements[ke].text&&($e=this.prevPlacement.variableOffsets[ke].anchor),this.variableOffsets[ke]={textOffset:Ue,width:y,height:w,anchor:a,textScale:S,prevAnchor:$e},this.markUsedJustification(_e,a,he,ge),_e.allowVerticalPlacement&&(this.markUsedOrientation(_e,ge,he),this.placedOrientations[ke]=ge),{shift:Fe,placedGlyphBoxes:He}}}placeLayerBucketPart(a,h,y,w){const{bucket:S,layout:R,posMatrix:D,textLabelPlaneMatrix:G,labelToScreenMatrix:q,clippingData:Z,textPixelRatio:ne,holdingForFade:he,collisionBoxArray:fe,partiallyEvaluatedTextSize:_e,partiallyEvaluatedIconSize:ge,collisionGroup:ye}=a.parameters,ie=R.get("text-optional"),pe=R.get("icon-optional"),we=R.get("text-allow-overlap"),Ee=R.get("icon-allow-overlap"),ke=R.get("text-rotation-alignment")==="map",Ue=R.get("text-pitch-alignment")==="map",Fe=R.get("icon-text-fit")!=="none",He=R.get("symbol-z-order")==="viewport-y";this.transform.setProjection(S.projection);let $e=we&&(Ee||!S.hasIconData()||pe),it=Ee&&(we||!S.hasTextData()||ie);!S.collisionArrays&&fe&&S.deserializeCollisionBoxes(fe),y&&w&&S.updateCollisionDebugBuffers(this.transform.zoom,fe);const Pt=(Qe,gt,st)=>{const{crossTileID:Lt,numVerticalGlyphVertices:tt}=Qe;if(Z){const ti={zoom:this.transform.zoom,pitch:this.transform.pitch};let _r=null;if(Z.dynamicFilterNeedsFeature){const mr=this.retainedQueryData[S.bucketInstanceId];_r=Z.featureIndex.loadFeature({featureIndex:Qe.featureIndex,bucketIndex:mr.bucketIndex,sourceLayerIndex:mr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Z.dynamicFilter)(ti,_r,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new i.Point(Qe.tileAnchorX,Qe.tileAnchorY),this.transform.calculateDistanceTileData(Z.unwrappedTileID)))return this.placements[Lt]=new Ft(!1,!1,!1,!0),void h.add(Lt)}if(h.has(Lt))return;if(he)return void(this.placements[Lt]=new Ft(!1,!1,!1));let mt=!1,xt=!1,at=!0,Et=!1,rn=!1,fn=null,qt={box:null,offscreen:null,occluded:null},gn={box:null,offscreen:null,occluded:null},An=null,Nn=null,un=null,xr=0,Or=0,Cr=0;st.textFeatureIndex?xr=st.textFeatureIndex:Qe.useRuntimeCollisionCircles&&(xr=Qe.featureIndex),st.verticalTextFeatureIndex&&(Or=st.verticalTextFeatureIndex);const or=ti=>{ti.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const _r=this.transform.elevation;(_r||ti.elevation)&&(ti.elevation=_r?_r.getAtTileOffset(ti.tileID,ti.tileAnchorX,ti.tileAnchorY):0)},Mo=st.textBox;if(Mo){or(Mo);const ti=mr=>{let ni=i.WritingMode.horizontal;if(S.allowVerticalPlacement&&!mr&&this.prevPlacement){const Io=this.prevPlacement.placedOrientations[Lt];Io&&(this.placedOrientations[Lt]=Io,ni=Io,this.markUsedOrientation(S,ni,Qe))}return ni},_r=(mr,ni)=>{if(S.allowVerticalPlacement&&tt>0&&st.verticalTextBox){for(const Io of S.writingModes)if(Io===i.WritingMode.vertical?(qt=ni(),gn=qt):qt=mr(),qt&&qt.box&&qt.box.length)break}else qt=mr()};if(R.get("text-variable-anchor")){let mr=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt]){const jr=this.prevPlacement.variableOffsets[Lt];mr.indexOf(jr.anchor)>0&&(mr=mr.filter(ls=>ls!==jr.anchor),mr.unshift(jr.anchor))}const ni=(jr,ls,Tc)=>{const ol=S.getSymbolInstanceTextSize(_e,Qe,this.transform.zoom,gt),lo=(jr.x2-jr.x1)*ol+2*jr.padding,cs=(jr.y2-jr.y1)*ol+2*jr.padding,co=Fe&&!Ee?ls:null;co&&or(co);let sl={box:[],offscreen:!1,occluded:!1};const $o=we?2*mr.length:mr.length;for(let iu=0;iu<$o;++iu){const Zu=this.attemptAnchorPlacement(mr[iu%mr.length],jr,lo,cs,ol,ke,Ue,ne,D,ye,iu>=mr.length,Qe,gt,S,Tc,co,_e,ge);if(Zu&&(sl=Zu.placedGlyphBoxes,sl&&sl.box&&sl.box.length)){mt=!0,fn=Zu.shift;break}}return sl};_r(()=>ni(Mo,st.iconBox,i.WritingMode.horizontal),()=>{const jr=st.verticalTextBox;return jr&&or(jr),S.allowVerticalPlacement&&!(qt&&qt.box&&qt.box.length)&&tt>0&&jr?ni(jr,st.verticalIconBox,i.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),qt&&(mt=qt.box,at=qt.offscreen,Et=qt.occluded);const Io=ti(!(!qt||!qt.box));if(!mt&&this.prevPlacement){const jr=this.prevPlacement.variableOffsets[Lt];jr&&(this.variableOffsets[Lt]=jr,this.markUsedJustification(S,jr.anchor,Qe,Io))}}else{const mr=(ni,Io)=>{const jr=S.getSymbolInstanceTextSize(_e,Qe,this.transform.zoom,gt),ls=this.collisionIndex.placeCollisionBox(S,jr,ni,new i.Point(0,0),we,ne,D,ye.predicate);return ls&&ls.box&&ls.box.length&&(this.markUsedOrientation(S,Io,Qe),this.placedOrientations[Lt]=Io),ls};_r(()=>mr(Mo,i.WritingMode.horizontal),()=>{const ni=st.verticalTextBox;return S.allowVerticalPlacement&&tt>0&&ni?(or(ni),mr(ni,i.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ti(!!(qt&&qt.box&&qt.box.length))}}if(An=qt,mt=An&&An.box&&An.box.length>0,at=An&&An.offscreen,Et=An&&An.occluded,Qe.useRuntimeCollisionCircles){const ti=S.text.placedSymbolArray.get(Qe.centerJustifiedTextSymbolIndex>=0?Qe.centerJustifiedTextSymbolIndex:Qe.verticalPlacedTextSymbolIndex),_r=i.evaluateSizeForFeature(S.textSizeData,_e,ti),mr=R.get("text-padding");Nn=this.collisionIndex.placeCollisionCircles(S,we,ti,S.lineVertexArray,S.glyphOffsetArray,_r,D,G,q,y,Ue,ye.predicate,Qe.collisionCircleDiameter*_r/i.ONE_EM,mr,this.retainedQueryData[S.bucketInstanceId].tileID),mt=we||Nn.circles.length>0&&!Nn.collisionDetected,at=at&&Nn.offscreen,Et=Nn.occluded}if(st.iconFeatureIndex&&(Cr=st.iconFeatureIndex),st.iconBox){const ti=_r=>{or(_r);const mr=Fe&&fn?Sn(fn.x,fn.y,ke,Ue,this.transform.angle):new i.Point(0,0),ni=S.getSymbolInstanceIconSize(ge,this.transform.zoom,Qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,ni,_r,mr,Ee,ne,D,ye.predicate)};gn&&gn.box&&gn.box.length&&st.verticalIconBox?(un=ti(st.verticalIconBox),xt=un.box.length>0):(un=ti(st.iconBox),xt=un.box.length>0),at=at&&un.offscreen,rn=un.occluded}const to=ie||Qe.numHorizontalGlyphVertices===0&&tt===0,Vo=pe||Qe.numIconVertices===0;if(to||Vo?Vo?to||(xt=xt&&mt):mt=xt&&mt:xt=mt=xt&&mt,mt&&An&&An.box&&this.collisionIndex.insertCollisionBox(An.box,R.get("text-ignore-placement"),S.bucketInstanceId,gn&&gn.box&&Or?Or:xr,ye.ID),xt&&un&&this.collisionIndex.insertCollisionBox(un.box,R.get("icon-ignore-placement"),S.bucketInstanceId,Cr,ye.ID),Nn&&(mt&&this.collisionIndex.insertCollisionCircles(Nn.circles,R.get("text-ignore-placement"),S.bucketInstanceId,xr,ye.ID),y)){const ti=S.bucketInstanceId;let _r=this.collisionCircleArrays[ti];_r===void 0&&(_r=this.collisionCircleArrays[ti]=new Jt);for(let mr=0;mr<Nn.circles.length;mr+=4)_r.circles.push(Nn.circles[mr+0]),_r.circles.push(Nn.circles[mr+1]),_r.circles.push(Nn.circles[mr+2]),_r.circles.push(Nn.collisionDetected?1:0)}const js=S.projection.name!=="globe";$e=$e&&(js||!Et),it=it&&(js||!rn),this.placements[Lt]=new Ft(mt||$e,xt||it,at||S.justReloaded),h.add(Lt)};if(He){const Qe=S.getSortedSymbolIndexes(this.transform.angle);for(let gt=Qe.length-1;gt>=0;--gt){const st=Qe[gt];Pt(S.symbolInstances.get(st),st,S.collisionArrays[st])}}else for(let Qe=a.symbolInstanceStart;Qe<a.symbolInstanceEnd;Qe++)Pt(S.symbolInstances.get(Qe),Qe,S.collisionArrays[Qe]);if(y&&S.bucketInstanceId in this.collisionCircleArrays){const Qe=this.collisionCircleArrays[S.bucketInstanceId];i.invert(Qe.invProjMatrix,D),Qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(a,h,y,w){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:G,crossTileID:q}=y,Z=i.getAnchorJustification(h),ne=w===i.WritingMode.vertical?G:Z==="left"?S:Z==="center"?R:Z==="right"?D:-1;S>=0&&(a.text.placedSymbolArray.get(S).crossTileID=ne>=0&&S!==ne?0:q),R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=ne>=0&&R!==ne?0:q),D>=0&&(a.text.placedSymbolArray.get(D).crossTileID=ne>=0&&D!==ne?0:q),G>=0&&(a.text.placedSymbolArray.get(G).crossTileID=ne>=0&&G!==ne?0:q)}markUsedOrientation(a,h,y){const w=h===i.WritingMode.horizontal||h===i.WritingMode.horizontalOnly?h:0,S=h===i.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:R,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:q}=y,Z=a.text.placedSymbolArray;R>=0&&(Z.get(R).placedOrientation=w),D>=0&&(Z.get(D).placedOrientation=w),G>=0&&(Z.get(G).placedOrientation=w),q>=0&&(Z.get(q).placedOrientation=S)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(a):1,S=h?h.opacities:{},R=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const G in this.placements){const q=this.placements[G],Z=S[G];Z?(this.opacities[G]=new It(Z,w,q.text,q.icon,null,q.clipped),y=y||q.text!==Z.text.placed||q.icon!==Z.icon.placed):(this.opacities[G]=new It(null,w,q.text,q.icon,q.skipFade,q.clipped),y=y||q.text||q.icon)}for(const G in S){const q=S[G];if(!this.opacities[G]){const Z=new It(q,w,!1,!1);Z.isHidden()||(this.opacities[G]=Z,y=y||q.text.placed||q.icon.placed)}}for(const G in R)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=R[G]);for(const G in D)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=D[G]);y?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h){const y=new Set;for(const w of h){const S=w.getBucket(a);S&&w.latestFeatureIndex&&a.id===S.layerIds[0]&&this.updateBucketOpacities(S,y,w.collisionBoxArray)}}updateBucketOpacities(a,h,y){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const w=a.layers[0].layout,S=!!a.layers[0].dynamicFilter(),R=new It(null,0,!1,!1,!0),D=w.get("text-allow-overlap"),G=w.get("icon-allow-overlap"),q=w.get("text-variable-anchor"),Z=w.get("text-rotation-alignment")==="map",ne=w.get("text-pitch-alignment")==="map",he=w.get("icon-text-fit")!=="none",fe=new It(null,0,D&&(G||!a.hasIconData()||w.get("icon-optional")),G&&(D||!a.hasTextData()||w.get("text-optional")),!0);!a.collisionArrays&&y&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(y);const _e=(ye,ie,pe)=>{for(let we=0;we<ie/4;we++)ye.opacityVertexArray.emplaceBack(pe)};let ge=0;for(let ye=0;ye<a.symbolInstances.length;ye++){const ie=a.symbolInstances.get(ye),{numHorizontalGlyphVertices:pe,numVerticalGlyphVertices:we,crossTileID:Ee,numIconVertices:ke}=ie,Ue=h.has(Ee);let Fe=this.opacities[Ee];Ue?Fe=R:Fe||(Fe=fe,this.opacities[Ee]=Fe),h.add(Ee);const He=pe>0||we>0,$e=ke>0,it=this.placedOrientations[Ee],Pt=it===i.WritingMode.vertical,Qe=it===i.WritingMode.horizontal||it===i.WritingMode.horizontalOnly;if(!He&&!$e||Fe.isHidden()||ge++,He){const gt=Fr(Fe.text);_e(a.text,pe,Pt?Zr:gt),_e(a.text,we,Qe?Zr:gt);const st=Fe.text.isHidden(),{leftJustifiedTextSymbolIndex:Lt,centerJustifiedTextSymbolIndex:tt,rightJustifiedTextSymbolIndex:mt,verticalPlacedTextSymbolIndex:xt}=ie,at=a.text.placedSymbolArray,Et=st||Pt?1:0;Lt>=0&&(at.get(Lt).hidden=Et),tt>=0&&(at.get(tt).hidden=Et),mt>=0&&(at.get(mt).hidden=Et),xt>=0&&(at.get(xt).hidden=st||Qe?1:0);const rn=this.variableOffsets[Ee];rn&&this.markUsedJustification(a,rn.anchor,ie,it);const fn=this.placedOrientations[Ee];fn&&(this.markUsedJustification(a,"left",ie,fn),this.markUsedOrientation(a,fn,ie))}if($e){const gt=Fr(Fe.icon),{placedIconSymbolIndex:st,verticalPlacedIconSymbolIndex:Lt}=ie,tt=a.icon.placedSymbolArray,mt=Fe.icon.isHidden()?1:0;st>=0&&(_e(a.icon,ke,Pt?Zr:gt),tt.get(st).hidden=mt),Lt>=0&&(_e(a.icon,ie.numVerticalIconVertices,Qe?Zr:gt),tt.get(Lt).hidden=mt)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const gt=a.collisionArrays[ye];if(gt){let st=new i.Point(0,0),Lt=!0;if(gt.textBox||gt.verticalTextBox){if(q){const mt=this.variableOffsets[Ee];mt?(st=Rn(mt.anchor,mt.width,mt.height,mt.textOffset,mt.textScale),Z&&st._rotate(ne?this.transform.angle:-this.transform.angle)):Lt=!1}S&&(Lt=!Fe.clipped),gt.textBox&&Wr(a.textCollisionBox.collisionVertexArray,Fe.text.placed,!Lt||Pt,st.x,st.y),gt.verticalTextBox&&Wr(a.textCollisionBox.collisionVertexArray,Fe.text.placed,!Lt||Qe,st.x,st.y)}const tt=Lt&&!!(!Qe&&gt.verticalIconBox);gt.iconBox&&Wr(a.iconCollisionBox.collisionVertexArray,Fe.icon.placed,tt,he?st.x:0,he?st.y:0),gt.verticalIconBox&&Wr(a.iconCollisionBox.collisionVertexArray,Fe.icon.placed,!tt,he?st.x:0,he?st.y:0)}}}if(a.fullyClipped=ge===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ye.invProjMatrix,a.placementViewportMatrix=ye.viewportMatrix,a.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>a}setStale(){this.stale=!0}}function Wr(m,a,h,y,w){m.emplaceBack(a?1:0,h?1:0,y||0,w||0),m.emplaceBack(a?1:0,h?1:0,y||0,w||0),m.emplaceBack(a?1:0,h?1:0,y||0,w||0),m.emplaceBack(a?1:0,h?1:0,y||0,w||0)}const yt=Math.pow(2,25),en=Math.pow(2,24),Mr=Math.pow(2,17),dr=Math.pow(2,16),gr=Math.pow(2,9),Qo=Math.pow(2,8),Gc=Math.pow(2,1);function Fr(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const a=m.placed?1:0,h=Math.floor(127*m.opacity);return h*yt+a*en+h*Mr+a*dr+h*gr+a*Qo+h*Gc+a}const Zr=0;class es{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,h,y,w,S){const R=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(R,w,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((D,G)=>D.sortKey-G.sortKey));this._currentPartIndex<R.length;){const D=R[this._currentPartIndex];if(h.placeLayerBucketPart(D,this._seenCrossTileIDs,y,D.symbolInstanceStart===0),this._currentPartIndex++,S())return!0}return!1}}class Rs{constructor(a,h,y,w,S,R,D,G){this.placement=new jn(a,S,R,D,G),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(a,h,y){const w=i.exported.now(),S=()=>{const R=i.exported.now()-w;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=h[a[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=D)&&(!R.maxzoom||R.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new es(R)),this._inProgressLayer.continuePlacement(y[R.source],this.placement,this._showCollisionBoxes,R,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Na=512/i.EXTENT/2;class Xr{constructor(a,h,y){this.tileID=a,this.bucketInstanceId=y,this.index=new i.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=a.canonical.x*i.EXTENT,S=a.canonical.y*i.EXTENT;for(let R=0;R<h.length;R++){const{key:D,crossTileID:G,tileAnchorX:q,tileAnchorY:Z}=h.get(R),ne=Math.floor((w+q)*Na),he=Math.floor((S+Z)*Na);this.index.add(ne,he),this.keys.push(D),this.crossTileIDs.push(G)}this.index.finish()}findMatches(a,h,y){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=Na/Math.pow(2,h.canonical.z-this.tileID.canonical.z),R=h.canonical.x*i.EXTENT,D=h.canonical.y*i.EXTENT;for(let G=0;G<a.length;G++){const q=a.get(G);if(q.crossTileID)continue;const{key:Z,tileAnchorX:ne,tileAnchorY:he}=q,fe=Math.floor((R+ne)*S),_e=Math.floor((D+he)*S),ge=this.index.range(fe-w,_e-w,fe+w,_e+w);for(const ye of ge){const ie=this.crossTileIDs[ye];if(this.keys[ye]===Z&&!y.has(ie)){y.add(ie),q.crossTileID=ie;break}}}}}class ws{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ga{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(h!==0)for(const y in this.indexes){const w=this.indexes[y],S={};for(const R in w){const D=w[R];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),S[D.tileID.key]=D}this.indexes[y]=S}this.lng=a}addBucket(a,h,y){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let S=0;S<h.symbolInstances.length;S++)h.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const w=this.usedCrossTileIDs[a.overscaledZ];for(const S in this.indexes){const R=this.indexes[S];if(Number(S)>a.overscaledZ)for(const D in R){const G=R[D];G.tileID.isChildOf(a)&&G.findMatches(h.symbolInstances,a,w)}else{const D=R[a.scaledTo(Number(S)).key];D&&D.findMatches(h.symbolInstances,a,w)}}for(let S=0;S<h.symbolInstances.length;S++){const R=h.symbolInstances.get(S);R.crossTileID||(R.crossTileID=y.generate(),w.add(R.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Xr(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const y of h.crossTileIDs)this.usedCrossTileIDs[a].delete(y)}removeStaleBuckets(a){let h=!1;for(const y in this.indexes){const w=this.indexes[y];for(const S in w)a[w[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,w[S]),delete w[S],h=!0)}return h}}class Es{constructor(){this.layerIndexes={},this.crossTileIDs=new ws,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,y,w){let S=this.layerIndexes[a.id];S===void 0&&(S=this.layerIndexes[a.id]=new Ga);let R=!1;const D={};w.name!=="globe"&&S.handleWrapJump(y);for(const G of h){const q=G.getBucket(a);q&&a.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(G.tileID,q,this.crossTileIDs)&&(R=!0),D[q.bucketInstanceId]=!0)}return S.removeStaleBuckets(D)&&(R=!0),R}pruneUnusedLayers(a){const h={};a.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const Zs=(m,a)=>i.emitValidationErrors(m,a&&a.filter(h=>h.identifier!=="source.canvas")),Vc=i.pick(vr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Xs=i.pick(vr,["setCenter","setZoom","setBearing","setPitch"]),Du={version:8,layers:[],sources:{}},qs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ds extends i.Evented{constructor(a,h={}){super(),this.map=a,this.dispatcher=new Zt(Nl(),this),this.imageManager=new ht,this.imageManager.setEventedParent(this),this.glyphManager=new i.GlyphManager(a._requestManager,h.localFontFamily?i.LocalGlyphMode.all:h.localIdeographFontFamily?i.LocalGlyphMode.ideographs:i.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Es,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.getReferrer());const y=this;this._rtlTextPluginCallback=Ds.registerForPluginStateChange(w=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(S,R)=>{if(i.triggerPluginCompletionEvent(S),R&&R.every(D=>D))for(const D in y._sourceCaches){const G=y._sourceCaches[D],q=G.getSource().type;q!=="vector"&&q!=="geojson"||G.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const S=this.getSource(w.sourceId);if(S&&S.vectorLayerIds)for(const R in this._layers){const D=this._layers[R];D.source===S.id&&this._validateLayer(D)}})}loadURL(a,h={}){this.fire(new i.Event("dataloading",{dataType:"style"}));const y=typeof h.validate=="boolean"?h.validate:!i.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);const w=this.map._requestManager.transformRequest(a,i.ResourceType.Style);this._request=i.getJSON(w,(S,R)=>{this._request=null,S?this.fire(new i.ErrorEvent(S)):R&&this._load(R,y)})}loadJSON(a,h={}){this.fire(new i.Event("dataloading",{dataType:"style"})),this._request=i.exported.frame(()=>{this._request=null,this._load(a,h.validate!==!1)})}loadEmpty(){this.fire(new i.Event("dataloading",{dataType:"style"})),this._load(Du,!1)}_updateLayerCount(a,h){const y=h?1:-1;a.is3D()&&(this._num3DLayers+=y),a.type==="circle"&&(this._numCircleLayers+=y),a.type==="symbol"&&(this._numSymbolLayers+=y)}_load(a,h){if(h&&Zs(this,i.validateStyle(a)))return;this._loaded=!0,this.stylesheet=i.clone$1(a),this._updateMapProjection();for(const w in a.sources)this.addSource(w,a.sources[w],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const y=Ru(this.stylesheet.layers);this._order=y.map(w=>w.id),this._layers={},this._serializedLayers={};for(const w of y){const S=i.createStyleLayer(w);S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Bt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new i.Event("data",{dataType:"style"})),this.fire(new i.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(h,y,w){let S,R,D;const G=i.exported.devicePixelRatio>1?"@2x":"";let q=i.getJSON(y.transformRequest(y.normalizeSpriteURL(h,G,".json"),i.ResourceType.SpriteJSON),(he,fe)=>{q=null,D||(D=he,S=fe,ne())}),Z=i.getImage(y.transformRequest(y.normalizeSpriteURL(h,G,".png"),i.ResourceType.SpriteImage),(he,fe)=>{Z=null,D||(D=he,R=fe,ne())});function ne(){if(D)w(D);else if(S&&R){const he=i.exported.getImageData(R),fe={};for(const _e in S){const{width:ge,height:ye,x:ie,y:pe,sdf:we,pixelRatio:Ee,stretchX:ke,stretchY:Ue,content:Fe}=S[_e],He=new i.RGBAImage({width:ge,height:ye});i.RGBAImage.copy(he,He,{x:ie,y:pe},{x:0,y:0},{width:ge,height:ye}),fe[_e]={data:He,pixelRatio:Ee,sdf:we,stretchX:ke,stretchY:Ue,content:Fe}}w(null,fe)}}return{cancel(){q&&(q.cancel(),q=null),Z&&(Z.cancel(),Z=null)}}}(a,this.map._requestManager,(h,y)=>{if(this._spriteRequest=null,h)this.fire(new i.ErrorEvent(h));else if(y)for(const w in y)this.imageManager.addImage(w,y[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new i.Event("data",{dataType:"style"}))})}_validateLayer(a){const h=this.getSource(a.source);if(!h)return;const y=a.sourceLayer;y&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(y)===-1)&&this.fire(new i.ErrorEvent(new Error(`Source layer "${y}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const h=[];for(const y of a){const w=this._layers[y];w.type!=="custom"&&h.push(w.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&(typeof a.isLayerDraped=="function"?a.isLayerDraped():qs[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const h=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(w.length||S.length)&&this._updateWorkerLayers(w,S);for(const R in this._updatedSources){const D=this._updatedSources[R];D==="reload"?this._reloadSource(R):D==="clear"&&this._clearSource(R)}this._updateTilesForChangedImages();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const y={};for(const w in this._sourceCaches){const S=this._sourceCaches[w];y[w]=S.used,S.used=!1}for(const w of this._order){const S=this._layers[w];if(S.recalculate(a,this._availableImages),!S.isHidden(a.zoom)){const D=this._getLayerSourceCache(S);D&&(D.used=!0)}const R=this.map.painter;if(R){const D=S.getProgramIds();if(!D)continue;const G=S.getProgramConfiguration(a.zoom);for(const q of D)R.useProgram(q,G)}}for(const w in y){const S=this._sourceCaches[w];y[w]!==S.used&&S.getSource().fire(new i.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new i.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Zs(this,i.validateStyle(a)))return!1;(a=i.clone$1(a)).layers=Ru(a.layers);const h=function(w,S){if(!w)return[{command:vr.setStyle,args:[S]}];let R=[];try{if(!E(w.version,S.version))return[{command:vr.setStyle,args:[S]}];E(w.center,S.center)||R.push({command:vr.setCenter,args:[S.center]}),E(w.zoom,S.zoom)||R.push({command:vr.setZoom,args:[S.zoom]}),E(w.bearing,S.bearing)||R.push({command:vr.setBearing,args:[S.bearing]}),E(w.pitch,S.pitch)||R.push({command:vr.setPitch,args:[S.pitch]}),E(w.sprite,S.sprite)||R.push({command:vr.setSprite,args:[S.sprite]}),E(w.glyphs,S.glyphs)||R.push({command:vr.setGlyphs,args:[S.glyphs]}),E(w.transition,S.transition)||R.push({command:vr.setTransition,args:[S.transition]}),E(w.light,S.light)||R.push({command:vr.setLight,args:[S.light]}),E(w.fog,S.fog)||R.push({command:vr.setFog,args:[S.fog]}),E(w.projection,S.projection)||R.push({command:vr.setProjection,args:[S.projection]});const D={},G=[];(function(ne,he,fe,_e){let ge;for(ge in he=he||{},ne=ne||{})ne.hasOwnProperty(ge)&&(he.hasOwnProperty(ge)||yc(ge,fe,_e));for(ge in he){if(!he.hasOwnProperty(ge))continue;const ye=he[ge];ne.hasOwnProperty(ge)?E(ne[ge],ye)||(ne[ge].type==="geojson"&&ye.type==="geojson"&&Ws(ne,he,ge)?fe.push({command:vr.setGeoJSONSourceData,args:[ge,ye.data]}):Fa(ge,he,fe,_e)):_c(ge,he,fe)}})(w.sources,S.sources,G,D);const q=[];w.layers&&w.layers.forEach(ne=>{ne.source&&D[ne.source]?R.push({command:vr.removeLayer,args:[ne.id]}):q.push(ne)});let Z=w.terrain;Z&&D[Z.source]&&(R.push({command:vr.setTerrain,args:[void 0]}),Z=void 0),R=R.concat(G),E(Z,S.terrain)||R.push({command:vr.setTerrain,args:[S.terrain]}),function(ne,he,fe){he=he||[];const _e=(ne=ne||[]).map(zr),ge=he.map(zr),ye=ne.reduce(Nc,{}),ie=he.reduce(Nc,{}),pe=_e.slice(),we=Object.create(null);let Ee,ke,Ue,Fe,He,$e,it;for(Ee=0,ke=0;Ee<_e.length;Ee++)Ue=_e[Ee],ie.hasOwnProperty(Ue)?ke++:(fe.push({command:vr.removeLayer,args:[Ue]}),pe.splice(pe.indexOf(Ue,ke),1));for(Ee=0,ke=0;Ee<ge.length;Ee++)Ue=ge[ge.length-1-Ee],pe[pe.length-1-Ee]!==Ue&&(ye.hasOwnProperty(Ue)?(fe.push({command:vr.removeLayer,args:[Ue]}),pe.splice(pe.lastIndexOf(Ue,pe.length-ke),1)):ke++,$e=pe[pe.length-Ee],fe.push({command:vr.addLayer,args:[ie[Ue],$e]}),pe.splice(pe.length-Ee,0,Ue),we[Ue]=!0);for(Ee=0;Ee<ge.length;Ee++)if(Ue=ge[Ee],Fe=ye[Ue],He=ie[Ue],!we[Ue]&&!E(Fe,He))if(E(Fe.source,He.source)&&E(Fe["source-layer"],He["source-layer"])&&E(Fe.type,He.type)){for(it in Jo(Fe.layout,He.layout,fe,Ue,null,vr.setLayoutProperty),Jo(Fe.paint,He.paint,fe,Ue,null,vr.setPaintProperty),E(Fe.filter,He.filter)||fe.push({command:vr.setFilter,args:[Ue,He.filter]}),E(Fe.minzoom,He.minzoom)&&E(Fe.maxzoom,He.maxzoom)||fe.push({command:vr.setLayerZoomRange,args:[Ue,He.minzoom,He.maxzoom]}),Fe)Fe.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?Jo(Fe[it],He[it],fe,Ue,it.slice(6),vr.setPaintProperty):E(Fe[it],He[it])||fe.push({command:vr.setLayerProperty,args:[Ue,it,He[it]]}));for(it in He)He.hasOwnProperty(it)&&!Fe.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?Jo(Fe[it],He[it],fe,Ue,it.slice(6),vr.setPaintProperty):E(Fe[it],He[it])||fe.push({command:vr.setLayerProperty,args:[Ue,it,He[it]]}))}else fe.push({command:vr.removeLayer,args:[Ue]}),$e=pe[pe.lastIndexOf(Ue)+1],fe.push({command:vr.addLayer,args:[He,$e]})}(q,S.layers,R)}catch(D){console.warn("Unable to compute style diff:",D),R=[{command:vr.setStyle,args:[S]}]}return R}(this.serialize(),a).filter(w=>!(w.command in Xs));if(h.length===0)return!1;const y=h.filter(w=>!(w.command in Vc));if(y.length>0)throw new Error(`Unimplemented: ${y.map(w=>w.command).join(", ")}.`);return h.forEach(w=>{w.command!=="setTransition"&&w.command!=="setProjection"&&this[w.command].apply(this,w.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,h){return this.getImage(a)?this.fire(new i.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,h),this._afterImageUpdated(a),this)}updateImage(a,h){this.imageManager.updateImage(a,h)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new i.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,h,y={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(i.validateSource,`sources.${a}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=zn(a,h,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:w.serialize(),sourceId:a}));const S=R=>{const D=(R?"symbol:":"other:")+a,G=this._sourceCaches[D]=new i.SourceCache(D,w,R);(R?this._symbolSourceCaches:this._otherSourceCaches)[a]=G,G.style=this,G.onAdd(this.map)};S(!1),h.type!=="vector"&&h.type!=="geojson"||S(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const h=this.getSource(a);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===a)return this.fire(new i.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new i.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const y=this._getSourceCaches(a);for(const w of y)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new i.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getSource(a).setData(h),this._changed=!0}getSource(a){const h=this._getSourceCache(a);return h&&h.getSource()}_getSources(){const a=[];for(const h in this._otherSourceCaches){const y=this._getSourceCache(h);y&&a.push(y.getSource())}return a}addLayer(a,h,y={}){this._checkLoaded();const w=a.id;if(this.getLayer(w))return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let S;if(a.type==="custom"){if(Zs(this,i.validateCustomStyleLayer(a)))return;S=i.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(w,a.source),a=i.clone$1(a),a=i.extend(a,{source:w})),this._validate(i.validateLayer,`layers.${w}`,a,{arrayIndex:-1},y))return;S=i.createStyleLayer(a),this._validateLayer(S),S.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}const R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(R,0,w),this._layerOrderChanged=!0,this._layers[w]=S;const D=this._getLayerSourceCache(S);if(this._removedLayers[w]&&S.source&&D&&S.type!=="custom"){const G=this._removedLayers[w];delete this._removedLayers[w],G.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",D.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,h){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new i.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===h)return;const y=this._order.indexOf(a);this._order.splice(y,1);const w=h?this._order.indexOf(h):this._order.length;h&&w===-1?this.fire(new i.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(w,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const h=this._layers[a];if(!h)return void this.fire(new i.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const y=this._order.indexOf(a);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,y){this._checkLoaded();const w=this.getLayer(a);w?w.minzoom===h&&w.maxzoom===y||(h!=null&&(w.minzoom=h),y!=null&&(w.maxzoom=y),this._updateLayer(w)):this.fire(new i.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,h,y={}){this._checkLoaded();const w=this.getLayer(a);if(w){if(!E(w.filter,h))return h==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(i.validateFilter,`layers.${w.id}.filter`,h,{layerType:w.type},y)||(w.filter=i.clone$1(h),this._updateLayer(w)))}else this.fire(new i.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const h=this.getLayer(a);return h&&i.clone$1(h.filter)}setLayoutProperty(a,h,y,w={}){this._checkLoaded();const S=this.getLayer(a);S?E(S.getLayoutProperty(h),y)||(S.setLayoutProperty(h,y,w),this._updateLayer(S)):this.fire(new i.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,h){const y=this.getLayer(a);if(y)return y.getLayoutProperty(h);this.fire(new i.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,h,y,w={}){this._checkLoaded();const S=this.getLayer(a);S?E(S.getPaintProperty(h),y)||(S.setPaintProperty(h,y,w)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new i.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,h){const y=this.getLayer(a);return y&&y.getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();const y=a.source,w=a.sourceLayer,S=this.getSource(y);if(!S)return void this.fire(new i.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const R=S.type;if(R==="geojson"&&w)return void this.fire(new i.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(R==="vector"&&!w)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided.")));const D=this._getSourceCaches(y);for(const G of D)G.setFeatureState(w,a.id,h)}removeFeatureState(a,h){this._checkLoaded();const y=a.source,w=this.getSource(y);if(!w)return void this.fire(new i.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const S=w.type,R=S==="vector"?a.sourceLayer:void 0;if(S==="vector"&&!R)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new i.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const D=this._getSourceCaches(y);for(const G of D)G.removeFeatureState(R,a.id,h)}getFeatureState(a){this._checkLoaded();const h=a.source,y=a.sourceLayer,w=this.getSource(h);if(w){if(w.type!=="vector"||y)return a.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(y,a.id);this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new i.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return i.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const h in this._sourceCaches){const y=this._sourceCaches[h].getSource();a[y.id]||(a[y.id]=y.serialize())}return i.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0;const h=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",h.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const h=R=>this._layers[R].type==="fill-extrusion",y={},w=[];for(let R=this._order.length-1;R>=0;R--){const D=this._order[R];if(h(D)){y[D]=R;for(const G of a){const q=G[D];if(q)for(const Z of q)w.push(Z)}}}w.sort((R,D)=>D.intersectionZ-R.intersectionZ);const S=[];for(let R=this._order.length-1;R>=0;R--){const D=this._order[R];if(h(D))for(let G=w.length-1;G>=0;G--){const q=w[G].feature;if(y[q.layer.id]<R)break;S.push(q),w.pop()}else for(const G of a){const q=G[D];if(q)for(const Z of q)S.push(Z.feature)}}return S}queryRenderedFeatures(a,h,y){h&&h.filter&&this._validate(i.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const w={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new i.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const G of h.layers){const q=this._layers[G];if(!q)return this.fire(new i.ErrorEvent(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];w[q.source]=!0}}const S=[];h.availableImages=this._availableImages;const R=h&&h.layers?h.layers.some(G=>{const q=this.getLayer(G);return q&&q.is3D()}):this.has3DLayers(),D=yn.createFromScreenPoints(a,y);for(const G in this._sourceCaches){const q=this._sourceCaches[G].getSource().id;h.layers&&!w[q]||S.push(Yr(this._sourceCaches[G],this._layers,this._serializedLayers,D,h,y,R,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(G,q,Z,ne,he,fe,_e){const ge={},ye=fe.queryRenderedSymbols(ne),ie=[];for(const pe of Object.keys(ye).map(Number))ie.push(_e[pe]);ie.sort(Wi);for(const pe of ie){const we=pe.featureIndex.lookupSymbolFeatures(ye[pe.bucketInstanceId],q,pe.bucketIndex,pe.sourceLayerIndex,he.filter,he.layers,he.availableImages,G);for(const Ee in we){const ke=ge[Ee]=ge[Ee]||[],Ue=we[Ee];Ue.sort((Fe,He)=>{const $e=pe.featureSortOrder;if($e){const it=$e.indexOf(Fe.featureIndex);return $e.indexOf(He.featureIndex)-it}return He.featureIndex-Fe.featureIndex});for(const Fe of Ue)ke.push(Fe)}}for(const pe in ge)ge[pe].forEach(we=>{const Ee=we.feature,ke=Z(G[pe]);if(!ke)return;const Ue=ke.getFeatureState(Ee.layer["source-layer"],Ee.id);Ee.source=Ee.layer.source,Ee.layer["source-layer"]&&(Ee.sourceLayer=Ee.layer["source-layer"]),Ee.state=Ue});return ge}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),D.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(a,h){h&&h.filter&&this._validate(i.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const y=this._getSourceCaches(a);let w=[];for(const S of y)w=w.concat(yi(S,h));return w}addSourceType(a,h,y){return Ds.getSourceType(a)?y(new Error(`A source type called "${a}" already exists.`)):(Ds.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},y):y(null,null))}getLight(){return this.light.getLight()}setLight(a,h={}){this._checkLoaded();const y=this.light.getLight();let w=!1;for(const R in a)if(!E(a[R],y[R])){w=!0;break}if(!w)return;const S=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,h),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,h=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let y=a;if(h===1){if(typeof y.source=="object"){const w="terrain-dem-src";this.addSource(w,y.source),y=i.clone$1(y),y=i.extend(y,{source:w})}if(this._validate(i.validateTerrain,"terrain",y))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,h)}else{const w=this.terrain,S=w.get();for(const R of Object.keys(i.spec.terrain))!y.hasOwnProperty(R)&&i.spec.terrain[R].default&&(y[R]=i.spec.terrain[R].default);for(const R in y)if(!E(y[R],S[R])){w.set(y),this.stylesheet.terrain=y;const D=this._setTransitionParameters({duration:0});w.updateTransitions(D);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const h=this.fog=new $t(a,this.map.transform);this.stylesheet.fog=a;const y=this._setTransitionParameters({duration:0});h.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,y=h.get();Object.keys(a).length===0&&h.set(a);for(const w in a)if(!E(a[w],y[w])){h.set(a),this.stylesheet.fog=a;const S=this._setTransitionParameters({duration:0});h.updateTransitions(S);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:i.exported.now(),transition:i.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(y=>this.isLayerDraped(this._layers[y])),h=this._order.filter(y=>!this.isLayerDraped(this._layers[y]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){const y=this.terrain=new Gt(a,h);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});y.updateTransitions(w)}_force3DLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="symbol"&&this._updateLayer(h)}}_validate(a,h,y,w,S={}){return(!S||S.validate!==!1)&&Zs(this,a.call(i.validateStyle,i.extend({key:h,style:this.serialize(),value:y,styleSpec:i.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const h=this._getSourceCaches(a);for(const y of h)y.clearTiles()}_reloadSource(a){const h=this._getSourceCaches(a);for(const y of h)y.resume(),y.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const h in this._sourceCaches)this._sourceCaches[h].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,y,w,S=!1){let R=!1,D=!1;const G={};for(const q of this._order){const Z=this._layers[q];if(Z.type!=="symbol")continue;if(!G[Z.source]){const he=this._getLayerSourceCache(Z);if(!he)continue;G[Z.source]=he.getRenderableIds(!0).map(fe=>he.getTileByID(fe)).sort((fe,_e)=>_e.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(_e.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer(Z,G[Z.source],a.center.lng,a.projection);R=R||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),S=S||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new i.Event("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.exported.now(),a.zoom))&&(this.pauseablePlacement=new Rs(a,this._order,S,h,y,w,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.exported.now()),D=!0),R&&this.pauseablePlacement.placement.setStale()),D||R)for(const q of this._order){const Z=this._layers[q];Z.type==="symbol"&&this.placement.updateLayerOpacities(Z,G[Z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,h,y){this.imageManager.getImages(h.icons,y),this._updateTilesForChangedImages();const w=S=>{S&&S.setDependencies(h.tileID.key,h.type,h.icons)};w(this._otherSourceCaches[h.source]),w(this._symbolSourceCaches[h.source])}getGlyphs(a,h,y){this.glyphManager.getGlyphs(h.stacks,y)}getResource(a,h,y){return i.makeRequest(h,y)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){const h=this._getSourceCaches(a);return h.length===0?(this.fire(new i.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):h.every(y=>y.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ds.getSourceType=function(m){return Fn[m]},Ds.setSourceType=function(m,a){Fn[m]=a},Ds.registerForPluginStateChange=i.registerForPluginStateChange;var ts=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Ks="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Cs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,ds=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,fs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let xl={},Co={};const Va=[];ns(ts,Va),ns(Cs,Va),ns(ds,Va),ns(fs,Va),xl=fr("",Cs),Co=fr(fs,ds);const vc=fr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),_a=ts,Fo=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var jo={background:fr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:fr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:fr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:fr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:fr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:fr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:fr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:fr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:fr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:fr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:fr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:fr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:fr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:fr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ks),skyboxGradient:fr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ks),skyboxCapture:fr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ns(m,a){const h=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of h)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=y.split(" ");for(const S of w)a.includes(S)||a.push(S)}}function fr(m,a){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w={},S=[...Va];return ns(m,S),ns(a,S),{fragmentSource:m=m.replace(h,(R,D,G,q,Z)=>(w[Z]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
varying ${G} ${q} ${Z};
#else
uniform ${G} ${q} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${G} ${q} ${Z} = u_${Z};
#endif
`)),vertexSource:a=a.replace(h,(R,D,G,q,Z)=>{const ne=q==="float"?"vec2":"vec4",he=Z.match(/color/)?"color":ne;return w[Z]?D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${G} ${ne} a_${Z};
varying ${G} ${q} ${Z};
#else
uniform ${G} ${q} u_${Z};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${G} ${q} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${he}(a_${Z}, u_${Z}_t);
#else
    ${G} ${q} ${Z} = u_${Z};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${G} ${ne} a_${Z};
#else
uniform ${G} ${q} u_${Z};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${G} ${q} ${Z} = a_${Z};
#else
    ${G} ${q} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${G} ${q} ${Z} = unpack_mix_${he}(a_${Z}, u_${Z}_t);
#else
    ${G} ${q} ${Z} = u_${Z};
#endif
`}),staticAttributes:y,usedDefines:S}}class mh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,h,y,w,S,R,D){this.context=a;let G=this.boundPaintVertexBuffers.length!==w.length;for(let Z=0;!G&&Z<w.length;Z++)this.boundPaintVertexBuffers[Z]!==w[Z]&&(G=!0);let q=this.boundDynamicVertexBuffers.length!==D.length;for(let Z=0;!q&&Z<D.length;Z++)this.boundDynamicVertexBuffers[Z]!==D[Z]&&(q=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||G||q||this.boundIndexBuffer!==S||this.boundVertexOffset!==R)this.freshBind(h,y,w,S,R,D);else{a.bindVertexArrayOES.set(this.vao);for(const Z of D)Z&&Z.bind();S&&S.dynamicDraw&&S.bind()}}freshBind(a,h,y,w,S,R){let D;const G=a.numAttributes,q=this.context,Z=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=w,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=R;else{D=q.currentNumAttributes||0;for(let ne=G;ne<D;ne++)Z.disableVertexAttribArray(ne)}h.enableAttributes(Z,a),h.bind(),h.setVertexAttribPointers(Z,a,S);for(const ne of y)ne.enableAttributes(Z,a),ne.bind(),ne.setVertexAttribPointers(Z,a,S);for(const ne of R)ne&&(ne.enableAttributes(Z,a),ne.bind(),ne.setVertexAttribPointers(Z,a,S));w&&w.bind(),q.currentNumAttributes=G}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function io(m,a){const h=Math.pow(2,a.canonical.z),y=a.canonical.y;return[new i.MercatorCoordinate(0,y/h).toLngLat().lat,new i.MercatorCoordinate(0,(y+1)/h).toLngLat().lat]}function Js(m,a,h,y,w,S,R){const D=m.context,G=D.gl,q=h.fbo;if(!q)return;m.prepareDrawTile();const Z=m.useProgram("hillshade");D.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,q.colorAttachment.get());const ne=((ge,ye,ie,pe)=>{const we=ie.paint.get("hillshade-shadow-color"),Ee=ie.paint.get("hillshade-highlight-color"),ke=ie.paint.get("hillshade-accent-color");let Ue=ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);ie.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ue-=ge.transform.angle);const Fe=!ge.options.moving;return{u_matrix:pe||ge.transform.calculateProjMatrix(ye.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:io(0,ye.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Ue],u_shadow:we,u_highlight:Ee,u_accent:ke}})(m,h,y,m.terrain?a.projMatrix:null);m.prepareDrawProgram(D,Z,a.toUnwrapped());const{tileBoundsBuffer:he,tileBoundsIndexBuffer:fe,tileBoundsSegments:_e}=m.getTileBoundsBuffers(h);Z.draw(D,G.TRIANGLES,w,S,R,i.CullFaceMode.disabled,ne,y.id,he,fe,_e)}function Vl(m,a,h){if(!a.needsDEMTextureUpload)return;const y=m.context,w=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(h.stride);const S=h.getPixels();a.demTexture?a.demTexture.update(S,{premultiply:!1}):a.demTexture=new i.Texture(y,S,w.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Ou(m,a,h,y,w,S){const R=m.context,D=R.gl;if(!a.dem)return;const G=a.dem;if(R.activeTexture.set(D.TEXTURE1),Vl(m,a,G),!a.demTexture)return;a.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);const q=G.dim;R.activeTexture.set(D.TEXTURE0);let Z=a.fbo;if(!Z){const _e=new i.Texture(R,{width:q,height:q,data:null},D.RGBA);_e.bind(D.LINEAR,D.CLAMP_TO_EDGE),Z=a.fbo=R.createFramebuffer(q,q,!0),Z.colorAttachment.set(_e.texture)}R.bindFramebuffer.set(Z.framebuffer),R.viewport.set([0,0,q,q]);const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:he,tileBoundsSegments:fe}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(R,D.TRIANGLES,y,w,S,i.CullFaceMode.disabled,((_e,ge)=>{const ye=ge.stride,ie=i.create();return i.ortho(ie,0,i.EXTENT,-i.EXTENT,0,0,1),i.translate(ie,ie,[0,-i.EXTENT,0]),{u_matrix:ie,u_image:1,u_dimension:[ye,ye],u_zoom:_e.overscaledZ,u_unpack:ge.unpackVector}})(a.tileID,G),h.id,ne,he,fe),a.needsHillshadePrepare=!1}const $a=m=>({u_matrix:new i.UniformMatrix4f(m),u_image0:new i.Uniform1i(m),u_skirt_height:new i.Uniform1f(m)}),Os=(m,a)=>({u_matrix:m,u_image0:0,u_skirt_height:a}),bl=(m,a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:S,u_image0:0,u_frustum_tl:R,u_frustum_tr:D,u_frustum_br:G,u_frustum_bl:q,u_globe_pos:Z,u_globe_radius:ne,u_viewport:he,u_grid_matrix:_e?Float32Array.from(_e):new Float32Array(9),u_skirt_height:fe});function Ys(m,a){return m!=null&&a!=null&&!(!m.hasData()||!a.hasData())&&m.demTexture!=null&&a.demTexture!=null&&m.tileID.key!==a.tileID.key}const rs=new class{constructor(){this.operations={}}newMorphing(m,a,h,y,w){if(m in this.operations){const S=this.operations[m];S.to.tileID.key!==h.tileID.key&&(S.queued=h)}else this.operations[m]={startTime:y,phase:0,duration:w,from:a,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const h=this.operations[a];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},As={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function xc(m){return 6*Math.pow(1.5,22-m)}function ku(m,a){const h=1<<m.z;return!a&&(m.x===0||m.x===h-1)||m.y===0||m.y===h-1}const wl=m=>({u_matrix:m});function Ha(m,a,h,y,w){if(w>0){const S=i.exported.now(),R=(S-m.timeAdded)/w,D=a?(S-a.timeAdded)/w:-1,G=h.getSource(),q=y.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),Z=!a||Math.abs(a.tileID.overscaledZ-q)>Math.abs(m.tileID.overscaledZ-q),ne=Z&&m.refreshedUponExpiration?1:i.clamp(Z?R:1-D,0,1);return m.refreshedUponExpiration&&R>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ne}:{opacity:ne,mix:0}}return{opacity:1,mix:0}}class Wa extends i.SourceCache{constructor(a){const h={type:"raster-dem",maxzoom:a.transform.maxZoom},y=new Zt(Nl(),null),w=zn("mock-dem",h,y,a.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class Za extends i.SourceCache{constructor(a){const h=zn("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new Zt(Nl(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,y){if(a.freezeTileCoverage)return;this.transform=a;const w=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,R)=>{if(S[R.key]="",!this._tiles[R.key]){const D=new i.Tile(R,this._source.tileSize*R.overscaleFactor(),a.tileZoom);D.state="loaded",this._tiles[R.key]=D}return S},{});for(const S in this._tiles)S in w||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(a){const h=this.proxyCachedFBO[a];if(h!==void 0){const y=Object.values(h);this.renderCachePool.push(...y),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ya extends i.OverscaledTileID{constructor(a,h,y){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=y}}class Fi extends i.Elevation{constructor(a,h){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,w,S]=function(G){const q=new i.StructArrayLayout2i4,Z=new i.StructArrayLayout3ui6,ne=131;q.reserve(17161),Z.reserve(33800);const he=i.EXTENT/128,fe=i.EXTENT+he/2,_e=fe+he;for(let ye=-he;ye<_e;ye+=he)for(let ie=-he;ie<_e;ie+=he){const pe=ie<0||ie>fe||ye<0||ye>fe?24575:0,we=i.clamp(Math.round(ie),0,i.EXTENT),Ee=i.clamp(Math.round(ye),0,i.EXTENT);q.emplaceBack(we+pe,Ee)}const ge=(ye,ie)=>{const pe=ie*ne+ye;Z.emplaceBack(pe+1,pe,pe+ne),Z.emplaceBack(pe+ne,pe+ne+1,pe+1)};for(let ye=1;ye<129;ye++)for(let ie=1;ie<129;ie++)ge(ie,ye);return[0,129].forEach(ye=>{for(let ie=0;ie<130;ie++)ge(ie,ye),ge(ye,ie)}),[q,Z,32768]}(),R=a.context;this.gridBuffer=R.createVertexBuffer(y,i.posAttributes.members),this.gridIndexBuffer=R.createIndexBuffer(w),this.gridSegments=i.SegmentVector.simpleSegment(0,0,y.length,w.length),this.gridNoSkirtSegments=i.SegmentVector.simpleSegment(0,0,y.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Za(h.map),this.orthoMatrix=i.create(),i.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.EXTENT,0,i.EXTENT,0,1);const D=R.gl;this._overlapStencilMode=new i.StencilMode({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Wa(h.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,h,y){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const w=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const S=()=>{this.sourceCache.used&&i.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const R=this.getScaledDemTileSize();this.sourceCache.update(h,R,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,S(),this._initializing=!0),S(),h.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&i.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(G=>{const q=h.getTileByID(G).tileID;return q.projMatrix=y.calculateProjMatrix(q.toUnwrapped()),q});(function(G,q){const Z=q.transform.pointCoordinate(q.transform.getCameraPoint()),ne=new i.Point(Z.x,Z.y);G.sort((he,fe)=>{if(fe.overscaledZ-he.overscaledZ)return fe.overscaledZ-he.overscaledZ;const _e=new i.Point(he.canonical.x+(1<<he.canonical.z)*he.wrap,he.canonical.y),ge=new i.Point(fe.canonical.x+(1<<fe.canonical.z)*fe.wrap,fe.canonical.y),ye=ne.mult(1<<he.canonical.z);return ye.x-=.5,ye.y-=.5,ye.distSqr(_e)-ye.distSqr(ge)})})(w,this.painter),this._previousZoom=y.zoom;const S=this.proxyToSource||{};this.proxyToSource={},w.forEach(G=>{this.proxyToSource[G.key]={}}),this.terrainTileForTile={};const R=this._style._sourceCaches;for(const G in R){const q=R[G];if(!q.used||(q!==this.sourceCache&&this.resetTileLookupCache(q.id),this._setupProxiedCoordsForOrtho(q,a[G],S),q.usedForTerrain))continue;const Z=a[G];q.getSource().reparseOverscaled&&this._assignTerrainTiles(Z)}this.proxiedCoords[h.id]=w.map(G=>new ya(G,G.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1,this._updateTimestamp=i.exported.now();const D={};this._visibleDemTiles=[];for(const G of this.proxyCoords){const q=this.terrainTileForTile[G.key];if(!q)continue;const Z=q.tileID.key;Z in D||(this._visibleDemTiles.push(q),D[Z]=Z)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;const y=this._findTileCoveringTileID(h,this.sourceCache);y&&(this.terrainTileForTile[h.key]=y)})}_prepareDEMTextures(){const a=this.painter.context,h=a.gl;for(const y in this.terrainTileForTile){const w=this.terrainTileForTile[y],S=w.dem;!S||w.demTexture&&!w.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),Vl(this.painter,w,S))}}_prepareDemTileUniforms(a,h,y,w){if(!h||h.demTexture==null)return!1;const S=a.tileID.canonical,R=Math.pow(2,h.tileID.canonical.z-S.z),D=w||"";return y[`u_dem_tl${D}`]=[S.x*R%1,S.y*R%1],y[`u_dem_scale${D}`]=R,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,h=a.gl;if(!this._emptyDepthBufferTexture){const y=new i.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.Texture(a,y,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const h=this._visibleDemTiles.reduce((y,w)=>{if(!w.dem)return y;const S=w.dem.tree.minimums[0];return S>0&&a++,y+S},0);return a?h/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);const y=this._getLoadedAreaMinimum(),w=new i.RGBAImage({width:1,height:1},new Uint8Array(i.DEMData.pack(y,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(w,{premultiply:!1}):S=this._emptyDEMTexture=new i.Texture(a,w,h.RGBA,{premultiply:!1}),S}setupElevationDraw(a,h,y){const w=this.painter.context,S=w.gl,R=(D=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:i.DEMData.getUnpackVector(D),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var D;R.u_dem_size=this.sourceCache.getSource().tileSize,R.u_exaggeration=this.exaggeration();let G=null,q=null,Z=1;if(y&&y.morphing&&this._useVertexMorphing){const ne=y.morphing.srcDemTile,he=y.morphing.dstDemTile;Z=y.morphing.phase,ne&&he&&(this._prepareDemTileUniforms(a,ne,R,"_prev")&&(q=ne),this._prepareDemTileUniforms(a,he,R)&&(G=he))}if(q&&G?(w.activeTexture.set(S.TEXTURE2),G.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),w.activeTexture.set(S.TEXTURE4),q.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),R.u_dem_lerp=Z):(G=this.terrainTileForTile[a.tileID.key],w.activeTexture.set(S.TEXTURE2),(this._prepareDemTileUniforms(a,G,R)?G.demTexture:this.emptyDEMTexture).bind(S.NEAREST,S.CLAMP_TO_EDGE)),w.activeTexture.set(S.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(R.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),R.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&G){const ne=(1<<G.tileID.canonical.z)*i.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;R.u_meter_to_dem=ne}if(y&&y.labelPlaneMatrixInv&&(R.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),h.setTerrainUniformValues(w,R),this.painter.transform.projection.name==="globe"){const ne=this.globeUniformValues(this.painter.transform,a.tileID.canonical,y&&y.useDenormalizedUpVectorScale);h.setGlobeUniformValues(w,ne)}}globeUniformValues(a,h,y){const w=a.projection;return{u_tile_tl_up:w.upVector(h,0,0),u_tile_tr_up:w.upVector(h,i.EXTENT,0),u_tile_br_up:w.upVector(h,i.EXTENT,i.EXTENT),u_tile_bl_up:w.upVector(h,0,i.EXTENT),u_tile_up_scale:y?i.globeMetersToEcef(1):w.upVectorScale(h,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const h=this.painter,y=this.painter.context;a.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,S,R,D,G){if(w.transform.projection.name==="globe")(function(q,Z,ne,he,fe){const _e=q.context,ge=_e.gl;let ye,ie;const pe=q.options.showTerrainWireframe?2:0,we=q.transform,Ee=i.globeUseCustomAntiAliasing(q,_e,we),ke=(Lt,tt)=>{if(ie===Lt)return;const mt=[As[Lt],"PROJECTION_GLOBE_VIEW"];Ee&&mt.push("CUSTOM_ANTIALIASING"),tt&&mt.push(As[pe]),ye=q.useProgram("globeRaster",null,mt),ie=Lt},Ue=q.colorModeForRenderPass(),Fe=new i.DepthMode(ge.LEQUAL,i.DepthMode.ReadWrite,q.depthRangeFor3D);rs.update(fe);const He=i.calculateGlobeMercatorMatrix(we),$e=[i.mercatorXfromLng(we.center.lng),i.mercatorYfromLat(we.center.lat)],it=pe?[!1,!0]:[!1],Pt=q.globeSharedBuffers,Qe=[we.width*i.exported.devicePixelRatio,we.height*i.exported.devicePixelRatio],gt=Float32Array.from(we.globeMatrix),st={useDenormalizedUpVectorScale:!0};if(it.forEach(Lt=>{const tt=q.transform,mt=xc(tt.zoom)*Z.exaggeration();ie=-1;const xt=Lt?ge.LINES:ge.TRIANGLES;for(const at of he){const Et=ne.getTile(at),rn=i.StencilMode.disabled,fn=Z.prevTerrainTileForTile[at.key],qt=Z.terrainTileForTile[at.key];Ys(fn,qt)&&rs.newMorphing(at.key,fn,qt,fe,250),_e.activeTexture.set(ge.TEXTURE0),Et.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const gn=rs.getMorphValuesForProxy(at.key),An=gn?1:0;gn&&i.extend$1(st,{morphing:{srcDemTile:gn.from,dstDemTile:gn.to,phase:i.easeCubicInOut(gn.phase)}});const Nn=i.tileCornersToBounds(at.canonical),un=i.getLatitudinalLod(Nn.getCenter().lat),xr=i.getGridMatrix(at.canonical,Nn,un,tt.worldSize/tt._pixelsPerMercatorPixel),Or=i.globeNormalizeECEF(i.globeTileBounds(at.canonical)),Cr=bl(tt.projMatrix,gt,He,Or,i.globeToMercatorTransition(tt.zoom),$e,tt.frustumCorners.TL,tt.frustumCorners.TR,tt.frustumCorners.BR,tt.frustumCorners.BL,tt.globeCenterInViewSpace,tt.globeRadius,Qe,mt,xr);if(ke(An,Lt),Z.setupElevationDraw(Et,ye,st),q.prepareDrawProgram(_e,ye,at.toUnwrapped()),Pt){const[or,Mo,to]=Lt?Pt.getWirefameBuffers(q.context,un):Pt.getGridBuffers(un,mt!==0);ye.draw(_e,xt,Fe,rn,Ue,i.CullFaceMode.backCCW,Cr,"globe_raster",or,Mo,to)}}}),Pt){const Lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ee&&Lt.push("CUSTOM_ANTIALIASING"),ye=q.useProgram("globeRaster",null,Lt);for(const tt of he){const{x:mt,y:xt,z:at}=tt.canonical,Et=xt===0,rn=xt===(1<<at)-1,[fn,qt,gn,An]=Pt.getPoleBuffers(at);if(An&&(Et||rn)){const Nn=ne.getTile(tt);_e.activeTexture.set(ge.TEXTURE0),Nn.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);let un=i.globePoleMatrixForTile(at,mt,we);const xr=i.globeNormalizeECEF(i.globeTileBounds(tt.canonical)),Or=(Cr,or)=>Cr.draw(_e,ge.TRIANGLES,Fe,i.StencilMode.disabled,Ue,i.CullFaceMode.disabled,bl(we.projMatrix,un,un,xr,0,$e,we.frustumCorners.TL,we.frustumCorners.TR,we.frustumCorners.BR,we.frustumCorners.BL,we.globeCenterInViewSpace,we.globeRadius,Qe,0),"globe_pole_raster",or,gn,An);Z.setupElevationDraw(Nn,ye,st),q.prepareDrawProgram(_e,ye,tt.toUnwrapped()),Et&&Or(ye,fn),rn&&(un=i.scale(i.create(),un,[1,-1,1]),Or(ye,qt))}}}})(w,S,R,D,G);else{const q=w.context,Z=q.gl;let ne,he;const fe=w.options.showTerrainWireframe?2:0,_e=(we,Ee)=>{if(he===we)return;const ke=[As[we]];Ee&&ke.push(As[fe]),ne=w.useProgram("terrainRaster",null,ke),he=we},ge=w.colorModeForRenderPass(),ye=new i.DepthMode(Z.LEQUAL,i.DepthMode.ReadWrite,w.depthRangeFor3D);rs.update(G);const ie=w.transform,pe=xc(ie.zoom)*S.exaggeration();(fe?[!1,!0]:[!1]).forEach(we=>{he=-1;const Ee=we?Z.LINES:Z.TRIANGLES,[ke,Ue]=we?S.getWirefameBuffer():[S.gridIndexBuffer,S.gridSegments];for(const Fe of D){const He=R.getTile(Fe),$e=i.StencilMode.disabled,it=S.prevTerrainTileForTile[Fe.key],Pt=S.terrainTileForTile[Fe.key];Ys(it,Pt)&&rs.newMorphing(Fe.key,it,Pt,G,250),q.activeTexture.set(Z.TEXTURE0),He.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST);const Qe=rs.getMorphValuesForProxy(Fe.key),gt=Qe?1:0;let st;Qe&&(st={morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:i.easeCubicInOut(Qe.phase)}});const Lt=Os(Fe.projMatrix,ku(Fe.canonical,ie.renderWorldCopies)?pe/10:pe);_e(gt,we),S.setupElevationDraw(He,ne,st),w.prepareDrawProgram(q,ne,Fe.toUnwrapped()),ne.draw(q,Ee,ye,$e,ge,i.CullFaceMode.backCCW,Lt,"terrain_raster",S.gridBuffer,ke,Ue)}})}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const h=this.painter,y=this.painter.context,w=this.proxySourceCache,S=this.proxiedCoords[w.id],R=this._drapedRenderBatches.shift(),D=[],G=h.style.order;let q=0;for(const Z of S){const ne=w.getTileByID(Z.proxyTileKey),he=w.proxyCachedFBO[Z.key]?w.proxyCachedFBO[Z.key][a]:void 0,fe=he!==void 0?w.renderCache[he]:this.pool[q++],_e=he!==void 0;if(ne.texture=fe.tex,_e&&!fe.dirty){D.push(ne.tileID);continue}let ge;y.bindFramebuffer.set(fe.fb.framebuffer),this.renderedToTile=!1,fe.dirty&&(y.clear({color:i.Color.transparent,stencil:0}),fe.dirty=!1);for(let ye=R.start;ye<=R.end;++ye){const ie=h.style._layers[G[ye]];if(ie.isHidden(h.transform.zoom))continue;const pe=h.style._getLayerSourceCache(ie),we=pe?this.proxyToSource[Z.key][pe.id]:[Z];if(!we)continue;const Ee=we;y.viewport.set([0,0,fe.fb.width,fe.fb.height]),ge!==(pe?pe.id:null)&&(this._setupStencil(fe,we,ie,pe),ge=pe?pe.id:null),h.renderLayer(h,pe,ie,Ee)}this.renderedToTile?(fe.dirty=!0,D.push(ne.tileID)):_e||--q,q===5&&(q=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),R.end+1}postRender(){}renderCacheEfficiency(a){const h=a.order.length;if(h===0)return{efficiency:100};let y,w=0,S=0,R=!1;for(let D=0;D<h;++D){const G=a._layers[a.order[D]];this._style.isLayerDraped(G)?(R&&++w,++S):R||(R=!0,y=G.id)}return S===0?{efficiency:100}:{efficiency:100*(1-w/S),firstUndrapedLayer:y}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,h,y){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const R=S.tileID,D=1<<R.overscaledZ,{x:G,y:q}=R.canonical,Z=G/D,ne=(G+1)/D,he=q/D,fe=(q+1)/D;return{minx:Z,miny:he,maxx:ne,maxy:fe,t:S.dem.tree.raycastRoot(Z,he,ne,fe,a,h,y),tile:S}});w.sort((S,R)=>(S.t!==null?S.t:Number.MAX_VALUE)-(R.t!==null?R.t:Number.MAX_VALUE));for(const S of w){if(S.t==null)return null;const R=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,a,h,y);if(R!=null)return R}return null}_createFBO(){const a=this.painter.context,h=a.gl,y=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);const w=new i.Texture(a,{width:y[0],height:y[1],data:null},h.RGBA);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const S=a.createFramebuffer(y[0],y[1],!1);return S.colorAttachment.set(w.texture),S.depthAttachment=new Ve(a,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:S,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const h=this._style._layers[a],y=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!y&&h.shouldRedrape():!y&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const y of this._style._getSources())if(y instanceof jt){a=!0;break}if(!a)return;const h={};for(let y=0;y<this._style.order.length;++y){const w=this._style._layers[this._style.order[y]],S=this._style._getLayerSourceCache(w);if(S&&!h[S.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof i.ZoomDependentExpression){h[S.id]=!0;for(const R of this.proxyCoords){const D=this.proxyToSource[R.key][S.id];if(D)for(const G of D)this._clearRenderCacheForTile(S.id,G)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const y in this._style._sourceCaches)if(this._style._sourceCaches[y]._source instanceof Dt){a=!0;break}if(!a)return;const h={};for(let y=0;y<this._style.order.length;++y){const w=this._style._layers[this._style.order[y]],S=this._style._getLayerSourceCache(w);if(!S||h[S.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const R=w.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const G=this.proxyToSource[D.key][S.id];if(G)for(const q of G){const Z=Ha(S.getTile(q),S.findLoadedParent(q,0),S,this.painter.transform,R);(Z.opacity!==1||Z.mix!==0)&&this._clearRenderCacheForTile(S.id,q)}}}}_setupDrapedRenderBatches(){const a=this._style.order,h=a.length;if(h===0)return;const y=[];let w,S=0,R=this._style._layers[a[S]];for(;!this._style.isLayerDraped(R)&&R.isHidden(this.painter.transform.zoom)&&++S<h;)R=this._style._layers[a[S]];for(;S<h;++S){const D=this._style._layers[a[S]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?w===void 0&&(w=S):w!==void 0&&(y.push({start:w,end:S-1}),w=void 0))}w!==void 0&&y.push({start:w,end:S-1}),this._drapedRenderBatches=y}_setupRenderCache(a){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const R=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let D=0;D<R.length;++D){const G=Object.values(R[D]);h.renderCachePool.push(...G)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,w=this._tilesDirty;for(let R=y.length-1;R>=0;R--){const D=y[R];if(h.getTileByID(D.key),h.proxyCachedFBO[D.key]!==void 0){const G=a[D.key],q=this.proxyToSource[D.key];let Z=0;for(const ne in q){const he=q[ne],fe=G[ne];if(!fe||fe.length!==he.length||he.some((_e,ge)=>_e!==fe[ge]||w[ne]&&w[ne].hasOwnProperty(_e.key))){Z=-1;break}++Z}for(const ne in h.proxyCachedFBO[D.key])h.renderCache[h.proxyCachedFBO[D.key][ne]].dirty=Z<0||Z!==Object.values(G).length}}const S=[...this._drapedRenderBatches];S.sort((R,D)=>D.end-D.start-(R.end-R.start));for(const R of S)for(const D of y){if(h.proxyCachedFBO[D.key])continue;let G=h.renderCachePool.pop();G===void 0&&h.renderCache.length<50&&(G=h.renderCache.length,h.renderCache.push(this._createFBO())),G!==void 0&&(h.proxyCachedFBO[D.key]={},h.proxyCachedFBO[D.key][R.start]=G,h.renderCache[G].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,y,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,R=S.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let D;if(y.isTileClipped())D=h.length,this._overlapStencilMode.test={func:R.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:R.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):i.StencilMode.disabled}_renderTileClippingMasks(a,h){const y=this.painter,w=this.painter.context,S=w.gl;y._tileClippingMaskIDs={},w.setColorMode(i.ColorMode.disabled),w.setDepthMode(i.DepthMode.disabled);const R=y.useProgram("clippingMask");for(const D of a){const G=y._tileClippingMaskIDs[D.key]=--h;R.draw(w,S.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:S.ALWAYS,mask:0},G,255,S.KEEP,S.KEEP,S.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,wl(D.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(a){const h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;const y=[a.x,a.y,1,1];i.transformMat4$1(y,y,h.pixelMatrixInverse),i.scale$1(y,y,1/y[3]),y[0]/=h.worldSize,y[1]/=h.worldSize;const w=h._camera.position,S=i.mercatorZfromAltitude(1,h.center.lat),R=[w[0],w[1],w[2]/S,0],D=i.subtract([],y.slice(0,3),R);i.normalize(D,D);const G=this.raycast(R,D,this._exaggeration);return G!==null&&G?(i.scaleAndAdd(R,R,D,G),R[3]=R[2],R[2]*=S,R):null}drawDepth(){const a=this.painter,h=a.context,y=this.proxySourceCache,w=Math.ceil(a.width),S=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const R=h.gl,D=h.createFramebuffer(w,S,!0);h.activeTexture.set(R.TEXTURE0);const G=new i.Texture(h,{width:w,height:S,data:null},R.RGBA);G.bind(R.NEAREST,R.CLAMP_TO_EDGE),D.colorAttachment.set(G.texture);const q=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,w,S);D.depthAttachment.set(q),this._depthFBO=D,this._depthTexture=G}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,w,S]),function(R,D,G,q){if(R.transform.projection.name==="globe")return;const Z=R.context,ne=Z.gl;Z.clear({depth:1});const he=R.useProgram("terrainDepth"),fe=new i.DepthMode(ne.LESS,i.DepthMode.ReadWrite,R.depthRangeFor3D);for(const _e of q){const ge=G.getTile(_e),ye=Os(_e.projMatrix,0);D.setupElevationDraw(ge,he),he.draw(Z,ne.TRIANGLES,fe,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.backCCW,ye,"terrain_depth",D.gridBuffer,D.gridIndexBuffer,D.gridNoSkirtSegments)}}(a,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,h,y){if(a.getSource()instanceof Un)return this._setupProxiedCoordsForImageSource(a,h,y);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const w=this.proxiedCoords[a.id]=[],S=this.proxyCoords;for(let D=0;D<S.length;D++){const G=S[D],q=this._findTileCoveringTileID(G,a);if(q){const Z=this._createProxiedId(G,q,y[G.key]&&y[G.key][a.id]);w.push(Z),this.proxyToSource[G.key][a.id]=[Z]}}let R=!1;for(let D=0;D<h.length;D++){const G=a.getTile(h[D]);if(!G||!G.hasData())continue;const q=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(q&&q.tileID.canonical.z!==G.tileID.canonical.z){const Z=this.proxyToSource[q.tileID.key][a.id],ne=this._createProxiedId(q.tileID,G,y[q.tileID.key]&&y[q.tileID.key][a.id]);Z?Z.splice(Z.length-1,0,ne):this.proxyToSource[q.tileID.key][a.id]=[ne],w.push(ne),R=!0}}this._sourceTilesOverlap[a.id]=R}_setupProxiedCoordsForImageSource(a,h,y){if(!a.getSource().loaded())return;const w=this.proxiedCoords[a.id]=[],S=this.proxyCoords,R=a.getSource(),D=new i.Point(R.tileID.x,R.tileID.y)._div(1<<R.tileID.z),G=R.coordinates.map(i.MercatorCoordinate.fromLngLat).reduce((Z,ne)=>(Z.min.x=Math.min(Z.min.x,ne.x-D.x),Z.min.y=Math.min(Z.min.y,ne.y-D.y),Z.max.x=Math.max(Z.max.x,ne.x-D.x),Z.max.y=Math.max(Z.max.y,ne.y-D.y),Z),{min:new i.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),q=(Z,ne)=>{const he=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),fe=Z.canonical.y/(1<<Z.canonical.z),_e=i.EXTENT/(1<<Z.canonical.z),ge=ne.wrap+ne.canonical.x/(1<<ne.canonical.z),ye=ne.canonical.y/(1<<ne.canonical.z);return he+_e<ge+G.min.x||he>ge+G.max.x||fe+_e<ye+G.min.y||fe>ye+G.max.y};for(let Z=0;Z<S.length;Z++){const ne=S[Z];for(let he=0;he<h.length;he++){const fe=a.getTile(h[he]);if(!fe||!fe.hasData()||q(ne,fe.tileID))continue;const _e=this._createProxiedId(ne,fe,y[ne.key]&&y[ne.key][a.id]),ge=this.proxyToSource[ne.key][a.id];ge?ge.push(_e):this.proxyToSource[ne.key][a.id]=[_e],w.push(_e)}}}_createProxiedId(a,h,y){let w=this.orthoMatrix;if(y){const S=y.find(R=>R.key===h.tileID.key);if(S)return S}if(h.tileID.key!==a.key){const S=a.canonical.z-h.tileID.canonical.z;let R,D,G;w=i.create();const q=h.tileID.wrap-a.wrap<<a.overscaledZ;S>0?(R=i.EXTENT>>S,D=R*((h.tileID.canonical.x<<S)-a.canonical.x+q),G=R*((h.tileID.canonical.y<<S)-a.canonical.y)):(R=i.EXTENT<<-S,D=i.EXTENT*(h.tileID.canonical.x-(a.canonical.x+q<<-S)),G=i.EXTENT*(h.tileID.canonical.y-(a.canonical.y<<-S))),i.ortho(w,0,R,0,R,0,1),i.translate(w,w,[D,G,0])}return new ya(h.tileID,a.key,w)}_findTileCoveringTileID(a,h){let y=h.getTile(a);if(y&&y.hasData())return y;const w=this._findCoveringTileCache[h.id],S=w[a.key];if(y=S?h.getTileByID(S):null,y&&y.hasData()||S===null)return y;let R=y?y.tileID:a,D=R.overscaledZ;const G=h.getSource().minzoom,q=[];if(!S){const ne=h.getSource().maxzoom;if(a.canonical.z>=ne){const he=a.canonical.z-ne;h.getSource().reparseOverscaled?(D=Math.max(a.canonical.z+2,h.transform.tileZoom),R=new i.OverscaledTileID(D,a.wrap,ne,a.canonical.x>>he,a.canonical.y>>he)):he!==0&&(D=ne,R=new i.OverscaledTileID(D,a.wrap,ne,a.canonical.x>>he,a.canonical.y>>he))}R.key!==a.key&&(q.push(R.key),y=h.getTile(R))}const Z=ne=>{q.forEach(he=>{w[he]=ne}),q.length=0};for(D-=1;D>=G&&(!y||!y.hasData());D--){y&&Z(y.tileID.key);const ne=R.calculateScaledKey(D);if(y=h.getTileByID(ne),y&&y.hasData())break;const he=w[ne];if(he===null)break;he===void 0?q.push(ne):y=h.getTileByID(he)}return Z(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let y=this._tilesDirty[a];y||(y=this._tilesDirty[a]={}),y[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(h){let y=0;const w=new i.StructArrayLayout2ui4,S=131;for(let R=1;R<129;R++){for(let D=1;D<129;D++)y=R*S+D,w.emplaceBack(y,y+1),w.emplaceBack(y,y+S),w.emplaceBack(y+1,y+S),R===128&&w.emplaceBack(y+S,y+S+1);w.emplaceBack(y+1,y+1+S)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=i.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Pn{static cacheKey(a,h,y,w){let S=`${h}${w?w.cacheKey:""}`;for(const R of y)a.usedDefines.includes(R)&&(S+=`/${R}`);return S}constructor(a,h,y,w,S,R){const D=a.gl;this.program=D.createProgram();const G=function(ie){const pe=[];for(let we=0;we<ie.length;we++){if(ie[we]===null)continue;const Ee=ie[we].split(" ");pe.push(Ee.pop())}return pe}(y.staticAttributes),q=w?w.getBinderAttributes():[],Z=G.concat(q);let ne=w?w.defines():[];ne=ne.concat(R.map(ie=>`#define ${ie}`));const he=a.isWebGL2?`#version 300 es
`:"",fe=he+ne.concat(a.extStandardDerivatives&&he.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Fo):Fo,Fo,_a,vc.fragmentSource,Co.fragmentSource,y.fragmentSource).join(`
`),_e=he+ne.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,_a,vc.vertexSource,Co.vertexSource,xl.vertexSource,y.vertexSource).join(`
`),ge=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(ge,fe),D.compileShader(ge),D.attachShader(this.program,ge);const ye=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(ye,_e),D.compileShader(ye),D.attachShader(this.program,ye),this.attributes={},this.numAttributes=Z.length;for(let ie=0;ie<this.numAttributes;ie++)Z[ie]&&(D.bindAttribLocation(this.program,ie,Z[ie]),this.attributes[Z[ie]]=ie);D.linkProgram(this.program),D.deleteShader(ye),D.deleteShader(ge),this.fixedUniforms=S(a),this.binderUniforms=w?w.getUniforms(a):[],R.includes("TERRAIN")&&(this.terrainUniforms=(ie=>({u_dem:new i.Uniform1i(ie),u_dem_prev:new i.Uniform1i(ie),u_dem_unpack:new i.Uniform4f(ie),u_dem_tl:new i.Uniform2f(ie),u_dem_scale:new i.Uniform1f(ie),u_dem_tl_prev:new i.Uniform2f(ie),u_dem_scale_prev:new i.Uniform1f(ie),u_dem_size:new i.Uniform1f(ie),u_dem_lerp:new i.Uniform1f(ie),u_exaggeration:new i.Uniform1f(ie),u_depth:new i.Uniform1i(ie),u_depth_size_inv:new i.Uniform2f(ie),u_meter_to_dem:new i.Uniform1f(ie),u_label_plane_matrix_inv:new i.UniformMatrix4f(ie)}))(a)),R.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new i.Uniform3f(ie),u_tile_tr_up:new i.Uniform3f(ie),u_tile_br_up:new i.Uniform3f(ie),u_tile_bl_up:new i.Uniform3f(ie),u_tile_up_scale:new i.Uniform1f(ie)}))(a)),R.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new i.UniformMatrix4f(ie),u_fog_range:new i.Uniform2f(ie),u_fog_color:new i.Uniform4f(ie),u_fog_horizon_blend:new i.Uniform1f(ie),u_fog_temporal_offset:new i.Uniform1f(ie),u_frustum_tl:new i.Uniform3f(ie),u_frustum_tr:new i.Uniform3f(ie),u_frustum_br:new i.Uniform3f(ie),u_frustum_bl:new i.Uniform3f(ie),u_globe_pos:new i.Uniform3f(ie),u_globe_radius:new i.Uniform1f(ie),u_globe_transition:new i.Uniform1f(ie),u_is_globe:new i.Uniform1i(ie),u_viewport:new i.Uniform2f(ie)}))(a))}}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)y[w]&&y[w].set(this.program,w,h[w])}}setGlobeUniformValues(a,h){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)y[w]&&y[w].set(this.program,w,h[w])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)y[w].set(this.program,w,h[w])}}draw(a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge){const ye=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(y),a.setStencilMode(w),a.setColorMode(S),a.setCullFace(R);for(const pe of Object.keys(this.fixedUniforms))this.fixedUniforms[pe].set(this.program,pe,D[pe]);_e&&_e.setUniforms(this.program,a,this.binderUniforms,he,{zoom:fe});const ie={[ye.LINES]:2,[ye.TRIANGLES]:3,[ye.LINE_STRIP]:1}[h];for(const pe of ne.get()){const we=pe.vaos||(pe.vaos={});(we[G]||(we[G]=new mh)).bind(a,this,q,_e?_e.getPaintVertexBuffers():[],Z,pe.vertexOffset,ge||[]),ye.drawElements(h,pe.primitiveLength*ie,ye.UNSIGNED_SHORT,pe.primitiveOffset*ie*2)}}}function oo(m,a){const h=Math.pow(2,a.tileID.overscaledZ),y=a.tileSize*Math.pow(2,m.transform.tileZoom)/h,w=y*(a.tileID.canonical.x+a.tileID.wrap*h),S=y*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/mn(a,1,m.transform.tileZoom),u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const ps=i.create(),Yi=(m,a,h,y,w,S,R,D,G,q,Z)=>{const ne=a.style.light,he=ne.properties.get("position"),fe=[he.x,he.y,he.z],_e=i.create$1();ne.properties.get("anchor")==="viewport"&&(i.fromRotation(_e,-a.transform.angle),i.transformMat3(fe,fe,_e));const ge=ne.properties.get("color"),ye=a.transform,ie={u_matrix:m,u_lightpos:fe,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+h,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ps,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:S};return ye.projection.name==="globe"&&(ie.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],ie.u_zoom_transition=G,ie.u_inv_rot_matrix=Z,ie.u_merc_center=q,ie.u_up_dir=ye.projection.upVector(new i.CanonicalTileID(0,0,0),q[0]*i.EXTENT,q[1]*i.EXTENT),ie.u_height_lift=D),ie},Xa=(m,a,h,y,w,S,R,D,G,q,Z,ne)=>{const he=Yi(m,a,h,y,w,S,R,G,q,Z,ne),fe={u_height_factor:-Math.pow(2,R.overscaledZ)/D.tileSize/8};return i.extend(he,oo(a,D),fe)},ks=m=>({u_matrix:m}),va=(m,a,h)=>i.extend(ks(m),oo(a,h)),$c=(m,a)=>({u_matrix:m,u_world:a}),is=(m,a,h,y)=>i.extend(va(m,a,h),{u_world:y}),ms=i.create(),Qr=(m,a,h,y,w,S)=>{const R=m.transform,D=R.projection.name==="globe";let G;if(S.paint.get("circle-pitch-alignment")==="map")if(D){const Z=i.globePixelsToTileUnits(R.zoom,a.canonical)*R._pixelsPerMercatorPixel;G=Float32Array.from([Z,0,0,Z])}else G=R.calculatePixelsToTileUnitsMatrix(h);else G=new Float32Array([R.pixelsToGLUnits[0],0,0,R.pixelsToGLUnits[1]]);const q={u_camera_to_center_distance:R.cameraToCenterDistance,u_matrix:m.translatePosMatrix(a.projMatrix,h,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_device_pixel_ratio:i.exported.devicePixelRatio,u_extrude_scale:G,u_inv_rot_matrix:ms,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){q.u_inv_rot_matrix=y,q.u_merc_center=w,q.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],q.u_zoom_transition=i.globeToMercatorTransition(R.zoom);const Z=w[0]*i.EXTENT,ne=w[1]*i.EXTENT;q.u_up_dir=R.projection.upVector(new i.CanonicalTileID(0,0,0),Z,ne)}return q},qa=m=>{const a=[];return m.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},os=(m,a,h,y)=>{const w=i.EXTENT/h.tileSize;return{u_matrix:m,u_camera_to_center_distance:a.getCameraToCenterDistance(y),u_extrude_scale:[a.pixelsToGLUnits[0]/w,a.pixelsToGLUnits[1]/w]}},Ka=(m,a,h=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:h}),Ja=i.create(),Hc=(m,a,h,y,w,S,R)=>{const D=m.transform,G=D.projection.name==="globe",q=G?i.globePixelsToTileUnits(D.zoom,a.canonical)*D._pixelsPerMercatorPixel:mn(h,1,S),Z={u_matrix:a.projMatrix,u_extrude_scale:q,u_intensity:R,u_inv_rot_matrix:Ja,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(G){Z.u_inv_rot_matrix=y,Z.u_merc_center=w,Z.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],Z.u_zoom_transition=i.globeToMercatorTransition(D.zoom);const ne=w[0]*i.EXTENT,he=w[1]*i.EXTENT;Z.u_up_dir=D.projection.upVector(new i.CanonicalTileID(0,0,0),ne,he)}return Z},Qs=(m,a,h,y,w,S,R)=>{const D=m.transform,G=D.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:xa(m,a,h,y),u_pixels_to_tile_units:G,u_device_pixel_ratio:S,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:El(h)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ao(a,m.transform),u_alpha_discard_threshold:0,u_trim_offset:R}},$l=(m,a,h,y,w)=>{const S=m.transform;return{u_matrix:xa(m,a,h,y),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:w,u_image:0,u_tile_units_to_pixels:Ao(a,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ao(m,a){return 1/mn(m,1,a.tileZoom)}function xa(m,a,h,y){return m.translatePosMatrix(y||a.tileID.projMatrix,a,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function El(m){const a=m.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}const ea=(m,a,h,y,w,S)=>{return{u_matrix:m,u_tl_parent:a,u_scale_parent:h,u_fade_t:y.mix,u_opacity:y.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(D=w.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(R=w.paint.get("raster-contrast"),R>0?1/(1-R):1+R),u_spin_weights:Uo(w.paint.get("raster-hue-rotate")),u_perspective_transform:S};var R,D};function Uo(m){m*=Math.PI/180;const a=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const Hl=i.create(),bc=(m,a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge)=>{const ye=w.transform,ie={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ye.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:ye.width/ye.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:R,u_coord_matrix:D,u_is_text:+G,u_pitch_with_map:+y,u_texsize:q,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Hl,u_up_vector:[0,-1,0]};return ge.name==="globe"&&(ie.u_tile_id=[Z.canonical.x,Z.canonical.y,1<<Z.canonical.z],ie.u_zoom_transition=ne,ie.u_inv_rot_matrix=fe,ie.u_merc_center=he,ie.u_camera_forward=ye._camera.forward(),ie.u_ecef_origin=i.globeECEFOrigin(ye.globeMatrix,Z.toUnwrapped()),ie.u_tile_matrix=Float32Array.from(ye.globeMatrix),ie.u_up_vector=_e),ie},ta=(m,a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge,ye)=>i.extend(bc(m,a,h,y,w,S,R,D,G,q,ne,he,fe,_e,ge,ye),{u_gamma_scale:y?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:i.exported.devicePixelRatio,u_is_halo:+Z}),Cl=(m,a,h,y,w,S,R,D,G,q,Z,ne,he,fe,_e,ge)=>i.extend(ta(m,a,h,y,w,S,R,D,!0,G,!0,Z,ne,he,fe,_e,ge),{u_texsize_icon:q,u_texture_icon:1}),Ya=(m,a,h)=>({u_matrix:m,u_opacity:a,u_color:h}),Ts=(m,a,h,y,w)=>i.extend(function(S,R,D){const G=R.imageManager.getPattern(S.toString()),{width:q,height:Z}=R.imageManager.getPixelSize(),ne=Math.pow(2,D.tileID.overscaledZ),he=D.tileSize*Math.pow(2,R.transform.tileZoom)/ne,fe=he*(D.tileID.canonical.x+D.tileID.wrap*ne),_e=he*D.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[q,Z],u_pattern_size:G.displaySize,u_tile_units_to_pixels:1/mn(D,1,R.transform.tileZoom),u_pixel_coord_upper:[fe>>16,_e>>16],u_pixel_coord_lower:[65535&fe,65535&_e]}}(y,h,w),{u_matrix:m,u_opacity:a}),We={fillExtrusion:m=>({u_matrix:new i.UniformMatrix4f(m),u_lightpos:new i.Uniform3f(m),u_lightintensity:new i.Uniform1f(m),u_lightcolor:new i.Uniform3f(m),u_vertical_gradient:new i.Uniform1f(m),u_opacity:new i.Uniform1f(m),u_edge_radius:new i.Uniform1f(m),u_ao:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_up_dir:new i.Uniform3f(m),u_height_lift:new i.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_lightpos:new i.Uniform3f(m),u_lightintensity:new i.Uniform1f(m),u_lightcolor:new i.Uniform3f(m),u_vertical_gradient:new i.Uniform1f(m),u_height_factor:new i.Uniform1f(m),u_edge_radius:new i.Uniform1f(m),u_ao:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_up_dir:new i.Uniform3f(m),u_height_lift:new i.Uniform1f(m),u_image:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_pixel_coord_upper:new i.Uniform2f(m),u_pixel_coord_lower:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m),u_opacity:new i.Uniform1f(m)}),fill:m=>({u_matrix:new i.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_image:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_pixel_coord_upper:new i.Uniform2f(m),u_pixel_coord_lower:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m)}),fillOutline:m=>({u_matrix:new i.UniformMatrix4f(m),u_world:new i.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_world:new i.Uniform2f(m),u_image:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_pixel_coord_upper:new i.Uniform2f(m),u_pixel_coord_lower:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new i.Uniform1f(m),u_extrude_scale:new i.UniformMatrix2f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_up_dir:new i.Uniform3f(m)}),collisionBox:m=>({u_matrix:new i.UniformMatrix4f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_extrude_scale:new i.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new i.UniformMatrix4f(m),u_inv_matrix:new i.UniformMatrix4f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_viewport_size:new i.Uniform2f(m)}),debug:m=>({u_color:new i.UniformColor(m),u_matrix:new i.UniformMatrix4f(m),u_overlay:new i.Uniform1i(m),u_overlay_scale:new i.Uniform1f(m)}),clippingMask:m=>({u_matrix:new i.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new i.Uniform1f(m),u_intensity:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_up_dir:new i.Uniform3f(m)}),heatmapTexture:m=>({u_image:new i.Uniform1i(m),u_color_ramp:new i.Uniform1i(m),u_opacity:new i.Uniform1f(m)}),hillshade:m=>({u_matrix:new i.UniformMatrix4f(m),u_image:new i.Uniform1i(m),u_latrange:new i.Uniform2f(m),u_light:new i.Uniform2f(m),u_shadow:new i.UniformColor(m),u_highlight:new i.UniformColor(m),u_accent:new i.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new i.UniformMatrix4f(m),u_image:new i.Uniform1i(m),u_dimension:new i.Uniform2f(m),u_zoom:new i.Uniform1f(m),u_unpack:new i.Uniform4f(m)}),line:m=>({u_matrix:new i.UniformMatrix4f(m),u_pixels_to_tile_units:new i.UniformMatrix2f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_units_to_pixels:new i.Uniform2f(m),u_dash_image:new i.Uniform1i(m),u_gradient_image:new i.Uniform1i(m),u_image_height:new i.Uniform1f(m),u_texsize:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m),u_alpha_discard_threshold:new i.Uniform1f(m),u_trim_offset:new i.Uniform2f(m)}),linePattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_texsize:new i.Uniform2f(m),u_pixels_to_tile_units:new i.UniformMatrix2f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_image:new i.Uniform1i(m),u_units_to_pixels:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m),u_alpha_discard_threshold:new i.Uniform1f(m)}),raster:m=>({u_matrix:new i.UniformMatrix4f(m),u_tl_parent:new i.Uniform2f(m),u_scale_parent:new i.Uniform1f(m),u_fade_t:new i.Uniform1f(m),u_opacity:new i.Uniform1f(m),u_image0:new i.Uniform1i(m),u_image1:new i.Uniform1i(m),u_brightness_low:new i.Uniform1f(m),u_brightness_high:new i.Uniform1f(m),u_saturation_factor:new i.Uniform1f(m),u_contrast_factor:new i.Uniform1f(m),u_spin_weights:new i.Uniform3f(m),u_perspective_transform:new i.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new i.Uniform1i(m),u_is_size_feature_constant:new i.Uniform1i(m),u_size_t:new i.Uniform1f(m),u_size:new i.Uniform1f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_rotate_symbol:new i.Uniform1i(m),u_aspect_ratio:new i.Uniform1f(m),u_fade_change:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_label_plane_matrix:new i.UniformMatrix4f(m),u_coord_matrix:new i.UniformMatrix4f(m),u_is_text:new i.Uniform1i(m),u_pitch_with_map:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_camera_forward:new i.Uniform3f(m),u_tile_matrix:new i.UniformMatrix4f(m),u_up_vector:new i.Uniform3f(m),u_ecef_origin:new i.Uniform3f(m),u_texture:new i.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new i.Uniform1i(m),u_is_size_feature_constant:new i.Uniform1i(m),u_size_t:new i.Uniform1f(m),u_size:new i.Uniform1f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_rotate_symbol:new i.Uniform1i(m),u_aspect_ratio:new i.Uniform1f(m),u_fade_change:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_label_plane_matrix:new i.UniformMatrix4f(m),u_coord_matrix:new i.UniformMatrix4f(m),u_is_text:new i.Uniform1i(m),u_pitch_with_map:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_texture:new i.Uniform1i(m),u_gamma_scale:new i.Uniform1f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_camera_forward:new i.Uniform3f(m),u_tile_matrix:new i.UniformMatrix4f(m),u_up_vector:new i.Uniform3f(m),u_ecef_origin:new i.Uniform3f(m),u_is_halo:new i.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new i.Uniform1i(m),u_is_size_feature_constant:new i.Uniform1i(m),u_size_t:new i.Uniform1f(m),u_size:new i.Uniform1f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_rotate_symbol:new i.Uniform1i(m),u_aspect_ratio:new i.Uniform1f(m),u_fade_change:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_label_plane_matrix:new i.UniformMatrix4f(m),u_coord_matrix:new i.UniformMatrix4f(m),u_is_text:new i.Uniform1i(m),u_pitch_with_map:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_texsize_icon:new i.Uniform2f(m),u_texture:new i.Uniform1i(m),u_texture_icon:new i.Uniform1i(m),u_gamma_scale:new i.Uniform1f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_is_halo:new i.Uniform1i(m)}),background:m=>({u_matrix:new i.UniformMatrix4f(m),u_opacity:new i.Uniform1f(m),u_color:new i.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_opacity:new i.Uniform1f(m),u_image:new i.Uniform1i(m),u_pattern_tl:new i.Uniform2f(m),u_pattern_br:new i.Uniform2f(m),u_texsize:new i.Uniform2f(m),u_pattern_size:new i.Uniform2f(m),u_pixel_coord_upper:new i.Uniform2f(m),u_pixel_coord_lower:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m)}),terrainRaster:$a,terrainDepth:$a,skybox:m=>({u_matrix:new i.UniformMatrix4f(m),u_sun_direction:new i.Uniform3f(m),u_cubemap:new i.Uniform1i(m),u_opacity:new i.Uniform1f(m),u_temporal_offset:new i.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new i.UniformMatrix4f(m),u_color_ramp:new i.Uniform1i(m),u_center_direction:new i.Uniform3f(m),u_radius:new i.Uniform1f(m),u_opacity:new i.Uniform1f(m),u_temporal_offset:new i.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new i.UniformMatrix3f(m),u_sun_direction:new i.Uniform3f(m),u_sun_intensity:new i.Uniform1f(m),u_color_tint_r:new i.Uniform4f(m),u_color_tint_m:new i.Uniform4f(m),u_luminance:new i.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new i.UniformMatrix4f(m),u_globe_matrix:new i.UniformMatrix4f(m),u_normalize_matrix:new i.UniformMatrix4f(m),u_merc_matrix:new i.UniformMatrix4f(m),u_zoom_transition:new i.Uniform1f(m),u_merc_center:new i.Uniform2f(m),u_image0:new i.Uniform1i(m),u_grid_matrix:new i.UniformMatrix3f(m),u_skirt_height:new i.Uniform1f(m),u_frustum_tl:new i.Uniform3f(m),u_frustum_tr:new i.Uniform3f(m),u_frustum_br:new i.Uniform3f(m),u_frustum_bl:new i.Uniform3f(m),u_globe_pos:new i.Uniform3f(m),u_globe_radius:new i.Uniform1f(m),u_viewport:new i.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new i.Uniform3f(m),u_frustum_tr:new i.Uniform3f(m),u_frustum_br:new i.Uniform3f(m),u_frustum_bl:new i.Uniform3f(m),u_horizon:new i.Uniform1f(m),u_transition:new i.Uniform1f(m),u_fadeout_range:new i.Uniform1f(m),u_color:new i.Uniform4f(m),u_high_color:new i.Uniform4f(m),u_space_color:new i.Uniform4f(m),u_star_intensity:new i.Uniform1f(m),u_star_density:new i.Uniform1f(m),u_star_size:new i.Uniform1f(m),u_temporal_offset:new i.Uniform1f(m),u_horizon_angle:new i.Uniform1f(m),u_rotation_matrix:new i.UniformMatrix4f(m)})};let dt;function Ut(m,a,h,y,w,S,R){const D=m.context,G=D.gl,q=m.transform,Z=m.useProgram("collisionBox"),ne=[];let he=0,fe=0;for(let Ee=0;Ee<y.length;Ee++){const ke=y[Ee],Ue=a.getTile(ke),Fe=Ue.getBucket(h);if(!Fe)continue;const He=ze(ke,Fe,q);let $e=He;w[0]===0&&w[1]===0||($e=m.translatePosMatrix(He,Ue,w,S));const it=R?Fe.textCollisionBox:Fe.iconCollisionBox,Pt=Fe.collisionCircleArray;if(Pt.length>0){const Qe=i.create(),gt=$e;i.mul(Qe,Fe.placementInvProjMatrix,q.glCoordMatrix),i.mul(Qe,Qe,Fe.placementViewportMatrix),ne.push({circleArray:Pt,circleOffset:fe,transform:gt,invTransform:Qe,projection:Fe.getProjection()}),he+=Pt.length/4,fe=he}it&&(m.terrain&&m.terrain.setupElevationDraw(Ue,Z),Z.draw(D,G.LINES,i.DepthMode.disabled,i.StencilMode.disabled,m.colorModeForRenderPass(),i.CullFaceMode.disabled,os($e,q,Ue,Fe.getProjection()),h.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,q.zoom,null,[it.collisionVertexBuffer,it.collisionVertexBufferExt]))}if(!R||!ne.length)return;const _e=m.useProgram("collisionCircle"),ge=new i.StructArrayLayout2f1f2i16;ge.resize(4*he),ge._trim();let ye=0;for(const Ee of ne)for(let ke=0;ke<Ee.circleArray.length/4;ke++){const Ue=4*ke,Fe=Ee.circleArray[Ue+0],He=Ee.circleArray[Ue+1],$e=Ee.circleArray[Ue+2],it=Ee.circleArray[Ue+3];ge.emplace(ye++,Fe,He,$e,it,0),ge.emplace(ye++,Fe,He,$e,it,1),ge.emplace(ye++,Fe,He,$e,it,2),ge.emplace(ye++,Fe,He,$e,it,3)}(!dt||dt.length<2*he)&&(dt=function(Ee){const ke=2*Ee,Ue=new i.StructArrayLayout3ui6;Ue.resize(ke),Ue._trim();for(let Fe=0;Fe<ke;Fe++){const He=6*Fe;Ue.uint16[He+0]=4*Fe+0,Ue.uint16[He+1]=4*Fe+1,Ue.uint16[He+2]=4*Fe+2,Ue.uint16[He+3]=4*Fe+2,Ue.uint16[He+4]=4*Fe+3,Ue.uint16[He+5]=4*Fe+0}return Ue}(he));const ie=D.createIndexBuffer(dt,!0),pe=D.createVertexBuffer(ge,i.collisionCircleLayout.members,!0);for(const Ee of ne){const ke={u_matrix:Ee.transform,u_inv_matrix:Ee.invTransform,u_camera_to_center_distance:(we=q).getCameraToCenterDistance(Ee.projection),u_viewport_size:[we.width,we.height]};_e.draw(D,G.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,m.colorModeForRenderPass(),i.CullFaceMode.disabled,ke,h.id,pe,ie,i.SegmentVector.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,q.zoom)}var we;pe.destroy(),ie.destroy()}const Cn=i.create();function Er({width:m,height:a,anchor:h,textOffset:y,textScale:w},S){const{horizontalAlign:R,verticalAlign:D}=i.getAnchorAlignment(h),G=-(R-.5)*m,q=-(D-.5)*a,Z=i.evaluateVariableOffset(h,y);return new i.Point((G/w+Z[0])*S,(q/w+Z[1])*S)}function pr(m,a,h,y,w,S,R,D,G,q,Z){const ne=m.text.placedSymbolArray,he=m.text.dynamicLayoutVertexArray,fe=m.icon.dynamicLayoutVertexArray,_e={},ge=m.getProjection(),ye=De(D,ge,S),ie=S.elevation,pe=ge.upVectorScale(D.canonical,S.center.lat,S.worldSize).metersToTile;he.clear();for(let we=0;we<ne.length;we++){const Ee=ne.get(we),{tileAnchorX:ke,tileAnchorY:Ue,numGlyphs:Fe}=Ee,He=Ee.hidden||!Ee.crossTileID||m.allowVerticalPlacement&&!Ee.placedOrientation?null:y[Ee.crossTileID];if(He){let $e=0,it=0,Pt=0;if(ie){const Et=ie?ie.getAtTileOffset(D,ke,Ue):0,[rn,fn,qt]=ge.upVector(D.canonical,ke,Ue);$e=Et*rn*pe,it=Et*fn*pe,Pt=Et*qt*pe}let[Qe,gt,st,Lt]=Sr(Ee.projectedAnchorX+$e,Ee.projectedAnchorY+it,Ee.projectedAnchorZ+Pt,h?ye:R);const tt=ja(S.getCameraToCenterDistance(ge),Lt);let mt=w.evaluateSizeForFeature(m.textSizeData,q,Ee)*tt/i.ONE_EM;h&&(mt*=m.tilePixelRatio/G);const xt=Er(He,mt);h?({x:Qe,y:gt,z:st}=ge.projectTilePoint(ke+xt.x,Ue+xt.y,D.canonical),[Qe,gt,st]=Sr(Qe+$e,gt+it,st+Pt,R)):(a&&xt._rotate(-S.angle),Qe+=xt.x,gt+=xt.y,st=0);const at=m.allowVerticalPlacement&&Ee.placedOrientation===i.WritingMode.vertical?Math.PI/2:0;for(let Et=0;Et<Fe;Et++)i.addDynamicAttributes(he,Qe,gt,st,at);Z&&Ee.associatedIconIndex>=0&&(_e[Ee.associatedIconIndex]={x:Qe,y:gt,z:st,angle:at})}else Yo(Fe,he)}if(Z){fe.clear();const we=m.icon.placedSymbolArray;for(let Ee=0;Ee<we.length;Ee++){const ke=we.get(Ee),{numGlyphs:Ue}=ke,Fe=_e[Ee];if(ke.hidden||!Fe)Yo(Ue,fe);else{const{x:He,y:$e,z:it,angle:Pt}=Fe;for(let Qe=0;Qe<Ue;Qe++)i.addDynamicAttributes(fe,He,$e,it,Pt)}}m.icon.dynamicLayoutVertexBuffer.updateData(fe)}m.text.dynamicLayoutVertexBuffer.updateData(he)}function ei(m,a,h){return h.iconsInText&&a?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Qn(m,a,h,y,w,S,R,D,G,q,Z,ne){const he=m.context,fe=he.gl,_e=m.transform,ge=D==="map",ye=G==="map",ie=ge&&h.layout.get("symbol-placement")!=="point",pe=ge&&!ye&&!ie,we=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ee=!1;const ke=m.depthModeForSublayer(0,i.DepthMode.ReadOnly),Ue=[i.mercatorXfromLng(_e.center.lng),i.mercatorYfromLat(_e.center.lat)],Fe=h.layout.get("text-variable-anchor"),He=_e.projection.name==="globe",$e=[],it=[0,-1,0];let Pt=it;!He&&!_e.mercatorFromTransition||ge||(Pt=function(Qe){const gt=Qe._camera.getWorldToCamera(Qe.worldSize,1),st=i.multiply([],gt,Qe.globeMatrix);i.invert(st,st);const Lt=[0,0,0],tt=[0,1,0,0];return i.transformMat4$1(tt,tt,st),Lt[0]=tt[0],Lt[1]=tt[1],Lt[2]=tt[2],i.normalize(Lt,Lt),Lt}(_e));for(const Qe of y){const gt=a.getTile(Qe),st=gt.getBucket(h);if(!st||st.projection.name==="mercator"&&He)continue;const Lt=w?st.text:st.icon;if(!Lt||st.fullyClipped||!Lt.segments.get().length)continue;const tt=Lt.programConfigurations.get(h.id),mt=w||st.sdfIcons,xt=w?st.textSizeData:st.iconSizeData,at=ye||_e.pitch!==0,Et=i.evaluateSizeForZoom(xt,_e.zoom);let rn,fn,qt,gn,An=[0,0],Nn=null;if(w)fn=gt.glyphAtlasTexture,qt=fe.LINEAR,rn=gt.glyphAtlasTexture.size,st.iconsInText&&(An=gt.imageAtlasTexture.size,Nn=gt.imageAtlasTexture,gn=at||m.options.rotating||m.options.zooming||xt.kind==="composite"||xt.kind==="camera"?fe.LINEAR:fe.NEAREST);else{const cs=h.layout.get("icon-size").constantOr(0)!==1||st.iconsNeedLinear;fn=gt.imageAtlasTexture,qt=mt||m.options.rotating||m.options.zooming||cs||at?fe.LINEAR:fe.NEAREST,rn=gt.imageAtlasTexture.size}const un=st.projection.name==="globe",xr=un?Pt:it,Or=un?i.globeToMercatorTransition(_e.zoom):0,Cr=De(Qe,st.getProjection(),_e),or=_e.calculatePixelsToTileUnitsMatrix(gt),Mo=et(Cr,gt.tileID.canonical,ye,ge,_e,st.getProjection(),or),to=m.terrain&&ye&&ie?i.invert(i.create(),Mo):Cn,Vo=hr(Cr,gt.tileID.canonical,ye,ge,_e,st.getProjection(),or),js=Fe&&st.hasTextData(),ti=h.layout.get("icon-text-fit")!=="none"&&js&&st.hasIconData();if(ie){const cs=_e.elevation,co=cs?cs.getAtTileOffsetFunc(Qe,_e.center.lat,_e.worldSize,st.getProjection()):null,sl=Si(Cr,gt.tileID.canonical,ye,ge,_e,st.getProjection(),or);ro(st,Cr,m,w,sl,Vo,ye,q,co,Qe)}const _r=ie||w&&Fe||ti,mr=m.translatePosMatrix(Cr,gt,S,R),ni=_r?Cn:Mo,Io=m.translatePosMatrix(Vo,gt,S,R,!0),jr=st.getProjection().createInversionMatrix(_e,Qe.canonical),ls=[];m.terrainRenderModeElevated()&&ye&&ls.push("PITCH_WITH_MAP_TERRAIN"),un&&ls.push("PROJECTION_GLOBE_VIEW"),_r&&ls.push("PROJECTED_POS_ON_VIEWPORT");const Tc=mt&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ol;ol=mt?st.iconsInText?Cl(xt.kind,Et,pe,ye,m,mr,ni,Io,rn,An,Qe,Or,Ue,jr,xr,st.getProjection()):ta(xt.kind,Et,pe,ye,m,mr,ni,Io,w,rn,!0,Qe,Or,Ue,jr,xr,st.getProjection()):bc(xt.kind,Et,pe,ye,m,mr,ni,Io,w,rn,Qe,Or,Ue,jr,xr,st.getProjection());const lo={program:m.useProgram(ei(mt,w,st),tt,ls),buffers:Lt,uniformValues:ol,atlasTexture:fn,atlasTextureIcon:Nn,atlasInterpolation:qt,atlasInterpolationIcon:gn,isSDF:mt,hasHalo:Tc,tile:gt,labelPlaneMatrixInv:to};if(we&&st.canOverlap){Ee=!0;const cs=Lt.segments.get();for(const co of cs)$e.push({segments:new i.SegmentVector([co]),sortKey:co.sortKey,state:lo})}else $e.push({segments:Lt.segments,sortKey:0,state:lo})}Ee&&$e.sort((Qe,gt)=>Qe.sortKey-gt.sortKey);for(const Qe of $e){const gt=Qe.state;if(m.terrain&&m.terrain.setupElevationDraw(gt.tile,gt.program,{useDepthForOcclusion:!He,labelPlaneMatrixInv:gt.labelPlaneMatrixInv}),he.activeTexture.set(fe.TEXTURE0),gt.atlasTexture.bind(gt.atlasInterpolation,fe.CLAMP_TO_EDGE),gt.atlasTextureIcon&&(he.activeTexture.set(fe.TEXTURE1),gt.atlasTextureIcon&&gt.atlasTextureIcon.bind(gt.atlasInterpolationIcon,fe.CLAMP_TO_EDGE)),gt.isSDF){const st=gt.uniformValues;gt.hasHalo&&(st.u_is_halo=1,Qi(gt.buffers,Qe.segments,h,m,gt.program,ke,Z,ne,st)),st.u_is_halo=0}Qi(gt.buffers,Qe.segments,h,m,gt.program,ke,Z,ne,gt.uniformValues)}}function Qi(m,a,h,y,w,S,R,D,G){const q=y.context,Z=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];w.draw(q,q.gl.TRIANGLES,S,R,D,i.CullFaceMode.disabled,G,h.id,m.layoutVertexBuffer,m.indexBuffer,a,h.paint,y.transform.zoom,m.programConfigurations.get(h.id),Z)}function Mi(m,a,h,y,w,S,R){const D=m.context.gl,G=h.paint.get("fill-pattern"),q=G&&G.constantOr(1);let Z,ne,he,fe,_e;R?(ne=q&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=D.LINES):(ne=q?"fillPattern":"fill",Z=D.TRIANGLES);for(const ge of y){const ye=a.getTile(ge);if(q&&!ye.patternsLoaded())continue;const ie=ye.getBucket(h);if(!ie)continue;m.prepareDrawTile();const pe=ie.programConfigurations.get(h.id),we=m.useProgram(ne,pe);q&&(m.context.activeTexture.set(D.TEXTURE0),ye.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),pe.updatePaintBuffers());const Ee=G.constantOr(null);if(Ee&&ye.imageAtlas){const Ue=ye.imageAtlas.patternPositions[Ee.toString()];Ue&&pe.setConstantPatternPositions(Ue)}const ke=m.translatePosMatrix(ge.projMatrix,ye,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(R){fe=ie.indexBuffer2,_e=ie.segments2;const Ue=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];he=ne==="fillOutlinePattern"&&q?is(ke,m,ye,Ue):$c(ke,Ue)}else fe=ie.indexBuffer,_e=ie.segments,he=q?va(ke,m,ye):ks(ke);m.prepareDrawProgram(m.context,we,ge.toUnwrapped()),we.draw(m.context,Z,w,m.stencilModeForClipping(ge),S,i.CullFaceMode.disabled,he,h.id,ie.layoutVertexBuffer,fe,_e,h.paint,m.transform.zoom,pe)}}function vi(m,a,h,y,w,S,R){const D=m.context,G=D.gl,q=m.transform,Z=h.paint.get("fill-extrusion-pattern"),ne=Z.constantOr(1),he=h.paint.get("fill-extrusion-opacity"),fe=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],_e=h.layout.get("fill-extrusion-edge-radius"),ge=_e>0&&!h.paint.get("fill-extrusion-rounded-roof"),ye=ge?0:_e,ie=q.projection.name==="globe"?i.fillExtrusionHeightLift():0,pe=q.projection.name==="globe",we=pe?i.globeToMercatorTransition(q.zoom):0,Ee=[i.mercatorXfromLng(q.center.lng),i.mercatorYfromLat(q.center.lat)],ke=[];pe&&ke.push("PROJECTION_GLOBE_VIEW"),fe[0]>0&&ke.push("FAUX_AO"),ge&&ke.push("ZERO_ROOF_RADIUS");for(const Ue of y){const Fe=a.getTile(Ue),He=Fe.getBucket(h);if(!He||He.projection.name!==q.projection.name)continue;const $e=He.programConfigurations.get(h.id),it=m.useProgram(ne?"fillExtrusionPattern":"fillExtrusion",$e,ke);if(m.terrain){const mt=m.terrain;if(m.style.terrainSetForDrapingOnly())mt.setupElevationDraw(Fe,it,{useMeterToDem:!0});else{if(!He.enableTerrain)continue;if(mt.setupElevationDraw(Fe,it,{useMeterToDem:!0}),ss(D,a,Ue,He,h,mt),!He.centroidVertexBuffer){const xt=it.attributes.a_centroid_pos;xt!==void 0&&G.vertexAttrib2f(xt,0,0)}}}ne&&(m.context.activeTexture.set(G.TEXTURE0),Fe.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),$e.updatePaintBuffers());const Pt=Z.constantOr(null);if(Pt&&Fe.imageAtlas){const mt=Fe.imageAtlas.patternPositions[Pt.toString()];mt&&$e.setConstantPatternPositions(mt)}const Qe=m.translatePosMatrix(Ue.projMatrix,Fe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),gt=q.projection.createInversionMatrix(q,Ue.canonical),st=h.paint.get("fill-extrusion-vertical-gradient"),Lt=ne?Xa(Qe,m,st,he,fe,ye,Ue,Fe,ie,we,Ee,gt):Yi(Qe,m,st,he,fe,ye,Ue,ie,we,Ee,gt);m.prepareDrawProgram(D,it,Ue.toUnwrapped());const tt=[];m.terrain&&tt.push(He.centroidVertexBuffer),pe&&tt.push(He.layoutVertexExtBuffer),it.draw(D,D.gl.TRIANGLES,w,S,R,i.CullFaceMode.backCCW,Lt,h.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,h.paint,m.transform.zoom,$e,tt)}}function ss(m,a,h,y,w,S){const R=[ie=>{let pe=ie.canonical.x-1,we=ie.wrap;return pe<0&&(pe=(1<<ie.canonical.z)-1,we--),new i.OverscaledTileID(ie.overscaledZ,we,ie.canonical.z,pe,ie.canonical.y)},ie=>{let pe=ie.canonical.x+1,we=ie.wrap;return pe===1<<ie.canonical.z&&(pe=0,we++),new i.OverscaledTileID(ie.overscaledZ,we,ie.canonical.z,pe,ie.canonical.y)},ie=>new i.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,(ie.canonical.y===0?1<<ie.canonical.z:ie.canonical.y)-1),ie=>new i.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,ie.canonical.y===(1<<ie.canonical.z)-1?0:ie.canonical.y+1)],D=ie=>{const pe=a.getSource().minzoom,we=ke=>{const Ue=a.getTileByID(ke);if(Ue&&Ue.hasData())return Ue.getBucket(w)},Ee=[0,-1,1];for(const ke of Ee){if(ie.overscaledZ+ke<pe)continue;const Ue=we(ie.calculateScaledKey(ie.overscaledZ+ke));if(Ue)return Ue}},G=[0,0,0],q=(ie,pe)=>(G[0]=Math.min(ie.min.y,pe.min.y),G[1]=Math.max(ie.max.y,pe.max.y),G[2]=i.EXTENT-pe.min.x>ie.max.x?pe.min.x-i.EXTENT:ie.max.x,G),Z=(ie,pe)=>(G[0]=Math.min(ie.min.x,pe.min.x),G[1]=Math.max(ie.max.x,pe.max.x),G[2]=i.EXTENT-pe.min.y>ie.max.y?pe.min.y-i.EXTENT:ie.max.y,G),ne=[(ie,pe)=>q(ie,pe),(ie,pe)=>q(pe,ie),(ie,pe)=>Z(ie,pe),(ie,pe)=>Z(pe,ie)],he=new i.Point(0,0);let fe,_e,ge;const ye=(ie,pe,we,Ee,ke)=>{const Ue=[[Ee?we:ie,Ee?ie:we,0],[Ee?we:pe,Ee?pe:we,0]],Fe=ke<0?i.EXTENT+ke:ke,He=[Ee?Fe:(ie+pe)/2,Ee?(ie+pe)/2:Fe,0];return we===0&&ke<0||we!==0&&ke>0?S.getForTilePoints(ge,[He],!0,_e):Ue.push(He),S.getForTilePoints(h,Ue,!0,fe),Math.max(Ue[0][2],Ue[1][2],He[2])/S.exaggeration()};for(let ie=0;ie<4;ie++){const pe=(ie<2?1:5)-ie,we=y.borders[ie];if(we.length===0)continue;const Ee=ge=R[ie](h),ke=D(Ee);if(!(ke&&ke instanceof i.FillExtrusionBucket&&ke.enableTerrain)||y.borderDoneWithNeighborZ[ie]===ke.canonical.z&&ke.borderDoneWithNeighborZ[pe]===y.canonical.z||(_e=S.findDEMTileFor(Ee),!_e||!_e.dem))continue;if(!fe){const $e=S.findDEMTileFor(h);if(!$e||!$e.dem)return;fe=$e}const Ue=ke.borders[pe];let Fe=0;const He=ke.borderDoneWithNeighborZ[pe]!==y.canonical.z;if(y.canonical.z===ke.canonical.z){for(let $e=0;$e<we.length;$e++){const it=y.featuresOnBorder[we[$e]],Pt=it.borders[ie];let Qe;for(;Fe<Ue.length&&(Qe=ke.featuresOnBorder[Ue[Fe]],!(Qe.borders[pe][1]>Pt[0]+3));)He&&ke.encodeCentroid(void 0,Qe,!1),Fe++;if(Qe&&Fe<Ue.length){const gt=Fe;let st=0;for(;!(Qe.borders[pe][0]>Pt[1]-3)&&(st++,++Fe!==Ue.length);)Qe=ke.featuresOnBorder[Ue[Fe]];if(Qe=ke.featuresOnBorder[Ue[gt]],it.intersectsCount()>1||Qe.intersectsCount()>1||st!==1){st!==1&&(Fe=gt),y.encodeCentroid(void 0,it,!1),He&&ke.encodeCentroid(void 0,Qe,!1);continue}const Lt=ne[ie](it,Qe),tt=ie%2?i.EXTENT-1:0;he.x=ye(Lt[0],Math.min(i.EXTENT-1,Lt[1]),tt,ie<2,Lt[2]),he.y=0,y.encodeCentroid(he,it,!1),He&&ke.encodeCentroid(he,Qe,!1)}else y.encodeCentroid(void 0,it,!1)}y.borderDoneWithNeighborZ[ie]=ke.canonical.z,y.needsCentroidUpdate=!0,He&&(ke.borderDoneWithNeighborZ[pe]=y.canonical.z,ke.needsCentroidUpdate=!0)}else{for(const $e of we)y.encodeCentroid(void 0,y.featuresOnBorder[$e],!1);if(He){for(const $e of Ue)ke.encodeCentroid(void 0,ke.featuresOnBorder[$e],!1);ke.borderDoneWithNeighborZ[pe]=y.canonical.z,ke.needsCentroidUpdate=!0}y.borderDoneWithNeighborZ[ie]=ke.canonical.z,y.needsCentroidUpdate=!0}}(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(m)}const di=new i.Color(1,0,0,1),ji=new i.Color(0,1,0,1),Rr=new i.Color(0,0,1,1),Ri=new i.Color(1,0,1,1),Di=new i.Color(0,1,1,1);function ba(m,a,h){const y=m.context,w=m.transform,S=y.gl,R=w.projection.name==="globe",D=R?["PROJECTION_GLOBE_VIEW"]:null;let G=h.projMatrix;if(R&&i.globeToMercatorTransition(w.zoom)>0){const it=i.transitionTileAABBinECEF(h.canonical,w),Pt=i.globeDenormalizeECEF(it);G=i.multiply(new Float32Array(16),w.globeMatrix,Pt),i.multiply(G,w.projMatrix,G)}const q=m.useProgram("debug",null,D),Z=a.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(Z,q);const ne=i.DepthMode.disabled,he=i.StencilMode.disabled,fe=m.colorModeForRenderPass(),_e="$debug";y.activeTexture.set(S.TEXTURE0),m.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R?Z._makeGlobeTileDebugBuffers(m.context,w):Z._makeDebugTileBoundsBuffers(m.context,w.projection);const ge=Z._tileDebugBuffer||m.debugBuffer,ye=Z._tileDebugIndexBuffer||m.debugIndexBuffer,ie=Z._tileDebugSegments||m.debugSegments;q.draw(y,S.LINE_STRIP,ne,he,fe,i.CullFaceMode.disabled,Ka(G,i.Color.red),_e,ge,ye,ie,null,null,null,[Z._globeTileDebugBorderBuffer]);const pe=Z.latestRawTileData,we=Math.floor((pe&&pe.byteLength||0)/1024),Ee=a.getTile(h).tileSize,ke=512/Math.min(Ee,512)*(h.overscaledZ/w.zoom)*.5;let Ue=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ue+=` => ${h.overscaledZ}`),Ue+=` ${we}kb`,function(it,Pt){it.initDebugOverlayCanvas();const Qe=it.debugOverlayCanvas,gt=it.context.gl,st=it.debugOverlayCanvas.getContext("2d");st.clearRect(0,0,Qe.width,Qe.height),st.shadowColor="white",st.shadowBlur=2,st.lineWidth=1.5,st.strokeStyle="white",st.textBaseline="top",st.font="bold 36px Open Sans, sans-serif",st.fillText(Pt,5,5),st.strokeText(Pt,5,5),it.debugOverlayTexture.update(Qe),it.debugOverlayTexture.bind(gt.LINEAR,gt.CLAMP_TO_EDGE)}(m,Ue);const Fe=Z._tileDebugTextBuffer||m.debugBuffer,He=Z._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,$e=Z._tileDebugTextSegments||m.debugSegments;q.draw(y,S.TRIANGLES,ne,he,i.ColorMode.alphaBlended,i.CullFaceMode.disabled,Ka(G,i.Color.transparent,ke),_e,Fe,He,$e,null,null,null,[Z._globeTileDebugTextBuffer])}function na(m,a,h,y){Wl(m,0,a+h/2,m.transform.width,h,y)}function wa(m,a,h,y){Wl(m,a-h/2,0,h,m.transform.height,y)}function Wl(m,a,h,y,w,S){const R=m.context,D=R.gl;D.enable(D.SCISSOR_TEST),D.scissor(a*i.exported.devicePixelRatio,h*i.exported.devicePixelRatio,y*i.exported.devicePixelRatio,w*i.exported.devicePixelRatio),R.clear({color:S}),D.disable(D.SCISSOR_TEST)}const so=i.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Dr}=so;function cr(m,a,h,y){m.emplaceBack(a,h,y)}class Ea{constructor(a){this.vertexArray=new i.StructArrayLayout3f12,this.indices=new i.StructArrayLayout3ui6,cr(this.vertexArray,-1,-1,1),cr(this.vertexArray,1,-1,1),cr(this.vertexArray,-1,1,1),cr(this.vertexArray,1,1,1),cr(this.vertexArray,-1,-1,-1),cr(this.vertexArray,1,-1,-1),cr(this.vertexArray,-1,1,-1),cr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Dr),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=i.SegmentVector.simpleSegment(0,0,36,12)}}function qr(m,a,h,y,w,S){const R=m.gl,D=a.paint.get("sky-atmosphere-color"),G=a.paint.get("sky-atmosphere-halo-color"),q=a.paint.get("sky-atmosphere-sun-intensity"),Z=((ne,he,fe,_e,ge)=>({u_matrix_3f:ne,u_sun_direction:he,u_sun_intensity:fe,u_color_tint_r:[_e.r,_e.g,_e.b,_e.a],u_color_tint_m:[ge.r,ge.g,ge.b,ge.a],u_luminance:5e-5}))(i.fromMat4(i.create$1(),y),w,q,D,G);R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+S,a.skyboxTexture,0),h.draw(m,R.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.frontCW,Z,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const To=i.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xi{constructor(a){const h=new i.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const y=new i.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,To.members),this.indexBuffer=a.createIndexBuffer(y),this.segments=i.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const eo={symbol:function(m,a,h,y,w){if(m.renderPass!=="translucent")return;const S=i.StencilMode.disabled,R=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(D,G,q,Z,ne,he,fe){const _e=G.transform,ge=ne==="map",ye=he==="map";for(const ie of D){const pe=Z.getTile(ie),we=pe.getBucket(q);if(!we||!we.text||!we.text.segments.get().length)continue;const Ee=i.evaluateSizeForZoom(we.textSizeData,_e.zoom),ke=De(ie,we.getProjection(),_e),Ue=_e.calculatePixelsToTileUnitsMatrix(pe),Fe=et(ke,pe.tileID.canonical,ye,ge,_e,we.getProjection(),Ue),He=q.layout.get("icon-text-fit")!=="none"&&we.hasIconData();if(Ee){const $e=Math.pow(2,_e.zoom-pe.tileID.overscaledZ);pr(we,ge,ye,fe,i.symbolSize,_e,Fe,ie,$e,Ee,He)}}}(y,m,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&Qn(m,a,h,y,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),S,R),h.paint.get("text-opacity").constantOr(1)!==0&&Qn(m,a,h,y,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),S,R),a.map.showCollisionBoxes&&(Ut(m,a,h,y,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Ut(m,a,h,y,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,h,y){if(m.renderPass!=="translucent")return;const w=h.paint.get("circle-opacity"),S=h.paint.get("circle-stroke-width"),R=h.paint.get("circle-stroke-opacity"),D=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)===0&&(S.constantOr(1)===0||R.constantOr(1)===0))return;const G=m.context,q=G.gl,Z=m.transform,ne=m.depthModeForSublayer(0,i.DepthMode.ReadOnly),he=i.StencilMode.disabled,fe=m.colorModeForRenderPass(),_e=Z.projection.name==="globe",ge=[i.mercatorXfromLng(Z.center.lng),i.mercatorYfromLat(Z.center.lat)],ye=[];for(let pe=0;pe<y.length;pe++){const we=y[pe],Ee=a.getTile(we),ke=Ee.getBucket(h);if(!ke||ke.projection.name!==Z.projection.name)continue;const Ue=ke.programConfigurations.get(h.id),Fe=qa(h);_e&&Fe.push("PROJECTION_GLOBE_VIEW");const He=m.useProgram("circle",Ue,Fe),$e=ke.layoutVertexBuffer,it=ke.globeExtVertexBuffer,Pt=ke.indexBuffer,Qe=Z.projection.createInversionMatrix(Z,we.canonical),gt={programConfiguration:Ue,program:He,layoutVertexBuffer:$e,globeExtVertexBuffer:it,indexBuffer:Pt,uniformValues:Qr(m,we,Ee,Qe,ge,h),tile:Ee};if(D){const st=ke.segments.get();for(const Lt of st)ye.push({segments:new i.SegmentVector([Lt]),sortKey:Lt.sortKey,state:gt})}else ye.push({segments:ke.segments,sortKey:0,state:gt})}D&&ye.sort((pe,we)=>pe.sortKey-we.sortKey);const ie={useDepthForOcclusion:!_e};for(const pe of ye){const{programConfiguration:we,program:Ee,layoutVertexBuffer:ke,globeExtVertexBuffer:Ue,indexBuffer:Fe,uniformValues:He,tile:$e}=pe.state,it=pe.segments;m.terrain&&m.terrain.setupElevationDraw($e,Ee,ie),m.prepareDrawProgram(G,Ee,$e.tileID.toUnwrapped()),Ee.draw(G,q.TRIANGLES,ne,he,fe,i.CullFaceMode.disabled,He,h.id,ke,Fe,it,h.paint,Z.zoom,we,[Ue])}},heatmap:function(m,a,h,y){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const w=m.context,S=w.gl,R=i.StencilMode.disabled,D=new i.ColorMode([S.ONE,S.ONE],i.Color.transparent,[!0,!0,!0,!0]);(function(fe,_e,ge,ye){const ie=fe.gl,pe=_e.width*ye,we=_e.height*ye;fe.activeTexture.set(ie.TEXTURE1),fe.viewport.set([0,0,pe,we]);let Ee=ge.heatmapFbo;if(!Ee||Ee&&(Ee.width!==pe||Ee.height!==we)){Ee&&Ee.destroy();const ke=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,ke),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),Ee=ge.heatmapFbo=fe.createFramebuffer(pe,we,!1),function(Ue,Fe,He,$e,it,Pt){const Qe=Ue.gl;Qe.texImage2D(Qe.TEXTURE_2D,0,Ue.isWebGL2&&Ue.extRenderToTextureHalfFloat?Qe.RGBA16F:Qe.RGBA,it,Pt,0,Qe.RGBA,Ue.extRenderToTextureHalfFloat?Ue.isWebGL2?Qe.HALF_FLOAT:Ue.extTextureHalfFloat.HALF_FLOAT_OES:Qe.UNSIGNED_BYTE,null),$e.colorAttachment.set(He)}(fe,0,ke,Ee,pe,we)}else ie.bindTexture(ie.TEXTURE_2D,Ee.colorAttachment.get()),fe.bindFramebuffer.set(Ee.framebuffer)})(w,m,h,m.transform.projection.name==="globe"?.5:.25),w.clear({color:i.Color.transparent});const G=m.transform,q=G.projection.name==="globe",Z=q?["PROJECTION_GLOBE_VIEW"]:null,ne=q?i.CullFaceMode.frontCCW:i.CullFaceMode.disabled,he=[i.mercatorXfromLng(G.center.lng),i.mercatorYfromLat(G.center.lat)];for(let fe=0;fe<y.length;fe++){const _e=y[fe];if(a.hasRenderableParent(_e))continue;const ge=a.getTile(_e),ye=ge.getBucket(h);if(!ye||ye.projection.name!==G.projection.name)continue;const ie=ye.programConfigurations.get(h.id),pe=m.useProgram("heatmap",ie,Z),{zoom:we}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ge,pe),m.prepareDrawProgram(w,pe,_e.toUnwrapped());const Ee=G.projection.createInversionMatrix(G,_e.canonical);pe.draw(w,S.TRIANGLES,i.DepthMode.disabled,R,D,ne,Hc(m,_e,ge,Ee,he,we,h.paint.get("heatmap-intensity")),h.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,h.paint,m.transform.zoom,ie,q?[ye.globeExtVertexBuffer]:null)}w.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(w,S){const R=w.context,D=R.gl,G=S.heatmapFbo;if(!G)return;R.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,G.colorAttachment.get()),R.activeTexture.set(D.TEXTURE1);let q=S.colorRampTexture;q||(q=S.colorRampTexture=new i.Texture(R,S.colorRamp,D.RGBA)),q.bind(D.LINEAR,D.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(R,D.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,w.colorModeForRenderPass(),i.CullFaceMode.disabled,((Z,ne,he,fe)=>({u_image:0,u_color_ramp:1,u_opacity:ne.paint.get("heatmap-opacity")}))(0,S),S.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,S.paint,w.transform.zoom)}(m,h))},line:function(m,a,h,y){if(m.renderPass!=="translucent")return;const w=h.paint.get("line-opacity"),S=h.paint.get("line-width");if(w.constantOr(1)===0||S.constantOr(1)===0)return;const R=m.depthModeForSublayer(0,i.DepthMode.ReadOnly),D=m.colorModeForRenderPass(),G=m.terrain&&m.terrain.renderingToTexture?1:i.exported.devicePixelRatio,q=h.paint.get("line-dasharray"),Z=q.constantOr(1),ne=h.layout.get("line-cap"),he=h.paint.get("line-pattern"),fe=he.constantOr(1),_e=h.paint.get("line-gradient"),ge=fe?"linePattern":"line",ye=m.context,ie=ye.gl,pe=(Ee=>{const ke=[];El(Ee)&&ke.push("RENDER_LINE_DASH"),Ee.paint.get("line-gradient")&&ke.push("RENDER_LINE_GRADIENT");const Ue=Ee.paint.get("line-trim-offset");Ue[0]===0&&Ue[1]===0||ke.push("RENDER_LINE_TRIM_OFFSET");const Fe=Ee.paint.get("line-pattern").constantOr(1),He=Ee.paint.get("line-opacity").constantOr(1)!==1;return!Fe&&He&&ke.push("RENDER_LINE_ALPHA_DISCARD"),ke})(h);let we=pe.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(we=!1);for(const Ee of y){const ke=a.getTile(Ee);if(fe&&!ke.patternsLoaded())continue;const Ue=ke.getBucket(h);if(!Ue)continue;m.prepareDrawTile();const Fe=Ue.programConfigurations.get(h.id),He=m.useProgram(ge,Fe,pe),$e=he.constantOr(null);if($e&&ke.imageAtlas){const mt=ke.imageAtlas.patternPositions[$e.toString()];mt&&Fe.setConstantPatternPositions(mt)}const it=q.constantOr(null),Pt=ne.constantOr(null);if(!fe&&it&&Pt&&ke.lineAtlas){const mt=ke.lineAtlas.getDash(it,Pt);mt&&Fe.setConstantPatternPositions(mt)}let[Qe,gt]=h.paint.get("line-trim-offset");(Pt==="round"||Pt==="square")&&Qe!==gt&&(Qe===0&&(Qe-=1),gt===1&&(gt+=1));const st=m.terrain?Ee.projMatrix:null,Lt=fe?$l(m,ke,h,st,G):Qs(m,ke,h,st,Ue.lineClipsArray.length,G,[Qe,gt]);if(_e){const mt=Ue.gradients[h.id];let xt=mt.texture;if(h.gradientVersion!==mt.version){let at=256;if(h.stepInterpolant){const Et=a.getSource().maxzoom,rn=Ee.canonical.z===Et?Math.ceil(1<<m.transform.maxZoom-Ee.canonical.z):1;at=i.clamp(i.nextPowerOfTwo(Ue.maxLineLength/i.EXTENT*1024*rn),256,ye.maxTextureSize)}mt.gradient=i.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:at,image:mt.gradient||void 0,clips:Ue.lineClipsArray}),mt.texture?mt.texture.update(mt.gradient):mt.texture=new i.Texture(ye,mt.gradient,ie.RGBA),mt.version=h.gradientVersion,xt=mt.texture}ye.activeTexture.set(ie.TEXTURE1),xt.bind(h.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}Z&&(ye.activeTexture.set(ie.TEXTURE0),ke.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),Fe.updatePaintBuffers()),fe&&(ye.activeTexture.set(ie.TEXTURE0),ke.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Fe.updatePaintBuffers()),m.prepareDrawProgram(ye,He,Ee.toUnwrapped());const tt=mt=>{He.draw(ye,ie.TRIANGLES,R,mt,D,i.CullFaceMode.disabled,Lt,h.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,h.paint,m.transform.zoom,Fe,[Ue.layoutVertexBuffer2])};if(we){const mt=m.stencilModeForClipping(Ee).ref;mt===0&&m.terrain&&ye.clear({stencil:0});const xt={func:ie.EQUAL,mask:255};Lt.u_alpha_discard_threshold=.8,tt(new i.StencilMode(xt,mt,255,ie.KEEP,ie.KEEP,ie.INVERT)),Lt.u_alpha_discard_threshold=0,tt(new i.StencilMode(xt,mt,255,ie.KEEP,ie.KEEP,ie.KEEP))}else tt(m.stencilModeForClipping(Ee))}we&&(m.resetStencilClippingMasks(),m.terrain&&ye.clear({stencil:0}))},fill:function(m,a,h,y){const w=h.paint.get("fill-color"),S=h.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const R=m.colorModeForRenderPass(),D=h.paint.get("fill-pattern"),G=m.opaquePassEnabledForLayer()&&!D.constantOr(1)&&w.constantOr(i.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===G){const q=m.depthModeForSublayer(1,m.renderPass==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly);Mi(m,a,h,y,q,R,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const q=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,i.DepthMode.ReadOnly);Mi(m,a,h,y,q,R,!0)}},"fill-extrusion":function(m,a,h,y){const w=h.paint.get("fill-extrusion-opacity");if(w!==0&&m.renderPass==="translucent"){const S=new i.DepthMode(m.context.gl.LEQUAL,i.DepthMode.ReadWrite,m.depthRangeFor3D);if(w!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))vi(m,a,h,y,S,i.StencilMode.disabled,i.ColorMode.disabled),vi(m,a,h,y,S,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const R=m.colorModeForRenderPass();vi(m,a,h,y,S,i.StencilMode.disabled,R)}}},hillshade:function(m,a,h,y){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const w=m.context,S=m.depthModeForSublayer(0,i.DepthMode.ReadOnly),R=m.colorModeForRenderPass(),D=m.terrain&&m.terrain.renderingToTexture,[G,q]=m.renderPass!=="translucent"||D?[{},y]:m.stencilConfigForOverlap(y);for(const Z of q){const ne=a.getTile(Z);if(ne.needsHillshadePrepare&&m.renderPass==="offscreen")Ou(m,ne,h,S,i.StencilMode.disabled,R);else if(m.renderPass==="translucent"){const he=D&&m.terrain?m.terrain.stencilModeForRTTOverlap(Z):G[Z.overscaledZ];Js(m,Z,ne,h,S,he,R)}}w.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,h,y,w,S){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!y.length)return;const R=m.context,D=R.gl,G=a.getSource(),q=m.useProgram("raster"),Z=m.colorModeForRenderPass(),ne=m.terrain&&m.terrain.renderingToTexture,[he,fe]=G instanceof Un||ne?[{},y]:m.stencilConfigForOverlap(y),_e=fe[fe.length-1].overscaledZ,ge=!m.options.moving;for(const ye of fe){const ie=ne?i.DepthMode.disabled:m.depthModeForSublayer(ye.overscaledZ-_e,h.paint.get("raster-opacity")===1?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly,D.LESS),pe=ye.toUnwrapped(),we=a.getTile(ye);if(ne&&(!we||!we.hasData()))continue;const Ee=ne?ye.projMatrix:m.transform.calculateProjMatrix(pe,ge),ke=m.terrain&&ne?m.terrain.stencilModeForRTTOverlap(ye):he[ye.overscaledZ],Ue=S?0:h.paint.get("raster-fade-duration");we.registerFadeDuration(Ue);const Fe=a.findLoadedParent(ye,0),He=Ha(we,Fe,a,m.transform,Ue);let $e,it;m.terrain&&m.terrain.prepareDrawTile();const Pt=h.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;R.activeTexture.set(D.TEXTURE0),we.texture.bind(Pt,D.CLAMP_TO_EDGE),R.activeTexture.set(D.TEXTURE1),Fe?(Fe.texture.bind(Pt,D.CLAMP_TO_EDGE),$e=Math.pow(2,Fe.tileID.overscaledZ-we.tileID.overscaledZ),it=[we.tileID.canonical.x*$e%1,we.tileID.canonical.y*$e%1]):we.texture.bind(Pt,D.CLAMP_TO_EDGE),we.texture.useMipmap&&R.extTextureFilterAnisotropic&&m.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Qe=ea(Ee,it||[0,0],$e||1,He,h,G instanceof Un?G.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(R,q,pe),G instanceof Un)G.boundsBuffer&&G.boundsSegments&&q.draw(R,D.TRIANGLES,ie,i.StencilMode.disabled,Z,i.CullFaceMode.disabled,Qe,h.id,G.boundsBuffer,m.quadTriangleIndexBuffer,G.boundsSegments);else{const{tileBoundsBuffer:gt,tileBoundsIndexBuffer:st,tileBoundsSegments:Lt}=m.getTileBoundsBuffers(we);q.draw(R,D.TRIANGLES,ie,ke,Z,i.CullFaceMode.disabled,Qe,h.id,gt,st,Lt)}}m.resetStencilClippingMasks()},background:function(m,a,h,y){const w=h.paint.get("background-color"),S=h.paint.get("background-opacity");if(S===0)return;const R=m.context,D=R.gl,G=m.transform,q=G.tileSize,Z=h.paint.get("background-pattern");if(m.isPatternMissing(Z))return;const ne=!Z&&w.a===1&&S===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ne)return;const he=i.StencilMode.disabled,fe=m.depthModeForSublayer(0,ne==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly),_e=m.colorModeForRenderPass(),ge=m.useProgram(Z?"backgroundPattern":"background");let ye,ie=y;ie||(ye=m.getBackgroundTiles(),ie=Object.values(ye).map(pe=>pe.tileID)),Z&&(R.activeTexture.set(D.TEXTURE0),m.imageManager.bind(m.context));for(const pe of ie){const we=pe.toUnwrapped(),Ee=y?pe.projMatrix:m.transform.calculateProjMatrix(we);m.prepareDrawTile();const ke=a?a.getTile(pe):ye?ye[pe.key]:new i.Tile(pe,q,G.zoom,m),Ue=Z?Ts(Ee,S,m,Z,{tileID:pe,tileSize:q}):Ya(Ee,S,w);m.prepareDrawProgram(R,ge,we);const{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:He,tileBoundsSegments:$e}=m.getTileBoundsBuffers(ke);ge.draw(R,D.TRIANGLES,fe,he,_e,i.CullFaceMode.disabled,Ue,h.id,Fe,He,$e)}},sky:function(m,a,h){const y=m.transform,w=y.projection.name==="mercator"||y.projection.name==="globe"?1:i.smoothstep(7,8,y.zoom),S=h.paint.get("sky-opacity")*w;if(S===0)return;const R=m.context,D=h.paint.get("sky-type"),G=new i.DepthMode(R.gl.LEQUAL,i.DepthMode.ReadOnly,[0,1]),q=m.frameCounter/1e3%1;D==="atmosphere"?m.renderPass==="offscreen"?h.needsSkyboxCapture(m)&&(function(Z,ne,he,fe){const _e=Z.context,ge=_e.gl;let ye=ne.skyboxFbo;if(!ye){ye=ne.skyboxFbo=_e.createFramebuffer(32,32,!1),ne.skyboxGeometry=new Ea(_e),ne.skyboxTexture=_e.gl.createTexture(),ge.bindTexture(ge.TEXTURE_CUBE_MAP,ne.skyboxTexture),ge.texParameteri(ge.TEXTURE_CUBE_MAP,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_CUBE_MAP,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_CUBE_MAP,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_CUBE_MAP,ge.TEXTURE_MAG_FILTER,ge.LINEAR);for(let Ee=0;Ee<6;++Ee)ge.texImage2D(ge.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,ge.RGBA,32,32,0,ge.RGBA,ge.UNSIGNED_BYTE,null)}_e.bindFramebuffer.set(ye.framebuffer),_e.viewport.set([0,0,32,32]);const ie=ne.getCenter(Z,!0),pe=Z.useProgram("skyboxCapture"),we=new Float64Array(16);i.identity(we),i.rotateY(we,we,.5*-Math.PI),qr(_e,ne,pe,we,ie,0),i.identity(we),i.rotateY(we,we,.5*Math.PI),qr(_e,ne,pe,we,ie,1),i.identity(we),i.rotateX(we,we,.5*-Math.PI),qr(_e,ne,pe,we,ie,2),i.identity(we),i.rotateX(we,we,.5*Math.PI),qr(_e,ne,pe,we,ie,3),i.identity(we),qr(_e,ne,pe,we,ie,4),i.identity(we),i.rotateY(we,we,Math.PI),qr(_e,ne,pe,we,ie,5),_e.viewport.set([0,0,Z.width,Z.height])}(m,h),h.markSkyboxValid(m)):m.renderPass==="sky"&&function(Z,ne,he,fe,_e){const ge=Z.context,ye=ge.gl,ie=Z.transform,pe=Z.useProgram("skybox");ge.activeTexture.set(ye.TEXTURE0),ye.bindTexture(ye.TEXTURE_CUBE_MAP,ne.skyboxTexture);const we=((Ee,ke,Ue,Fe,He)=>({u_matrix:Ee,u_sun_direction:ke,u_cubemap:0,u_opacity:Fe,u_temporal_offset:He}))(ie.skyboxMatrix,ne.getCenter(Z,!1),0,fe,_e);Z.prepareDrawProgram(ge,pe),pe.draw(ge,ye.TRIANGLES,he,i.StencilMode.disabled,Z.colorModeForRenderPass(),i.CullFaceMode.backCW,we,"skybox",ne.skyboxGeometry.vertexBuffer,ne.skyboxGeometry.indexBuffer,ne.skyboxGeometry.segment)}(m,h,G,S,q):D==="gradient"&&m.renderPass==="sky"&&function(Z,ne,he,fe,_e){const ge=Z.context,ye=ge.gl,ie=Z.transform,pe=Z.useProgram("skyboxGradient");ne.skyboxGeometry||(ne.skyboxGeometry=new Ea(ge)),ge.activeTexture.set(ye.TEXTURE0);let we=ne.colorRampTexture;we||(we=ne.colorRampTexture=new i.Texture(ge,ne.colorRamp,ye.RGBA)),we.bind(ye.LINEAR,ye.CLAMP_TO_EDGE);const Ee=((ke,Ue,Fe,He,$e)=>({u_matrix:ke,u_color_ramp:0,u_center_direction:Ue,u_radius:i.degToRad(Fe),u_opacity:He,u_temporal_offset:$e}))(ie.skyboxMatrix,ne.getCenter(Z,!1),ne.paint.get("sky-gradient-radius"),fe,_e);Z.prepareDrawProgram(ge,pe),pe.draw(ge,ye.TRIANGLES,he,i.StencilMode.disabled,Z.colorModeForRenderPass(),i.CullFaceMode.backCW,Ee,"skyboxGradient",ne.skyboxGeometry.vertexBuffer,ne.skyboxGeometry.indexBuffer,ne.skyboxGeometry.segment)}(m,h,G,S,q)},debug:function(m,a,h){for(let y=0;y<h.length;y++)ba(m,a,h[y])},custom:function(m,a,h,y){const w=m.context,S=h.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&h.isLayerDraped()){if(m.renderPass==="offscreen"){const R=S.prerender;if(R){if(m.setCustomLayerDefaults(),w.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const D=m.transform.pointMerc;R.call(S,w.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.globeToMercatorTransition(m.transform.zoom),[D.x,D.y],m.transform.pixelsPerMeterRatio)}else R.call(S,w.gl,m.transform.customLayerMatrix());w.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const D=S.renderToTile;if(D){const G=y[0].canonical,q=new i.MercatorCoordinate(G.x+y[0].wrap*(1<<G.z),G.y,G.z);w.setDepthMode(i.DepthMode.disabled),w.setStencilMode(i.StencilMode.disabled),w.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),D.call(S,w.gl,q),w.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),w.setColorMode(m.colorModeForRenderPass()),w.setStencilMode(i.StencilMode.disabled);const R=S.renderingMode==="3d"?new i.DepthMode(m.context.gl.LEQUAL,i.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,i.DepthMode.ReadOnly);if(w.setDepthMode(R),m.transform.projection.name==="globe"){const D=m.transform.pointMerc;S.render(w.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.globeToMercatorTransition(m.transform.zoom),[D.x,D.y],m.transform.pixelsPerMeterRatio)}else S.render(w.gl,m.transform.customLayerMatrix());w.setDirty(),m.setBaseState(),w.bindFramebuffer.set(null)}}else i.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class So{constructor(a,h,y=!1){this.context=new Rt(a,y),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=i.SourceCache.maxUnderzooming+i.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,h){const y=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Fi(this,a));const w=this._terrain;this.transform.elevation=y?w:null,w.update(a,this.transform,h)}_updateFog(a){const h=a.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,w]=h.getFovAdjustedRange(this.transform._fov);if(y>w)return void(this.transform.fogCullDistSq=null);const S=y+.78*(w-y);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,h){if(this.width=a*i.exported.devicePixelRatio,this.height=h*i.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._layers[y].resize()}setup(){const a=this.context,h=new i.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(i.EXTENT,0),h.emplaceBack(0,i.EXTENT),h.emplaceBack(i.EXTENT,i.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(h,i.posAttributes.members),this.tileExtentSegments=i.SegmentVector.simpleSegment(0,0,4,2);const y=new i.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(i.EXTENT,0),y.emplaceBack(0,i.EXTENT),y.emplaceBack(i.EXTENT,i.EXTENT),this.debugBuffer=a.createVertexBuffer(y,i.posAttributes.members),this.debugSegments=i.SegmentVector.simpleSegment(0,0,4,5);const w=new i.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(w,i.posAttributes.members),this.viewportSegments=i.SegmentVector.simpleSegment(0,0,4,2);const S=new i.StructArrayLayout4i8;S.emplaceBack(0,0,0,0),S.emplaceBack(i.EXTENT,0,i.EXTENT,0),S.emplaceBack(0,i.EXTENT,0,i.EXTENT),S.emplaceBack(i.EXTENT,i.EXTENT,i.EXTENT,i.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(S,i.boundsAttributes.members),this.mercatorBoundsSegments=i.SegmentVector.simpleSegment(0,0,4,2);const R=new i.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(R);const D=new i.StructArrayLayout1ui2;for(const q of[0,1,3,2,0])D.emplaceBack(q);this.debugIndexBuffer=a.createIndexBuffer(D),this.emptyTexture=new i.Texture(a,new i.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=i.create();const G=this.context.gl;this.stencilClearMode=new i.StencilMode({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.loadTimeStamps.push(i.window.performance.now()),this.atmosphereBuffer=new Xi(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,h=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,h.TRIANGLES,i.DepthMode.disabled,this.stencilClearMode,i.ColorMode.disabled,i.CullFaceMode.disabled,wl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,y){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const G of y)if(this._tileClippingMaskIDs[G.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=h.id;const w=this.context,S=w.gl;this.nextStencilID+y.length>256&&this.clearStencil(),w.setColorMode(i.ColorMode.disabled),w.setDepthMode(i.DepthMode.disabled);const R=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of y){const G=h.getTile(D),q=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:Z,tileBoundsIndexBuffer:ne,tileBoundsSegments:he}=this.getTileBoundsBuffers(G);R.draw(w,S.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:S.ALWAYS,mask:0},q,255,S.KEEP,S.KEEP,S.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,wl(D.projMatrix),"$clipping",Z,ne,he)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new i.StencilMode({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const h=this.context.gl;return new i.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){const h=this.context.gl,y=a.sort((R,D)=>D.overscaledZ-R.overscaledZ),w=y[y.length-1].overscaledZ,S=y[0].overscaledZ-w+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const R={};for(let D=0;D<S;D++)R[D+w]=new i.StencilMode({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=S,[R,y]}return[{[w]:i.StencilMode.disabled},y]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new i.ColorMode([a.CONSTANT_COLOR,a.ONE],new i.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?i.ColorMode.unblended:i.ColorMode.alphaBlended}depthModeForSublayer(a,h,y){if(!this.opaquePassEnabledForLayer())return i.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new i.DepthMode(y||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,h){this.style=a,this.options=h,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(i.exported.now()),this.imageManager.beginFrame();const y=this.style.order,w=this.style._sourceCaches;for(const q in w){const Z=w[q];Z.used&&Z.prepare(this.context)}const S={},R={},D={};for(const q in w){const Z=w[q];S[q]=Z.getVisibleCoordinates(),R[q]=S[q].slice().reverse(),D[q]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<y.length;q++)if(this.style._layers[y[q]].is3D()){this.opaquePassCutoff=q;break}if(this.terrain&&(this.terrain.updateTileBinding(D),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.GlobeSharedBuffers(this.context)),!i.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const q of y){const Z=this.style._layers[q],ne=a._getLayerSourceCache(Z);if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const he=ne?R[ne.id]:void 0;(Z.type==="custom"||Z.isSky()||he&&he.length)&&this.renderLayer(this,ne,Z,he)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const G=this.terrain;if(G&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&G.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?i.Color.black:i.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[y[this.currentLayer]],Z=a._getLayerSourceCache(q);if(q.isSky())continue;const ne=Z?R[Z.id]:void 0;this._renderTileClippingMasks(q,Z,ne),this.renderLayer(this,Z,q,ne)}if(this.style.fog&&this.transform.projection.supportsFog&&function(q,Z){const ne=q.context,he=ne.gl,fe=q.transform,_e=new i.DepthMode(he.LEQUAL,i.DepthMode.ReadOnly,[0,1]),ge=q.useProgram("globeAtmosphere",null,fe.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ye=i.globeToMercatorTransition(fe.zoom),ie=Z.properties.get("color").toArray01(),pe=Z.properties.get("high-color").toArray01(),we=Z.properties.get("space-color").toArray01PremultipliedAlpha(),Ee=i.identity$1([]);i.rotateY$1(Ee,Ee,-i.degToRad(fe._center.lng)),i.rotateX$1(Ee,Ee,i.degToRad(fe._center.lat)),i.rotateZ$1(Ee,Ee,fe.angle),i.rotateX$1(Ee,Ee,-fe._pitch);const ke=i.fromQuat(new Float32Array(16),Ee),Ue=i.mapValue(Z.properties.get("star-intensity"),0,1,0,.25),Fe=5e-4,He=i.mapValue(Z.properties.get("horizon-blend"),0,1,Fe,.25),$e=i.globeUseCustomAntiAliasing(q,ne,fe)&&He===Fe?fe.worldSize/(2*Math.PI*1.025)-1:fe.globeRadius,it=q.frameCounter/1e3%1,Pt=i.length(fe.globeCenterInViewSpace),Qe=Math.sqrt(Math.pow(Pt,2)-Math.pow($e,2)),gt=Math.acos(Qe/Pt),st=((tt,mt,xt,at,Et,rn,fn,qt,gn,An,Nn,un,xr,Or)=>({u_frustum_tl:tt,u_frustum_tr:mt,u_frustum_br:xt,u_frustum_bl:at,u_horizon:Et,u_transition:rn,u_fadeout_range:fn,u_color:qt,u_high_color:gn,u_space_color:An,u_star_intensity:Nn,u_star_size:5*i.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:un,u_horizon_angle:xr,u_rotation_matrix:Or}))(fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.frustumCorners.horizon,ye,He,ie,pe,we,Ue,it,gt,ke);q.prepareDrawProgram(ne,ge);const Lt=q.atmosphereBuffer;Lt&&ge.draw(ne,he.TRIANGLES,_e,i.StencilMode.disabled,i.ColorMode.alphaBlended,i.CullFaceMode.backCW,st,"skybox",Lt.vertexBuffer,Lt.indexBuffer,Lt.segments)}(this,this.style.fog),this.renderPass="sky",(i.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const q=this.style._layers[y[this.currentLayer]],Z=a._getLayerSourceCache(q);q.isSky()&&this.renderLayer(this,Z,q,Z?R[Z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;){const q=this.style._layers[y[this.currentLayer]],Z=a._getLayerSourceCache(q);if(q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(q)){if(q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ne=Z?(q.type==="symbol"?D:R)[Z.id]:void 0;this._renderTileClippingMasks(q,Z,Z?S[Z.id]:void 0),this.renderLayer(this,Z,q,ne),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let q=null;i.values(this.style._layers).forEach(Z=>{const ne=a._getLayerSourceCache(Z);ne&&!Z.isHidden(this.transform.zoom)&&(!q||q.getSource().maxzoom<ne.getSource().maxzoom)&&(q=ne)}),q&&this.options.showTileBoundaries&&eo.debug(this,q,q.getVisibleCoordinates())}this.options.showPadding&&function(q){const Z=q.transform.padding;na(q,q.transform.height-(Z.top||0),3,di),na(q,Z.bottom||0,3,ji),wa(q,Z.left||0,3,Rr),wa(q,q.transform.width-(Z.right||0),3,Ri);const ne=q.transform.centerPoint;(function(he,fe,_e,ge){Wl(he,fe-1,_e-10,2,20,ge),Wl(he,fe-10,_e-1,20,2,ge)})(q,ne.x,q.transform.height-ne.y,Di)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(i.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,h,y,w){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||w&&w.length)&&(this.id=y.id,this.gpuTimingStart(y),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(y.type)||a.terrain&&y.type==="custom")&&eo[y.type](a,h,y,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let y=this.gpuTimers[a.id];y||(y=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),y.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,h=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),a.beginQueryEXT(a.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const h={};for(const y in a){const w=a[y],S=this.context.extTimerQuery,R=S.getQueryObjectEXT(w.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(w.query),h[y]=R}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let y=0;for(const w of a)y+=h.getQueryObjectEXT(w,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(w);return y}translatePosMatrix(a,h,y,w,S){if(!y[0]&&!y[1])return a;const R=S?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(R){const q=Math.sin(R),Z=Math.cos(R);y=[y[0]*Z-y[1]*q,y[0]*q+y[1]*Z]}const D=[S?y[0]:mn(h,y[0],this.transform.zoom),S?y[1]:mn(h,y[1],this.transform.zoom),0],G=new Float32Array(16);return i.translate(G,a,D),G}saveTileTexture(a){const h=this._tileTextures[a.size[0]];h?h.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}isPatternMissing(a){return a===null||a!==void 0&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&this.terrain.exaggeration()===0,y=this.style&&this.style.fog,w=[];return this.terrainRenderModeElevated()&&w.push("TERRAIN"),this.transform.projection.name==="globe"&&w.push("GLOBE"),h&&w.push("ZERO_EXAGGERATION"),y&&!a&&y.getOpacity(this.transform.pitch)!==0&&w.push("FOG"),a&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}useProgram(a,h,y){this.cache=this.cache||{};const w=y||[],S=this.currentGlobalDefines().concat(w),R=Pn.cacheKey(jo[a],a,S,h);return this.cache[R]||(this.cache[R]=new Pn(this.context,a,jo[a],h,We[a],S)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=i.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,h,y){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const S=w.getOpacity(this.transform.pitch),R=((D,G,q,Z,ne,he,fe,_e,ge,ye,ie)=>{const pe=D.transform,we=G.properties.get("color").toArray01();we[3]=Z;const Ee=D.frameCounter/1e3%1;return{u_fog_matrix:q?pe.calculateFogTileMatrix(q):D.identityMat,u_fog_range:G.getFovAdjustedRange(pe._fov),u_fog_color:we,u_fog_horizon_blend:G.properties.get("horizon-blend"),u_fog_temporal_offset:Ee,u_frustum_tl:ne,u_frustum_tr:he,u_frustum_br:fe,u_frustum_bl:_e,u_globe_pos:ge,u_globe_radius:ye,u_viewport:ie,u_globe_transition:i.globeToMercatorTransition(pe.zoom),u_is_globe:+(pe.projection.name==="globe")}})(this,w,y,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.exported.devicePixelRatio,this.transform.height*i.exported.devicePixelRatio]);h.setFogUniformValues(a,R)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,h=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const w of y)h[w.key]=a[w.key]||new i.Tile(w,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Ca{constructor(a=0,h=0,y=0,w=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=y,this.right=w}interpolate(a,h,y){return h.top!=null&&a.top!=null&&(this.top=i.number(a.top,h.top,y)),h.bottom!=null&&a.bottom!=null&&(this.bottom=i.number(a.bottom,h.bottom,y)),h.left!=null&&a.left!=null&&(this.left=i.number(a.left,h.left,y)),h.right!=null&&a.right!=null&&(this.right=i.number(a.right,h.right,y)),this}getCenter(a,h){const y=i.clamp((this.left+a-this.right)/2,0,a),w=i.clamp((this.top+h-this.bottom)/2,0,h);return new i.Point(y,w)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Qa(m,a){const h=i.getColumn(m,3);i.fromQuat(m,a),i.setColumn(m,3,h)}function nr(m,a){const h=i.identity$1([]);return i.rotateZ$1(h,h,-a),i.rotateX$1(h,h,-m),h}function Ss(m,a){const h=[m[0],m[1],0],y=[a[0],a[1],0];if(i.length(h)>=1e-15){const R=i.normalize([],h);i.scale$2(y,R,i.dot(y,R)),a[0]=y[0],a[1]=y[1]}const w=i.cross([],a,m);if(i.len(w)<1e-15)return null;const S=Math.atan2(-w[1],w[0]);return nr(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),S)}class Wc{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){const h=a instanceof i.MercatorCoordinate?a:new i.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=i.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;const y=this.position,w=this._elevation?this._elevation.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(a)):0,S=i.MercatorCoordinate.fromLngLat(a,w),R=[S.x-y.x,S.y-y.y,S.z-y.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Ss(R,h)}setPitchBearing(a,h){this.orientation=nr(i.degToRad(a),i.degToRad(-h))}}class el{constructor(a,h){this._transform=i.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){const a=this.position;return new i.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=i.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&i.setColumn(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||i.identity$1([]),a&&Qa(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=nr(a,h),Qa(this._transform,this._orientation)}forward(){const a=i.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=i.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=i.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){const y=new Float64Array(16);return i.invert(y,this.getWorldToCamera(a,h)),y}getWorldToCameraPosition(a,h,y){const w=this.position;i.scale$2(w,w,-a);const S=new Float64Array(16);return i.fromScaling(S,[y,y,y]),i.translate(S,S,w),S[10]*=h,S}getWorldToCamera(a,h){const y=new Float64Array(16),w=new Float64Array(4),S=this.position;return i.conjugate(w,this._orientation),i.scale$2(S,S,-a),i.fromQuat(y,w),i.translate(y,y,S),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=h,y[9]*=h,y[10]*=h,y[11]*=h,y}getCameraToClipPerspective(a,h,y,w){const S=new Float64Array(16);return i.perspective(S,a,h,y,w),S}getDistanceToElevation(a,h=!1){const y=a===0?0:i.mercatorZfromAltitude(a,h?i.latFromMercatorY(this.position[1]):this.position[1]),w=this.forward();return(y-this.position[2])/w[2]}clone(){return new el([...this.position],[...this.orientation])}}function ra(m,a){const h=tl(m.projection,m.zoom,m.width,m.height),y=function(S,R,D,G,q){const Z=new i.LngLat(D.lng-180*gs,D.lat),ne=new i.LngLat(D.lng+180*gs,D.lat),he=S.project(Z.lng,Z.lat),fe=S.project(ne.lng,ne.lat),_e=-Math.atan2(fe.y-he.y,fe.x-he.x),ge=i.MercatorCoordinate.fromLngLat(D);ge.y=i.clamp(ge.y,-1+gs,1-gs);const ye=ge.toLngLat(),ie=S.project(ye.lng,ye.lat),pe=i.MercatorCoordinate.fromLngLat(ye);pe.x+=gs;const we=pe.toLngLat(),Ee=S.project(we.lng,we.lat),ke=Ta(Ee.x-ie.x,Ee.y-ie.y,_e),Ue=i.MercatorCoordinate.fromLngLat(ye);Ue.y+=gs;const Fe=Ue.toLngLat(),He=S.project(Fe.lng,Fe.lat),$e=Ta(He.x-ie.x,He.y-ie.y,_e),it=Math.abs(ke.x)/Math.abs($e.y),Pt=i.identity([]);i.rotateZ(Pt,Pt,-_e*(1-(q?0:G)));const Qe=i.identity([]);return i.scale(Qe,Qe,[1,1-(1-it)*G,1]),Qe[4]=-$e.x/$e.y*G,i.rotateZ(Qe,Qe,_e),i.multiply(Qe,Pt,Qe),Qe}(m.projection,0,m.center,h,a),w=Aa(m);return i.scale(y,y,[w,w,1]),y}function Aa(m){const a=m.projection,h=tl(m.projection,m.zoom,m.width,m.height),y=nl(a,m.center),w=nl(a,i.LngLat.convert(a.center));return Math.pow(2,y*h+(1-h)*w)}function tl(m,a,h,y,w=1/0){const S=m.range;if(!S)return 0;const R=Math.min(w,Math.max(h,y)),D=Math.log(R/1024)/Math.LN2;return i.smoothstep(S[0]+D,S[1]+D,a)}const gs=1/4e4;function nl(m,a){const h=i.clamp(a.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),y=new i.LngLat(a.lng-180*gs,h),w=new i.LngLat(a.lng+180*gs,h),S=m.project(y.lng,h),R=m.project(w.lng,h),D=i.MercatorCoordinate.fromLngLat(y),G=i.MercatorCoordinate.fromLngLat(w),q=R.x-S.x,Z=R.y-S.y,ne=G.x-D.x,he=G.y-D.y,fe=Math.sqrt((ne*ne+he*he)/(q*q+Z*Z));return Math.log(fe)/Math.LN2}function Ta(m,a,h){const y=Math.cos(h),w=Math.sin(h);return{x:m*y-a*w,y:m*w+a*y}}class rl{constructor(a,h,y,w,S,R,D){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=w??60,this.setProjection(R),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new i.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ca,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new el,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new rl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,h=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(a||y)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return i.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=i.getProjection(this.projectionOptions);const y=!E(h,this.getProjection());return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.getProjection({name:"mercator"});const h=a!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.Point(this.width,this.height)}get bearing(){return i.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const h=-a*Math.PI/180;var y;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(y=new i.ARRAY_TYPE(4),i.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y),function(w,S,R){var D=S[0],G=S[1],q=S[2],Z=S[3],ne=Math.sin(R),he=Math.cos(R);w[0]=D*he+q*ne,w[1]=G*he+Z*ne,w[2]=D*-ne+q*he,w[3]=G*-ne+Z*he}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const h=i.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=i.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let w=0,S=0;for(let R=0;R<h.length;R++){const D=new i.Point(h[R][0]*this.width,y+h[R][1]*(this.height-y)),G=a.pointCoordinate(D);if(!G)continue;const q=1/Math.hypot(G[0]-this._camera.position[0],G[1]-this._camera.position[1]);w+=G[3]*q,S+=q}return S===0?NaN:w/S}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(a),S=this._mercatorZfromZoom(this._maxZoom),R=Math.max(w-y,S);this._setZoom(this._zoomFromMercatorZ(R))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let y;y=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];const w=i.length(i.sub([],this._camera.position,y));return i.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!i.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){const y=[a.position.x,a.position.y,a.position.z];i.exactEquals$1(y,this._camera.position)||(this._setCameraPosition(y),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,h=new Wc;return h.position=new i.MercatorCoordinate(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!i.length$1(a))return!1;i.normalize$1(a,a);const h=i.transformQuat([],[0,0,-1],a),y=i.transformQuat([],[0,-1,0],a);if(y[2]<0)return!1;const w=Ss(h,y);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(a){const h=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;a[2]=i.clamp(a[2],w/y,w/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,y){this._unmodified=!1,this._edgeInsets.interpolate(a,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){const h=[new i.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const y=this.pointCoordinate(new i.Point(0,0)),w=this.pointCoordinate(new i.Point(this.width,0)),S=this.pointCoordinate(new i.Point(this.width,this.height)),R=this.pointCoordinate(new i.Point(0,this.height)),D=Math.floor(Math.min(y.x,w.x,S.x,R.x)),G=Math.floor(Math.max(y.x,w.x,S.x,R.x)),q=1;for(let Z=D-q;Z<=G+q;Z++)Z!==0&&h.push(new i.UnwrappedTileID(Z,a))}return h}coveringTiles(a){let h=this.coveringZoomLevel(a);const y=h,w=this.elevation&&!a.isTerrainDEM,S=this.projection.name==="mercator";if(a.minzoom!==void 0&&h<a.minzoom)return[];a.maxzoom!==void 0&&h>a.maxzoom&&(h=a.maxzoom);const R=this.locationCoordinate(this.center),D=this.center.lat,G=1<<h,q=[G*R.x,G*R.y,0],Z=this.projection.name==="globe",ne=!Z,he=i.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,ne),fe=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),_e=G*i.mercatorZfromAltitude(1,this.center.lat),ge=this._camera.position[2]/i.mercatorZfromAltitude(1,this.center.lat),ye=[G*fe.x,G*fe.y,ge*(ne?1:_e)],ie=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),pe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,we=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ee=a.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,ke=this.projection.isReprojectedInTileSpace?Aa(this):1,Ue=tt=>{const xt=new i.MercatorCoordinate(tt.x+25e-6,tt.y,tt.z),at=new i.MercatorCoordinate(tt.x,tt.y+25e-6,tt.z),Et=tt.toLngLat(),rn=xt.toLngLat(),fn=at.toLngLat(),qt=this.locationCoordinate(Et),gn=this.locationCoordinate(rn),An=this.locationCoordinate(fn),Nn=Math.hypot(gn.x-qt.x,gn.y-qt.y),un=Math.hypot(An.x-qt.x,An.y-qt.y);return Math.sqrt(Nn*un)*ke/25e-6},Fe=tt=>{const mt=we,xt=Ee;return{aabb:i.tileAABB(this,G,0,0,0,tt,xt,mt,this.projection),zoom:0,x:0,y:0,minZ:xt,maxZ:mt,wrap:tt,fullyVisible:!1}},He=[];let $e=[];const it=h,Pt=a.reparseOverscaled?y:h,Qe=tt=>tt*tt,gt=Qe((ge-this._centerAltitude)*_e),st=tt=>{if(!this._elevation||!tt.tileID||!S)return;const mt=this._elevation.getMinMaxForTile(tt.tileID),xt=tt.aabb;mt?(xt.min[2]=mt.min,xt.max[2]=mt.max,xt.center[2]=(xt.min[2]+xt.max[2])/2):(tt.shouldSplit=Lt(tt),tt.shouldSplit||(xt.min[2]=xt.max[2]=xt.center[2]=this._centerAltitude))},Lt=tt=>{if(tt.zoom<pe)return!0;if(tt.zoom===it)return!1;if(tt.shouldSplit!=null)return tt.shouldSplit;const mt=tt.aabb.distanceX(ye),xt=tt.aabb.distanceY(ye);let at=gt,Et=1;if(Z){at=Qe(tt.aabb.distanceZ(ye));const qt=Math.pow(2,tt.zoom),gn=i.latFromMercatorY((tt.y+1)/qt),An=i.latFromMercatorY(tt.y/qt),Nn=Math.min(Math.max(D,gn),An),un=i.circumferenceAtLatitude(Nn)/i.circumferenceAtLatitude(D);if(Et=Nn===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,un/this._mercatorScaleRatio),this.zoom<=i.GLOBE_ZOOM_THRESHOLD_MIN&&tt.zoom===it-1&&un>=.9)return!0}else if(w&&(at=Qe(tt.aabb.distanceZ(ye)*_e)),this.projection.isReprojectedInTileSpace&&y<=5){const qt=Math.pow(2,tt.zoom),gn=Ue(new i.MercatorCoordinate((tt.x+.5)/qt,(tt.y+.5)/qt));Et=gn>.85?1:gn}const rn=mt*mt+xt*xt+at,fn=Qe((1<<it-tt.zoom)*ie*Et*((qt,gn)=>{if(gn*Qe(.707)<qt)return 1;const An=Math.sqrt(gn/qt);return An/(1.4144271570014144+(Math.pow(1.1,An-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(at,gt),rn));return rn<fn};if(this.renderWorldCopies)for(let tt=1;tt<=3;tt++)He.push(Fe(-tt)),He.push(Fe(tt));for(He.push(Fe(0));He.length>0;){const tt=He.pop(),mt=tt.x,xt=tt.y;let at=tt.fullyVisible;if(!at){const Et=tt.aabb.intersects(he);if(Et===0)continue;at=Et===2}if(tt.zoom!==it&&Lt(tt))for(let Et=0;Et<4;Et++){const rn=(mt<<1)+Et%2,fn=(xt<<1)+(Et>>1),qt={aabb:S?tt.aabb.quadrant(Et):i.tileAABB(this,G,tt.zoom+1,rn,fn,tt.wrap,tt.minZ,tt.maxZ,this.projection),zoom:tt.zoom+1,x:rn,y:fn,wrap:tt.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:tt.minZ,maxZ:tt.maxZ};w&&!Z&&(qt.tileID=new i.OverscaledTileID(tt.zoom+1===it?Pt:tt.zoom+1,tt.wrap,tt.zoom+1,rn,fn),st(qt)),He.push(qt)}else{const Et=tt.zoom===it?Pt:tt.zoom;if(a.minzoom&&a.minzoom>Et)continue;const rn=q[0]-(.5+mt+(tt.wrap<<tt.zoom))*(1<<h-tt.zoom),fn=q[1]-.5-xt,qt=tt.tileID?tt.tileID:new i.OverscaledTileID(Et,tt.wrap,tt.zoom,mt,xt);$e.push({tileID:qt,distanceSq:rn*rn+fn*fn})}}if(this.fogCullDistSq){const tt=this.fogCullDistSq,mt=this.horizonLineFromTop();$e=$e.filter(xt=>{const at=[0,0,0,1],Et=[i.EXTENT,i.EXTENT,0,1],rn=this.calculateFogTileMatrix(xt.tileID.toUnwrapped());i.transformMat4$1(at,at,rn),i.transformMat4$1(Et,Et,rn);const fn=i.getAABBPointSquareDist(at,Et);if(fn===0)return!0;let qt=!1;const gn=this._elevation;if(gn&&fn>tt&&mt!==0){const An=this.calculateProjMatrix(xt.tileID.toUnwrapped());let Nn;a.isTerrainDEM||(Nn=gn.getMinMaxForTile(xt.tileID)),Nn||(Nn={min:Ee,max:we});const un=i.furthestTileCorner(this.rotation),xr=[un[0]*i.EXTENT,un[1]*i.EXTENT,Nn.max];i.transformMat4(xr,xr,An),qt=(1-xr[1])*this.height*.5<mt}return fn<tt||qt})}return $e.sort((tt,mt)=>tt.distanceSq-mt.distanceSq).map(tt=>tt.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const h=i.clamp(a.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),y=this.projection.project(a.lng,h);return new i.Point(y.x*this.worldSize,y.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,h){let y,w;const S=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;y=(h.x-S.x)/D,w=(h.y-S.y)/D}else{const D=this.pointCoordinate(h),G=this.pointCoordinate(S);y=D.x-G.x,w=D.y-G.y}const R=this.locationCoordinate(a);this.setLocation(new i.MercatorCoordinate(R.x-y,R.y-w))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,h){const y=h?i.mercatorZfromAltitude(h,a.lat):void 0,w=this.projection.project(a.lng,a.lat);return new i.MercatorCoordinate(w.x,w.y,y)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){const y=h??this._centerAltitude,w=[a.x,a.y,0,1],S=[a.x,a.y,1,1];i.transformMat4$1(w,w,this.pixelMatrixInverse),i.transformMat4$1(S,S,this.pixelMatrixInverse);const R=S[3];i.scale$1(w,w,1/w[3]),i.scale$1(S,S,1/R);const D=w[2],G=S[2];return{p0:w,p1:S,t:D===G?0:(y-D)/(G-D)}}screenPointToMercatorRay(a){const h=[a.x,a.y,0,1],y=[a.x,a.y,1,1];return i.transformMat4$1(h,h,this.pixelMatrixInverse),i.transformMat4$1(y,y,this.pixelMatrixInverse),i.scale$1(h,h,1/h[3]),i.scale$1(y,y,1/y[3]),h[2]=i.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,y[2]=i.mercatorZfromAltitude(y[2],this._center.lat)*this.worldSize,i.scale$1(h,h,1/this.worldSize),i.scale$1(y,y,1/this.worldSize),new i.Ray([h[0],h[1],h[2]],i.normalize([],i.sub([],y,h)))}rayIntersectionCoordinate(a){const{p0:h,p1:y,t:w}=a,S=i.mercatorZfromAltitude(h[2],this._center.lat),R=i.mercatorZfromAltitude(y[2],this._center.lat);return new i.MercatorCoordinate(i.number(h[0],y[0],w)/this.worldSize,i.number(h[1],y[1],w)/this.worldSize,i.number(S,R,w))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let h=this.projection.pointCoordinate3D(this,a.x,a.y);if(h)return new i.MercatorCoordinate(h[0],h[1],h[2]);let y=0,w=this.horizonLineFromTop();if(a.y>w)return this.pointCoordinate(a);const S=.02*w,R=a.clone();for(let D=0;D<10&&w-y>S;D++){R.y=i.number(y,w,.66);const G=this.projection.pointCoordinate3D(this,R.x,R.y);G?(w=R.y,h=G):y=R.y}return h?new i.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const h=this.pointCoordinate(a);return h.y>=0&&h.y<=1}_coordinatePoint(a,h){const y=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,w=[a.x*this.worldSize,a.y*this.worldSize,y+a.toAltitude(),1];return i.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new i.Point(w[0]/w[3],w[1]/w[3]):new i.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:h}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,S=this.pointLocation3D(new i.Point(h,a)),R=this.pointLocation3D(new i.Point(w,a)),D=this.pointLocation3D(new i.Point(w,y)),G=this.pointLocation3D(new i.Point(h,y));let q=Math.min(S.lng,R.lng,D.lng,G.lng),Z=Math.max(S.lng,R.lng,D.lng,G.lng),ne=Math.min(S.lat,R.lat,D.lat,G.lat),he=Math.max(S.lat,R.lat,D.lat,G.lat);const fe=Math.pow(2,-this.zoom)/16*270,_e=this.projection.name==="globe"?1:4,ge=(ye,ie,pe,we,Ee)=>{const ke=(ye+pe)/2,Ue=(ie+we)/2,Fe=new i.Point(ke,Ue),{lng:He,lat:$e}=this.pointLocation3D(Fe),it=Math.max(0,q-He,ne-$e,He-Z,$e-he);q=Math.min(q,He),Z=Math.max(Z,He),ne=Math.min(ne,$e),he=Math.max(he,$e),(Ee<_e||it>fe)&&(ge(ye,ie,ke,Ue,Ee+1),ge(ke,Ue,pe,we,Ee+1))};if(ge(h,a,w,a,1),ge(w,a,w,y,1),ge(w,y,h,y,1),ge(h,y,h,a,1),this.projection.name==="globe"){const[ye,ie]=i.polesInViewport(this);ye?(he=90,Z=180,q=-180):ie&&(ne=-90,Z=180,q=-180)}return new i.LngLatBounds(new i.LngLat(q,ne),new i.LngLat(Z,he))}_getBoundsRectangular(a,h){const{top:y,left:w}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,R=this.width-this._edgeInsets.right,D=new i.Point(w,y),G=new i.Point(R,y),q=new i.Point(R,S),Z=new i.Point(w,S);let ne=this.pointCoordinate(D,a),he=this.pointCoordinate(G,a);const fe=this.pointCoordinate(q,h),_e=this.pointCoordinate(Z,h),ge=(ye,ie)=>(ie.y-ye.y)/(ie.x-ye.x);return ne.y>1&&he.y>=0?ne=new i.MercatorCoordinate((1-_e.y)/ge(_e,ne)+_e.x,1):ne.y<0&&he.y<=1&&(ne=new i.MercatorCoordinate(-_e.y/ge(_e,ne)+_e.x,0)),he.y>1&&ne.y>=0?he=new i.MercatorCoordinate((1-fe.y)/ge(fe,he)+fe.x,1):he.y<0&&ne.y<=1&&(he=new i.MercatorCoordinate(-fe.y/ge(fe,he)+fe.x,0)),new i.LngLatBounds().extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(he)).extend(this.coordinateLocation(_e)).extend(this.coordinateLocation(fe))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=a.visibleDemTiles.reduce((y,w)=>{if(w.dem){const S=w.dem.tree;y.min=Math.min(y.min,S.minimums[0]),y.max=Math.max(y.max,S.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,y=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-i.MAX_MERCATOR_LATITUDE,this.maxLat=i.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=i.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=i.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=i.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){const h=a.key,y=this._distanceTileDataCache;if(y[h])return y[h];const w=a.canonical,S=1/this.height,R=this.cameraWorldSize,D=R/this.zoomScale(w.z),G=(w.x+Math.pow(2,w.z)*a.wrap)*D,q=w.y*D,Z=this.point;Z.x*=R/this.worldSize,Z.y*=R/this.worldSize;const ne=this.angle,he=Math.sin(-ne),fe=-Math.cos(-ne);return y[h]={bearing:[he,fe],center:[(Z.x-G)*S,(Z.y-q)*S],scale:D/i.EXTENT*S},y[h]}calculateFogTileMatrix(a){const h=a.key,y=this._fogTileMatrixCache;if(y[h])return y[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return i.multiply(w,this.worldToFogMatrix,w),y[h]=new Float32Array(w),y[h]}calculateProjMatrix(a,h=!1){const y=a.key,w=h?this._alignedProjMatrixCache:this._projMatrixCache;if(w[y])return w[y];const S=this.calculatePosMatrix(a,this.worldSize);return i.multiply(S,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,S),w[y]=new Float32Array(S),w[y]}calculatePixelsToTileUnitsMatrix(a){const h=a.tileID.key,y=this._pixelsToTileUnitsCache;if(y[h])return y[h];const w=function(S,R){const{scale:D}=S.tileTransform,G=D*i.EXTENT/(S.tileSize*Math.pow(2,R.zoom-S.tileID.overscaledZ+S.tileID.canonical.z));return q=new Float32Array(4),he=(Z=R.inverseAdjustmentMatrix)[1],fe=Z[2],_e=Z[3],ye=(ne=[G,G])[1],q[0]=Z[0]*(ge=ne[0]),q[1]=he*ge,q[2]=fe*ye,q[3]=_e*ye,q;var q,Z,ne,he,fe,_e,ge,ye}(a,this);return y[h]=w,y[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,h=i.fromScaling([],[a,a,a]);return i.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const h=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(h),w=this._camera.forward(),S=i.mercatorZfromAltitude(1,this._center.lat);y[2]/=S,w[2]/=S,i.normalize(w,w);const R=a.raycast(y,w,a.exaggeration());if(R){const D=i.scaleAndAdd([],y,w,R),G=new i.MercatorCoordinate(D[0],D[1],i.mercatorZfromAltitude(D[2],i.latFromMercatorY(D[1]))),q=(G.z+i.length([G.x-y[0],G.y-y[1],G.z-y[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(q),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const h=this._elevation,y=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(y),S=h.getAtPointOrZero(new i.MercatorCoordinate(...w)),R=this.pixelsPerMeter/this.worldSize*S,D=this._minimumHeightOverTerrain(),G=w[2]-R;if(G<=D)if(G<0||a){const q=this.locationCoordinate(this._center,this._centerAltitude),Z=[w[0],w[1],q.z-w[2]],ne=i.length(Z);Z[2]-=(D-G)/this._pixelsPerMercatorPixel;const he=i.length(Z);if(he===0)return;i.scale$2(Z,Z,ne/he*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],q.z*this._pixelsPerMercatorPixel-Z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const he=this.center;return he.lat=i.clamp(he.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(he.lng=i.clamp(he.lng,this.minLng,this.maxLng)),this.center=he,void(this._constraining=!1)}const h=this._unmodified,{x:y,y:w}=this.point;let S=0,R=y,D=w;const G=this.width/2,q=this.height/2,Z=this.worldMinY*this.scale,ne=this.worldMaxY*this.scale;if(w-q<Z&&(D=Z+q),w+q>ne&&(D=ne-q),ne-Z<this.height&&(S=Math.max(S,this.height/(ne-Z)),D=(ne+Z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const he=this.worldMinX*this.scale,fe=this.worldMaxX*this.scale,_e=this.worldSize/2-(he+fe)/2;R=(y+_e+this.worldSize)%this.worldSize-_e,R-G<he&&(R=he+G),R+G>fe&&(R=fe-G),fe-he<this.width&&(S=Math.max(S,this.width/(fe-he)),R=(fe+he)/2)}R===y&&D===w||(this.center=this.unproject(new i.Point(R,D))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.mercatorZfromAltitude(1,this.center.lat)/i.mercatorZfromAltitude(1,i.GLOBE_SCALE_MATCH_LATITUDE));const y=tl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?h:1,S=this._camera.getWorldToCamera(this.worldSize,w),R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);R[8]=2*-a.x/this.width,R[9]=2*a.y/this.height;let D=i.mul([],R,S);if(this.projection.isReprojectedInTileSpace){const Ue=this.locationCoordinate(this.center),Fe=i.identity([]);i.translate(Fe,Fe,[Ue.x*this.worldSize,Ue.y*this.worldSize,0]),i.multiply(Fe,Fe,ra(this)),i.translate(Fe,Fe,[-Ue.x*this.worldSize,-Ue.y*this.worldSize,0]),i.multiply(D,D,Fe),this.inverseAdjustmentMatrix=function(He){const $e=ra(He,!0);return me([],[$e[0],$e[1],$e[4],$e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=i.scale([],D,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=D,this.invProjMatrix=i.invert(new Float64Array(16),this.projMatrix);const G=i.invert([],R);this.frustumCorners=i.FrustumCorners.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height);const q=new Float32Array(16);i.identity(q),i.scale(q,q,[1,-1,1]),i.rotateX(q,q,this._pitch),i.rotateZ(q,q,this.angle);const Z=i.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ne=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Z[8]=2*-a.x/this.width,Z[9]=2*(a.y+ne)/this.height,this.skyboxMatrix=i.multiply(q,Z,q);const he=this.point,fe=he.x,_e=he.y,ge=this.width%2/2,ye=this.height%2/2,ie=Math.cos(this.angle),pe=Math.sin(this.angle),we=fe-Math.round(fe)+ie*ge+pe*ye,Ee=_e-Math.round(_e)+ie*ye+pe*ge,ke=new Float64Array(D);if(i.translate(ke,ke,[we>.5?we-1:we,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=ke,D=i.create(),i.scale(D,D,[this.width/2,-this.height/2,1]),i.translate(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=i.create(),i.scale(D,D,[1,-1,1]),i.translate(D,D,[-1,-1,0]),i.scale(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=i.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},D=i.invert(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.calculateGlobeMatrix(this);const Ue=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.transformMat4(Ue,Ue,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,y=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,S=[a,a,h];i.scale$2(S,S,w),i.scale$2(y,y,-1),i.multiply$2(y,y,S);const R=i.create();i.translate(R,R,y),i.scale(R,R,S),this.mercatorFogMatrix=R,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,w)}_computeCameraPosition(a){const h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),w=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-y[0]*S,w.y/this.worldSize-y[1]*S,a/this.worldSize*this._centerAltitude-y[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],w=a[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(S=Math.min((h-y)/w,1)),this._camera.position=i.scaleAndAdd([],this._camera.position,a,S),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,h=this._camera.forward(),{pitch:y,bearing:w}=this._camera.getPitchBearing(),S=i.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,R=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.degToRad(this._maxPitch)),D=Math.max((a[2]-S)/Math.cos(y),R),G=this._zoomFromMercatorZ(D);i.scaleAndAdd(a,a,h,D),this._pitch=i.clamp(y,i.degToRad(this.minPitch),i.degToRad(this.maxPitch)),this.angle=i.wrap(w,-Math.PI,Math.PI),this._setZoom(i.clamp(G,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let h=0,y=i.GLOBE_ZOOM_THRESHOLD_MAX,w=0,S=1/0;for(;y-h>1e-6&&y>h;){const R=h+.5*(y-h),D=this.tileSize*Math.pow(2,R),G=this.getCameraToCenterDistance(this.projection,R,D),q=this.scaleZoom(G/(a*this.tileSize)),Z=Math.abs(R-q);Z<S&&(S=Z,w=R),R<q?h=R:y=R}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){const y=Math.min(a.x,h.x),w=Math.max(a.x,h.x),S=Math.min(a.y,h.y),R=Math.max(a.y,h.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new i.Point(y,S),new i.Point(w,R),new i.Point(y,R),new i.Point(w,S)],G=this.renderWorldCopies?-3:0,q=this.renderWorldCopies?4:1;for(const Z of D){const ne=this.pointRayIntersection(Z);if(ne.t<0)return!0;const he=this.rayIntersectionCoordinate(ne);if(he.x<G||he.y<0||he.x>q||he.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.Point(0,0),new i.Point(this.width,this.height))}zoomDeltaToMovement(a,h){const y=i.length(i.sub([],this._camera.position,a)),w=this._zoomFromMercatorZ(y)+h;return y-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const a=function([h,y,w],S){const R=[h,y,w,1];i.transformMat4$1(R,R,S);const D=R[3]=Math.max(R[3],1e-6);return R[0]/=D,R[1]/=D,R[2]/=D,R}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.Point(0,a))}}getCameraToCenterDistance(a,h=this.zoom,y=this.worldSize){const w=tl(a,h,this.width,this.height,1024),S=a.pixelSpaceConversion(this.center.lat,y,w);return .5/Math.tan(.5*this._fov)*this.height*S}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.multiply(a,a,this.globeMatrix),a}}function wc(m,a){let h=!1,y=null;const w=()=>{y=null,h&&(m(),y=setTimeout(w,a),h=!1)};return()=>(h=!0,y||w(),y)}class gh{constructor(a){this._hashName=a&&encodeURIComponent(a),i.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wc(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,i.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),i.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const h=Zc(a);if(this._hashName){const y=this._hashName;let w=!1;const S=i.window.location.hash.slice(1).split("&").map(R=>{const D=R.split("=")[0];return D===y?(w=!0,`${D}=${h}`):R}).filter(R=>R);return w||S.push(`${y}=${h}`),`#${S.join("&")}`}return`#${h}`}_getCurrentHash(){const a=i.window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(h=y)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=i.window.location.href.replace(/(#.+)?$/,this.getHashString());i.window.history.replaceState(i.window.history.state,null,a)}}function Zc(m,a){const h=m.getCenter(),y=Math.round(100*m.getZoom())/100,w=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,w),R=Math.round(h.lng*S)/S,D=Math.round(h.lat*S)/S,G=m.getBearing(),q=m.getPitch();let Z=a?`/${R}/${D}/${y}`:`${y}/${D}/${R}`;return(G||q)&&(Z+="/"+Math.round(10*G)/10),q&&(Z+=`/${Math.round(q)}`),Z}const Xc={linearity:.3,easing:i.bezier(0,0,.3,1)},qc=i.extend({deceleration:2500,maxSpeed:1400},Xc),zu=i.extend({deceleration:20,maxSpeed:1400},Xc),nn=i.extend({deceleration:1e3,maxSpeed:360},Xc),Sa=i.extend({deceleration:1e3,maxSpeed:90},Xc);class Qh{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=i.exported.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new i.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const S=ju(h.pan.mag(),y,i.extend({},qc,a||{}));w.offset=h.pan.mult(S.amount/h.pan.mag()),w.center=this._map.transform.center,Fu(w,S)}if(h.zoom){const S=ju(h.zoom,y,zu);w.zoom=this._map.transform.zoom+S.amount,Fu(w,S)}if(h.bearing){const S=ju(h.bearing,y,nn);w.bearing=this._map.transform.bearing+i.clamp(S.amount,-179,179),Fu(w,S)}if(h.pitch){const S=ju(h.pitch,y,Sa);w.pitch=this._map.transform.pitch+S.amount,Fu(w,S)}if(w.zoom||w.bearing){const S=h.pinchAround===void 0?h.around:h.pinchAround;w.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Fu(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function ju(m,a,h){const{maxSpeed:y,linearity:w,deceleration:S}=h,R=i.clamp(m*w/(a/1e3),-y,y),D=Math.abs(R)/(S*w);return{easing:h.easing,duration:1e3*D,amount:R*(D/2)}}class ao extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,y,w={}){const S=ae(h.getCanvasContainer(),y),R=h.unproject(S);super(a,i.extend({point:S,lngLat:R,originalEvent:y},w)),this._defaultPrevented=!1,this.target=h}}class Kc extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,y){const w=a==="touchend"?y.changedTouches:y.touches,S=be(h.getCanvasContainer(),w),R=S.map(G=>h.unproject(G)),D=S.reduce((G,q,Z,ne)=>G.add(q.div(ne.length)),new i.Point(0,0));super(a,{points:S,point:D,lngLats:R,lngLat:h.unproject(D),originalEvent:y}),this._defaultPrevented=!1}}class Uu extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,y){super(a,{originalEvent:y}),this._defaultPrevented=!1}}class _h{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Uu(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new ao(a.type,this._map,a))}mouseup(a){this._map.fire(new ao(a.type,this._map,a))}preclick(a){const h=i.extend({},a);h.type="preclick",this._map.fire(new ao(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new ao(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new ao(a.type,this._map,a))}mouseover(a){this._map.fire(new ao(a.type,this._map,a))}mouseout(a){this._map.fire(new ao(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Kc(a.type,this._map,a))}touchmove(a){this._map.fire(new Kc(a.type,this._map,a))}touchend(a){this._map.fire(new Kc(a.type,this._map,a))}touchcancel(a){this._map.fire(new Kc(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ec{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new ao(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ao("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new ao(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gd{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&a.button===0&&(X(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const y=h,w=this._startPos,S=this._lastPos;if(!w||!S||S.equals(y)||!this._box&&y.dist(w)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=O("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const R=Math.min(w.x,y.x),D=Math.max(w.x,y.x),G=Math.min(w.y,y.y),q=Math.max(w.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${R}px,${G}px)`,this._box.style.width=D-R+"px",this._box.style.height=q-G+"px")})}mouseupWindow(a,h){if(!this._active)return;const y=this._startPos,w=h;if(y&&a.button===0){if(this.reset(),ue(),y.x!==w.x||y.y!==w.y)return this._map.fire(new i.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:S=>S.fitScreenCoordinates(y,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),J(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new i.Event(a,{originalEvent:h}))}}function yh(m,a){const h={};for(let y=0;y<m.length;y++)h[m[y].identifier]=a[y];return h}class Jc{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),y.length===this.numTouches&&(this.centroid=function(w){const S=new i.Point(0,0);for(const R of w)S._add(R);return S.div(w.length)}(h),this.touches=yh(y,h)))}touchmove(a,h,y){if(this.aborted||!this.centroid)return;const w=yh(y,h);for(const S in this.touches){const R=w[S];(!R||R.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(a,h,y){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Nu{constructor(a){this.singleTap=new Jc(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,y){this.singleTap.touchstart(a,h,y)}touchmove(a,h,y){this.singleTap.touchmove(a,h,y)}touchend(a,h,y){const w=this.singleTap.touchend(a,h,y);if(w){const S=a.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(w)<30;if(S&&R||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class ed{constructor(){this._zoomIn=new Nu({numTouches:1,numTaps:2}),this._zoomOut=new Nu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,y){this._zoomIn.touchstart(a,h,y),this._zoomOut.touchstart(a,h,y)}touchmove(a,h,y){this._zoomIn.touchmove(a,h,y),this._zoomOut.touchmove(a,h,y)}touchend(a,h,y){const w=this._zoomIn.touchend(a,h,y),S=this._zoomOut.touchend(a,h,y);return w?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(w)},{originalEvent:a})}):S?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(S)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vd={0:1,2:2};class Cc{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;const y=Ce(a);this._correctButton(a,y)&&(this._lastPoint=h,this._eventButton=y)}mousemoveWindow(a,h){const y=this._lastPoint;if(y){if(a.preventDefault(),this._eventButton!=null&&function(w,S){const R=Vd[S];return w.buttons===void 0||(w.buttons&R)!==R}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(y,h)}}mouseupWindow(a){this._lastPoint&&Ce(a)===this._eventButton&&(this._moved&&ue(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vh extends Cc{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return h===0&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class xh extends Cc{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){const y=.8*(h.x-a.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(a){a.preventDefault()}}class bh extends Cc{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){const y=-.5*(h.y-a.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(a){a.preventDefault()}}class Gu{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),i.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.Point(0,0)}touchstart(a,h,y){return this._calculateTransform(a,h,y)}touchmove(a,h,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!i.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,h,y)}}touchend(a,h,y){this._calculateTransform(a,h,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,y){y.length>0&&(this._active=!0);const w=yh(y,h),S=new i.Point(0,0),R=new i.Point(0,0);let D=0;for(const q in w){const Z=w[q],ne=this._touches[q];ne&&(S._add(Z),R._add(Z.sub(ne)),D++,w[q]=Z)}if(this._touches=w,D<this._minTouches||!R.mag())return;const G=R.div(D);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(D),panDelta:G}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ms{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,y){return{}}touchstart(a,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,y){const w=this._firstTwoTouches;if(!w)return;a.preventDefault();const[S,R]=w,D=Yc(y,h,S),G=Yc(y,h,R);if(!D||!G)return;const q=this._aroundCenter?null:D.add(G).div(2);return this._move([D,G],q,a)}touchend(a,h,y){if(!this._firstTwoTouches)return;const[w,S]=this._firstTwoTouches,R=Yc(y,h,w),D=Yc(y,h,S);R&&D||(this._active&&ue(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Yc(m,a,h){for(let y=0;y<m.length;y++)if(m[y].identifier===h)return a[y]}function Ac(m,a){return Math.log(m/a)/Math.LN2}class Qc extends Ms{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const y=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Ac(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ac(this._distance,y),pinchAround:h}}}function eu(m,a){return 180*m.angleWith(a)/Math.PI}class Vu extends Ms{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){const y=this._vector;if(this._vector=a[0].sub(a[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:eu(this._vector,y),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const w=eu(a,y);return Math.abs(w)<h}}function Al(m){return Math.abs(m.y)>Math.abs(m.x)}class tu extends Ms{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Al(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,y){const w=this._lastPoints;if(!w)return;const S=a[0].sub(w[0]),R=a[1].sub(w[1]);return this._map._cooperativeGestures&&!i.isFullscreen()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(S,R,y.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(S.y+R.y)/2*-.5})}gestureBeginsVertically(a,h,y){if(this._valid!==void 0)return this._valid;const w=a.mag()>=2,S=h.mag()>=2;if(!w&&!S)return;if(!w||!S)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const R=a.y>0==h.y>0;return Al(a)&&Al(h)&&R}}const No={panStep:100,bearingStep:15,pitchStep:10};class Ap{constructor(){const a=No;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,y=0,w=0,S=0,R=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?y=-1:(a.preventDefault(),S=-1);break;case 39:a.shiftKey?y=1:(a.preventDefault(),S=1);break;case 38:a.shiftKey?w=1:(a.preventDefault(),R=-1);break;case 40:a.shiftKey?w=-1:(a.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(y=0,w=0),{cameraAnimation:D=>{const G=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:$d,zoom:h?Math.round(G)+h*(a.shiftKey?2:1):G,bearing:D.getBearing()+y*this._bearingStep,pitch:D.getPitch()+w*this._pitchStep,offset:[-S*this._panStep,-R*this._panStep],center:D.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $d(m){return m*(2-m)}const _s=4.000244140625;class as{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,i.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||i.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===i.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const y=i.exported.now(),w=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,h!==0&&h%_s==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=ae(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>_s?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&q!==0&&(q=1/q);const Z=h(),ne=Math.pow(2,Z),he=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):ne;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(he*q))),this._type==="wheel"&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:h(),w=this._startZoom,S=this._easing;let R,D=!1;if(this._type==="wheel"&&w&&S){const G=Math.min((i.exported.now()-this._lastWheelEventTime)/200,1),q=S(G);R=i.number(w,y,q),G<1?this._frameId||(this._frameId=!0):D=!0}else R=y,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:R-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=i.ease;if(this._prevEase){const y=this._prevEase,w=(i.exported.now()-y.start)/y.duration,S=y.easing(w+.01)-y.easing(w),R=.27/Math.sqrt(S*S+1e-4)*.01,D=Math.sqrt(.0729-R*R);h=i.bezier(R,D,.25,1)}return this._prevEase={start:i.exported.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(i.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class td{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Go{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(a.shiftKey?-1:1),around:y.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hd{constructor(){this._tap=new Nu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,y){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=h[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(a,h,y))}touchmove(a,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const w=h[0],S=w.y-this._swipePoint.y;return this._swipePoint=w,a.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(a,h,y)}touchend(a,h,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(a,h,y)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nd{constructor(a,h,y){this._el=a,this._mousePan=h,this._touchPan=y}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wd{constructor(a,h,y){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rd{constructor(a,h,y,w){this._el=a,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const zs=m=>m.zoom||m.drag||m.pitch||m.rotate;class wh extends i.Event{}class Zd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){const y=i.sub([],h,a);this.radius=i.length(y[2]<0?i.div([],y,this.constants):[y[0],y[1],0])}projectRay(a){i.div(a,a,this.constants),i.normalize(a,a),i.mul$1(a,a,this.constants);const h=i.scale$2([],a,this.radius);if(h[2]>0){const y=i.scale$2([],[0,0,1],i.dot(h,[0,0,1])),w=i.scale$2([],i.normalize([],[h[0],h[1],0]),this.radius),S=i.add([],h,i.scale$2([],i.sub([],i.add([],w,y),h),2));h[0]=S[0],h[1]=S[1]}return h}}function ia(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Fs{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qh(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Zd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),i.bindAll(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[i.window.document,"mousemove",{capture:!0}],[i.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[i.window,"blur",void 0]];for(const[w,S,R]of this._listeners)w.addEventListener(S,w===i.window.document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[a,h,y]of this._listeners)a.removeEventListener(h,a===i.window.document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(a){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new _h(h,a));const w=h.boxZoom=new Gd(h,a);this._add("boxZoom",w);const S=new ed,R=new Go;h.doubleClickZoom=new td(R,S),this._add("tapZoom",S),this._add("clickZoom",R);const D=new Hd;this._add("tapDragZoom",D);const G=h.touchPitch=new tu(h);this._add("touchPitch",G);const q=new xh(a),Z=new bh(a);h.dragRotate=new Wd(a,q,Z),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]);const ne=new vh(a),he=new Gu(h,a);h.dragPan=new nd(y,ne,he),this._add("mousePan",ne),this._add("touchPan",he,["touchZoom","touchRotate"]);const fe=new Vu,_e=new Qc;h.touchZoomRotate=new rd(y,_e,fe,D),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",_e,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ec(h));const ge=h.scrollZoom=new as(h,this);this._add("scrollZoom",ge,["mousePan"]);const ye=h.keyboard=new Ap;this._add("keyboard",ye);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[ie]&&h[ie].enable(a[ie])}_add(a,h,y){this._handlers.push({handlerName:a,handler:h,allowed:y}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,h,y){for(const w in a)if(w!==y&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const h=[];for(const y of a)this._el.contains(y.target)&&h.push(y);return h}handleEvent(a,h){this._updatingCamera=!0;const y=a.type==="renderFrame",w=y?void 0:a,S={needsRenderFrame:!1},R={},D={},G=a.touches?this._getMapTouches(a.touches):void 0,q=G?be(this._el,G):y?void 0:ae(this._el,a);for(const{handlerName:he,handler:fe,allowed:_e}of this._handlers){if(!fe.isEnabled())continue;let ge;this._blockedByActive(D,_e,he)?fe.reset():fe[h||a.type]&&(ge=fe[h||a.type](a,q,G),this.mergeHandlerResult(S,R,ge,he,w),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()),(ge||fe.isActive())&&(D[he]=fe)}const Z={};for(const he in this._previousActiveHandlers)D[he]||(Z[he]=w);this._previousActiveHandlers=D,(Object.keys(Z).length||ia(S))&&(this._changes.push([S,R,Z]),this._triggerRenderFrame()),(Object.keys(D).length||ia(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ne}=S;ne&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ne(this._map))}mergeHandlerResult(a,h,y,w,S){if(!y)return;i.extend(a,y);const R={handlerName:w,originalEvent:y.originalEvent||S};y.zoomDelta!==void 0&&(h.zoom=R),y.panDelta!==void 0&&(h.drag=R),y.pitchDelta!==void 0&&(h.pitch=R),y.bearingDelta!==void 0&&(h.rotate=R)}_applyChanges(){const a={},h={},y={};for(const[w,S,R]of this._changes)w.panDelta&&(a.panDelta=(a.panDelta||new i.Point(0,0))._add(w.panDelta)),w.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(a.around=w.around),w.aroundCoord!==void 0&&(a.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(a.pinchAround=w.pinchAround),w.noInertia&&(a.noInertia=w.noInertia),i.extend(h,S),i.extend(y,R);this._updateMapTransform(a,h,y),this._changes=[]}_updateMapTransform(a,h,y){const w=this._map,S=w.transform,R=pe=>[pe.x,pe.y,pe.z];if((pe=>{const we=this._eventsInProgress.drag;return we&&!this._handlersById[we.handlerName].isActive()})()&&!ia(a)){const pe=S.zoom;S.cameraElevationReference="sea",S.recenterOnTerrain(),S.cameraElevationReference="ground",pe!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&w._stop(!0),!ia(a))return void this._fireEvents(h,y,!0);let{panDelta:D,zoomDelta:G,bearingDelta:q,pitchDelta:Z,around:ne,aroundCoord:he,pinchAround:fe}=a;S._isCameraConstrained&&(G>0&&(G=0),S._isCameraConstrained=!1),fe!==void 0&&(ne=fe),(G||(pe=>h[pe]&&!this._eventsInProgress[pe])("drag"))&&ne&&(this._dragOrigin=R(S.pointCoordinate3D(ne)),this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",w._stop(!0),ne=ne||w.transform.centerPoint,q&&(S.bearing+=q),Z&&(S.pitch+=Z),S._updateCameraState();const _e=[0,0,0];if(D)if(S.projection.name==="mercator"){const pe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(ne).dir),we=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(ne.sub(D)).dir);_e[0]=we[0]-pe[0],_e[1]=we[1]-pe[1]}else{const pe=S.pointCoordinate(ne);if(S.projection.name==="globe"){D=D.rotate(-S.angle);const we=S._pixelsPerMercatorPixel/S.worldSize;_e[0]=-D.x*i.mercatorScale(i.latFromMercatorY(pe.y))*we,_e[1]=-D.y*i.mercatorScale(S.center.lat)*we}else{const we=S.pointCoordinate(ne.sub(D));pe&&we&&(_e[0]=we.x-pe.x,_e[1]=we.y-pe.y)}}const ge=S.zoom,ye=[0,0,0];if(G){const pe=R(he||S.pointCoordinate3D(ne)),we={dir:i.normalize([],i.sub([],pe,S._camera.position))};if(we.dir[2]<0){const Ee=S.zoomDeltaToMovement(pe,G);i.scale$2(ye,we.dir,Ee)}}const ie=i.add(_e,_e,ye);S._translateCameraConstrained(ie),G&&Math.abs(S.zoom-ge)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,y,!0)}_fireEvents(a,h,y){const w=zs(this._eventsInProgress),S=zs(a),R={};for(const Z in a){const{originalEvent:ne}=a[Z];this._eventsInProgress[Z]||(R[`${Z}start`]=ne),this._eventsInProgress[Z]=a[Z]}!w&&S&&this._fireEvent("movestart",S.originalEvent);for(const Z in R)this._fireEvent(Z,R[Z]);S&&this._fireEvent("move",S.originalEvent);for(const Z in a){const{originalEvent:ne}=a[Z];this._fireEvent(Z,ne)}const D={};let G;for(const Z in this._eventsInProgress){const{handlerName:ne,originalEvent:he}=this._eventsInProgress[Z];this._handlersById[ne].isActive()||(delete this._eventsInProgress[Z],G=h[ne]||he,D[`${Z}end`]=G)}for(const Z in D)this._fireEvent(Z,D[Z]);const q=zs(this._eventsInProgress);if(y&&(w||S)&&!q){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=he=>he!==0&&-this._bearingSnap<he&&he<this._bearingSnap;Z?(ne(Z.bearing||this._map.getBearing())&&(Z.bearing=0),this._map.easeTo(Z,{originalEvent:G})):(this._map.fire(new i.Event("moveend",{originalEvent:G})),ne(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new i.Event(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new wh("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const il="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $u extends i.Evented{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,i.bindAll(["_renderFrameCallback"],this)}getCenter(){return new i.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,y){return a=i.Point.convert(a).mult(-1),this.panTo(this.transform.center,i.extend({offset:a},h),y)}panTo(a,h,y){return this.easeTo(i.extend({center:a},h),y)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,y){return this.easeTo(i.extend({zoom:a},h),y)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,y){return this.easeTo(i.extend({bearing:a},h),y)}resetNorth(a,h){return this.rotateTo(0,i.extend({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(i.extend({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){a=i.LngLatBounds.convert(a);const y=h&&h.bearing||0,w=h&&h.pitch||0,S=a.getNorthWest(),R=a.getSouthEast();return this._cameraForBounds(this.transform,S,R,y,w,h)}_extendCameraOptions(a){const h={top:0,bottom:0,right:0,left:0};if(typeof(a=i.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){const y=a.padding;a.padding={top:y,bottom:y,right:y,left:y}}return a.padding=i.extend(h,a.padding),a}_minimumAABBFrustumDistance(a,h){const y=h.max[0]-h.min[0],w=h.max[1]-h.min[1];return y/w>a.aspect?y/(2*Math.tan(.5*a.fovX)*a.aspect):w/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,h,y,w,S,R){const D=a.clone(),G=this._extendCameraOptions(R);D.bearing=w,D.pitch=S;const q=i.LngLat.convert(h),Z=i.LngLat.convert(y),ne=.5*(q.lat+Z.lat),he=.5*(q.lng+Z.lng),fe=i.latLngToECEF(ne,he),_e=i.normalize([],fe),ge=i.normalize([],i.cross([],_e,[0,1,0])),ye=i.cross([],ge,_e),ie=[ge[0],ge[1],ge[2],0,ye[0],ye[1],ye[2],0,_e[0],_e[1],_e[2],0,0,0,0,1],pe=[fe,i.latLngToECEF(q.lat,q.lng),i.latLngToECEF(Z.lat,q.lng),i.latLngToECEF(Z.lat,Z.lng),i.latLngToECEF(q.lat,Z.lng),i.latLngToECEF(ne,q.lng),i.latLngToECEF(ne,Z.lng),i.latLngToECEF(q.lat,he),i.latLngToECEF(Z.lat,he)];let we=i.Aabb.fromPoints(pe.map(at=>[i.dot(ge,at),i.dot(ye,at),i.dot(_e,at)]));const Ee=i.transformMat4([],we.center,ie);i.squaredLength(Ee)===0&&i.set(Ee,0,0,1),i.normalize(Ee,Ee),i.scale$2(Ee,Ee,i.GLOBE_RADIUS),D.center=i.ecefToLatLng(Ee);const ke=D.getWorldToCameraMatrix(),Ue=i.invert(new Float64Array(16),ke);we=i.Aabb.applyTransform(we,i.multiply([],ke,ie)),i.transformMat4(Ee,Ee,ke);const Fe=.5*(we.max[2]-we.min[2]),He=this._minimumAABBFrustumDistance(D,we),$e=i.scale$2([],[0,0,1],Fe),it=i.add($e,Ee,$e),Pt=He+(D.pitch===0?0:i.distance(Ee,it)),Qe=D.globeCenterInViewSpace,gt=i.sub([],Ee,[Qe[0],Qe[1],Qe[2]]);i.normalize(gt,gt),i.scale$2(gt,gt,Pt);const st=i.add([],Ee,gt);i.transformMat4(st,st,Ue);const Lt=i.earthRadius/i.GLOBE_RADIUS,tt=i.length(st),mt=i.mercatorZfromAltitude(Math.max(tt*Lt-i.earthRadius,Number.EPSILON),0),xt=Math.min(D.zoomFromMercatorZAdjusted(mt),G.maxZoom);return xt>.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(D.setProjection({name:"mercator"}),D.zoom=xt,this._cameraForBounds(D,h,y,w,S,R)):{center:D.center,zoom:xt,bearing:w,pitch:S}}queryTerrainElevation(a,h){const y=this.transform.elevation;return y?(h=i.extend({},{exaggerated:!0},h),y.getAtPoint(i.MercatorCoordinate.fromLngLat(a),null,h.exaggerated)):null}_cameraForBounds(a,h,y,w,S,R){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,h,y,w,S,R);const D=a.clone(),G=this._extendCameraOptions(R),q=D.padding;D.bearing=w,D.pitch=S;const Z=i.LngLat.convert(h),ne=i.LngLat.convert(y),he=new i.LngLat(Z.lng,ne.lat),fe=new i.LngLat(ne.lng,Z.lat),_e=D.project(Z),ge=D.project(ne),ye=this.queryTerrainElevation(Z),ie=this.queryTerrainElevation(ne),pe=this.queryTerrainElevation(he),we=this.queryTerrainElevation(fe),Ee=[[_e.x,_e.y,Math.min(ye||0,ie||0,pe||0,we||0)],[ge.x,ge.y,Math.max(ye||0,ie||0,pe||0,we||0)]];let ke=i.Aabb.fromPoints(Ee);const Ue=D.getWorldToCameraMatrix(),Fe=i.invert(new Float64Array(16),Ue);ke=i.Aabb.applyTransform(ke,Ue);const He=i.sub([],ke.max,ke.min),$e=q.left||0,it=q.right||0,Pt=q.bottom||0,Qe=q.top||0,{left:gt,right:st,top:Lt,bottom:tt}=G.padding,mt=.5*($e+it),xt=.5*(Qe+Pt),at=Math.min(D.scaleZoom(D.scale*Math.min((D.width-($e+it+gt+st))/He[0],(D.height-(Pt+Qe+tt+Lt))/He[1])),G.maxZoom),Et=D.scale/D.zoomScale(at);ke=new i.Aabb([ke.min[0]-(gt+mt)*Et,ke.min[1]-(tt+xt)*Et,ke.min[2]],[ke.max[0]+(st+mt)*Et,ke.max[1]+(Lt+xt)*Et,ke.max[2]]);const rn=.5*He[2],fn=this._minimumAABBFrustumDistance(D,ke),qt=[0,0,1,0];i.transformMat4$1(qt,qt,Ue),i.normalize$2(qt,qt);const gn=i.scale$2([],qt,fn+rn),An=i.add([],ke.center,gn),Nn=(typeof G.offset.x=="number"&&typeof G.offset.y=="number"?new i.Point(G.offset.x,G.offset.y):i.Point.convert(G.offset)).rotate(-i.degToRad(w));ke.center[0]-=Nn.x*Et,ke.center[1]+=Nn.y*Et,i.transformMat4(ke.center,ke.center,Fe),i.transformMat4(An,An,Fe);const un=[ke.center[0],ke.center[1],An[2]*D.pixelsPerMeter];i.scale$2(un,un,1/D.worldSize);const xr=i.lngFromMercatorX(un[0]),Or=i.latFromMercatorY(un[1]),Cr=Math.min(D._zoomFromMercatorZ(un[2]),G.maxZoom),or=new i.LngLat(xr,Or);return D.mercatorFromTransition&&Cr<.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(D.setProjection({name:"globe"}),D.zoom=Cr,this._cameraForBounds(D,h,y,w,S,R)):{center:or,zoom:Cr,bearing:w,pitch:S}}fitBounds(a,h,y){const w=this.cameraForBounds(a,h);return this._fitInternal(w,h,y)}fitScreenCoordinates(a,h,y,w,S){const R=i.Point.convert(a),D=i.Point.convert(h),G=new i.Point(Math.min(R.x,D.x),Math.min(R.y,D.y)),q=new i.Point(Math.max(R.x,D.x),Math.max(R.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(R,D))return this;const Z=this.transform.pointLocation3D(G),ne=this.transform.pointLocation3D(q),he=this.transform.pointLocation3D(new i.Point(G.x,q.y)),fe=this.transform.pointLocation3D(new i.Point(q.x,G.y)),_e=[Math.min(Z.lng,ne.lng,he.lng,fe.lng),Math.min(Z.lat,ne.lat,he.lat,fe.lat)],ge=[Math.max(Z.lng,ne.lng,he.lng,fe.lng),Math.max(Z.lat,ne.lat,he.lat,fe.lat)],ye=w&&w.pitch?w.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,_e,ge,y,ye,w);return this._fitInternal(ie,w,S)}_fitInternal(a,h,y){return a?(delete(h=i.extend(a,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this}jumpTo(a,h){this.stop();const y=a.preloadOnly?this.transform.clone():this.transform;let w=!1,S=!1,R=!1;return"zoom"in a&&y.zoom!==+a.zoom&&(w=!0,y.zoom=+a.zoom),a.center!==void 0&&(y.center=i.LngLat.convert(a.center)),"bearing"in a&&y.bearing!==+a.bearing&&(S=!0,y.bearing=+a.bearing),"pitch"in a&&y.pitch!==+a.pitch&&(R=!0,y.pitch=+a.pitch),a.padding==null||y.isPaddingEqual(a.padding)||(y.padding=a.padding),a.preloadOnly?(this._preloadTiles(y),this):(this.fire(new i.Event("movestart",h)).fire(new i.Event("move",h)),w&&this.fire(new i.Event("zoomstart",h)).fire(new i.Event("zoom",h)).fire(new i.Event("zoomend",h)),S&&this.fire(new i.Event("rotatestart",h)).fire(new i.Event("rotate",h)).fire(new i.Event("rotateend",h)),R&&this.fire(new i.Event("pitchstart",h)).fire(new i.Event("pitch",h)).fire(new i.Event("pitchend",h)),this.fire(new i.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.warnOnce(il),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){const y=this.transform;if(!y.projection.supportsFreeCamera)return i.warnOnce(il),this;this.stop();const w=y.zoom,S=y.pitch,R=y.bearing;y.setFreeCameraOptions(a);const D=w!==y.zoom,G=S!==y.pitch,q=R!==y.bearing;return this.fire(new i.Event("movestart",h)).fire(new i.Event("move",h)),D&&this.fire(new i.Event("zoomstart",h)).fire(new i.Event("zoom",h)).fire(new i.Event("zoomend",h)),q&&this.fire(new i.Event("rotatestart",h)).fire(new i.Event("rotate",h)).fire(new i.Event("rotateend",h)),G&&this.fire(new i.Event("pitchstart",h)).fire(new i.Event("pitch",h)).fire(new i.Event("pitchend",h)),this.fire(new i.Event("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),((a=i.extend({offset:[0,0],duration:500,easing:i.ease},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const y=this.transform,w=this.getZoom(),S=this.getBearing(),R=this.getPitch(),D=this.getPadding(),G="zoom"in a?+a.zoom:w,q="bearing"in a?this._normalizeBearing(a.bearing,S):S,Z="pitch"in a?+a.pitch:R,ne="padding"in a?a.padding:y.padding,he=i.Point.convert(a.offset);let fe,_e,ge;if(y.projection.name==="globe"){const $e=i.MercatorCoordinate.fromLngLat(y.center),it=he.rotate(-y.angle);$e.x+=it.x/y.worldSize,$e.y+=it.y/y.worldSize;const Pt=$e.toLngLat(),Qe=i.LngLat.convert(a.center||Pt);this._normalizeCenter(Qe),fe=y.centerPoint.add(it),_e=new i.Point($e.x,$e.y).mult(y.worldSize),ge=new i.Point(i.mercatorXfromLng(Qe.lng),i.mercatorYfromLat(Qe.lat)).mult(y.worldSize).sub(_e)}else{fe=y.centerPoint.add(he);const $e=y.pointLocation(fe),it=i.LngLat.convert(a.center||$e);this._normalizeCenter(it),_e=y.project($e),ge=y.project(it).sub(_e)}const ye=y.zoomScale(G-w);let ie,pe;a.around&&(ie=i.LngLat.convert(a.around),pe=y.locationPoint(ie));const we=this._zooming||G!==w,Ee=this._rotating||S!==q,ke=this._pitching||Z!==R,Ue=!y.isPaddingEqual(ne),Fe=$e=>it=>{if(we&&($e.zoom=i.number(w,G,it)),Ee&&($e.bearing=i.number(S,q,it)),ke&&($e.pitch=i.number(R,Z,it)),Ue&&($e.interpolatePadding(D,ne,it),fe=$e.centerPoint.add(he)),ie)$e.setLocationAtPoint(ie,pe);else{const Pt=$e.zoomScale($e.zoom-w),Qe=G>w?Math.min(2,ye):Math.max(.5,ye),gt=Math.pow(Qe,1-it),st=$e.unproject(_e.add(ge.mult(it*gt)).mult(Pt));$e.setLocationAtPoint($e.renderWorldCopies?st.wrap():st,fe)}return a.preloadOnly||this._fireMoveEvents(h),$e};if(a.preloadOnly){const $e=this._emulate(Fe,a.duration,y);return this._preloadTiles($e),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=we,this._rotating=Ee,this._pitching=ke,this._padding=Ue,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,He),this._ease(Fe(y),$e=>{y.recenterOnTerrain(),this._afterEase(h,$e)},a),this}_prepareEase(a,h,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||y.moving||this.fire(new i.Event("movestart",a)),this._zooming&&!y.zooming&&this.fire(new i.Event("zoomstart",a)),this._rotating&&!y.rotating&&this.fire(new i.Event("rotatestart",a)),this._pitching&&!y.pitching&&this.fire(new i.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new i.Event("move",a)),this._zooming&&this.fire(new i.Event("zoom",a)),this._rotating&&this.fire(new i.Event("rotate",a)),this._pitching&&this.fire(new i.Event("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,w=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new i.Event("zoomend",a)),w&&this.fire(new i.Event("rotateend",a)),S&&this.fire(new i.Event("pitchend",a)),this.fire(new i.Event("moveend",a))}flyTo(a,h){if(this._prefersReducedMotion(a)){const at=i.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,h)}this.stop(),a=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},a);const y=this.transform,w=this.getZoom(),S=this.getBearing(),R=this.getPitch(),D=this.getPadding(),G="zoom"in a?i.clamp(+a.zoom,y.minZoom,y.maxZoom):w,q="bearing"in a?this._normalizeBearing(a.bearing,S):S,Z="pitch"in a?+a.pitch:R,ne="padding"in a?a.padding:y.padding,he=y.zoomScale(G-w),fe=i.Point.convert(a.offset);let _e=y.centerPoint.add(fe);const ge=y.pointLocation(_e),ye=i.LngLat.convert(a.center||ge);this._normalizeCenter(ye);const ie=y.project(ge),pe=y.project(ye).sub(ie);let we=a.curve;const Ee=Math.max(y.width,y.height),ke=Ee/he,Ue=pe.mag();if("minZoom"in a){const at=i.clamp(Math.min(a.minZoom,w,G),y.minZoom,y.maxZoom),Et=Ee/y.zoomScale(at-w);we=Math.sqrt(Et/Ue*2)}const Fe=we*we;function He(at){const Et=(ke*ke-Ee*Ee+(at?-1:1)*Fe*Fe*Ue*Ue)/(2*(at?ke:Ee)*Fe*Ue);return Math.log(Math.sqrt(Et*Et+1)-Et)}function $e(at){return(Math.exp(at)-Math.exp(-at))/2}function it(at){return(Math.exp(at)+Math.exp(-at))/2}const Pt=He(0);let Qe=function(at){return it(Pt)/it(Pt+we*at)},gt=function(at){return Ee*((it(Pt)*($e(Et=Pt+we*at)/it(Et))-$e(Pt))/Fe)/Ue;var Et},st=(He(1)-Pt)/we;if(Math.abs(Ue)<1e-6||!isFinite(st)){if(Math.abs(Ee-ke)<1e-6)return this.easeTo(a,h);const at=ke<Ee?-1:1;st=Math.abs(Math.log(ke/Ee))/we,gt=function(){return 0},Qe=function(Et){return Math.exp(at*we*Et)}}a.duration="duration"in a?+a.duration:1e3*st/("screenSpeed"in a?+a.screenSpeed/we:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Lt=S!==q,tt=Z!==R,mt=!y.isPaddingEqual(ne),xt=at=>Et=>{const rn=Et*st,fn=1/Qe(rn);at.zoom=Et===1?G:w+at.scaleZoom(fn),Lt&&(at.bearing=i.number(S,q,Et)),tt&&(at.pitch=i.number(R,Z,Et)),mt&&(at.interpolatePadding(D,ne,Et),_e=at.centerPoint.add(fe));const qt=Et===1?ye:at.unproject(ie.add(pe.mult(gt(rn))).mult(fn));return at.setLocationAtPoint(at.renderWorldCopies?qt.wrap():qt,_e),at._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),at};if(a.preloadOnly){const at=this._emulate(xt,a.duration,y);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=Lt,this._pitching=tt,this._padding=mt,this._prepareEase(h,!1),this._ease(xt(y),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,h)}if(!a){const y=this.handlers;y&&y.stop(!1)}return this}_ease(a,h,y){y.animate===!1||y.duration===0?(a(1),h()):(this._easeStart=i.exported.now(),this._easeOptions=y,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((i.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=i.wrap(a,-180,180);const y=Math.abs(a-h);return Math.abs(a-360-h)<y&&(a-=360),Math.abs(a+360-h)<y&&(a+=360),a}_normalizeCenter(a){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const y=a.lng-h.center.lng;a.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&i.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,h,y){const w=Math.ceil(15*h/1e3),S=[],R=a(y.clone());for(let D=0;D<=w;D++){const G=R(D/w);S.push(G.clone())}return S}}class on{constructor(a={}){this.options=a,i.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const h=this.options&&this.options.compact;return this._map=a,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=O("button","mapboxgl-ctrl-attrib-button",this._container),O("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=O("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,h){const y=this._map._getUIString(`AttributionControl.${h}`);a.setAttribute("aria-label",y),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.config.ACCESS_TOKEN}];if(a){const y=h.reduce((w,S,R)=>(S.value&&(w+=`${S.key}=${S.value}${R<h.length-1?"&":""}`),w),"?");a.href=`${i.config.FEEDBACK_URL}/${y}#${Zc(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._sourceCaches;for(const w in h){const S=h[w];if(S.used){const R=S.getSource();R.attribution&&a.indexOf(R.attribution)<0&&a.push(R.attribution)}}a.sort((w,S)=>w.length-S.length),a=a.filter((w,S)=>{for(let R=S+1;R<a.length;R++)if(a[R].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const y=a.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,a.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Eh{constructor(){i.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=O("div","mapboxgl-ctrl");const h=O("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const h in a){const y=a[h].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Ch{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const w of y)if(w.id===a)return void(w.cancelled=!0)}run(a=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Tl(m,a,h){if(m=new i.LngLat(m.lng,m.lat),a){const y=new i.LngLat(m.lng-360,m.lat),w=new i.LngLat(m.lng+360,m.lat),S=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),R=h.locationPoint(m).distSqr(a),D=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint(y).distSqr(a)<R&&(D||Math.abs(y.lng-h.center.lng)<S)?m=y:h.locationPoint(w).distSqr(a)<R&&(D||Math.abs(w.lng-h.center.lng)<S)&&(m=w)}for(;Math.abs(m.lng-h.center.lng)>180;){const y=h.locationPoint(m);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const Zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Xt extends i.Evented{constructor(a,h){if(super(),(a instanceof i.window.HTMLElement||h)&&(a=i.extend({element:a},h)),i.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=i.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=O("div");const w=41,S=27,R=z("svg",{display:"block",height:w*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${w}`},this._element),D=z("radialGradient",{id:"shadowGradient"},z("defs",{},R));z("stop",{offset:"10%","stop-opacity":.4},D),z("stop",{offset:"100%","stop-opacity":.05},D),z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},R),z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},R),z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},R),z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},R),this._offset=i.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const y=this._element.classList;for(const w in Zl)y.remove(`mapboxgl-marker-anchor-${w}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=i.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const h=a.code,y=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(a){const h=a.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,h=this._pos;if(!a||!h)return!1;const y=a.unproject(h),w=a.getFreeCameraOptions();if(!w.position)return!1;const S=w.position.toLngLat();return S.distanceTo(y)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();const y=a.unproject(h);let w;a._showingGlobe()&&i.isLngLatBehindGlobe(a.transform,this._lngLat)?w=0:(w=1-a._queryFogOpacity(y),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Zl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const a=this._pos,h=this._map,y=this.getPitchAlignment();if(!h||!a||y!=="map")return"";if(!h._showingGlobe()){const G=h.getPitch();return G?`rotateX(${G}deg)`:""}const w=i.radToDeg(i.globeTiltAtLngLat(h.transform,this._lngLat)),S=a.sub(i.globeCenterToScreenPoint(h.transform)),R=Math.abs(S.x)+Math.abs(S.y);if(R===0)return"";const D=w/R;return`rotateX(${-S.y*D}deg) rotateY(${S.x*D}deg)`}_calculateZTransform(){const a=this._pos,h=this._map;if(!h||!a)return"";let y=0;const w=this.getRotationAlignment();if(w==="map")if(h._showingGlobe()){const S=h.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),R=h.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);y=i.radToDeg(Math.atan2(R.y,R.x))-90}else y=-h.getBearing();else if(w==="horizon"){const S=i.smoothstep(4,6,h.getZoom()),R=i.globeCenterToScreenPoint(h.transform);R.y+=S*h.transform.height;const D=a.sub(R),G=i.radToDeg(Math.atan2(D.y,D.x));y=(G>90?G-270:G+90)*(1-S)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(a){i.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Tl(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),a===!0?this._updateFrameId=i.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=i.Point.convert(a),this._update(),this}_onMove(a){const h=this._map;if(!h)return;const y=this._pointerdownPos,w=this._positionDelta;if(y&&w){if(!this._isDragging){const S=this._clickTolerance||h._clickTolerance;if(a.point.dist(y)<S)return;this._isDragging=!0}this._pos=a.point.sub(w),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.Event("dragstart"))),this.fire(new i.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.Event("dragend")),this._state="inactive"}_addDragHandler(a){const h=this._map,y=this._pos;h&&y&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(y),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ah={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Sl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xd(m=new i.Point(0,0),a="bottom"){if(typeof m=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new i.Point(0,m);case"top-left":return new i.Point(h,h);case"top-right":return new i.Point(-h,h);case"bottom":return new i.Point(0,-m);case"bottom-left":return new i.Point(h,-h);case"bottom-right":return new i.Point(-h,-h);case"left":return new i.Point(m,0);case"right":return new i.Point(-m,0)}return new i.Point(0,0)}return m instanceof i.Point||Array.isArray(m)?i.Point.convert(m):i.Point.convert(m[a]||[0,0])}class id{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const h=i.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,y){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+y}}const Hu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Xl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Tp={showCompass:!0,showZoom:!0,visualizePitch:!1};class cn{constructor(a,h,y=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new xh({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,y&&(this.mousePitch=new bh({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),i.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),X()}move(a,h){const y=this.map,w=this.mouseRotate.mousemoveWindow(a,h),S=w&&w.bearingDelta;if(S&&y.setBearing(y.getBearing()+S),this.mousePitch){const R=this.mousePitch.mousemoveWindow(a,h),D=R&&R.pitchDelta;D&&y.setPitch(y.getPitch()+D)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){J(),i.window.removeEventListener("mousemove",this.mousemove),i.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(i.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),ae(this.element,a)),i.window.addEventListener("mousemove",this.mousemove),i.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,ae(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=be(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=be(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const nu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Wu={maxWidth:100,unit:"metric"},Th={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ru={version:i.version,supported:T,setRTLTextPlugin:i.setRTLTextPlugin,getRTLTextPluginStatus:i.getRTLTextPluginStatus,Map:class extends $u{constructor(m){if(i.LivePerformanceUtils.mark(i.PerformanceMarkers.create),(m=i.extend({},Xl,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&i.isSafariWithAntialiasingBug(i.window)&&(m.antialias=!1,i.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new rl(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Ch,this._domRenderTaskQueue=new Ch,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.uniqueId(),this._locale=i.extend({},Hu,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new id(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new i.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=i.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof i.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&i.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),i.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),i.window!==void 0&&(i.window.addEventListener("online",this._onWindowOnline,!1),i.window.addEventListener("resize",this._onWindowResize,!1),i.window.addEventListener("orientationchange",this._onWindowResize,!1),i.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Fs(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new gh(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,i.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new on({customAttribution:m.customAttribution})),this._logoControl=new Eh,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new i.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new i.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(m,a){if(a===void 0&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const y=this._controlPositions[a];return a.indexOf("bottom")!==-1?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new i.Event("movestart",m)).fire(new i.Event("move",m)),this.fire(new i.Event("resize",m)),a&&this.fire(new i.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(i.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?i.window.navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(a=>a==="auto"?i.window.navigator.language:a):m}setLanguage(m){const a=this._parseLanguage(m);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,a=m.projection.name;let h;a==="globe"&&m.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),h=!0):a==="mercator"&&m.zoom<i.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,a){return this._updateProjection(m||a||{name:"mercator"})}_updateProjection(m){let a;if(a=m.name==="globe"&&this.transform.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(i.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(i.Point.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,a,h){if(m==="mouseenter"||m==="mouseover"){let y=!1;const w=R=>{const D=a.filter(q=>this.getLayer(q)),G=D.length?this.queryRenderedFeatures(R.point,{layers:D}):[];G.length?y||(y=!0,h.call(this,new ao(m,this,R.originalEvent,{features:G}))):y=!1},S=()=>{y=!1};return{layers:new Set(a),listener:h,delegates:{mousemove:w,mouseout:S}}}if(m==="mouseleave"||m==="mouseout"){let y=!1;const w=R=>{const D=a.filter(G=>this.getLayer(G));(D.length?this.queryRenderedFeatures(R.point,{layers:D}):[]).length?y=!0:y&&(y=!1,h.call(this,new ao(m,this,R.originalEvent)))},S=R=>{y&&(y=!1,h.call(this,new ao(m,this,R.originalEvent)))};return{layers:new Set(a),listener:h,delegates:{mousemove:w,mouseout:S}}}{const y=w=>{const S=a.filter(D=>this.getLayer(D)),R=S.length?this.queryRenderedFeatures(w.point,{layers:S}):[];R.length&&(w.features=R,h.call(this,w),delete w.features)};return{layers:new Set(a),listener:h,delegates:{[m]:y}}}}on(m,a,h){if(h===void 0)return super.on(m,a);Array.isArray(a)||(a=[a]);const y=this._createDelegatedListener(m,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(y);for(const w in y.delegates)this.on(w,y.delegates[w]);return this}once(m,a,h){if(h===void 0)return super.once(m,a);Array.isArray(a)||(a=[a]);const y=this._createDelegatedListener(m,a,h);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(m,a,h){if(h===void 0)return super.off(m,a);a=new Set(Array.isArray(a)?a:[a]);const y=(S,R)=>{if(S.size!==R.size)return!1;for(const D of S)if(!R.has(D))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[m]:void 0;return w&&(S=>{for(let R=0;R<S.length;R++){const D=S[R];if(D.listener===h&&y(D.layers,a)){for(const G in D.delegates)this.off(G,D.delegates[G]);return S.splice(R,1),this}}})(w),this}queryRenderedFeatures(m,a){return this.style?(a!==void 0||m===void 0||m instanceof i.Point||Array.isArray(m)||(a=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(m,a){return this.style.querySourceFeatures(m,a)}isPointOnSurface(m){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&i.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.Point.convert(m))}setStyle(m,a){return(a=i.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(a==null)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new Ds(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,a){if(typeof m=="string"){const h=this._requestManager.normalizeStyleURL(m),y=this._requestManager.transformRequest(h,i.ResourceType.Style);i.getJSON(y,(w,S)=>{w?this.fire(new i.ErrorEvent(w)):S&&this._updateDiff(S,a)})}else typeof m=="object"&&this._updateDiff(m,a)}_updateDiff(m,a){try{this.style.setState(m)&&this._update(!0)}catch(h){i.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.warnOnce("There is no style added to the map."),!1)}addSource(m,a){return this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const a in m){const h=m[a]._tiles;for(const y in h){const w=h[y];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}addSourceType(m,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,h)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,a,{pixelRatio:h=1,sdf:y=!1,stretchX:w,stretchY:S,content:R}={}){if(this._lazyInitEmptyStyle(),a instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&a instanceof i.window.ImageBitmap){const{width:D,height:G,data:q}=i.exported.getImageData(a);this.style.addImage(m,{data:new i.RGBAImage({width:D,height:G},q),pixelRatio:h,stretchX:w,stretchY:S,content:R,sdf:y,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:G}=a,q=a;this.style.addImage(m,{data:new i.RGBAImage({width:D,height:G},new Uint8Array(q.data)),pixelRatio:h,stretchX:w,stretchY:S,content:R,sdf:y,version:0,userImage:q}),q.onAdd&&q.onAdd(this,m)}}updateImage(m,a){const h=this.style.getImage(m);if(!h)return void this.fire(new i.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=a instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&a instanceof i.window.ImageBitmap?i.exported.getImageData(a):a,{width:w,height:S}=y;w!==void 0&&S!==void 0?w===h.data.width&&S===h.data.height?(h.data.replace(y.data,!(a instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&a instanceof i.window.ImageBitmap)),this.style.updateImage(m,h)):this.fire(new i.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${S})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`))):this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new i.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,a){i.getImage(this._requestManager.transformRequest(m,i.ResourceType.Image),(h,y)=>{a(h,y instanceof i.window.HTMLImageElement?i.exported.getImageData(y):y)})}listImages(){return this.style.listImages()}addLayer(m,a){return this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)}moveLayer(m,a){return this.style.moveLayer(m,a),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,a,h){return this.style.setLayerZoomRange(m,a,h),this._update(!0)}setFilter(m,a,h={}){return this.style.setFilter(m,a,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,a,h,y={}){return this.style.setPaintProperty(m,a,h,y),this._update(!0)}getPaintProperty(m,a){return this.style.getPaintProperty(m,a)}setLayoutProperty(m,a,h,y={}){return this.style.setLayoutProperty(m,a,h,y),this._update(!0)}getLayoutProperty(m,a){return this.style.getLayoutProperty(m,a)}setLight(m,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.LngLat.convert(m),this.transform):0}setFeatureState(m,a){return this.style.setFeatureState(m,a),this._update()}removeFeatureState(m,a){return this.style.removeFeatureState(m,a),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let h,y,w,S=this._container;for(;S&&(!y||!w);){const R=i.window.getComputedStyle(S).transform;R&&R!=="none"&&(h=R.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(y=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(w=h[3])),S=S.parentElement}this._containerWidth=y?Math.abs(m/y):m,this._containerHeight=w?Math.abs(a/w):a}_detectMissingCSS(){i.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=O("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=O("div","mapboxgl-canvas-container",m);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=O("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=O("div","mapboxgl-control-container",m),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{y[w]=O("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const h=i.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);a!==-1&&this._markers.splice(a,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const a=this._popups.indexOf(m);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const m=i.extend({},T.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",m),h=a||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);h?(this._useWebGL2&&!a&&i.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),i.storeAuthState(h,!0),this.painter=new So(h,this.transform,!!a),this.on("data",y=>{y.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.exported$1.testSupport(h)):this.fire(new i.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new i.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;const h=this.painter.context.extTimerQuery,y=i.exported.now();if(this.listens("gpu-timing-frame")&&(a=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],i.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],i.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,G=this.transform.pitch,q=i.exported.now(),Z=new i.EvaluationParameters(D,{now:q,fadeDuration:w,pitch:G,transition:this.style.getTransition()});this.style.update(Z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(y),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const D=i.exported.now()-y;h.endQueryEXT(h.TIME_ELAPSED_EXT,a),setTimeout(()=>{const G=h.getQueryObjectEXT(a,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(a),this.fire(new i.Event("gpu-timing-frame",{cpuTime:D,gpuTime:G})),i.window.performance.mark("frame-gpu",{startTime:y,detail:{gpuTime:G}})},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const G=this.painter.queryGpuTimers(D);this.fire(new i.Event("gpu-timing-layer",{layerTimes:G}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const G=this.painter.queryGpuTimeDeferredRender(D);this.fire(new i.Event("gpu-timing-deferred-render",{gpuTime:G}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(R||this._repaint)this.triggerRepaint();else{const D=!this.isMoving()&&this.loaded();if(D&&(S=this._updateAverageElevation(y,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new i.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const G=this._calculateSpeedIndex();this.fire(new i.Event("speedindexcompleted",{speedIndex:G})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,i.LivePerformanceUtils.mark(i.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&i.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const a of this._markers)m&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!m||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(m,a=!1){const h=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const y=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),S=!1;this.transform.elevation&&(S=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const R=Math.abs(y-w);if(R>1){if(this._isInitialLoad||S)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,m,300)}else if(R>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){i.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===i.AUTH_ERR_MSG||m.status===401)){const a=this.painter.context.gl;i.storeAuthState(a,!1),this._logoControl instanceof Eh&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const h=this.painter.context.gl,y=h.createFramebuffer();function w(S){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,S,0);const R=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,R),R}return h.bindFramebuffer(h.FRAMEBUFFER,y),this._canvasPixelComparison(w(m),a.canvasCopies.map(w),a.timeStamps)}_canvasPixelComparison(m,a,h){let y=h[1]-h[0];const w=m.length/4;for(let S=0;S<a.length;S++){const R=a[S];let D=0;for(let G=0;G<R.length;G+=4)R[G]===m[G]&&R[G+1]===m[G+1]&&R[G+2]===m[G+2]&&R[G+3]===m[G+3]&&(D+=1);y+=(h[S+2]-h[S+1])*(1-D/w)}return y}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),i.window!==void 0&&(i.window.removeEventListener("resize",this._onWindowResize,!1),i.window.removeEventListener("orientationchange",this._onWindowResize,!1),i.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.removeEventListener("online",this._onWindowOnline,!1),i.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new i.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=i.exported.frame(a=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(m){const a=this.style?Object.values(this.style._sourceCaches):[];return i.asyncAll(a,(h,y)=>h._preloadTiles(m,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){i.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,a){i.setCacheLimits(m,a)}get version(){return i.version}},NavigationControl:class{constructor(m){this.options=i.extend({},Tp,m),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(i.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),O("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),O("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=O("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),h=a===m.getMaxZoom(),y=a===m.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cn(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const h=O("button",m,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(m,a){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends i.Evented{constructor(m){super(),this.options=i.extend({geolocation:i.window.navigator.geolocation},nu,m),i.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const a=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,m(h)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):i.window.navigator.permissions!==void 0?i.window.navigator.permissions.query({name:"geolocation"}).then(h=>a(h.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),h=m.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new i.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("geolocate",m)),this._finish()}}_updateCamera(m){const a=new i.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,y=this._map.getBearing(),w=i.extend({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),w,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new i.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=i.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=O("button","mapboxgl-ctrl-geolocate",this._container),O("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){i.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O("div","mapboxgl-user-location"),this._dotElement.appendChild(O("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(O("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=O("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{i.window.addEventListener("ondeviceorientationabsolute"in i.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};i.window.DeviceMotionEvent!==void 0&&typeof i.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),i.window.removeEventListener("deviceorientation",this._onDeviceOrientation),i.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:on,ScaleControl:class{constructor(m){this.options=i.extend({},Wu,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,y=a._containerWidth/2-m/2,w=a.unproject([y,h]),S=a.unproject([y+m,h]),R=w.distanceTo(S);if(this.options.unit==="imperial"){const D=3.2808*R;D>5280?this._setScale(m,D/5280,"mile"):this._setScale(m,D,"foot")}else this.options.unit==="nautical"?this._setScale(m,R/1852,"nautical-mile"):R>=1e3?this._setScale(m,R/1e3,"kilometer"):this._setScale(m,R,"meter")}_setScale(m,a,h){this._map._requestDomTask(()=>{const y=function(S){const R=Math.pow(10,`${Math.floor(S)}`.length-1);let D=S/R;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(G){const q=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*q)/q}(D),R*D}(a),w=y/a;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(y):`${y}&nbsp;${Th[h]}`,this._container.style.width=m*w+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof i.window.HTMLElement?this._container=m.container:i.warnOnce("Full screen control 'container' must be a DOM element.")),i.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in i.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in i.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,i.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!i.window.document.fullscreenEnabled&&!i.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=O("button","mapboxgl-ctrl-fullscreen",this._controlContainer);O("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),i.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(i.window.document.fullscreenElement||i.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?i.window.document.exitFullscreen?i.window.document.exitFullscreen():i.window.document.webkitCancelFullScreen&&i.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.Evented{constructor(m){super(),this.options=i.extend(Object.create(Ah),m),i.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new i.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new i.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=i.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(i.window.document.createTextNode(m))}setHTML(m){const a=i.window.document.createDocumentFragment(),h=i.window.document.createElement("body");let y;for(h.innerHTML=m;y=h.firstChild,y;)a.appendChild(y);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=O("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const h=this._closeButton=O("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,h=this._container,y=this._pos;if(!a||!h||!y)return"bottom";const w=h.offsetWidth,S=h.offsetHeight,R=y.x<w/2,D=y.x>a.transform.width-w/2;if(y.y+m<S)return R?"top-left":D?"top-right":"top";if(y.y>a.transform.height-S){if(R)return"bottom-left";if(D)return"bottom-right"}return R?"left":D?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let y=this._container;if(y||(y=this._container=O("div","mapboxgl-popup",a.getContainer()),this._tip=O("div","mapboxgl-popup-tip",y),y.appendChild(h)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tl(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const w=this._pos=this._trackPointer&&m?m:a.project(this._lngLat),S=Xd(this.options.offset),R=this._anchor=this._getAnchor(S.y),D=Xd(this.options.offset,R),G=w.add(D).round();a._requestDomTask(()=>{this._container&&R&&(this._container.style.transform=`${Zl[R]} translate(${G.x}px,${G.y}px)`)})}if(!this._marker&&a._showingGlobe()){const w=i.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Sl);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Xt,Style:Ds,LngLat:i.LngLat,LngLatBounds:i.LngLatBounds,Point:i.Point,MercatorCoordinate:i.MercatorCoordinate,FreeCameraOptions:Wc,Evented:i.Evented,config:i.config,prewarm:function(){Nl().acquire(Hs)},clearPrewarmedResources:function(){const m=Eo;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Hs),Eo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return i.config.ACCESS_TOKEN},set accessToken(m){i.config.ACCESS_TOKEN=m},get baseApiUrl(){return i.config.API_URL},set baseApiUrl(m){i.config.API_URL=m},get workerCount(){return br.workerCount},set workerCount(m){br.workerCount=m},get maxParallelImageRequests(){return i.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){i.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){i.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:i.exported.setNow,restoreNow:i.exported.restoreNow};return ru});var b=d;return b})})(Q3);var Mx=Q3.exports;const tP=F_(Mx),d$=ND({__proto__:null,default:tP},[Mx]),f$=k.createContext(null);function p$(n,t){const r=Array.isArray(n)?n[0]:n?n.x:0,l=Array.isArray(n)?n[1]:n?n.y:0,u=Array.isArray(t)?t[0]:t?t.x:0,d=Array.isArray(t)?t[1]:t?t.y:0;return r===u&&l===d}function Ol(n,t){if(n===t)return!0;if(!n||!t)return!1;if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!Ol(n[r],t[r]))return!1;return!0}else if(Array.isArray(t))return!1;if(typeof n=="object"&&typeof t=="object"){const r=Object.keys(n),l=Object.keys(t);if(r.length!==l.length)return!1;for(const u of r)if(!t.hasOwnProperty(u)||!Ol(n[u],t[u]))return!1;return!0}return!1}function m$(n){const t=n.clone();return t.pixelsToGLUnits=n.pixelsToGLUnits,t}function oT(n,t){if(!n.getProjection)return;const r=n.getProjection(),l=t.getProjection();Ol(r,l)||t.setProjection(r)}function sT(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function aT(n,t){const r=t.viewState||t;let l=!1;if("longitude"in r&&"latitude"in r){const u=n.center;n.center=new u.constructor(r.longitude,r.latitude),l=l||u!==n.center}if("zoom"in r){const u=n.zoom;n.zoom=r.zoom,l=l||u!==n.zoom}if("bearing"in r){const u=n.bearing;n.bearing=r.bearing,l=l||u!==n.bearing}if("pitch"in r){const u=n.pitch;n.pitch=r.pitch,l=l||u!==n.pitch}return r.padding&&!n.isPaddingEqual(r.padding)&&(l=!0,n.padding=r.padding),l}const g$=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function lT(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const t={};for(const l of n.layers)t[l.id]=l;const r=n.layers.map(l=>{let u=null;"interactive"in l&&(u=Object.assign({},l),delete u.interactive);const d=t[l.ref];if(d){u=u||Object.assign({},l),delete u.ref;for(const p of g$)p in d&&(u[p]=d[p])}return u||l});return{...n,layers:r}}var cT={};const uT={version:8,sources:{},layers:[]},hT={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},dv={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},dT={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},_$=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],y$=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class lp{constructor(t,r,l){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=u=>{const d=this.props[dT[u.type]];d?d(u):u.type==="error"&&console.error(u.error)},this._onPointerEvent=u=>{(u.type==="mousemove"||u.type==="mouseout")&&this._updateHover(u);const d=this.props[hT[u.type]];d&&(this.props.interactiveLayerIds&&u.type!=="mouseover"&&u.type!=="mouseout"&&(u.features=this._hoveredFeatures||this._queryRenderedFeatures(u.point)),d(u),delete u.features)},this._onCameraEvent=u=>{if(!this._internalUpdate){const d=this.props[dv[u.type]];d&&d(u)}u.type in this._deferredEvents&&(this._deferredEvents[u.type]=!1)},this._MapClass=t,this.props=r,this._initialize(l)}get map(){return this._map}get transform(){return this._renderTransform}setProps(t){const r=this.props;this.props=t;const l=this._updateSettings(t,r);l&&this._createShadowTransform(this._map);const u=this._updateSize(t),d=this._updateViewState(t,!0);this._updateStyle(t,r),this._updateStyleComponents(t,r),this._updateHandlers(t,r),(l||u||d&&!this._map.isMoving())&&this.redraw()}static reuse(t,r){const l=lp.savedMaps.pop();if(!l)return null;const u=l.map,d=u.getContainer();for(r.className=d.className;d.childNodes.length>0;)r.appendChild(d.childNodes[0]);u._container=r;const p=u._resizeObserver;p&&(p.disconnect(),p.observe(r)),l.setProps({...t,styleDiffing:!1}),u.resize();const{initialViewState:b}=t;return b&&(b.bounds?u.fitBounds(b.bounds,{...b.fitBoundsOptions,duration:0}):l._updateViewState(b,!1)),u.isStyleLoaded()?u.fire("load"):u.once("styledata",()=>u.fire("load")),u._update(),l}_initialize(t){const{props:r}=this,{mapStyle:l=uT}=r,u={...r,...r.initialViewState,accessToken:r.mapboxAccessToken||v$()||null,container:t,style:lT(l)},d=u.initialViewState||u.viewState||u;if(Object.assign(u,{center:[d.longitude||0,d.latitude||0],zoom:d.zoom||0,pitch:d.pitch||0,bearing:d.bearing||0}),r.gl){const T=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=T,r.gl)}const p=new this._MapClass(u);d.padding&&p.setPadding(d.padding),r.cursor&&(p.getCanvas().style.cursor=r.cursor),this._createShadowTransform(p);const b=p._render;p._render=T=>{this._inRender=!0,b.call(p,T),this._inRender=!1};const i=p._renderTaskQueue.run;p._renderTaskQueue.run=T=>{i.call(p._renderTaskQueue,T),this._onBeforeRepaint()},p.on("render",()=>this._onAfterRepaint());const E=p.fire;p.fire=this._fireEvent.bind(this,E),p.on("resize",()=>{this._renderTransform.resize(p.transform.width,p.transform.height)}),p.on("styledata",()=>{this._updateStyleComponents(this.props,{}),oT(p.transform,this._renderTransform)}),p.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const T in hT)p.on(T,this._onPointerEvent);for(const T in dv)p.on(T,this._onCameraEvent);for(const T in dT)p.on(T,this._onEvent);this._map=p}recycle(){const r=this.map.getContainer().querySelector("[mapboxgl-children]");r==null||r.remove(),lp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;!this._inRender&&t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_createShadowTransform(t){const r=m$(t.transform);t.painter.transform=r,this._renderTransform=r}_updateSize(t){const{viewState:r}=t;if(r){const l=this._map;if(r.width!==l.transform.width||r.height!==l.transform.height)return l.resize(),!0}return!1}_updateViewState(t,r){if(this._internalUpdate)return!1;const l=this._map,u=this._renderTransform,{zoom:d,pitch:p,bearing:b}=u,i=l.isMoving();i&&(u.cameraElevationReference="sea");const E=aT(u,{...sT(l.transform),...t});if(i&&(u.cameraElevationReference="ground"),E&&r){const T=this._deferredEvents;T.move=!0,T.zoom||(T.zoom=d!==u.zoom),T.rotate||(T.rotate=b!==u.bearing),T.pitch||(T.pitch=p!==u.pitch)}return i||aT(l.transform,t),E}_updateSettings(t,r){const l=this._map;let u=!1;for(const d of _$)if(d in t&&!Ol(t[d],r[d])){u=!0;const p=l[`set${d[0].toUpperCase()}${d.slice(1)}`];p==null||p.call(l,t[d])}return u}_updateStyle(t,r){if(t.cursor!==r.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==r.mapStyle){const{mapStyle:l=uT,styleDiffing:u=!0}=t,d={diff:u};return"localIdeographFontFamily"in t&&(d.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(lT(l),d),!0}return!1}_updateStyleComponents(t,r){const l=this._map;let u=!1;return l.isStyleLoaded()&&("light"in t&&l.setLight&&!Ol(t.light,r.light)&&(u=!0,l.setLight(t.light)),"fog"in t&&l.setFog&&!Ol(t.fog,r.fog)&&(u=!0,l.setFog(t.fog)),"terrain"in t&&l.setTerrain&&!Ol(t.terrain,r.terrain)&&(!t.terrain||l.getSource(t.terrain.source))&&(u=!0,l.setTerrain(t.terrain))),u}_updateHandlers(t,r){var l,u;const d=this._map;let p=!1;for(const b of y$){const i=(l=t[b])!==null&&l!==void 0?l:!0,E=(u=r[b])!==null&&u!==void 0?u:!0;Ol(i,E)||(p=!0,i?d[b].enable(i):d[b].disable())}return p}_queryRenderedFeatures(t){const r=this._map,l=r.transform,{interactiveLayerIds:u=[]}=this.props;try{return r.transform=this._renderTransform,r.queryRenderedFeatures(t,{layers:u.filter(r.getLayer.bind(r))})}catch{return[]}finally{r.transform=l}}_updateHover(t){var r;const{props:l}=this;if(l.interactiveLayerIds&&(l.onMouseMove||l.onMouseEnter||l.onMouseLeave)){const d=t.type,p=((r=this._hoveredFeatures)===null||r===void 0?void 0:r.length)>0,b=this._queryRenderedFeatures(t.point),i=b.length>0;!i&&p&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=b,i&&!p&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=d}else this._hoveredFeatures=null}_fireEvent(t,r,l){const u=this._map,d=u.transform,p=typeof r=="string"?r:r.type;return p==="move"&&this._updateViewState(this.props,!1),p in dv&&(typeof r=="object"&&(r.viewState=sT(d)),this._map.isMoving())?(u.transform=this._renderTransform,t.call(u,r,l),u.transform=d,u):(t.call(u,r,l),u)}_onBeforeRepaint(){const t=this._map;this._internalUpdate=!0;for(const l in this._deferredEvents)this._deferredEvents[l]&&t.fire(l);this._internalUpdate=!1;const r=this._map.transform;t.transform=this._renderTransform,this._onAfterRepaint=()=>{oT(this._renderTransform,r),t.transform=r}}}lp.savedMaps=[];function v$(){let n=null;if(typeof location<"u"){const t=/access_token=([^&\/]*)/.exec(location.search);n=t&&t[1]}try{n=n||cT.MapboxAccessToken}catch{}try{n=n||cT.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return n}const x$=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function b$(n){if(!n)return null;const t=n.map,r={getMap:()=>t,getCenter:()=>n.transform.center,getZoom:()=>n.transform.zoom,getBearing:()=>n.transform.bearing,getPitch:()=>n.transform.pitch,getPadding:()=>n.transform.padding,getBounds:()=>n.transform.getBounds(),project:l=>{const u=t.transform;t.transform=n.transform;const d=t.project(l);return t.transform=u,d},unproject:l=>{const u=t.transform;t.transform=n.transform;const d=t.unproject(l);return t.transform=u,d},queryTerrainElevation:(l,u)=>{const d=t.transform;t.transform=n.transform;const p=t.queryTerrainElevation(l,u);return t.transform=d,p},queryRenderedFeatures:(l,u)=>{const d=t.transform;t.transform=n.transform;const p=t.queryRenderedFeatures(l,u);return t.transform=d,p}};for(const l of w$(t))!(l in r)&&!x$.includes(l)&&(r[l]=t[l].bind(t));return r}function w$(n){const t=new Set;let r=n;for(;r;){for(const l of Object.getOwnPropertyNames(r))l[0]!=="_"&&typeof n[l]=="function"&&l!=="fire"&&l!=="setEventedParent"&&t.add(l);r=Object.getPrototypeOf(r)}return Array.from(t)}const E$=typeof document<"u"?k.useLayoutEffect:k.useEffect,C$=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function A$(n,t){for(const l of C$)l in t&&(n[l]=t[l]);const{RTLTextPlugin:r="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=t;r&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"&&n.setRTLTextPlugin(r,l=>{l&&console.error(l)},!0)}const Ep=k.createContext(null);function T$(n,t,r){const l=k.useContext(f$),[u,d]=k.useState(null),p=k.useRef(),{current:b}=k.useRef({mapLib:null,map:null});k.useEffect(()=>{const T=n.mapLib;let A=!0,I;return Promise.resolve(T||r).then(O=>{if(!A)return;if(!O)throw new Error("Invalid mapLib");const z="Map"in O?O:O.default;if(!z.Map)throw new Error("Invalid mapLib");if(A$(z,n),!z.supported||z.supported(n))n.reuseMaps&&(I=lp.reuse(n,p.current)),I||(I=new lp(z.Map,n,p.current)),b.map=b$(I),b.mapLib=z,d(I),l==null||l.onMapMount(b.map,n.id);else throw new Error("Map is not supported by this browser")}).catch(O=>{const{onError:z}=n;z?z({type:"error",target:null,originalEvent:null,error:O}):console.error(O)}),()=>{A=!1,I&&(l==null||l.onMapUnmount(n.id),n.reuseMaps?I.recycle():I.destroy())}},[]),E$(()=>{u&&u.setProps(n)}),k.useImperativeHandle(t,()=>b.map,[u]);const i=k.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),E={height:"100%"};return k.createElement("div",{id:n.id,ref:p,style:i},u&&k.createElement(Ep.Provider,{value:b},k.createElement("div",{"mapboxgl-children":"",style:E},n.children)))}const S$=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Nd(n,t){if(!n||!t)return;const r=n.style;for(const l in t){const u=t[l];Number.isFinite(u)&&!S$.test(l)?r[l]=`${u}px`:r[l]=u}}function M$(n,t){const{map:r,mapLib:l}=k.useContext(Ep),u=k.useRef({props:n});u.current.props=n;const d=k.useMemo(()=>{let U=!1;k.Children.forEach(n.children,X=>{X&&(U=!0)});const N={...n,element:U?document.createElement("div"):null},V=new l.Marker(N);return V.setLngLat([n.longitude,n.latitude]),V.getElement().addEventListener("click",X=>{var J,te;(te=(J=u.current.props).onClick)===null||te===void 0||te.call(J,{type:"click",target:V,originalEvent:X})}),V.on("dragstart",X=>{var J,te;const ue=X;ue.lngLat=d.getLngLat(),(te=(J=u.current.props).onDragStart)===null||te===void 0||te.call(J,ue)}),V.on("drag",X=>{var J,te;const ue=X;ue.lngLat=d.getLngLat(),(te=(J=u.current.props).onDrag)===null||te===void 0||te.call(J,ue)}),V.on("dragend",X=>{var J,te;const ue=X;ue.lngLat=d.getLngLat(),(te=(J=u.current.props).onDragEnd)===null||te===void 0||te.call(J,ue)}),V},[]);k.useEffect(()=>(d.addTo(r.getMap()),()=>{d.remove()}),[]);const{longitude:p,latitude:b,offset:i,style:E,draggable:T=!1,popup:A=null,rotation:I=0,rotationAlignment:O="auto",pitchAlignment:z="auto"}=n;return k.useEffect(()=>{Nd(d.getElement(),E)},[E]),k.useImperativeHandle(t,()=>d,[]),(d.getLngLat().lng!==p||d.getLngLat().lat!==b)&&d.setLngLat([p,b]),i&&!p$(d.getOffset(),i)&&d.setOffset(i),d.isDraggable()!==T&&d.setDraggable(T),d.getRotation()!==I&&d.setRotation(I),d.getRotationAlignment()!==O&&d.setRotationAlignment(O),d.getPitchAlignment()!==z&&d.setPitchAlignment(z),d.getPopup()!==A&&d.setPopup(A),cp.createPortal(n.children,d.getElement())}k.memo(k.forwardRef(M$));function fT(n){return new Set(n?n.trim().split(/\s+/):[])}function I$(n,t){const{map:r,mapLib:l}=k.useContext(Ep),u=k.useMemo(()=>document.createElement("div"),[]),d=k.useRef({props:n});d.current.props=n;const p=k.useMemo(()=>{const b={...n},i=new l.Popup(b);return i.setLngLat([n.longitude,n.latitude]),i.once("open",E=>{var T,A;(A=(T=d.current.props).onOpen)===null||A===void 0||A.call(T,E)}),i},[]);if(k.useEffect(()=>{const b=i=>{var E,T;(T=(E=d.current.props).onClose)===null||T===void 0||T.call(E,i)};return p.on("close",b),p.setDOMContent(u).addTo(r.getMap()),()=>{p.off("close",b),p.isOpen()&&p.remove()}},[]),k.useEffect(()=>{Nd(p.getElement(),n.style)},[n.style]),k.useImperativeHandle(t,()=>p,[]),p.isOpen()&&((p.getLngLat().lng!==n.longitude||p.getLngLat().lat!==n.latitude)&&p.setLngLat([n.longitude,n.latitude]),n.offset&&!Ol(p.options.offset,n.offset)&&p.setOffset(n.offset),(p.options.anchor!==n.anchor||p.options.maxWidth!==n.maxWidth)&&(p.options.anchor=n.anchor,p.setMaxWidth(n.maxWidth)),p.options.className!==n.className)){const b=fT(p.options.className),i=fT(n.className);for(const E of b)i.has(E)||p.removeClassName(E);for(const E of i)b.has(E)||p.addClassName(E);p.options.className=n.className}return cp.createPortal(n.children,u)}k.memo(k.forwardRef(I$));function Cp(n,t,r,l){const u=k.useContext(Ep),d=k.useMemo(()=>n(u),[]);return k.useEffect(()=>{const p=t,b=typeof t=="function"&&typeof r=="function"?t:null,i=typeof t=="function"?t:null,{map:E}=u;return E.hasControl(d)||(E.addControl(d,p==null?void 0:p.position),b&&b(u)),()=>{i&&i(u),E.hasControl(d)&&E.removeControl(d)}},[]),d}function P$(n){const t=Cp(({mapLib:r})=>new r.AttributionControl(n),{position:n.position});return k.useEffect(()=>{Nd(t._container,n.style)},[n.style]),null}k.memo(P$);function L$(n){const t=Cp(({mapLib:r})=>new r.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return k.useEffect(()=>{Nd(t._controlContainer,n.style)},[n.style]),null}k.memo(L$);function B$(n,t){const r=k.useRef({props:n}),l=Cp(({mapLib:u})=>{const d=new u.GeolocateControl(n),p=d._setupUI;return d._setupUI=b=>{d._container.hasChildNodes()||p(b)},d.on("geolocate",b=>{var i,E;(E=(i=r.current.props).onGeolocate)===null||E===void 0||E.call(i,b)}),d.on("error",b=>{var i,E;(E=(i=r.current.props).onError)===null||E===void 0||E.call(i,b)}),d.on("outofmaxbounds",b=>{var i,E;(E=(i=r.current.props).onOutOfMaxBounds)===null||E===void 0||E.call(i,b)}),d.on("trackuserlocationstart",b=>{var i,E;(E=(i=r.current.props).onTrackUserLocationStart)===null||E===void 0||E.call(i,b)}),d.on("trackuserlocationend",b=>{var i,E;(E=(i=r.current.props).onTrackUserLocationEnd)===null||E===void 0||E.call(i,b)}),d},{position:n.position});return r.current.props=n,k.useImperativeHandle(t,()=>l,[]),k.useEffect(()=>{Nd(l._container,n.style)},[n.style]),null}k.memo(k.forwardRef(B$));function R$(n){const t=Cp(({mapLib:r})=>new r.NavigationControl(n),{position:n.position});return k.useEffect(()=>{Nd(t._container,n.style)},[n.style]),null}k.memo(R$);function D$(n){const t=Cp(({mapLib:d})=>new d.ScaleControl(n),{position:n.position}),r=k.useRef(n),l=r.current;r.current=n;const{style:u}=n;return n.maxWidth!==void 0&&n.maxWidth!==l.maxWidth&&(t.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==l.unit&&t.setUnit(n.unit),k.useEffect(()=>{Nd(t._container,u)},[u]),null}k.memo(D$);function R_(n,t){if(!n)throw new Error(t)}function O$(n,t,r,l){if(R_(r.id===l.id,"layer id changed"),R_(r.type===l.type,"layer type changed"),r.type==="custom"||l.type==="custom")return;const{layout:u={},paint:d={},filter:p,minzoom:b,maxzoom:i,beforeId:E}=r;if(E!==l.beforeId&&n.moveLayer(t,E),u!==l.layout){const T=l.layout||{};for(const A in u)Ol(u[A],T[A])||n.setLayoutProperty(t,A,u[A]);for(const A in T)u.hasOwnProperty(A)||n.setLayoutProperty(t,A,void 0)}if(d!==l.paint){const T=l.paint||{};for(const A in d)Ol(d[A],T[A])||n.setPaintProperty(t,A,d[A]);for(const A in T)d.hasOwnProperty(A)||n.setPaintProperty(t,A,void 0)}Ol(p,l.filter)||n.setFilter(t,p),(b!==l.minzoom||i!==l.maxzoom)&&n.setLayerZoomRange(t,b,i)}function k$(n,t,r){if(n.style&&n.style._loaded&&(!("source"in r)||n.getSource(r.source))){const l={...r,id:t};delete l.beforeId,n.addLayer(l,r.beforeId)}}let z$=0;function F$(n){const t=k.useContext(Ep).map.getMap(),r=k.useRef(n),[,l]=k.useState(0),u=k.useMemo(()=>n.id||`jsx-layer-${z$++}`,[]);if(k.useEffect(()=>{if(t){const p=()=>l(b=>b+1);return t.on("styledata",p),p(),()=>{t.off("styledata",p),t.style&&t.style._loaded&&t.getLayer(u)&&t.removeLayer(u)}}},[t]),t&&t.style&&t.getLayer(u))try{O$(t,u,n,r.current)}catch(p){console.warn(p)}else k$(t,u,n);return r.current=n,null}let j$=0;function U$(n,t,r){if(n.style&&n.style._loaded){const l={...r};return delete l.id,delete l.children,n.addSource(t,l),n.getSource(t)}return null}function N$(n,t,r){R_(t.id===r.id,"source id changed"),R_(t.type===r.type,"source type changed");let l="",u=0;for(const p in t)p!=="children"&&p!=="id"&&!Ol(r[p],t[p])&&(l=p,u++);if(!u)return;const d=t.type;if(d==="geojson")n.setData(t.data);else if(d==="image")n.updateImage({url:t.url,coordinates:t.coordinates});else if("setCoordinates"in n&&u===1&&l==="coordinates")n.setCoordinates(t.coordinates);else if("setUrl"in n)switch(l){case"url":n.setUrl(t.url);break;case"tiles":n.setTiles(t.tiles);break}else console.warn(`Unable to update <Source> prop: ${l}`)}function G$(n){const t=k.useContext(Ep).map.getMap(),r=k.useRef(n),[,l]=k.useState(0),u=k.useMemo(()=>n.id||`jsx-source-${j$++}`,[]);k.useEffect(()=>{if(t){const p=()=>setTimeout(()=>l(b=>b+1),0);return t.on("styledata",p),p(),()=>{var b;if(t.off("styledata",p),t.style&&t.style._loaded&&t.getSource(u)){const i=(b=t.getStyle())===null||b===void 0?void 0:b.layers;if(i)for(const E of i)E.source===u&&t.removeLayer(E.id);t.removeSource(u)}}}},[t]);let d=t&&t.style&&t.getSource(u);return d?N$(d,n,r.current):d=U$(t,u,n),r.current=n,d&&k.Children.map(n.children,p=>p&&k.cloneElement(p,{source:u}))||null}const V$=tS(()=>Promise.resolve().then(()=>d$),void 0,import.meta.url),$$=k.forwardRef(function(t,r){return T$(t,r,V$)}),fv=F$,H$=G$;function W$(n,t){var r=k.useRef(null),l=k.useRef(null);l.current=t;var u=k.useRef(null);k.useEffect(function(){d()});var d=k.useCallback(function(){var p=u.current,b=l.current,i=p||(b?b instanceof Element?b:b.current:null);r.current&&r.current.element===i&&r.current.subscriber===n||(r.current&&r.current.cleanup&&r.current.cleanup(),r.current={element:i,subscriber:n,cleanup:i?n(i):void 0})},[n]);return k.useEffect(function(){return function(){r.current&&r.current.cleanup&&(r.current.cleanup(),r.current=null)}},[]),k.useCallback(function(p){u.current=p,d()},[d])}function pT(n,t,r){return n[t]?n[t][0]?n[t][0][r]:n[t][r]:t==="contentBoxSize"?n.contentRect[r==="inlineSize"?"width":"height"]:void 0}function Z$(n){n===void 0&&(n={});var t=n.onResize,r=k.useRef(void 0);r.current=t;var l=n.round||Math.round,u=k.useRef(),d=k.useState({width:void 0,height:void 0}),p=d[0],b=d[1],i=k.useRef(!1);k.useEffect(function(){return i.current=!1,function(){i.current=!0}},[]);var E=k.useRef({width:void 0,height:void 0}),T=W$(k.useCallback(function(A){return(!u.current||u.current.box!==n.box||u.current.round!==l)&&(u.current={box:n.box,round:l,instance:new ResizeObserver(function(I){var O=I[0],z=n.box==="border-box"?"borderBoxSize":n.box==="device-pixel-content-box"?"devicePixelContentBoxSize":"contentBoxSize",U=pT(O,z,"inlineSize"),N=pT(O,z,"blockSize"),V=U?l(U):void 0,X=N?l(N):void 0;if(E.current.width!==V||E.current.height!==X){var J={width:V,height:X};E.current.width=V,E.current.height=X,r.current?r.current(J):i.current||b(J)}})}),u.current.instance.observe(A,{box:n.box}),function(){u.current&&u.current.instance.unobserve(A)}},[n.box,l]),n.ref);return k.useMemo(function(){return{ref:T,width:p.width,height:p.height}},[T,p.width,p.height])}class X${constructor(){bf(this,"_cls");bf(this,"_nameMap");bf(this,"params")}toJSON(){const t=this._cls,r=[];if(this.params)for(const[l,u]of Object.entries(this.params))l&&r.push([this._getSerializedName(l),u]);return{_cls:t,kwargs:r}}_getSerializedName(t){return this._nameMap.has(t)?this._nameMap.get(t):t}}class mT extends X${constructor(t=null){super(),this.params=t,this._cls="fiftyone.core.aggregations.Values",this._nameMap=new Map(Object.entries({fieldOrExpr:"field_or_expr",expr:"expr",missingValue:"missing_value",unwind:"unwind"}))}}const q$="/aggregate";function K$({view:n,filters:t,dataset:r,sample_ids:l}={}){const[u,d]=Pe.useState(!0),[p,b]=Pe.useState(null);return[async(E,T)=>{d(!0);const A=E.map(O=>O.toJSON()),I=await hp()("POST",q$,{filters:t,view:n,dataset:T||r.name,sample_ids:l,aggregations:A});b(I.aggregate),d(!1)},p,u]}const J$=({path:n,dataset:t,filters:r,view:l})=>{const[u,d,p]=K$({dataset:t,filters:r,view:l});return Pe.useEffect(()=>{u([new mT({fieldOrExpr:"id"}),new mT({fieldOrExpr:`${n}.point.coordinates`})],t.name)},[t,r,l,n]),{loading:p,samples:Pe.useMemo(()=>d?d[0].reduce((b,i,E)=>(d[1][E]&&(b[i]=d[1][E]),b),{}):{},[d])}};function Y$({draw:n,onCreate:t}){const r=Pe.useRef(t);return r.current=t,Cp(({map:l})=>(l.on("draw.create",u=>{r.current(u),n.delete(u.features[0].id)}),n),({map:l})=>{l.off("draw.create",r.current)}),null}const Ix="@fiftyone/map",Q$=Object.freeze({clustering:!0,clusterMaxZoom:11,clusters:{paint:{"circle-color":"rgb(244, 113, 6)","circle-opacity":.7,"circle-radius":["step",["get","point_count"],20,10,30,25,40]},textPaint:{"text-color":"white"}},pointPaint:{"circle-color":"rgb(244, 113, 6)","circle-opacity":.7,"circle-radius":4}}),eH=G_({key:"@fiftyone/map/state.defaultActiveField",get:({get:n})=>n(rP)[0]}),nP=Xo({key:"@fiftyone/map/state.activeField",default:eH}),rP=G_({key:"@fiftyone/map/state.geoFields",get:({get:n})=>n(PD).filter(t=>t.embeddedDocType==="fiftyone.core.labels.GeoLocation").map(({name:t})=>t).sort()}),tH=G_({key:"hasSelection",get:({get:n})=>n(zd).scope===Ix}),iP={Street:"streets-v11",Dark:"dark-v10",Light:"light-v10",Outdoors:"outdoors-v11",Satellite:"satellite-v9"},nH=Object.keys(iP),rH=G_({key:"defaultMapStyle",get:({get:n})=>n(LD)==="dark"?"Dark":"Light"}),oP=Xo({key:"@fiftyone/map/state.mapStyle",default:rH,effects:[pc("@fiftyone/map/state.style",{sessionStorage:!0,map:n=>["Dark","Light"].includes(n)?void 0:n})]}),iH="_options_1pz6v_1",pv="_link_1pz6v_16",oH=(n,t,r,l=!1)=>{const u=k.useRef(r);u.current=r,k.useEffect(()=>{if(!n)return;const d=p=>u.current(p);return n&&n.addEventListener(t,d,l),()=>{n&&n.removeEventListener(t,d)}},[n,t])},sH=n=>({values:nH.filter(r=>r.includes(n))}),gT=({value:n})=>Q.jsx(Q.Fragment,{children:n}),aH=({clearSelectionData:n,fitSelectionData:t,fitData:r})=>{const l=fc(),[u,d]=Pi(oP),p=sn(rP),[b,i]=Pi(nP),E=sn(tH),T={background:l.neutral.softBg,borderTopLeftRadius:3,borderTopRightRadius:3,padding:"0.25rem"},A=Pe.useCallback(()=>{n(),r()},[n,r]);return oH(window,"keydown",({key:I})=>{switch(I){case"Escape":A();break;case"f":t();break}}),Q.jsxs("div",{className:iH,children:[Q.jsxs("div",{children:[Q.jsx(u_,{placeholder:"Map Style",value:u,onSelect:d,useSearch:sH,component:gT,containerStyle:T,overflow:!0}),p.length>1&&Q.jsx(u_,{placeholder:"Field",value:b,onSelect:i,useSearch:()=>({values:p}),component:gT,containerStyle:T,overflow:!0})]}),Q.jsxs("div",{children:[E&&Q.jsx(i_,{to:A,className:pv,title:"Reset (Esc)",children:Q.jsx(O_,{})}),Q.jsx(i_,{to:t,className:pv,title:"Fit data (f)",children:Q.jsx(pS,{})}),Q.jsx(i_,{className:pv,href:"https://docs.voxel51.com/user_guide/app.html#map-panel",title:"Help",to:xT("https://docs.voxel51.com"),target:"_blank",children:Q.jsx(bT,{})}),Q.jsx(wT,{place:ET.MAP_ACTIONS})]})]})},sP={animate:!1,padding:30},aP=n=>n.features.reduce((t,{geometry:{coordinates:r}})=>t.extend(r),new Mx.LngLatBounds),mv=(n,t)=>{n.fitBounds(aP(t),sP)},lH=n=>{const t=Object.entries(n);return t.length===0?null:{type:"FeatureCollection",features:t.map(([r,l])=>({type:"Feature",properties:{id:r},geometry:{type:"Point",coordinates:l}}))}},cH=()=>{const n=fc(),t=sn(D_),r=sn(k_),l=sn(f1);let{loading:u,samples:d}=J$({dataset:t,filters:l,view:r,path:sn(nP)});const p=U_("map",Q$),b=sn(oP),[{selection:i},E]=Pi(zd),T=p1(),A=Pe.useRef(null),I=Pe.useMemo(()=>f_.debounce(()=>{A.current&&A.current.resize()},0,{trailing:!0}),[]),{ref:O}=Z$({onResize:I}),z=Pe.useMemo(()=>{let be=d;if(i){be={};for(const Ce of i)d[Ce]&&(be[Ce]=d[Ce])}return lH(be)},[d,i]),U=Pe.useMemo(()=>z&&aP(z),[d]),[N]=Pe.useState(()=>new QV({displayControlsDefault:!1,defaultMode:"draw_polygon"})),[V,X]=Pe.useState(!1),J=Pe.useCallback(()=>{var Ne;const be=(Ne=A.current)==null?void 0:Ne.getMap();if(!be)return;be.on("click","cluster",ht=>{var Gt;ht.preventDefault();const _t=be.queryRenderedFeatures(ht.point,{layers:["cluster"]});N.changeMode("simple_select");const Bt=(Gt=_t[0].properties)==null?void 0:Gt.cluster_id;be.getSource("points").getClusterExpansionZoom(Bt,(hn,wt)=>{var $t;if(hn)return;const bt=_t[0].geometry;($t=A.current)==null||$t.easeTo({center:bt.coordinates,zoom:wt})})});const Ce=()=>be.getCanvas().style.cursor="pointer",je=()=>be.getCanvas().style.cursor="crosshair",me=()=>be.getCanvas().style.cursor="all-scroll";be.on("mouseenter","cluster",Ce),be.on("mouseleave","cluster",je),be.on("mouseenter","point",()=>Ce),be.on("mouseleave","point",()=>je),be.on("dragstart",me),be.on("dragend",je)},[]),te=Pe.useMemo(()=>Object.keys(d).length,[d]);Pe.useEffect(()=>{A.current&&z&&mv(A.current,z)},[z]),VT(()=>new Promise(be=>{A.current.once("render",()=>{be(A.current.getCanvas())}),A.current.setBearing(A.current.getBearing())}));const ue=vT();return Pe.useEffect(()=>{ue(T)},[]),p.mapboxAccessToken?(!Object.keys(d).length||!z)&&!u?Q.jsx(Nh,{children:"No data"}):Q.jsxs("div",{className:JV,ref:O,children:[u&&!te?Q.jsx(Nh,{style:{opacity:.5},children:"Pixelating..."}):V?Q.jsxs(Nh,{children:["Something went wrong... is your ",Q.jsx(Yw,{style:{color:n.text.primary},href:"https://docs.voxel51.com/user_guide/app.html#map-panel",children:"Mapbox token"})," valid?"]}):Q.jsxs($$,{ref:A,mapLib:tP,mapStyle:`mapbox://styles/mapbox/${iP[b]}`,initialViewState:{bounds:U,fitBoundsOptions:sP},onStyleData:()=>{A.current&&(A.current.getCanvas().style.cursor="crosshair")},mapboxAccessToken:p.mapboxAccessToken,onLoad:J,onRender:()=>{N.getMode()!=="draw_polygon"&&N.changeMode("draw_polygon")},onError:({error:be})=>{throw X(!0),be},children:[Q.jsxs(H$,{id:"points",type:"geojson",data:z,cluster:p.clustering,clusterMaxZoom:p.clusterMaxZoom,children:[p.clustering&&Q.jsx(fv,{id:"cluster",filter:["has","point_count"],paint:{"circle-color":n.primary.plainColor,"circle-opacity":.7,"circle-radius":["step",["get","point_count"],20,10,30,25,40],...p.clusters.paint},type:"circle"}),p.clustering&&Q.jsx(fv,{id:"cluster-count",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:p.clusters.textPaint,type:"symbol"}),Q.jsx(fv,{id:"point",filter:["!",["has","point_count"]],paint:p.pointPaint,type:"circle"})]}),Q.jsx(Y$,{draw:N,onCreate:be=>{const{features:[Ce]}=be,je=new Set;for(let me=0;me<z.features.length;me++)r$(Ce,z.features[me])&&je.add(z.features[me].properties.id);je.size&&E({selection:Array.from(je),scope:Ix})}})]}),Q.jsx(aH,{fitData:()=>A.current&&mv(A.current,z),fitSelectionData:()=>A.current&&mv(A.current,z),clearSelectionData:T})]}):Q.jsxs(Nh,{children:["No Mapbox token provided. ",Q.jsx(Yw,{style:{color:n.text.primary},href:"https://docs.voxel51.com/user_guide/app.html#map-panel",children:"Learn more"})]})};var Px={},uH=Kh;Object.defineProperty(Px,"__esModule",{value:!0});var lP=Px.default=void 0,hH=uH(Xh()),dH=qh();lP=Px.default=(0,hH.default)((0,dH.jsx)("path",{d:"m20.5 3-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5M15 19l-6-2.11V5l6 2.11z"}),"Map");function fH(){const{selection:n,scope:t}=sn(zd),r=p1();return t!==Ix?null:Q.jsx(CT,{selectionCount:n==null?void 0:n.length.toString(),onClickSelection:r})}g1({name:"Map",label:"Map",component:cH,type:_1.Panel,activator:pH,Icon:lP,panelOptions:{TabIndicator:fH,priority:AT}});function pH({schema:n}){for(const t in n)if(n[t].embeddedDocType==="fiftyone.core.labels.GeoLocation")return!0;return!1}const mH=TB,BH=({prepared:n})=>{const t=BD.usePreloadedQuery(mH,n),l=sn(RD)===0;return Pe.createElement(FD,{fragment:t,hasDataset:!l},Pe.createElement("div",{className:jD.page,"data-cy":"dataset-page"},l?Pe.createElement(UD,{mode:"ADD_SAMPLE"}):Pe.createElement(DD.Provider,{value:t},Pe.createElement(OD,null),Pe.createElement(kD,null))),Pe.createElement(zD,null))};export{BH as default};
